{"version":3,"file":"LazyImage.vue_vue_type_script_setup_true_lang-a-nj9ALk.js","sources":["../../../../../../../ComfyUI_frontend/src/composables/useFeatureFlags.ts","../../../../../../../ComfyUI_frontend/src/components/input/SingleSelect.vue","../../../../../../../ComfyUI_frontend/src/platform/assets/composables/useModelTypes.ts","../../../../../../../ComfyUI_frontend/src/platform/assets/components/UploadModelConfirmation.vue","../../../../../../../ComfyUI_frontend/src/platform/assets/components/VideoHelpDialog.vue","../../../../../../../ComfyUI_frontend/src/platform/assets/components/UploadModelFooter.vue","../../../../../../../ComfyUI_frontend/src/platform/assets/components/UploadModelUrlInput.vue","../../../../../../../ComfyUI_frontend/src/platform/assets/components/UploadModelUrlInputCivitai.vue","../../../../../../../ComfyUI_frontend/src/platform/assets/importSources/civitaiImportSource.ts","../../../../../../../ComfyUI_frontend/src/platform/assets/importSources/huggingfaceImportSource.ts","../../../../../../../ComfyUI_frontend/src/platform/assets/utils/importSourceUtil.ts","../../../../../../../ComfyUI_frontend/src/platform/assets/composables/useUploadModelWizard.ts","../../../../../../../ComfyUI_frontend/src/platform/assets/components/UploadModelDialog.vue","../../../../../../../../../../assets/images/civitai.svg","../../../../../../../ComfyUI_frontend/src/platform/assets/components/UploadModelDialogHeader.vue","../../../../../../../ComfyUI_frontend/src/platform/assets/components/UploadModelUpgradeModalBody.vue","../../../../../../../ComfyUI_frontend/src/platform/assets/components/UploadModelUpgradeModalFooter.vue","../../../../../../../ComfyUI_frontend/src/platform/assets/components/UploadModelUpgradeModal.vue","../../../../../../../ComfyUI_frontend/src/platform/assets/components/UploadModelUpgradeModalHeader.vue","../../../../../../../ComfyUI_frontend/src/platform/assets/composables/useModelUpload.ts","../../../../../../../../../../assets/images/default-template.png","../../../../../../../ComfyUI_frontend/src/composables/useIntersectionObserver.ts","../../../../../../../ComfyUI_frontend/src/services/mediaCacheService.ts","../../../../../../../ComfyUI_frontend/src/components/common/LazyImage.vue"],"sourcesContent":["import { computed, reactive, readonly } from 'vue'\n\nimport { remoteConfig } from '@/platform/remoteConfig/remoteConfig'\nimport { api } from '@/scripts/api'\n\n/**\n * Known server feature flags (top-level, not extensions)\n */\nexport enum ServerFeatureFlag {\n  SUPPORTS_PREVIEW_METADATA = 'supports_preview_metadata',\n  MAX_UPLOAD_SIZE = 'max_upload_size',\n  MANAGER_SUPPORTS_V4 = 'extension.manager.supports_v4',\n  MODEL_UPLOAD_BUTTON_ENABLED = 'model_upload_button_enabled',\n  ASSET_DELETION_ENABLED = 'asset_deletion_enabled',\n  ASSET_RENAME_ENABLED = 'asset_rename_enabled',\n  PRIVATE_MODELS_ENABLED = 'private_models_enabled',\n  ONBOARDING_SURVEY_ENABLED = 'onboarding_survey_enabled',\n  HUGGINGFACE_MODEL_IMPORT_ENABLED = 'huggingface_model_import_enabled',\n  ASYNC_MODEL_UPLOAD_ENABLED = 'async_model_upload_enabled'\n}\n\n/**\n * Composable for reactive access to server-side feature flags\n */\nexport function useFeatureFlags() {\n  const flags = reactive({\n    get supportsPreviewMetadata() {\n      return api.getServerFeature(ServerFeatureFlag.SUPPORTS_PREVIEW_METADATA)\n    },\n    get maxUploadSize() {\n      return api.getServerFeature(ServerFeatureFlag.MAX_UPLOAD_SIZE)\n    },\n    get supportsManagerV4() {\n      return api.getServerFeature(ServerFeatureFlag.MANAGER_SUPPORTS_V4)\n    },\n    get modelUploadButtonEnabled() {\n      // Check remote config first (from /api/features), fall back to websocket feature flags\n      return (\n        remoteConfig.value.model_upload_button_enabled ??\n        api.getServerFeature(\n          ServerFeatureFlag.MODEL_UPLOAD_BUTTON_ENABLED,\n          false\n        )\n      )\n    },\n    get assetDeletionEnabled() {\n      return (\n        remoteConfig.value.asset_deletion_enabled ??\n        api.getServerFeature(ServerFeatureFlag.ASSET_DELETION_ENABLED, false)\n      )\n    },\n    get assetRenameEnabled() {\n      return (\n        remoteConfig.value.asset_rename_enabled ??\n        api.getServerFeature(ServerFeatureFlag.ASSET_RENAME_ENABLED, false)\n      )\n    },\n    get privateModelsEnabled() {\n      // Check remote config first (from /api/features), fall back to websocket feature flags\n      return (\n        remoteConfig.value.private_models_enabled ??\n        api.getServerFeature(ServerFeatureFlag.PRIVATE_MODELS_ENABLED, false)\n      )\n    },\n    get onboardingSurveyEnabled() {\n      return (\n        remoteConfig.value.onboarding_survey_enabled ??\n        api.getServerFeature(ServerFeatureFlag.ONBOARDING_SURVEY_ENABLED, true)\n      )\n    },\n    get huggingfaceModelImportEnabled() {\n      return (\n        remoteConfig.value.huggingface_model_import_enabled ??\n        api.getServerFeature(\n          ServerFeatureFlag.HUGGINGFACE_MODEL_IMPORT_ENABLED,\n          false\n        )\n      )\n    },\n    get asyncModelUploadEnabled() {\n      return (\n        remoteConfig.value.async_model_upload_enabled ??\n        api.getServerFeature(\n          ServerFeatureFlag.ASYNC_MODEL_UPLOAD_ENABLED,\n          false\n        )\n      )\n    }\n  })\n\n  const featureFlag = <T = unknown>(featurePath: string, defaultValue?: T) =>\n    computed(() => api.getServerFeature(featurePath, defaultValue))\n\n  return {\n    flags: readonly(flags),\n    featureFlag\n  }\n}\n","<template>\n  <!--\n    Note: We explicitly pass options here (not just via $attrs) because:\n    1. Our custom value template needs options to look up labels from values\n    2. PrimeVue's value slot only provides 'value' and 'placeholder', not the selected item's label\n    3. We need to maintain the icon slot functionality in the value template\n    option-label=\"name\" is required because our option template directly accesses option.name\n  -->\n  <Select\n    v-model=\"selectedItem\"\n    v-bind=\"$attrs\"\n    :options=\"options\"\n    option-label=\"name\"\n    option-value=\"value\"\n    unstyled\n    :pt=\"{\n      root: ({ props }: SelectPassThroughMethodOptions<SelectOption>) => ({\n        class: [\n          // container\n          'h-10 relative inline-flex cursor-pointer select-none items-center',\n          // trigger surface\n          'rounded-lg',\n          'bg-secondary-background text-base-foreground',\n          'border-[2.5px] border-solid border-transparent',\n          'transition-all duration-200 ease-in-out',\n          'focus-within:border-node-component-border',\n          // disabled\n          { 'opacity-60 cursor-default': props.disabled }\n        ]\n      }),\n      label: {\n        class:\n          // Align with MultiSelect labelContainer spacing\n          'flex-1 flex items-center whitespace-nowrap pl-4 py-2 outline-hidden'\n      },\n      dropdown: {\n        class:\n          // Right chevron touch area\n          'flex shrink-0 items-center justify-center px-3 py-2'\n      },\n      overlay: {\n        class: cn(\n          'mt-2 p-2 rounded-lg',\n          'bg-base-background text-base-foreground',\n          'border border-solid border-border-default'\n        )\n      },\n      listContainer: () => ({\n        style: `max-height: min(${listMaxHeight}, 50vh)`,\n        class: 'scrollbar-custom'\n      }),\n      list: {\n        class:\n          // Same list tone/size as MultiSelect\n          'flex flex-col gap-0 p-0 m-0 list-none border-none text-sm'\n      },\n      option: ({ context }: SelectPassThroughMethodOptions<SelectOption>) => ({\n        class: cn(\n          // Row layout\n          'flex items-center justify-between gap-3 px-2 py-3 rounded',\n          'hover:bg-secondary-background-hover',\n          // Add focus state for keyboard navigation\n          context.focused && 'bg-secondary-background-hover',\n          // Selected state + check icon\n          context.selected &&\n            'bg-secondary-background-selected hover:bg-secondary-background-selected'\n        )\n      }),\n      optionLabel: {\n        class: 'truncate'\n      },\n      optionGroupLabel: {\n        class: 'px-3 py-2 text-xs uppercase tracking-wide text-muted-foreground'\n      },\n      emptyMessage: {\n        class: 'px-3 py-2 text-sm text-muted-foreground'\n      }\n    }\"\n    :aria-label=\"label || t('g.singleSelectDropdown')\"\n    role=\"combobox\"\n    :aria-expanded=\"false\"\n    aria-haspopup=\"listbox\"\n    :tabindex=\"0\"\n  >\n    <!-- Trigger value -->\n    <template #value=\"slotProps\">\n      <div class=\"flex items-center gap-2 text-sm\">\n        <slot name=\"icon\" />\n        <span\n          v-if=\"slotProps.value !== null && slotProps.value !== undefined\"\n          class=\"text-base-foreground\"\n        >\n          {{ getLabel(slotProps.value) }}\n        </span>\n        <span v-else class=\"text-base-foreground\">\n          {{ label }}\n        </span>\n      </div>\n    </template>\n\n    <!-- Trigger caret -->\n    <template #dropdownicon>\n      <i class=\"icon-[lucide--chevron-down] text-muted-foreground\" />\n    </template>\n\n    <!-- Option row -->\n    <template #option=\"{ option, selected }\">\n      <div\n        class=\"flex w-full items-center justify-between gap-3\"\n        :style=\"optionStyle\"\n      >\n        <span class=\"truncate\">{{ option.name }}</span>\n        <i v-if=\"selected\" class=\"icon-[lucide--check] text-base-foreground\" />\n      </div>\n    </template>\n  </Select>\n</template>\n\n<script setup lang=\"ts\">\nimport type { SelectPassThroughMethodOptions } from 'primevue/select'\nimport Select from 'primevue/select'\nimport { computed } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport { cn } from '@/utils/tailwindUtil'\n\nimport type { SelectOption } from './types'\n\ndefineOptions({\n  inheritAttrs: false\n})\n\nconst {\n  label,\n  options,\n  listMaxHeight = '28rem',\n  popoverMinWidth,\n  popoverMaxWidth\n} = defineProps<{\n  label?: string\n  /**\n   * Required for displaying the selected item's label.\n   * Cannot rely on $attrs alone because we need to access options\n   * in getLabel() to map values to their display names.\n   */\n  options?: SelectOption[]\n  /** Maximum height of the dropdown panel (default: 28rem) */\n  listMaxHeight?: string\n  /** Minimum width of the popover (default: auto) */\n  popoverMinWidth?: string\n  /** Maximum width of the popover (default: auto) */\n  popoverMaxWidth?: string\n}>()\n\nconst selectedItem = defineModel<string | undefined>({ required: true })\n\nconst { t } = useI18n()\n\n/**\n * Maps a value to its display label.\n * Necessary because PrimeVue's value slot doesn't provide the selected item's label,\n * only the raw value. We need this to show the correct text when an item is selected.\n */\nconst getLabel = (val: string | null | undefined) => {\n  if (val == null) return label ?? ''\n  if (!options) return label ?? ''\n  const found = options.find((o) => o.value === val)\n  return found ? found.name : (label ?? '')\n}\n\n// Extract complex style logic from template\nconst optionStyle = computed(() => {\n  if (!popoverMinWidth && !popoverMaxWidth) return undefined\n\n  const styles: string[] = []\n  if (popoverMinWidth) styles.push(`min-width: ${popoverMinWidth}`)\n  if (popoverMaxWidth) styles.push(`max-width: ${popoverMaxWidth}`)\n\n  return styles.join('; ')\n})\n</script>\n","import { createSharedComposable, useAsyncState } from '@vueuse/core'\n\nimport { api } from '@/scripts/api'\n\n/**\n * Format folder name to display name\n * Converts \"upscale_models\" -> \"Upscale Model\"\n * Converts \"loras\" -> \"LoRA\"\n */\nfunction formatDisplayName(folderName: string): string {\n  // Special cases for acronyms and proper nouns\n  const specialCases: Record<string, string> = {\n    loras: 'LoRA',\n    ipadapter: 'IP-Adapter',\n    sams: 'SAM',\n    clip_vision: 'CLIP Vision',\n    animatediff_motion_lora: 'AnimateDiff Motion LoRA',\n    animatediff_models: 'AnimateDiff Model',\n    vae: 'VAE',\n    sam2: 'SAM 2',\n    controlnet: 'ControlNet',\n    gligen: 'GLIGEN'\n  }\n\n  if (specialCases[folderName]) {\n    return specialCases[folderName]\n  }\n\n  return folderName\n    .split('_')\n    .map((word) => word.charAt(0).toUpperCase() + word.slice(1))\n    .join(' ')\n}\n\ninterface ModelTypeOption {\n  name: string // Display name\n  value: string // Actual tag value\n}\n\nconst DISALLOWED_MODEL_TYPES = ['nlf'] as const\n\n/**\n * Composable for fetching and managing model types from the API\n * Uses shared state to ensure data is only fetched once\n */\nexport const useModelTypes = createSharedComposable(() => {\n  const {\n    state: modelTypes,\n    isLoading,\n    error,\n    execute: fetchModelTypes\n  } = useAsyncState(\n    async (): Promise<ModelTypeOption[]> => {\n      const response = await api.getModelFolders()\n      return response\n        .filter(\n          (folder) =>\n            !DISALLOWED_MODEL_TYPES.includes(\n              folder.name as (typeof DISALLOWED_MODEL_TYPES)[number]\n            )\n        )\n        .map((folder) => ({\n          name: formatDisplayName(folder.name),\n          value: folder.name\n        }))\n        .sort((a, b) => a.name.localeCompare(b.name))\n    },\n    [] as ModelTypeOption[],\n    {\n      immediate: false,\n      onError: (err) => {\n        console.error('Failed to fetch model types:', err)\n      }\n    }\n  )\n\n  return {\n    modelTypes,\n    isLoading,\n    error,\n    fetchModelTypes\n  }\n})\n","<template>\n  <div class=\"flex flex-col gap-4 text-sm text-muted-foreground\">\n    <div class=\"flex flex-col gap-2\">\n      <p class=\"m-0\">\n        {{ $t('assetBrowser.modelAssociatedWithLink') }}\n      </p>\n      <div\n        class=\"flex items-center gap-3 bg-secondary-background p-3 rounded-lg\"\n      >\n        <img\n          v-if=\"previewImage\"\n          :src=\"previewImage\"\n          :alt=\"metadata?.filename || metadata?.name || 'Model preview'\"\n          class=\"w-14 h-14 rounded object-cover flex-shrink-0\"\n        />\n        <p class=\"m-0 text-base-foreground\">\n          {{ metadata?.filename || metadata?.name }}\n        </p>\n      </div>\n    </div>\n\n    <!-- Model Type Selection -->\n    <div class=\"flex flex-col gap-2\">\n      <label class=\"\">\n        {{ $t('assetBrowser.modelTypeSelectorLabel') }}\n      </label>\n      <SingleSelect\n        v-model=\"modelValue\"\n        :label=\"\n          isLoading\n            ? $t('g.loading')\n            : $t('assetBrowser.modelTypeSelectorPlaceholder')\n        \"\n        :options=\"modelTypes\"\n        :disabled=\"isLoading\"\n        data-attr=\"upload-model-step2-type-selector\"\n      />\n      <div class=\"flex items-center gap-2\">\n        <i class=\"icon-[lucide--circle-question-mark]\" />\n        <span>{{ $t('assetBrowser.notSureLeaveAsIs') }}</span>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport SingleSelect from '@/components/input/SingleSelect.vue'\nimport { useModelTypes } from '@/platform/assets/composables/useModelTypes'\nimport type { AssetMetadata } from '@/platform/assets/schemas/assetSchema'\n\ndefineProps<{\n  metadata?: AssetMetadata\n  previewImage?: string\n}>()\n\nconst modelValue = defineModel<string | undefined>()\n\nconst { modelTypes, isLoading } = useModelTypes()\n</script>\n","<template>\n  <Dialog\n    v-model:visible=\"isVisible\"\n    modal\n    :closable=\"false\"\n    :close-on-escape=\"false\"\n    :dismissable-mask=\"true\"\n    :pt=\"{\n      root: { class: 'video-help-dialog' },\n      header: { class: '!hidden' },\n      content: { class: '!p-0' },\n      mask: { class: '!bg-black/70' }\n    }\"\n    :style=\"{ width: '90vw', maxWidth: '800px' }\"\n  >\n    <div class=\"relative\">\n      <Button\n        variant=\"textonly\"\n        size=\"icon\"\n        class=\"absolute top-4 right-6 z-10\"\n        :aria-label=\"$t('g.close')\"\n        @click=\"isVisible = false\"\n      >\n        <i class=\"pi pi-times text-sm\" />\n      </Button>\n      <video\n        autoplay\n        muted\n        loop\n        :aria-label=\"ariaLabel\"\n        class=\"w-full rounded-lg\"\n        :src=\"videoUrl\"\n      >\n        {{ $t('g.videoFailedToLoad') }}\n      </video>\n    </div>\n  </Dialog>\n</template>\n\n<script setup lang=\"ts\">\nimport { useEventListener } from '@vueuse/core'\nimport Dialog from 'primevue/dialog'\nimport { onWatcherCleanup, watch } from 'vue'\n\nimport Button from '@/components/ui/button/Button.vue'\n\nconst isVisible = defineModel<boolean>({ required: true })\n\nconst { videoUrl, ariaLabel = 'Help video' } = defineProps<{\n  videoUrl: string\n  ariaLabel?: string\n}>()\n\nconst handleEscapeKey = (event: KeyboardEvent) => {\n  if (event.key === 'Escape') {\n    event.stopImmediatePropagation()\n    event.stopPropagation()\n    event.preventDefault()\n    isVisible.value = false\n  }\n}\n\n// Add listener with capture phase to intercept before parent dialogs\n// Only active when dialog is visible\nwatch(\n  isVisible,\n  (visible) => {\n    if (visible) {\n      const stop = useEventListener(document, 'keydown', handleEscapeKey, {\n        capture: true\n      })\n      onWatcherCleanup(stop)\n    }\n  },\n  { immediate: true }\n)\n</script>\n","<template>\n  <div class=\"flex justify-end gap-2 w-full\">\n    <div\n      v-if=\"currentStep === 1 && flags.huggingfaceModelImportEnabled\"\n      class=\"mr-auto flex items-center gap-2\"\n    >\n      <i class=\"icon-[lucide--circle-question-mark] text-muted-foreground\" />\n      <Button\n        variant=\"muted-textonly\"\n        size=\"sm\"\n        data-attr=\"upload-model-step1-help-civitai\"\n        @click=\"showCivitaiHelp = true\"\n      >\n        {{ $t('assetBrowser.providerCivitai') }}\n      </Button>\n      <Button\n        variant=\"muted-textonly\"\n        size=\"sm\"\n        data-attr=\"upload-model-step1-help-huggingface\"\n        @click=\"showHuggingFaceHelp = true\"\n      >\n        {{ $t('assetBrowser.providerHuggingFace') }}\n      </Button>\n    </div>\n    <Button\n      v-else-if=\"currentStep === 1\"\n      variant=\"muted-textonly\"\n      size=\"lg\"\n      class=\"mr-auto underline\"\n      data-attr=\"upload-model-step1-help-link\"\n      @click=\"showCivitaiHelp = true\"\n    >\n      <i class=\"icon-[lucide--circle-question-mark]\" />\n      <span>{{ $t('assetBrowser.uploadModelHowDoIFindThis') }}</span>\n    </Button>\n    <Button\n      v-if=\"currentStep === 1\"\n      variant=\"muted-textonly\"\n      size=\"lg\"\n      data-attr=\"upload-model-step1-cancel-button\"\n      :disabled=\"isFetchingMetadata || isUploading\"\n      @click=\"emit('close')\"\n    >\n      {{ $t('g.cancel') }}\n    </Button>\n    <Button\n      v-if=\"currentStep !== 1 && currentStep !== 3\"\n      variant=\"muted-textonly\"\n      size=\"lg\"\n      :data-attr=\"`upload-model-step${currentStep}-back-button`\"\n      :disabled=\"isFetchingMetadata || isUploading\"\n      @click=\"emit('back')\"\n    >\n      {{ $t('g.back') }}\n    </Button>\n    <span v-else />\n\n    <Button\n      v-if=\"currentStep === 1\"\n      variant=\"secondary\"\n      size=\"lg\"\n      data-attr=\"upload-model-step1-continue-button\"\n      :disabled=\"!canFetchMetadata || isFetchingMetadata\"\n      @click=\"emit('fetchMetadata')\"\n    >\n      <i\n        v-if=\"isFetchingMetadata\"\n        class=\"icon-[lucide--loader-circle] animate-spin\"\n      />\n      <span>{{ $t('g.continue') }}</span>\n    </Button>\n    <Button\n      v-else-if=\"currentStep === 2\"\n      variant=\"secondary\"\n      size=\"lg\"\n      data-attr=\"upload-model-step2-confirm-button\"\n      :disabled=\"!canUploadModel || isUploading\"\n      @click=\"emit('upload')\"\n    >\n      <i v-if=\"isUploading\" class=\"icon-[lucide--loader-circle] animate-spin\" />\n      <span>{{ $t('assetBrowser.upload') }}</span>\n    </Button>\n    <Button\n      v-else-if=\"\n        currentStep === 3 &&\n        (uploadStatus === 'success' || uploadStatus === 'processing')\n      \"\n      variant=\"secondary\"\n      data-attr=\"upload-model-step3-finish-button\"\n      @click=\"emit('close')\"\n    >\n      {{\n        uploadStatus === 'processing'\n          ? $t('g.close')\n          : $t('assetBrowser.finish')\n      }}\n    </Button>\n    <VideoHelpDialog\n      v-model=\"showCivitaiHelp\"\n      video-url=\"https://media.comfy.org/compressed_768/civitai_howto.webm\"\n      :aria-label=\"$t('assetBrowser.uploadModelHelpVideo')\"\n    />\n    <VideoHelpDialog\n      v-model=\"showHuggingFaceHelp\"\n      video-url=\"https://media.comfy.org/byom/huggingfacehowto.mp4\"\n      :aria-label=\"$t('assetBrowser.uploadModelHelpVideo')\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref } from 'vue'\n\nimport Button from '@/components/ui/button/Button.vue'\nimport { useFeatureFlags } from '@/composables/useFeatureFlags'\nimport VideoHelpDialog from '@/platform/assets/components/VideoHelpDialog.vue'\n\nconst { flags } = useFeatureFlags()\n\nconst showCivitaiHelp = ref(false)\nconst showHuggingFaceHelp = ref(false)\n\ndefineProps<{\n  currentStep: number\n  isFetchingMetadata: boolean\n  isUploading: boolean\n  canFetchMetadata: boolean\n  canUploadModel: boolean\n  uploadStatus?: 'processing' | 'success' | 'error'\n}>()\n\nconst emit = defineEmits<{\n  (e: 'back'): void\n  (e: 'fetchMetadata'): void\n  (e: 'upload'): void\n  (e: 'close'): void\n}>()\n</script>\n","<template>\n  <div class=\"flex flex-col justify-between h-full gap-6 text-sm\">\n    <div class=\"flex flex-col gap-6\">\n      <div class=\"flex flex-col gap-2\">\n        <p class=\"m-0 text-foreground\">\n          {{ $t('assetBrowser.uploadModelDescription1Generic') }}\n        </p>\n        <div class=\"m-0\">\n          <p class=\"m-0 text-muted-foreground\">\n            {{ $t('assetBrowser.uploadModelDescription2Generic') }}\n          </p>\n          <span class=\"inline-flex items-center gap-1 flex-wrap mt-2\">\n            <span class=\"inline-flex items-center gap-1\">\n              <img\n                :src=\"civitaiIcon\"\n                :alt=\"$t('assetBrowser.providerCivitai')\"\n                class=\"w-4 h-4\"\n              />\n              <a\n                :href=\"civitaiUrl\"\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                class=\"text-muted underline\"\n              >\n                {{ $t('assetBrowser.providerCivitai') }}</a\n              ><span>,</span>\n            </span>\n            <span class=\"inline-flex items-center gap-1\">\n              <img\n                :src=\"huggingFaceIcon\"\n                :alt=\"$t('assetBrowser.providerHuggingFace')\"\n                class=\"w-4 h-4\"\n              />\n              <a\n                :href=\"huggingFaceUrl\"\n                target=\"_blank\"\n                rel=\"noopener noreferrer\"\n                class=\"text-muted underline\"\n              >\n                {{ $t('assetBrowser.providerHuggingFace') }}\n              </a>\n            </span>\n          </span>\n        </div>\n      </div>\n\n      <div class=\"flex flex-col gap-2\">\n        <InputText\n          v-model=\"url\"\n          autofocus\n          :placeholder=\"$t('assetBrowser.genericLinkPlaceholder')\"\n          class=\"w-full bg-secondary-background border-0 p-4\"\n          data-attr=\"upload-model-step1-url-input\"\n        />\n        <p v-if=\"error\" class=\"text-xs text-error\">\n          {{ error }}\n        </p>\n        <p v-else-if=\"!flags.asyncModelUploadEnabled\" class=\"text-foreground\">\n          <i18n-t keypath=\"assetBrowser.maxFileSize\" tag=\"span\">\n            <template #size>\n              <span class=\"font-bold italic\">{{\n                $t('assetBrowser.maxFileSizeValue')\n              }}</span>\n            </template>\n          </i18n-t>\n        </p>\n      </div>\n    </div>\n\n    <div class=\"text-sm text-muted\">\n      {{ $t('assetBrowser.uploadModelHelpFooterText') }}\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport InputText from 'primevue/inputtext'\nimport { computed } from 'vue'\n\nimport { useFeatureFlags } from '@/composables/useFeatureFlags'\n\nconst { flags } = useFeatureFlags()\n\nconst props = defineProps<{\n  modelValue: string\n  error?: string\n}>()\n\nconst emit = defineEmits<{\n  'update:modelValue': [value: string]\n}>()\n\nconst url = computed({\n  get: () => props.modelValue,\n  set: (value: string) => emit('update:modelValue', value)\n})\n\nconst civitaiIcon = '/assets/images/civitai.svg'\nconst civitaiUrl = 'https://civitai.com/models'\nconst huggingFaceIcon = '/assets/images/hf-logo.svg'\nconst huggingFaceUrl = 'https://huggingface.co'\n</script>\n","<template>\n  <div class=\"flex flex-col gap-6 text-sm text-muted-foreground\">\n    <div class=\"flex flex-col gap-2\">\n      <p class=\"m-0\">\n        {{ $t('assetBrowser.uploadModelDescription1') }}\n      </p>\n      <ul class=\"list-disc space-y-1 pl-5 mt-0\">\n        <li>\n          <i18n-t keypath=\"assetBrowser.uploadModelDescription2\" tag=\"span\">\n            <template #link>\n              <a\n                href=\"https://civitai.com/models\"\n                target=\"_blank\"\n                class=\"text-muted-foreground\"\n              >\n                {{ $t('assetBrowser.uploadModelDescription2Link') }}\n              </a>\n            </template>\n          </i18n-t>\n        </li>\n        <li v-if=\"!flags.asyncModelUploadEnabled\">\n          <i18n-t keypath=\"assetBrowser.uploadModelDescription3\" tag=\"span\">\n            <template #size>\n              <span class=\"font-bold italic\">{{\n                $t('assetBrowser.maxFileSizeValue')\n              }}</span>\n            </template>\n          </i18n-t>\n        </li>\n      </ul>\n    </div>\n\n    <div class=\"flex flex-col gap-2\">\n      <i18n-t keypath=\"assetBrowser.civitaiLinkLabel\" tag=\"label\" class=\"mb-0\">\n        <template #download>\n          <span class=\"font-bold italic\">{{\n            $t('assetBrowser.civitaiLinkLabelDownload')\n          }}</span>\n        </template>\n      </i18n-t>\n      <InputText\n        v-model=\"url\"\n        autofocus\n        :placeholder=\"$t('assetBrowser.civitaiLinkPlaceholder')\"\n        class=\"w-full bg-secondary-background border-0 p-4\"\n        data-attr=\"upload-model-step1-url-input\"\n      />\n      <p v-if=\"error\" class=\"text-xs text-error\">\n        {{ error }}\n      </p>\n      <i18n-t\n        v-else\n        keypath=\"assetBrowser.civitaiLinkExample\"\n        tag=\"p\"\n        class=\"text-xs\"\n      >\n        <template #example>\n          <strong>{{ $t('assetBrowser.civitaiLinkExampleStrong') }}</strong>\n        </template>\n        <template #link>\n          <a\n            href=\"https://civitai.com/models/10706/luisap-z-image-and-qwen-pixel-art-refiner?modelVersionId=2225295\"\n            target=\"_blank\"\n            class=\"text-muted-foreground\"\n          >\n            {{ $t('assetBrowser.civitaiLinkExampleUrl') }}\n          </a>\n        </template>\n      </i18n-t>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport InputText from 'primevue/inputtext'\n\nimport { useFeatureFlags } from '@/composables/useFeatureFlags'\n\nconst { flags } = useFeatureFlags()\n\ndefineProps<{\n  error?: string\n}>()\n\nconst url = defineModel<string>({ required: true })\n</script>\n","import type { ImportSource } from '@/platform/assets/types/importSource'\n\n/**\n * Civitai model import source configuration\n */\nexport const civitaiImportSource: ImportSource = {\n  type: 'civitai',\n  name: 'Civitai',\n  hostnames: ['civitai.com']\n}\n","import type { ImportSource } from '@/platform/assets/types/importSource'\n\n/**\n * Hugging Face model import source configuration\n */\nexport const huggingfaceImportSource: ImportSource = {\n  type: 'huggingface',\n  name: 'Hugging Face',\n  hostnames: ['huggingface.co']\n}\n","import type { ImportSource } from '@/platform/assets/types/importSource'\n\n/**\n * Check if a URL belongs to a specific import source\n */\nexport function validateSourceUrl(url: string, source: ImportSource): boolean {\n  try {\n    const hostname = new URL(url).hostname.toLowerCase()\n    return source.hostnames.some(\n      (h) => hostname === h || hostname.endsWith(`.${h}`)\n    )\n  } catch {\n    return false\n  }\n}\n","import type { Ref } from 'vue'\nimport { computed, ref, watch } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport { useFeatureFlags } from '@/composables/useFeatureFlags'\nimport { st } from '@/i18n'\nimport { civitaiImportSource } from '@/platform/assets/importSources/civitaiImportSource'\nimport { huggingfaceImportSource } from '@/platform/assets/importSources/huggingfaceImportSource'\nimport type { AssetMetadata } from '@/platform/assets/schemas/assetSchema'\nimport { assetService } from '@/platform/assets/services/assetService'\nimport type { ImportSource } from '@/platform/assets/types/importSource'\nimport { validateSourceUrl } from '@/platform/assets/utils/importSourceUtil'\nimport { useAssetDownloadStore } from '@/stores/assetDownloadStore'\nimport { useAssetsStore } from '@/stores/assetsStore'\nimport { useModelToNodeStore } from '@/stores/modelToNodeStore'\n\ninterface WizardData {\n  url: string\n  metadata?: AssetMetadata\n  name: string\n  tags: string[]\n  previewImage?: string\n}\n\ninterface ModelTypeOption {\n  name: string\n  value: string\n}\n\nexport function useUploadModelWizard(modelTypes: Ref<ModelTypeOption[]>) {\n  const { t } = useI18n()\n  const assetsStore = useAssetsStore()\n  const assetDownloadStore = useAssetDownloadStore()\n  const modelToNodeStore = useModelToNodeStore()\n  const { flags } = useFeatureFlags()\n  const currentStep = ref(1)\n  const isFetchingMetadata = ref(false)\n  const isUploading = ref(false)\n  const uploadStatus = ref<'processing' | 'success' | 'error'>()\n  const uploadError = ref('')\n\n  const wizardData = ref<WizardData>({\n    url: '',\n    name: '',\n    tags: []\n  })\n\n  const selectedModelType = ref<string>()\n\n  // Available import sources\n  const importSources: ImportSource[] = flags.huggingfaceModelImportEnabled\n    ? [civitaiImportSource, huggingfaceImportSource]\n    : [civitaiImportSource]\n\n  // Detected import source based on URL\n  const detectedSource = computed(() => {\n    const url = wizardData.value.url.trim()\n    if (!url) return null\n    return (\n      importSources.find((source) => validateSourceUrl(url, source)) ?? null\n    )\n  })\n\n  // Clear error when URL changes\n  watch(\n    () => wizardData.value.url,\n    () => {\n      uploadError.value = ''\n    }\n  )\n\n  // Validation\n  const canFetchMetadata = computed(() => {\n    return wizardData.value.url.trim().length > 0\n  })\n\n  const canUploadModel = computed(() => {\n    return !!selectedModelType.value\n  })\n\n  async function fetchMetadata() {\n    if (!canFetchMetadata.value) return\n\n    // Clean and normalize URL\n    let cleanedUrl = wizardData.value.url.trim()\n    try {\n      cleanedUrl = new URL(encodeURI(cleanedUrl)).toString()\n    } catch {\n      // If URL parsing fails, just use the trimmed input\n    }\n    wizardData.value.url = cleanedUrl\n\n    // Validate URL belongs to a supported import source\n    const source = detectedSource.value\n    if (!source) {\n      const supportedSources = importSources.map((s) => s.name).join(', ')\n      uploadError.value = t('assetBrowser.unsupportedUrlSource', {\n        sources: supportedSources\n      })\n      return\n    }\n\n    isFetchingMetadata.value = true\n    try {\n      const metadata = await assetService.getAssetMetadata(wizardData.value.url)\n\n      // Decode URL-encoded filenames (e.g., Chinese characters)\n      if (metadata.filename) {\n        try {\n          metadata.filename = decodeURIComponent(metadata.filename)\n        } catch {\n          // Keep original if decoding fails\n        }\n      }\n      if (metadata.name) {\n        try {\n          metadata.name = decodeURIComponent(metadata.name)\n        } catch {\n          // Keep original if decoding fails\n        }\n      }\n\n      wizardData.value.metadata = metadata\n\n      // Pre-fill name from metadata\n      wizardData.value.name = metadata.filename || metadata.name || ''\n\n      // Store preview image if available\n      wizardData.value.previewImage = metadata.preview_image\n\n      // Pre-fill model type from metadata tags if available\n      if (metadata.tags && metadata.tags.length > 0) {\n        wizardData.value.tags = metadata.tags\n        // Try to detect model type from tags\n        const typeTag = metadata.tags.find((tag) =>\n          modelTypes.value.some((type) => type.value === tag)\n        )\n        if (typeTag) {\n          selectedModelType.value = typeTag\n        }\n      }\n\n      currentStep.value = 2\n    } catch (error) {\n      console.error('Failed to retrieve metadata:', error)\n      uploadError.value =\n        error instanceof Error\n          ? error.message\n          : st(\n              'assetBrowser.uploadModelFailedToRetrieveMetadata',\n              'Failed to retrieve metadata. Please check the link and try again.'\n            )\n      currentStep.value = 1\n    } finally {\n      isFetchingMetadata.value = false\n    }\n  }\n\n  async function uploadPreviewImage(\n    filename: string\n  ): Promise<string | undefined> {\n    if (!wizardData.value.previewImage) return undefined\n\n    try {\n      const baseFilename = filename.split('.')[0]\n      let extension = 'png'\n      const mimeMatch = wizardData.value.previewImage.match(\n        /^data:image\\/([^;]+);/\n      )\n      if (mimeMatch) {\n        extension = mimeMatch[1] === 'jpeg' ? 'jpg' : mimeMatch[1]\n      }\n\n      const previewAsset = await assetService.uploadAssetFromBase64({\n        data: wizardData.value.previewImage,\n        name: `${baseFilename}_preview.${extension}`,\n        tags: ['preview']\n      })\n      return previewAsset.id\n    } catch (error) {\n      console.error('Failed to upload preview image:', error)\n      return undefined\n    }\n  }\n\n  async function refreshModelCaches() {\n    if (!selectedModelType.value) return\n\n    const providers = modelToNodeStore.getAllNodeProviders(\n      selectedModelType.value\n    )\n    const results = await Promise.allSettled(\n      providers.map((provider) =>\n        assetsStore.updateModelsForNodeType(provider.nodeDef.name)\n      )\n    )\n    results.forEach((result, index) => {\n      if (result.status === 'rejected') {\n        console.error(\n          `Failed to refresh ${providers[index].nodeDef.name}:`,\n          result.reason\n        )\n      }\n    })\n  }\n\n  async function uploadModel(): Promise<boolean> {\n    if (!canUploadModel.value) {\n      return false\n    }\n\n    const source = detectedSource.value\n    if (!source) {\n      uploadError.value = t('assetBrowser.noValidSourceDetected')\n      return false\n    }\n\n    isUploading.value = true\n\n    try {\n      const tags = selectedModelType.value\n        ? ['models', selectedModelType.value]\n        : ['models']\n      const filename =\n        wizardData.value.metadata?.filename ||\n        wizardData.value.metadata?.name ||\n        'model'\n\n      const previewId = await uploadPreviewImage(filename)\n      const userMetadata = {\n        source: source.type,\n        source_url: wizardData.value.url,\n        model_type: selectedModelType.value\n      }\n\n      if (flags.asyncModelUploadEnabled) {\n        const result = await assetService.uploadAssetAsync({\n          source_url: wizardData.value.url,\n          tags,\n          user_metadata: userMetadata,\n          preview_id: previewId\n        })\n\n        if (result.type === 'async' && result.task.status !== 'completed') {\n          if (selectedModelType.value) {\n            assetDownloadStore.trackDownload(\n              result.task.task_id,\n              selectedModelType.value\n            )\n          }\n          uploadStatus.value = 'processing'\n        } else {\n          uploadStatus.value = 'success'\n          await refreshModelCaches()\n        }\n        currentStep.value = 3\n      } else {\n        await assetService.uploadAssetFromUrl({\n          url: wizardData.value.url,\n          name: filename,\n          tags,\n          user_metadata: userMetadata,\n          preview_id: previewId\n        })\n        uploadStatus.value = 'success'\n        await refreshModelCaches()\n        currentStep.value = 3\n      }\n    } catch (error) {\n      console.error('Failed to upload asset:', error)\n      uploadStatus.value = 'error'\n      uploadError.value =\n        error instanceof Error ? error.message : 'Failed to upload model'\n      currentStep.value = 3\n    } finally {\n      isUploading.value = false\n    }\n    return uploadStatus.value !== 'error'\n  }\n\n  function goToPreviousStep() {\n    if (currentStep.value > 1) {\n      currentStep.value = currentStep.value - 1\n    }\n  }\n\n  return {\n    // State\n    currentStep,\n    isFetchingMetadata,\n    isUploading,\n    uploadStatus,\n    uploadError,\n    wizardData,\n    selectedModelType,\n\n    // Computed\n    canFetchMetadata,\n    canUploadModel,\n    detectedSource,\n\n    // Actions\n    fetchMetadata,\n    uploadModel,\n    goToPreviousStep\n  }\n}\n","<template>\n  <div\n    class=\"upload-model-dialog flex flex-col justify-between gap-6 p-4 pt-6 border-t border-border-default\"\n  >\n    <!-- Step 1: Enter URL -->\n    <UploadModelUrlInput\n      v-if=\"currentStep === 1 && flags.huggingfaceModelImportEnabled\"\n      v-model=\"wizardData.url\"\n      :error=\"uploadError\"\n      class=\"flex-1\"\n    />\n    <UploadModelUrlInputCivitai\n      v-else-if=\"currentStep === 1\"\n      v-model=\"wizardData.url\"\n      :error=\"uploadError\"\n    />\n\n    <!-- Step 2: Confirm Metadata -->\n    <UploadModelConfirmation\n      v-else-if=\"currentStep === 2\"\n      v-model=\"selectedModelType\"\n      :metadata=\"wizardData.metadata\"\n      :preview-image=\"wizardData.previewImage\"\n    />\n\n    <!-- Step 3: Upload Progress -->\n    <UploadModelProgress\n      v-else-if=\"currentStep === 3 && uploadStatus != null\"\n      :result=\"uploadStatus\"\n      :error=\"uploadError\"\n      :metadata=\"wizardData.metadata\"\n      :model-type=\"selectedModelType\"\n      :preview-image=\"wizardData.previewImage\"\n    />\n\n    <!-- Navigation Footer -->\n    <UploadModelFooter\n      :current-step=\"currentStep\"\n      :is-fetching-metadata=\"isFetchingMetadata\"\n      :is-uploading=\"isUploading\"\n      :can-fetch-metadata=\"canFetchMetadata\"\n      :can-upload-model=\"canUploadModel\"\n      :upload-status=\"uploadStatus\"\n      @back=\"goToPreviousStep\"\n      @fetch-metadata=\"handleFetchMetadata\"\n      @upload=\"handleUploadModel\"\n      @close=\"handleClose\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { onMounted } from 'vue'\n\nimport { useFeatureFlags } from '@/composables/useFeatureFlags'\nimport UploadModelConfirmation from '@/platform/assets/components/UploadModelConfirmation.vue'\nimport UploadModelFooter from '@/platform/assets/components/UploadModelFooter.vue'\nimport UploadModelProgress from '@/platform/assets/components/UploadModelProgress.vue'\nimport UploadModelUrlInput from '@/platform/assets/components/UploadModelUrlInput.vue'\nimport UploadModelUrlInputCivitai from '@/platform/assets/components/UploadModelUrlInputCivitai.vue'\nimport { useModelTypes } from '@/platform/assets/composables/useModelTypes'\nimport { useUploadModelWizard } from '@/platform/assets/composables/useUploadModelWizard'\nimport { useDialogStore } from '@/stores/dialogStore'\n\nconst { flags } = useFeatureFlags()\nconst dialogStore = useDialogStore()\nconst { modelTypes, fetchModelTypes } = useModelTypes()\n\nconst emit = defineEmits<{\n  'upload-success': []\n}>()\n\nconst {\n  currentStep,\n  isFetchingMetadata,\n  isUploading,\n  uploadStatus,\n  uploadError,\n  wizardData,\n  selectedModelType,\n  canFetchMetadata,\n  canUploadModel,\n  fetchMetadata,\n  uploadModel,\n  goToPreviousStep\n} = useUploadModelWizard(modelTypes)\n\nasync function handleFetchMetadata() {\n  await fetchMetadata()\n}\n\nasync function handleUploadModel() {\n  const success = await uploadModel()\n  if (success) {\n    emit('upload-success')\n  }\n}\n\nfunction handleClose() {\n  dialogStore.closeDialog({ key: 'upload-model' })\n}\n\nonMounted(() => {\n  fetchModelTypes()\n})\n</script>\n\n<style scoped>\n.upload-model-dialog {\n  width: 90vw;\n  max-width: 800px;\n  min-height: 400px;\n}\n\n@media (min-width: 640px) {\n  .upload-model-dialog {\n    width: auto;\n    min-width: 600px;\n  }\n}\n</style>\n","export default \"__VITE_PUBLIC_ASSET__53f47e52__\"","<template>\n  <div class=\"flex items-center gap-2 p-4 font-bold\">\n    <img\n      v-if=\"!flags.huggingfaceModelImportEnabled\"\n      src=\"/assets/images/civitai.svg\"\n      class=\"size-4\"\n    />\n    <span>{{ $t(titleKey) }}</span>\n    <span\n      class=\"rounded-full bg-white px-1.5 py-0 text-xxs font-inter font-semibold uppercase text-black\"\n    >\n      {{ $t('g.beta') }}\n    </span>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\n\nimport { useFeatureFlags } from '@/composables/useFeatureFlags'\n\nconst { flags } = useFeatureFlags()\n\nconst titleKey = computed(() => {\n  return flags.huggingfaceModelImportEnabled\n    ? 'assetBrowser.uploadModelGeneric'\n    : 'assetBrowser.uploadModelFromCivitai'\n})\n</script>\n","<template>\n  <div\n    class=\"flex flex-1 flex-col items-center justify-center text-base text-muted-foreground\"\n  >\n    <p class=\"m-0 max-w-md\">\n      {{ $t('assetBrowser.upgradeFeatureDescription') }}\n    </p>\n  </div>\n</template>\n","<template>\n  <div class=\"flex flex-wrap justify-end gap-2 w-full\">\n    <a\n      href=\"https://blog.comfy.org/p/comfy-cloud-new-features-and-pricing\"\n      target=\"_blank\"\n      rel=\"noopener noreferrer\"\n      class=\"text-muted-foreground mr-auto underline flex items-center gap-2\"\n    >\n      <i class=\"icon-[lucide--external-link]\" />\n      <span>{{ $t('g.learnMore') }}</span>\n    </a>\n    <Button variant=\"textonly\" @click=\"emit('close')\">{{\n      $t('g.close')\n    }}</Button>\n    <Button variant=\"secondary\" @click=\"emit('subscribe')\">\n      {{ $t('subscription.required.subscribe') }}\n    </Button>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport Button from '@/components/ui/button/Button.vue'\n\nconst emit = defineEmits<{\n  close: []\n  subscribe: []\n}>()\n</script>\n","<template>\n  <div\n    class=\"flex flex-col justify-between gap-10 p-4 border-t border-border-default w-auto max-w-[min(500px,90vw)]\"\n  >\n    <UploadModelUpgradeModalBody />\n\n    <UploadModelUpgradeModalFooter\n      @close=\"handleClose\"\n      @subscribe=\"handleSubscribe\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport UploadModelUpgradeModalBody from '@/platform/assets/components/UploadModelUpgradeModalBody.vue'\nimport UploadModelUpgradeModalFooter from '@/platform/assets/components/UploadModelUpgradeModalFooter.vue'\nimport { useSubscription } from '@/platform/cloud/subscription/composables/useSubscription'\nimport { useDialogStore } from '@/stores/dialogStore'\n\nconst dialogStore = useDialogStore()\nconst { showSubscriptionDialog } = useSubscription()\n\nfunction handleClose() {\n  dialogStore.closeDialog({ key: 'upload-model-upgrade' })\n}\n\nfunction handleSubscribe() {\n  showSubscriptionDialog()\n}\n</script>\n","<template>\n  <div class=\"flex items-center gap-2 p-4 font-bold\">\n    <span>{{ $t('assetBrowser.upgradeToUnlockFeature') }}</span>\n  </div>\n</template>\n","import { useFeatureFlags } from '@/composables/useFeatureFlags'\nimport UploadModelDialog from '@/platform/assets/components/UploadModelDialog.vue'\nimport UploadModelDialogHeader from '@/platform/assets/components/UploadModelDialogHeader.vue'\nimport UploadModelUpgradeModal from '@/platform/assets/components/UploadModelUpgradeModal.vue'\nimport UploadModelUpgradeModalHeader from '@/platform/assets/components/UploadModelUpgradeModalHeader.vue'\nimport { useDialogStore } from '@/stores/dialogStore'\nimport { computed } from 'vue'\n\nexport function useModelUpload(\n  onUploadSuccess?: () => Promise<unknown> | void\n) {\n  const dialogStore = useDialogStore()\n  const { flags } = useFeatureFlags()\n  const isUploadButtonEnabled = computed(() => flags.modelUploadButtonEnabled)\n\n  function showUploadDialog() {\n    if (!flags.privateModelsEnabled) {\n      // Show upgrade modal if private models are disabled\n      dialogStore.showDialog({\n        key: 'upload-model-upgrade',\n        headerComponent: UploadModelUpgradeModalHeader,\n        component: UploadModelUpgradeModal,\n        dialogComponentProps: {\n          pt: {\n            header: 'py-0! pl-0!',\n            content: 'p-0!'\n          }\n        }\n      })\n    } else {\n      // Show regular upload modal\n      dialogStore.showDialog({\n        key: 'upload-model',\n        headerComponent: UploadModelDialogHeader,\n        component: UploadModelDialog,\n        props: {\n          onUploadSuccess: async () => {\n            await onUploadSuccess?.()\n          }\n        },\n        dialogComponentProps: {\n          pt: {\n            header: 'py-0! pl-0!',\n            content: 'p-0!'\n          }\n        }\n      })\n    }\n  }\n  return { isUploadButtonEnabled, showUploadDialog }\n}\n","export default \"__VITE_PUBLIC_ASSET__c8cdd13f__\"","import { onBeforeUnmount, ref, watch } from 'vue'\nimport type { Ref } from 'vue'\n\ninterface UseIntersectionObserverOptions extends IntersectionObserverInit {\n  immediate?: boolean\n}\n\nexport function useIntersectionObserver(\n  target: Ref<Element | null>,\n  callback: IntersectionObserverCallback,\n  options: UseIntersectionObserverOptions = {}\n) {\n  const { immediate = true, ...observerOptions } = options\n\n  const isSupported =\n    typeof window !== 'undefined' && 'IntersectionObserver' in window\n  const isIntersecting = ref(false)\n\n  let observer: IntersectionObserver | null = null\n\n  const cleanup = () => {\n    if (observer) {\n      observer.disconnect()\n      observer = null\n    }\n  }\n\n  const observe = () => {\n    cleanup()\n\n    if (!isSupported || !target.value) return\n\n    observer = new IntersectionObserver((entries) => {\n      isIntersecting.value = entries.some((entry) => entry.isIntersecting)\n      callback(entries, observer!)\n    }, observerOptions)\n\n    observer.observe(target.value)\n  }\n\n  const unobserve = () => {\n    if (observer && target.value) {\n      observer.unobserve(target.value)\n    }\n  }\n\n  if (immediate) {\n    watch(target, observe, { immediate: true, flush: 'post' })\n  }\n\n  onBeforeUnmount(cleanup)\n\n  return {\n    isSupported,\n    isIntersecting,\n    observe,\n    unobserve,\n    cleanup\n  }\n}\n","import { reactive } from 'vue'\n\ninterface CachedMedia {\n  src: string\n  blob?: Blob\n  objectUrl?: string\n  error?: boolean\n  isLoading: boolean\n  lastAccessed: number\n}\n\ninterface MediaCacheOptions {\n  maxSize?: number\n  maxAge?: number // in milliseconds\n  preloadDistance?: number // pixels from viewport\n}\n\nclass MediaCacheService {\n  public cache = reactive(new Map<string, CachedMedia>())\n  private readonly maxSize: number\n  private readonly maxAge: number\n  private cleanupInterval: number | null = null\n  private urlRefCount = new Map<string, number>()\n\n  constructor(options: MediaCacheOptions = {}) {\n    this.maxSize = options.maxSize ?? 100\n    this.maxAge = options.maxAge ?? 30 * 60 * 1000 // 30 minutes\n\n    // Start cleanup interval\n    this.startCleanupInterval()\n  }\n\n  private startCleanupInterval() {\n    // Clean up every 5 minutes\n    this.cleanupInterval = window.setInterval(\n      () => {\n        this.cleanup()\n      },\n      5 * 60 * 1000\n    )\n  }\n\n  private cleanup() {\n    const now = Date.now()\n    const keysToDelete: string[] = []\n\n    // Find expired entries\n    for (const [key, entry] of Array.from(this.cache.entries())) {\n      if (now - entry.lastAccessed > this.maxAge) {\n        // Only revoke object URL if no components are using it\n        if (entry.objectUrl) {\n          const refCount = this.urlRefCount.get(entry.objectUrl) || 0\n          if (refCount === 0) {\n            URL.revokeObjectURL(entry.objectUrl)\n            this.urlRefCount.delete(entry.objectUrl)\n            keysToDelete.push(key)\n          }\n          // Don't delete cache entry if URL is still in use\n        } else {\n          keysToDelete.push(key)\n        }\n      }\n    }\n\n    // Remove expired entries\n    keysToDelete.forEach((key) => this.cache.delete(key))\n\n    // If still over size limit, remove oldest entries that aren't in use\n    if (this.cache.size > this.maxSize) {\n      const entries = Array.from(this.cache.entries())\n      entries.sort((a, b) => a[1].lastAccessed - b[1].lastAccessed)\n\n      let removedCount = 0\n      const targetRemoveCount = this.cache.size - this.maxSize\n\n      for (const [key, entry] of entries) {\n        if (removedCount >= targetRemoveCount) break\n\n        if (entry.objectUrl) {\n          const refCount = this.urlRefCount.get(entry.objectUrl) || 0\n          if (refCount === 0) {\n            URL.revokeObjectURL(entry.objectUrl)\n            this.urlRefCount.delete(entry.objectUrl)\n            this.cache.delete(key)\n            removedCount++\n          }\n        } else {\n          this.cache.delete(key)\n          removedCount++\n        }\n      }\n    }\n  }\n\n  async getCachedMedia(src: string): Promise<CachedMedia> {\n    let entry = this.cache.get(src)\n\n    if (entry) {\n      // Update last accessed time\n      entry.lastAccessed = Date.now()\n      return entry\n    }\n\n    // Create new entry\n    entry = {\n      src,\n      isLoading: true,\n      lastAccessed: Date.now()\n    }\n\n    // Update cache with loading entry\n    this.cache.set(src, entry)\n\n    try {\n      // Fetch the media\n      const response = await fetch(src, { cache: 'force-cache' })\n      if (!response.ok) {\n        throw new Error(`Failed to fetch: ${response.status}`)\n      }\n\n      const blob = await response.blob()\n      const objectUrl = URL.createObjectURL(blob)\n\n      // Update entry with successful result\n      const updatedEntry: CachedMedia = {\n        src,\n        blob,\n        objectUrl,\n        isLoading: false,\n        lastAccessed: Date.now()\n      }\n\n      this.cache.set(src, updatedEntry)\n      return updatedEntry\n    } catch (error) {\n      console.warn('Failed to cache media:', src, error)\n\n      // Update entry with error\n      const errorEntry: CachedMedia = {\n        src,\n        error: true,\n        isLoading: false,\n        lastAccessed: Date.now()\n      }\n\n      this.cache.set(src, errorEntry)\n      return errorEntry\n    }\n  }\n\n  acquireUrl(src: string): string | undefined {\n    const entry = this.cache.get(src)\n    if (entry?.objectUrl) {\n      const currentCount = this.urlRefCount.get(entry.objectUrl) || 0\n      this.urlRefCount.set(entry.objectUrl, currentCount + 1)\n      return entry.objectUrl\n    }\n    return undefined\n  }\n\n  releaseUrl(src: string): void {\n    const entry = this.cache.get(src)\n    if (entry?.objectUrl) {\n      const count = (this.urlRefCount.get(entry.objectUrl) || 1) - 1\n      if (count <= 0) {\n        URL.revokeObjectURL(entry.objectUrl)\n        this.urlRefCount.delete(entry.objectUrl)\n        // Remove from cache as well\n        this.cache.delete(src)\n      } else {\n        this.urlRefCount.set(entry.objectUrl, count)\n      }\n    }\n  }\n\n  clearCache() {\n    // Revoke all object URLs\n    for (const entry of Array.from(this.cache.values())) {\n      if (entry.objectUrl) {\n        URL.revokeObjectURL(entry.objectUrl)\n      }\n    }\n    this.cache.clear()\n    this.urlRefCount.clear()\n  }\n\n  destroy() {\n    if (this.cleanupInterval) {\n      clearInterval(this.cleanupInterval)\n      this.cleanupInterval = null\n    }\n    this.clearCache()\n  }\n}\n\n// Global instance\nlet mediaCacheInstance: MediaCacheService | null = null\n\nexport function useMediaCache(options?: MediaCacheOptions) {\n  if (!mediaCacheInstance) {\n    mediaCacheInstance = new MediaCacheService(options)\n  }\n\n  const getCachedMedia = (src: string) =>\n    mediaCacheInstance!.getCachedMedia(src)\n  const clearCache = () => mediaCacheInstance!.clearCache()\n  const acquireUrl = (src: string) => mediaCacheInstance!.acquireUrl(src)\n  const releaseUrl = (src: string) => mediaCacheInstance!.releaseUrl(src)\n\n  return {\n    getCachedMedia,\n    clearCache,\n    acquireUrl,\n    releaseUrl,\n    cache: mediaCacheInstance.cache\n  }\n}\n\n// Cleanup on page unload\nif (typeof window !== 'undefined') {\n  window.addEventListener('beforeunload', () => {\n    if (mediaCacheInstance) {\n      mediaCacheInstance.destroy()\n    }\n  })\n}\n","<template>\n  <div\n    ref=\"containerRef\"\n    class=\"relative flex h-full w-full items-center justify-center overflow-hidden\"\n    :class=\"containerClass\"\n  >\n    <Skeleton\n      v-if=\"!isImageLoaded\"\n      width=\"100%\"\n      height=\"100%\"\n      class=\"absolute inset-0\"\n    />\n    <img\n      v-if=\"cachedSrc\"\n      :src=\"cachedSrc\"\n      :alt=\"alt\"\n      draggable=\"false\"\n      :class=\"imageClass\"\n      :style=\"imageStyle\"\n      @load=\"onImageLoad\"\n      @error=\"onImageError\"\n    />\n    <div\n      v-if=\"hasError\"\n      class=\"absolute inset-0 flex items-center justify-center\"\n    >\n      <img\n        src=\"/assets/images/default-template.png\"\n        :alt=\"alt\"\n        draggable=\"false\"\n        :class=\"imageClass\"\n        :style=\"imageStyle\"\n      />\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport Skeleton from 'primevue/skeleton'\nimport { computed, onUnmounted, ref, watch } from 'vue'\n\nimport { useIntersectionObserver } from '@/composables/useIntersectionObserver'\nimport { useMediaCache } from '@/services/mediaCacheService'\nimport type { ClassValue } from '@/utils/tailwindUtil'\n\nconst {\n  src,\n  alt = '',\n  containerClass = '',\n  imageClass = '',\n  imageStyle,\n  rootMargin = '300px'\n} = defineProps<{\n  src: string\n  alt?: string\n  containerClass?: ClassValue\n  imageClass?: ClassValue\n  imageStyle?: Record<string, any>\n  rootMargin?: string\n}>()\n\nconst containerRef = ref<HTMLElement | null>(null)\nconst isIntersecting = ref(false)\nconst isImageLoaded = ref(false)\nconst hasError = ref(false)\nconst cachedSrc = ref<string | undefined>(undefined)\n\nconst { getCachedMedia, acquireUrl, releaseUrl } = useMediaCache()\n\n// Use intersection observer to detect when the image container comes into view\nuseIntersectionObserver(\n  containerRef,\n  (entries) => {\n    const entry = entries[0]\n    isIntersecting.value = entry?.isIntersecting ?? false\n  },\n  {\n    rootMargin,\n    threshold: 0.1\n  }\n)\n\n// Only start loading the image when it's in view\nconst shouldLoad = computed(() => isIntersecting.value)\n\nwatch(\n  shouldLoad,\n  async (shouldLoadVal) => {\n    if (shouldLoadVal && src && !cachedSrc.value && !hasError.value) {\n      try {\n        const cachedMedia = await getCachedMedia(src)\n        if (cachedMedia.error) {\n          hasError.value = true\n        } else if (cachedMedia.objectUrl) {\n          const acquiredUrl = acquireUrl(src)\n          cachedSrc.value = acquiredUrl || cachedMedia.objectUrl\n        } else {\n          cachedSrc.value = src\n        }\n      } catch (error) {\n        console.warn('Failed to load cached media:', error)\n        cachedSrc.value = src\n      }\n    } else if (!shouldLoadVal) {\n      if (cachedSrc.value?.startsWith('blob:')) {\n        releaseUrl(src)\n      }\n      // Hide image when out of view\n      isImageLoaded.value = false\n      cachedSrc.value = undefined\n      hasError.value = false\n    }\n  },\n  { immediate: true }\n)\n\nconst onImageLoad = () => {\n  isImageLoaded.value = true\n  hasError.value = false\n}\n\nconst onImageError = () => {\n  hasError.value = true\n  isImageLoaded.value = false\n}\n\nonUnmounted(() => {\n  if (cachedSrc.value?.startsWith('blob:')) {\n    releaseUrl(src)\n  }\n})\n</script>\n"],"names":["useFeatureFlags","flags","reactive","api","remoteConfig","featureFlag","__name","featurePath","defaultValue","computed","readonly","selectedItem","_useModel","__props","t","useI18n","getLabel","val","found","o","optionStyle","styles","formatDisplayName","folderName","specialCases","word","DISALLOWED_MODEL_TYPES","useModelTypes","createSharedComposable","modelTypes","isLoading","error","fetchModelTypes","useAsyncState","folder","a","b","err","modelValue","isVisible","handleEscapeKey","event","watch","visible","stop","useEventListener","onWatcherCleanup","showCivitaiHelp","ref","showHuggingFaceHelp","emit","__emit","civitaiIcon","civitaiUrl","huggingFaceIcon","huggingFaceUrl","props","url","value","civitaiImportSource","huggingfaceImportSource","validateSourceUrl","source","hostname","h","useUploadModelWizard","assetsStore","useAssetsStore","assetDownloadStore","useAssetDownloadStore","modelToNodeStore","useModelToNodeStore","currentStep","isFetchingMetadata","isUploading","uploadStatus","uploadError","wizardData","selectedModelType","importSources","detectedSource","canFetchMetadata","canUploadModel","fetchMetadata","cleanedUrl","supportedSources","s","metadata","assetService","typeTag","tag","type","st","uploadPreviewImage","filename","baseFilename","extension","mimeMatch","refreshModelCaches","providers","provider","result","index","uploadModel","tags","previewId","userMetadata","goToPreviousStep","dialogStore","useDialogStore","handleFetchMetadata","handleUploadModel","handleClose","onMounted","_imports_0$1","titleKey","_hoisted_1","_hoisted_2","_openBlock","_createElementBlock","_createElementVNode","_toDisplayString","_ctx","showSubscriptionDialog","useSubscription","handleSubscribe","useModelUpload","onUploadSuccess","isUploadButtonEnabled","showUploadDialog","UploadModelDialogHeader","UploadModelDialog","UploadModelUpgradeModalHeader","UploadModelUpgradeModal","_imports_0","useIntersectionObserver","target","callback","options","immediate","observerOptions","isSupported","isIntersecting","observer","cleanup","observe","entries","entry","unobserve","onBeforeUnmount","MediaCacheService","now","keysToDelete","key","removedCount","targetRemoveCount","src","response","blob","objectUrl","updatedEntry","errorEntry","currentCount","count","mediaCacheInstance","useMediaCache","containerRef","isImageLoaded","hasError","cachedSrc","getCachedMedia","acquireUrl","releaseUrl","shouldLoad","shouldLoadVal","cachedMedia","acquiredUrl","onImageLoad","onImageError","onUnmounted"],"mappings":"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"}