{"version":3,"mappings":"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","names":["TemplateIncludeOnDistributionEnum","getCategoryIcon","__name","categoryId","generateCategoryId","categoryGroup","categoryTitle","useWorkflowTemplatesStore","defineStore","customTemplates","shallowRef","coreTemplates","englishTemplates","isLoaded","ref","knownTemplateNames","getTemplateByName","name","enhancedTemplates","template","categoryFilters","addLocalizedFieldsToTemplate","st","normalizeI18nKey","localizeTemplateList","templates","localizeTemplateCategory","templateCategory","createAllCategory","coreTemplatesWithSourceModule","category","customTemplatesWithSourceModule","moduleName","groupedTemplates","computed","allTemplates","t","enhancedTemplate","templateFuse","fuseOptions","Fuse","filterTemplatesByCategory","filter","navGroupedTemplates","items","essentialCats","cat","essentialCat","categoryIcon","categoryGroups","group","groupName","word","extensionItems","loadWorkflowTemplates","api","locale","i18n","coreResult","englishResult","isCloud","coreNames","customNames","error","getEnglishMetadata","templateName","OnCloseKey","BREAKPOINTS","PANEL_SIZES","slots","useSlots","closeDialog","inject","notMobile","useBreakpoints","isLeftPanelOpen","isRightPanelOpen","mobileMenuOpen","hasRightPanel","watch","isDesktop","showLeftPanel","toggleLeftPanel","toggleRightPanel","emit","__emit","isCollapsed","__props","value","toggleCollapse","_hoisted_1","_hoisted_2","_hoisted_3","_openBlock","_createElementBlock","_createElementVNode","_renderSlot","_ctx","collapsedGroups","getFirstItemId","firstEntry","activeItem","usePopoverSizing","options","minWidth","maxWidth","style","selectedItems","_useModel","searchQuery","useI18n","selectedCount","popoverStyle","attrs","useAttrs","originalOptions","results","useFuse","filteredOptions","searchResults","result","item","useAssetFilterOptions","assets","availableFileFormats","extensions","toValue","asset","extension","uniqWith","a","b","format","availableBaseModels","models","baseModel","model","sortOptions","ownershipOptions","fileFormats","baseModels","sortBy","ownership","hasMutableAssets","handleFilterChange","option","isOpen","popover","hide","__expose","promptTextReal","confirmTextX","cancelTextX","disabled","showConfirmDialog","dialogStore","useDialogStore","headerProps","props","footerProps","ConfirmHeader","ConfirmBody","ConfirmFooter","settingStore","useSettingStore","flags","useFeatureFlags","toastStore","useToastStore","dropdownMenuButton","useTemplateRef","titleId","useId","descId","isEditing","newNameRef","deletedLocal","displayName","showAssetOptions","tooltipDelay","isLoading","useImage","confirmDeletion","assetName","promptText","optionsDisabled","confirmDialog","cn","assetService","resolve","err","startAssetRename","assetRename","newName","assetsWithKey","gridStyle","getAssetDescription","getAssetBaseModel","filterByCategory","tag","filterByFileFormats","formats","formatSet","filterByBaseModels","modelSet","filterByOwnership","useAssetBrowser","assetsSource","selectedCategory","filters","transformAssetForDisplay","typeTag","description","badges","badgeLabel","stats","d","availableCategories","categories","uniqueCategories","contentTitle","categoryFilteredAssets","fuseResults","searchFiltered","filteredAssets","sortedAssets","updateFilters","newFilters","ACRONYM_TAGS","formatCategoryLabel","raw","segment","upper","lower","assetStore","useAssetsStore","modelToNodeStore","useModelToNodeStore","breakpoints","breakpointsTailwind","provide","cacheKey","fetchedAssets","isStoreLoading","refreshAssets","isUploadButtonEnabled","showUploadDialog","useModelUpload","primaryCategoryTag","tagFromAssets","mapped","activeCategoryTag","displayTitle","label","shouldShowLeftPanel","handleClose","handleAssetSelectAndEmit","dialogComponentProps","useAssetBrowserDialog","dialogKey","show","handleAssetSelected","AssetBrowserModal","browse","clickableClasses","togglePopover","event","variant","menuBackgroundStyle","labelClasses","textClasses","iconColorClass","iconClass","dotClasses","popoverPt","POLL_INTERVAL_MS","MAX_POLL_DURATION_MS","subscribe","isActiveSubscription","fetchStatus","showSubscriptionDialog","useSubscription","telemetry","useTelemetry","isPolling","pollInterval","isAwaitingStripeSubscription","startPollingSubscriptionStatus","startTime","poll","stopPolling","awaiting","isActive","handleSubscribe","onBeforeUnmount","DIALOG_KEY","useSubscriptionDialog","dialogService","useDialogService","defineAsyncComponent","__vitePreload","toast","useToast","newMessages","message","messagesToRemove","requested","updateToastPosition","styleElement","createStyleElement","rect","nextTick","_runWhenIdle","runWhenGlobalIdle","safeGlobal","_targetWindow","runner","_timeout","disposed","end","targetWindow","timeout","handle","workspaceState","useWorkspaceStore","exitFocusMode","watchEffect","app","workflowStore","useWorkflowStore","handleBeforeUnload","onMounted","workspaceStore","rightSidePanelStore","useRightSidePanelStore","sidebarTabStore","useSidebarTabStore","sidebarLocation","unifiedWidth","focusMode","storeToRefs","activeSidebarTabId","activeSidebarTab","bottomPanelVisible","useBottomPanelStore","rightSidePanelVisible","sidebarPanelVisible","sidebarStateKey","onResizestart","splitterRefreshKey","firstPanelStyle","lastPanelStyle","buildTooltipConfig","ComfyRunButton","settingsStore","commandStore","useCommandStore","isExecutionIdle","useExecutionStore","position","visible","tabContainer","panelRef","dragHandleRef","isDocked","useLocalStorage","storedPosition","x","y","isDragging","useDraggable","minY","watchDebounced","newX","newY","setInitialPosition","screenWidth","screenHeight","menuWidth","menuHeight","clamp","captureLastDragState","comfyRunButtonResolved","newVisible","useEventListener","lastDragState","newIsDragging","distanceLeft","distanceRight","distanceTop","distanceBottom","closestEdge","min","curr","verticalRatio","horizontalRatio","isMouseOverDropZone","onMouseEnterDropZone","onMouseLeaveDropZone","dragging","cancelJobTooltipConfig","cancelCurrentJob","actionbarClass","panelClass","isNodeMissingDefinition","node","nodeDefsByName","nodeName","collectMissingNodes","graph","lookup","unref","collectAllNodes","graphHasMissingNodes","nodeDefStore","useNodeDefStore","hasMissingNodes","menu","workflowService","useWorkflowService","itemLabel","itemInputRef","wrapperRef","rename","initialName","ComfyWorkflow","appendJsonExt","navigationStore","useSubgraphNavigationStore","isRoot","tooltipText","menuItems","startRename","handleClick","inputBlur","doRename","useOverflowObserver","element","isOverflowing","disposeFns","checkOverflowFn","checkOverflow","debounce","useMutationObserver","useResizeObserver","readonly","fn","MIN_WIDTH","ITEM_GAP","ITEM_PADDING","ICON_WIDTH","breadcrumbRef","workflowName","isBlueprint","useSubgraphStore","collapseTabs","overflowingTabs","breadcrumbElement","subgraph","canvas","useCanvasStore","title","rootGraph","forEachSubgraphNode","home","overflowObserver","el","itemsWithIcon","separators","separatorWidth","itemsWidth","separatorsWidth","gapsWidth","totalWidth","containerWidth","onUpdated","cancelJobTooltip","clearQueueTooltip","useJobMenu","currentMenuItem","onInspectAsset","queueStore","useQueueStore","copyToClipboard","useCopyToClipboard","litegraphService","useLitegraphService","mediaAssetActions","useMediaAssetActions","openJobWorkflow","data","filename","temp","copyJobId","cancelJob","copyErrorMessage","m","reportError","addOutputLoaderNode","nodeType","widgetName","nodeDef","isResultItemType","v","apiItem","annotated","createAnnotatedPath","widget","w","downloadPreviewAsset","downloadFile","exportJobWorkflow","input","json","blob","downloadBlob","deleteJobAsset","task","preview","mapTaskOutputToAssetItem","removeFailedJob","jobMenuOpenWorkflowLabel","jobMenuOpenWorkflowFailedLabel","jobMenuCopyJobIdLabel","jobMenuCancelLabel","state","hasDeletableAsset","morePopoverRef","moreTooltipConfig","onMoreClick","onClearHistoryFromMenu","jobItemPopoverRef","open","onEntry","entry","clampPercentInt","formatPercent0","value0to100","useQueueProgress","executionStore","totalPercent","totalPercentFormatted","currentNodePercent","currentNodePercentFormatted","totalProgressStyle","currentNodeProgressStyle","dateKey","ts","day","isToday","now","isYesterday","yest","formatShortMonthDay","formatClockTime","iconForJobState","buildTitle","prefix","shortId","idx","buildQueuedTime","formatClockTimeFn","buildJobDisplay","ctx","total","primary","right","time","iconImageUrl","formatDuration","jobStateFromTask","isInitializing","jobTabs","jobSortModes","ADDED_HINT_DURATION_MS","relativeTimeFormatterCache","taskIdToKey","id","key","dateLabelForTimestamp","relativeFormatter","formatRelativeDay","formatted","useJobList","seenPendingIds","recentlyAddedPendingIds","addedHintTimeouts","clearAddedHintTimeout","timeoutId","scheduleAddedHintExpiry","updated","pendingIds","pendingSet","nextAdded","nextSeen","shouldShowAddedHint","onUnmounted","relativeTimeFormatter","localeValue","formatter","undatedLabel","isJobInitializing","promptId","currentNodeName","selectedJobTab","selectedWorkflowFilter","selectedSortMode","allTasksSorted","tasksWithJobState","hasFailedJobs","hasFailed","filteredTaskEntries","entries","activeId","wid","filteredTasks","jobItems","showAddedHint","display","jobItemById","ji","groupedJobItems","groups","index","groupIdx","valueOrDefault","sortByExecutionTimeDesc","filterPopoverRef","sortPopoverRef","filterTooltipConfig","sortTooltipConfig","visibleJobTabs","tab","onFilterClick","selectWorkflowFilter","onSortClick","selectSortMode","tabLabel","sortLabel","mode","extractExecutionError","messages","record","detail","useJobErrorReporting","taskForJob","dialog","errorMessageValue","formatElapsedTime","ms","totalSec","minutes","seconds","pickRecentDurations","useQueueEstimates","jobState","firstSeenTs","jobsAhead","nowTs","runningWorkflowCount","showParallelQueuedStats","recentDurations","runningRemainingRangeSeconds","durations","sorted","avg","sum","p75","running","remaining","timestamp","startTs","elapsed","minLo","range","minHi","estimateRangeSeconds","ahead","runningCount","batches","estimateRemainingRangeSeconds","baseTs","lo","hi","timeElapsedValue","copyAriaLabel","workflowValue","jobIdValue","pid","findIn","arr","queuedAtValue","currentQueueIndex","queuePositionValue","n","timer","formatEta","hiS","loS","loM","hiM","estimatedStartInValue","estimatedFinishInValue","baseRows","extraRows","rows","endTs","execMs","generatedOnValue","totalGenTimeValue","failedAfterValue","reportJobError","imgRef","width","height","onImgLoad","cancelTooltipConfig","deleteTooltipConfig","rowRef","showDetails","onRowEnter","isPreviewVisible","onRowLeave","onPopoverEnter","onPopoverLeave","previewHideTimer","previewShowTimer","clearPreviewHideTimer","clearPreviewShowTimer","canShowPreview","scheduleShowPreview","scheduleHidePreview","onIconEnter","onIconLeave","onPreviewEnter","onPreviewLeave","popoverPosition","updatePopoverPosition","gap","isAnyPopoverVisible","isHovered","shouldSpin","computedShowClear","emitDetailsLeave","onCancelClick","onDeleteClick","onContextMenu","emitCancelItem","emitDeleteItem","activeDetailsId","hideTimer","showTimer","clearHideTimer","clearShowTimer","onDetailsEnter","jobId","onDetailsLeave","resetActiveDetails","jobContextMenuRef","jobMenuEntries","onCancelItemEvent","onDeleteItemEvent","onMenuItem","onJobMenuAction","wrapWithErrorHandlingAsync","useErrorHandling","isClearing","clearHistory","onConfirm","onCancel","useCompletionSummary","lastActiveStartTs","_summary","dismissTimer","clearDismissTimer","startDismissTimer","clearSummary","active","prev","start","finished","completedCount","failedCount","imagePreviews","useResultGallery","getFilteredTasks","galleryActiveIndex","galleryItems","activeUrl","o","assetsStore","assetSelectionStore","useAssetSelectionStore","isOverlayHovered","internalExpanded","isExpanded","completionSummary","hasCompletionSummary","queuedCount","isExecuting","hasActiveJob","activeJobsCount","overlayState","showBackground","isVisible","containerClass","bottomRowClass","headerTitle","concurrentWorkflowCount","showConcurrentIndicator","displayedJobGroups","onCancelItem","onDeleteItem","openResultGallery","setExpanded","expanded","openExpandedFromEmpty","viewAllJobs","onSummaryClick","openAssetsSidebar","focusAssetInSidebar","assetId","existingAsset","inspectJobAsset","cancelQueuedWorkflows","interruptAll","promptIds","showClearHistoryDialog","QueueClearHistoryDialog","useActionBarButtonStore","extensionStore","useExtensionStore","e","actionBarButtonStore","isMobile","buildDocsUrl","docsPaths","useExternalLink","userDisplayName","userEmail","userPhotoUrl","handleSignOut","useCurrentUser","authActions","useFirebaseAuthActions","authStore","useFirebaseAuthStore","subscriptionTierName","subscriptionTier","subscriptionDialog","formattedBalance","cents","formatCreditsFromCents","canUpgrade","tier","handleOpenUserSettings","handleOpenPlansAndPricing","handleOpenPlanAndCreditsSettings","handleTopUp","handleOpenPartnerNodesInfo","handleLogout","handleSubscribed","isLoggedIn","photoURL","closePopover","handleSignIn","apiNodesOverviewUrl","popoverRef","hideTimeout","showTimeout","showPopover","cancelHidePopover","hidePopover","releaseApiClient","axios","getComfyApiBaseUrl","useReleaseService","url","handleApiError","context","routeSpecificErrors","axiosError","status","executeApiRequest","apiCall","errorContext","isAbortError","params","signal","endpoint","useReleaseStore","releases","releaseService","systemStatsStore","useSystemStatsStore","currentVersion","releaseVersion","releaseStatus","releaseTimestamp","showVersionUpdates","recentRelease","recentReleases","THREE_DAYS_MS","compareVersions","currentVer","valid","compare","isNewVersionAvailable","isLatestVersion","hasMediumOrHighAttention","attention","shouldShowToast","isElectron","shouldShowRedDot","version","shouldShowPopup","handleSkipRelease","handleShowChangelog","handleWhatsNewSeen","fetchReleases","until","fetchedReleases","stringToLocale","initialize","managerState","useManagerState","toastErrorHandler","queueUIStore","useQueueUIStore","isQueueOverlayExpanded","releaseStore","showReleaseRedDot","shouldShowConflictRedDot","useConflictAcknowledgment","isTopMenuHovered","queueHistoryTooltipConfig","customNodesManagerTooltipConfig","isRightSidePanelOpen","rightSidePanelTooltipConfig","legacyCommandsContainerRef","toggleQueueOverlay","openCustomNodeManager","ManagerTab","toastError","mountCustomExtension","bottomPanelStore","isShortcutsTabActive","activeTabId","shouldCapitalizeTab","tabId","getTabDisplayTitle","openKeybindingSettings","closeBottomPanel","useAbsolutePosition","useTransform","lgCanvas","canvasPosToClientPos","updateCanvasPosition","useCanvasPositionConversion","computeStyle","pos","size","scale","left","top","config","intersect","x1","y1","x2","y2","useDomClipping","margin","calculateClipPath","elementRect","canvasRect","isSelected","selectedArea","offset","intersection","clipX","clipY","clipWidth","clipHeight","canvasElement","clipPath","widgetElement","positionStyle","updatePosition","clippingStyle","updateClipPath","canvasStore","enableDomClipping","updateDomClipping","selectedNode","renderArea","selectedAreaConfig","useElementBounding","widgetState","_","__","oldVisible","isDOMWidget","tooltip","mountElementIfVisible","domWidgetStore","useDomWidgetStore","widgetStates","updateWidgets","lowQuality","currentGraph","isInCorrectGraph","whenever","useChainCallback","useZoomControls","isModalVisible","showModal","hideModal","toggleModal","hasActivePopup","useMinimapGraph","onGraphChanged","nodeStatesCache","linksCache","lastNodeCount","updateFlags","layoutStoreVersion","layoutStore","originalCallbacksMap","handleGraphChangedThrottled","useThrottleFn","setupEventListeners","originalCallbacks","cleanupEventListeners","oldGraph","g","structureChanged","positionChanged","connectionChanged","dataSource","MinimapDataSourceFactory","currentNodeCount","nodes","nodeId","currentState","currentNodeIds","currentLinks","useMinimapInteraction","containerRef","bounds","centerViewOn","containerRect","updateContainerRect","handlePointerDown","target","handlePointerMove","offsetX","offsetY","worldX","worldY","releasePointer","c","ds","delta","newScale","useMinimapRenderer","canvasRef","settings","needsFullRedraw","needsBoundsUpdate","renderMinimap","renderMinimapToCanvas","updateBounds","updateViewport","useMinimapSettings","colorPaletteStore","useColorPaletteStore","nodeColors","showLinks","showGroups","renderBypass","renderError","isLightTheme","containerStyles","panelStyles","useMinimapViewport","viewportTransform","canvasDimensions","updateCanvasDimensions","canvasEl","dpr","calculateGraphBounds","sourceBounds","enforceMinimumBounds","calculateScale","calculateMinimapScale","viewportWidth","viewportHeight","centerOffsetX","centerOffsetY","startViewportSync","stopViewportSync","useRafFn","useMinimap","canvasRefMaybe","containerRefMaybe","minimapRef","initialized","updateOption","renderer","viewport","interaction","graphManager","pauseChangeDetection","resumeChangeDetection","init","destroy","newCanvas","oldCanvas","newGraph","toggle","setMinimapRef","viewportStyles","transform","buttonRef","isCanvasReadOnly","currentModeIcon","unlockCommandText","lockCommandText","setMode","minimap","formatKeySequence","interval","applyZoom","val","inputValue","executeCommand","command","startRepeat","cmd","stopRepeat","filteredMinimapStyles","zoomInCommandText","zoomOutCommandText","zoomToFitCommandText","zoomInputContainer","newVal","canvasInteractions","useCanvasInteractions","stringifiedMinimapStyles","buttonGroupKeys","buttonKeys","additionalButtonStyles","buttonStyles","buttonGroupStyles","acc","linkHidden","LiteGraph","fitViewCommandText","minimapCommandText","zoomButtonClass","minimapButtonClass","fitViewTooltip","shortcut","minimapTooltip","linkVisibilityTooltip","linkVisibilityAriaLabel","linkVisibleClass","onMinimapToggleClick","onLinkVisibilityToggleClick","idleTimeout","tooltipRef","hideTooltip","showTooltip","comfyApp","onIdle","ctor","inputSlot","isOverNodeInput","inputName","translatedTooltip","outputSlot","isOverNodeOutput","toggleBypass","toLightThemeColor","color","adjustColor","showColorPicker","NO_COLOR_OPTION","colorOptions","LGraphCanvas","selectedColorOption","applyColor","colorOption","colorName","canvasColorOption","isColorable","currentColorOption","currentColor","localizedCurrentColorName","updateColorSelectionFromNode","newSelectedItems","getItemsColorOption","isSingleSubgraph","hasAnySelection","useSelectionState","isUnpackVisible","isConvertVisible","isDeletable","selectedNodes","buttonHovered","selectedOutputNodes","isLGraphNode","isOutputNode","outputNodeStokeStyle","handleMouseEnter","handleMouseLeave","onInfoClick","open3DViewer","isSingleImageNode","openMaskEditor","isRefreshableWidget","useRefreshableSelection","graphStore","refreshableWidgets","isRefreshable","refreshSelected","SubgraphNode","moreOptionsOpen","forceCloseMoreOptionsSignal","restoreMoreOptionsSignal","moreOptionsRestorePending","moreOptionsWasOpenBeforeDrag","moreOptionsSelectionSignature","buildSelectionSignature","store","isLGraphGroup","currentSelectionMatchesSignature","useSelectionToolboxPosition","toolboxRef","getSelectableItems","useSelectedLiteGraphItems","shouldRenderVueNodes","useVueFeatureFlags","worldPosition","canvasLeft","canvasTop","litegraphDragging","vueNodeDragging","updateSelectionBounds","selectableItems","allBounds","layout","LGraphNode","LGraphGroup","unionBounds","computeUnionBounds","updateTransform","screenX","screenY","startSync","stopSync","changed","handleDragStateChange","handleDragStart","handleDragEnd","selectionMatches","shouldRestore","resetMoreOptionsState","HARD_BLACKLIST","CORE_MENU_ITEMS","normalizeLabel","isDuplicateItem","existingItems","normalizedLabel","equivalents","existingNormalized","values","isCoreMenuItem","removeDuplicateMenuOptions","itemsByLabel","itemsWithoutLabel","opt","seenLabels","duplicates","vueItem","MENU_ORDER","getMenuItemOrder","buildStructuredMenu","deduplicated","coreItemsMap","deleteItem","orderedCoreItems","coreLabels","getSectionNumber","lastSection","itemIndex","currentSection","convertContextMenuToOptions","applyStructuring","convertSubmenuToOptions","capturedSubmenu","captureDynamicSubmenu","capturedItems","capturedOptions","OriginalContextMenu","mockEvent","mockMenu","subOption","stripHtmlTags","html","DOMPurify","useCanvasRefresh","useNodeCustomization","canvasRefresh","shapeOptions","RenderShape","shapeOption","firstColorableItem","currentBgColor","currentShape","useGroupMenuOptions","groupContext","padding","bump","shape","groupNodes","allSame","i","createModeAction","LGraphEventMode","useImageMenuOptions","openImage","img","copyImage","saveImage","useSelectedNodeActions","getSelectedNodes","toggleSelectedNodesMode","optimalSize","filterOutputNodes","useNodeMenuOptions","applyShape","adjustNodeSize","toggleNodeCollapse","toggleNodePin","toggleNodeBypass","runBranch","shapeSubmenu","colorSubmenu","showNodeHelp","states","useFrameNodes","titleEditorStore","useTitleEditorStore","hasMultipleSelection","canFrame","useNodeArrangement","alignOptions","distributeOptions","alignOption","newPositions","alignNodes","distributeOption","distributeNodes","useSelectionOperations","currentTitle","newTitle","titledItem","baseTitle","useSelectionMenuOptions","copySelection","duplicateSelection","deleteSelection","renameSelection","applyAlign","applyDistribute","convertToSubgraph","unpackSubgraph","addSubgraphToLibrary","useSubgraphOperations","frameNodes","alignSubmenu","align","distributeSubmenu","distribute","hasSubgraphs","convertOption","BadgeVariant","convertToGroupNodes","nodeOptionsInstance","toggleNodeOptions","showNodeOptions","registerNodeOptionsInstance","instance","markAsVueOptions","useMoreOptionsMenu","hasSubgraphsComputed","hasImageNode","hasOutputNodesSelected","computeSelectionFlags","getImageMenuOptions","getNodeInfoOption","getNodeVisualOptions","getPinOption","getBypassOption","getRunBranchOption","getFitGroupToNodesOption","getGroupColorOptions","getGroupModeOptions","getBasicSelectionOptions","getSubgraphOptions","getMultipleNodesOptions","hasMultipleNodes","optionsVersion","menuOptions","selectedGroups","hasSubgraphsSelected","litegraphOptions","rawItems","basicOps","pin","bypass","groupModes","visualOptions","markedVueOptions","merged","menuOptionsWithSubmenu","getCurrentShape","handleSubmenuClick","isShapeSelected","isColorSubmenu","contextMenu","colorPickerMenu","lastScale","lastOffsetX","lastOffsetY","updateMenuPosition","menuEl","contextMenuInstance","isColorOption","convertToMenuItem","isColor","sub","showColorPopover","handleColorSelect","onMenuShow","onMenuHide","extensionService","useExtensionService","extensionToolboxCommands","commandIds","commandId","isSingleNode","hasAny3DNodeSelected","showInfoButton","showConvertToSubgraph","showFrameNodes","showSubgraphButtons","showBypass","showLoad3DViewer","showMaskEditor","showDelete","showRefresh","showExecute","showAnyPrimaryActions","showAnyControlActions","showInput","editedTitle","inputPositionStyle","inputFontStyle","inputStyle","previousCanvasDraggable","onEdit","newValue","trimmedTitle","nodeHelpStore","useNodeHelpStore","nodeInfo","info","isQuerying","debouncedSearchQuery","refDebounced","updateKeyRef","toRef","onCleanup","isCleanup","cleanupFn","cb","CONTROL_OPTIONS","isControlOption","normalizeControlOption","widgetWithVueTrack","customRef","track","trigger","useReactiveWidgetValue","getControlWidget","cagWidget","getNodeType","isProxyWidget","normalizeWidgetValue","safeWidgetMapper","slotMetadata","spec","slotInfo","borderStyle","callback","isValidWidgetValue","useGraphNodeManager","createNode","deleteNode","setSource","useLayoutMutations","vueNodeData","reactive","nodeRefs","refreshNodeSlots","nodeRef","currentData","updatedWidgets","extractVueNodeData","subgraphId","reactiveWidgets","shallowReactive","reactiveInputs","safeWidgets","reactiveComputed","apiNode","getNode","syncWithGraph","currentNodes","handleNodeAdded","originalCallback","initializeVueNodeLayout","nodePosition","nodeSize","LayoutSource","handleNodeRemoved","createCleanupFunction","originalOnNodeAdded","originalOnNodeRemoved","originalOnTrigger","cleanup","triggerHandlers","propertyEvent","slotErrorsEvent","slotLinksEvent","NodeSlotType","isCollapse","getWidgetComponent","getComponent","WidgetLegacy","onWidgetValueChange","isEmpty","displayLabel","widgetsSectionDataList","widgets","searchedWidgetsSectionDataList","searcher","query","words","type","getOptionValue","valueField","getOptionLabel","labelField","optionValue","handleSelect","targetNodes","nodeState","triggerRef","isPinned","getColorValue","nodeColorEntries","nodeColor","theColorOptions","getIcon","draggableList","draggableItems","proxyWidgets","activeNode","parseProxyWidgets","activeWidgets","mapWidgets","wNode","widgetItemToProperty","interiorWidgets","updatePreviews","interiorNodes","nodeWidgets","candidateWidgets","widgetItem","matchesPropertyItem","filteredCandidates","recommendedWidgets","isRecommendedWidget","filteredActive","toKey","demote","subgraphNode","demoteWidget","promote","promoteWidget","showAll","toAdd","hideAll","propertyItem","matchesWidgetItem","showRecommended","setDraggableState","DraggableList","reorderedItems","oldPosition","newIndex","newPosition","aw","pruneDisconnected","activeTab","isEditingSubgraph","panelIcon","hasSelection","isSubgraphNode","isSingleNodeSelected","selectionCount","panelTitle","closePanel","tabs","list","handleTitleEdit","handleTitleCancel","useSearchBoxStore","useMouse","newSearchBoxEnabled","setPopoverRef","toggleVisible","_sfc_main","AutoComplete","inputEl","oldVal","showCategory","showIdName","showNodeFrequency","nodeFrequencyStore","useNodeFrequencyStore","nodeFrequency","nodeBookmarkStore","useNodeBookmarkStore","isBookmarked","enableNodePreview","autoCompletePlus","nodeSearchFilterVisible","inputId","suggestions","hoveredSuggestion","currentQuery","placeholder","debouncedTrackSearch","search","queryIsEmpty","onAddNode","inputElement","reFocusInput","onAddFilter","filterAndValue","onRemoveFilter","setHoverSuggestion","triggerEvent","listenerController","disconnectOnReset","searchBoxStore","dismissable","getNewNodeLocation","nodeFilters","addFilter","removeFilter","f","toRaw","clearFilters","addNode","showSearchBox","showNewSearchBox","getFirstLink","firstLink","dataType","showContextMenu","fromSlot","toType","commonOptions","cancelResetOnContextClose","afterRerouteId","connectionOptions","createEvent","reset","handleDroppedOnCanvas","canvasEventHandler","linkReleaseAction","linkReleaseActionShift","preventDefault","cancelNextReset","LinkReleaseTriggerAction","attributes","containerClasses","structureClasses","roundedClasses","variantClasses","aspectRatio","topStyle","defaultSlotClasses","slotClasses","baseClasses","variantStyles","chipClasses","contentRef","SLIDER_START_POSITION","isVideoType","sliderPosition","elementX","elementWidth","isOutside","useMouseInElement","outside","baseImageClass","overlayImageClass","sizeClasses","opacityClasses","useLazyPagination","itemsPerPage","initialPage","currentPage","loadedPages","itemsArray","itemData","paginatedItems","loadedPageNumbers","endIndex","hasMoreItems","loadedPagesArray","totalPages","loadNextPage","nextPage","newLoadedPages","length","useTemplateRankingStore","largestUsageScore","normalizeUsageScore","usage","computeFreshness","dateStr","date","daysSinceAdded","searchRank","internal","freshness","useTemplateFiltering","rankingStore","selectedModels","selectedUseCases","selectedRunsOn","templatesArray","templateData","fuse","availableModels","availableUseCases","tagSet","availableRunsOn","filteredBySearch","filteredByModels","selectedModel","filteredByUseCases","selectedTag","filteredByRunsOn","isExternalAPI","isComfyUI","getVramMetric","sortedTemplates","scoreA","nameA","nameB","dateA","vramA","vramB","sizeA","sizeB","filteredTemplates","resetFilters","removeModelFilter","removeUseCaseFilter","removeRunsOnFilter","runsOn","r","filteredCount","totalCount","debouncedTrackFilterChange","useTemplateWorkflows","workflowTemplatesStore","selectedTemplate","loadingTemplateId","isTemplatesLoaded","allTemplateGroups","loadTemplates","selectFirstTemplateCategory","firstCategory","selectTemplateCategory","getTemplateThumbnailUrl","sourceModule","basePath","indexSuffix","getTemplateTitle","fallback","getTemplateDescription","loadWorkflowTemplate","actualSourceModule","fetchTemplateJson","createGridStyle","columns","sessionStartTime","templateWasSelected","distributions","onClose","getEffectiveSourceModule","getBaseThumbnailSrc","sm","getOverlayThumbnailSrc","openTutorial","navItems","selectedNavItem","navigationFilteredTemplates","coordinateNavAndSort","source","isPopularNav","isPopularSort","selectedModelObjects","selectedUseCaseObjects","useCase","selectedRunsOnObjects","loadingTemplate","hoveredTemplate","cardRefs","templateListKey","modelSearchText","modelOptions","useCaseOptions","runsOnOptions","modelFilterLabel","useCaseFilterLabel","runsOnFilterLabel","loadTrigger","shouldUsePagination","paginatedTemplates","isLoadingMore","hasMoreTemplates","resetPagination","displayTemplates","useIntersectionObserver","onLoadWorkflow","pageTitle","navItem","useAsyncState","isTemplateVisibleOnDistribution","useWorkflowTemplateSelectorDialog","WorkflowTemplateSelectorDialog","whileMouseDown","elementOrEvent","iteration","intervalId","dispose","disposeGlobal","disposeLocal","menuItemStore","useMenuItemStore","colorPaletteService","useColorPaletteService","menuRef","nodes2Enabled","onLogoMenuClick","translateMenuItem","translatedLabel","showSettings","defaultPanel","SettingDialogHeader","SettingDialogContent","showManageExtensions","themeMenuItems","palette","extraMenuItems","translatedItems","helpIndex","helpItem","isLastItem","isZoomCommand","handleZoomMouseDown","handleItemClick","hasActiveStateSiblings","handleNodes2ToggleClick","onNodes2ToggleChange","overlayValue","shouldShowBadge","computedTooltip","toggleConsole","getCommand","showSettingsDialog","isShortcutsPanelVisible","toggleShortcutsPanel","TIME_UNITS","SUBMENU_CONFIG","staticUrls","openedAt","isSubmenuVisible","submenuRef","submenuStyle","hoverTimeout","hasReleases","shouldShowManagerRedDot","isNewManagerUI","moreItems","openExternalLink","openDevTools","onReinstall","hasVisibleMoreItems","moreMenuItem","PuzzleIcon","onUpdateComfyUI","clearHoverTimeout","calculateSubmenuPosition","button","submenuWidth","estimatedHeight","submenuHeight","formatReleaseDate","dateString","diffTime","timeUnits","unit","onMenuItemHover","moreButton","onMenuItemLeave","onSubmenuHover","onSubmenuLeave","electronAPI","updateComfyUI","rebootComfyUI","useComfyManagerService","onReleaseClick","release","versionAnchor","formatVersionAnchor","changelogUrl","isDismissed","latestRelease","shouldShow","changelogBaseUrl","formattedContent","contentWithoutImages","trimmedContent","renderMarkdownToHtml","fallbackContent","startAutoHide","dismissToast","clearAutoHide","handleSkip","handleLearnMore","handleUpdate","markdown","imageMatch","image","contentWithoutImage","reorderedContent","closePopup","useHelpCenterStore","helpCenterStore","isHelpCenterVisible","conflictDetection","useConflictDetection","showNodeConflictDialog","markConflictsAsSeen","isSmall","toRefs","toggleHelpCenter","closeHelpCenter","handleWhatsNewDismissed","showConflictModal","userStore","useUserStore","logout","openTemplates","ENTER_OVERFLOW_MARGIN","EXIT_OVERFLOW_MARGIN","sideToolbarRef","topToolbarRef","bottomToolbarRef","sidebarStyle","isConnected","selectedTab","onTabClick","keybindingStore","useKeybindingStore","getTabTooltipSuffix","keybinding","groupClasses","containerHeight","topHeight","bottomHeight","contentHeight","useTopbarBadgeStore","isXl","isLg","displayMode","topbarBadgeStore","POPOVER_WIDTH","thumbnailUrl","isActiveTab","positionRef","middle","popoverWidth","halfWidth","shift","newPos","workflowTabRef","workflowThumbnail","useWorkflowThumbnail","autoSaveSetting","autoSaveDelay","shouldShowStatusIndicator","closeWorkflows","onCloseWorkflow","tabGetter","usePragmaticDraggable","usePragmaticDroppable","fromIndex","wf","toIndex","workflow","workflowBookmarkStore","useWorkflowBookmarkStore","rightClickedTab","showOverflowArrows","leftArrowEnabled","rightArrowEnabled","workflowToOption","selectedWorkflow","onWorkflowChange","contextMenuItems","handleWheel","scrollElement","scrollAmount","scrollContent","scroll","direction","ensureActiveTabVisible","containerElement","activeTabElement","stopArrivedWatch","stopOverflowWatch","_prev","scrollState","useScroll","atLeft","atRight","isOverflow","useLayoutSync","unsubscribe","change","liteNode","useVueNodeLifecycleIndividual","layoutMutations","nodeManager","initializeNodeManager","activeGraph","manager","removeNodeTitleHeight","reroute","parent","linkIds","link","disposeNodeManagerAndSyncs","enabled","ensureCorrectLayoutScale","vueMode","oldVueMode","useVueNodeLifecycle","createSharedComposable","DEFAULT_NUMBER_OPTIONS","formatCreditsValue","usd","formatCreditsFromUsd","makePrefix","approximate","makeSuffix","suffix","appendNote","note","formatCreditsLabel","formatCreditsRangeLabel","minUsd","maxUsd","max","rangeValue","formatCreditsListLabel","usdValues","separator","safePricingExecution","calculateRunwayDurationPrice","durationWidget","duration","cost","makeOmniProDurationCalculator","pricePerSecond","klingMotionControlPricingCalculator","modeWidget","pixversePricingCalculator","qualityWidget","motionModeWidget","quality","motionMode","byteDanceVideoPricingCalculator","modelWidget","resolutionWidget","resolution","priceByModel","modelKey","resKey","baseRange","min10s","max10s","minCost","maxCost","ltxvPricingCalculator","modelTable","pps","klingVideoWithAudioPricingCalculator","generateAudioWidget","generateAudio","SORA_SIZES","ALL_SIZES","validateSora2Selection","modelRaw","sizeRaw","perSecForSora2","formatRunPrice","perSec","sora2PricingCalculator","getWidgetValue","validationError","calculateTripo3DGenerationPrice","getWidget","getString","defaultValue","getBool","modelVersionRaw","hasStyle","hasTexture","hasPbr","quad","textureQualityRaw","geometryQualityRaw","isHdTexture","isDetailedGeometry","withTexture","baseCredits","credits","dollars","apiNodeCosts","widthW","heightW","h","imagesInput","hasRefs","MP","outMP","outputCost","minTotal","maxTotal","numImagesWidget","turboWidget","numImages","basePrice","renderingSpeedWidget","characterInput","hasCharacter","renderingSpeed","totalCost","modeValue","durationValue","modelValue","modality","nWidget","effectSceneWidget","effectScene","sizeWidget","price","aspectRatioWidget","lengthWidget","textureQualityWidget","getNumber","hasAdvancedParam","pricePerImage","resolutionStr","rate","inputMin","inputMax","outputPrice","useNodePricing","priceConfig","componentIconSvg","usePriceBadge","updateSubgraphCredits","isCreditsBadge","newBadges","collectCreditsBadges","getCreditsBadge","visited","badge","LGraphBadge","useComputedWithWidgetWatch","widgetNames","triggerCanvasRedraw","widgetValues","widgetsToObserve","currentValues","indexesToObserve","_type","computeFn","computedWithControl","useNodeBadge","priceBadge","nodeSourceBadgeMode","nodeIdBadgeMode","nodeLifeCycleBadgeMode","showApiPricingBadge","badgeTextVisible","badgeMode","NodeBadgeMode","nodePricing","BadgePosition","s","hasDynamicPricing","creditsBadge","createBadge","relevantWidgetNames","useCanvasDrop","args","loc","dndData","basePos","useSharedCanvasPositionConversion","ComfyNodeDefImpl","ComfyModelDef","nodeAtPos","targetProvider","targetGraphNode","providers","provider","useContextMenuTranslation","legacyMenuCompat","getCanvasMenuOptions","getCanvasCenterMenuOptions","res","newApiItems","legacyItems","nodeMenuFn","getNodeMenuOptionsWithExtensions","translateMenus","reInput","reWidget","cvt","tinp","twgt","te","extraInfo","matchInput","match","matchWidget","ContextMenu","hasTextSelection","selection","shouldIgnoreCopyPaste","clipboardHTMLWrapper","useCopy","serializedData","base64Data","useGlobalLitegraph","LGraph","LLink","DragAndScale","pasteClipboardItems","binaryString","bytes","decodedData","usePaste","pasteItemsOnNode","contentType","filteredItems","currentNode","isNodeSelected","isImageNodeSelected","isImageNode","isVideoNodeSelected","isVideoNode","isAudioNodeSelected","isAudioNode","imageNode","audioNode","videoNode","newNode","useLitegraphSettings","canvasInfoEnabled","zoomSpeed","linkRenderMode","minFontSizeForLOD","linkMarkerShape","maximumFps","dragZoomEnabled","liveSelection","CanvasPointer","navigationMode","leftMouseBehavior","mouseWheelScroll","CORE_SETTINGS","oldValue","LinkMarkerShape","useWorkflowAutoSave","autoSaveTimeout","isSaving","needsAutoSave","scheduleAutoSave","delay","activeWorkflow","newSetting","useTemplateUrlLoader","route","useRoute","router","useRouter","templateWorkflows","TEMPLATE_NAMESPACE","PRESERVED_QUERY_NAMESPACES","SUPPORTED_MODES","isValidParameter","param","isSupportedMode","cleanupUrlParams","newQuery","templateParam","sourceParam","modeParam","clearPreservedQuery","useWorkflowPersistence","templateUrlLoader","ensureTemplateQueryFromIntent","hydratePreservedQuery","mergedQuery","mergePreservedQueryIntoQuery","workflowPersistenceEnabled","persistCurrentWorkflow","ourKeys","loadWorkflowFromStorage","loadPreviousWorkflowFromStorage","getStorageValue","clientId","sessionWorkflow","localWorkflow","loadDefaultWorkflow","initializeWorkflow","loadTemplateFromUrlIfPresent","activeWorkflowKey","setStorageValue","tryOnScopeDispose","openWorkflows","restoreState","paths","activeIndex","storedWorkflows","storedActiveIndex","useTransformSettling","settleDelay","passive","isTransforming","markTransformActive","markTransformSettled","useDebounceFn","useTransformStateIndividual","camera","transformStyle","syncWithCanvas","canvasToScreen","point","screenToCanvas","getNodeScreenBounds","topLeft","calculateAdjustedMargin","baseMargin","isNodeTooSmall","getExpandedViewportBounds","marginX","marginY","testViewportIntersection","screenPos","nodeRight","nodeBottom","isNodeInViewport","nodePos","adjustedMargin","getViewportBounds","bottomRight","useTransformState","isInteracting","handlePointerUp","handlePointerCancel","showOptionsPanel","toggleOptionsPanel","isMultiSelectKey","useNodeEventHandlersIndividual","bringNodeToFront","useNodeZIndex","shouldHandleNodePointerEvents","handleNodeSelect","multiSelect","selectedItemsCount","preserveExistingSelection","handleNodeCollapse","collapsed","handleNodeTitleUpdate","handleNodeRightClick","toggleNodeSelectionAfterPointerUp","useNodeEventHandlers","useNodeSnap","gridSize","alwaysSnap","shouldSnap","applySnapToPosition","posArray","snapPoint","applySnapToSize","gridSizeValue","sizeArray","useShiftKeySync","shiftKeyState","syncShiftState","isShiftPressed","trackShiftKey","initialEvent","handleKeyEvent","stopKeydown","stopKeyup","useNodeDrag","useNodeDragIndividual","mutations","selectedNodeIds","transformState","dragStartPos","dragStartMouse","otherSelectedNodesStartPositions","rafId","stopShiftSync","lastCanvasDelta","startDrag","isDraggedNodeInSelection","nodeLayout","handleDrag","pointerId","mouseDelta","canvasOrigin","canvasWithDelta","canvasDelta","otherNodeId","startPos","newOtherPosition","frameDelta","endDrag","boundsUpdates","currentLayout","currentPos","snappedPos","useNodePointerInteractions","nodeIdRef","forwardEventToCanvas","forwardMiddlePointerIfNeeded","isMiddlePointerInput","hasDraggingStarted","startPosition","DRAG_THRESHOLD","onPointerdown","safeDragStart","onPointermove","lmbDown","dx","dy","cleanupDragState","safeDragEnd","onPointerup","wasDragging","onPointercancel","onContextmenu","onScopeDispose","trackingConfigs","updates","nodeUpdates","resizeObserver","conv","updatesByType","nodesNeedingSlotResync","elementType","elementId","borderBox","cx","cy","topLeftCanvas","syncNodeSlotLayoutsFromDOM","useVueElementTracking","appIdentifierMaybe","trackingType","appIdentifier","getCurrentInstance","useNodeExecutionState","nodeLocatorIdMaybe","locatorId","nodeLocationProgressStates","isIdle","progressState","executing","progress","progressPercentage","prog","executionState","useNodeLayout","nodeIdMaybe","layoutRef","zIndex","moveNodeTo","useNodePreviewState","nodePreviewImages","useNodeOutputStore","previewUrls","urls","hasPreview","latestPreviewUrl","shouldShowPreviewImg","useNodeResize","resizeCallback","isResizing","resizeStartPointer","resizeStartSize","nodeElement","startSize","moveEvent","deltaX","deltaY","newSize","upEvent","stopMoveListen","stopUpListen","actualDimensions","imageError","handleImageLoad","handleImageError","actionButtonClass","nodeOutputStore","currentIndex","isFocused","videoError","showLoader","videoWrapperEl","currentVideoUrl","hasMultipleVideos","newUrls","handleVideoLoad","video","handleVideoError","handleDownload","handleRemove","setCurrentIndex","handleFocusIn","handleFocusOut","getNavigationDotClass","handleKeyDown","getVideoFilename","currentImageEl","imageWrapperEl","startDelayedLoader","stopDelayedLoader","useTimeoutFn","currentImageUrl","hasMultipleImages","imageAltText","setupNodeForMaskEditor","handleEditMask","getImageFilename","hasMedia","onErrorCaptured","baseResizeHandleClasses","MIN_NODE_WIDTH","progressClasses","nodeLocatorId","getLocatorIdFromNodeData","hasExecutionError","hasAnyError","displayHeader","TitleMode","bypassed","muted","nodeBodyBackgroundColor","applyLightThemeColor","nodeOpacity","globalOpacity","hasInputs","nonWidgetedInputs","hasOutputs","pointerHandlers","remainingPointerHandlers","nodeOnPointerdown","lgraphNode","handleContextMenu","initSizeStyles","nodeContainerRef","startResize","clampedWidth","handleResizePointerDown","from","to","currentWidth","currentHeight","hasCustomContent","nodeMedia","borderClass","isTransparent","outlineClass","cursorClass","shapeClass","beforeShapeClass","handleCollapse","handleHeaderTitleUpdate","handleEnterSubgraph","litegraphNode","getNodeByLocatorId","nodeOutputs","nodeOutputLocatorId","newOutputs","hasVideoInput","isDraggingOver","handleDragOver","canDrop","handleDragLeave","handleDrop","pendingCallbacks","isNewUserDetermined","isNewUserCached","newUserService","checkIsNewUser","isNewUserSettings","hasNoWorkflow","hasNoPreviousWorkflow","registerInitCallback","initializeIfNewUser","isNewUser","selectionRect","pointer","dragging_rectangle","rectangleStyle","nodeSearchboxPopoverRef","betaMenuEnabled","workflowTabsPosition","canvasMenuEnabled","tooltipEnabled","selectionToolboxEnabled","showUI","minimapEnabled","vueNodeLifecycle","handleVueNodeLifecycleReset","allNodes","spellcheckEnabled","textarea","forEachNode","IS_CONTROL_WIDGET","updateControlWidgetLabel","l","currentPaletteId","lastNodeErrors","slot","nodeErrors","inputIndex","loadCustomNodesI18n","i18nData","mergeCustomNodesI18n","comfyAppReady","workflowPersistence","ChangeTracker","UnauthorizedError","migrateToLitegraphReroute","workflowJSON","migratedWorkflowJSON","migrateLegacyRerouteNodes","DEFAULT_TITLE","TITLE_SUFFIX","useBrowserTabTitle","executionText","newMenuEnabled","isAutoSaveEnabled","isActiveWorkflowModified","isActiveWorkflowPersisted","shouldShowUnsavedIndicator","isUnsavedText","workflowNameText","nodeExecutionTitle","runningNodes","workflowTitle","useTitle","frameworkOptions","projectOptions","tempNavigation","searchText","selectedFrameworks","selectedProjects","selectedSort","useModelSelectorDialog","SampleModelSelector","createModelNodeFromAsset","validatedAsset","assetItemSchema","errorMessage","validAsset","userMetadata","MODELS_TAG","MISSING_TAG","targetGraph","ZENDESK_FIELDS","SUPPORT_BASE_URL","buildSupportUrl","searchParams","moveSelectedNodesVersionAdded","useCoreCommands","firebaseAuthActions","getTracker","isQueuePanelV2Enabled","toggleQueuePanelV2","moveSelectedNodes","positionUpdater","getAllNonIoNodesInSubgraph","current","lastLinksRenderMode","currentMode","metadata","batchCount","useQueueSettingsStore","executionIds","getExecutionIdsForSelectedNodes","previousDarkTheme","DEFAULT_DARK_COLOR_PALETTE","previousLightTheme","DEFAULT_LIGHT_COLOR_PALETTE","theme","resolvedUserInfo","supportUrl","ManagerUIState","tryToggleWidgetPromotion","currentValue","useProgressFavicon","defaultFavicon","favicon","useFavicon","totalFrames","frame","LatentPreviewMethod","LogLevel","HashFunction","CudaMalloc","FloatingPointPrecision","CrossAttentionMethod","VramManagement","SERVER_CONFIG_ITEMS","badgeClasses","sev","progressPercent","isCompleted","isFailed","isRunning","isPending","assetDownloadStore","useAssetDownloadStore","activeFilter","filterOptions","setFilter","downloadJobs","completedJobs","failedJobs","isInProgress","currentJobName","job","filteredJobs","activeFilterLabel","DISMISSAL_DURATION_MS","useVersionCompatibilityStore","frontendVersion","backendVersion","requiredFrontendVersion","isFrontendOutdated","gt","isFrontendNewer","hasVersionMismatch","versionKey","dismissalStorage","useStorage","dismissedUntil","shouldShowWarning","warningsDisabled","warningMessage","checkVersionCompatibility","dismissWarning","dismissUntil","useFrontendVersionMismatchWarning","immediate","versionCompatibilityStore","hasShownWarning","showWarning","detailMessage","fullMessage","setupAutoQueueHandler","queueCountStore","useQueuePendingTaskCountStore","queueSettingsStore","graphHasChanged","internalCount","nodeDatas","nodeToNodeData","mapper","safeWidget","batchCountWidget","runButtonClick","openFeedback","comfyManagerStore","useComfyManagerStore","runFullConflictAnalysis","activeTabIndex","focusedLogs","isRestarting","isRestartCompleted","isTaskInProgress","log","taskQueue","completedTasksCount","totalTasksCount","completedTasks","queuedTasks","currentTaskName","collapsedPanels","togglePanel","sectionsContainerRef","scrollY","lastPanelRef","isUserScrolling","lastPanelLogs","isAtBottom","scrollLastPanelToBottom","scrollContentToBottom","resetUserScrolling","handleScroll","onLogsAdded","closeToast","handleRestart","originalToastSetting","graphCanvasContainerRef","linearMode","newTheme","DARK_THEME_CLASS","newTasks","oldTasks","oldRunningTaskIds","fontSize","loadLocale","useNewMenu","coreCommands","useKeybindingService","queuePendingTaskCountStore","onStatus","onExecutionSuccess","reconnectingMessage","onReconnecting","onReconnected","wrapWithErrorHandling","onGraphReady","useServerConfigStore","useModelStore"],"ignoreList":[],"sources":["../../../../../../../ComfyUI_frontend/src/platform/workflow/templates/types/template.ts","../../../../../../../ComfyUI_frontend/src/utils/categoryUtil.ts","../../../../../../../ComfyUI_frontend/src/platform/workflow/templates/repositories/workflowTemplatesStore.ts","../../../../../../../ComfyUI_frontend/src/types/widgetTypes.ts","../../../../../../../ComfyUI_frontend/src/components/widget/layout/BaseModalLayout.vue","../../../../../../../ComfyUI_frontend/src/components/widget/nav/NavTitle.vue","../../../../../../../ComfyUI_frontend/src/components/widget/panel/PanelHeader.vue","../../../../../../../ComfyUI_frontend/src/components/widget/panel/LeftSidePanel.vue","../../../../../../../ComfyUI_frontend/src/composables/usePopoverSizing.ts","../../../../../../../ComfyUI_frontend/src/components/input/MultiSelect.vue","../../../../../../../ComfyUI_frontend/src/platform/assets/composables/useAssetFilterOptions.ts","../../../../../../../ComfyUI_frontend/src/platform/assets/components/AssetFilterBar.vue","../../../../../../../ComfyUI_frontend/src/components/button/MoreButton.vue","../../../../../../../ComfyUI_frontend/src/components/dialog/confirm/ConfirmBody.vue","../../../../../../../ComfyUI_frontend/src/components/dialog/confirm/ConfirmFooter.vue","../../../../../../../ComfyUI_frontend/src/components/dialog/confirm/confirmDialog.ts","../../../../../../../ComfyUI_frontend/src/platform/assets/components/AssetCard.vue","../../../../../../../ComfyUI_frontend/src/platform/assets/components/AssetGrid.vue","../../../../../../../ComfyUI_frontend/src/platform/assets/utils/assetMetadataUtils.ts","../../../../../../../ComfyUI_frontend/src/platform/assets/composables/useAssetBrowser.ts","../../../../../../../ComfyUI_frontend/src/platform/assets/utils/categoryLabel.ts","../../../../../../../ComfyUI_frontend/src/platform/assets/components/AssetBrowserModal.vue","../../../../../../../ComfyUI_frontend/src/platform/assets/composables/useAssetBrowserDialog.ts","../../../../../../../ComfyUI_frontend/src/components/topbar/TopbarBadge.vue","../../../../../../../ComfyUI_frontend/src/platform/cloud/subscription/components/SubscribeButton.vue","../../../../../../../ComfyUI_frontend/src/platform/cloud/subscription/composables/useSubscriptionDialog.ts","../../../../../../../ComfyUI_frontend/src/components/toast/GlobalToast.vue","../../../../../../../ComfyUI_frontend/src/base/common/async.ts","../../../../../../../ComfyUI_frontend/src/components/MenuHamburger.vue","../../../../../../../ComfyUI_frontend/src/components/dialog/UnloadWindowConfirmDialog.vue","../../../../../../../ComfyUI_frontend/src/components/LiteGraphCanvasSplitterOverlay.vue","../../../../../../../ComfyUI_frontend/src/composables/useTooltipConfig.ts","../../../../../../../ComfyUI_frontend/src/components/actionbar/ComfyRunButton/index.ts","../../../../../../../ComfyUI_frontend/src/components/actionbar/ComfyActionbar.vue","../../../../../../../ComfyUI_frontend/src/workbench/extensions/manager/utils/graphHasMissingNodes.ts","../../../../../../../ComfyUI_frontend/src/components/breadcrumb/SubgraphBreadcrumbItem.vue","../../../../../../../ComfyUI_frontend/src/composables/element/useOverflowObserver.ts","../../../../../../../ComfyUI_frontend/src/components/breadcrumb/SubgraphBreadcrumb.vue","../../../../../../../ComfyUI_frontend/src/components/queue/QueueOverlayActive.vue","../../../../../../../ComfyUI_frontend/src/components/queue/CompletionSummaryBanner.vue","../../../../../../../ComfyUI_frontend/src/components/queue/QueueOverlayEmpty.vue","../../../../../../../ComfyUI_frontend/src/composables/queue/useJobMenu.ts","../../../../../../../ComfyUI_frontend/src/components/queue/QueueOverlayHeader.vue","../../../../../../../ComfyUI_frontend/src/components/queue/job/JobContextMenu.vue","../../../../../../../ComfyUI_frontend/src/utils/numberUtil.ts","../../../../../../../ComfyUI_frontend/src/composables/queue/useQueueProgress.ts","../../../../../../../ComfyUI_frontend/src/utils/dateTimeUtil.ts","../../../../../../../ComfyUI_frontend/src/utils/queueDisplay.ts","../../../../../../../ComfyUI_frontend/src/utils/queueUtil.ts","../../../../../../../ComfyUI_frontend/src/composables/queue/useJobList.ts","../../../../../../../ComfyUI_frontend/src/components/queue/job/JobFiltersBar.vue","../../../../../../../ComfyUI_frontend/src/components/queue/job/useJobErrorReporting.ts","../../../../../../../ComfyUI_frontend/src/components/queue/job/useQueueEstimates.ts","../../../../../../../ComfyUI_frontend/src/components/queue/job/JobDetailsPopover.vue","../../../../../../../ComfyUI_frontend/src/components/queue/job/QueueAssetPreview.vue","../../../../../../../ComfyUI_frontend/src/components/queue/job/QueueJobItem.vue","../../../../../../../ComfyUI_frontend/src/components/queue/job/JobGroupsList.vue","../../../../../../../ComfyUI_frontend/src/components/queue/QueueOverlayExpanded.vue","../../../../../../../ComfyUI_frontend/src/components/queue/dialogs/QueueClearHistoryDialog.vue","../../../../../../../ComfyUI_frontend/src/composables/queue/useCompletionSummary.ts","../../../../../../../ComfyUI_frontend/src/composables/queue/useResultGallery.ts","../../../../../../../ComfyUI_frontend/src/components/queue/QueueProgressOverlay.vue","../../../../../../../ComfyUI_frontend/src/stores/actionBarButtonStore.ts","../../../../../../../ComfyUI_frontend/src/components/topbar/ActionBarButtons.vue","../../../../../../../ComfyUI_frontend/src/components/topbar/CurrentUserPopover.vue","../../../../../../../ComfyUI_frontend/src/components/topbar/CurrentUserButton.vue","../../../../../../../ComfyUI_frontend/src/components/topbar/LoginButton.vue","../../../../../../../ComfyUI_frontend/src/platform/updates/common/releaseService.ts","../../../../../../../ComfyUI_frontend/src/platform/updates/common/releaseStore.ts","../../../../../../../ComfyUI_frontend/src/components/TopMenuSection.vue","../../../../../../../ComfyUI_frontend/src/components/common/ExtensionSlot.vue","../../../../../../../ComfyUI_frontend/src/components/bottomPanel/BottomPanel.vue","../../../../../../../ComfyUI_frontend/src/composables/element/useAbsolutePosition.ts","../../../../../../../ComfyUI_frontend/src/composables/element/useDomClipping.ts","../../../../../../../ComfyUI_frontend/src/components/graph/widgets/DomWidget.vue","../../../../../../../ComfyUI_frontend/src/components/graph/DomWidgets.vue","../../../../../../../ComfyUI_frontend/src/composables/useZoomControls.ts","../../../../../../../ComfyUI_frontend/src/renderer/extensions/minimap/composables/useMinimapGraph.ts","../../../../../../../ComfyUI_frontend/src/renderer/extensions/minimap/composables/useMinimapInteraction.ts","../../../../../../../ComfyUI_frontend/src/renderer/extensions/minimap/composables/useMinimapRenderer.ts","../../../../../../../ComfyUI_frontend/src/renderer/extensions/minimap/composables/useMinimapSettings.ts","../../../../../../../ComfyUI_frontend/src/renderer/extensions/minimap/composables/useMinimapViewport.ts","../../../../../../../ComfyUI_frontend/src/renderer/extensions/minimap/composables/useMinimap.ts","../../../../../../../ComfyUI_frontend/src/components/graph/CanvasModeSelector.vue","../../../../../../../ComfyUI_frontend/src/components/graph/modals/ZoomControlsModal.vue","../../../../../../../ComfyUI_frontend/src/components/graph/GraphCanvasMenu.vue","../../../../../../../ComfyUI_frontend/src/components/graph/NodeTooltip.vue","../../../../../../../ComfyUI_frontend/src/components/graph/selectionToolbox/BypassButton.vue","../../../../../../../ComfyUI_frontend/src/components/graph/selectionToolbox/ColorPickerButton.vue","../../../../../../../ComfyUI_frontend/src/components/graph/selectionToolbox/ConfigureSubgraph.vue","../../../../../../../ComfyUI_frontend/src/components/graph/selectionToolbox/ConvertToSubgraphButton.vue","../../../../../../../ComfyUI_frontend/src/components/graph/selectionToolbox/DeleteButton.vue","../../../../../../../ComfyUI_frontend/src/components/graph/selectionToolbox/ExecuteButton.vue","../../../../../../../ComfyUI_frontend/src/components/graph/selectionToolbox/ExtensionCommandButton.vue","../../../../../../../ComfyUI_frontend/src/components/graph/selectionToolbox/InfoButton.vue","../../../../../../../ComfyUI_frontend/src/components/graph/selectionToolbox/Load3DViewerButton.vue","../../../../../../../ComfyUI_frontend/src/components/graph/selectionToolbox/MaskEditorButton.vue","../../../../../../../ComfyUI_frontend/src/composables/useRefreshableSelection.ts","../../../../../../../ComfyUI_frontend/src/components/graph/selectionToolbox/RefreshSelectionButton.vue","../../../../../../../ComfyUI_frontend/src/components/graph/selectionToolbox/SaveToSubgraphLibrary.vue","../../../../../../../ComfyUI_frontend/src/composables/canvas/useSelectionToolboxPosition.ts","../../../../../../../ComfyUI_frontend/src/composables/graph/contextMenuConverter.ts","../../../../../../../ComfyUI_frontend/src/composables/graph/useCanvasRefresh.ts","../../../../../../../ComfyUI_frontend/src/composables/graph/useNodeCustomization.ts","../../../../../../../ComfyUI_frontend/src/composables/graph/useGroupMenuOptions.ts","../../../../../../../ComfyUI_frontend/src/composables/graph/useImageMenuOptions.ts","../../../../../../../ComfyUI_frontend/src/composables/graph/useSelectedNodeActions.ts","../../../../../../../ComfyUI_frontend/src/composables/graph/useNodeMenuOptions.ts","../../../../../../../ComfyUI_frontend/src/composables/graph/useFrameNodes.ts","../../../../../../../ComfyUI_frontend/src/composables/graph/useNodeArrangement.ts","../../../../../../../ComfyUI_frontend/src/composables/graph/useSelectionOperations.ts","../../../../../../../ComfyUI_frontend/src/composables/graph/useSelectionMenuOptions.ts","../../../../../../../ComfyUI_frontend/src/composables/graph/useMoreOptionsMenu.ts","../../../../../../../ComfyUI_frontend/src/components/graph/selectionToolbox/ColorPickerMenu.vue","../../../../../../../ComfyUI_frontend/src/components/graph/NodeContextMenu.vue","../../../../../../../ComfyUI_frontend/src/components/graph/selectionToolbox/FrameNodes.vue","../../../../../../../ComfyUI_frontend/src/components/graph/selectionToolbox/NodeOptionsButton.vue","../../../../../../../ComfyUI_frontend/src/components/graph/selectionToolbox/VerticalDivider.vue","../../../../../../../ComfyUI_frontend/src/components/graph/SelectionToolbox.vue","../../../../../../../ComfyUI_frontend/src/components/graph/TitleEditor.vue","../../../../../../../ComfyUI_frontend/src/components/rightSidePanel/info/TabInfo.vue","../../../../../../../ComfyUI_frontend/src/components/rightSidePanel/layout/SidePanelSearch.vue","../../../../../../../ComfyUI_frontend/src/types/simplifiedWidget.ts","../../../../../../../ComfyUI_frontend/src/composables/graph/useGraphNodeManager.ts","../../../../../../../ComfyUI_frontend/src/components/rightSidePanel/layout/PropertiesAccordionItem.vue","../../../../../../../ComfyUI_frontend/src/components/rightSidePanel/parameters/SectionWidgets.vue","../../../../../../../ComfyUI_frontend/src/components/rightSidePanel/parameters/TabParameters.vue","../../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/widgets/components/form/FormSelectButton.vue","../../../../../../../ComfyUI_frontend/src/components/rightSidePanel/settings/TabSettings.vue","../../../../../../../ComfyUI_frontend/src/components/rightSidePanel/subgraph/SubgraphNodeWidget.vue","../../../../../../../ComfyUI_frontend/src/components/rightSidePanel/subgraph/SubgraphEditor.vue","../../../../../../../ComfyUI_frontend/src/components/rightSidePanel/RightSidePanel.vue","../../../../../../../ComfyUI_frontend/src/stores/workspace/searchBoxStore.ts","../../../../../../../ComfyUI_frontend/src/components/primevueOverride/AutoCompletePlus.vue","../../../../../../../ComfyUI_frontend/src/components/searchbox/NodeSearchItem.vue","../../../../../../../ComfyUI_frontend/src/components/searchbox/NodeSearchBox.vue","../../../../../../../ComfyUI_frontend/src/components/searchbox/NodeSearchBoxPopover.vue","../../../../../../../ComfyUI_frontend/src/components/icons/ComfyLogo.vue","../../../../../../../ComfyUI_frontend/src/components/card/CardBottom.vue","../../../../../../../ComfyUI_frontend/src/components/card/CardContainer.vue","../../../../../../../ComfyUI_frontend/src/components/card/CardTop.vue","../../../../../../../ComfyUI_frontend/src/components/chip/SquareChip.vue","../../../../../../../ComfyUI_frontend/src/components/templates/thumbnails/BaseThumbnail.vue","../../../../../../../ComfyUI_frontend/src/components/templates/thumbnails/CompareSliderThumbnail.vue","../../../../../../../ComfyUI_frontend/src/components/templates/thumbnails/DefaultThumbnail.vue","../../../../../../../ComfyUI_frontend/src/components/templates/thumbnails/HoverDissolveThumbnail.vue","../../../../../../../ComfyUI_frontend/src/composables/useLazyPagination.ts","../../../../../../../ComfyUI_frontend/src/stores/templateRankingStore.ts","../../../../../../../ComfyUI_frontend/src/composables/useTemplateFiltering.ts","../../../../../../../ComfyUI_frontend/src/platform/workflow/templates/composables/useTemplateWorkflows.ts","../../../../../../../ComfyUI_frontend/src/utils/gridUtil.ts","../../../../../../../ComfyUI_frontend/src/components/custom/widget/WorkflowTemplateSelectorDialog.vue","../../../../../../../ComfyUI_frontend/src/composables/useWorkflowTemplateSelectorDialog.ts","../../../../../../../ComfyUI_frontend/src/utils/mouseDownUtil.ts","../../../../../../../ComfyUI_frontend/src/components/sidebar/ComfyMenuButton.vue","../../../../../../../ComfyUI_frontend/src/components/sidebar/SidebarIcon.vue","../../../../../../../ComfyUI_frontend/src/components/sidebar/SidebarBottomPanelToggleButton.vue","../../../../../../../ComfyUI_frontend/src/components/sidebar/SidebarSettingsButton.vue","../../../../../../../ComfyUI_frontend/src/components/sidebar/SidebarShortcutsToggleButton.vue","../../../../../../../ComfyUI_frontend/src/components/icons/PuzzleIcon.vue","../../../../../../../ComfyUI_frontend/src/components/helpcenter/HelpCenterMenuContent.vue","../../../../../../../ComfyUI_frontend/src/platform/updates/components/ReleaseNotificationToast.vue","../../../../../../../ComfyUI_frontend/src/platform/updates/components/WhatsNewPopup.vue","../../../../../../../ComfyUI_frontend/src/stores/helpCenterStore.ts","../../../../../../../ComfyUI_frontend/src/components/sidebar/SidebarHelpCenterIcon.vue","../../../../../../../ComfyUI_frontend/src/components/sidebar/SidebarLogoutIcon.vue","../../../../../../../ComfyUI_frontend/src/components/sidebar/SidebarTemplatesButton.vue","../../../../../../../ComfyUI_frontend/src/components/sidebar/SideToolbar.vue","../../../../../../../ComfyUI_frontend/src/stores/topbarBadgeStore.ts","../../../../../../../ComfyUI_frontend/src/components/topbar/TopbarBadges.vue","../../../../../../../ComfyUI_frontend/src/components/topbar/WorkflowTabPopover.vue","../../../../../../../ComfyUI_frontend/src/components/topbar/WorkflowTab.vue","../../../../../../../ComfyUI_frontend/src/components/topbar/WorkflowOverflowMenu.vue","../../../../../../../ComfyUI_frontend/src/components/topbar/WorkflowTabs.vue","../../../../../../../ComfyUI_frontend/src/renderer/core/layout/sync/useLayoutSync.ts","../../../../../../../ComfyUI_frontend/src/composables/graph/useVueNodeLifecycle.ts","../../../../../../../ComfyUI_frontend/src/composables/node/useNodePricing.ts","../../../../../../../ComfyUI_frontend/src/composables/node/usePriceBadge.ts","../../../../../../../ComfyUI_frontend/src/composables/node/useWatchWidget.ts","../../../../../../../ComfyUI_frontend/src/composables/node/useNodeBadge.ts","../../../../../../../ComfyUI_frontend/src/composables/useCanvasDrop.ts","../../../../../../../ComfyUI_frontend/src/composables/useContextMenuTranslation.ts","../../../../../../../ComfyUI_frontend/src/workbench/eventHelpers.ts","../../../../../../../ComfyUI_frontend/src/composables/useCopy.ts","../../../../../../../ComfyUI_frontend/src/composables/useGlobalLitegraph.ts","../../../../../../../ComfyUI_frontend/src/composables/usePaste.ts","../../../../../../../ComfyUI_frontend/src/platform/settings/composables/useLitegraphSettings.ts","../../../../../../../ComfyUI_frontend/src/platform/settings/constants/coreSettings.ts","../../../../../../../ComfyUI_frontend/src/platform/workflow/persistence/composables/useWorkflowAutoSave.ts","../../../../../../../ComfyUI_frontend/src/platform/workflow/templates/composables/useTemplateUrlLoader.ts","../../../../../../../ComfyUI_frontend/src/platform/workflow/persistence/composables/useWorkflowPersistence.ts","../../../../../../../ComfyUI_frontend/src/renderer/core/layout/transform/useTransformSettling.ts","../../../../../../../ComfyUI_frontend/src/renderer/core/layout/transform/useTransformState.ts","../../../../../../../ComfyUI_frontend/src/renderer/core/layout/transform/TransformPane.vue","../../../../../../../ComfyUI_frontend/src/renderer/extensions/minimap/MiniMap.vue","../../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/utils/selectionUtils.ts","../../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/composables/useNodeEventHandlers.ts","../../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/composables/useNodeSnap.ts","../../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/composables/useShiftKeySync.ts","../../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/layout/useNodeDrag.ts","../../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/composables/useNodePointerInteractions.ts","../../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/composables/useVueNodeResizeTracking.ts","../../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/execution/useNodeExecutionState.ts","../../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/layout/useNodeLayout.ts","../../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/preview/useNodePreviewState.ts","../../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/interactions/resize/useNodeResize.ts","../../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/components/LivePreview.vue","../../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/VideoPreview.vue","../../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/components/ImagePreview.vue","../../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/components/NodeContent.vue","../../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/components/LGraphNode.vue","../../../../../../../ComfyUI_frontend/src/services/newUserService.ts","../../../../../../../ComfyUI_frontend/src/components/graph/SelectionRectangle.vue","../../../../../../../ComfyUI_frontend/src/components/graph/GraphCanvas.vue","../../../../../../../ComfyUI_frontend/src/components/toast/RerouteMigrationToast.vue","../../../../../../../ComfyUI_frontend/src/composables/useBrowserTabTitle.ts","../../../../../../../ComfyUI_frontend/src/components/widget/panel/RightSidePanel.vue","../../../../../../../ComfyUI_frontend/src/components/widget/SampleModelSelector.vue","../../../../../../../ComfyUI_frontend/src/composables/useModelSelectorDialog.ts","../../../../../../../ComfyUI_frontend/src/platform/assets/utils/createModelNodeFromAsset.ts","../../../../../../../ComfyUI_frontend/src/platform/support/config.ts","../../../../../../../ComfyUI_frontend/src/composables/useCoreCommands.ts","../../../../../../../ComfyUI_frontend/src/composables/useProgressFavicon.ts","../../../../../../../ComfyUI_frontend/src/types/serverArgs.ts","../../../../../../../ComfyUI_frontend/src/constants/serverConfig.ts","../../../../../../../ComfyUI_frontend/src/components/honeyToast/HoneyToast.vue","../../../../../../../ComfyUI_frontend/src/components/common/StatusBadge.vue","../../../../../../../ComfyUI_frontend/src/components/toast/ProgressToastItem.vue","../../../../../../../ComfyUI_frontend/src/platform/assets/components/ModelImportProgressDialog.vue","../../../../../../../ComfyUI_frontend/src/platform/updates/common/versionCompatibilityStore.ts","../../../../../../../ComfyUI_frontend/src/platform/updates/common/useFrontendVersionMismatchWarning.ts","../../../../../../../ComfyUI_frontend/src/services/autoQueueService.ts","../../../../../../../ComfyUI_frontend/src/views/LinearView.vue","../../../../../../../ComfyUI_frontend/src/workbench/extensions/manager/components/ManagerProgressToast.vue","../../../../../../../ComfyUI_frontend/src/views/GraphView.vue"],"sourcesContent":["export interface TemplateInfo {\n  name: string\n  /**\n   * Optional title which is used as the fallback if the name is not in the locales dictionary.\n   */\n  title?: string\n  tutorialUrl?: string\n  mediaType: string\n  mediaSubtype: string\n  thumbnailVariant?: string\n  description: string\n  localizedTitle?: string\n  localizedDescription?: string\n  isEssential?: boolean\n  sourceModule?: string\n  tags?: string[]\n  models?: string[]\n  date?: string\n  useCase?: string\n  license?: string\n  /**\n   * Estimated VRAM requirement in bytes.\n   */\n  vram?: number\n  size?: number\n  /**\n   * Whether this template uses open source models. When false, indicates partner/API node templates.\n   */\n  openSource?: boolean\n  /**\n   * Array of custom node package IDs required for this template (from Custom Node Registry).\n   * Templates with this field will be hidden on local installations temporarily.\n   */\n  requiresCustomNodes?: string[]\n  /**\n   * Manual ranking boost/demotion for \"Recommended\" sort. Scale 1-10, default 5.\n   * Higher values promote the template, lower values demote it.\n   */\n  searchRank?: number\n  /**\n   * Usage score based on real world usage statistics.\n   * Used for popular templates sort and for \"Recommended\" sort boost.\n   */\n  usage?: number\n  /**\n   * Manage template's visibility across different distributions by specifying which distributions it should be included on.\n   * If not specified, the template will be included on all distributions.\n   */\n  includeOnDistributions?: TemplateIncludeOnDistributionEnum[]\n}\n\nexport enum TemplateIncludeOnDistributionEnum {\n  Cloud = 'cloud',\n  Local = 'local',\n  Desktop = 'desktop',\n  Mac = 'mac',\n  Windows = 'windows'\n}\n\nexport interface WorkflowTemplates {\n  moduleName: string\n  templates: TemplateInfo[]\n  title: string\n  localizedTitle?: string\n  category?: string\n  type?: string\n  icon?: string\n  isEssential?: boolean\n}\n\nexport interface TemplateGroup {\n  label: string\n  icon?: string\n  modules: WorkflowTemplates[]\n}\n","/**\n * Maps category IDs to their corresponding Lucide icon classes\n */\nexport const getCategoryIcon = (categoryId: string): string => {\n  const iconMap: Record<string, string> = {\n    // Main categories\n    all: 'icon-[lucide--list]',\n    'getting-started': 'icon-[lucide--graduation-cap]',\n\n    // Generation types\n    'generation-image': 'icon-[lucide--image]',\n    image: 'icon-[lucide--image]',\n    'generation-video': 'icon-[lucide--film]',\n    video: 'icon-[lucide--film]',\n    'generation-3d': 'icon-[lucide--box]',\n    '3d': 'icon-[lucide--box]',\n    'generation-audio': 'icon-[lucide--volume-2]',\n    audio: 'icon-[lucide--volume-2]',\n    'generation-llm': 'icon-[lucide--message-square-text]',\n\n    // API and models\n    'api-nodes': 'icon-[lucide--hand-coins]',\n    'closed-models': 'icon-[lucide--hand-coins]',\n\n    // LLMs and AI\n    llm: 'icon-[lucide--message-square-text]',\n    llms: 'icon-[lucide--message-square-text]',\n    'llm-api': 'icon-[lucide--message-square-text]',\n\n    // Performance and hardware\n    'small-models': 'icon-[lucide--zap]',\n    performance: 'icon-[lucide--zap]',\n    'mac-compatible': 'icon-[lucide--command]',\n    'runs-on-mac': 'icon-[lucide--command]',\n\n    // Training\n    'lora-training': 'icon-[lucide--dumbbell]',\n    training: 'icon-[lucide--dumbbell]',\n\n    // Extensions and tools\n    extensions: 'icon-[lucide--puzzle]',\n    tools: 'icon-[lucide--wrench]',\n\n    // Fallbacks for common patterns\n    upscaling: 'icon-[lucide--maximize-2]',\n    controlnet: 'icon-[lucide--sliders-horizontal]',\n    'area-composition': 'icon-[lucide--layout-grid]'\n  }\n\n  // Return mapped icon or fallback to folder\n  return iconMap[categoryId.toLowerCase()] || 'icon-[lucide--folder]'\n}\n\n/**\n * Generates a unique category ID from a category group and title\n */\nexport function generateCategoryId(\n  categoryGroup: string,\n  categoryTitle: string\n) {\n  return `${categoryGroup.toLowerCase().replace(/\\s+/g, '-')}-${categoryTitle.toLowerCase().replace(/\\s+/g, '-')}`\n}\n","import Fuse from 'fuse.js'\nimport { defineStore } from 'pinia'\nimport { computed, ref, shallowRef } from 'vue'\n\nimport { i18n, st } from '@/i18n'\nimport { isCloud } from '@/platform/distribution/types'\nimport { api } from '@/scripts/api'\nimport type { NavGroupData, NavItemData } from '@/types/navTypes'\nimport { generateCategoryId, getCategoryIcon } from '@/utils/categoryUtil'\nimport { normalizeI18nKey } from '@/utils/formatUtil'\n\nimport type {\n  TemplateGroup,\n  TemplateInfo,\n  WorkflowTemplates\n} from '../types/template'\n\n// Enhanced template interface for easier filtering\ninterface EnhancedTemplate extends TemplateInfo {\n  sourceModule: string\n  category?: string\n  categoryType?: string\n  categoryGroup?: string // 'GENERATION TYPE' or 'CLOSED SOURCE MODELS'\n  isEssential?: boolean\n  isPartnerNode?: boolean // Computed from OpenSource === false\n  searchableText?: string\n}\n\nexport const useWorkflowTemplatesStore = defineStore(\n  'workflowTemplates',\n  () => {\n    const customTemplates = shallowRef<{ [moduleName: string]: string[] }>({})\n    const coreTemplates = shallowRef<WorkflowTemplates[]>([])\n    const englishTemplates = shallowRef<WorkflowTemplates[]>([])\n    const isLoaded = ref(false)\n    const knownTemplateNames = ref(new Set<string>())\n\n    const getTemplateByName = (name: string): EnhancedTemplate | undefined => {\n      return enhancedTemplates.value.find((template) => template.name === name)\n    }\n\n    // Store filter mappings for dynamic categories\n    type FilterData = {\n      category?: string\n      categoryGroup?: string\n    }\n\n    const categoryFilters = ref(new Map<string, FilterData>())\n\n    /**\n     * Add localization fields to a template.\n     */\n    const addLocalizedFieldsToTemplate = (\n      template: TemplateInfo,\n      categoryTitle: string\n    ) => ({\n      ...template,\n      localizedTitle: st(\n        `templateWorkflows.template.${normalizeI18nKey(categoryTitle)}.${normalizeI18nKey(template.name)}`,\n        template.title ?? template.name\n      ),\n      localizedDescription: st(\n        `templateWorkflows.templateDescription.${normalizeI18nKey(categoryTitle)}.${normalizeI18nKey(template.name)}`,\n        template.description\n      )\n    })\n\n    /**\n     * Add localization fields to all templates in a list of templates.\n     */\n    const localizeTemplateList = (\n      templates: TemplateInfo[],\n      categoryTitle: string\n    ) =>\n      templates.map((template) =>\n        addLocalizedFieldsToTemplate(template, categoryTitle)\n      )\n\n    /**\n     * Add localization fields to a template category and all its constituent templates.\n     */\n    const localizeTemplateCategory = (templateCategory: WorkflowTemplates) => ({\n      ...templateCategory,\n      localizedTitle: st(\n        `templateWorkflows.category.${normalizeI18nKey(templateCategory.title)}`,\n        templateCategory.title ?? templateCategory.moduleName\n      ),\n      templates: localizeTemplateList(\n        templateCategory.templates,\n        templateCategory.title\n      )\n    })\n\n    // Create an \"All\" category that combines all templates\n    const createAllCategory = () => {\n      // First, get core templates with source module added\n      const coreTemplatesWithSourceModule = coreTemplates.value.flatMap(\n        (category) =>\n          // For each template in each category, add the sourceModule and pass through any localized fields\n          category.templates.map((template) => {\n            // Get localized template with its original category title for i18n lookup\n            const localizedTemplate = addLocalizedFieldsToTemplate(\n              template,\n              category.title\n            )\n            return {\n              ...localizedTemplate,\n              sourceModule: category.moduleName\n            }\n          })\n      )\n\n      // Now handle custom templates\n      const customTemplatesWithSourceModule = Object.entries(\n        customTemplates.value\n      ).flatMap(([moduleName, templates]) =>\n        templates.map((name) => ({\n          name,\n          mediaType: 'image',\n          mediaSubtype: 'jpg',\n          description: name,\n          sourceModule: moduleName\n        }))\n      )\n\n      return {\n        moduleName: 'all',\n        title: 'All',\n        localizedTitle: st('templateWorkflows.category.All', 'All Templates'),\n        templates: [\n          ...coreTemplatesWithSourceModule,\n          ...customTemplatesWithSourceModule\n        ]\n      }\n    }\n\n    /**\n     * Original grouped templates for backward compatibility\n     */\n    const groupedTemplates = computed<TemplateGroup[]>(() => {\n      // Get regular categories\n      const allTemplates = [\n        ...coreTemplates.value.map(localizeTemplateCategory),\n        ...Object.entries(customTemplates.value).map(\n          ([moduleName, templates]) => ({\n            moduleName,\n            title: moduleName,\n            localizedTitle: st(\n              `templateWorkflows.category.${normalizeI18nKey(moduleName)}`,\n              moduleName\n            ),\n            templates: templates.map((name) => ({\n              name,\n              mediaType: 'image',\n              mediaSubtype: 'jpg',\n              description: name\n            }))\n          })\n        )\n      ]\n\n      // Group templates by their main category\n      const groupedByCategory = [\n        {\n          label: st(\n            'templateWorkflows.category.ComfyUI Examples',\n            'ComfyUI Examples'\n          ),\n          modules: [\n            createAllCategory(),\n            ...allTemplates.filter((t) => t.moduleName === 'default')\n          ]\n        },\n        ...(Object.keys(customTemplates.value).length > 0\n          ? [\n              {\n                label: st(\n                  'templateWorkflows.category.Custom Nodes',\n                  'Custom Nodes'\n                ),\n                modules: allTemplates.filter((t) => t.moduleName !== 'default')\n              }\n            ]\n          : [])\n      ]\n\n      return groupedByCategory\n    })\n\n    /**\n     * Enhanced templates with proper categorization for filtering\n     */\n    const enhancedTemplates = computed<EnhancedTemplate[]>(() => {\n      const allTemplates: EnhancedTemplate[] = []\n\n      // Process core templates\n      coreTemplates.value.forEach((category) => {\n        category.templates.forEach((template) => {\n          const enhancedTemplate: EnhancedTemplate = {\n            ...template,\n            sourceModule: category.moduleName,\n            category: category.title,\n            categoryType: category.type,\n            categoryGroup: category.category,\n            isEssential: category.isEssential,\n            isPartnerNode: template.openSource === false,\n            searchableText: [\n              template.title || template.name,\n              template.description || '',\n              category.title,\n              ...(template.tags || []),\n              ...(template.models || [])\n            ].join(' ')\n          }\n\n          allTemplates.push(enhancedTemplate)\n        })\n      })\n\n      // Process custom templates\n      Object.entries(customTemplates.value).forEach(\n        ([moduleName, templates]) => {\n          templates.forEach((name) => {\n            const enhancedTemplate: EnhancedTemplate = {\n              name,\n              title: name,\n              description: name,\n              mediaType: 'image',\n              mediaSubtype: 'jpg',\n              sourceModule: moduleName,\n              category: 'Extensions',\n              categoryType: 'extension',\n              searchableText: `${name} ${moduleName} extension`\n            }\n            allTemplates.push(enhancedTemplate)\n          })\n        }\n      )\n\n      // TODO: Temporary filtering of custom node templates on local installations\n      // Future: Add UX that allows local users to opt-in to templates with custom nodes,\n      // potentially conditional on whether they have those specific custom nodes installed.\n      // This would provide better template discovery while respecting local user workflows.\n      const filteredTemplates = isCloud\n        ? allTemplates\n        : allTemplates.filter(\n            (template) => !template.requiresCustomNodes?.length\n          )\n\n      return filteredTemplates\n    })\n\n    /**\n     * Fuse.js instance for advanced template searching and filtering\n     */\n    const templateFuse = computed(() => {\n      const fuseOptions = {\n        keys: [\n          { name: 'searchableText', weight: 0.4 },\n          { name: 'title', weight: 0.3 },\n          { name: 'name', weight: 0.2 },\n          { name: 'tags', weight: 0.1 }\n        ],\n        threshold: 0.3,\n        includeScore: true\n      }\n\n      return new Fuse(enhancedTemplates.value, fuseOptions)\n    })\n\n    /**\n     * Filter templates by category ID using stored filter mappings\n     */\n    const filterTemplatesByCategory = (categoryId: string) => {\n      if (categoryId === 'all') {\n        return enhancedTemplates.value\n      }\n\n      if (categoryId.startsWith('basics-')) {\n        // Filter for templates from categories marked as essential\n        return enhancedTemplates.value.filter(\n          (t) =>\n            t.isEssential &&\n            t.category?.toLowerCase().replace(/\\s+/g, '-') ===\n              categoryId.replace('basics-', '')\n        )\n      }\n\n      if (categoryId === 'popular') {\n        return enhancedTemplates.value\n      }\n\n      if (categoryId === 'partner-nodes') {\n        // Filter for templates where OpenSource === false\n        return enhancedTemplates.value.filter((t) => t.isPartnerNode)\n      }\n\n      // Handle extension-specific filters\n      if (categoryId.startsWith('extension-')) {\n        const moduleName = categoryId.replace('extension-', '')\n        return enhancedTemplates.value.filter(\n          (t) => t.sourceModule === moduleName\n        )\n      }\n\n      // Look up the filter from our stored mappings\n      const filter = categoryFilters.value.get(categoryId)\n      if (!filter) {\n        return enhancedTemplates.value\n      }\n\n      // Apply the filter\n      return enhancedTemplates.value.filter((template) => {\n        if (filter.category && template.category !== filter.category) {\n          return false\n        }\n        if (\n          filter.categoryGroup &&\n          template.categoryGroup !== filter.categoryGroup\n        ) {\n          return false\n        }\n        return true\n      })\n    }\n\n    /**\n     * New navigation structure dynamically built from JSON categories\n     */\n    const navGroupedTemplates = computed<(NavItemData | NavGroupData)[]>(() => {\n      if (!isLoaded.value) return []\n\n      const items: (NavItemData | NavGroupData)[] = []\n\n      // Clear and rebuild filter mappings\n      categoryFilters.value.clear()\n\n      // 1. All Templates - always first\n      items.push({\n        id: 'all',\n        label: st('templateWorkflows.category.All', 'All Templates'),\n        icon: getCategoryIcon('all')\n      })\n\n      // 1.5. Popular categories\n\n      items.push({\n        id: 'popular',\n        label: st('templateWorkflows.category.Popular', 'Popular'),\n        icon: 'icon-[lucide--flame]'\n      })\n\n      // 2. Basics (isEssential categories) - always beneath All Templates if they exist\n      const essentialCats = coreTemplates.value.filter(\n        (cat) => cat.isEssential && cat.templates.length > 0\n      )\n\n      if (essentialCats.length > 0) {\n        essentialCats.forEach((essentialCat) => {\n          const categoryIcon = essentialCat.icon\n          const categoryTitle = essentialCat.title ?? 'Getting Started'\n          const categoryId = generateCategoryId('basics', essentialCat.title)\n          items.push({\n            id: categoryId,\n            label: st(\n              `templateWorkflows.category.${normalizeI18nKey(categoryTitle)}`,\n              categoryTitle\n            ),\n            icon:\n              categoryIcon ||\n              getCategoryIcon(essentialCat.type || 'getting-started')\n          })\n        })\n      }\n\n      // 3. Group categories from JSON dynamically\n      const categoryGroups = new Map<\n        string,\n        { title: string; items: NavItemData[] }\n      >()\n\n      // Process all categories from JSON\n      coreTemplates.value.forEach((category) => {\n        // Skip essential categories as they're handled as Basics\n        if (category.isEssential) return\n\n        const categoryGroup = category.category\n        const categoryIcon = category.icon\n\n        if (categoryGroup) {\n          if (!categoryGroups.has(categoryGroup)) {\n            categoryGroups.set(categoryGroup, {\n              title: categoryGroup,\n              items: []\n            })\n          }\n\n          const group = categoryGroups.get(categoryGroup)!\n\n          // Generate unique ID for this category\n          const categoryId = generateCategoryId(categoryGroup, category.title)\n\n          // Store the filter mapping\n          categoryFilters.value.set(categoryId, {\n            category: category.title,\n            categoryGroup: categoryGroup\n          })\n\n          group.items.push({\n            id: categoryId,\n            label: st(\n              `templateWorkflows.category.${normalizeI18nKey(category.title)}`,\n              category.title\n            ),\n            icon: categoryIcon || getCategoryIcon(category.type || 'default')\n          })\n        }\n      })\n\n      // Add grouped categories\n      categoryGroups.forEach((group, groupName) => {\n        if (group.items.length > 0) {\n          items.push({\n            title: st(\n              `templateWorkflows.category.${normalizeI18nKey(groupName)}`,\n              groupName\n                .split(' ')\n                .map(\n                  (word) =>\n                    word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()\n                )\n                .join(' ')\n            ),\n            items: group.items\n          })\n        }\n      })\n\n      // 3.5. Partner Nodes - virtual category for OpenSource === false templates\n      const partnerNodeCount = enhancedTemplates.value.filter(\n        (t) => t.isPartnerNode\n      ).length\n\n      if (partnerNodeCount > 0) {\n        items.push({\n          id: 'partner-nodes',\n          label: st(\n            'templateWorkflows.category.Partner Nodes',\n            'Partner Nodes'\n          ),\n          icon: 'icon-[lucide--handshake]'\n        })\n      }\n\n      // 4. Extensions - always last\n      const extensionCounts = enhancedTemplates.value.filter(\n        (t) => t.sourceModule !== 'default'\n      ).length\n\n      if (extensionCounts > 0) {\n        // Get unique extension modules\n        const extensionModules = Array.from(\n          new Set(\n            enhancedTemplates.value\n              .filter((t) => t.sourceModule !== 'default')\n              .map((t) => t.sourceModule)\n          )\n        ).sort()\n\n        const extensionItems: NavItemData[] = extensionModules.map(\n          (moduleName) => ({\n            id: `extension-${moduleName}`,\n            label: st(\n              `templateWorkflows.category.${normalizeI18nKey(moduleName)}`,\n              moduleName\n            ),\n            icon: getCategoryIcon('extensions')\n          })\n        )\n\n        items.push({\n          title: st('templateWorkflows.category.Extensions', 'Extensions'),\n          items: extensionItems,\n          collapsible: true\n        })\n      }\n\n      return items\n    })\n\n    async function loadWorkflowTemplates() {\n      try {\n        if (!isLoaded.value) {\n          customTemplates.value = await api.getWorkflowTemplates()\n          const locale = i18n.global.locale.value\n\n          const [coreResult, englishResult] = await Promise.all([\n            api.getCoreWorkflowTemplates(locale),\n            isCloud && locale !== 'en'\n              ? api.getCoreWorkflowTemplates('en')\n              : Promise.resolve([])\n          ])\n\n          coreTemplates.value = coreResult\n          englishTemplates.value = englishResult\n\n          const coreNames = coreTemplates.value.flatMap((category) =>\n            category.templates.map((template) => template.name)\n          )\n          const customNames = Object.values(customTemplates.value).flat()\n          knownTemplateNames.value = new Set([...coreNames, ...customNames])\n\n          isLoaded.value = true\n        }\n      } catch (error) {\n        console.error('Error fetching workflow templates:', error)\n      }\n    }\n\n    function getEnglishMetadata(templateName: string): {\n      tags?: string[]\n      category?: string\n      useCase?: string\n      models?: string[]\n      license?: string\n    } | null {\n      if (englishTemplates.value.length === 0) {\n        return null\n      }\n\n      for (const category of englishTemplates.value) {\n        const template = category.templates.find((t) => t.name === templateName)\n        if (template) {\n          return {\n            tags: template.tags,\n            category: category.title,\n            useCase: template.useCase,\n            models: template.models,\n            license: template.license\n          }\n        }\n      }\n\n      return null\n    }\n\n    return {\n      groupedTemplates,\n      navGroupedTemplates,\n      enhancedTemplates,\n      templateFuse,\n      filterTemplatesByCategory,\n      isLoaded,\n      loadWorkflowTemplates,\n      knownTemplateNames,\n      getTemplateByName,\n      getEnglishMetadata\n    }\n  }\n)\n","import type { InjectionKey } from 'vue'\n\nexport type AssetKind = 'image' | 'video' | 'audio' | 'model' | 'unknown'\n\nexport const OnCloseKey: InjectionKey<() => void> = Symbol()\n","<template>\n  <div class=\"base-widget-layout rounded-2xl overflow-hidden relative\">\n    <Button\n      v-show=\"!isRightPanelOpen && hasRightPanel\"\n      size=\"icon\"\n      :class=\"\n        cn('absolute top-4 right-18 z-10', 'transition-opacity duration-200', {\n          'opacity-0 pointer-events-none': isRightPanelOpen || !hasRightPanel\n        })\n      \"\n      @click=\"toggleRightPanel\"\n    >\n      <i class=\"icon-[lucide--panel-right] text-sm\" />\n    </Button>\n    <Button\n      size=\"lg\"\n      class=\"absolute top-4 right-6 z-10 transition-opacity duration-200 w-10\"\n      @click=\"closeDialog\"\n    >\n      <i class=\"pi pi-times\" />\n    </Button>\n    <div class=\"flex h-full w-full\">\n      <Transition name=\"slide-panel\">\n        <nav\n          v-if=\"$slots.leftPanel && showLeftPanel\"\n          :class=\"[\n            PANEL_SIZES.width,\n            PANEL_SIZES.minWidth,\n            PANEL_SIZES.maxWidth\n          ]\"\n        >\n          <slot name=\"leftPanel\"></slot>\n        </nav>\n      </Transition>\n\n      <div class=\"flex-1 flex bg-base-background\">\n        <div class=\"flex h-full w-full flex-col\">\n          <header\n            v-if=\"$slots.header\"\n            class=\"w-full h-18 px-6 flex items-center justify-between gap-2\"\n          >\n            <div class=\"flex flex-1 shrink-0 gap-2\">\n              <Button v-if=\"!notMobile\" size=\"icon\" @click=\"toggleLeftPanel\">\n                <i\n                  :class=\"\n                    cn(\n                      showLeftPanel\n                        ? 'icon-[lucide--panel-left]'\n                        : 'icon-[lucide--panel-left-close]'\n                    )\n                  \"\n                />\n              </Button>\n              <slot name=\"header\"></slot>\n            </div>\n            <slot name=\"header-right-area\"></slot>\n            <div\n              :class=\"\n                cn(\n                  'flex justify-end gap-2 w-0',\n                  hasRightPanel && !isRightPanelOpen ? 'min-w-22' : 'min-w-10'\n                )\n              \"\n            >\n              <Button\n                v-if=\"isRightPanelOpen && hasRightPanel\"\n                size=\"icon\"\n                @click=\"toggleRightPanel\"\n              >\n                <i class=\"icon-[lucide--panel-right-close]\" />\n              </Button>\n            </div>\n          </header>\n\n          <main class=\"flex min-h-0 flex-1 flex-col\">\n            <!-- Fallback title bar when no leftPanel is provided -->\n            <slot name=\"contentFilter\"></slot>\n            <h2\n              v-if=\"!$slots.leftPanel\"\n              class=\"text-xxl m-0 px-6 pt-2 pb-6 capitalize\"\n            >\n              {{ contentTitle }}\n            </h2>\n            <div\n              class=\"min-h-0 flex-1 px-6 pt-0 pb-10 overflow-y-auto scrollbar-custom\"\n            >\n              <slot name=\"content\"></slot>\n            </div>\n          </main>\n        </div>\n        <aside\n          v-if=\"hasRightPanel && isRightPanelOpen\"\n          class=\"w-1/4 min-w-40 max-w-80\"\n        >\n          <slot name=\"rightPanel\"></slot>\n        </aside>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useBreakpoints } from '@vueuse/core'\nimport { computed, inject, ref, useSlots, watch } from 'vue'\n\nimport Button from '@/components/ui/button/Button.vue'\nimport { OnCloseKey } from '@/types/widgetTypes'\nimport { cn } from '@/utils/tailwindUtil'\n\nconst { contentTitle } = defineProps<{\n  contentTitle: string\n}>()\n\nconst BREAKPOINTS = { md: 880 }\nconst PANEL_SIZES = {\n  width: 'w-1/3',\n  minWidth: 'min-w-40',\n  maxWidth: 'max-w-56'\n}\n\nconst slots = useSlots()\nconst closeDialog = inject(OnCloseKey, () => {})\n\nconst breakpoints = useBreakpoints(BREAKPOINTS)\nconst notMobile = breakpoints.greater('md')\n\nconst isLeftPanelOpen = ref<boolean>(true)\nconst isRightPanelOpen = ref<boolean>(false)\nconst mobileMenuOpen = ref<boolean>(false)\n\nconst hasRightPanel = computed(() => !!slots.rightPanel)\n\nwatch(notMobile, (isDesktop) => {\n  if (!isDesktop) {\n    mobileMenuOpen.value = false\n  }\n})\n\nconst showLeftPanel = computed(() => {\n  const shouldShow = notMobile.value\n    ? isLeftPanelOpen.value\n    : mobileMenuOpen.value\n  return shouldShow\n})\n\nconst toggleLeftPanel = () => {\n  if (notMobile.value) {\n    isLeftPanelOpen.value = !isLeftPanelOpen.value\n  } else {\n    mobileMenuOpen.value = !mobileMenuOpen.value\n  }\n}\n\nconst toggleRightPanel = () => {\n  isRightPanelOpen.value = !isRightPanelOpen.value\n}\n</script>\n<style scoped>\n.base-widget-layout {\n  height: 80vh;\n  width: 90vw;\n  max-width: 1280px;\n  aspect-ratio: 20/13;\n}\n\n@media (min-width: 1450px) {\n  .base-widget-layout {\n    max-width: 1724px;\n  }\n}\n\n/* Fade transition for buttons */\n.fade-enter-active,\n.fade-leave-active {\n  transition: opacity 0.2s ease;\n}\n\n.fade-enter-from,\n.fade-leave-to {\n  opacity: 0;\n}\n\n/* Slide transition for left panel */\n.slide-panel-enter-active,\n.slide-panel-leave-active {\n  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  will-change: transform;\n  backface-visibility: hidden;\n}\n\n.slide-panel-enter-from,\n.slide-panel-leave-to {\n  transform: translateX(-100%);\n}\n</style>\n","<template>\n  <div\n    :class=\"\n      cn(\n        'flex items-center justify-between m-0 px-3 py-0 pt-5',\n        collapsible && 'cursor-pointer select-none'\n      )\n    \"\n    @click=\"collapsible && toggleCollapse()\"\n  >\n    <h3 class=\"text-xs font-bold text-text-secondary uppercase\">\n      {{ title }}\n    </h3>\n    <i\n      v-if=\"collapsible\"\n      :class=\"\n        cn(\n          'pi transition-transform duration-200 text-xs text-text-secondary ',\n          isCollapsed ? 'pi-chevron-right' : 'pi-chevron-down'\n        )\n      \"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\n\nimport { cn } from '@/utils/tailwindUtil'\n\nconst {\n  title,\n  modelValue = false,\n  collapsible = false\n} = defineProps<{\n  title: string\n  modelValue?: boolean\n  collapsible?: boolean\n}>()\n\nconst emit = defineEmits<{\n  'update:modelValue': [value: boolean]\n}>()\n\nconst isCollapsed = computed({\n  get: () => modelValue,\n  set: (value: boolean) => emit('update:modelValue', value)\n})\n\nconst toggleCollapse = () => {\n  isCollapsed.value = !isCollapsed.value\n}\n</script>\n","<template>\n  <header class=\"flex h-16 items-center justify-between px-6\">\n    <div class=\"flex items-center gap-2 pl-1\">\n      <slot name=\"icon\">\n        <i class=\"text-neutral icon-[lucide--puzzle] text-base\" />\n      </slot>\n      <h2 class=\"text-neutral text-base font-bold\">\n        <slot></slot>\n      </h2>\n    </div>\n  </header>\n</template>\n","<template>\n  <div class=\"flex h-full w-full flex-col bg-modal-panel-background\">\n    <PanelHeader>\n      <template #icon>\n        <slot name=\"header-icon\"></slot>\n      </template>\n      <slot name=\"header-title\"></slot>\n    </PanelHeader>\n\n    <nav\n      class=\"flex scrollbar-hide flex-1 flex-col gap-1 overflow-y-auto px-3 py-4\"\n    >\n      <template v-for=\"(item, index) in navItems\" :key=\"index\">\n        <div v-if=\"'items' in item\" class=\"flex flex-col gap-2\">\n          <NavTitle\n            v-model=\"collapsedGroups[item.title]\"\n            :title=\"item.title\"\n            :collapsible=\"item.collapsible\"\n          />\n          <template v-if=\"!item.collapsible || !collapsedGroups[item.title]\">\n            <NavItem\n              v-for=\"subItem in item.items\"\n              :key=\"subItem.id\"\n              :icon=\"subItem.icon\"\n              :active=\"activeItem === subItem.id\"\n              @click=\"activeItem = subItem.id\"\n            >\n              {{ subItem.label }}\n            </NavItem>\n          </template>\n        </div>\n        <div v-else class=\"flex flex-col gap-2\">\n          <NavItem\n            :icon=\"item.icon\"\n            :active=\"activeItem === item.id\"\n            @click=\"activeItem = item.id\"\n          >\n            {{ item.label }}\n          </NavItem>\n        </div>\n      </template>\n    </nav>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, ref } from 'vue'\n\nimport NavItem from '@/components/widget/nav/NavItem.vue'\nimport NavTitle from '@/components/widget/nav/NavTitle.vue'\nimport type { NavGroupData, NavItemData } from '@/types/navTypes'\n\nimport PanelHeader from './PanelHeader.vue'\n\nconst { navItems = [], modelValue } = defineProps<{\n  navItems?: (NavItemData | NavGroupData)[]\n  modelValue?: string | null\n}>()\n\nconst emit = defineEmits<{\n  'update:modelValue': [value: string | null]\n}>()\n\n// Track collapsed state for each group\nconst collapsedGroups = ref<Record<string, boolean>>({})\n\nconst getFirstItemId = () => {\n  if (!navItems || navItems.length === 0) {\n    return null\n  }\n\n  const firstEntry = navItems[0]\n\n  if ('items' in firstEntry && firstEntry.items.length > 0) {\n    return firstEntry.items[0].id\n  }\n  if ('id' in firstEntry) {\n    return firstEntry.id\n  }\n\n  return null\n}\n\nconst activeItem = computed({\n  get: () => modelValue ?? getFirstItemId(),\n  set: (value: string | null) => emit('update:modelValue', value)\n})\n</script>\n","import { computed } from 'vue'\nimport type { CSSProperties, ComputedRef } from 'vue'\n\ninterface PopoverSizeOptions {\n  minWidth?: string\n  maxWidth?: string\n}\n\n/**\n * Composable for managing popover sizing styles\n * @param options Popover size configuration\n * @returns Computed style object for popover sizing\n */\nexport function usePopoverSizing(\n  options: PopoverSizeOptions\n): ComputedRef<CSSProperties> {\n  return computed(() => {\n    const { minWidth, maxWidth } = options\n    const style: CSSProperties = {}\n\n    if (minWidth) {\n      style.minWidth = minWidth\n    }\n\n    if (maxWidth) {\n      style.maxWidth = maxWidth\n    }\n\n    return style\n  })\n}\n","<template>\n  <!--\n    Note: Unlike SingleSelect, we don't need an explicit options prop because:\n    1. Our value template only shows a static label (not dynamic based on selection)\n    2. We display a count badge instead of actual selected labels\n    3. All PrimeVue props (including options) are passed via v-bind=\"$attrs\"\n    option-label=\"name\" is required because our option template directly accesses option.name\n    max-selected-labels=\"0\" is required to show count badge instead of selected item labels\n  -->\n  <MultiSelect\n    v-model=\"selectedItems\"\n    v-bind=\"{ ...$attrs, options: filteredOptions }\"\n    option-label=\"name\"\n    unstyled\n    :max-selected-labels=\"0\"\n    :pt=\"{\n      root: ({ props }: MultiSelectPassThroughMethodOptions) => ({\n        class: cn(\n          'h-10 relative inline-flex cursor-pointer select-none',\n          'rounded-lg bg-secondary-background text-base-foreground',\n          'transition-all duration-200 ease-in-out',\n          'border-[2.5px] border-solid',\n          selectedCount > 0\n            ? 'border-node-component-border'\n            : 'border-transparent',\n          'focus-within:border-node-component-border',\n          { 'opacity-60 cursor-default': props.disabled }\n        )\n      }),\n      labelContainer: {\n        class:\n          'flex-1 flex items-center overflow-hidden whitespace-nowrap pl-4 py-2 '\n      },\n      label: {\n        class: 'p-0'\n      },\n      dropdown: {\n        class: 'flex shrink-0 cursor-pointer items-center justify-center px-3'\n      },\n      header: () => ({\n        class:\n          showSearchBox || showSelectedCount || showClearButton\n            ? 'block'\n            : 'hidden'\n      }),\n      // Overlay & list visuals unchanged\n      overlay: {\n        class: cn(\n          'mt-2 rounded-lg py-2 px-2',\n          'bg-base-background',\n          'text-base-foreground',\n          'border border-solid border-border-default'\n        )\n      },\n      listContainer: () => ({\n        style: { maxHeight: `min(${listMaxHeight}, 50vh)` },\n        class: 'scrollbar-custom'\n      }),\n      list: {\n        class: 'flex flex-col gap-0 p-0 m-0 list-none border-none text-sm'\n      },\n      // Option row hover and focus tone\n      option: ({ context }: MultiSelectPassThroughMethodOptions) => ({\n        class: cn(\n          'flex gap-2 items-center h-10 px-2 rounded-lg cursor-pointer',\n          'hover:bg-secondary-background-hover',\n          // Add focus/highlight state for keyboard navigation\n          context?.focused &&\n            'bg-secondary-background-selected hover:bg-secondary-background-selected'\n        )\n      }),\n      // Hide built-in checkboxes entirely via PT (no :deep)\n      pcHeaderCheckbox: {\n        root: { class: 'hidden' },\n        style: { display: 'none' }\n      },\n      pcOptionCheckbox: {\n        root: { class: 'hidden' },\n        style: { display: 'none' }\n      }\n    }\"\n    :aria-label=\"label || t('g.multiSelectDropdown')\"\n    role=\"combobox\"\n    :aria-expanded=\"false\"\n    aria-haspopup=\"listbox\"\n    :tabindex=\"0\"\n  >\n    <template\n      v-if=\"showSearchBox || showSelectedCount || showClearButton\"\n      #header\n    >\n      <div class=\"flex flex-col px-2 pt-2 pb-0\">\n        <SearchBox\n          v-if=\"showSearchBox\"\n          v-model=\"searchQuery\"\n          :class=\"showSelectedCount || showClearButton ? 'mb-2' : ''\"\n          :show-order=\"true\"\n          :show-border=\"true\"\n          :place-holder=\"searchPlaceholder\"\n        />\n        <div\n          v-if=\"showSelectedCount || showClearButton\"\n          class=\"mt-2 flex items-center justify-between\"\n        >\n          <span\n            v-if=\"showSelectedCount\"\n            class=\"px-1 text-sm text-base-foreground\"\n          >\n            {{\n              selectedCount > 0\n                ? $t('g.itemsSelected', { selectedCount })\n                : $t('g.itemSelected', { selectedCount })\n            }}\n          </span>\n          <Button\n            v-if=\"showClearButton\"\n            variant=\"textonly\"\n            size=\"md\"\n            @click.stop=\"selectedItems = []\"\n          >\n            {{ $t('g.clearAll') }}\n          </Button>\n        </div>\n        <div class=\"my-4 h-px bg-border-default\"></div>\n      </div>\n    </template>\n\n    <!-- Trigger value (keep text scale identical) -->\n    <template #value>\n      <span class=\"text-sm\">\n        {{ label }}\n      </span>\n      <span\n        v-if=\"selectedCount > 0\"\n        class=\"pointer-events-none absolute -top-2 -right-2 z-10 flex h-5 w-5 items-center justify-center rounded-full bg-primary-background text-xs font-semibold text-base-foreground\"\n      >\n        {{ selectedCount }}\n      </span>\n    </template>\n\n    <!-- Chevron size identical to current -->\n    <template #dropdownicon>\n      <i class=\"icon-[lucide--chevron-down] text-muted-foreground\" />\n    </template>\n\n    <!-- Custom option row: square checkbox + label (unchanged layout/colors) -->\n    <template #option=\"slotProps\">\n      <div\n        role=\"button\"\n        class=\"flex items-center gap-2 cursor-pointer\"\n        :style=\"popoverStyle\"\n      >\n        <div\n          class=\"flex size-4 shrink-0 items-center justify-center rounded p-0.5 transition-all duration-200\"\n          :class=\"\n            slotProps.selected\n              ? 'bg-primary-background'\n              : 'bg-secondary-background'\n          \"\n        >\n          <i\n            v-if=\"slotProps.selected\"\n            class=\"text-bold icon-[lucide--check] text-xs text-base-foreground\"\n          />\n        </div>\n        <span>\n          {{ slotProps.option.name }}\n        </span>\n      </div>\n    </template>\n  </MultiSelect>\n</template>\n\n<script setup lang=\"ts\">\nimport { useFuse } from '@vueuse/integrations/useFuse'\nimport type { UseFuseOptions } from '@vueuse/integrations/useFuse'\nimport type { MultiSelectPassThroughMethodOptions } from 'primevue/multiselect'\nimport MultiSelect from 'primevue/multiselect'\nimport { computed, useAttrs } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport SearchBox from '@/components/common/SearchBox.vue'\nimport Button from '@/components/ui/button/Button.vue'\nimport { usePopoverSizing } from '@/composables/usePopoverSizing'\nimport { cn } from '@/utils/tailwindUtil'\n\nimport type { SelectOption } from './types'\n\ntype Option = SelectOption\n\ndefineOptions({\n  inheritAttrs: false\n})\n\ninterface Props {\n  /** Input label shown on the trigger button */\n  label?: string\n  /** Show search box in the panel header */\n  showSearchBox?: boolean\n  /** Show selected count text in the panel header */\n  showSelectedCount?: boolean\n  /** Show \"Clear all\" action in the panel header */\n  showClearButton?: boolean\n  /** Placeholder for the search input */\n  searchPlaceholder?: string\n  /** Maximum height of the dropdown panel (default: 28rem) */\n  listMaxHeight?: string\n  /** Minimum width of the popover (default: auto) */\n  popoverMinWidth?: string\n  /** Maximum width of the popover (default: auto) */\n  popoverMaxWidth?: string\n  // Note: options prop is intentionally omitted.\n  // It's passed via $attrs to maximize PrimeVue API compatibility\n}\nconst {\n  label,\n  showSearchBox = false,\n  showSelectedCount = false,\n  showClearButton = false,\n  searchPlaceholder = 'Search...',\n  listMaxHeight = '28rem',\n  popoverMinWidth,\n  popoverMaxWidth\n} = defineProps<Props>()\n\nconst selectedItems = defineModel<Option[]>({\n  required: true\n})\nconst searchQuery = defineModel<string>('searchQuery', { default: '' })\n\nconst { t } = useI18n()\nconst selectedCount = computed(() => selectedItems.value.length)\n\nconst popoverStyle = usePopoverSizing({\n  minWidth: popoverMinWidth,\n  maxWidth: popoverMaxWidth\n})\nconst attrs = useAttrs()\nconst originalOptions = computed(() => (attrs.options as Option[]) || [])\n\n// Use VueUse's useFuse for better reactivity and performance\nconst fuseOptions: UseFuseOptions<Option> = {\n  fuseOptions: {\n    keys: ['name', 'value'],\n    threshold: 0.3,\n    includeScore: false\n  },\n  matchAllWhenSearchEmpty: true\n}\n\nconst { results } = useFuse(searchQuery, originalOptions, fuseOptions)\n\n// Filter options based on search, but always include selected items\nconst filteredOptions = computed(() => {\n  if (!searchQuery.value || searchQuery.value.trim() === '') {\n    return originalOptions.value\n  }\n\n  // results.value already contains the search results from useFuse\n  const searchResults = results.value.map(\n    (result: { item: Option }) => result.item\n  )\n\n  // Include selected items that aren't in search results\n  const selectedButNotInResults = selectedItems.value.filter(\n    (item) =>\n      !searchResults.some((result: Option) => result.value === item.value)\n  )\n\n  return [...selectedButNotInResults, ...searchResults]\n})\n</script>\n","import { uniqWith } from 'es-toolkit'\nimport { computed, toValue } from 'vue'\nimport type { MaybeRefOrGetter } from 'vue'\n\nimport type { SelectOption } from '@/components/input/types'\nimport type { AssetItem } from '@/platform/assets/schemas/assetSchema'\n\n/**\n * Composable that extracts available filter options from asset data\n * Provides reactive computed properties for file formats and base models\n */\nexport function useAssetFilterOptions(assets: MaybeRefOrGetter<AssetItem[]>) {\n  /**\n   * Extract unique file formats from asset names\n   * Returns sorted SelectOption array with extensions\n   */\n  const availableFileFormats = computed<SelectOption[]>(() => {\n    const assetList = toValue(assets)\n    const extensions = assetList\n      .map((asset) => {\n        const extension = asset.name.split('.').pop()\n        return extension && extension !== asset.name ? extension : null\n      })\n      .filter((extension): extension is string => extension !== null)\n\n    const uniqueExtensions = uniqWith(extensions, (a, b) => a === b)\n\n    return uniqueExtensions.sort().map((format) => ({\n      name: `.${format}`,\n      value: format\n    }))\n  })\n\n  /**\n   * Extract unique base models from asset user metadata\n   * Returns sorted SelectOption array with base model names\n   */\n  const availableBaseModels = computed<SelectOption[]>(() => {\n    const assetList = toValue(assets)\n    const models = assetList\n      .map((asset) => asset.user_metadata?.base_model)\n      .filter(\n        (baseModel): baseModel is string =>\n          baseModel !== undefined && typeof baseModel === 'string'\n      )\n\n    const uniqueModels = uniqWith(models, (a, b) => a === b)\n\n    return uniqueModels.sort().map((model) => ({\n      name: model,\n      value: model\n    }))\n  })\n\n  return {\n    availableFileFormats,\n    availableBaseModels\n  }\n}\n","<template>\n  <div\n    class=\"flex gap-4 items-center justify-between px-6 pt-2 pb-6\"\n    data-component-id=\"asset-filter-bar\"\n  >\n    <div\n      class=\"flex gap-4 items-center\"\n      data-component-id=\"asset-filter-bar-left\"\n    >\n      <MultiSelect\n        v-if=\"availableFileFormats.length > 0\"\n        v-model=\"fileFormats\"\n        :label=\"$t('assetBrowser.fileFormats')\"\n        :options=\"availableFileFormats\"\n        class=\"min-w-32\"\n        data-component-id=\"asset-filter-file-formats\"\n        @update:model-value=\"handleFilterChange\"\n      />\n\n      <MultiSelect\n        v-if=\"availableBaseModels.length > 0\"\n        v-model=\"baseModels\"\n        :label=\"$t('assetBrowser.baseModels')\"\n        :options=\"availableBaseModels\"\n        class=\"min-w-32\"\n        data-component-id=\"asset-filter-base-models\"\n        @update:model-value=\"handleFilterChange\"\n      />\n\n      <SingleSelect\n        v-if=\"hasMutableAssets\"\n        v-model=\"ownership\"\n        :label=\"$t('assetBrowser.ownership')\"\n        :options=\"ownershipOptions\"\n        class=\"min-w-42\"\n        data-component-id=\"asset-filter-ownership\"\n        @update:model-value=\"handleFilterChange\"\n      />\n    </div>\n\n    <div class=\"flex items-center\" data-component-id=\"asset-filter-bar-right\">\n      <SingleSelect\n        v-model=\"sortBy\"\n        :label=\"$t('assetBrowser.sortBy')\"\n        :options=\"sortOptions\"\n        class=\"min-w-32\"\n        data-component-id=\"asset-filter-sort\"\n        @update:model-value=\"handleFilterChange\"\n      >\n        <template #icon>\n          <i class=\"icon-[lucide--arrow-up-down]\" />\n        </template>\n      </SingleSelect>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, ref } from 'vue'\n\nimport MultiSelect from '@/components/input/MultiSelect.vue'\nimport SingleSelect from '@/components/input/SingleSelect.vue'\nimport type { SelectOption } from '@/components/input/types'\nimport { t } from '@/i18n'\nimport type { OwnershipOption } from '@/platform/assets/composables/useAssetBrowser'\nimport { useAssetFilterOptions } from '@/platform/assets/composables/useAssetFilterOptions'\nimport type { AssetItem } from '@/platform/assets/schemas/assetSchema'\n\nconst SORT_OPTIONS = [\n  { name: t('assetBrowser.sortRecent'), value: 'recent' },\n  { name: t('assetBrowser.sortAZ'), value: 'name-asc' },\n  { name: t('assetBrowser.sortZA'), value: 'name-desc' }\n] as const\n\ntype SortOption = (typeof SORT_OPTIONS)[number]['value']\n\nconst sortOptions = [...SORT_OPTIONS]\n\nconst ownershipOptions = [\n  { name: t('assetBrowser.ownershipAll'), value: 'all' },\n  { name: t('assetBrowser.ownershipMyModels'), value: 'my-models' },\n  { name: t('assetBrowser.ownershipPublicModels'), value: 'public-models' }\n]\n\nexport interface FilterState {\n  fileFormats: string[]\n  baseModels: string[]\n  sortBy: string\n  ownership: OwnershipOption\n}\n\nconst { assets = [], allAssets = [] } = defineProps<{\n  assets?: AssetItem[]\n  allAssets?: AssetItem[]\n}>()\n\nconst fileFormats = ref<SelectOption[]>([])\nconst baseModels = ref<SelectOption[]>([])\nconst sortBy = ref<SortOption>('recent')\nconst ownership = ref<OwnershipOption>('all')\n\nconst { availableFileFormats, availableBaseModels } =\n  useAssetFilterOptions(assets)\n\nconst hasMutableAssets = computed(() => {\n  const assetsToCheck = allAssets.length ? allAssets : assets\n  return assetsToCheck.some((asset) => asset.is_immutable === false)\n})\n\nconst emit = defineEmits<{\n  filterChange: [filters: FilterState]\n}>()\n\nfunction handleFilterChange() {\n  emit('filterChange', {\n    fileFormats: fileFormats.value.map((option: SelectOption) => option.value),\n    baseModels: baseModels.value.map((option: SelectOption) => option.value),\n    sortBy: sortBy.value,\n    ownership: ownership.value\n  })\n}\n</script>\n","<template>\n  <div class=\"relative inline-flex items-center\">\n    <Button size=\"icon\" variant=\"secondary\" @click=\"popover?.toggle\">\n      <i\n        :class=\"\n          cn(\n            !isVertical\n              ? 'icon-[lucide--ellipsis]'\n              : 'icon-[lucide--more-vertical]',\n            'text-sm'\n          )\n        \"\n      />\n    </Button>\n\n    <Popover\n      ref=\"popover\"\n      append-to=\"body\"\n      auto-z-index\n      dismissable\n      close-on-escape\n      unstyled\n      :base-z-index=\"1000\"\n      :pt=\"{\n        root: {\n          class: cn('absolute z-50')\n        },\n        content: {\n          class: cn(\n            'mt-1 rounded-lg',\n            'bg-secondary-background text-base-foreground',\n            'shadow-lg'\n          )\n        }\n      }\"\n      @show=\"\n        () => {\n          isOpen = true\n          $emit('menuOpened')\n        }\n      \"\n      @hide=\"\n        () => {\n          isOpen = false\n          $emit('menuClosed')\n        }\n      \"\n    >\n      <div class=\"flex min-w-40 flex-col gap-2 p-2\">\n        <slot :close=\"hide\" />\n      </div>\n    </Popover>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport Popover from 'primevue/popover'\nimport { ref } from 'vue'\n\nimport Button from '@/components/ui/button/Button.vue'\nimport { cn } from '@/utils/tailwindUtil'\n\ninterface MoreButtonProps {\n  isVertical?: boolean\n}\n\nconst { isVertical = false } = defineProps<MoreButtonProps>()\n\ndefineEmits<{\n  menuOpened: []\n  menuClosed: []\n}>()\n\nconst isOpen = ref(false)\nconst popover = ref<InstanceType<typeof Popover>>()\n\nfunction hide() {\n  popover.value?.hide()\n}\n\ndefineExpose({\n  hide,\n  isOpen\n})\n</script>\n","<template>\n  <div\n    class=\"flex flex-col px-4 py-2 text-sm text-muted-foreground border-t border-border-default\"\n  >\n    <p v-if=\"promptTextReal\">\n      {{ promptTextReal }}\n    </p>\n  </div>\n</template>\n<script setup lang=\"ts\">\nimport { computed, toValue } from 'vue'\nimport type { MaybeRefOrGetter } from 'vue'\n\nconst { promptText } = defineProps<{\n  promptText?: MaybeRefOrGetter<string>\n}>()\n\nconst promptTextReal = computed(() => toValue(promptText))\n</script>\n","<template>\n  <section class=\"w-full flex gap-2 justify-end px-2 pb-2\">\n    <Button :disabled variant=\"textonly\" autofocus @click=\"$emit('cancel')\">\n      {{ cancelTextX }}\n    </Button>\n    <Button\n      :disabled\n      variant=\"textonly\"\n      :class=\"confirmClass\"\n      @click=\"$emit('confirm')\"\n    >\n      {{ confirmTextX }}\n    </Button>\n  </section>\n</template>\n<script setup lang=\"ts\">\nimport { computed, toValue } from 'vue'\nimport type { MaybeRefOrGetter } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport Button from '@/components/ui/button/Button.vue'\n\nconst { t } = useI18n()\n\nconst { cancelText, confirmText, confirmClass, optionsDisabled } = defineProps<{\n  cancelText?: string\n  confirmText?: string\n  confirmClass?: string\n  optionsDisabled?: MaybeRefOrGetter<boolean>\n}>()\n\ndefineEmits<{\n  cancel: []\n  confirm: []\n}>()\n\nconst confirmTextX = computed(() => confirmText || t('g.confirm'))\nconst cancelTextX = computed(() => cancelText || t('g.cancel'))\nconst disabled = computed(() => toValue(optionsDisabled))\n</script>\n","import ConfirmBody from '@/components/dialog/confirm/ConfirmBody.vue'\nimport ConfirmFooter from '@/components/dialog/confirm/ConfirmFooter.vue'\nimport ConfirmHeader from '@/components/dialog/confirm/ConfirmHeader.vue'\nimport { useDialogStore } from '@/stores/dialogStore'\nimport type { ComponentAttrs } from 'vue-component-type-helpers'\n\ninterface ConfirmDialogOptions {\n  headerProps?: ComponentAttrs<typeof ConfirmHeader>\n  props?: ComponentAttrs<typeof ConfirmBody>\n  footerProps?: ComponentAttrs<typeof ConfirmFooter>\n}\n\nexport function showConfirmDialog(options: ConfirmDialogOptions = {}) {\n  const dialogStore = useDialogStore()\n  const { headerProps, props, footerProps } = options\n  return dialogStore.showDialog({\n    headerComponent: ConfirmHeader,\n    component: ConfirmBody,\n    footerComponent: ConfirmFooter,\n    headerProps,\n    props,\n    footerProps,\n    dialogComponentProps: {\n      pt: {\n        header: 'py-0! px-0!',\n        content: 'p-0!',\n        footer: 'p-0!'\n      }\n    }\n  })\n}\n","<template>\n  <div\n    v-if=\"!deletedLocal\"\n    data-component-id=\"AssetCard\"\n    :data-asset-id=\"asset.id\"\n    :aria-labelledby=\"titleId\"\n    :aria-describedby=\"descId\"\n    :tabindex=\"interactive ? 0 : -1\"\n    :class=\"\n      cn(\n        'rounded-2xl overflow-hidden transition-all duration-200 bg-modal-card-background p-2 gap-2 flex flex-col h-full',\n        interactive &&\n          'group appearance-none bg-transparent m-0 outline-none text-left hover:bg-secondary-background focus:bg-secondary-background border-none focus:outline-solid outline-base-foreground outline-4'\n      )\n    \"\n    @keydown.enter.self=\"interactive && $emit('select', asset)\"\n  >\n    <div class=\"relative aspect-square w-full overflow-hidden rounded-xl\">\n      <div\n        v-if=\"isLoading || error\"\n        class=\"flex size-full cursor-pointer items-center justify-center bg-gradient-to-br from-smoke-400 via-smoke-800 to-charcoal-400\"\n        role=\"button\"\n        @click.self=\"interactive && $emit('select', asset)\"\n      />\n      <img\n        v-else\n        :src=\"asset.preview_url\"\n        :alt=\"displayName\"\n        class=\"size-full object-cover cursor-pointer\"\n        role=\"button\"\n        @click.self=\"interactive && $emit('select', asset)\"\n      />\n\n      <AssetBadgeGroup :badges=\"asset.badges\" />\n      <IconGroup\n        v-if=\"showAssetOptions\"\n        :class=\"\n          cn(\n            'absolute top-2 right-2 invisible group-hover:visible',\n            dropdownMenuButton?.isOpen && 'visible'\n          )\n        \"\n      >\n        <MoreButton ref=\"dropdown-menu-button\" size=\"sm\">\n          <template #default>\n            <Button\n              v-if=\"flags.assetRenameEnabled\"\n              variant=\"secondary\"\n              size=\"md\"\n              class=\"justify-start\"\n              @click=\"startAssetRename\"\n            >\n              <i class=\"icon-[lucide--pencil]\" />\n              <span>{{ $t('g.rename') }}</span>\n            </Button>\n            <Button\n              v-if=\"flags.assetDeletionEnabled\"\n              variant=\"secondary\"\n              size=\"md\"\n              class=\"justify-start\"\n              @click=\"confirmDeletion\"\n            >\n              <i class=\"icon-[lucide--trash-2]\" />\n              <span>{{ $t('g.delete') }}</span>\n            </Button>\n          </template>\n        </MoreButton>\n      </IconGroup>\n    </div>\n    <div class=\"max-h-32 flex flex-col gap-2 justify-between flex-auto\">\n      <h3\n        :id=\"titleId\"\n        v-tooltip.top=\"{ value: displayName, showDelay: tooltipDelay }\"\n        :class=\"\n          cn(\n            'mb-2 m-0 text-base font-semibold line-clamp-2 wrap-anywhere',\n            'text-base-foreground'\n          )\n        \"\n      >\n        <EditableText\n          :model-value=\"displayName\"\n          :is-editing=\"isEditing\"\n          :input-attrs=\"{ 'data-testid': 'asset-name-input' }\"\n          @edit=\"assetRename\"\n          @cancel=\"assetRename()\"\n        />\n      </h3>\n      <p\n        :id=\"descId\"\n        v-tooltip.top=\"{ value: asset.description, showDelay: tooltipDelay }\"\n        :class=\"\n          cn(\n            'm-0 text-sm leading-6 overflow-hidden [-webkit-box-orient:vertical] [-webkit-line-clamp:2] [display:-webkit-box] text-muted-foreground'\n          )\n        \"\n      >\n        {{ asset.description }}\n      </p>\n      <div class=\"flex gap-4 text-xs text-muted-foreground mt-auto\">\n        <span v-if=\"asset.stats.stars\" class=\"flex items-center gap-1\">\n          <i class=\"icon-[lucide--star] size-3\" />\n          {{ asset.stats.stars }}\n        </span>\n        <span v-if=\"asset.stats.downloadCount\" class=\"flex items-center gap-1\">\n          <i class=\"icon-[lucide--download] size-3\" />\n          {{ asset.stats.downloadCount }}\n        </span>\n        <span v-if=\"asset.stats.formattedDate\" class=\"flex items-center gap-1\">\n          <i class=\"icon-[lucide--clock] size-3\" />\n          {{ asset.stats.formattedDate }}\n        </span>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useImage } from '@vueuse/core'\nimport { computed, ref, toValue, useId, useTemplateRef } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport IconGroup from '@/components/button/IconGroup.vue'\nimport MoreButton from '@/components/button/MoreButton.vue'\nimport EditableText from '@/components/common/EditableText.vue'\nimport { showConfirmDialog } from '@/components/dialog/confirm/confirmDialog'\nimport Button from '@/components/ui/button/Button.vue'\nimport { useFeatureFlags } from '@/composables/useFeatureFlags'\nimport AssetBadgeGroup from '@/platform/assets/components/AssetBadgeGroup.vue'\nimport type { AssetDisplayItem } from '@/platform/assets/composables/useAssetBrowser'\nimport { assetService } from '@/platform/assets/services/assetService'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useToastStore } from '@/platform/updates/common/toastStore'\nimport { useDialogStore } from '@/stores/dialogStore'\nimport { cn } from '@/utils/tailwindUtil'\n\nconst { asset, interactive } = defineProps<{\n  asset: AssetDisplayItem\n  interactive?: boolean\n}>()\n\ndefineEmits<{\n  select: [asset: AssetDisplayItem]\n}>()\n\nconst { t } = useI18n()\nconst settingStore = useSettingStore()\nconst { closeDialog } = useDialogStore()\nconst { flags } = useFeatureFlags()\nconst toastStore = useToastStore()\n\nconst dropdownMenuButton = useTemplateRef<InstanceType<typeof MoreButton>>(\n  'dropdown-menu-button'\n)\n\nconst titleId = useId()\nconst descId = useId()\n\nconst isEditing = ref(false)\nconst newNameRef = ref<string>()\nconst deletedLocal = ref(false)\n\nconst displayName = computed(() => newNameRef.value ?? asset.name)\n\nconst showAssetOptions = computed(\n  () =>\n    (flags.assetDeletionEnabled || flags.assetRenameEnabled) &&\n    !(asset.is_immutable ?? true)\n)\n\nconst tooltipDelay = computed<number>(() =>\n  settingStore.get('LiteGraph.Node.TooltipDelay')\n)\n\nconst { isLoading, error } = useImage({\n  src: asset.preview_url ?? '',\n  alt: asset.name\n})\n\nfunction confirmDeletion() {\n  dropdownMenuButton.value?.hide()\n  const assetName = toValue(displayName)\n  const promptText = ref<string>(t('assetBrowser.deletion.body'))\n  const optionsDisabled = ref(false)\n  const confirmDialog = showConfirmDialog({\n    headerProps: {\n      title: t('assetBrowser.deletion.header')\n    },\n    props: {\n      promptText\n    },\n    footerProps: {\n      confirmText: t('g.delete'),\n      // TODO: These need to be put into the new Button Variants once we have them.\n      confirmClass: cn(\n        'bg-danger-200 text-base-foreground hover:bg-danger-200/80 focus:bg-danger-200/80 focus:ring ring-base-foreground'\n      ),\n      optionsDisabled,\n      onCancel: () => {\n        closeDialog(confirmDialog)\n      },\n      onConfirm: async () => {\n        optionsDisabled.value = true\n        try {\n          promptText.value = t('assetBrowser.deletion.inProgress', {\n            assetName\n          })\n          await assetService.deleteAsset(asset.id)\n          promptText.value = t('assetBrowser.deletion.complete', {\n            assetName\n          })\n          // Give a second for the completion message\n          await new Promise((resolve) => setTimeout(resolve, 1_000))\n          deletedLocal.value = true\n        } catch (err: unknown) {\n          console.error(err)\n          promptText.value = t('assetBrowser.deletion.failed', {\n            assetName\n          })\n          // Give a second for the completion message\n          await new Promise((resolve) => setTimeout(resolve, 3_000))\n        } finally {\n          closeDialog(confirmDialog)\n        }\n      }\n    }\n  })\n}\n\nfunction startAssetRename() {\n  dropdownMenuButton.value?.hide()\n  isEditing.value = true\n}\n\nasync function assetRename(newName?: string) {\n  isEditing.value = false\n  if (newName) {\n    // Optimistic update\n    newNameRef.value = newName\n    try {\n      const result = await assetService.updateAsset(asset.id, {\n        name: newName\n      })\n      // Update with the actual name once the server responds\n      newNameRef.value = result.name\n    } catch (err: unknown) {\n      console.error(err)\n      toastStore.add({\n        severity: 'error',\n        summary: t('assetBrowser.rename.failed'),\n        life: 10_000\n      })\n      newNameRef.value = undefined\n    }\n  }\n}\n</script>\n","<template>\n  <div\n    data-component-id=\"AssetGrid\"\n    class=\"h-full\"\n    role=\"grid\"\n    :aria-label=\"$t('assetBrowser.assetCollection')\"\n    :aria-rowcount=\"-1\"\n    :aria-colcount=\"-1\"\n    :aria-setsize=\"assets.length\"\n  >\n    <div v-if=\"loading\" class=\"flex h-full items-center justify-center py-20\">\n      <i\n        class=\"icon-[lucide--loader] size-12 animate-spin text-muted-foreground\"\n      />\n    </div>\n    <div\n      v-else-if=\"assets.length === 0\"\n      class=\"flex h-full flex-col items-center justify-center py-16 text-muted-foreground\"\n    >\n      <i class=\"mb-4 icon-[lucide--search] size-10\" />\n      <h3 class=\"mb-2 text-lg font-medium\">\n        {{ $t('assetBrowser.noAssetsFound') }}\n      </h3>\n      <p class=\"text-sm\">{{ $t('assetBrowser.tryAdjustingFilters') }}</p>\n    </div>\n    <VirtualGrid\n      v-else\n      :items=\"assetsWithKey\"\n      :grid-style=\"gridStyle\"\n      :default-item-height=\"320\"\n      :default-item-width=\"240\"\n    >\n      <template #item=\"{ item }\">\n        <AssetCard\n          :asset=\"item\"\n          :interactive=\"true\"\n          @select=\"$emit('assetSelect', $event)\"\n        />\n      </template>\n    </VirtualGrid>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport type { CSSProperties } from 'vue'\nimport { computed } from 'vue'\n\nimport VirtualGrid from '@/components/common/VirtualGrid.vue'\nimport AssetCard from '@/platform/assets/components/AssetCard.vue'\nimport type { AssetDisplayItem } from '@/platform/assets/composables/useAssetBrowser'\n\nconst { assets } = defineProps<{\n  assets: AssetDisplayItem[]\n  loading?: boolean\n}>()\n\ndefineEmits<{\n  assetSelect: [asset: AssetDisplayItem]\n}>()\n\nconst assetsWithKey = computed(() =>\n  assets.map((asset) => ({ ...asset, key: asset.id }))\n)\n\nconst gridStyle: Partial<CSSProperties> = {\n  display: 'grid',\n  gridTemplateColumns: 'repeat(auto-fill, minmax(15rem, 1fr))',\n  gap: '1rem',\n  padding: '0.5rem'\n}\n</script>\n","import type { AssetItem } from '@/platform/assets/schemas/assetSchema'\n\n/**\n * Type-safe utilities for extracting metadata from assets\n */\n\n/**\n * Safely extracts string description from asset metadata\n * @param asset - The asset to extract description from\n * @returns The description string or null if not present/not a string\n */\nexport function getAssetDescription(asset: AssetItem): string | null {\n  return typeof asset.user_metadata?.description === 'string'\n    ? asset.user_metadata.description\n    : null\n}\n\n/**\n * Safely extracts string base_model from asset metadata\n * @param asset - The asset to extract base_model from\n * @returns The base_model string or null if not present/not a string\n */\nexport function getAssetBaseModel(asset: AssetItem): string | null {\n  return typeof asset.user_metadata?.base_model === 'string'\n    ? asset.user_metadata.base_model\n    : null\n}\n","import { computed, ref } from 'vue'\nimport type { Ref } from 'vue'\nimport { useFuse } from '@vueuse/integrations/useFuse'\nimport type { UseFuseOptions } from '@vueuse/integrations/useFuse'\n\nimport { d, t } from '@/i18n'\nimport type { FilterState } from '@/platform/assets/components/AssetFilterBar.vue'\nimport type { AssetItem } from '@/platform/assets/schemas/assetSchema'\nimport {\n  getAssetBaseModel,\n  getAssetDescription\n} from '@/platform/assets/utils/assetMetadataUtils'\n\nexport type OwnershipOption = 'all' | 'my-models' | 'public-models'\n\nfunction filterByCategory(category: string) {\n  return (asset: AssetItem) => {\n    if (category === 'all') return true\n\n    // Check if any tag matches the category (for exact matches)\n    if (asset.tags.includes(category)) return true\n\n    // Check if any tag's top-level folder matches the category\n    return asset.tags.some((tag) => {\n      if (typeof tag === 'string' && tag.includes('/')) {\n        return tag.split('/')[0] === category\n      }\n      return false\n    })\n  }\n}\n\nfunction filterByFileFormats(formats: string[]) {\n  return (asset: AssetItem) => {\n    if (formats.length === 0) return true\n    const formatSet = new Set(formats)\n    const extension = asset.name.split('.').pop()?.toLowerCase()\n    return extension ? formatSet.has(extension) : false\n  }\n}\n\nfunction filterByBaseModels(models: string[]) {\n  return (asset: AssetItem) => {\n    if (models.length === 0) return true\n    const modelSet = new Set(models)\n    const baseModel = getAssetBaseModel(asset)\n    return baseModel ? modelSet.has(baseModel) : false\n  }\n}\n\nfunction filterByOwnership(ownership: OwnershipOption) {\n  return (asset: AssetItem) => {\n    if (ownership === 'all') return true\n    if (ownership === 'my-models') return asset.is_immutable === false\n    if (ownership === 'public-models') return asset.is_immutable === true\n    return true\n  }\n}\n\ntype AssetBadge = {\n  label: string\n  type: 'type' | 'base' | 'size'\n}\n\n// Display properties for transformed assets\nexport interface AssetDisplayItem extends AssetItem {\n  description: string\n  badges: AssetBadge[]\n  stats: {\n    formattedDate?: string\n    downloadCount?: string\n    stars?: string\n  }\n}\n\n/**\n * Asset Browser composable\n * Manages search, filtering, asset transformation and selection logic\n */\nexport function useAssetBrowser(\n  assetsSource: Ref<AssetItem[] | undefined> = ref<AssetItem[] | undefined>([])\n) {\n  const assets = computed<AssetItem[]>(() => assetsSource.value ?? [])\n  // State\n  const searchQuery = ref('')\n  const selectedCategory = ref('all')\n  const filters = ref<FilterState>({\n    sortBy: 'recent',\n    fileFormats: [],\n    baseModels: [],\n    ownership: 'all'\n  })\n\n  // Transform API asset to display asset\n  function transformAssetForDisplay(asset: AssetItem): AssetDisplayItem {\n    // Extract description from metadata or create from tags\n    const typeTag = asset.tags.find((tag) => tag !== 'models')\n    const description =\n      getAssetDescription(asset) ||\n      `${typeTag || t('assetBrowser.unknown')} model`\n\n    // Create badges from tags and metadata\n    const badges: AssetBadge[] = []\n\n    // Type badge from non-root tag\n    if (typeTag) {\n      // Remove category prefix from badge label (e.g. \"checkpoint/model\"  \"model\")\n      const badgeLabel = typeTag.includes('/')\n        ? typeTag.substring(typeTag.indexOf('/') + 1)\n        : typeTag\n\n      badges.push({ label: badgeLabel, type: 'type' })\n    }\n\n    // Base model badge from metadata\n    const baseModel = getAssetBaseModel(asset)\n    if (baseModel) {\n      badges.push({\n        label: baseModel,\n        type: 'base'\n      })\n    }\n\n    // Create display stats from API data\n    const stats = {\n      formattedDate: d(new Date(asset.created_at), { dateStyle: 'short' }),\n      downloadCount: undefined, // Not available in API\n      stars: undefined // Not available in API\n    }\n\n    return {\n      ...asset,\n      description,\n      badges,\n      stats\n    }\n  }\n\n  const availableCategories = computed(() => {\n    const categories = assets.value\n      .filter((asset) => asset.tags[0] === 'models')\n      .map((asset) => asset.tags[1])\n      .filter((tag): tag is string => typeof tag === 'string' && tag.length > 0)\n      .map((tag) => tag.split('/')[0]) // Extract top-level folder name\n\n    const uniqueCategories = Array.from(new Set(categories))\n      .sort()\n      .map((category) => ({\n        id: category,\n        label: category.charAt(0).toUpperCase() + category.slice(1),\n        icon: 'icon-[lucide--package]'\n      }))\n\n    return [\n      {\n        id: 'all',\n        label: t('assetBrowser.allModels'),\n        icon: 'icon-[lucide--folder]'\n      },\n      ...uniqueCategories\n    ]\n  })\n\n  // Compute content title from selected category\n  const contentTitle = computed(() => {\n    if (selectedCategory.value === 'all') {\n      return t('assetBrowser.allModels')\n    }\n\n    const category = availableCategories.value.find(\n      (cat) => cat.id === selectedCategory.value\n    )\n    return category?.label || t('assetBrowser.assets')\n  })\n\n  // Category-filtered assets for filter options (before search/format/base model filters)\n  const categoryFilteredAssets = computed(() => {\n    return assets.value.filter(filterByCategory(selectedCategory.value))\n  })\n\n  const fuseOptions: UseFuseOptions<AssetItem> = {\n    fuseOptions: {\n      keys: [\n        { name: 'name', weight: 0.4 },\n        { name: 'tags', weight: 0.3 }\n      ],\n      threshold: 0.4, // Higher threshold for typo tolerance (0.0 = exact, 1.0 = match all)\n      ignoreLocation: true, // Search anywhere in the string, not just at the beginning\n      includeScore: true\n    },\n    matchAllWhenSearchEmpty: true\n  }\n\n  const { results: fuseResults } = useFuse(\n    searchQuery,\n    categoryFilteredAssets,\n    fuseOptions\n  )\n\n  const searchFiltered = computed(() =>\n    fuseResults.value.map((result) => result.item)\n  )\n\n  const filteredAssets = computed(() => {\n    const filtered = searchFiltered.value\n      .filter(filterByFileFormats(filters.value.fileFormats))\n      .filter(filterByBaseModels(filters.value.baseModels))\n      .filter(filterByOwnership(filters.value.ownership))\n\n    const sortedAssets = [...filtered]\n    sortedAssets.sort((a, b) => {\n      switch (filters.value.sortBy) {\n        case 'name-desc':\n          return b.name.localeCompare(a.name)\n        case 'recent':\n          return (\n            new Date(b.created_at).getTime() - new Date(a.created_at).getTime()\n          )\n        case 'popular':\n          return a.name.localeCompare(b.name)\n        case 'name-asc':\n        default:\n          return a.name.localeCompare(b.name)\n      }\n    })\n\n    // Transform to display format\n    return sortedAssets.map(transformAssetForDisplay)\n  })\n\n  function updateFilters(newFilters: FilterState) {\n    filters.value = { ...newFilters }\n  }\n\n  return {\n    searchQuery,\n    selectedCategory,\n    availableCategories,\n    contentTitle,\n    categoryFilteredAssets,\n    filteredAssets,\n    updateFilters\n  }\n}\n","const ACRONYM_TAGS = new Set(['VAE', 'CLIP', 'GLIGEN'])\n\nexport function formatCategoryLabel(raw?: string): string {\n  if (!raw) return 'Models'\n\n  // Special display name mappings\n  if (raw === 'diffusion_models') return 'Diffusion'\n\n  return raw\n    .split('_')\n    .map((segment) => {\n      const upper = segment.toUpperCase()\n      if (ACRONYM_TAGS.has(upper)) return upper\n\n      const lower = segment.toLowerCase()\n      return lower.charAt(0).toUpperCase() + lower.slice(1)\n    })\n    .join(' ')\n}\n","<template>\n  <BaseModalLayout\n    data-component-id=\"AssetBrowserModal\"\n    class=\"size-full max-h-full max-w-full min-w-0\"\n    :content-title=\"displayTitle\"\n    @close=\"handleClose\"\n  >\n    <template v-if=\"shouldShowLeftPanel\" #leftPanel>\n      <LeftSidePanel\n        v-model=\"selectedCategory\"\n        data-component-id=\"AssetBrowserModal-LeftSidePanel\"\n        :nav-items=\"availableCategories\"\n      >\n        <template #header-icon>\n          <div class=\"icon-[lucide--folder] size-4\" />\n        </template>\n        <template #header-title>\n          <span class=\"capitalize\">{{ displayTitle }}</span>\n        </template>\n      </LeftSidePanel>\n    </template>\n\n    <template #header>\n      <div class=\"flex w-full items-center justify-between gap-2\">\n        <SearchBox\n          v-model=\"searchQuery\"\n          :autofocus=\"true\"\n          size=\"lg\"\n          :placeholder=\"$t('g.searchPlaceholder')\"\n          class=\"max-w-96\"\n        />\n        <Button\n          v-if=\"isUploadButtonEnabled\"\n          variant=\"primary\"\n          :size=\"breakpoints.md ? 'lg' : 'icon'\"\n          data-attr=\"upload-model-button\"\n          @click=\"showUploadDialog\"\n        >\n          <i class=\"icon-[lucide--folder-input]\" />\n          <span class=\"hidden md:inline\">{{\n            $t('assetBrowser.uploadModel')\n          }}</span>\n        </Button>\n      </div>\n    </template>\n\n    <template #contentFilter>\n      <AssetFilterBar\n        :assets=\"categoryFilteredAssets\"\n        :all-assets=\"fetchedAssets\"\n        @filter-change=\"updateFilters\"\n      />\n    </template>\n\n    <template #content>\n      <AssetGrid\n        :assets=\"filteredAssets\"\n        :loading=\"isLoading\"\n        @asset-select=\"handleAssetSelectAndEmit\"\n      />\n    </template>\n  </BaseModalLayout>\n</template>\n\n<script setup lang=\"ts\">\nimport { breakpointsTailwind, useBreakpoints } from '@vueuse/core'\nimport { computed, provide } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport SearchBox from '@/components/common/SearchBox.vue'\nimport Button from '@/components/ui/button/Button.vue'\nimport BaseModalLayout from '@/components/widget/layout/BaseModalLayout.vue'\nimport LeftSidePanel from '@/components/widget/panel/LeftSidePanel.vue'\nimport AssetFilterBar from '@/platform/assets/components/AssetFilterBar.vue'\nimport AssetGrid from '@/platform/assets/components/AssetGrid.vue'\nimport type { AssetDisplayItem } from '@/platform/assets/composables/useAssetBrowser'\nimport { useAssetBrowser } from '@/platform/assets/composables/useAssetBrowser'\nimport { useModelUpload } from '@/platform/assets/composables/useModelUpload'\nimport type { AssetItem } from '@/platform/assets/schemas/assetSchema'\nimport { formatCategoryLabel } from '@/platform/assets/utils/categoryLabel'\nimport { useAssetsStore } from '@/stores/assetsStore'\nimport { useModelToNodeStore } from '@/stores/modelToNodeStore'\nimport { OnCloseKey } from '@/types/widgetTypes'\n\nconst { t } = useI18n()\nconst assetStore = useAssetsStore()\nconst modelToNodeStore = useModelToNodeStore()\nconst breakpoints = useBreakpoints(breakpointsTailwind)\n\nconst props = defineProps<{\n  nodeType?: string\n  assetType?: string\n  onSelect?: (asset: AssetItem) => void\n  onClose?: () => void\n  showLeftPanel?: boolean\n  title?: string\n}>()\n\nconst emit = defineEmits<{\n  'asset-select': [asset: AssetDisplayItem]\n  close: []\n}>()\n\nprovide(OnCloseKey, props.onClose ?? (() => {}))\n\n// Compute the cache key based on nodeType or assetType\nconst cacheKey = computed(() => {\n  if (props.nodeType) return props.nodeType\n  if (props.assetType) return `tag:${props.assetType}`\n  return ''\n})\n\n// Read directly from store cache - reactive to any store updates\nconst fetchedAssets = computed(\n  () => assetStore.modelAssetsByNodeType.get(cacheKey.value) ?? []\n)\n\nconst isStoreLoading = computed(\n  () => assetStore.modelLoadingByNodeType.get(cacheKey.value) ?? false\n)\n\n// Only show loading spinner when loading AND no cached data\nconst isLoading = computed(\n  () => isStoreLoading.value && fetchedAssets.value.length === 0\n)\n\nasync function refreshAssets(): Promise<AssetItem[]> {\n  if (props.nodeType) {\n    return await assetStore.updateModelsForNodeType(props.nodeType)\n  }\n  if (props.assetType) {\n    return await assetStore.updateModelsForTag(props.assetType)\n  }\n  return []\n}\n\n// Trigger background refresh on mount\nvoid refreshAssets()\n\nconst { isUploadButtonEnabled, showUploadDialog } =\n  useModelUpload(refreshAssets)\n\nconst {\n  searchQuery,\n  selectedCategory,\n  availableCategories,\n  categoryFilteredAssets,\n  filteredAssets,\n  updateFilters\n} = useAssetBrowser(fetchedAssets)\n\nconst primaryCategoryTag = computed(() => {\n  const assets = fetchedAssets.value ?? []\n  const tagFromAssets = assets\n    .map((asset) => asset.tags?.find((tag) => tag !== 'models'))\n    .find((tag): tag is string => typeof tag === 'string' && tag.length > 0)\n\n  if (tagFromAssets) return tagFromAssets\n\n  if (props.nodeType) {\n    const mapped = modelToNodeStore.getCategoryForNodeType(props.nodeType)\n    if (mapped) return mapped\n  }\n\n  if (props.assetType) return props.assetType\n\n  return 'models'\n})\n\nconst activeCategoryTag = computed(() => {\n  if (selectedCategory.value !== 'all') {\n    return selectedCategory.value\n  }\n  return primaryCategoryTag.value\n})\n\nconst displayTitle = computed(() => {\n  if (props.title) return props.title\n\n  const label = formatCategoryLabel(activeCategoryTag.value)\n  return t('assetBrowser.allCategory', { category: label })\n})\n\nconst shouldShowLeftPanel = computed(() => {\n  return props.showLeftPanel ?? true\n})\n\nfunction handleClose() {\n  props.onClose?.()\n  emit('close')\n}\n\nfunction handleAssetSelectAndEmit(asset: AssetDisplayItem) {\n  emit('asset-select', asset)\n  // onSelect callback is provided by dialog composable layer\n  // It handles the appropriate transformation (filename extraction or full asset)\n  props.onSelect?.(asset)\n}\n</script>\n","import AssetBrowserModal from '@/platform/assets/components/AssetBrowserModal.vue'\nimport type { AssetItem } from '@/platform/assets/schemas/assetSchema'\nimport { useDialogStore } from '@/stores/dialogStore'\nimport type { DialogComponentProps } from '@/stores/dialogStore'\n\ninterface ShowOptions {\n  /** ComfyUI node type for context (e.g., 'CheckpointLoaderSimple') */\n  nodeType: string\n  /** Widget input name (e.g., 'ckpt_name') */\n  inputName: string\n  /** Current selected asset value */\n  currentValue?: string\n  onAssetSelected?: (asset: AssetItem) => void\n}\n\ninterface BrowseOptions {\n  /** Asset type tag to filter by (e.g., 'models') */\n  assetType: string\n  /** Custom modal title (optional) */\n  title?: string\n  /** Called when asset selected */\n  onAssetSelected?: (asset: AssetItem) => void\n}\n\nconst dialogComponentProps: DialogComponentProps = {\n  headless: true,\n  modal: true,\n  closable: true,\n  pt: {\n    root: {\n      class: 'rounded-2xl overflow-hidden asset-browser-dialog'\n    },\n    header: {\n      class: '!p-0 hidden'\n    },\n    content: {\n      class: '!p-0 !m-0 h-full w-full'\n    }\n  }\n} as const\n\nexport const useAssetBrowserDialog = () => {\n  const dialogStore = useDialogStore()\n  const dialogKey = 'global-asset-browser'\n\n  async function show(props: ShowOptions) {\n    const handleAssetSelected = (asset: AssetItem) => {\n      props.onAssetSelected?.(asset)\n      dialogStore.closeDialog({ key: dialogKey })\n    }\n\n    dialogStore.showDialog({\n      key: dialogKey,\n      component: AssetBrowserModal,\n      props: {\n        nodeType: props.nodeType,\n        inputName: props.inputName,\n        currentValue: props.currentValue,\n        onSelect: handleAssetSelected,\n        onClose: () => dialogStore.closeDialog({ key: dialogKey })\n      },\n      dialogComponentProps\n    })\n  }\n\n  async function browse(options: BrowseOptions): Promise<void> {\n    const handleAssetSelected = (asset: AssetItem) => {\n      options.onAssetSelected?.(asset)\n      dialogStore.closeDialog({ key: dialogKey })\n    }\n\n    dialogStore.showDialog({\n      key: dialogKey,\n      component: AssetBrowserModal,\n      props: {\n        showLeftPanel: true,\n        assetType: options.assetType,\n        title: options.title,\n        onSelect: handleAssetSelected,\n        onClose: () => dialogStore.closeDialog({ key: dialogKey })\n      },\n      dialogComponentProps\n    })\n  }\n\n  return { show, browse }\n}\n","<template>\n  <!-- Icon-only mode with Popover -->\n  <div\n    v-if=\"displayMode === 'icon-only'\"\n    class=\"relative inline-flex h-full shrink-0 items-center justify-center px-2\"\n    :class=\"clickableClasses\"\n    :style=\"menuBackgroundStyle\"\n    @click=\"togglePopover\"\n  >\n    <i\n      v-if=\"iconClass\"\n      :class=\"['shrink-0 text-base', iconClass, iconColorClass]\"\n    />\n    <div\n      v-else-if=\"badge.label\"\n      class=\"shrink-0 rounded-full px-1.5 py-0.5 text-xxxs font-semibold\"\n      :class=\"labelClasses\"\n    >\n      {{ badge.label }}\n    </div>\n    <div v-else class=\"size-2 shrink-0 rounded-full\" :class=\"dotClasses\" />\n    <Popover\n      ref=\"popover\"\n      append-to=\"body\"\n      :auto-z-index=\"true\"\n      :base-z-index=\"1000\"\n      :dismissable=\"true\"\n      :close-on-escape=\"true\"\n      unstyled\n      :pt=\"popoverPt\"\n    >\n      <div class=\"flex max-w-xs min-w-40 flex-col gap-2 p-3\">\n        <div\n          v-if=\"badge.label\"\n          class=\"w-fit rounded-full px-1.5 py-0.5 text-xxxs font-semibold\"\n          :class=\"labelClasses\"\n        >\n          {{ badge.label }}\n        </div>\n        <div class=\"text-sm font-inter\">{{ badge.text }}</div>\n        <div v-if=\"badge.tooltip\" class=\"text-xs\">\n          {{ badge.tooltip }}\n        </div>\n      </div>\n    </Popover>\n  </div>\n\n  <!-- Compact mode: Icon + Label only with Popover -->\n  <div\n    v-else-if=\"displayMode === 'compact'\"\n    class=\"relative inline-flex h-full\"\n    :style=\"menuBackgroundStyle\"\n  >\n    <div\n      class=\"flex h-full shrink-0 items-center gap-2 whitespace-nowrap\"\n      :class=\"[\n        { 'flex-row-reverse': reverseOrder },\n        noPadding ? '' : 'px-3',\n        clickableClasses\n      ]\"\n      @click=\"togglePopover\"\n    >\n      <i\n        v-if=\"iconClass\"\n        :class=\"['shrink-0 text-base', iconClass, iconColorClass]\"\n      />\n      <div\n        v-if=\"badge.label\"\n        class=\"shrink-0 rounded-full px-1.5 py-0.5 text-xxxs font-semibold\"\n        :class=\"labelClasses\"\n      >\n        {{ badge.label }}\n      </div>\n    </div>\n    <Popover\n      ref=\"popover\"\n      append-to=\"body\"\n      :auto-z-index=\"true\"\n      :base-z-index=\"1000\"\n      :dismissable=\"true\"\n      :close-on-escape=\"true\"\n      unstyled\n      :pt=\"popoverPt\"\n    >\n      <div class=\"flex max-w-xs min-w-40 flex-col gap-2 p-3\">\n        <div\n          v-if=\"badge.label\"\n          class=\"w-fit rounded-full px-1.5 py-0.5 text-xxxs font-semibold\"\n          :class=\"labelClasses\"\n        >\n          {{ badge.label }}\n        </div>\n        <div class=\"text-sm font-inter\">{{ badge.text }}</div>\n        <div v-if=\"badge.tooltip\" class=\"text-xs\">\n          {{ badge.tooltip }}\n        </div>\n      </div>\n    </Popover>\n  </div>\n\n  <!-- Full mode: Icon + Label + Text -->\n  <div\n    v-else\n    v-tooltip=\"badge.tooltip\"\n    class=\"flex h-full shrink-0 items-center gap-2 whitespace-nowrap\"\n    :class=\"[{ 'flex-row-reverse': reverseOrder }, noPadding ? '' : 'px-3']\"\n    :style=\"menuBackgroundStyle\"\n  >\n    <i\n      v-if=\"iconClass\"\n      :class=\"['shrink-0 text-base', iconClass, iconColorClass]\"\n    />\n    <div\n      v-if=\"badge.label\"\n      class=\"shrink-0 rounded-full px-1.5 py-0.5 text-xxxs font-semibold\"\n      :class=\"labelClasses\"\n    >\n      {{ badge.label }}\n    </div>\n    <div class=\"font-inter text-sm\" :class=\"textClasses\">\n      {{ badge.text }}\n    </div>\n  </div>\n</template>\n<script setup lang=\"ts\">\nimport Popover from 'primevue/popover'\nimport { computed, ref } from 'vue'\n\nimport type { TopbarBadge } from '@/types/comfy'\nimport { cn } from '@/utils/tailwindUtil'\n\nconst props = withDefaults(\n  defineProps<{\n    badge: TopbarBadge\n    displayMode?: 'full' | 'compact' | 'icon-only'\n    reverseOrder?: boolean\n    noPadding?: boolean\n    backgroundColor?: string\n  }>(),\n  {\n    displayMode: 'full',\n    reverseOrder: false,\n    noPadding: false,\n    backgroundColor: 'var(--comfy-menu-bg)'\n  }\n)\n\nconst popover = ref<InstanceType<typeof Popover>>()\n\nconst togglePopover = (event: Event) => {\n  popover.value?.toggle(event)\n}\n\nconst variant = computed(() => props.badge.variant ?? 'info')\n\nconst menuBackgroundStyle = computed(() => ({\n  backgroundColor: props.backgroundColor\n}))\n\nconst labelClasses = computed(() => {\n  switch (variant.value) {\n    case 'error':\n      return 'bg-danger-100 text-white'\n    case 'warning':\n      return 'bg-gold-600 text-black'\n    case 'info':\n    default:\n      return 'bg-white text-black'\n  }\n})\n\nconst textClasses = computed(() => {\n  switch (variant.value) {\n    case 'error':\n      return 'text-danger-100'\n    case 'warning':\n      return 'text-warning-background'\n    case 'info':\n    default:\n      return 'text-text-primary'\n  }\n})\n\nconst iconColorClass = computed(() => textClasses.value)\n\nconst iconClass = computed(() => {\n  if (props.badge.icon) {\n    return props.badge.icon\n  }\n  switch (variant.value) {\n    case 'error':\n      return 'pi pi-exclamation-circle'\n    case 'warning':\n      return 'icon-[lucide--triangle-alert]'\n    case 'info':\n    default:\n      return undefined\n  }\n})\n\nconst clickableClasses = 'cursor-pointer transition-opacity hover:opacity-80'\n\nconst dotClasses = computed(() => {\n  switch (variant.value) {\n    case 'error':\n      return 'bg-danger-100'\n    case 'warning':\n      return 'bg-gold-600'\n    case 'info':\n    default:\n      return 'bg-slate-100'\n  }\n})\n\nconst popoverPt = computed(() => ({\n  root: {\n    class: cn('absolute z-50')\n  },\n  content: {\n    class: cn(\n      'mt-1 rounded-lg',\n      'bg-base-background',\n      'text-base-foreground',\n      'shadow-lg',\n      'border border-border-default'\n    )\n  }\n}))\n</script>\n","<template>\n  <Button\n    :size\n    :loading=\"isLoading\"\n    :disabled=\"isPolling\"\n    variant=\"primary\"\n    :style=\"\n      variant === 'gradient'\n        ? {\n            background: 'var(--color-subscription-button-gradient)',\n            color: 'var(--color-white)'\n          }\n        : undefined\n    \"\n    :class=\"cn('font-bold', fluid && 'w-full')\"\n    @click=\"handleSubscribe\"\n  >\n    {{ label || $t('subscription.required.subscribe') }}\n  </Button>\n</template>\n\n<script setup lang=\"ts\">\nimport { onBeforeUnmount, ref, watch } from 'vue'\n\nimport Button from '@/components/ui/button/Button.vue'\nimport { useSubscription } from '@/platform/cloud/subscription/composables/useSubscription'\nimport { isCloud } from '@/platform/distribution/types'\nimport { useTelemetry } from '@/platform/telemetry'\nimport { cn } from '@/utils/tailwindUtil'\n\nconst {\n  size = 'lg',\n  fluid = true,\n  variant = 'default',\n  label\n} = defineProps<{\n  label?: string\n  size?: 'sm' | 'lg'\n  variant?: 'default' | 'gradient'\n  fluid?: boolean\n}>()\n\nconst emit = defineEmits<{\n  subscribed: []\n}>()\n\nconst { subscribe, isActiveSubscription, fetchStatus, showSubscriptionDialog } =\n  useSubscription()\n\nconst telemetry = useTelemetry()\n\nconst isLoading = ref(false)\nconst isPolling = ref(false)\nlet pollInterval: number | null = null\nconst isAwaitingStripeSubscription = ref(false)\n\nconst POLL_INTERVAL_MS = 3000 // Poll every 3 seconds\nconst MAX_POLL_DURATION_MS = 5 * 60 * 1000 // Stop polling after 5 minutes\n\nconst startPollingSubscriptionStatus = () => {\n  isPolling.value = true\n  isLoading.value = true\n\n  const startTime = Date.now()\n\n  const poll = async () => {\n    try {\n      if (Date.now() - startTime > MAX_POLL_DURATION_MS) {\n        stopPolling()\n        return\n      }\n\n      await fetchStatus()\n\n      if (isActiveSubscription.value) {\n        stopPolling()\n        telemetry?.trackMonthlySubscriptionSucceeded()\n        emit('subscribed')\n      }\n    } catch (error) {\n      console.error(\n        '[SubscribeButton] Error polling subscription status:',\n        error\n      )\n    }\n  }\n\n  void poll()\n  pollInterval = window.setInterval(poll, POLL_INTERVAL_MS)\n}\n\nconst stopPolling = () => {\n  if (pollInterval) {\n    clearInterval(pollInterval)\n    pollInterval = null\n  }\n  isPolling.value = false\n  isLoading.value = false\n}\n\nwatch(\n  [isAwaitingStripeSubscription, isActiveSubscription],\n  ([awaiting, isActive]) => {\n    if (isCloud && awaiting && isActive) {\n      emit('subscribed')\n      isAwaitingStripeSubscription.value = false\n    }\n  }\n)\n\nconst handleSubscribe = async () => {\n  if (isCloud) {\n    useTelemetry()?.trackSubscription('subscribe_clicked')\n    isAwaitingStripeSubscription.value = true\n    showSubscriptionDialog()\n    return\n  }\n\n  isLoading.value = true\n  try {\n    await subscribe()\n\n    startPollingSubscriptionStatus()\n  } catch (error) {\n    console.error('[SubscribeButton] Error initiating subscription:', error)\n    isLoading.value = false\n  }\n}\n\nonBeforeUnmount(() => {\n  stopPolling()\n  isAwaitingStripeSubscription.value = false\n})\n</script>\n","import { defineAsyncComponent } from 'vue'\nimport { useDialogService } from '@/services/dialogService'\nimport { useDialogStore } from '@/stores/dialogStore'\n\nconst DIALOG_KEY = 'subscription-required'\n\nexport const useSubscriptionDialog = () => {\n  const dialogService = useDialogService()\n  const dialogStore = useDialogStore()\n\n  function hide() {\n    dialogStore.closeDialog({ key: DIALOG_KEY })\n  }\n\n  function show() {\n    dialogService.showLayoutDialog({\n      key: DIALOG_KEY,\n      component: defineAsyncComponent(\n        () =>\n          import('@/platform/cloud/subscription/components/SubscriptionRequiredDialogContent.vue')\n      ),\n      props: {\n        onClose: hide\n      },\n      dialogComponentProps: {\n        style: 'width: min(1328px, 95vw); max-height: 90vh;',\n        pt: {\n          root: {\n            class: 'rounded-2xl bg-transparent'\n          },\n          content: {\n            class:\n              '!p-0 rounded-2xl border border-border-default bg-base-background/60 backdrop-blur-md shadow-[0_25px_80px_rgba(5,6,12,0.45)]'\n          }\n        }\n      }\n    })\n  }\n\n  return {\n    show,\n    hide\n  }\n}\n","<template>\n  <Toast />\n</template>\n\n<script setup lang=\"ts\">\nimport Toast from 'primevue/toast'\nimport { useToast } from 'primevue/usetoast'\nimport { nextTick, watch } from 'vue'\n\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useToastStore } from '@/platform/updates/common/toastStore'\n\nconst toast = useToast()\nconst toastStore = useToastStore()\nconst settingStore = useSettingStore()\n\nwatch(\n  () => toastStore.messagesToAdd,\n  (newMessages) => {\n    if (newMessages.length === 0) {\n      return\n    }\n\n    newMessages.forEach((message) => {\n      toast.add(message)\n    })\n    toastStore.messagesToAdd = []\n  },\n  { deep: true }\n)\n\nwatch(\n  () => toastStore.messagesToRemove,\n  (messagesToRemove) => {\n    if (messagesToRemove.length === 0) {\n      return\n    }\n\n    messagesToRemove.forEach((message) => {\n      toast.remove(message)\n    })\n    toastStore.messagesToRemove = []\n  },\n  { deep: true }\n)\n\nwatch(\n  () => toastStore.removeAllRequested,\n  (requested) => {\n    if (requested) {\n      toast.removeAllGroups()\n      toastStore.removeAllRequested = false\n    }\n  }\n)\n\nfunction updateToastPosition() {\n  const styleElement =\n    document.getElementById('dynamic-toast-style') || createStyleElement()\n  const rect = document\n    .querySelector('.graph-canvas-container')\n    ?.getBoundingClientRect()\n  if (!rect) return\n\n  styleElement.textContent = `\n    .p-toast.p-component.p-toast-top-right {\n      top: ${rect.top + 100}px !important;\n      right: ${window.innerWidth - (rect.left + rect.width) + 20}px !important;\n       z-index: 10000 !important;\n    }\n  `\n}\n\nfunction createStyleElement() {\n  const style = document.createElement('style')\n  style.id = 'dynamic-toast-style'\n  document.head.appendChild(style)\n  return style\n}\n\nwatch(\n  () => settingStore.get('Comfy.UseNewMenu'),\n  () => nextTick(updateToastPosition),\n  { immediate: true }\n)\nwatch(\n  () => settingStore.get('Comfy.Sidebar.Location'),\n  () => nextTick(updateToastPosition),\n  { immediate: true }\n)\n</script>\n","/**\n * Cross-browser async utilities for scheduling tasks during browser idle time\n * with proper fallbacks for browsers that don't support requestIdleCallback.\n *\n * Implementation based on:\n * https://github.com/microsoft/vscode/blob/main/src/vs/base/common/async.ts\n */\n\ninterface IdleDeadline {\n  didTimeout: boolean\n  timeRemaining(): number\n}\n\ninterface IDisposable {\n  dispose(): void\n}\n\n/**\n * Internal implementation function that handles the actual scheduling logic.\n * Uses feature detection to determine whether to use native requestIdleCallback\n * or fall back to setTimeout-based implementation.\n */\nlet _runWhenIdle: (\n  targetWindow: any,\n  callback: (idle: IdleDeadline) => void,\n  timeout?: number\n) => IDisposable\n\n/**\n * Execute the callback during the next browser idle period.\n * Falls back to setTimeout-based scheduling in browsers without native support.\n */\nexport let runWhenGlobalIdle: (\n    callback: (idle: IdleDeadline) => void,\n    timeout?: number\n  ) => IDisposable\n\n  // Self-invoking function to set up the idle callback implementation\n;(function () {\n  const safeGlobal: any = globalThis\n\n  if (\n    typeof safeGlobal.requestIdleCallback !== 'function' ||\n    typeof safeGlobal.cancelIdleCallback !== 'function'\n  ) {\n    // Fallback implementation for browsers without native support (e.g., Safari)\n    _runWhenIdle = (_targetWindow, runner, _timeout?) => {\n      setTimeout(() => {\n        if (disposed) {\n          return\n        }\n\n        // Simulate IdleDeadline - give 15ms window (one frame at ~64fps)\n        const end = Date.now() + 15\n        const deadline: IdleDeadline = {\n          didTimeout: true,\n          timeRemaining() {\n            return Math.max(0, end - Date.now())\n          }\n        }\n\n        runner(Object.freeze(deadline))\n      })\n\n      let disposed = false\n      return {\n        dispose() {\n          if (disposed) {\n            return\n          }\n          disposed = true\n        }\n      }\n    }\n  } else {\n    // Native requestIdleCallback implementation\n    _runWhenIdle = (targetWindow: typeof safeGlobal, runner, timeout?) => {\n      const handle: number = targetWindow.requestIdleCallback(\n        runner,\n        typeof timeout === 'number' ? { timeout } : undefined\n      )\n\n      let disposed = false\n      return {\n        dispose() {\n          if (disposed) {\n            return\n          }\n          disposed = true\n          targetWindow.cancelIdleCallback(handle)\n        }\n      }\n    }\n  }\n\n  runWhenGlobalIdle = (runner, timeout) =>\n    _runWhenIdle(globalThis, runner, timeout)\n})()\n","<template>\n  <div\n    v-show=\"workspaceState.focusMode\"\n    class=\"fixed z-9999 flex flex-row no-drag top-0 right-0\"\n  >\n    <Button\n      v-tooltip=\"{ value: $t('menu.showMenu'), showDelay: 300 }\"\n      variant=\"muted-textonly\"\n      size=\"lg\"\n      :aria-label=\"$t('menu.showMenu')\"\n      aria-live=\"assertive\"\n      @click=\"exitFocusMode\"\n      @contextmenu=\"showNativeSystemMenu\"\n    >\n      <i class=\"pi pi-bars\" />\n    </Button>\n    <div class=\"window-actions-spacer\" />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { watchEffect } from 'vue'\n\nimport Button from '@/components/ui/button/Button.vue'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { app } from '@/scripts/app'\nimport { useWorkspaceStore } from '@/stores/workspaceStore'\nimport { showNativeSystemMenu } from '@/utils/envUtil'\n\nconst workspaceState = useWorkspaceStore()\nconst settingStore = useSettingStore()\nconst exitFocusMode = () => {\n  workspaceState.focusMode = false\n}\n\nwatchEffect(() => {\n  if (settingStore.get('Comfy.UseNewMenu') !== 'Disabled') {\n    return\n  }\n  if (workspaceState.focusMode) {\n    app.ui.menuContainer.style.display = 'none'\n  } else {\n    app.ui.menuContainer.style.display = 'block'\n  }\n})\n</script>\n","<template>\n  <div>\n    <!--\n    UnloadWindowConfirmDialog: This component does not render\n    anything visible. It is used to confirm the user wants to\n    close the window, and if they do, it will call the\n    beforeunload event.\n    -->\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { onBeforeUnmount, onMounted } from 'vue'\n\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\n\nconst settingStore = useSettingStore()\nconst workflowStore = useWorkflowStore()\n\nconst handleBeforeUnload = (event: BeforeUnloadEvent) => {\n  if (\n    settingStore.get('Comfy.Window.UnloadConfirmation') &&\n    workflowStore.modifiedWorkflows.length > 0\n  ) {\n    event.preventDefault()\n    return true\n  }\n  return undefined\n}\n\nonMounted(() => {\n  window.addEventListener('beforeunload', handleBeforeUnload)\n})\n\nonBeforeUnmount(() => {\n  window.removeEventListener('beforeunload', handleBeforeUnload)\n})\n</script>\n","<template>\n  <div\n    class=\"w-full h-full absolute top-0 left-0 z-999 pointer-events-none flex flex-col\"\n  >\n    <slot name=\"workflow-tabs\" />\n\n    <div\n      class=\"pointer-events-none flex flex-1 overflow-hidden\"\n      :class=\"{\n        'flex-row': sidebarLocation === 'left',\n        'flex-row-reverse': sidebarLocation === 'right'\n      }\"\n    >\n      <div class=\"side-toolbar-container\">\n        <slot name=\"side-toolbar\" />\n      </div>\n\n      <Splitter\n        :key=\"splitterRefreshKey\"\n        class=\"bg-transparent pointer-events-none border-none flex-1 overflow-hidden\"\n        :state-key=\"sidebarStateKey\"\n        state-storage=\"local\"\n        @resizestart=\"onResizestart\"\n      >\n        <!-- First panel: sidebar when left, properties when right -->\n        <SplitterPanel\n          v-if=\"\n            !focusMode && (sidebarLocation === 'left' || rightSidePanelVisible)\n          \"\n          :class=\"\n            sidebarLocation === 'left'\n              ? cn(\n                  'side-bar-panel bg-comfy-menu-bg pointer-events-auto',\n                  sidebarPanelVisible && 'min-w-78'\n                )\n              : 'bg-comfy-menu-bg pointer-events-auto'\n          \"\n          :min-size=\"sidebarLocation === 'left' ? 10 : 15\"\n          :size=\"20\"\n          :style=\"firstPanelStyle\"\n          :role=\"sidebarLocation === 'left' ? 'complementary' : undefined\"\n          :aria-label=\"\n            sidebarLocation === 'left' ? t('sideToolbar.sidebar') : undefined\n          \"\n        >\n          <slot\n            v-if=\"sidebarLocation === 'left' && sidebarPanelVisible\"\n            name=\"side-bar-panel\"\n          />\n          <slot\n            v-else-if=\"sidebarLocation === 'right'\"\n            name=\"right-side-panel\"\n          />\n        </SplitterPanel>\n\n        <!-- Main panel (always present) -->\n        <SplitterPanel :size=\"80\" class=\"flex flex-col\">\n          <slot name=\"topmenu\" :sidebar-panel-visible />\n\n          <Splitter\n            class=\"bg-transparent pointer-events-none border-none splitter-overlay-bottom mr-1 mb-1 ml-1 flex-1\"\n            layout=\"vertical\"\n            :pt:gutter=\"\n              cn(\n                'rounded-tl-lg rounded-tr-lg ',\n                !(bottomPanelVisible && !focusMode) && 'hidden'\n              )\n            \"\n            state-key=\"bottom-panel-splitter\"\n            state-storage=\"local\"\n            @resizestart=\"onResizestart\"\n          >\n            <SplitterPanel class=\"graph-canvas-panel relative\">\n              <slot name=\"graph-canvas-panel\" />\n            </SplitterPanel>\n            <SplitterPanel\n              v-show=\"bottomPanelVisible && !focusMode\"\n              class=\"bottom-panel border border-(--p-panel-border-color) max-w-full overflow-x-auto bg-comfy-menu-bg pointer-events-auto rounded-lg\"\n            >\n              <slot name=\"bottom-panel\" />\n            </SplitterPanel>\n          </Splitter>\n        </SplitterPanel>\n\n        <!-- Last panel: properties when left, sidebar when right -->\n        <SplitterPanel\n          v-if=\"\n            !focusMode && (sidebarLocation === 'right' || rightSidePanelVisible)\n          \"\n          :class=\"\n            sidebarLocation === 'right'\n              ? cn(\n                  'side-bar-panel bg-comfy-menu-bg pointer-events-auto',\n                  sidebarPanelVisible && 'min-w-78'\n                )\n              : 'bg-comfy-menu-bg pointer-events-auto'\n          \"\n          :min-size=\"sidebarLocation === 'right' ? 10 : 15\"\n          :size=\"20\"\n          :style=\"lastPanelStyle\"\n          :role=\"sidebarLocation === 'right' ? 'complementary' : undefined\"\n          :aria-label=\"\n            sidebarLocation === 'right' ? t('sideToolbar.sidebar') : undefined\n          \"\n        >\n          <slot v-if=\"sidebarLocation === 'left'\" name=\"right-side-panel\" />\n          <slot\n            v-else-if=\"sidebarLocation === 'right' && sidebarPanelVisible\"\n            name=\"side-bar-panel\"\n          />\n        </SplitterPanel>\n      </Splitter>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { cn } from '@comfyorg/tailwind-utils'\nimport { storeToRefs } from 'pinia'\nimport Splitter from 'primevue/splitter'\nimport type { SplitterResizeStartEvent } from 'primevue/splitter'\nimport SplitterPanel from 'primevue/splitterpanel'\nimport { computed } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useBottomPanelStore } from '@/stores/workspace/bottomPanelStore'\nimport { useRightSidePanelStore } from '@/stores/workspace/rightSidePanelStore'\nimport { useSidebarTabStore } from '@/stores/workspace/sidebarTabStore'\nimport { useWorkspaceStore } from '@/stores/workspaceStore'\n\nconst workspaceStore = useWorkspaceStore()\nconst settingStore = useSettingStore()\nconst rightSidePanelStore = useRightSidePanelStore()\nconst sidebarTabStore = useSidebarTabStore()\nconst { t } = useI18n()\nconst sidebarLocation = computed<'left' | 'right'>(() =>\n  settingStore.get('Comfy.Sidebar.Location')\n)\n\nconst unifiedWidth = computed(() =>\n  settingStore.get('Comfy.Sidebar.UnifiedWidth')\n)\n\nconst { focusMode } = storeToRefs(workspaceStore)\n\nconst { activeSidebarTabId, activeSidebarTab } = storeToRefs(sidebarTabStore)\nconst { bottomPanelVisible } = storeToRefs(useBottomPanelStore())\nconst { isOpen: rightSidePanelVisible } = storeToRefs(rightSidePanelStore)\n\nconst sidebarPanelVisible = computed(() => activeSidebarTab.value !== null)\n\nconst sidebarStateKey = computed(() => {\n  return unifiedWidth.value\n    ? 'unified-sidebar'\n    : // When no tab is active, use a default key to maintain state\n      (activeSidebarTabId.value ?? 'default-sidebar')\n})\n\n/**\n * Avoid triggering default behaviors during drag-and-drop, such as text selection.\n */\nfunction onResizestart({ originalEvent: event }: SplitterResizeStartEvent) {\n  event.preventDefault()\n}\n\n/*\n * Force refresh the splitter when right panel visibility or sidebar location changes\n * to recalculate the width and panel order\n */\nconst splitterRefreshKey = computed(() => {\n  return `main-splitter${rightSidePanelVisible.value ? '-with-right-panel' : ''}-${sidebarLocation.value}`\n})\n\nconst firstPanelStyle = computed(() => {\n  if (sidebarLocation.value === 'left') {\n    return { display: sidebarPanelVisible.value ? 'flex' : 'none' }\n  }\n  return undefined\n})\n\nconst lastPanelStyle = computed(() => {\n  if (sidebarLocation.value === 'right') {\n    return { display: sidebarPanelVisible.value ? 'flex' : 'none' }\n  }\n  return undefined\n})\n</script>\n\n<style scoped>\n:deep(.p-splitter-gutter) {\n  pointer-events: auto;\n}\n\n:deep(.p-splitter-gutter:hover),\n:deep(.p-splitter-gutter[data-p-gutter-resizing='true']) {\n  transition: background-color 0.2s ease 300ms;\n  background-color: var(--p-primary-color);\n}\n\n/* Hide sidebar gutter when sidebar is not visible */\n:deep(.side-bar-panel[style*='display: none'] + .p-splitter-gutter),\n:deep(.p-splitter-gutter + .side-bar-panel[style*='display: none']) {\n  display: none;\n}\n\n.splitter-overlay-bottom :deep(.p-splitter-gutter) {\n  transform: translateY(5px);\n}\n</style>\n","/**\n * Build a tooltip configuration object compatible with v-tooltip.\n * Consumers pass the translated text value.\n */\nexport const buildTooltipConfig = (value: string) => ({\n  value,\n  showDelay: 300,\n  hideDelay: 0,\n  pt: {\n    text: {\n      class:\n        'border-node-component-tooltip-border bg-node-component-tooltip-surface text-node-component-tooltip border rounded-md px-2 py-1 text-xs leading-none shadow-none'\n    },\n    arrow: {\n      class: 'border-t-node-component-tooltip-border'\n    }\n  }\n})\n","import { defineAsyncComponent } from 'vue'\n\nimport { isCloud } from '@/platform/distribution/types'\n\nexport default isCloud && window.__CONFIG__?.subscription_required\n  ? defineAsyncComponent(() => import('./CloudRunButtonWrapper.vue'))\n  : defineAsyncComponent(() => import('./ComfyQueueButton.vue'))\n","<template>\n  <div class=\"flex h-full items-center\">\n    <div\n      v-if=\"isDragging && !isDocked\"\n      :class=\"actionbarClass\"\n      @mouseenter=\"onMouseEnterDropZone\"\n      @mouseleave=\"onMouseLeaveDropZone\"\n    >\n      {{ t('actionbar.dockToTop') }}\n    </div>\n\n    <Panel\n      class=\"pointer-events-auto\"\n      :style=\"style\"\n      :class=\"panelClass\"\n      :pt=\"{\n        header: { class: 'hidden' },\n        content: { class: isDocked ? 'p-0' : 'p-1' }\n      }\"\n    >\n      <div ref=\"panelRef\" class=\"flex items-center select-none gap-2\">\n        <span\n          ref=\"dragHandleRef\"\n          :class=\"\n            cn(\n              'drag-handle cursor-grab w-3 h-max',\n              isDragging && 'cursor-grabbing'\n            )\n          \"\n        />\n        <Suspense @resolve=\"comfyRunButtonResolved\">\n          <ComfyRunButton />\n        </Suspense>\n        <Button\n          v-tooltip.bottom=\"cancelJobTooltipConfig\"\n          variant=\"destructive\"\n          size=\"icon\"\n          :disabled=\"isExecutionIdle\"\n          :aria-label=\"t('menu.interrupt')\"\n          @click=\"cancelCurrentJob\"\n        >\n          <i class=\"icon-[lucide--x] size-4\" />\n        </Button>\n      </div>\n    </Panel>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport {\n  useDraggable,\n  useEventListener,\n  useLocalStorage,\n  watchDebounced\n} from '@vueuse/core'\nimport { clamp } from 'es-toolkit/compat'\nimport { storeToRefs } from 'pinia'\nimport Panel from 'primevue/panel'\nimport { computed, nextTick, ref, watch } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport Button from '@/components/ui/button/Button.vue'\nimport { buildTooltipConfig } from '@/composables/useTooltipConfig'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useCommandStore } from '@/stores/commandStore'\nimport { useExecutionStore } from '@/stores/executionStore'\nimport { cn } from '@/utils/tailwindUtil'\n\nimport ComfyRunButton from './ComfyRunButton'\n\nconst settingsStore = useSettingStore()\nconst commandStore = useCommandStore()\nconst { t } = useI18n()\nconst { isIdle: isExecutionIdle } = storeToRefs(useExecutionStore())\n\nconst position = computed(() => settingsStore.get('Comfy.UseNewMenu'))\nconst visible = computed(() => position.value !== 'Disabled')\n\nconst tabContainer = document.querySelector('.workflow-tabs-container')\nconst panelRef = ref<HTMLElement | null>(null)\nconst dragHandleRef = ref<HTMLElement | null>(null)\nconst isDocked = useLocalStorage('Comfy.MenuPosition.Docked', true)\nconst storedPosition = useLocalStorage('Comfy.MenuPosition.Floating', {\n  x: 0,\n  y: 0\n})\nconst { x, y, style, isDragging } = useDraggable(panelRef, {\n  initialValue: { x: 0, y: 0 },\n  handle: dragHandleRef,\n  containerElement: document.body,\n  onMove: (event) => {\n    // Prevent dragging the menu over the top of the tabs\n    const minY = tabContainer?.getBoundingClientRect().bottom ?? 40\n    if (event.y < minY) {\n      event.y = minY\n    }\n  }\n})\n\n// Update storedPosition when x or y changes\nwatchDebounced(\n  [x, y],\n  ([newX, newY]) => {\n    storedPosition.value = { x: newX, y: newY }\n  },\n  { debounce: 300 }\n)\n\n// Set initial position to bottom center\nconst setInitialPosition = () => {\n  if (panelRef.value) {\n    const screenWidth = window.innerWidth\n    const screenHeight = window.innerHeight\n    const menuWidth = panelRef.value.offsetWidth\n    const menuHeight = panelRef.value.offsetHeight\n\n    if (menuWidth === 0 || menuHeight === 0) {\n      return\n    }\n\n    // Check if stored position exists and is within bounds\n    if (storedPosition.value.x !== 0 || storedPosition.value.y !== 0) {\n      // Ensure stored position is within screen bounds\n      x.value = clamp(storedPosition.value.x, 0, screenWidth - menuWidth)\n      y.value = clamp(storedPosition.value.y, 0, screenHeight - menuHeight)\n      captureLastDragState()\n      return\n    }\n\n    // If no stored position or current position, set to bottom center\n    if (x.value === 0 && y.value === 0) {\n      x.value = clamp((screenWidth - menuWidth) / 2, 0, screenWidth - menuWidth)\n      y.value = clamp(\n        screenHeight - menuHeight - 10,\n        0,\n        screenHeight - menuHeight\n      )\n      captureLastDragState()\n    }\n  }\n}\n\n//The ComfyRunButton is a dynamic import. Which means it will not be loaded onMount in this component.\n//So we must use suspense resolve to ensure that is has loaded and updated the DOM before calling setInitialPosition()\nasync function comfyRunButtonResolved() {\n  await nextTick()\n  setInitialPosition()\n}\n\nwatch(visible, async (newVisible) => {\n  if (newVisible) {\n    await nextTick(setInitialPosition)\n  }\n})\n\n/**\n * Track run button handle drag start using mousedown on the drag handle.\n */\nuseEventListener(dragHandleRef, 'mousedown', () => {\n  useTelemetry()?.trackUiButtonClicked({\n    button_id: 'actionbar_run_handle_drag_start'\n  })\n})\n\nconst lastDragState = ref({\n  x: x.value,\n  y: y.value,\n  windowWidth: window.innerWidth,\n  windowHeight: window.innerHeight\n})\nconst captureLastDragState = () => {\n  lastDragState.value = {\n    x: x.value,\n    y: y.value,\n    windowWidth: window.innerWidth,\n    windowHeight: window.innerHeight\n  }\n}\nwatch(\n  isDragging,\n  (newIsDragging) => {\n    if (!newIsDragging) {\n      // Stop dragging\n      captureLastDragState()\n    }\n  },\n  { immediate: true }\n)\n\nconst adjustMenuPosition = () => {\n  if (panelRef.value) {\n    const screenWidth = window.innerWidth\n    const screenHeight = window.innerHeight\n    const menuWidth = panelRef.value.offsetWidth\n    const menuHeight = panelRef.value.offsetHeight\n\n    // Calculate distances to all edges\n    const distanceLeft = lastDragState.value.x\n    const distanceRight =\n      lastDragState.value.windowWidth - (lastDragState.value.x + menuWidth)\n    const distanceTop = lastDragState.value.y\n    const distanceBottom =\n      lastDragState.value.windowHeight - (lastDragState.value.y + menuHeight)\n\n    // Find the smallest distance to determine which edge to anchor to\n    const distances = [\n      { edge: 'left', distance: distanceLeft },\n      { edge: 'right', distance: distanceRight },\n      { edge: 'top', distance: distanceTop },\n      { edge: 'bottom', distance: distanceBottom }\n    ]\n    const closestEdge = distances.reduce((min, curr) =>\n      curr.distance < min.distance ? curr : min\n    )\n\n    // Calculate vertical position as a percentage of screen height\n    const verticalRatio =\n      lastDragState.value.y / lastDragState.value.windowHeight\n    const horizontalRatio =\n      lastDragState.value.x / lastDragState.value.windowWidth\n\n    // Apply positioning based on closest edge\n    if (closestEdge.edge === 'left') {\n      x.value = closestEdge.distance // Maintain exact distance from left\n      y.value = verticalRatio * screenHeight\n    } else if (closestEdge.edge === 'right') {\n      x.value = screenWidth - menuWidth - closestEdge.distance // Maintain exact distance from right\n      y.value = verticalRatio * screenHeight\n    } else if (closestEdge.edge === 'top') {\n      x.value = horizontalRatio * screenWidth\n      y.value = closestEdge.distance // Maintain exact distance from top\n    } else {\n      // bottom\n      x.value = horizontalRatio * screenWidth\n      y.value = screenHeight - menuHeight - closestEdge.distance // Maintain exact distance from bottom\n    }\n\n    // Ensure the menu stays within the screen bounds\n    x.value = clamp(x.value, 0, screenWidth - menuWidth)\n    y.value = clamp(y.value, 0, screenHeight - menuHeight)\n  }\n}\n\nuseEventListener(window, 'resize', adjustMenuPosition)\n\n// Drop zone state\nconst isMouseOverDropZone = ref(false)\n\n// Mouse event handlers for self-contained drop zone\nconst onMouseEnterDropZone = () => {\n  if (isDragging.value) {\n    isMouseOverDropZone.value = true\n  }\n}\n\nconst onMouseLeaveDropZone = () => {\n  if (isDragging.value) {\n    isMouseOverDropZone.value = false\n  }\n}\n\n// Handle drag state changes\nwatch(isDragging, (dragging) => {\n  if (dragging) {\n    // Starting to drag - undock if docked\n    if (isDocked.value) {\n      isDocked.value = false\n    }\n  } else {\n    // Stopped dragging - dock if mouse is over drop zone\n    if (isMouseOverDropZone.value) {\n      isDocked.value = true\n    }\n    // Reset drop zone state\n    isMouseOverDropZone.value = false\n  }\n})\n\nconst cancelJobTooltipConfig = computed(() =>\n  buildTooltipConfig(t('menu.interrupt'))\n)\n\nconst cancelCurrentJob = async () => {\n  if (isExecutionIdle.value) return\n  await commandStore.execute('Comfy.Interrupt')\n}\n\nconst actionbarClass = computed(() =>\n  cn(\n    'w-[200px] border-dashed border-blue-500 opacity-80',\n    'm-1.5 flex items-center justify-center self-stretch',\n    'rounded-md before:w-50 before:-ml-50 before:h-full',\n    'pointer-events-auto',\n    isMouseOverDropZone.value &&\n      'border-[3px] opacity-100 scale-105 shadow-[0_0_20px] shadow-blue-500'\n  )\n)\nconst panelClass = computed(() =>\n  cn(\n    'actionbar pointer-events-auto z-1300',\n    isDragging.value && 'select-none pointer-events-none',\n    isDocked.value\n      ? 'p-0 static border-none bg-transparent'\n      : 'fixed shadow-interface'\n  )\n)\n</script>\n","import { unref } from 'vue'\nimport type { MaybeRef } from 'vue'\n\nimport type {\n  LGraph,\n  LGraphNode,\n  Subgraph\n} from '@/lib/litegraph/src/litegraph'\nimport type { ComfyNodeDefImpl } from '@/stores/nodeDefStore'\nimport { collectAllNodes } from '@/utils/graphTraversalUtil'\n\nexport type NodeDefLookup = Record<string, ComfyNodeDefImpl | undefined>\n\nconst isNodeMissingDefinition = (\n  node: LGraphNode,\n  nodeDefsByName: NodeDefLookup\n) => {\n  const nodeName = node?.type\n  if (!nodeName) return false\n  return !nodeDefsByName[nodeName]\n}\n\nexport const collectMissingNodes = (\n  graph: LGraph | Subgraph | null | undefined,\n  nodeDefsByName: MaybeRef<NodeDefLookup>\n): LGraphNode[] => {\n  if (!graph) return []\n  const lookup = unref(nodeDefsByName)\n  return collectAllNodes(graph, (node) => isNodeMissingDefinition(node, lookup))\n}\n\nexport const graphHasMissingNodes = (\n  graph: LGraph | Subgraph | null | undefined,\n  nodeDefsByName: MaybeRef<NodeDefLookup>\n) => {\n  return collectMissingNodes(graph, nodeDefsByName).length > 0\n}\n","<template>\n  <a\n    ref=\"wrapperRef\"\n    v-tooltip.bottom=\"{\n      value: tooltipText,\n      showDelay: 512\n    }\"\n    draggable=\"false\"\n    href=\"#\"\n    class=\"p-breadcrumb-item-link h-12 cursor-pointer px-2\"\n    :class=\"{\n      'flex items-center gap-1': isActive,\n      'p-breadcrumb-item-link-menu-visible': menu?.overlayVisible,\n      'p-breadcrumb-item-link-icon-visible': isActive,\n      'active-breadcrumb-item': isActive\n    }\"\n    @click=\"handleClick\"\n  >\n    <i\n      v-if=\"hasMissingNodes && isRoot\"\n      class=\"icon-[lucide--triangle-alert] text-warning-background\"\n    />\n    <span class=\"p-breadcrumb-item-label px-2\">{{ item.label }}</span>\n    <Tag v-if=\"item.isBlueprint\" value=\"Blueprint\" severity=\"primary\" />\n    <i v-if=\"isActive\" class=\"pi pi-angle-down text-[10px]\"></i>\n  </a>\n  <Menu\n    v-if=\"isActive\"\n    ref=\"menu\"\n    :model=\"menuItems\"\n    :popup=\"true\"\n    :pt=\"{\n      root: {\n        style: 'background-color: var(--comfy-menu-bg)'\n      },\n      itemLink: {\n        class: 'py-2'\n      }\n    }\"\n  />\n  <InputText\n    v-if=\"isEditing\"\n    ref=\"itemInputRef\"\n    v-model=\"itemLabel\"\n    class=\"fixed z-10000 px-2 py-2 text-[.8rem]\"\n    @blur=\"inputBlur(false)\"\n    @click.stop\n    @keydown.enter=\"inputBlur(true)\"\n    @keydown.esc=\"inputBlur(false)\"\n  />\n</template>\n\n<script setup lang=\"ts\">\nimport InputText from 'primevue/inputtext'\nimport type { MenuState } from 'primevue/menu'\nimport Menu from 'primevue/menu'\nimport type { MenuItem } from 'primevue/menuitem'\nimport Tag from 'primevue/tag'\nimport { computed, nextTick, ref } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport { useWorkflowService } from '@/platform/workflow/core/services/workflowService'\nimport {\n  ComfyWorkflow,\n  useWorkflowStore\n} from '@/platform/workflow/management/stores/workflowStore'\nimport { app } from '@/scripts/app'\nimport { useDialogService } from '@/services/dialogService'\nimport { useCommandStore } from '@/stores/commandStore'\nimport { useNodeDefStore } from '@/stores/nodeDefStore'\nimport { useSubgraphNavigationStore } from '@/stores/subgraphNavigationStore'\nimport { appendJsonExt } from '@/utils/formatUtil'\nimport { graphHasMissingNodes } from '@/workbench/extensions/manager/utils/graphHasMissingNodes'\n\ninterface Props {\n  item: MenuItem\n  isActive?: boolean\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  isActive: false\n})\n\nconst nodeDefStore = useNodeDefStore()\nconst hasMissingNodes = computed(() =>\n  graphHasMissingNodes(app.rootGraph, nodeDefStore.nodeDefsByName)\n)\n\nconst { t } = useI18n()\nconst menu = ref<InstanceType<typeof Menu> & MenuState>()\nconst dialogService = useDialogService()\nconst workflowStore = useWorkflowStore()\nconst workflowService = useWorkflowService()\nconst isEditing = ref(false)\nconst itemLabel = ref<string>()\nconst itemInputRef = ref<{ $el?: HTMLInputElement }>()\nconst wrapperRef = ref<HTMLAnchorElement>()\n\nconst rename = async (\n  newName: string | null | undefined,\n  initialName: string\n) => {\n  if (newName && newName !== initialName) {\n    // Synchronize the node titles with the new name\n    props.item.updateTitle?.(newName)\n\n    if (workflowStore.activeSubgraph) {\n      workflowStore.activeSubgraph.name = newName\n    } else if (workflowStore.activeWorkflow) {\n      try {\n        await workflowService.renameWorkflow(\n          workflowStore.activeWorkflow,\n          ComfyWorkflow.basePath + appendJsonExt(newName)\n        )\n      } catch (error) {\n        console.error(error)\n        dialogService.showErrorDialog(error)\n        return\n      }\n    }\n\n    // Force the navigation stack to recompute the labels\n    // TODO: investigate if there is a better way to do this\n    const navigationStore = useSubgraphNavigationStore()\n    navigationStore.restoreState(navigationStore.exportState())\n  }\n}\n\nconst isRoot = props.item.key === 'root'\n\nconst tooltipText = computed(() => {\n  if (hasMissingNodes.value && isRoot) {\n    return t('breadcrumbsMenu.missingNodesWarning')\n  }\n  return props.item.label\n})\n\nconst menuItems = computed<MenuItem[]>(() => {\n  return [\n    {\n      label: t('g.rename'),\n      icon: 'pi pi-pencil',\n      command: startRename\n    },\n    {\n      label: t('breadcrumbsMenu.duplicate'),\n      icon: 'pi pi-copy',\n      command: async () => {\n        await workflowService.duplicateWorkflow(workflowStore.activeWorkflow!)\n      },\n      visible: isRoot && !props.item.isBlueprint\n    },\n    {\n      separator: true,\n      visible: isRoot\n    },\n    {\n      label: t('menuLabels.Save'),\n      icon: 'pi pi-save',\n      command: async () => {\n        await useCommandStore().execute('Comfy.SaveWorkflow')\n      },\n      visible: isRoot\n    },\n    {\n      label: t('menuLabels.Save As'),\n      icon: 'pi pi-save',\n      command: async () => {\n        await useCommandStore().execute('Comfy.SaveWorkflowAs')\n      },\n      visible: isRoot\n    },\n    {\n      separator: true\n    },\n    {\n      label: t('breadcrumbsMenu.clearWorkflow'),\n      icon: 'pi pi-trash',\n      command: async () => {\n        await useCommandStore().execute('Comfy.ClearWorkflow')\n      }\n    },\n    {\n      separator: true,\n      visible: props.item.key === 'root' && props.item.isBlueprint\n    },\n    {\n      label: t('subgraphStore.publish'),\n      icon: 'pi pi-copy',\n      command: async () => {\n        await workflowService.saveWorkflowAs(workflowStore.activeWorkflow!)\n      },\n      visible: props.item.key === 'root' && props.item.isBlueprint\n    },\n    {\n      separator: true,\n      visible: isRoot\n    },\n    {\n      label: props.item.isBlueprint\n        ? t('breadcrumbsMenu.deleteBlueprint')\n        : t('breadcrumbsMenu.deleteWorkflow'),\n      icon: 'pi pi-times',\n      command: async () => {\n        await workflowService.deleteWorkflow(workflowStore.activeWorkflow!)\n      },\n      visible: isRoot\n    }\n  ]\n})\n\nconst handleClick = (event: MouseEvent) => {\n  if (isEditing.value) {\n    return\n  }\n\n  if (event.detail === 1) {\n    if (props.isActive) {\n      menu.value?.toggle(event)\n    } else {\n      props.item.command?.({ item: props.item, originalEvent: event })\n    }\n  } else if (props.isActive && event.detail === 2) {\n    menu.value?.hide()\n    event.stopPropagation()\n    event.preventDefault()\n    startRename()\n  }\n}\n\nconst startRename = () => {\n  isEditing.value = true\n  itemLabel.value = props.item.label as string\n  void nextTick(() => {\n    if (itemInputRef.value?.$el) {\n      itemInputRef.value.$el.focus()\n      itemInputRef.value.$el.select()\n      if (wrapperRef.value) {\n        itemInputRef.value.$el.style.width = `${Math.max(200, wrapperRef.value.offsetWidth)}px`\n      }\n    }\n  })\n}\n\nconst inputBlur = async (doRename: boolean) => {\n  if (doRename) {\n    await rename(itemLabel.value, props.item.label as string)\n  }\n\n  isEditing.value = false\n}\n</script>\n\n<style scoped>\n@reference '../../assets/css/style.css';\n\n.p-breadcrumb-item-link,\n.p-breadcrumb-item-icon {\n  @apply select-none;\n}\n\n.p-breadcrumb-item-link {\n  @apply overflow-hidden;\n}\n\n.p-breadcrumb-item-label {\n  @apply whitespace-nowrap text-ellipsis overflow-hidden;\n}\n\n.active-breadcrumb-item {\n  color: var(--text-primary);\n}\n</style>\n","import { useMutationObserver, useResizeObserver } from '@vueuse/core'\nimport { debounce } from 'es-toolkit/compat'\nimport { readonly, ref } from 'vue'\n\n/**\n * Observes an element for overflow changes and optionally debounces the check\n * @param element - The element to observe\n * @param options - The options for the observer\n * @param options.debounceTime - The time to debounce the check in milliseconds\n * @param options.useMutationObserver - Whether to use a mutation observer to check for overflow\n * @param options.useResizeObserver - Whether to use a resize observer to check for overflow\n * @returns An object containing the isOverflowing state and the checkOverflow function to manually trigger\n */\nexport const useOverflowObserver = (\n  element: HTMLElement,\n  options?: {\n    debounceTime?: number\n    useMutationObserver?: boolean\n    useResizeObserver?: boolean\n    onCheck?: (isOverflowing: boolean) => void\n  }\n) => {\n  options = {\n    debounceTime: 25,\n    useMutationObserver: true,\n    useResizeObserver: true,\n    ...options\n  }\n\n  const isOverflowing = ref(false)\n  const disposeFns: (() => void)[] = []\n  const disposed = ref(false)\n\n  const checkOverflowFn = () => {\n    isOverflowing.value = element.scrollWidth > element.clientWidth\n    options.onCheck?.(isOverflowing.value)\n  }\n\n  const checkOverflow = options.debounceTime\n    ? debounce(checkOverflowFn, options.debounceTime)\n    : checkOverflowFn\n\n  if (options.useMutationObserver) {\n    disposeFns.push(\n      useMutationObserver(element, checkOverflow, {\n        subtree: true,\n        childList: true\n      }).stop\n    )\n  }\n  if (options.useResizeObserver) {\n    disposeFns.push(useResizeObserver(element, checkOverflow).stop)\n  }\n\n  return {\n    isOverflowing: readonly(isOverflowing),\n    disposed: readonly(disposed),\n    checkOverflow,\n    dispose: () => {\n      disposed.value = true\n      disposeFns.forEach((fn) => fn())\n    }\n  }\n}\n","<template>\n  <div\n    class=\"subgraph-breadcrumb w-auto drop-shadow-[var(--interface-panel-drop-shadow)]\"\n    :class=\"{\n      'subgraph-breadcrumb-collapse': collapseTabs,\n      'subgraph-breadcrumb-overflow': overflowingTabs\n    }\"\n    :style=\"{\n      '--p-breadcrumb-gap': `0px`,\n      '--p-breadcrumb-item-margin': `${ITEM_GAP / 2}px`,\n      '--p-breadcrumb-item-min-width': `${MIN_WIDTH}px`,\n      '--p-breadcrumb-item-padding': `${ITEM_PADDING}px`,\n      '--p-breadcrumb-icon-width': `${ICON_WIDTH}px`\n    }\"\n  >\n    <Breadcrumb\n      ref=\"breadcrumbRef\"\n      class=\"w-fit rounded-lg p-0\"\n      :model=\"items\"\n      :pt=\"{ item: { class: 'pointer-events-auto' } }\"\n      :aria-label=\"$t('g.graphNavigation')\"\n    >\n      <template #item=\"{ item }\">\n        <SubgraphBreadcrumbItem\n          :item=\"item\"\n          :is-active=\"item === items.at(-1)\"\n        />\n      </template>\n      <template #separator\n        ><span style=\"transform: scale(1.5)\"> / </span></template\n      >\n    </Breadcrumb>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport Breadcrumb from 'primevue/breadcrumb'\nimport type { MenuItem } from 'primevue/menuitem'\nimport { computed, onUpdated, ref, watch } from 'vue'\n\nimport SubgraphBreadcrumbItem from '@/components/breadcrumb/SubgraphBreadcrumbItem.vue'\nimport { useOverflowObserver } from '@/composables/element/useOverflowObserver'\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useSubgraphNavigationStore } from '@/stores/subgraphNavigationStore'\nimport { useSubgraphStore } from '@/stores/subgraphStore'\nimport { forEachSubgraphNode } from '@/utils/graphTraversalUtil'\n\nconst MIN_WIDTH = 28\nconst ITEM_GAP = 8\nconst ITEM_PADDING = 8\nconst ICON_WIDTH = 20\n\nconst workflowStore = useWorkflowStore()\nconst navigationStore = useSubgraphNavigationStore()\nconst breadcrumbRef = ref<InstanceType<typeof Breadcrumb>>()\nconst workflowName = computed(() => workflowStore.activeWorkflow?.filename)\nconst isBlueprint = computed(() =>\n  useSubgraphStore().isSubgraphBlueprint(workflowStore.activeWorkflow)\n)\nconst collapseTabs = ref(false)\nconst overflowingTabs = ref(false)\n\nconst breadcrumbElement = computed(() => {\n  if (!breadcrumbRef.value) return null\n\n  const el = (breadcrumbRef.value as unknown as { $el: HTMLElement }).$el\n  const list = el?.querySelector('.p-breadcrumb-list') as HTMLElement\n  return list\n})\n\nconst items = computed(() => {\n  const items = navigationStore.navigationStack.map<MenuItem>((subgraph) => ({\n    label: subgraph.name,\n    command: () => {\n      useTelemetry()?.trackUiButtonClicked({\n        button_id: 'breadcrumb_subgraph_item_selected'\n      })\n      const canvas = useCanvasStore().getCanvas()\n      if (!canvas.graph) throw new TypeError('Canvas has no graph')\n\n      canvas.setGraph(subgraph)\n    },\n    updateTitle: (title: string) => {\n      const rootGraph = useCanvasStore().getCanvas().graph?.rootGraph\n      if (!rootGraph) return\n\n      forEachSubgraphNode(rootGraph, subgraph.id, (node) => {\n        node.title = title\n      })\n    }\n  }))\n\n  return [home.value, ...items]\n})\n\nconst home = computed(() => ({\n  label: workflowName.value,\n  icon: 'pi pi-home',\n  key: 'root',\n  isBlueprint: isBlueprint.value,\n  command: () => {\n    useTelemetry()?.trackUiButtonClicked({\n      button_id: 'breadcrumb_subgraph_root_selected'\n    })\n    const canvas = useCanvasStore().getCanvas()\n    if (!canvas.graph) throw new TypeError('Canvas has no graph')\n\n    canvas.setGraph(canvas.graph.rootGraph)\n  }\n}))\n\n// Check for overflow on breadcrumb items and collapse/expand the breadcrumb to fit\nlet overflowObserver: ReturnType<typeof useOverflowObserver> | undefined\nwatch(breadcrumbElement, (el) => {\n  overflowObserver?.dispose()\n  overflowObserver = undefined\n\n  if (!el) return\n\n  overflowObserver = useOverflowObserver(el, {\n    onCheck: (isOverflowing) => {\n      overflowingTabs.value = isOverflowing\n\n      if (collapseTabs.value) {\n        // Items are currently hidden, check if we can show them\n        if (!isOverflowing) {\n          const items = [\n            ...el.querySelectorAll('.p-breadcrumb-item')\n          ] as HTMLElement[]\n\n          if (items.length < 3) return\n\n          const itemsWithIcon = items.filter((item) =>\n            item.querySelector('.p-breadcrumb-item-link-icon-visible')\n          ).length\n          const separators = el.querySelectorAll(\n            '.p-breadcrumb-separator'\n          ) as NodeListOf<HTMLElement>\n          const separator = separators[separators.length - 1] as HTMLElement\n          const separatorWidth = separator.offsetWidth\n\n          // items + separators + gaps + icons\n          const itemsWidth =\n            (MIN_WIDTH + ITEM_PADDING + ITEM_PADDING) * items.length +\n            itemsWithIcon * ICON_WIDTH\n          const separatorsWidth = (items.length - 1) * separatorWidth\n          const gapsWidth = (items.length - 1) * (ITEM_GAP * 2)\n          const totalWidth = itemsWidth + separatorsWidth + gapsWidth\n          const containerWidth = el.clientWidth\n\n          if (totalWidth <= containerWidth) {\n            collapseTabs.value = false\n          }\n        }\n      } else if (isOverflowing) {\n        collapseTabs.value = true\n      }\n    }\n  })\n})\n\n// If e.g. the workflow name changes, we need to check the overflow again\nonUpdated(() => {\n  if (!overflowObserver?.disposed.value) {\n    overflowObserver?.checkOverflow()\n  }\n})\n</script>\n\n<style scoped>\n@reference '../../assets/css/style.css';\n\n.subgraph-breadcrumb:not(:empty) {\n  flex: auto;\n  flex-shrink: 10000;\n  min-width: 120px;\n}\n\n.subgraph-breadcrumb,\n:deep(.p-breadcrumb) {\n  @apply overflow-hidden;\n}\n\n:deep(.p-breadcrumb) {\n  width: 100%;\n  background-color: transparent;\n}\n\n:deep(.p-breadcrumb-item) {\n  @apply flex items-center overflow-hidden;\n  min-width: calc(var(--p-breadcrumb-item-min-width) + 1rem);\n  /* Collapse middle items first */\n  flex-shrink: 10000;\n}\n\n:deep(.p-breadcrumb-separator) {\n  display: flex;\n  padding: 0 var(--p-breadcrumb-item-margin);\n}\n\n:deep(.p-breadcrumb-item-link) {\n  padding: 0\n    calc(var(--p-breadcrumb-item-margin) + var(--p-breadcrumb-item-padding));\n}\n\n:deep(.p-breadcrumb-separator),\n:deep(.p-breadcrumb-item) {\n  @apply h-12;\n  border-top: 1px solid var(--interface-stroke);\n  border-bottom: 1px solid var(--interface-stroke);\n  background-color: var(--comfy-menu-bg);\n}\n\n:deep(.p-breadcrumb-item:has(.p-breadcrumb-item-link-icon-visible)) {\n  min-width: calc(var(--p-breadcrumb-item-min-width) + 1rem + 20px);\n}\n\n:deep(.p-breadcrumb-item:first-child) {\n  @apply rounded-l-lg;\n  /* Then collapse the root workflow */\n  flex-shrink: 5000;\n  border-left: 1px solid var(--interface-stroke);\n\n  .p-breadcrumb-item-link {\n    padding-left: var(--p-breadcrumb-item-padding);\n  }\n}\n\n:deep(.p-breadcrumb-item:last-child) {\n  @apply rounded-r-lg;\n  /* Then collapse the active item */\n  flex-shrink: 1;\n  border-right: 1px solid var(--interface-stroke);\n}\n\n:deep(.p-breadcrumb-item-link:hover),\n:deep(.p-breadcrumb-item-link-menu-visible) {\n  background-color: color-mix(\n    in srgb,\n    var(--fg-color) 10%,\n    var(--comfy-menu-bg)\n  ) !important;\n  color: var(--fg-color);\n}\n</style>\n\n<style>\n@reference '../../assets/css/style.css';\n\n.subgraph-breadcrumb-collapse .p-breadcrumb-list {\n  .p-breadcrumb-item,\n  .p-breadcrumb-separator {\n    @apply hidden;\n  }\n\n  .p-breadcrumb-item:nth-last-child(3),\n  .p-breadcrumb-separator:nth-last-child(2),\n  .p-breadcrumb-item:nth-last-child(1) {\n    @apply flex;\n  }\n}\n</style>\n","<template>\n  <div class=\"flex flex-col gap-3 p-2\">\n    <div class=\"flex flex-col gap-1\">\n      <div\n        class=\"relative h-2 w-full overflow-hidden rounded-full border border-interface-stroke bg-interface-panel-surface\"\n      >\n        <div\n          class=\"absolute inset-0 h-full rounded-full transition-[width]\"\n          :style=\"totalProgressStyle\"\n        />\n        <div\n          class=\"absolute inset-0 h-full rounded-full transition-[width]\"\n          :style=\"currentNodeProgressStyle\"\n        />\n      </div>\n      <div class=\"flex items-start justify-end gap-4 text-[12px] leading-none\">\n        <div class=\"flex items-center gap-1 text-text-primary opacity-90\">\n          <i18n-t keypath=\"sideToolbar.queueProgressOverlay.total\">\n            <template #percent>\n              <span class=\"font-bold\">{{ totalPercentFormatted }}</span>\n            </template>\n          </i18n-t>\n        </div>\n        <div class=\"flex items-center gap-1 text-text-secondary\">\n          <span>{{ t('sideToolbar.queueProgressOverlay.currentNode') }}</span>\n          <span class=\"inline-block max-w-[10rem] truncate\">{{\n            currentNodeName\n          }}</span>\n          <span class=\"flex items-center gap-1\">\n            <span>{{ currentNodePercentFormatted }}</span>\n          </span>\n        </div>\n      </div>\n    </div>\n\n    <div :class=\"bottomRowClass\">\n      <div class=\"flex items-center gap-4 text-[12px] text-text-primary\">\n        <div class=\"flex items-center gap-2\">\n          <span class=\"opacity-90\">\n            <span class=\"font-bold\">{{ runningCount }}</span>\n            <span class=\"ml-1\">{{\n              t('sideToolbar.queueProgressOverlay.running')\n            }}</span>\n          </span>\n          <Button\n            v-if=\"runningCount > 0\"\n            v-tooltip.top=\"cancelJobTooltip\"\n            variant=\"destructive\"\n            size=\"icon\"\n            :aria-label=\"t('sideToolbar.queueProgressOverlay.interruptAll')\"\n            @click=\"$emit('interruptAll')\"\n          >\n            <i\n              class=\"icon-[lucide--x] block size-4 leading-none text-text-primary\"\n            />\n          </Button>\n        </div>\n\n        <div class=\"flex items-center gap-2\">\n          <span class=\"opacity-90\">\n            <span class=\"font-bold\">{{ queuedCount }}</span>\n            <span class=\"ml-1\">{{\n              t('sideToolbar.queueProgressOverlay.queuedSuffix')\n            }}</span>\n          </span>\n          <Button\n            v-if=\"queuedCount > 0\"\n            v-tooltip.top=\"clearQueueTooltip\"\n            variant=\"destructive\"\n            size=\"icon\"\n            :aria-label=\"t('sideToolbar.queueProgressOverlay.clearQueued')\"\n            @click=\"$emit('clearQueued')\"\n          >\n            <i\n              class=\"icon-[lucide--list-x] block size-4 leading-none text-text-primary\"\n            />\n          </Button>\n        </div>\n      </div>\n\n      <Button\n        class=\"min-w-30 flex-1 px-2 py-0\"\n        variant=\"secondary\"\n        size=\"md\"\n        @click=\"$emit('viewAllJobs')\"\n      >\n        {{ t('sideToolbar.queueProgressOverlay.viewAllJobs') }}\n      </Button>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport Button from '@/components/ui/button/Button.vue'\nimport { buildTooltipConfig } from '@/composables/useTooltipConfig'\n\ndefineProps<{\n  totalProgressStyle: Record<string, string>\n  currentNodeProgressStyle: Record<string, string>\n  totalPercentFormatted: string\n  currentNodePercentFormatted: string\n  currentNodeName: string\n  runningCount: number\n  queuedCount: number\n  bottomRowClass: string\n}>()\n\ndefineEmits<{\n  (e: 'interruptAll'): void\n  (e: 'clearQueued'): void\n  (e: 'viewAllJobs'): void\n}>()\n\nconst { t } = useI18n()\nconst cancelJobTooltip = computed(() =>\n  buildTooltipConfig(t('sideToolbar.queueProgressOverlay.cancelJobTooltip'))\n)\nconst clearQueueTooltip = computed(() =>\n  buildTooltipConfig(t('sideToolbar.queueProgressOverlay.clearQueueTooltip'))\n)\n</script>\n","<template>\n  <Button\n    variant=\"secondary\"\n    size=\"lg\"\n    class=\"group w-full justify-between gap-3 p-1 text-left font-normal hover:cursor-pointer focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-background\"\n    :aria-label=\"props.ariaLabel\"\n    @click=\"emit('click', $event)\"\n  >\n    <span class=\"inline-flex items-center gap-2\">\n      <span v-if=\"props.mode === 'allFailed'\" class=\"inline-flex items-center\">\n        <i\n          class=\"ml-1 icon-[lucide--circle-alert] block size-4 leading-none text-destructive-background\"\n        />\n      </span>\n\n      <span class=\"inline-flex items-center gap-2\">\n        <span\n          v-if=\"props.mode !== 'allFailed'\"\n          class=\"relative inline-flex h-6 items-center\"\n        >\n          <span\n            v-for=\"(url, idx) in props.thumbnailUrls\"\n            :key=\"url + idx\"\n            class=\"inline-block h-6 w-6 overflow-hidden rounded-[6px] border-0 bg-secondary-background\"\n            :style=\"{ marginLeft: idx === 0 ? '0' : '-12px' }\"\n          >\n            <img\n              :src=\"url\"\n              :alt=\"$t('sideToolbar.queueProgressOverlay.preview')\"\n              class=\"h-full w-full object-cover\"\n            />\n          </span>\n        </span>\n\n        <span class=\"text-[14px] font-normal text-text-primary\">\n          <template v-if=\"props.mode === 'allSuccess'\">\n            <i18n-t\n              keypath=\"sideToolbar.queueProgressOverlay.jobsCompleted\"\n              :plural=\"props.completedCount\"\n            >\n              <template #count>\n                <span class=\"font-bold\">{{ props.completedCount }}</span>\n              </template>\n            </i18n-t>\n          </template>\n          <template v-else-if=\"props.mode === 'mixed'\">\n            <i18n-t\n              keypath=\"sideToolbar.queueProgressOverlay.jobsCompleted\"\n              :plural=\"props.completedCount\"\n            >\n              <template #count>\n                <span class=\"font-bold\">{{ props.completedCount }}</span>\n              </template>\n            </i18n-t>\n            <span>, </span>\n            <i18n-t\n              keypath=\"sideToolbar.queueProgressOverlay.jobsFailed\"\n              :plural=\"props.failedCount\"\n            >\n              <template #count>\n                <span class=\"font-bold\">{{ props.failedCount }}</span>\n              </template>\n            </i18n-t>\n          </template>\n          <template v-else>\n            <i18n-t\n              keypath=\"sideToolbar.queueProgressOverlay.jobsFailed\"\n              :plural=\"props.failedCount\"\n            >\n              <template #count>\n                <span class=\"font-bold\">{{ props.failedCount }}</span>\n              </template>\n            </i18n-t>\n          </template>\n        </span>\n      </span>\n    </span>\n\n    <span\n      class=\"flex items-center justify-center rounded p-1 text-text-secondary transition-colors duration-200 ease-in-out\"\n    >\n      <i class=\"icon-[lucide--chevron-down] block size-4 leading-none\" />\n    </span>\n  </Button>\n</template>\n\n<script setup lang=\"ts\">\nimport Button from '@/components/ui/button/Button.vue'\nimport type {\n  CompletionSummary,\n  CompletionSummaryMode\n} from '@/composables/queue/useCompletionSummary'\n\ntype Props = {\n  mode: CompletionSummaryMode\n  completedCount: CompletionSummary['completedCount']\n  failedCount: CompletionSummary['failedCount']\n  thumbnailUrls?: CompletionSummary['thumbnailUrls']\n  ariaLabel?: string\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  thumbnailUrls: () => []\n})\n\nconst emit = defineEmits<{\n  (e: 'click', event: MouseEvent): void\n}>()\n</script>\n","<template>\n  <div class=\"pointer-events-auto\">\n    <CompletionSummaryBanner\n      :mode=\"summary.mode\"\n      :completed-count=\"summary.completedCount\"\n      :failed-count=\"summary.failedCount\"\n      :thumbnail-urls=\"summary.thumbnailUrls\"\n      :aria-label=\"t('sideToolbar.queueProgressOverlay.expandCollapsedQueue')\"\n      @click=\"$emit('summaryClick')\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useI18n } from 'vue-i18n'\n\nimport CompletionSummaryBanner from '@/components/queue/CompletionSummaryBanner.vue'\nimport type { CompletionSummary } from '@/composables/queue/useCompletionSummary'\n\ndefineProps<{ summary: CompletionSummary }>()\n\ndefineEmits<{\n  (e: 'summaryClick'): void\n}>()\n\nconst { t } = useI18n()\n</script>\n","import { computed } from 'vue'\n\nimport { downloadFile } from '@/base/common/downloadUtil'\nimport type { JobListItem } from '@/composables/queue/useJobList'\nimport { useCopyToClipboard } from '@/composables/useCopyToClipboard'\nimport { st, t } from '@/i18n'\nimport { mapTaskOutputToAssetItem } from '@/platform/assets/composables/media/assetMappers'\nimport { useMediaAssetActions } from '@/platform/assets/composables/useMediaAssetActions'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useWorkflowService } from '@/platform/workflow/core/services/workflowService'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport type {\n  ExecutionErrorWsMessage,\n  ResultItem,\n  ResultItemType\n} from '@/schemas/apiSchema'\nimport { api } from '@/scripts/api'\nimport { downloadBlob } from '@/scripts/utils'\nimport { useDialogService } from '@/services/dialogService'\nimport { useLitegraphService } from '@/services/litegraphService'\nimport { useNodeDefStore } from '@/stores/nodeDefStore'\nimport { useQueueStore } from '@/stores/queueStore'\nimport type { ResultItemImpl, TaskItemImpl } from '@/stores/queueStore'\nimport { createAnnotatedPath } from '@/utils/createAnnotatedPath'\nimport { appendJsonExt } from '@/utils/formatUtil'\n\nexport type MenuEntry =\n  | {\n      kind?: 'item'\n      key: string\n      label: string\n      icon?: string\n      onClick?: () => void | Promise<void>\n    }\n  | { kind: 'divider'; key: string }\n\n/**\n * Provides job context menu entries and actions.\n *\n * @param currentMenuItem Getter for the currently targeted job list item\n * @param onInspectAsset Callback to trigger when inspecting a completed job's asset\n */\nexport function useJobMenu(\n  currentMenuItem: () => JobListItem | null,\n  onInspectAsset?: (item: JobListItem) => void\n) {\n  const workflowStore = useWorkflowStore()\n  const workflowService = useWorkflowService()\n  const queueStore = useQueueStore()\n  const { copyToClipboard } = useCopyToClipboard()\n  const litegraphService = useLitegraphService()\n  const nodeDefStore = useNodeDefStore()\n  const mediaAssetActions = useMediaAssetActions()\n\n  const openJobWorkflow = async () => {\n    const item = currentMenuItem()\n    if (!item) return\n    const data = item.taskRef?.workflow\n    if (!data) return\n    const filename = `Job ${item.id}.json`\n    const temp = workflowStore.createTemporary(filename, data)\n    await workflowService.openWorkflow(temp)\n  }\n\n  const copyJobId = async () => {\n    const item = currentMenuItem()\n    if (!item) return\n    await copyToClipboard(item.id)\n  }\n\n  const cancelJob = async () => {\n    const item = currentMenuItem()\n    if (!item) return\n    if (item.state === 'running' || item.state === 'initialization') {\n      await api.interrupt(item.id)\n    } else if (item.state === 'pending') {\n      await api.deleteItem('queue', item.id)\n    }\n    await queueStore.update()\n  }\n\n  const copyErrorMessage = async () => {\n    const item = currentMenuItem()\n    if (!item) return\n    const msgs = item.taskRef?.status?.messages as any[] | undefined\n    const err = msgs?.find((m: any) => m?.[0] === 'execution_error')?.[1] as\n      | ExecutionErrorWsMessage\n      | undefined\n    const message = err?.exception_message\n    if (message) await copyToClipboard(String(message))\n  }\n\n  const reportError = () => {\n    const item = currentMenuItem()\n    if (!item) return\n    const msgs = item.taskRef?.status?.messages as any[] | undefined\n    const err = msgs?.find((m: any) => m?.[0] === 'execution_error')?.[1] as\n      | ExecutionErrorWsMessage\n      | undefined\n    if (err) useDialogService().showExecutionErrorDialog(err)\n  }\n\n  // This is very magical only because it matches the respective backend implementation\n  // There is or will be a better way to do this\n  const addOutputLoaderNode = async () => {\n    const item = currentMenuItem()\n    if (!item) return\n    const result: ResultItemImpl | undefined = item.taskRef?.previewOutput\n    if (!result) return\n\n    let nodeType: 'LoadImage' | 'LoadVideo' | 'LoadAudio' | null = null\n    let widgetName: 'image' | 'file' | 'audio' | null = null\n    if (result.isImage) {\n      nodeType = 'LoadImage'\n      widgetName = 'image'\n    } else if (result.isVideo) {\n      nodeType = 'LoadVideo'\n      widgetName = 'file'\n    } else if (result.isAudio) {\n      nodeType = 'LoadAudio'\n      widgetName = 'audio'\n    }\n    if (!nodeType || !widgetName) return\n\n    const nodeDef = nodeDefStore.nodeDefsByName[nodeType]\n    if (!nodeDef) return\n    const node = litegraphService.addNodeOnGraph(nodeDef, {\n      pos: litegraphService.getCanvasCenter()\n    })\n\n    if (!node) return\n\n    const isResultItemType = (v: string | undefined): v is ResultItemType =>\n      v === 'input' || v === 'output' || v === 'temp'\n\n    const apiItem: ResultItem = {\n      filename: result.filename,\n      subfolder: result.subfolder,\n      type: isResultItemType(result.type) ? result.type : undefined\n    }\n\n    const annotated = createAnnotatedPath(apiItem, {\n      rootFolder: apiItem.type\n    })\n    const widget = node.widgets?.find((w) => w.name === widgetName)\n    if (widget) {\n      widget.value = annotated\n      widget.callback?.(annotated)\n    }\n    node.graph?.setDirtyCanvas(true, true)\n  }\n\n  /**\n   * Trigger a download of the job's previewable output asset.\n   */\n  const downloadPreviewAsset = () => {\n    const item = currentMenuItem()\n    if (!item) return\n    const result: ResultItemImpl | undefined = item.taskRef?.previewOutput\n    if (!result) return\n    downloadFile(result.url)\n  }\n\n  /**\n   * Export the workflow JSON attached to the job.\n   */\n  const exportJobWorkflow = async () => {\n    const item = currentMenuItem()\n    if (!item) return\n    const data = item.taskRef?.workflow\n    if (!data) return\n\n    const settingStore = useSettingStore()\n    let filename = `Job ${item.id}.json`\n\n    if (settingStore.get('Comfy.PromptFilename')) {\n      const input = await useDialogService().prompt({\n        title: t('workflowService.exportWorkflow'),\n        message: t('workflowService.enterFilename') + ':',\n        defaultValue: filename\n      })\n      if (!input) return\n      filename = appendJsonExt(input)\n    }\n\n    const json = JSON.stringify(data, null, 2)\n    const blob = new Blob([json], { type: 'application/json' })\n    downloadBlob(filename, blob)\n  }\n\n  const deleteJobAsset = async () => {\n    const item = currentMenuItem()\n    if (!item) return\n    const task = item.taskRef as TaskItemImpl | undefined\n    const preview = task?.previewOutput\n    if (!task || !preview) return\n\n    const asset = mapTaskOutputToAssetItem(task, preview)\n    const success = await mediaAssetActions.confirmDelete(asset)\n    if (success) {\n      await queueStore.update()\n    }\n  }\n\n  const removeFailedJob = async () => {\n    const task = currentMenuItem()?.taskRef as TaskItemImpl | undefined\n    if (!task) return\n    await queueStore.delete(task)\n  }\n\n  const jobMenuOpenWorkflowLabel = computed(() =>\n    st('queue.jobMenu.openAsWorkflowNewTab', 'Open as workflow in new tab')\n  )\n  const jobMenuOpenWorkflowFailedLabel = computed(() =>\n    st('queue.jobMenu.openWorkflowNewTab', 'Open workflow in new tab')\n  )\n  const jobMenuCopyJobIdLabel = computed(() =>\n    st('queue.jobMenu.copyJobId', 'Copy job ID')\n  )\n  const jobMenuCancelLabel = computed(() =>\n    st('queue.jobMenu.cancelJob', 'Cancel job')\n  )\n\n  const jobMenuEntries = computed<MenuEntry[]>(() => {\n    const item = currentMenuItem()\n    const state = item?.state\n    if (!state) return []\n    const hasDeletableAsset = !!item?.taskRef?.previewOutput\n    if (state === 'completed') {\n      return [\n        {\n          key: 'inspect-asset',\n          label: st('queue.jobMenu.inspectAsset', 'Inspect asset'),\n          icon: 'icon-[lucide--zoom-in]',\n          onClick: onInspectAsset\n            ? () => {\n                const item = currentMenuItem()\n                if (item) onInspectAsset(item)\n              }\n            : undefined\n        },\n        {\n          key: 'add-to-current',\n          label: st(\n            'queue.jobMenu.addToCurrentWorkflow',\n            'Add to current workflow'\n          ),\n          icon: 'icon-[comfy--node]',\n          onClick: addOutputLoaderNode\n        },\n        {\n          key: 'download',\n          label: st('queue.jobMenu.download', 'Download'),\n          icon: 'icon-[lucide--download]',\n          onClick: downloadPreviewAsset\n        },\n        { kind: 'divider', key: 'd1' },\n        {\n          key: 'open-workflow',\n          label: jobMenuOpenWorkflowLabel.value,\n          icon: 'icon-[comfy--workflow]',\n          onClick: openJobWorkflow\n        },\n        {\n          key: 'export-workflow',\n          label: st('queue.jobMenu.exportWorkflow', 'Export workflow'),\n          icon: 'icon-[comfy--file-output]',\n          onClick: exportJobWorkflow\n        },\n        { kind: 'divider', key: 'd2' },\n        {\n          key: 'copy-id',\n          label: jobMenuCopyJobIdLabel.value,\n          icon: 'icon-[lucide--copy]',\n          onClick: copyJobId\n        },\n        { kind: 'divider', key: 'd3' },\n        ...(hasDeletableAsset\n          ? [\n              {\n                key: 'delete',\n                label: st('queue.jobMenu.deleteAsset', 'Delete asset'),\n                icon: 'icon-[lucide--trash-2]',\n                onClick: deleteJobAsset\n              }\n            ]\n          : [])\n      ]\n    }\n    if (state === 'failed') {\n      return [\n        {\n          key: 'open-workflow',\n          label: jobMenuOpenWorkflowFailedLabel.value,\n          icon: 'icon-[comfy--workflow]',\n          onClick: openJobWorkflow\n        },\n        { kind: 'divider', key: 'd1' },\n        {\n          key: 'copy-id',\n          label: jobMenuCopyJobIdLabel.value,\n          icon: 'icon-[lucide--copy]',\n          onClick: copyJobId\n        },\n        {\n          key: 'copy-error',\n          label: st('queue.jobMenu.copyErrorMessage', 'Copy error message'),\n          icon: 'icon-[lucide--copy]',\n          onClick: copyErrorMessage\n        },\n        {\n          key: 'report-error',\n          label: st('queue.jobMenu.reportError', 'Report error'),\n          icon: 'icon-[lucide--message-circle-warning]',\n          onClick: reportError\n        },\n        { kind: 'divider', key: 'd2' },\n        {\n          key: 'delete',\n          label: st('queue.jobMenu.removeJob', 'Remove job'),\n          icon: 'icon-[lucide--circle-minus]',\n          onClick: removeFailedJob\n        }\n      ]\n    }\n    return [\n      {\n        key: 'open-workflow',\n        label: jobMenuOpenWorkflowLabel.value,\n        icon: 'icon-[comfy--workflow]',\n        onClick: openJobWorkflow\n      },\n      { kind: 'divider', key: 'd1' },\n      {\n        key: 'copy-id',\n        label: jobMenuCopyJobIdLabel.value,\n        icon: 'icon-[lucide--copy]',\n        onClick: copyJobId\n      },\n      { kind: 'divider', key: 'd2' },\n      {\n        key: 'cancel-job',\n        label: jobMenuCancelLabel.value,\n        icon: 'icon-[lucide--x]',\n        onClick: cancelJob\n      }\n    ]\n  })\n\n  return {\n    jobMenuEntries,\n    openJobWorkflow,\n    copyJobId,\n    cancelJob\n  }\n}\n","<template>\n  <div\n    class=\"flex h-12 items-center justify-between gap-2 border-b border-interface-stroke px-2\"\n  >\n    <div class=\"px-2 text-[14px] font-normal text-text-primary\">\n      <span>{{ headerTitle }}</span>\n      <span\n        v-if=\"showConcurrentIndicator\"\n        class=\"ml-4 inline-flex items-center gap-1 text-blue-100\"\n      >\n        <span class=\"inline-block size-2 rounded-full bg-blue-100\" />\n        <span>\n          <span class=\"font-bold\">{{ concurrentWorkflowCount }}</span>\n          <span class=\"ml-1\">{{\n            t('sideToolbar.queueProgressOverlay.running')\n          }}</span>\n        </span>\n      </span>\n    </div>\n    <div v-if=\"!isCloud\" class=\"flex items-center gap-1\">\n      <Button\n        v-tooltip.top=\"moreTooltipConfig\"\n        variant=\"textonly\"\n        size=\"icon\"\n        :aria-label=\"t('sideToolbar.queueProgressOverlay.moreOptions')\"\n        @click=\"onMoreClick\"\n      >\n        <i\n          class=\"icon-[lucide--more-horizontal] block size-4 leading-none text-text-secondary\"\n        />\n      </Button>\n      <Popover\n        ref=\"morePopoverRef\"\n        :dismissable=\"true\"\n        :close-on-escape=\"true\"\n        unstyled\n        :pt=\"{\n          root: { class: 'absolute z-50' },\n          content: {\n            class: [\n              'bg-transparent border-none p-0 pt-2 rounded-lg shadow-lg font-inter'\n            ]\n          }\n        }\"\n      >\n        <div\n          class=\"flex flex-col items-stretch rounded-lg border border-interface-stroke bg-interface-panel-surface px-2 py-3 font-inter\"\n        >\n          <Button\n            class=\"w-full justify-start\"\n            variant=\"textonly\"\n            size=\"sm\"\n            :aria-label=\"t('sideToolbar.queueProgressOverlay.clearHistory')\"\n            @click=\"onClearHistoryFromMenu\"\n          >\n            <i class=\"icon-[lucide--file-x-2] size-4 text-muted\" />\n            <span>{{\n              t('sideToolbar.queueProgressOverlay.clearHistory')\n            }}</span>\n          </Button>\n        </div>\n      </Popover>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport Popover from 'primevue/popover'\nimport type { PopoverMethods } from 'primevue/popover'\nimport { computed, ref } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport Button from '@/components/ui/button/Button.vue'\nimport { buildTooltipConfig } from '@/composables/useTooltipConfig'\nimport { isCloud } from '@/platform/distribution/types'\n\ndefineProps<{\n  headerTitle: string\n  showConcurrentIndicator: boolean\n  concurrentWorkflowCount: number\n}>()\n\nconst emit = defineEmits<{\n  (e: 'clearHistory'): void\n}>()\n\nconst { t } = useI18n()\n\nconst morePopoverRef = ref<PopoverMethods | null>(null)\nconst moreTooltipConfig = computed(() => buildTooltipConfig(t('g.more')))\n\nconst onMoreClick = (event: MouseEvent) => {\n  morePopoverRef.value?.toggle(event)\n}\nconst onClearHistoryFromMenu = () => {\n  morePopoverRef.value?.hide()\n  emit('clearHistory')\n}\n</script>\n","<template>\n  <Popover\n    ref=\"jobItemPopoverRef\"\n    :dismissable=\"true\"\n    :close-on-escape=\"true\"\n    unstyled\n    :pt=\"{\n      root: { class: 'absolute z-50' },\n      content: {\n        class: [\n          'bg-transparent border-none p-0 pt-2 rounded-lg shadow-lg font-inter'\n        ]\n      }\n    }\"\n  >\n    <div\n      class=\"flex min-w-[14rem] flex-col items-stretch rounded-lg border border-interface-stroke bg-interface-panel-surface px-2 py-3 font-inter\"\n    >\n      <template v-for=\"entry in entries\" :key=\"entry.key\">\n        <div v-if=\"entry.kind === 'divider'\" class=\"px-2 py-1\">\n          <div class=\"h-px bg-interface-stroke\" />\n        </div>\n        <Button\n          v-else\n          class=\"w-full justify-start bg-transparent\"\n          variant=\"textonly\"\n          size=\"sm\"\n          :aria-label=\"entry.label\"\n          @click=\"onEntry(entry)\"\n        >\n          <i\n            v-if=\"entry.icon\"\n            :class=\"[\n              entry.icon,\n              'block size-4 shrink-0 leading-none text-text-secondary'\n            ]\"\n          />\n          <span>{{ entry.label }}</span>\n        </Button>\n      </template>\n    </div>\n  </Popover>\n</template>\n\n<script setup lang=\"ts\">\nimport Popover from 'primevue/popover'\nimport { ref } from 'vue'\n\nimport Button from '@/components/ui/button/Button.vue'\nimport type { MenuEntry } from '@/composables/queue/useJobMenu'\n\ndefineProps<{ entries: MenuEntry[] }>()\n\nconst emit = defineEmits<{\n  (e: 'action', entry: MenuEntry): void\n}>()\n\nconst jobItemPopoverRef = ref<InstanceType<typeof Popover> | null>(null)\n\nfunction open(event: Event) {\n  if (jobItemPopoverRef.value) {\n    jobItemPopoverRef.value.toggle(event)\n  }\n}\n\nfunction hide() {\n  jobItemPopoverRef.value?.hide()\n}\n\nfunction onEntry(entry: MenuEntry) {\n  emit('action', entry)\n}\n\ndefineExpose({ open, hide })\n</script>\n","import { clamp } from 'es-toolkit/math'\n\n/**\n * Clamp a numeric value to an integer percent in the range [0, 100].\n *\n * @param value Numeric value expected to be a percentage (0-100)\n * @returns Integer percent between 0 and 100\n */\nexport const clampPercentInt = (value?: number): number => {\n  const v = Math.round(value ?? 0)\n  return clamp(v, 0, 100)\n}\n\n/**\n * Format a percentage (0-100) using the provided locale with 0 fraction digits.\n *\n * @param locale BCP-47 locale string\n * @param value0to100 Percent value in [0, 100]\n * @returns Localized percent string, e.g. \"42%\"\n */\nexport const formatPercent0 = (locale: string, value0to100: number): string => {\n  const v = clampPercentInt(value0to100)\n  return new Intl.NumberFormat(locale, {\n    style: 'percent',\n    maximumFractionDigits: 0\n  }).format((v || 0) / 100)\n}\n","import { computed } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport { useExecutionStore } from '@/stores/executionStore'\nimport { clampPercentInt, formatPercent0 } from '@/utils/numberUtil'\n\n/**\n * Queue progress composable exposing total/current node progress values and styles.\n */\nexport function useQueueProgress() {\n  const { locale } = useI18n()\n  const executionStore = useExecutionStore()\n\n  const totalPercent = computed(() =>\n    clampPercentInt(Math.round((executionStore.executionProgress ?? 0) * 100))\n  )\n\n  const totalPercentFormatted = computed(() =>\n    formatPercent0(locale.value, totalPercent.value)\n  )\n\n  const currentNodePercent = computed(() =>\n    clampPercentInt(\n      Math.round((executionStore.executingNodeProgress ?? 0) * 100)\n    )\n  )\n\n  const currentNodePercentFormatted = computed(() =>\n    formatPercent0(locale.value, currentNodePercent.value)\n  )\n\n  const totalProgressStyle = computed(() => ({\n    width: `${totalPercent.value}%`,\n    background: 'var(--color-interface-panel-job-progress-primary)'\n  }))\n\n  const currentNodeProgressStyle = computed(() => ({\n    width: `${currentNodePercent.value}%`,\n    background: 'var(--color-interface-panel-job-progress-secondary)'\n  }))\n\n  return {\n    totalPercent,\n    totalPercentFormatted,\n    currentNodePercent,\n    currentNodePercentFormatted,\n    totalProgressStyle,\n    currentNodeProgressStyle\n  }\n}\n","/**\n * Return a local date key in YYYY-MM-DD format for grouping.\n *\n * @param ts Unix timestamp in milliseconds\n * @returns Local date key string\n */\nexport const dateKey = (ts: number): string => {\n  const d = new Date(ts)\n  const y = d.getFullYear()\n  const m = String(d.getMonth() + 1).padStart(2, '0')\n  const day = String(d.getDate()).padStart(2, '0')\n  return `${y}-${m}-${day}`\n}\n\n/**\n * Check if a timestamp is on the same local day as today.\n *\n * @param ts Unix timestamp in milliseconds\n * @returns True if today\n */\nexport const isToday = (ts: number): boolean => {\n  const d = new Date(ts)\n  const now = new Date()\n  return (\n    d.getFullYear() === now.getFullYear() &&\n    d.getMonth() === now.getMonth() &&\n    d.getDate() === now.getDate()\n  )\n}\n\n/**\n * Check if a timestamp corresponds to yesterday in local time.\n *\n * @param ts Unix timestamp in milliseconds\n * @returns True if yesterday\n */\nexport const isYesterday = (ts: number): boolean => {\n  const d = new Date(ts)\n  const now = new Date()\n  const yest = new Date(now.getFullYear(), now.getMonth(), now.getDate() - 1)\n  return (\n    d.getFullYear() === yest.getFullYear() &&\n    d.getMonth() === yest.getMonth() &&\n    d.getDate() === yest.getDate()\n  )\n}\n\n/**\n * Localized short month + day label, e.g. \"Jan 2\".\n *\n * @param ts Unix timestamp in milliseconds\n * @param locale BCP-47 locale string\n * @returns Localized month/day label\n */\nexport const formatShortMonthDay = (ts: number, locale: string): string => {\n  const d = new Date(ts)\n  return new Intl.DateTimeFormat(locale, {\n    month: 'short',\n    day: 'numeric'\n  }).format(d)\n}\n\n/**\n * Localized clock time, e.g. \"10:05:06\" with locale defaults for 12/24 hour.\n *\n * @param ts Unix timestamp in milliseconds\n * @param locale BCP-47 locale string\n * @returns Localized time string\n */\nexport const formatClockTime = (ts: number, locale: string): string => {\n  const d = new Date(ts)\n  return new Intl.DateTimeFormat(locale, {\n    hour: 'numeric',\n    minute: '2-digit',\n    second: '2-digit'\n  }).format(d)\n}\n","import type { TaskItemImpl } from '@/stores/queueStore'\nimport type { JobState } from '@/types/queue'\nimport { formatDuration } from '@/utils/formatUtil'\nimport { clampPercentInt, formatPercent0 } from '@/utils/numberUtil'\n\nexport type BuildJobDisplayCtx = {\n  t: (k: string, v?: Record<string, any>) => string\n  locale: string\n  formatClockTimeFn: (ts: number, locale: string) => string\n  isActive: boolean\n  totalPercent?: number\n  currentNodePercent?: number\n  currentNodeName?: string\n  showAddedHint?: boolean\n  /** Whether the app is running in cloud distribution */\n  isCloud?: boolean\n}\n\ntype JobDisplay = {\n  iconName: string\n  iconImageUrl?: string\n  primary: string\n  secondary: string\n  showClear: boolean\n}\n\nexport const iconForJobState = (state: JobState): string => {\n  switch (state) {\n    case 'pending':\n      return 'icon-[lucide--loader-circle]'\n    case 'initialization':\n      return 'icon-[lucide--server-crash]'\n    case 'running':\n      return 'icon-[lucide--zap]'\n    case 'completed':\n      return 'icon-[lucide--check-check]'\n    case 'failed':\n      return 'icon-[lucide--alert-circle]'\n    default:\n      return 'icon-[lucide--circle]'\n  }\n}\n\nconst buildTitle = (task: TaskItemImpl, t: (k: string) => string): string => {\n  const prefix = t('g.job')\n  const shortId = String(task.promptId ?? '').split('-')[0]\n  const idx = task.queueIndex\n  if (typeof idx === 'number') return `${prefix} #${idx}`\n  if (shortId) return `${prefix} ${shortId}`\n  return prefix\n}\n\nconst buildQueuedTime = (\n  task: TaskItemImpl,\n  locale: string,\n  formatClockTimeFn: (ts: number, locale: string) => string\n): string => {\n  const ts = task.createTime\n  return ts !== undefined ? formatClockTimeFn(ts, locale) : ''\n}\n\nexport const buildJobDisplay = (\n  task: TaskItemImpl,\n  state: JobState,\n  ctx: BuildJobDisplayCtx\n): JobDisplay => {\n  if (state === 'pending') {\n    if (ctx.showAddedHint) {\n      return {\n        iconName: 'icon-[lucide--check]',\n        primary: ctx.t('queue.jobAddedToQueue'),\n        secondary: buildQueuedTime(task, ctx.locale, ctx.formatClockTimeFn),\n        showClear: true\n      }\n    }\n    return {\n      iconName: iconForJobState(state),\n      primary: ctx.t('queue.inQueue'),\n      secondary: buildQueuedTime(task, ctx.locale, ctx.formatClockTimeFn),\n      showClear: true\n    }\n  }\n  if (state === 'initialization') {\n    return {\n      iconName: iconForJobState(state),\n      primary: ctx.t('queue.initializingAlmostReady'),\n      secondary: buildQueuedTime(task, ctx.locale, ctx.formatClockTimeFn),\n      showClear: true\n    }\n  }\n  if (state === 'running') {\n    if (ctx.isActive) {\n      const total = formatPercent0(\n        ctx.locale,\n        clampPercentInt(ctx.totalPercent)\n      )\n      const curr = formatPercent0(\n        ctx.locale,\n        clampPercentInt(ctx.currentNodePercent)\n      )\n      const primary = ctx.t('sideToolbar.queueProgressOverlay.total', {\n        percent: total\n      })\n      const right = ctx.currentNodeName\n        ? `${ctx.currentNodeName} ${ctx.t(\n            'sideToolbar.queueProgressOverlay.colonPercent',\n            { percent: curr }\n          )}`\n        : ''\n      return {\n        iconName: iconForJobState(state),\n        primary,\n        secondary: right,\n        showClear: true\n      }\n    }\n    return {\n      iconName: iconForJobState(state),\n      primary: ctx.t('g.running'),\n      secondary: '',\n      showClear: true\n    }\n  }\n  if (state === 'completed') {\n    const time = task.executionTimeInSeconds\n    const preview = task.previewOutput\n    const iconImageUrl = preview && preview.isImage ? preview.url : undefined\n\n    // Cloud shows \"Completed in Xh Ym Zs\", non-cloud shows filename\n    const primary = ctx.isCloud\n      ? ctx.t('queue.completedIn', {\n          duration: formatDuration(task.executionTime ?? 0)\n        })\n      : preview?.filename && preview.filename.length\n        ? preview.filename\n        : buildTitle(task, ctx.t)\n\n    return {\n      iconName: iconForJobState(state),\n      iconImageUrl,\n      primary,\n      secondary: time !== undefined ? `${time.toFixed(2)}s` : '',\n      showClear: false\n    }\n  }\n  if (state === 'failed') {\n    return {\n      iconName: iconForJobState(state),\n      primary: ctx.t('g.failed'),\n      secondary: ctx.t('g.failed'),\n      showClear: true\n    }\n  }\n  return {\n    iconName: iconForJobState(state),\n    primary: buildTitle(task, ctx.t),\n    secondary: '',\n    showClear: true\n  }\n}\n","import type { TaskItemImpl } from '@/stores/queueStore'\nimport type { JobState } from '@/types/queue'\n\n/**\n * Map a task to a UI job state, including initialization override.\n *\n * @param task Task item from the queue store\n * @param isInitializing True if the prompt is currently initializing\n * @returns JobState for UI\n */\nexport const jobStateFromTask = (\n  task: TaskItemImpl,\n  isInitializing: boolean\n): JobState => {\n  if (isInitializing) return 'initialization'\n  const status = task.displayStatus\n  switch (status) {\n    case 'Running':\n      return 'running'\n    case 'Pending':\n      return 'pending'\n    case 'Completed':\n      return 'completed'\n    case 'Failed':\n    case 'Cancelled':\n      return 'failed'\n  }\n  return 'failed'\n}\n","import { computed, onUnmounted, ref, watch } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport { useQueueProgress } from '@/composables/queue/useQueueProgress'\nimport { st } from '@/i18n'\nimport { isCloud } from '@/platform/distribution/types'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { useExecutionStore } from '@/stores/executionStore'\nimport { useQueueStore } from '@/stores/queueStore'\nimport type { TaskItemImpl } from '@/stores/queueStore'\nimport type { JobState } from '@/types/queue'\nimport {\n  dateKey,\n  formatClockTime,\n  formatShortMonthDay,\n  isToday,\n  isYesterday\n} from '@/utils/dateTimeUtil'\nimport { normalizeI18nKey } from '@/utils/formatUtil'\nimport { buildJobDisplay } from '@/utils/queueDisplay'\nimport { jobStateFromTask } from '@/utils/queueUtil'\n\n/** Tabs for job list filtering */\nexport const jobTabs = ['All', 'Completed', 'Failed'] as const\nexport type JobTab = (typeof jobTabs)[number]\n\nexport const jobSortModes = ['mostRecent', 'totalGenerationTime'] as const\nexport type JobSortMode = (typeof jobSortModes)[number]\n\n/**\n * UI item in the job list. Mirrors data previously prepared inline.\n */\nexport type JobListItem = {\n  id: string\n  title: string\n  meta: string\n  state: JobState\n  iconName?: string\n  iconImageUrl?: string\n  showClear?: boolean\n  taskRef?: any\n  progressTotalPercent?: number\n  progressCurrentPercent?: number\n  runningNodeName?: string\n  executionTimeMs?: number\n  computeHours?: number\n}\n\nexport type JobGroup = {\n  key: string\n  label: string\n  items: JobListItem[]\n}\n\nconst ADDED_HINT_DURATION_MS = 3000\nconst relativeTimeFormatterCache = new Map<string, Intl.RelativeTimeFormat>()\nconst taskIdToKey = (id: string | number | undefined) => {\n  if (id === null || id === undefined) return null\n  const key = String(id)\n  return key.length ? key : null\n}\n\n/**\n * Returns localized Today/Yesterday (capitalized) or localized Mon DD.\n */\nconst dateLabelForTimestamp = (\n  ts: number,\n  locale: string,\n  relativeFormatter: Intl.RelativeTimeFormat\n) => {\n  const formatRelativeDay = (value: number) => {\n    const formatted = relativeFormatter.format(value, 'day')\n    return formatted\n      ? formatted[0].toLocaleUpperCase(locale) + formatted.slice(1)\n      : formatted\n  }\n  if (isToday(ts)) {\n    return formatRelativeDay(0)\n  }\n  if (isYesterday(ts)) {\n    return formatRelativeDay(-1)\n  }\n  return formatShortMonthDay(ts, locale)\n}\n\ntype TaskWithState = {\n  task: TaskItemImpl\n  state: JobState\n}\n\n/**\n * Builds the reactive job list, filters, and grouped view for the queue overlay.\n */\nexport function useJobList() {\n  const { t, locale } = useI18n()\n  const queueStore = useQueueStore()\n  const executionStore = useExecutionStore()\n  const workflowStore = useWorkflowStore()\n\n  const seenPendingIds = ref<Set<string>>(new Set())\n  const recentlyAddedPendingIds = ref<Set<string>>(new Set())\n  const addedHintTimeouts = new Map<string, ReturnType<typeof setTimeout>>()\n\n  const clearAddedHintTimeout = (id: string) => {\n    const timeoutId = addedHintTimeouts.get(id)\n    if (timeoutId !== undefined) {\n      clearTimeout(timeoutId)\n      addedHintTimeouts.delete(id)\n    }\n  }\n\n  const scheduleAddedHintExpiry = (id: string) => {\n    clearAddedHintTimeout(id)\n    const timeoutId = setTimeout(() => {\n      addedHintTimeouts.delete(id)\n      const updated = new Set(recentlyAddedPendingIds.value)\n      if (updated.delete(id)) {\n        recentlyAddedPendingIds.value = updated\n      }\n    }, ADDED_HINT_DURATION_MS)\n    addedHintTimeouts.set(id, timeoutId)\n  }\n\n  watch(\n    () =>\n      queueStore.pendingTasks\n        .map((task) => taskIdToKey(task.promptId))\n        .filter((id): id is string => !!id),\n    (pendingIds) => {\n      const pendingSet = new Set(pendingIds)\n      const nextAdded = new Set(recentlyAddedPendingIds.value)\n      const nextSeen = new Set(seenPendingIds.value)\n\n      pendingIds.forEach((id) => {\n        if (!nextSeen.has(id)) {\n          nextSeen.add(id)\n          nextAdded.add(id)\n          scheduleAddedHintExpiry(id)\n        }\n      })\n\n      for (const id of Array.from(nextSeen)) {\n        if (!pendingSet.has(id)) {\n          nextSeen.delete(id)\n          nextAdded.delete(id)\n          clearAddedHintTimeout(id)\n        }\n      }\n\n      recentlyAddedPendingIds.value = nextAdded\n      seenPendingIds.value = nextSeen\n    },\n    { immediate: true }\n  )\n\n  const shouldShowAddedHint = (task: TaskItemImpl, state: JobState) => {\n    if (state !== 'pending') return false\n    const id = taskIdToKey(task.promptId)\n    if (!id) return false\n    return recentlyAddedPendingIds.value.has(id)\n  }\n\n  onUnmounted(() => {\n    addedHintTimeouts.forEach((timeoutId) => clearTimeout(timeoutId))\n    addedHintTimeouts.clear()\n    seenPendingIds.value = new Set<string>()\n    recentlyAddedPendingIds.value = new Set<string>()\n  })\n\n  const { totalPercent, currentNodePercent } = useQueueProgress()\n\n  const relativeTimeFormatter = computed(() => {\n    const localeValue = locale.value\n    let formatter = relativeTimeFormatterCache.get(localeValue)\n    if (!formatter) {\n      formatter = new Intl.RelativeTimeFormat(localeValue, { numeric: 'auto' })\n      relativeTimeFormatterCache.set(localeValue, formatter)\n    }\n    return formatter\n  })\n  const undatedLabel = computed(() => t('queue.jobList.undated') || 'Undated')\n\n  const isJobInitializing = (promptId: string | number | undefined) =>\n    executionStore.isPromptInitializing(promptId)\n\n  const currentNodeName = computed(() => {\n    const node = executionStore.executingNode\n    if (!node) return t('g.emDash')\n    const title = (node.title ?? '').toString().trim()\n    if (title) return title\n    const nodeType = (node.type ?? '').toString().trim() || t('g.untitled')\n    const key = `nodeDefs.${normalizeI18nKey(nodeType)}.display_name`\n    return st(key, nodeType)\n  })\n\n  const selectedJobTab = ref<JobTab>('All')\n  const selectedWorkflowFilter = ref<'all' | 'current'>('all')\n  const selectedSortMode = ref<JobSortMode>('mostRecent')\n\n  const allTasksSorted = computed<TaskItemImpl[]>(() => {\n    const all = [\n      ...queueStore.pendingTasks,\n      ...queueStore.runningTasks,\n      ...queueStore.historyTasks\n    ]\n    return all.sort((a, b) => b.queueIndex - a.queueIndex)\n  })\n\n  const tasksWithJobState = computed<TaskWithState[]>(() =>\n    allTasksSorted.value.map((task) => ({\n      task,\n      state: jobStateFromTask(task, isJobInitializing(task?.promptId))\n    }))\n  )\n\n  const hasFailedJobs = computed(() =>\n    tasksWithJobState.value.some(({ state }) => state === 'failed')\n  )\n\n  watch(\n    () => hasFailedJobs.value,\n    (hasFailed) => {\n      if (!hasFailed && selectedJobTab.value === 'Failed') {\n        selectedJobTab.value = 'All'\n      }\n    }\n  )\n\n  const filteredTaskEntries = computed<TaskWithState[]>(() => {\n    let entries = tasksWithJobState.value\n    if (selectedJobTab.value === 'Completed') {\n      entries = entries.filter(({ state }) => state === 'completed')\n    } else if (selectedJobTab.value === 'Failed') {\n      entries = entries.filter(({ state }) => state === 'failed')\n    }\n\n    if (selectedWorkflowFilter.value === 'current') {\n      const activeId = workflowStore.activeWorkflow?.activeState?.id\n      if (!activeId) return []\n      entries = entries.filter(({ task }) => {\n        const wid = task.workflow?.id\n        return !!wid && wid === activeId\n      })\n    }\n    return entries\n  })\n\n  const filteredTasks = computed<TaskItemImpl[]>(() =>\n    filteredTaskEntries.value.map(({ task }) => task)\n  )\n\n  const jobItems = computed<JobListItem[]>(() => {\n    return filteredTaskEntries.value.map(({ task, state }) => {\n      const isActive =\n        String(task.promptId ?? '') ===\n        String(executionStore.activePromptId ?? '')\n      const showAddedHint = shouldShowAddedHint(task, state)\n\n      const display = buildJobDisplay(task, state, {\n        t,\n        locale: locale.value,\n        formatClockTimeFn: formatClockTime,\n        isActive,\n        totalPercent: isActive ? totalPercent.value : undefined,\n        currentNodePercent: isActive ? currentNodePercent.value : undefined,\n        currentNodeName: isActive ? currentNodeName.value : undefined,\n        showAddedHint,\n        isCloud\n      })\n\n      return {\n        id: String(task.promptId),\n        title: display.primary,\n        meta: display.secondary,\n        state,\n        iconName: display.iconName,\n        iconImageUrl: display.iconImageUrl,\n        showClear: display.showClear,\n        taskRef: task,\n        progressTotalPercent:\n          state === 'running' && isActive ? totalPercent.value : undefined,\n        progressCurrentPercent:\n          state === 'running' && isActive\n            ? currentNodePercent.value\n            : undefined,\n        runningNodeName:\n          state === 'running' && isActive ? currentNodeName.value : undefined,\n        executionTimeMs: task.executionTime,\n        computeHours:\n          task.executionTime !== undefined\n            ? task.executionTime / 3_600_000\n            : undefined\n      } as JobListItem\n    })\n  })\n\n  const jobItemById = computed(() => {\n    const m = new Map<string, JobListItem>()\n    jobItems.value.forEach((ji) => m.set(ji.id, ji))\n    return m\n  })\n\n  const groupedJobItems = computed<JobGroup[]>(() => {\n    const groups: JobGroup[] = []\n    const index = new Map<string, number>()\n    const localeValue = locale.value\n    for (const { task, state } of filteredTaskEntries.value) {\n      let ts: number | undefined\n      if (state === 'completed' || state === 'failed') {\n        ts = task.executionEndTimestamp\n      } else {\n        ts = task.createTime\n      }\n      const key = ts === undefined ? 'undated' : dateKey(ts)\n      let groupIdx = index.get(key)\n      if (groupIdx === undefined) {\n        const label =\n          ts === undefined\n            ? undatedLabel.value\n            : dateLabelForTimestamp(\n                ts,\n                localeValue,\n                relativeTimeFormatter.value\n              )\n        groups.push({ key, label, items: [] })\n        groupIdx = groups.length - 1\n        index.set(key, groupIdx)\n      }\n      const ji = jobItemById.value.get(String(task.promptId))\n      if (ji) groups[groupIdx].items.push(ji)\n    }\n\n    if (selectedSortMode.value === 'totalGenerationTime') {\n      const valueOrDefault = (value: JobListItem['executionTimeMs']) =>\n        typeof value === 'number' && !Number.isNaN(value) ? value : -1\n      const sortByExecutionTimeDesc = (a: JobListItem, b: JobListItem) =>\n        valueOrDefault(b.executionTimeMs) - valueOrDefault(a.executionTimeMs)\n\n      groups.forEach((group) => {\n        group.items.sort(sortByExecutionTimeDesc)\n      })\n    }\n\n    return groups\n  })\n\n  return {\n    // filters/state\n    selectedJobTab,\n    selectedWorkflowFilter,\n    selectedSortMode,\n    hasFailedJobs,\n    // data sources\n    allTasksSorted,\n    filteredTasks,\n    jobItems,\n    groupedJobItems,\n    currentNodeName\n  }\n}\n","<template>\n  <div class=\"flex items-center justify-between gap-2 px-3\">\n    <div class=\"min-w-0 flex-1 overflow-x-auto\">\n      <div class=\"inline-flex items-center gap-1 whitespace-nowrap\">\n        <Button\n          v-for=\"tab in visibleJobTabs\"\n          :key=\"tab\"\n          :variant=\"selectedJobTab === tab ? 'secondary' : 'muted-textonly'\"\n          size=\"sm\"\n          class=\"px-3\"\n          @click=\"$emit('update:selectedJobTab', tab)\"\n        >\n          {{ tabLabel(tab) }}\n        </Button>\n      </div>\n    </div>\n    <div class=\"ml-2 flex shrink-0 items-center gap-2\">\n      <Button\n        v-if=\"showWorkflowFilter\"\n        v-tooltip.top=\"filterTooltipConfig\"\n        variant=\"secondary\"\n        size=\"icon\"\n        :aria-label=\"t('sideToolbar.queueProgressOverlay.filterJobs')\"\n        @click=\"onFilterClick\"\n      >\n        <i class=\"icon-[lucide--list-filter] size-4\" />\n        <span\n          v-if=\"selectedWorkflowFilter !== 'all'\"\n          class=\"pointer-events-none absolute -top-1 -right-1 inline-block size-2 rounded-full bg-base-foreground\"\n        />\n      </Button>\n      <Popover\n        v-if=\"showWorkflowFilter\"\n        ref=\"filterPopoverRef\"\n        :dismissable=\"true\"\n        :close-on-escape=\"true\"\n        unstyled\n        :pt=\"{\n          root: { class: 'absolute z-50' },\n          content: {\n            class: [\n              'bg-transparent border-none p-0 pt-2 rounded-lg shadow-lg font-inter'\n            ]\n          }\n        }\"\n      >\n        <div\n          class=\"flex min-w-[12rem] flex-col items-stretch rounded-lg border border-interface-stroke bg-interface-panel-surface px-2 py-3\"\n        >\n          <Button\n            class=\"w-full justify-between\"\n            variant=\"textonly\"\n            size=\"sm\"\n            @click=\"selectWorkflowFilter('all')\"\n          >\n            <span>{{\n              t('sideToolbar.queueProgressOverlay.filterAllWorkflows')\n            }}</span>\n            <i\n              v-if=\"selectedWorkflowFilter === 'all'\"\n              class=\"icon-[lucide--check] size-4\"\n            />\n          </Button>\n          <div class=\"mx-2 mt-1 h-px\" />\n          <Button\n            class=\"w-full justify-between\"\n            variant=\"textonly\"\n            @click=\"selectWorkflowFilter('current')\"\n          >\n            <span>{{\n              t('sideToolbar.queueProgressOverlay.filterCurrentWorkflow')\n            }}</span>\n            <i\n              v-if=\"selectedWorkflowFilter === 'current'\"\n              class=\"icon-[lucide--check] block size-4 leading-none text-text-secondary\"\n            />\n          </Button>\n        </div>\n      </Popover>\n      <Button\n        v-tooltip.top=\"sortTooltipConfig\"\n        variant=\"secondary\"\n        size=\"icon\"\n        :aria-label=\"t('sideToolbar.queueProgressOverlay.sortJobs')\"\n        @click=\"onSortClick\"\n      >\n        <i class=\"icon-[lucide--arrow-up-down] size-4\" />\n        <span\n          v-if=\"selectedSortMode !== 'mostRecent'\"\n          class=\"pointer-events-none absolute -top-1 -right-1 inline-block size-2 rounded-full bg-base-foreground\"\n        />\n      </Button>\n      <Popover\n        ref=\"sortPopoverRef\"\n        :dismissable=\"true\"\n        :close-on-escape=\"true\"\n        unstyled\n        :pt=\"{\n          root: { class: 'absolute z-50' },\n          content: {\n            class: [\n              'bg-transparent border-none p-0 pt-2 rounded-lg shadow-lg font-inter'\n            ]\n          }\n        }\"\n      >\n        <div\n          class=\"flex min-w-[12rem] flex-col items-stretch rounded-lg border border-interface-stroke bg-interface-panel-surface px-2 py-3\"\n        >\n          <template v-for=\"(mode, index) in jobSortModes\" :key=\"mode\">\n            <Button\n              class=\"w-full justify-between\"\n              variant=\"textonly\"\n              size=\"sm\"\n              @click=\"selectSortMode(mode)\"\n            >\n              <span>{{ sortLabel(mode) }}</span>\n              <i\n                v-if=\"selectedSortMode === mode\"\n                class=\"icon-[lucide--check] size-4 text-text-secondary\"\n              />\n            </Button>\n            <div\n              v-if=\"index < jobSortModes.length - 1\"\n              class=\"mx-2 mt-1 h-px\"\n            />\n          </template>\n        </div>\n      </Popover>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport Popover from 'primevue/popover'\nimport { computed, ref } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport Button from '@/components/ui/button/Button.vue'\nimport { jobSortModes, jobTabs } from '@/composables/queue/useJobList'\nimport type { JobSortMode, JobTab } from '@/composables/queue/useJobList'\nimport { buildTooltipConfig } from '@/composables/useTooltipConfig'\nimport { isCloud } from '@/platform/distribution/types'\n\nconst props = defineProps<{\n  selectedJobTab: JobTab\n  selectedWorkflowFilter: 'all' | 'current'\n  selectedSortMode: JobSortMode\n  hasFailedJobs: boolean\n}>()\n\nconst emit = defineEmits<{\n  (e: 'update:selectedJobTab', value: JobTab): void\n  (e: 'update:selectedWorkflowFilter', value: 'all' | 'current'): void\n  (e: 'update:selectedSortMode', value: JobSortMode): void\n}>()\n\nconst { t } = useI18n()\nconst filterPopoverRef = ref<InstanceType<typeof Popover> | null>(null)\nconst sortPopoverRef = ref<InstanceType<typeof Popover> | null>(null)\n\nconst filterTooltipConfig = computed(() =>\n  buildTooltipConfig(t('sideToolbar.queueProgressOverlay.filterBy'))\n)\nconst sortTooltipConfig = computed(() =>\n  buildTooltipConfig(t('sideToolbar.queueProgressOverlay.sortBy'))\n)\n\n// This can be removed when cloud implements /jobs and we switch to it.\nconst showWorkflowFilter = !isCloud\n\nconst visibleJobTabs = computed(() =>\n  props.hasFailedJobs ? jobTabs : jobTabs.filter((tab) => tab !== 'Failed')\n)\n\nconst onFilterClick = (event: Event) => {\n  if (filterPopoverRef.value) {\n    filterPopoverRef.value.toggle(event)\n  }\n}\nconst selectWorkflowFilter = (value: 'all' | 'current') => {\n  ;(filterPopoverRef.value as any)?.hide?.()\n  emit('update:selectedWorkflowFilter', value)\n}\n\nconst onSortClick = (event: Event) => {\n  if (sortPopoverRef.value) {\n    sortPopoverRef.value.toggle(event)\n  }\n}\n\nconst selectSortMode = (value: JobSortMode) => {\n  ;(sortPopoverRef.value as any)?.hide?.()\n  emit('update:selectedSortMode', value)\n}\n\nconst tabLabel = (tab: JobTab) => {\n  if (tab === 'All') return t('g.all')\n  if (tab === 'Completed') return t('g.completed')\n  return t('g.failed')\n}\n\nconst sortLabel = (mode: JobSortMode) => {\n  if (mode === 'mostRecent') {\n    return t('queue.jobList.sortMostRecent')\n  }\n  if (mode === 'totalGenerationTime') {\n    return t('queue.jobList.sortTotalGenerationTime')\n  }\n  return ''\n}\n</script>\n","import { computed } from 'vue'\nimport type { ComputedRef } from 'vue'\n\nimport type { ExecutionErrorWsMessage } from '@/schemas/apiSchema'\nimport type { TaskItemImpl } from '@/stores/queueStore'\n\ntype CopyHandler = (value: string) => void | Promise<void>\n\nexport type JobErrorDialogService = {\n  showExecutionErrorDialog: (error: ExecutionErrorWsMessage) => void\n  showErrorDialog: (\n    error: Error,\n    options?: {\n      reportType?: string\n      [key: string]: unknown\n    }\n  ) => void\n}\n\ntype JobExecutionError = {\n  detail?: ExecutionErrorWsMessage\n  message: string\n}\n\nexport const extractExecutionError = (\n  task: TaskItemImpl | null\n): JobExecutionError | null => {\n  const status = (task as TaskItemImpl | null)?.status\n  const messages = (status as { messages?: unknown[] } | undefined)?.messages\n  if (!Array.isArray(messages) || !messages.length) return null\n  const record = messages.find((entry: unknown) => {\n    return Array.isArray(entry) && entry[0] === 'execution_error'\n  }) as [string, ExecutionErrorWsMessage?] | undefined\n  if (!record) return null\n  const detail = record[1]\n  const message = String(detail?.exception_message ?? '')\n  return {\n    detail,\n    message\n  }\n}\n\nexport type UseJobErrorReportingOptions = {\n  taskForJob: ComputedRef<TaskItemImpl | null>\n  copyToClipboard: CopyHandler\n  dialog: JobErrorDialogService\n}\n\nexport const useJobErrorReporting = ({\n  taskForJob,\n  copyToClipboard,\n  dialog\n}: UseJobErrorReportingOptions) => {\n  const errorMessageValue = computed(() => {\n    const error = extractExecutionError(taskForJob.value)\n    return error?.message ?? ''\n  })\n\n  const copyErrorMessage = () => {\n    if (errorMessageValue.value) {\n      void copyToClipboard(errorMessageValue.value)\n    }\n  }\n\n  const reportJobError = () => {\n    const error = extractExecutionError(taskForJob.value)\n    if (error?.detail) {\n      dialog.showExecutionErrorDialog(error.detail)\n      return\n    }\n    if (errorMessageValue.value) {\n      dialog.showErrorDialog(new Error(errorMessageValue.value), {\n        reportType: 'queueJobError'\n      })\n    }\n  }\n\n  return {\n    errorMessageValue,\n    copyErrorMessage,\n    reportJobError\n  }\n}\n","import { computed } from 'vue'\nimport type { ComputedRef, Ref } from 'vue'\n\nimport type { useExecutionStore } from '@/stores/executionStore'\nimport type { TaskItemImpl, useQueueStore } from '@/stores/queueStore'\nimport type { JobState } from '@/types/queue'\n\ntype QueueStore = ReturnType<typeof useQueueStore>\ntype ExecutionStore = ReturnType<typeof useExecutionStore>\n\nexport type UseQueueEstimatesOptions = {\n  queueStore: QueueStore\n  executionStore: ExecutionStore\n  taskForJob: ComputedRef<TaskItemImpl | null>\n  jobState: ComputedRef<JobState | null>\n  firstSeenTs: ComputedRef<number | undefined>\n  jobsAhead: ComputedRef<number | null>\n  nowTs: Ref<number>\n}\n\ntype EstimateRange = [number, number]\n\nexport const formatElapsedTime = (ms: number): string => {\n  const totalSec = Math.max(0, Math.floor(ms / 1000))\n  const minutes = Math.floor(totalSec / 60)\n  const seconds = totalSec % 60\n  return `${minutes}m ${seconds}s`\n}\n\nconst pickRecentDurations = (queueStore: QueueStore) =>\n  queueStore.historyTasks\n    .map((task: TaskItemImpl) => Number(task.executionTimeInSeconds))\n    .filter(\n      (value: number | undefined) =>\n        typeof value === 'number' && !Number.isNaN(value)\n    ) as number[]\n\nexport const useQueueEstimates = ({\n  queueStore,\n  executionStore,\n  taskForJob,\n  jobState,\n  firstSeenTs,\n  jobsAhead,\n  nowTs\n}: UseQueueEstimatesOptions) => {\n  const runningWorkflowCount = computed(\n    () => executionStore.runningWorkflowCount\n  )\n\n  const showParallelQueuedStats = computed(\n    () =>\n      jobState.value === 'pending' &&\n      !!firstSeenTs.value &&\n      (runningWorkflowCount.value ?? 0) > 1\n  )\n\n  const recentDurations = computed<number[]>(() =>\n    pickRecentDurations(queueStore).slice(-20)\n  )\n\n  const runningRemainingRangeSeconds = computed<EstimateRange | null>(() => {\n    const durations = recentDurations.value\n    if (!durations.length) return null\n    const sorted = durations.slice().sort((a, b) => a - b)\n    const avg = sorted.reduce((sum, value) => sum + value, 0) / sorted.length\n    const p75 =\n      sorted[Math.min(sorted.length - 1, Math.floor(sorted.length * 0.75))]\n    const running = queueStore.runningTasks as TaskItemImpl[]\n    const now = nowTs.value\n    const remaining = running\n      .map((task) => task.executionStartTimestamp)\n      .filter((timestamp): timestamp is number => typeof timestamp === 'number')\n      .map((startTs) => {\n        const elapsed = Math.max(0, Math.floor((now - startTs) / 1000))\n        return {\n          lo: Math.max(0, Math.round(avg - elapsed)),\n          hi: Math.max(0, Math.round(p75 - elapsed))\n        }\n      })\n    if (!remaining.length) return null\n    const minLo = remaining.reduce(\n      (min, range) => Math.min(min, range.lo),\n      Infinity\n    )\n    const minHi = remaining.reduce(\n      (min, range) => Math.min(min, range.hi),\n      Infinity\n    )\n    return [minLo, minHi]\n  })\n\n  const estimateRangeSeconds = computed<EstimateRange | null>(() => {\n    const durations = recentDurations.value\n    if (!durations.length) return null\n    const ahead = jobsAhead.value\n    if (ahead == null) return null\n    const sorted = durations.slice().sort((a, b) => a - b)\n    const avg = sorted.reduce((sum, value) => sum + value, 0) / sorted.length\n    const p75 =\n      sorted[Math.min(sorted.length - 1, Math.floor(sorted.length * 0.75))]\n    if (ahead <= 0) {\n      return runningRemainingRangeSeconds.value ?? [0, 0]\n    }\n    const runningCount = Math.max(1, runningWorkflowCount.value || 1)\n    const batches = Math.ceil(ahead / runningCount)\n    return [Math.round(avg * batches), Math.round(p75 * batches)]\n  })\n\n  const estimateRemainingRangeSeconds = computed<EstimateRange | null>(() => {\n    const durations = recentDurations.value\n    if (!durations.length) return null\n    const sorted = durations.slice().sort((a, b) => a - b)\n    const avg = sorted.reduce((sum, value) => sum + value, 0) / sorted.length\n    const p75 =\n      sorted[Math.min(sorted.length - 1, Math.floor(sorted.length * 0.75))]\n    const task = taskForJob.value as TaskItemImpl & {\n      executionStartTimestamp?: number\n    }\n    const execStart =\n      jobState.value === 'running' ? task?.executionStartTimestamp : undefined\n    const baseTs = execStart ?? firstSeenTs.value\n    const elapsed = baseTs\n      ? Math.max(0, Math.floor((nowTs.value - baseTs) / 1000))\n      : 0\n    const lo = Math.max(0, Math.round(avg - elapsed))\n    const hi = Math.max(0, Math.round(p75 - elapsed))\n    return [lo, hi]\n  })\n\n  const timeElapsedValue = computed(() => {\n    const task = taskForJob.value as TaskItemImpl & {\n      executionStartTimestamp?: number\n    }\n    const execStart =\n      jobState.value === 'running' ? task?.executionStartTimestamp : undefined\n    const baseTs = execStart ?? firstSeenTs.value\n    if (!baseTs) return ''\n    return formatElapsedTime(nowTs.value - baseTs)\n  })\n\n  return {\n    runningWorkflowCount,\n    showParallelQueuedStats,\n    estimateRangeSeconds,\n    estimateRemainingRangeSeconds,\n    timeElapsedValue\n  }\n}\n","<template>\n  <div\n    class=\"w-[300px] min-w-[260px] rounded-lg border border-interface-stroke bg-interface-panel-surface shadow-md\"\n  >\n    <div class=\"flex items-center border-b border-interface-stroke p-4\">\n      <span\n        class=\"text-[0.875rem] leading-normal font-normal text-text-primary\"\n        >{{ t('queue.jobDetails.header') }}</span\n      >\n    </div>\n    <div class=\"flex flex-col gap-6 px-4 pt-4 pb-4\">\n      <div class=\"grid grid-cols-2 items-center gap-x-2 gap-y-2\">\n        <template v-for=\"row in baseRows\" :key=\"row.label\">\n          <div\n            class=\"flex items-center text-[0.75rem] leading-normal font-normal text-text-primary\"\n          >\n            {{ row.label }}\n          </div>\n          <div\n            class=\"flex min-w-0 items-center text-[0.75rem] leading-normal font-normal text-text-secondary\"\n          >\n            <span class=\"block min-w-0 truncate\">{{ row.value }}</span>\n            <Button\n              v-if=\"row.canCopy\"\n              size=\"icon\"\n              variant=\"muted-textonly\"\n              :aria-label=\"copyAriaLabel\"\n              @click.stop=\"copyJobId\"\n            >\n              <i class=\"icon-[lucide--copy] size-4\" />\n            </Button>\n          </div>\n        </template>\n      </div>\n\n      <div\n        v-if=\"extraRows.length\"\n        class=\"grid grid-cols-2 items-center gap-x-2 gap-y-2\"\n      >\n        <template v-for=\"row in extraRows\" :key=\"row.label\">\n          <div\n            class=\"flex items-center text-[0.75rem] leading-normal font-normal text-text-primary\"\n          >\n            {{ row.label }}\n          </div>\n          <div\n            class=\"flex min-w-0 items-center text-[0.75rem] leading-normal font-normal text-text-secondary\"\n          >\n            <span class=\"block min-w-0 truncate\">{{ row.value }}</span>\n          </div>\n        </template>\n      </div>\n\n      <div v-if=\"jobState === 'failed'\" class=\"grid grid-cols-2 gap-x-2\">\n        <div\n          class=\"flex items-center text-[0.75rem] leading-normal font-normal text-text-primary\"\n        >\n          {{ t('queue.jobDetails.errorMessage') }}\n        </div>\n        <div class=\"flex items-center justify-between gap-4\">\n          <Button\n            class=\"justify-start px-0\"\n            variant=\"muted-textonly\"\n            size=\"sm\"\n            icon-position=\"right\"\n            @click.stop=\"copyErrorMessage\"\n          >\n            <span>{{ copyAriaLabel }}</span>\n            <i class=\"icon-[lucide--copy] block size-3.5 leading-none\" />\n          </Button>\n          <Button\n            class=\"justify-start px-0\"\n            variant=\"muted-textonly\"\n            size=\"sm\"\n            icon-position=\"right\"\n            @click.stop=\"reportJobError\"\n          >\n            <span>{{ t('queue.jobDetails.report') }}</span>\n            <i\n              class=\"icon-[lucide--message-circle-warning] block size-3.5 leading-none\"\n            />\n          </Button>\n        </div>\n        <div\n          class=\"col-span-2 mt-2 rounded bg-interface-panel-hover-surface px-4 py-2 text-[0.75rem] leading-normal text-text-secondary\"\n        >\n          {{ errorMessageValue }}\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, onMounted, onUnmounted, ref } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport Button from '@/components/ui/button/Button.vue'\nimport { useCopyToClipboard } from '@/composables/useCopyToClipboard'\nimport { isCloud } from '@/platform/distribution/types'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { useDialogService } from '@/services/dialogService'\nimport { useExecutionStore } from '@/stores/executionStore'\nimport { useQueueStore } from '@/stores/queueStore'\nimport type { TaskItemImpl } from '@/stores/queueStore'\nimport { formatClockTime } from '@/utils/dateTimeUtil'\nimport { jobStateFromTask } from '@/utils/queueUtil'\n\nimport { useJobErrorReporting } from './useJobErrorReporting'\nimport { formatElapsedTime, useQueueEstimates } from './useQueueEstimates'\n\nconst props = defineProps<{\n  jobId: string\n  workflowId?: string\n}>()\n\nconst copyAriaLabel = computed(() => t('g.copy'))\n\nconst workflowStore = useWorkflowStore()\nconst queueStore = useQueueStore()\nconst executionStore = useExecutionStore()\nconst dialog = useDialogService()\nconst { locale, t } = useI18n()\n\nconst workflowValue = computed(() => {\n  const wid = props.workflowId\n  if (!wid) return ''\n  const activeId = workflowStore.activeWorkflow?.activeState?.id\n  if (activeId && activeId === wid) {\n    return workflowStore.activeWorkflow?.filename ?? wid\n  }\n  return wid\n})\nconst jobIdValue = computed(() => props.jobId)\n\nconst { copyToClipboard } = useCopyToClipboard()\nconst copyJobId = () => void copyToClipboard(jobIdValue.value)\n\nconst taskForJob = computed(() => {\n  const pid = props.jobId\n  const findIn = (arr: TaskItemImpl[]) =>\n    arr.find((t) => String(t.promptId ?? '') === String(pid))\n  return (\n    findIn(queueStore.pendingTasks) ||\n    findIn(queueStore.runningTasks) ||\n    findIn(queueStore.historyTasks) ||\n    null\n  )\n})\n\nconst jobState = computed(() => {\n  const task = taskForJob.value\n  if (!task) return null\n  const isInitializing = executionStore.isPromptInitializing(\n    String(task?.promptId)\n  )\n  return jobStateFromTask(task, isInitializing)\n})\n\nconst firstSeenTs = computed<number | undefined>(() => {\n  const task = taskForJob.value\n  return task?.createTime\n})\n\nconst queuedAtValue = computed(() =>\n  firstSeenTs.value !== undefined\n    ? formatClockTime(firstSeenTs.value, locale.value)\n    : ''\n)\n\nconst currentQueueIndex = computed<number | null>(() => {\n  const task = taskForJob.value\n  return task ? Number(task.queueIndex) : null\n})\n\nconst jobsAhead = computed<number | null>(() => {\n  const idx = currentQueueIndex.value\n  if (idx == null) return null\n  const ahead = queueStore.pendingTasks.filter(\n    (t: TaskItemImpl) => Number(t.queueIndex) < idx\n  )\n  return ahead.length\n})\n\nconst queuePositionValue = computed(() => {\n  if (jobsAhead.value == null) return ''\n  const n = jobsAhead.value\n  return t('queue.jobDetails.queuePositionValue', { count: n }, n)\n})\n\nconst nowTs = ref<number>(Date.now())\nlet timer: number | null = null\nonMounted(() => {\n  timer = window.setInterval(() => {\n    nowTs.value = Date.now()\n  }, 1000)\n})\nonUnmounted(() => {\n  if (timer != null) {\n    clearInterval(timer)\n    timer = null\n  }\n})\n\nconst {\n  showParallelQueuedStats,\n  estimateRangeSeconds,\n  estimateRemainingRangeSeconds,\n  timeElapsedValue\n} = useQueueEstimates({\n  queueStore,\n  executionStore,\n  taskForJob,\n  jobState,\n  firstSeenTs,\n  jobsAhead,\n  nowTs\n})\n\nconst formatEta = (lo: number, hi: number): string => {\n  if (hi <= 60) {\n    const hiS = Math.max(1, Math.round(hi))\n    const loS = Math.max(1, Math.min(hiS, Math.round(lo)))\n    if (loS === hiS)\n      return t('queue.jobDetails.eta.seconds', { count: hiS }, hiS)\n    return t('queue.jobDetails.eta.secondsRange', { lo: loS, hi: hiS })\n  }\n  if (lo >= 60 && hi < 90) {\n    return t('queue.jobDetails.eta.minutes', { count: 1 }, 1)\n  }\n  const loM = Math.max(1, Math.floor(lo / 60))\n  const hiM = Math.max(loM, Math.ceil(hi / 60))\n  if (loM === hiM) {\n    return t('queue.jobDetails.eta.minutes', { count: loM }, loM)\n  }\n  return t('queue.jobDetails.eta.minutesRange', { lo: loM, hi: hiM })\n}\n\nconst estimatedStartInValue = computed(() => {\n  const range = estimateRangeSeconds.value\n  if (!range) return ''\n  const [lo, hi] = range\n  return formatEta(lo, hi)\n})\n\nconst estimatedFinishInValue = computed(() => {\n  const range = estimateRemainingRangeSeconds.value\n  if (!range) return ''\n  const [lo, hi] = range\n  return formatEta(lo, hi)\n})\n\ntype DetailRow = { label: string; value: string; canCopy?: boolean }\n\nconst baseRows = computed<DetailRow[]>(() => [\n  { label: t('queue.jobDetails.workflow'), value: workflowValue.value },\n  { label: t('queue.jobDetails.jobId'), value: jobIdValue.value, canCopy: true }\n])\n\nconst extraRows = computed<DetailRow[]>(() => {\n  if (jobState.value === 'pending') {\n    if (!firstSeenTs.value) return []\n    const rows: DetailRow[] = [\n      { label: t('queue.jobDetails.queuedAt'), value: queuedAtValue.value }\n    ]\n    if (showParallelQueuedStats.value) {\n      rows.push(\n        {\n          label: t('queue.jobDetails.queuePosition'),\n          value: queuePositionValue.value\n        },\n        {\n          label: t('queue.jobDetails.timeElapsed'),\n          value: timeElapsedValue.value\n        },\n        {\n          label: t('queue.jobDetails.estimatedStartIn'),\n          value: estimatedStartInValue.value\n        }\n      )\n    }\n    return rows\n  }\n  if (jobState.value === 'running') {\n    if (!firstSeenTs.value) return []\n    return [\n      { label: t('queue.jobDetails.queuedAt'), value: queuedAtValue.value },\n      {\n        label: t('queue.jobDetails.timeElapsed'),\n        value: timeElapsedValue.value\n      },\n      {\n        label: t('queue.jobDetails.estimatedFinishIn'),\n        value: estimatedFinishInValue.value\n      }\n    ]\n  }\n  if (jobState.value === 'completed') {\n    const task = taskForJob.value as any\n    const endTs: number | undefined = task?.executionEndTimestamp\n    const execMs: number | undefined = task?.executionTime\n    const generatedOnValue = endTs ? formatClockTime(endTs, locale.value) : ''\n    const totalGenTimeValue =\n      execMs !== undefined ? formatElapsedTime(execMs) : ''\n    const computeHoursValue =\n      execMs !== undefined ? (execMs / 3600000).toFixed(3) + ' hours' : ''\n\n    const rows: DetailRow[] = [\n      { label: t('queue.jobDetails.generatedOn'), value: generatedOnValue },\n      {\n        label: t('queue.jobDetails.totalGenerationTime'),\n        value: totalGenTimeValue\n      }\n    ]\n    if (isCloud) {\n      rows.push({\n        label: t('queue.jobDetails.computeHoursUsed'),\n        value: computeHoursValue\n      })\n    }\n    return rows\n  }\n  if (jobState.value === 'failed') {\n    const task = taskForJob.value as any\n    const execMs: number | undefined = task?.executionTime\n    const failedAfterValue =\n      execMs !== undefined ? formatElapsedTime(execMs) : ''\n    const computeHoursValue =\n      execMs !== undefined ? (execMs / 3600000).toFixed(3) + ' hours' : ''\n    const rows: DetailRow[] = [\n      { label: t('queue.jobDetails.queuedAt'), value: queuedAtValue.value },\n      { label: t('queue.jobDetails.failedAfter'), value: failedAfterValue }\n    ]\n    if (isCloud) {\n      rows.push({\n        label: t('queue.jobDetails.computeHoursUsed'),\n        value: computeHoursValue\n      })\n    }\n    return rows\n  }\n  return []\n})\n\nconst { errorMessageValue, copyErrorMessage, reportJobError } =\n  useJobErrorReporting({\n    taskForJob,\n    copyToClipboard,\n    dialog\n  })\n</script>\n","<template>\n  <div class=\"w-[300px] min-w-[260px] rounded-lg shadow-md\">\n    <div class=\"p-3\">\n      <div class=\"relative aspect-square w-full overflow-hidden rounded-lg\">\n        <img\n          ref=\"imgRef\"\n          :src=\"imageUrl\"\n          :alt=\"name\"\n          class=\"h-full w-full cursor-pointer object-contain\"\n          @click=\"$emit('image-click')\"\n          @load=\"onImgLoad\"\n        />\n        <div\n          v-if=\"timeLabel\"\n          class=\"absolute bottom-2 left-2 rounded px-2 py-0.5 text-xs text-text-primary\"\n          :style=\"{\n            background: 'rgba(217, 217, 217, 0.40)',\n            backdropFilter: 'blur(2px)'\n          }\"\n        >\n          {{ timeLabel }}\n        </div>\n      </div>\n      <div class=\"mt-2 text-center\">\n        <div\n          class=\"truncate text-[0.875rem] leading-normal font-semibold text-text-primary\"\n          :title=\"name\"\n        >\n          {{ name }}\n        </div>\n        <div\n          v-if=\"width && height\"\n          class=\"mt-1 text-[0.75rem] leading-normal text-text-secondary\"\n        >\n          {{ width }}x{{ height }}\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref } from 'vue'\n\ndefineOptions({ inheritAttrs: false })\n\ndefineProps<{\n  imageUrl: string\n  name: string\n  timeLabel?: string\n}>()\n\ndefineEmits(['image-click'])\n\nconst imgRef = ref<HTMLImageElement | null>(null)\nconst width = ref<number | null>(null)\nconst height = ref<number | null>(null)\n\nconst onImgLoad = () => {\n  const el = imgRef.value\n  if (!el) return\n  width.value = el.naturalWidth || null\n  height.value = el.naturalHeight || null\n}\n</script>\n","<template>\n  <div\n    ref=\"rowRef\"\n    class=\"relative\"\n    @mouseenter=\"onRowEnter\"\n    @mouseleave=\"onRowLeave\"\n    @contextmenu.stop.prevent=\"onContextMenu\"\n  >\n    <Teleport to=\"body\">\n      <div\n        v-if=\"!isPreviewVisible && showDetails && popoverPosition\"\n        class=\"fixed z-50\"\n        :style=\"{\n          top: `${popoverPosition.top}px`,\n          right: `${popoverPosition.right}px`\n        }\"\n        @mouseenter=\"onPopoverEnter\"\n        @mouseleave=\"onPopoverLeave\"\n      >\n        <JobDetailsPopover\n          :job-id=\"props.jobId\"\n          :workflow-id=\"props.workflowId\"\n        />\n      </div>\n    </Teleport>\n    <Teleport to=\"body\">\n      <div\n        v-if=\"isPreviewVisible && canShowPreview && popoverPosition\"\n        class=\"fixed z-50\"\n        :style=\"{\n          top: `${popoverPosition.top}px`,\n          right: `${popoverPosition.right}px`\n        }\"\n        @mouseenter=\"onPreviewEnter\"\n        @mouseleave=\"onPreviewLeave\"\n      >\n        <QueueAssetPreview\n          :image-url=\"iconImageUrl!\"\n          :name=\"props.title\"\n          :time-label=\"rightText || undefined\"\n          @image-click=\"emit('view')\"\n        />\n      </div>\n    </Teleport>\n    <div\n      class=\"relative flex items-center justify-between gap-2 overflow-hidden rounded-lg border border-secondary-background bg-secondary-background p-1 text-[12px] text-text-primary transition-colors duration-150 ease-in-out hover:border-secondary-background-hover hover:bg-secondary-background-hover\"\n      @mouseenter=\"isHovered = true\"\n      @mouseleave=\"isHovered = false\"\n    >\n      <div\n        v-if=\"\n          props.state === 'running' &&\n          (props.progressTotalPercent !== undefined ||\n            props.progressCurrentPercent !== undefined)\n        \"\n        class=\"absolute inset-0\"\n      >\n        <div\n          v-if=\"props.progressTotalPercent !== undefined\"\n          class=\"pointer-events-none absolute inset-y-0 left-0 h-full bg-interface-panel-job-progress-primary transition-[width]\"\n          :style=\"{ width: `${props.progressTotalPercent}%` }\"\n        />\n        <div\n          v-if=\"props.progressCurrentPercent !== undefined\"\n          class=\"pointer-events-none absolute inset-y-0 left-0 h-full bg-interface-panel-job-progress-secondary transition-[width]\"\n          :style=\"{ width: `${props.progressCurrentPercent}%` }\"\n        />\n      </div>\n\n      <div class=\"relative z-1 flex items-center gap-1\">\n        <div class=\"relative inline-flex items-center justify-center\">\n          <div\n            class=\"absolute left-1/2 top-1/2 size-10 -translate-x-1/2 -translate-y-1/2\"\n            @mouseenter.stop=\"onIconEnter\"\n            @mouseleave.stop=\"onIconLeave\"\n          />\n          <div\n            class=\"inline-flex h-6 w-6 items-center justify-center overflow-hidden rounded-[6px]\"\n          >\n            <img\n              v-if=\"iconImageUrl\"\n              :src=\"iconImageUrl\"\n              class=\"h-full w-full object-cover\"\n            />\n            <i\n              v-else\n              :class=\"cn(iconClass, 'size-4', shouldSpin && 'animate-spin')\"\n            />\n          </div>\n        </div>\n      </div>\n\n      <div class=\"relative z-1 min-w-0 flex-1\">\n        <div class=\"truncate opacity-90\" :title=\"props.title\">\n          <slot name=\"primary\">{{ props.title }}</slot>\n        </div>\n      </div>\n\n      <!--\n        TODO: Refactor action buttons to use a declarative config system.\n\n        Instead of hardcoding button visibility logic in the template, define an array of\n        action button configs with properties like:\n        - icon, label, action, tooltip\n        - visibleStates: JobState[] (which job states show this button)\n        - alwaysVisible: boolean (show without hover)\n        - destructive: boolean (use destructive styling)\n\n        Then render buttons in two groups:\n        1. Always-visible buttons (outside Transition)\n        2. Hover-only buttons (inside Transition)\n\n        This would eliminate the current duplication where the cancel button exists\n        both outside (for running) and inside (for pending) the Transition.\n      -->\n      <div class=\"relative z-1 flex items-center gap-2 text-text-secondary\">\n        <Transition\n          mode=\"out-in\"\n          enter-active-class=\"transition-opacity transition-transform duration-150 ease-out\"\n          leave-active-class=\"transition-opacity transition-transform duration-150 ease-in\"\n          enter-from-class=\"opacity-0 translate-y-0.5\"\n          enter-to-class=\"opacity-100 translate-y-0\"\n          leave-from-class=\"opacity-100 translate-y-0\"\n          leave-to-class=\"opacity-0 translate-y-0.5\"\n        >\n          <div\n            v-if=\"isHovered\"\n            key=\"actions\"\n            class=\"inline-flex items-center gap-2 pr-1\"\n          >\n            <Button\n              v-if=\"props.state === 'failed' && computedShowClear\"\n              v-tooltip.top=\"deleteTooltipConfig\"\n              variant=\"destructive\"\n              size=\"icon\"\n              :aria-label=\"t('g.delete')\"\n              @click.stop=\"onDeleteClick\"\n            >\n              <i class=\"icon-[lucide--trash-2] size-4\" />\n            </Button>\n            <Button\n              v-else-if=\"\n                props.state !== 'completed' &&\n                props.state !== 'running' &&\n                computedShowClear\n              \"\n              v-tooltip.top=\"cancelTooltipConfig\"\n              variant=\"destructive\"\n              size=\"icon\"\n              :aria-label=\"t('g.cancel')\"\n              @click.stop=\"onCancelClick\"\n            >\n              <i class=\"icon-[lucide--x] size-4\" />\n            </Button>\n            <Button\n              v-else-if=\"props.state === 'completed'\"\n              variant=\"textonly\"\n              size=\"sm\"\n              @click.stop=\"emit('view')\"\n              >{{ t('menuLabels.View') }}</Button\n            >\n            <Button\n              v-if=\"props.showMenu !== undefined ? props.showMenu : true\"\n              v-tooltip.top=\"moreTooltipConfig\"\n              variant=\"textonly\"\n              size=\"icon-sm\"\n              :aria-label=\"t('g.more')\"\n              @click.stop=\"emit('menu', $event)\"\n            >\n              <i class=\"icon-[lucide--more-horizontal] size-4\" />\n            </Button>\n          </div>\n          <div\n            v-else-if=\"props.state !== 'running'\"\n            key=\"secondary\"\n            class=\"pr-2\"\n          >\n            <slot name=\"secondary\">{{ props.rightText }}</slot>\n          </div>\n        </Transition>\n        <!-- Running job cancel button - always visible -->\n        <Button\n          v-if=\"props.state === 'running' && computedShowClear\"\n          v-tooltip.top=\"cancelTooltipConfig\"\n          variant=\"destructive\"\n          size=\"icon\"\n          :aria-label=\"t('g.cancel')\"\n          @click.stop=\"onCancelClick\"\n        >\n          <i class=\"icon-[lucide--x] size-4\" />\n        </Button>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, nextTick, ref, watch } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport JobDetailsPopover from '@/components/queue/job/JobDetailsPopover.vue'\nimport QueueAssetPreview from '@/components/queue/job/QueueAssetPreview.vue'\nimport Button from '@/components/ui/button/Button.vue'\nimport { buildTooltipConfig } from '@/composables/useTooltipConfig'\nimport type { JobState } from '@/types/queue'\nimport { iconForJobState } from '@/utils/queueDisplay'\nimport { cn } from '@/utils/tailwindUtil'\n\nconst props = withDefaults(\n  defineProps<{\n    jobId: string\n    workflowId?: string\n    state: JobState\n    title: string\n    rightText?: string\n    iconName?: string\n    iconImageUrl?: string\n    showClear?: boolean\n    showMenu?: boolean\n    progressTotalPercent?: number\n    progressCurrentPercent?: number\n    activeDetailsId?: string | null\n  }>(),\n  {\n    workflowId: undefined,\n    rightText: '',\n    iconName: undefined,\n    iconImageUrl: undefined,\n    showClear: undefined,\n    showMenu: undefined,\n    progressTotalPercent: undefined,\n    progressCurrentPercent: undefined,\n    runningNodeName: undefined,\n    activeDetailsId: null\n  }\n)\n\nconst emit = defineEmits<{\n  (e: 'cancel'): void\n  (e: 'delete'): void\n  (e: 'menu', event: MouseEvent): void\n  (e: 'view'): void\n  (e: 'details-enter', jobId: string): void\n  (e: 'details-leave', jobId: string): void\n}>()\n\nconst { t } = useI18n()\n\nconst cancelTooltipConfig = computed(() => buildTooltipConfig(t('g.cancel')))\nconst deleteTooltipConfig = computed(() => buildTooltipConfig(t('g.delete')))\nconst moreTooltipConfig = computed(() => buildTooltipConfig(t('g.more')))\n\nconst rowRef = ref<HTMLDivElement | null>(null)\nconst showDetails = computed(() => props.activeDetailsId === props.jobId)\n\nconst onRowEnter = () => {\n  if (!isPreviewVisible.value) emit('details-enter', props.jobId)\n}\nconst onRowLeave = () => emit('details-leave', props.jobId)\nconst onPopoverEnter = () => emit('details-enter', props.jobId)\nconst onPopoverLeave = () => emit('details-leave', props.jobId)\n\nconst isPreviewVisible = ref(false)\nconst previewHideTimer = ref<number | null>(null)\nconst previewShowTimer = ref<number | null>(null)\nconst clearPreviewHideTimer = () => {\n  if (previewHideTimer.value !== null) {\n    clearTimeout(previewHideTimer.value)\n    previewHideTimer.value = null\n  }\n}\nconst clearPreviewShowTimer = () => {\n  if (previewShowTimer.value !== null) {\n    clearTimeout(previewShowTimer.value)\n    previewShowTimer.value = null\n  }\n}\nconst canShowPreview = computed(\n  () => props.state === 'completed' && !!props.iconImageUrl\n)\nconst scheduleShowPreview = () => {\n  if (!canShowPreview.value) return\n  clearPreviewHideTimer()\n  clearPreviewShowTimer()\n  previewShowTimer.value = window.setTimeout(() => {\n    isPreviewVisible.value = true\n    previewShowTimer.value = null\n  }, 200)\n}\nconst scheduleHidePreview = () => {\n  clearPreviewHideTimer()\n  clearPreviewShowTimer()\n  previewHideTimer.value = window.setTimeout(() => {\n    isPreviewVisible.value = false\n    previewHideTimer.value = null\n  }, 150)\n}\nconst onIconEnter = () => scheduleShowPreview()\nconst onIconLeave = () => scheduleHidePreview()\nconst onPreviewEnter = () => scheduleShowPreview()\nconst onPreviewLeave = () => scheduleHidePreview()\n\nconst popoverPosition = ref<{ top: number; right: number } | null>(null)\n\nconst updatePopoverPosition = () => {\n  const el = rowRef.value\n  if (!el) return\n  const rect = el.getBoundingClientRect()\n  const gap = 8\n  popoverPosition.value = {\n    top: rect.top,\n    right: window.innerWidth - rect.left + gap\n  }\n}\n\nconst isAnyPopoverVisible = computed(\n  () => showDetails.value || (isPreviewVisible.value && canShowPreview.value)\n)\n\nwatch(\n  isAnyPopoverVisible,\n  (visible) => {\n    if (visible) {\n      nextTick(updatePopoverPosition)\n    } else {\n      popoverPosition.value = null\n    }\n  },\n  { immediate: false }\n)\n\nconst isHovered = ref(false)\n\nconst iconClass = computed(() => {\n  if (props.iconName) return props.iconName\n  return iconForJobState(props.state)\n})\n\nconst shouldSpin = computed(\n  () =>\n    props.state === 'pending' &&\n    iconClass.value === iconForJobState('pending') &&\n    !props.iconImageUrl\n)\n\nconst computedShowClear = computed(() => {\n  if (props.showClear !== undefined) return props.showClear\n  return props.state !== 'completed'\n})\n\nconst emitDetailsLeave = () => emit('details-leave', props.jobId)\n\nconst onCancelClick = () => {\n  emitDetailsLeave()\n  emit('cancel')\n}\n\nconst onDeleteClick = () => {\n  emitDetailsLeave()\n  emit('delete')\n}\n\nconst onContextMenu = (event: MouseEvent) => {\n  const shouldShowMenu = props.showMenu !== undefined ? props.showMenu : true\n  if (shouldShowMenu) emit('menu', event)\n}\n</script>\n","<template>\n  <div class=\"flex flex-col gap-4 px-3 pb-4\">\n    <div\n      v-for=\"group in displayedJobGroups\"\n      :key=\"group.key\"\n      class=\"flex flex-col gap-2\"\n    >\n      <div class=\"text-[12px] leading-none text-text-secondary\">\n        {{ group.label }}\n      </div>\n      <QueueJobItem\n        v-for=\"ji in group.items\"\n        :key=\"ji.id\"\n        :job-id=\"ji.id\"\n        :workflow-id=\"ji.taskRef?.workflow?.id\"\n        :state=\"ji.state\"\n        :title=\"ji.title\"\n        :right-text=\"ji.meta\"\n        :icon-name=\"ji.iconName\"\n        :icon-image-url=\"ji.iconImageUrl\"\n        :show-clear=\"ji.showClear\"\n        :show-menu=\"true\"\n        :progress-total-percent=\"ji.progressTotalPercent\"\n        :progress-current-percent=\"ji.progressCurrentPercent\"\n        :running-node-name=\"ji.runningNodeName\"\n        :active-details-id=\"activeDetailsId\"\n        @cancel=\"emitCancelItem(ji)\"\n        @delete=\"emitDeleteItem(ji)\"\n        @menu=\"(ev) => $emit('menu', ji, ev)\"\n        @view=\"$emit('viewItem', ji)\"\n        @details-enter=\"onDetailsEnter\"\n        @details-leave=\"onDetailsLeave\"\n      />\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { onBeforeUnmount, ref, watch } from 'vue'\n\nimport QueueJobItem from '@/components/queue/job/QueueJobItem.vue'\nimport type { JobGroup, JobListItem } from '@/composables/queue/useJobList'\n\nconst props = defineProps<{ displayedJobGroups: JobGroup[] }>()\n\nconst emit = defineEmits<{\n  (e: 'cancelItem', item: JobListItem): void\n  (e: 'deleteItem', item: JobListItem): void\n  (e: 'menu', item: JobListItem, ev: MouseEvent): void\n  (e: 'viewItem', item: JobListItem): void\n}>()\n\nconst emitCancelItem = (item: JobListItem) => {\n  emit('cancelItem', item)\n}\n\nconst emitDeleteItem = (item: JobListItem) => {\n  emit('deleteItem', item)\n}\n\nconst activeDetailsId = ref<string | null>(null)\nconst hideTimer = ref<number | null>(null)\nconst showTimer = ref<number | null>(null)\nconst clearHideTimer = () => {\n  if (hideTimer.value !== null) {\n    clearTimeout(hideTimer.value)\n    hideTimer.value = null\n  }\n}\nconst clearShowTimer = () => {\n  if (showTimer.value !== null) {\n    clearTimeout(showTimer.value)\n    showTimer.value = null\n  }\n}\nconst onDetailsEnter = (jobId: string) => {\n  clearHideTimer()\n  clearShowTimer()\n  showTimer.value = window.setTimeout(() => {\n    activeDetailsId.value = jobId\n    showTimer.value = null\n  }, 200)\n}\nconst onDetailsLeave = (jobId: string) => {\n  clearHideTimer()\n  clearShowTimer()\n  hideTimer.value = window.setTimeout(() => {\n    if (activeDetailsId.value === jobId) activeDetailsId.value = null\n    hideTimer.value = null\n  }, 150)\n}\n\nconst resetActiveDetails = () => {\n  clearHideTimer()\n  clearShowTimer()\n  activeDetailsId.value = null\n}\n\nwatch(\n  () => props.displayedJobGroups,\n  (groups) => {\n    const activeId = activeDetailsId.value\n    if (!activeId) return\n\n    const hasActiveJob = groups.some((group) =>\n      group.items.some((item) => item.id === activeId)\n    )\n\n    if (!hasActiveJob) resetActiveDetails()\n  }\n)\n\nonBeforeUnmount(resetActiveDetails)\n</script>\n","<template>\n  <div class=\"flex w-full flex-col gap-4\">\n    <QueueOverlayHeader\n      :header-title=\"headerTitle\"\n      :show-concurrent-indicator=\"showConcurrentIndicator\"\n      :concurrent-workflow-count=\"concurrentWorkflowCount\"\n      @clear-history=\"$emit('clearHistory')\"\n    />\n\n    <div class=\"flex items-center justify-between px-3\">\n      <Button\n        class=\"grow gap-1 justify-center\"\n        variant=\"secondary\"\n        size=\"sm\"\n        @click=\"$emit('showAssets')\"\n      >\n        <i class=\"icon-[comfy--image-ai-edit] size-4\" />\n        <span>{{ t('sideToolbar.queueProgressOverlay.showAssets') }}</span>\n      </Button>\n      <div class=\"ml-4 inline-flex items-center\">\n        <div\n          class=\"inline-flex h-6 items-center text-[12px] leading-none text-text-primary opacity-90\"\n        >\n          <span class=\"font-bold\">{{ queuedCount }}</span>\n          <span class=\"ml-1\">{{\n            t('sideToolbar.queueProgressOverlay.queuedSuffix')\n          }}</span>\n        </div>\n        <Button\n          v-if=\"queuedCount > 0\"\n          class=\"ml-2\"\n          variant=\"destructive\"\n          size=\"icon\"\n          :aria-label=\"t('sideToolbar.queueProgressOverlay.clearQueued')\"\n          @click=\"$emit('clearQueued')\"\n        >\n          <i class=\"icon-[lucide--list-x] size-4\" />\n        </Button>\n      </div>\n    </div>\n\n    <JobFiltersBar\n      :selected-job-tab=\"selectedJobTab\"\n      :selected-workflow-filter=\"selectedWorkflowFilter\"\n      :selected-sort-mode=\"selectedSortMode\"\n      :has-failed-jobs=\"hasFailedJobs\"\n      @update:selected-job-tab=\"$emit('update:selectedJobTab', $event)\"\n      @update:selected-workflow-filter=\"\n        $emit('update:selectedWorkflowFilter', $event)\n      \"\n      @update:selected-sort-mode=\"$emit('update:selectedSortMode', $event)\"\n    />\n\n    <div class=\"flex-1 min-h-0 overflow-y-auto\">\n      <JobGroupsList\n        :displayed-job-groups=\"displayedJobGroups\"\n        @cancel-item=\"onCancelItemEvent\"\n        @delete-item=\"onDeleteItemEvent\"\n        @view-item=\"$emit('viewItem', $event)\"\n        @menu=\"onMenuItem\"\n      />\n    </div>\n\n    <JobContextMenu\n      ref=\"jobContextMenuRef\"\n      :entries=\"jobMenuEntries\"\n      @action=\"onJobMenuAction\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport Button from '@/components/ui/button/Button.vue'\nimport type {\n  JobGroup,\n  JobListItem,\n  JobSortMode,\n  JobTab\n} from '@/composables/queue/useJobList'\nimport type { MenuEntry } from '@/composables/queue/useJobMenu'\nimport { useJobMenu } from '@/composables/queue/useJobMenu'\n\nimport QueueOverlayHeader from './QueueOverlayHeader.vue'\nimport JobContextMenu from './job/JobContextMenu.vue'\nimport JobFiltersBar from './job/JobFiltersBar.vue'\nimport JobGroupsList from './job/JobGroupsList.vue'\n\ndefineProps<{\n  headerTitle: string\n  showConcurrentIndicator: boolean\n  concurrentWorkflowCount: number\n  queuedCount: number\n  selectedJobTab: JobTab\n  selectedWorkflowFilter: 'all' | 'current'\n  selectedSortMode: JobSortMode\n  displayedJobGroups: JobGroup[]\n  hasFailedJobs: boolean\n}>()\n\nconst emit = defineEmits<{\n  (e: 'showAssets'): void\n  (e: 'clearHistory'): void\n  (e: 'clearQueued'): void\n  (e: 'update:selectedJobTab', value: JobTab): void\n  (e: 'update:selectedWorkflowFilter', value: 'all' | 'current'): void\n  (e: 'update:selectedSortMode', value: JobSortMode): void\n  (e: 'cancelItem', item: JobListItem): void\n  (e: 'deleteItem', item: JobListItem): void\n  (e: 'viewItem', item: JobListItem): void\n}>()\n\nconst { t } = useI18n()\n\nconst currentMenuItem = ref<JobListItem | null>(null)\nconst jobContextMenuRef = ref<InstanceType<typeof JobContextMenu> | null>(null)\n\nconst { jobMenuEntries } = useJobMenu(\n  () => currentMenuItem.value,\n  (item) => emit('viewItem', item)\n)\n\nconst onCancelItemEvent = (item: JobListItem) => {\n  emit('cancelItem', item)\n}\n\nconst onDeleteItemEvent = (item: JobListItem) => {\n  emit('deleteItem', item)\n}\n\nconst onMenuItem = (item: JobListItem, event: Event) => {\n  currentMenuItem.value = item\n  jobContextMenuRef.value?.open(event)\n}\n\nconst onJobMenuAction = async (entry: MenuEntry) => {\n  if (entry.kind === 'divider') return\n  if (entry.onClick) await entry.onClick()\n  jobContextMenuRef.value?.hide()\n}\n</script>\n","<template>\n  <section\n    class=\"w-[360px] rounded-2xl border border-interface-stroke bg-interface-panel-surface text-text-primary shadow-interface font-inter\"\n  >\n    <header\n      class=\"flex items-center justify-between border-b border-interface-stroke px-4 py-4\"\n    >\n      <p class=\"m-0 text-[14px] font-normal leading-none\">\n        {{ t('sideToolbar.queueProgressOverlay.clearHistoryDialogTitle') }}\n      </p>\n      <Button\n        size=\"icon\"\n        variant=\"muted-textonly\"\n        :aria-label=\"t('g.close')\"\n        @click=\"onCancel\"\n      >\n        <i class=\"icon-[lucide--x] block size-4 leading-none\" />\n      </Button>\n    </header>\n\n    <div class=\"flex flex-col gap-4 px-4 py-4 text-[14px] text-text-secondary\">\n      <p class=\"m-0\">\n        {{\n          t('sideToolbar.queueProgressOverlay.clearHistoryDialogDescription')\n        }}\n      </p>\n      <p class=\"m-0\">\n        {{ t('sideToolbar.queueProgressOverlay.clearHistoryDialogAssetsNote') }}\n      </p>\n    </div>\n\n    <footer class=\"flex items-center justify-end px-4 py-4\">\n      <div class=\"flex items-center gap-4 leading-none\">\n        <Button variant=\"muted-textonly\" size=\"lg\" @click=\"onCancel\">\n          {{ t('g.cancel') }}\n        </Button>\n        <Button\n          variant=\"secondary\"\n          size=\"lg\"\n          :disabled=\"isClearing\"\n          @click=\"onConfirm\"\n          >{{ t('g.clear') }}</Button\n        >\n      </div>\n    </footer>\n  </section>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport Button from '@/components/ui/button/Button.vue'\nimport { useErrorHandling } from '@/composables/useErrorHandling'\nimport { useDialogStore } from '@/stores/dialogStore'\nimport { useQueueStore } from '@/stores/queueStore'\n\nconst dialogStore = useDialogStore()\nconst queueStore = useQueueStore()\nconst { t } = useI18n()\nconst { wrapWithErrorHandlingAsync } = useErrorHandling()\n\nconst isClearing = ref(false)\n\nconst clearHistory = wrapWithErrorHandlingAsync(\n  async () => {\n    await queueStore.clear(['history'])\n    dialogStore.closeDialog()\n  },\n  undefined,\n  () => {\n    isClearing.value = false\n  }\n)\n\nconst onConfirm = async () => {\n  if (isClearing.value) return\n  isClearing.value = true\n  await clearHistory()\n}\n\nconst onCancel = () => {\n  dialogStore.closeDialog()\n}\n</script>\n","import { computed, ref, watch } from 'vue'\n\nimport { useExecutionStore } from '@/stores/executionStore'\nimport { useQueueStore } from '@/stores/queueStore'\nimport { jobStateFromTask } from '@/utils/queueUtil'\n\nexport type CompletionSummaryMode = 'allSuccess' | 'mixed' | 'allFailed'\n\nexport type CompletionSummary = {\n  mode: CompletionSummaryMode\n  completedCount: number\n  failedCount: number\n  thumbnailUrls: string[]\n}\n\n/**\n * Tracks queue activity transitions and exposes a short-lived summary of the\n * most recent generation batch.\n */\nexport const useCompletionSummary = () => {\n  const queueStore = useQueueStore()\n  const executionStore = useExecutionStore()\n\n  const isActive = computed(\n    () => queueStore.runningTasks.length > 0 || !executionStore.isIdle\n  )\n\n  const lastActiveStartTs = ref<number | null>(null)\n  const _summary = ref<CompletionSummary | null>(null)\n  const dismissTimer = ref<number | null>(null)\n\n  const clearDismissTimer = () => {\n    if (dismissTimer.value !== null) {\n      clearTimeout(dismissTimer.value)\n      dismissTimer.value = null\n    }\n  }\n\n  const startDismissTimer = () => {\n    clearDismissTimer()\n    dismissTimer.value = window.setTimeout(() => {\n      _summary.value = null\n      dismissTimer.value = null\n    }, 6000)\n  }\n\n  const clearSummary = () => {\n    _summary.value = null\n    clearDismissTimer()\n  }\n\n  watch(\n    isActive,\n    (active, prev) => {\n      if (!prev && active) {\n        lastActiveStartTs.value = Date.now()\n      }\n      if (prev && !active) {\n        const start = lastActiveStartTs.value ?? 0\n        const finished = queueStore.historyTasks.filter((t: any) => {\n          const ts: number | undefined = t.executionEndTimestamp\n          return typeof ts === 'number' && ts >= start\n        })\n\n        if (!finished.length) {\n          _summary.value = null\n          clearDismissTimer()\n          return\n        }\n\n        let completedCount = 0\n        let failedCount = 0\n        const imagePreviews: string[] = []\n\n        for (const task of finished) {\n          const state = jobStateFromTask(task, false)\n          if (state === 'completed') {\n            completedCount++\n            const preview = task.previewOutput\n            if (preview?.isImage) {\n              imagePreviews.push(preview.urlWithTimestamp)\n            }\n          } else if (state === 'failed') {\n            failedCount++\n          }\n        }\n\n        if (completedCount === 0 && failedCount === 0) {\n          _summary.value = null\n          clearDismissTimer()\n          return\n        }\n\n        let mode: CompletionSummaryMode = 'mixed'\n        if (failedCount === 0) mode = 'allSuccess'\n        else if (completedCount === 0) mode = 'allFailed'\n\n        _summary.value = {\n          mode,\n          completedCount,\n          failedCount,\n          thumbnailUrls: imagePreviews.slice(0, 3)\n        }\n        startDismissTimer()\n      }\n    },\n    { immediate: true }\n  )\n\n  const summary = computed(() => _summary.value)\n\n  return {\n    summary,\n    clearSummary\n  }\n}\n","import { ref, shallowRef } from 'vue'\n\nimport type { JobListItem } from '@/composables/queue/useJobList'\nimport type { ResultItemImpl } from '@/stores/queueStore'\n\n/**\n * Manages result gallery state and activation for queue items.\n */\nexport function useResultGallery(getFilteredTasks: () => any[]) {\n  const galleryActiveIndex = ref(-1)\n  const galleryItems = shallowRef<ResultItemImpl[]>([])\n\n  const onViewItem = (item: JobListItem) => {\n    const items: ResultItemImpl[] = getFilteredTasks().flatMap((t: any) => {\n      const preview = t.previewOutput\n      return preview && preview.supportsPreview ? [preview] : []\n    })\n\n    if (!items.length) return\n\n    galleryItems.value = items\n    const activeUrl: string | undefined = item.taskRef?.previewOutput?.url\n    const idx = activeUrl ? items.findIndex((o) => o.url === activeUrl) : 0\n    galleryActiveIndex.value = idx >= 0 ? idx : 0\n  }\n\n  return {\n    galleryActiveIndex,\n    galleryItems,\n    onViewItem\n  }\n}\n","<template>\n  <div\n    v-show=\"isVisible\"\n    :class=\"['flex', 'justify-end', 'w-full', 'pointer-events-none']\"\n  >\n    <div\n      class=\"pointer-events-auto flex w-[350px] min-w-[310px] max-h-[60vh] flex-col overflow-hidden rounded-lg border font-inter transition-colors duration-200 ease-in-out\"\n      :class=\"containerClass\"\n      @mouseenter=\"isHovered = true\"\n      @mouseleave=\"isHovered = false\"\n    >\n      <!-- Expanded state -->\n      <QueueOverlayExpanded\n        v-if=\"isExpanded\"\n        v-model:selected-job-tab=\"selectedJobTab\"\n        v-model:selected-workflow-filter=\"selectedWorkflowFilter\"\n        v-model:selected-sort-mode=\"selectedSortMode\"\n        class=\"flex-1 min-h-0\"\n        :header-title=\"headerTitle\"\n        :show-concurrent-indicator=\"showConcurrentIndicator\"\n        :concurrent-workflow-count=\"concurrentWorkflowCount\"\n        :queued-count=\"queuedCount\"\n        :displayed-job-groups=\"displayedJobGroups\"\n        :has-failed-jobs=\"hasFailedJobs\"\n        @show-assets=\"openAssetsSidebar\"\n        @clear-history=\"onClearHistoryFromMenu\"\n        @clear-queued=\"cancelQueuedWorkflows\"\n        @cancel-item=\"onCancelItem\"\n        @delete-item=\"onDeleteItem\"\n        @view-item=\"inspectJobAsset\"\n      />\n\n      <QueueOverlayActive\n        v-else-if=\"hasActiveJob\"\n        :total-progress-style=\"totalProgressStyle\"\n        :current-node-progress-style=\"currentNodeProgressStyle\"\n        :total-percent-formatted=\"totalPercentFormatted\"\n        :current-node-percent-formatted=\"currentNodePercentFormatted\"\n        :current-node-name=\"currentNodeName\"\n        :running-count=\"runningCount\"\n        :queued-count=\"queuedCount\"\n        :bottom-row-class=\"bottomRowClass\"\n        @interrupt-all=\"interruptAll\"\n        @clear-queued=\"cancelQueuedWorkflows\"\n        @view-all-jobs=\"viewAllJobs\"\n      />\n\n      <QueueOverlayEmpty\n        v-else-if=\"completionSummary\"\n        :summary=\"completionSummary\"\n        @summary-click=\"onSummaryClick\"\n      />\n    </div>\n  </div>\n\n  <ResultGallery\n    v-model:active-index=\"galleryActiveIndex\"\n    :all-gallery-items=\"galleryItems\"\n  />\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, nextTick, ref } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport QueueOverlayActive from '@/components/queue/QueueOverlayActive.vue'\nimport QueueOverlayEmpty from '@/components/queue/QueueOverlayEmpty.vue'\nimport QueueOverlayExpanded from '@/components/queue/QueueOverlayExpanded.vue'\nimport QueueClearHistoryDialog from '@/components/queue/dialogs/QueueClearHistoryDialog.vue'\nimport ResultGallery from '@/components/sidebar/tabs/queue/ResultGallery.vue'\nimport { useCompletionSummary } from '@/composables/queue/useCompletionSummary'\nimport { useJobList } from '@/composables/queue/useJobList'\nimport type { JobListItem } from '@/composables/queue/useJobList'\nimport { useQueueProgress } from '@/composables/queue/useQueueProgress'\nimport { useResultGallery } from '@/composables/queue/useResultGallery'\nimport { useErrorHandling } from '@/composables/useErrorHandling'\nimport { useAssetSelectionStore } from '@/platform/assets/composables/useAssetSelectionStore'\nimport { isCloud } from '@/platform/distribution/types'\nimport { api } from '@/scripts/api'\nimport { useAssetsStore } from '@/stores/assetsStore'\nimport { useCommandStore } from '@/stores/commandStore'\nimport { useDialogStore } from '@/stores/dialogStore'\nimport { useExecutionStore } from '@/stores/executionStore'\nimport { useQueueStore } from '@/stores/queueStore'\nimport { useSidebarTabStore } from '@/stores/workspace/sidebarTabStore'\n\ntype OverlayState = 'hidden' | 'empty' | 'active' | 'expanded'\n\nconst props = withDefaults(\n  defineProps<{\n    expanded?: boolean\n    menuHovered?: boolean\n  }>(),\n  {\n    menuHovered: false\n  }\n)\n\nconst emit = defineEmits<{\n  (e: 'update:expanded', value: boolean): void\n}>()\n\nconst { t } = useI18n()\nconst queueStore = useQueueStore()\nconst commandStore = useCommandStore()\nconst executionStore = useExecutionStore()\nconst sidebarTabStore = useSidebarTabStore()\nconst dialogStore = useDialogStore()\nconst assetsStore = useAssetsStore()\nconst assetSelectionStore = useAssetSelectionStore()\nconst { wrapWithErrorHandlingAsync } = useErrorHandling()\n\nconst {\n  totalPercentFormatted,\n  currentNodePercentFormatted,\n  totalProgressStyle,\n  currentNodeProgressStyle\n} = useQueueProgress()\nconst isHovered = ref(false)\nconst isOverlayHovered = computed(() => isHovered.value || props.menuHovered)\nconst internalExpanded = ref(false)\nconst isExpanded = computed({\n  get: () =>\n    props.expanded === undefined ? internalExpanded.value : props.expanded,\n  set: (value) => {\n    if (props.expanded === undefined) {\n      internalExpanded.value = value\n    }\n    emit('update:expanded', value)\n  }\n})\n\nconst { summary: completionSummary, clearSummary } = useCompletionSummary()\nconst hasCompletionSummary = computed(() => completionSummary.value !== null)\n\nconst runningCount = computed(() => queueStore.runningTasks.length)\nconst queuedCount = computed(() => queueStore.pendingTasks.length)\nconst isExecuting = computed(() => !executionStore.isIdle)\nconst hasActiveJob = computed(() => runningCount.value > 0 || isExecuting.value)\nconst activeJobsCount = computed(() => runningCount.value + queuedCount.value)\n\nconst overlayState = computed<OverlayState>(() => {\n  if (isExpanded.value) return 'expanded'\n  if (hasActiveJob.value) return 'active'\n  if (hasCompletionSummary.value) return 'empty'\n  return 'hidden'\n})\n\nconst showBackground = computed(\n  () =>\n    overlayState.value === 'expanded' ||\n    overlayState.value === 'empty' ||\n    (overlayState.value === 'active' && isOverlayHovered.value)\n)\n\nconst isVisible = computed(() => overlayState.value !== 'hidden')\n\nconst containerClass = computed(() =>\n  showBackground.value\n    ? 'border-interface-stroke bg-interface-panel-surface shadow-interface'\n    : 'border-transparent bg-transparent shadow-none'\n)\n\nconst bottomRowClass = computed(\n  () =>\n    `flex items-center justify-end gap-4 transition-opacity duration-200 ease-in-out ${\n      overlayState.value === 'active' && isOverlayHovered.value\n        ? 'opacity-100 pointer-events-auto'\n        : 'opacity-0 pointer-events-none'\n    }`\n)\nconst headerTitle = computed(() =>\n  hasActiveJob.value\n    ? `${activeJobsCount.value} ${t('sideToolbar.queueProgressOverlay.activeJobsSuffix')}`\n    : t('sideToolbar.queueProgressOverlay.jobQueue')\n)\n\nconst concurrentWorkflowCount = computed(\n  () => executionStore.runningWorkflowCount\n)\nconst showConcurrentIndicator = computed(\n  () => concurrentWorkflowCount.value > 1\n)\n\nconst {\n  selectedJobTab,\n  selectedWorkflowFilter,\n  selectedSortMode,\n  hasFailedJobs,\n  filteredTasks,\n  groupedJobItems,\n  currentNodeName\n} = useJobList()\n\nconst displayedJobGroups = computed(() => groupedJobItems.value)\n\nconst onCancelItem = wrapWithErrorHandlingAsync(async (item: JobListItem) => {\n  const promptId = item.taskRef?.promptId\n  if (!promptId) return\n\n  if (item.state === 'running' || item.state === 'initialization') {\n    // Running/initializing jobs: interrupt execution\n    await api.interrupt(promptId)\n    await queueStore.update()\n  } else if (item.state === 'pending') {\n    // Pending jobs: remove from queue\n    await api.deleteItem('queue', promptId)\n    await queueStore.update()\n  }\n})\n\nconst onDeleteItem = wrapWithErrorHandlingAsync(async (item: JobListItem) => {\n  if (!item.taskRef) return\n  await queueStore.delete(item.taskRef)\n})\n\nconst {\n  galleryActiveIndex,\n  galleryItems,\n  onViewItem: openResultGallery\n} = useResultGallery(() => filteredTasks.value)\n\nconst setExpanded = (expanded: boolean) => {\n  isExpanded.value = expanded\n}\n\nconst openExpandedFromEmpty = () => {\n  setExpanded(true)\n}\n\nconst viewAllJobs = () => {\n  setExpanded(true)\n}\n\nconst onSummaryClick = () => {\n  openExpandedFromEmpty()\n  clearSummary()\n}\n\nconst openAssetsSidebar = () => {\n  sidebarTabStore.activeSidebarTabId = 'assets'\n}\n\nconst focusAssetInSidebar = async (item: JobListItem) => {\n  const task = item.taskRef\n  const promptId = task?.promptId\n  const preview = task?.previewOutput\n  if (!promptId || !preview) return\n\n  const assetId = String(promptId)\n  openAssetsSidebar()\n  await nextTick()\n  await assetsStore.updateHistory()\n  const asset = assetsStore.historyAssets.find(\n    (existingAsset) => existingAsset.id === assetId\n  )\n  if (!asset) {\n    throw new Error('Asset not found in media assets panel')\n  }\n  assetSelectionStore.setSelection([assetId])\n}\n\nconst inspectJobAsset = wrapWithErrorHandlingAsync(\n  async (item: JobListItem) => {\n    openResultGallery(item)\n    await focusAssetInSidebar(item)\n  }\n)\n\nconst cancelQueuedWorkflows = wrapWithErrorHandlingAsync(async () => {\n  await commandStore.execute('Comfy.ClearPendingTasks')\n})\n\nconst interruptAll = wrapWithErrorHandlingAsync(async () => {\n  const tasks = queueStore.runningTasks\n  const promptIds = tasks\n    .map((task) => task.promptId)\n    .filter((id): id is string => typeof id === 'string' && id.length > 0)\n\n  if (!promptIds.length) return\n\n  // Cloud backend supports cancelling specific jobs via /queue delete,\n  // while /interrupt always targets the \"first\" job. Use the targeted API\n  // on cloud to ensure we cancel the workflow the user clicked.\n  if (isCloud) {\n    await Promise.all(promptIds.map((id) => api.deleteItem('queue', id)))\n    return\n  }\n\n  await Promise.all(promptIds.map((id) => api.interrupt(id)))\n})\n\nconst showClearHistoryDialog = () => {\n  dialogStore.showDialog({\n    key: 'queue-clear-history',\n    component: QueueClearHistoryDialog,\n    dialogComponentProps: {\n      headless: true,\n      closable: false,\n      closeOnEscape: true,\n      dismissableMask: true,\n      pt: {\n        root: {\n          class: 'max-w-[360px] w-auto bg-transparent border-none shadow-none'\n        },\n        content: {\n          class: '!p-0 bg-transparent'\n        }\n      }\n    }\n  })\n}\n\nconst onClearHistoryFromMenu = () => {\n  showClearHistoryDialog()\n}\n</script>\n","import { defineStore } from 'pinia'\nimport { computed } from 'vue'\n\nimport type { ActionBarButton } from '@/types/comfy'\n\nimport { useExtensionStore } from './extensionStore'\n\nexport const useActionBarButtonStore = defineStore('actionBarButton', () => {\n  const extensionStore = useExtensionStore()\n\n  const buttons = computed<ActionBarButton[]>(() =>\n    extensionStore.extensions.flatMap((e) => e.actionBarButtons ?? [])\n  )\n\n  return {\n    buttons\n  }\n})\n","<template>\n  <div class=\"flex h-full shrink-0 items-center gap-1\">\n    <Button\n      v-for=\"(button, index) in actionBarButtonStore.buttons\"\n      :key=\"index\"\n      v-tooltip.bottom=\"button.tooltip\"\n      :aria-label=\"button.tooltip || button.label\"\n      :class=\"button.class\"\n      variant=\"muted-textonly\"\n      size=\"sm\"\n      class=\"h-7 rounded-full\"\n      @click=\"button.onClick\"\n    >\n      <i :class=\"button.icon\" />\n      <span v-if=\"!isMobile && button.label\">{{ button.label }}</span>\n    </Button>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport { breakpointsTailwind, useBreakpoints } from '@vueuse/core'\n\nimport Button from '@/components/ui/button/Button.vue'\nimport { useActionBarButtonStore } from '@/stores/actionBarButtonStore'\n\nconst actionBarButtonStore = useActionBarButtonStore()\n\nconst breakpoints = useBreakpoints(breakpointsTailwind)\nconst isMobile = breakpoints.smaller('sm')\n</script>\n","<!-- A popover that shows current user information and actions -->\n<template>\n  <div\n    class=\"current-user-popover w-80 -m-3 p-2 rounded-lg border border-border-default bg-base-background shadow-[1px_1px_8px_0_rgba(0,0,0,0.4)]\"\n  >\n    <!-- User Info Section -->\n    <div class=\"flex flex-col items-center px-0 py-3 mb-4\">\n      <UserAvatar\n        class=\"mb-1\"\n        :photo-url=\"userPhotoUrl\"\n        :pt:icon:class=\"{\n          'text-2xl!': !userPhotoUrl\n        }\"\n        size=\"large\"\n      />\n\n      <!-- User Details -->\n      <h3 class=\"my-0 mb-1 truncate text-base font-bold text-base-foreground\">\n        {{ userDisplayName || $t('g.user') }}\n      </h3>\n      <p v-if=\"userEmail\" class=\"my-0 truncate text-sm text-muted\">\n        {{ userEmail }}\n      </p>\n      <span\n        v-if=\"subscriptionTierName\"\n        class=\"my-0 text-xs text-foreground bg-secondary-background-hover rounded-full uppercase px-2 py-0.5 font-bold mt-2\"\n      >\n        {{ subscriptionTierName }}\n      </span>\n    </div>\n\n    <!-- Credits Section -->\n    <div v-if=\"isActiveSubscription\" class=\"flex items-center gap-2 px-4 py-2\">\n      <i class=\"icon-[lucide--component] text-amber-400 text-sm\" />\n      <Skeleton\n        v-if=\"authStore.isFetchingBalance\"\n        width=\"4rem\"\n        height=\"1.25rem\"\n        class=\"w-full\"\n      />\n      <span v-else class=\"text-base font-semibold text-base-foreground\">{{\n        formattedBalance\n      }}</span>\n      <i\n        v-tooltip=\"{ value: $t('credits.unified.tooltip'), showDelay: 300 }\"\n        class=\"icon-[lucide--circle-help] cursor-help text-base text-muted-foreground mr-auto\"\n      />\n      <Button\n        variant=\"secondary\"\n        size=\"sm\"\n        class=\"text-base-foreground\"\n        data-testid=\"add-credits-button\"\n        @click=\"handleTopUp\"\n      >\n        {{ $t('subscription.addCredits') }}\n      </Button>\n    </div>\n\n    <div v-else class=\"flex justify-center px-4\">\n      <SubscribeButton\n        :fluid=\"false\"\n        :label=\"$t('subscription.subscribeToComfyCloud')\"\n        size=\"sm\"\n        variant=\"gradient\"\n        @subscribed=\"handleSubscribed\"\n      />\n    </div>\n\n    <Divider class=\"my-2 mx-0\" />\n\n    <div\n      v-if=\"isActiveSubscription\"\n      class=\"flex items-center gap-2 px-4 py-2 cursor-pointer hover:bg-secondary-background-hover\"\n      data-testid=\"partner-nodes-menu-item\"\n      @click=\"handleOpenPartnerNodesInfo\"\n    >\n      <i class=\"icon-[lucide--tag] text-muted-foreground text-sm\" />\n      <span class=\"text-sm text-base-foreground flex-1\">{{\n        $t('subscription.partnerNodesCredits')\n      }}</span>\n    </div>\n\n    <div\n      class=\"flex items-center gap-2 px-4 py-2 cursor-pointer hover:bg-secondary-background-hover\"\n      data-testid=\"plans-pricing-menu-item\"\n      @click=\"handleOpenPlansAndPricing\"\n    >\n      <i class=\"icon-[lucide--receipt-text] text-muted-foreground text-sm\" />\n      <span class=\"text-sm text-base-foreground flex-1\">{{\n        $t('subscription.plansAndPricing')\n      }}</span>\n      <span\n        v-if=\"canUpgrade\"\n        class=\"text-xs font-bold text-base-background bg-base-foreground px-1.5 py-0.5 rounded-full\"\n      >\n        {{ $t('subscription.upgrade') }}\n      </span>\n    </div>\n\n    <div\n      v-if=\"isActiveSubscription\"\n      class=\"flex items-center gap-2 px-4 py-2 cursor-pointer hover:bg-secondary-background-hover\"\n      data-testid=\"manage-plan-menu-item\"\n      @click=\"handleOpenPlanAndCreditsSettings\"\n    >\n      <i class=\"icon-[lucide--file-text] text-muted-foreground text-sm\" />\n      <span class=\"text-sm text-base-foreground flex-1\">{{\n        $t('subscription.managePlan')\n      }}</span>\n    </div>\n\n    <div\n      class=\"flex items-center gap-2 px-4 py-2 cursor-pointer hover:bg-secondary-background-hover\"\n      data-testid=\"user-settings-menu-item\"\n      @click=\"handleOpenUserSettings\"\n    >\n      <i class=\"icon-[lucide--settings-2] text-muted-foreground text-sm\" />\n      <span class=\"text-sm text-base-foreground flex-1\">{{\n        $t('userSettings.accountSettings')\n      }}</span>\n    </div>\n\n    <Divider class=\"my-2 mx-0\" />\n\n    <div\n      class=\"flex items-center gap-2 px-4 py-2 cursor-pointer hover:bg-secondary-background-hover\"\n      data-testid=\"logout-menu-item\"\n      @click=\"handleLogout\"\n    >\n      <i class=\"icon-[lucide--log-out] text-muted-foreground text-sm\" />\n      <span class=\"text-sm text-base-foreground flex-1\">{{\n        $t('auth.signOut.signOut')\n      }}</span>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport Divider from 'primevue/divider'\nimport Skeleton from 'primevue/skeleton'\nimport { computed, onMounted } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport { formatCreditsFromCents } from '@/base/credits/comfyCredits'\nimport UserAvatar from '@/components/common/UserAvatar.vue'\nimport Button from '@/components/ui/button/Button.vue'\nimport { useCurrentUser } from '@/composables/auth/useCurrentUser'\nimport { useFirebaseAuthActions } from '@/composables/auth/useFirebaseAuthActions'\nimport { useExternalLink } from '@/composables/useExternalLink'\nimport SubscribeButton from '@/platform/cloud/subscription/components/SubscribeButton.vue'\nimport { useSubscription } from '@/platform/cloud/subscription/composables/useSubscription'\nimport { useSubscriptionDialog } from '@/platform/cloud/subscription/composables/useSubscriptionDialog'\nimport { isCloud } from '@/platform/distribution/types'\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useDialogService } from '@/services/dialogService'\nimport { useFirebaseAuthStore } from '@/stores/firebaseAuthStore'\n\nconst emit = defineEmits<{\n  close: []\n}>()\n\nconst { buildDocsUrl, docsPaths } = useExternalLink()\n\nconst { userDisplayName, userEmail, userPhotoUrl, handleSignOut } =\n  useCurrentUser()\nconst authActions = useFirebaseAuthActions()\nconst authStore = useFirebaseAuthStore()\nconst dialogService = useDialogService()\nconst {\n  isActiveSubscription,\n  subscriptionTierName,\n  subscriptionTier,\n  fetchStatus\n} = useSubscription()\nconst subscriptionDialog = useSubscriptionDialog()\nconst { locale } = useI18n()\n\nconst formattedBalance = computed(() => {\n  const cents =\n    authStore.balance?.effective_balance_micros ??\n    authStore.balance?.amount_micros ??\n    0\n  return formatCreditsFromCents({\n    cents,\n    locale: locale.value,\n    numberOptions: {\n      minimumFractionDigits: 0,\n      maximumFractionDigits: 2\n    }\n  })\n})\n\nconst canUpgrade = computed(() => {\n  const tier = subscriptionTier.value\n  return (\n    tier === 'FOUNDERS_EDITION' || tier === 'STANDARD' || tier === 'CREATOR'\n  )\n})\n\nconst handleOpenUserSettings = () => {\n  dialogService.showSettingsDialog('user')\n  emit('close')\n}\n\nconst handleOpenPlansAndPricing = () => {\n  subscriptionDialog.show()\n  emit('close')\n}\n\nconst handleOpenPlanAndCreditsSettings = () => {\n  if (isCloud) {\n    dialogService.showSettingsDialog('subscription')\n  } else {\n    dialogService.showSettingsDialog('credits')\n  }\n\n  emit('close')\n}\n\nconst handleTopUp = () => {\n  // Track purchase credits entry from avatar popover\n  useTelemetry()?.trackAddApiCreditButtonClicked()\n  dialogService.showTopUpCreditsDialog()\n  emit('close')\n}\n\nconst handleOpenPartnerNodesInfo = () => {\n  window.open(\n    buildDocsUrl(docsPaths.partnerNodesPricing, { includeLocale: true }),\n    '_blank'\n  )\n  emit('close')\n}\n\nconst handleLogout = async () => {\n  await handleSignOut()\n  emit('close')\n}\n\nconst handleSubscribed = async () => {\n  await fetchStatus()\n}\n\nonMounted(() => {\n  void authActions.fetchBalance()\n})\n</script>\n","<!-- A button that shows current authenticated user's avatar -->\n<template>\n  <div>\n    <Button\n      v-if=\"isLoggedIn\"\n      class=\"p-1 hover:bg-transparent\"\n      variant=\"muted-textonly\"\n      :aria-label=\"$t('g.currentUser')\"\n      @click=\"popover?.toggle($event)\"\n    >\n      <div\n        class=\"flex items-center gap-1 rounded-full hover:bg-interface-button-hover-surface\"\n      >\n        <UserAvatar :photo-url=\"photoURL\" />\n\n        <i class=\"icon-[lucide--chevron-down] size-3 px-1\" />\n      </div>\n    </Button>\n\n    <Popover\n      ref=\"popover\"\n      :show-arrow=\"false\"\n      :pt=\"{\n        root: {\n          class: 'rounded-lg'\n        }\n      }\"\n    >\n      <CurrentUserPopover @close=\"closePopover\" />\n    </Popover>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport Popover from 'primevue/popover'\nimport { computed, ref } from 'vue'\n\nimport UserAvatar from '@/components/common/UserAvatar.vue'\nimport Button from '@/components/ui/button/Button.vue'\nimport { useCurrentUser } from '@/composables/auth/useCurrentUser'\n\nimport CurrentUserPopover from './CurrentUserPopover.vue'\n\nconst { isLoggedIn, userPhotoUrl } = useCurrentUser()\n\nconst popover = ref<InstanceType<typeof Popover> | null>(null)\nconst photoURL = computed<string | undefined>(\n  () => userPhotoUrl.value ?? undefined\n)\n\nconst closePopover = () => {\n  popover.value?.hide()\n}\n</script>\n","<template>\n  <Button\n    v-if=\"!isLoggedIn\"\n    variant=\"secondary\"\n    size=\"icon\"\n    class=\"rounded-full bg-secondary-background text-base-foreground hover:bg-secondary-background-hover\"\n    :aria-label=\"t('g.login')\"\n    @click=\"handleSignIn()\"\n    @mouseenter=\"showPopover\"\n    @mouseleave=\"hidePopover\"\n  >\n    <i class=\"icon-[lucide--user] size-4\" />\n  </Button>\n  <Popover\n    ref=\"popoverRef\"\n    class=\"p-2\"\n    @mouseout=\"hidePopover\"\n    @mouseover=\"cancelHidePopover\"\n  >\n    <div>\n      <div class=\"mb-1\">{{ t('auth.loginButton.tooltipHelp') }}</div>\n      <a\n        :href=\"apiNodesOverviewUrl\"\n        target=\"_blank\"\n        class=\"text-neutral-500 hover:text-primary\"\n        >{{ t('auth.loginButton.tooltipLearnMore') }}</a\n      >\n    </div>\n  </Popover>\n</template>\n\n<script setup lang=\"ts\">\nimport Popover from 'primevue/popover'\nimport { ref } from 'vue'\n\nimport Button from '@/components/ui/button/Button.vue'\nimport { useCurrentUser } from '@/composables/auth/useCurrentUser'\nimport { useExternalLink } from '@/composables/useExternalLink'\nimport { t } from '@/i18n'\n\nconst { isLoggedIn, handleSignIn } = useCurrentUser()\nconst { buildDocsUrl } = useExternalLink()\nconst apiNodesOverviewUrl = buildDocsUrl(\n  '/tutorials/api-nodes/overview#api-nodes',\n  {\n    includeLocale: true\n  }\n)\nconst popoverRef = ref<InstanceType<typeof Popover> | null>(null)\nlet hideTimeout: ReturnType<typeof setTimeout> | null = null\nlet showTimeout: ReturnType<typeof setTimeout> | null = null\n\nconst showPopover = (event: Event) => {\n  // Clear any existing timeouts\n  if (hideTimeout) {\n    clearTimeout(hideTimeout)\n    hideTimeout = null\n  }\n  if (showTimeout) {\n    clearTimeout(showTimeout)\n    showTimeout = null\n  }\n\n  showTimeout = setTimeout(() => {\n    if (popoverRef.value) {\n      popoverRef.value.show(event, event.target as HTMLElement)\n    }\n  }, 200)\n}\n\nconst cancelHidePopover = () => {\n  if (hideTimeout) {\n    clearTimeout(hideTimeout)\n    hideTimeout = null\n  }\n}\n\nconst hidePopover = () => {\n  // Clear show timeout if mouse leaves before popover appears\n  if (showTimeout) {\n    clearTimeout(showTimeout)\n    showTimeout = null\n  }\n\n  hideTimeout = setTimeout(() => {\n    if (popoverRef.value) {\n      popoverRef.value.hide()\n    }\n  }, 150) // Minimal delay to allow moving to popover\n}\n</script>\n","import type { AxiosError, AxiosResponse } from 'axios'\nimport axios from 'axios'\nimport { ref, watch } from 'vue'\n\nimport { getComfyApiBaseUrl } from '@/config/comfyApi'\nimport type { components, operations } from '@/types/comfyRegistryTypes'\nimport { isAbortError } from '@/utils/typeGuardUtil'\n\n// Use generated types from OpenAPI spec\nexport type ReleaseNote = components['schemas']['ReleaseNote']\ntype GetReleasesParams = operations['getReleaseNotes']['parameters']['query']\n\n// Use generated error response type\ntype ErrorResponse = components['schemas']['ErrorResponse']\n\nconst releaseApiClient = axios.create({\n  baseURL: getComfyApiBaseUrl(),\n  headers: {\n    'Content-Type': 'application/json'\n  }\n})\n\n// Release service for fetching release notes\nexport const useReleaseService = () => {\n  const isLoading = ref(false)\n  const error = ref<string | null>(null)\n\n  watch(\n    () => getComfyApiBaseUrl(),\n    (url) => {\n      releaseApiClient.defaults.baseURL = url\n    }\n  )\n\n  // No transformation needed - API response matches the generated type\n\n  // Handle API errors with context\n  const handleApiError = (\n    err: unknown,\n    context: string,\n    routeSpecificErrors?: Record<number, string>\n  ): string => {\n    if (!axios.isAxiosError(err))\n      return err instanceof Error\n        ? `${context}: ${err.message}`\n        : `${context}: Unknown error occurred`\n\n    const axiosError = err as AxiosError<ErrorResponse>\n\n    if (axiosError.response) {\n      const { status, data } = axiosError.response\n\n      if (routeSpecificErrors && routeSpecificErrors[status])\n        return routeSpecificErrors[status]\n\n      switch (status) {\n        case 400:\n          return `Bad request: ${data?.message || 'Invalid input'}`\n        case 401:\n          return 'Unauthorized: Authentication required'\n        case 403:\n          return `Forbidden: ${data?.message || 'Access denied'}`\n        case 404:\n          return `Not found: ${data?.message || 'Resource not found'}`\n        case 500:\n          return `Server error: ${data?.message || 'Internal server error'}`\n        default:\n          return `${context}: ${data?.message || axiosError.message}`\n      }\n    }\n\n    return `${context}: ${axiosError.message}`\n  }\n\n  // Execute API request with error handling\n  const executeApiRequest = async <T>(\n    apiCall: () => Promise<AxiosResponse<T>>,\n    errorContext: string,\n    routeSpecificErrors?: Record<number, string>\n  ): Promise<T | null> => {\n    isLoading.value = true\n    error.value = null\n\n    try {\n      const response = await apiCall()\n      return response.data\n    } catch (err) {\n      // Don't treat cancellations as errors\n      if (isAbortError(err)) return null\n\n      error.value = handleApiError(err, errorContext, routeSpecificErrors)\n      return null\n    } finally {\n      isLoading.value = false\n    }\n  }\n\n  // Fetch release notes from API\n  const getReleases = async (\n    params: GetReleasesParams,\n    signal?: AbortSignal\n  ): Promise<ReleaseNote[] | null> => {\n    const endpoint = '/releases'\n    const errorContext = 'Failed to get releases'\n    const routeSpecificErrors = {\n      400: 'Invalid project or version parameter'\n    }\n\n    const apiResponse = await executeApiRequest(\n      () =>\n        releaseApiClient.get<ReleaseNote[]>(endpoint, {\n          params,\n          signal\n        }),\n      errorContext,\n      routeSpecificErrors\n    )\n\n    return apiResponse\n  }\n\n  return {\n    isLoading,\n    error,\n    getReleases\n  }\n}\n","import { until } from '@vueuse/core'\nimport { defineStore } from 'pinia'\nimport { compare, valid } from 'semver'\nimport { computed, ref } from 'vue'\n\nimport { isCloud } from '@/platform/distribution/types'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useSystemStatsStore } from '@/stores/systemStatsStore'\nimport { isElectron } from '@/utils/envUtil'\nimport { stringToLocale } from '@/utils/formatUtil'\n\nimport { useReleaseService } from './releaseService'\nimport type { ReleaseNote } from './releaseService'\n\n// Store for managing release notes\nexport const useReleaseStore = defineStore('release', () => {\n  // State\n  const releases = ref<ReleaseNote[]>([])\n  const isLoading = ref(false)\n  const error = ref<string | null>(null)\n\n  // Services\n  const releaseService = useReleaseService()\n  const systemStatsStore = useSystemStatsStore()\n  const settingStore = useSettingStore()\n\n  const currentVersion = computed(() => {\n    if (isCloud) {\n      return systemStatsStore?.systemStats?.system?.cloud_version ?? ''\n    }\n    return systemStatsStore?.systemStats?.system?.comfyui_version ?? ''\n  })\n\n  // Release data from settings\n  const locale = computed(() => settingStore.get('Comfy.Locale'))\n  const releaseVersion = computed(() =>\n    settingStore.get('Comfy.Release.Version')\n  )\n  const releaseStatus = computed(() => settingStore.get('Comfy.Release.Status'))\n  const releaseTimestamp = computed(() =>\n    settingStore.get('Comfy.Release.Timestamp')\n  )\n  const showVersionUpdates = computed(() =>\n    settingStore.get('Comfy.Notification.ShowVersionUpdates')\n  )\n\n  // Most recent release\n  const recentRelease = computed(() => {\n    return releases.value[0] ?? null\n  })\n\n  // 3 most recent releases\n  const recentReleases = computed(() => {\n    return releases.value.slice(0, 3)\n  })\n\n  // Helper constants\n  const THREE_DAYS_MS = 3 * 24 * 60 * 60 * 1000 // 3 days\n\n  const compareVersions = (\n    releaseVersion: string,\n    currentVer: string\n  ): number => {\n    if (valid(releaseVersion) && valid(currentVer)) {\n      return compare(releaseVersion, currentVer)\n    }\n    // Non-semver (e.g. git hash): assume different = newer\n    return releaseVersion === currentVer ? 0 : 1\n  }\n\n  // New version available?\n  const isNewVersionAvailable = computed(\n    () =>\n      !!recentRelease.value &&\n      compareVersions(\n        recentRelease.value.version,\n        currentVersion.value || '0.0.0'\n      ) > 0\n  )\n\n  const isLatestVersion = computed(\n    () =>\n      !!recentRelease.value &&\n      compareVersions(\n        recentRelease.value.version,\n        currentVersion.value || '0.0.0'\n      ) === 0\n  )\n\n  const hasMediumOrHighAttention = computed(() => {\n    const attention = recentRelease.value?.attention\n    return attention === 'medium' || attention === 'high'\n  })\n\n  // Show toast if needed\n  const shouldShowToast = computed(() => {\n    // Only show on desktop version\n    if (!isElectron() || isCloud) {\n      return false\n    }\n\n    // Skip if notifications are disabled\n    if (!showVersionUpdates.value) {\n      return false\n    }\n\n    if (!isNewVersionAvailable.value) {\n      return false\n    }\n\n    // Skip if low attention\n    if (!hasMediumOrHighAttention.value) {\n      return false\n    }\n\n    // Skip if user already skipped or changelog seen\n    if (\n      releaseVersion.value === recentRelease.value?.version &&\n      ['skipped', 'changelog seen'].includes(releaseStatus.value)\n    ) {\n      return false\n    }\n\n    return true\n  })\n\n  // Show red-dot indicator\n  const shouldShowRedDot = computed(() => {\n    // Only show on desktop version\n    if (!isElectron() || isCloud) {\n      return false\n    }\n\n    // Skip if notifications are disabled\n    if (!showVersionUpdates.value) {\n      return false\n    }\n\n    // Already latest  no dot\n    if (!isNewVersionAvailable.value) {\n      return false\n    }\n\n    const { version } = recentRelease.value\n\n    // Changelog seen  clear dot\n    if (\n      releaseVersion.value === version &&\n      releaseStatus.value === 'changelog seen'\n    ) {\n      return false\n    }\n\n    // Attention medium / high (levels 2 & 3)\n    if (hasMediumOrHighAttention.value) {\n      // Persist until changelog is opened\n      return true\n    }\n\n    // Attention low (level 1) and skipped  keep up to 3 d\n    if (\n      releaseVersion.value === version &&\n      releaseStatus.value === 'skipped' &&\n      releaseTimestamp.value &&\n      Date.now() - releaseTimestamp.value >= THREE_DAYS_MS\n    ) {\n      return false\n    }\n\n    // Not skipped  show\n    return true\n  })\n\n  const shouldShowPopup = computed(() => {\n    if (!isElectron() && !isCloud) {\n      return false\n    }\n\n    if (!showVersionUpdates.value) {\n      return false\n    }\n\n    if (!recentRelease.value) {\n      return false\n    }\n\n    // Skip version check if current version isn't semver (e.g. git hash)\n    const skipVersionCheck = !valid(currentVersion.value)\n    if (!skipVersionCheck && !isLatestVersion.value) {\n      return false\n    }\n\n    if (\n      releaseVersion.value === recentRelease.value.version &&\n      releaseStatus.value === \"what's new seen\"\n    ) {\n      return false\n    }\n\n    return true\n  })\n\n  // Action handlers for user interactions\n  async function handleSkipRelease(version: string): Promise<void> {\n    if (\n      version !== recentRelease.value?.version ||\n      releaseStatus.value === 'changelog seen'\n    ) {\n      return\n    }\n\n    await settingStore.set('Comfy.Release.Version', version)\n    await settingStore.set('Comfy.Release.Status', 'skipped')\n    await settingStore.set('Comfy.Release.Timestamp', Date.now())\n  }\n\n  async function handleShowChangelog(version: string): Promise<void> {\n    if (version !== recentRelease.value?.version) {\n      return\n    }\n\n    await settingStore.set('Comfy.Release.Version', version)\n    await settingStore.set('Comfy.Release.Status', 'changelog seen')\n    await settingStore.set('Comfy.Release.Timestamp', Date.now())\n  }\n\n  async function handleWhatsNewSeen(version: string): Promise<void> {\n    if (version !== recentRelease.value?.version) {\n      return\n    }\n\n    await settingStore.set('Comfy.Release.Version', version)\n    await settingStore.set('Comfy.Release.Status', \"what's new seen\")\n    await settingStore.set('Comfy.Release.Timestamp', Date.now())\n  }\n\n  // Fetch releases from API\n  async function fetchReleases(): Promise<void> {\n    if (isLoading.value) {\n      return\n    }\n\n    if (!isCloud && !showVersionUpdates.value) {\n      return\n    }\n\n    // Skip fetching if API nodes are disabled via argv\n    if (\n      systemStatsStore.systemStats?.system?.argv?.includes(\n        '--disable-api-nodes'\n      )\n    ) {\n      return\n    }\n    isLoading.value = true\n    error.value = null\n\n    try {\n      // Ensure system stats are loaded\n      if (!systemStatsStore.systemStats) {\n        await until(systemStatsStore.isInitialized)\n      }\n\n      const fetchedReleases = await releaseService.getReleases({\n        project: isCloud ? 'cloud' : 'comfyui',\n        current_version: currentVersion.value,\n        form_factor: systemStatsStore.getFormFactor(),\n        locale: stringToLocale(locale.value)\n      })\n\n      if (fetchedReleases !== null) {\n        releases.value = fetchedReleases\n      } else if (releaseService.error.value) {\n        error.value = releaseService.error.value\n      }\n    } catch (err) {\n      error.value =\n        err instanceof Error ? err.message : 'Unknown error occurred'\n    } finally {\n      isLoading.value = false\n    }\n  }\n\n  // Initialize store\n  async function initialize(): Promise<void> {\n    await fetchReleases()\n  }\n\n  return {\n    releases,\n    isLoading,\n    error,\n    recentRelease,\n    recentReleases,\n    shouldShowToast,\n    shouldShowRedDot,\n    shouldShowPopup,\n    shouldShowUpdateButton: isNewVersionAvailable,\n    handleSkipRelease,\n    handleShowChangelog,\n    handleWhatsNewSeen,\n    fetchReleases,\n    initialize\n  }\n})\n","<template>\n  <div\n    v-if=\"!workspaceStore.focusMode\"\n    class=\"ml-1 flex gap-x-0.5 pt-1\"\n    @mouseenter=\"isTopMenuHovered = true\"\n    @mouseleave=\"isTopMenuHovered = false\"\n  >\n    <div class=\"min-w-0 flex-1\">\n      <SubgraphBreadcrumb />\n    </div>\n\n    <div class=\"mx-1 flex flex-col items-end gap-1\">\n      <div class=\"flex items-center gap-2\">\n        <div\n          v-if=\"managerState.shouldShowManagerButtons.value\"\n          class=\"pointer-events-auto flex h-12 shrink-0 items-center rounded-lg border border-interface-stroke bg-comfy-menu-bg px-2 shadow-interface\"\n        >\n          <Button\n            v-tooltip.bottom=\"customNodesManagerTooltipConfig\"\n            variant=\"secondary\"\n            size=\"icon\"\n            :aria-label=\"t('menu.customNodesManager')\"\n            class=\"relative\"\n            @click=\"openCustomNodeManager\"\n          >\n            <i class=\"icon-[lucide--puzzle] size-4\" />\n            <span\n              v-if=\"shouldShowRedDot\"\n              class=\"absolute top-0.5 right-1 size-2 rounded-full bg-red-500\"\n            />\n          </Button>\n        </div>\n\n        <div\n          class=\"actionbar-container pointer-events-auto flex gap-2 h-12 items-center rounded-lg border border-interface-stroke bg-comfy-menu-bg px-2 shadow-interface\"\n        >\n          <ActionBarButtons />\n          <!-- Support for legacy topbar elements attached by custom scripts, hidden if no elements present -->\n          <div\n            ref=\"legacyCommandsContainerRef\"\n            class=\"[&:not(:has(*>*:not(:empty)))]:hidden\"\n          ></div>\n          <ComfyActionbar />\n          <Button\n            v-tooltip.bottom=\"queueHistoryTooltipConfig\"\n            type=\"destructive\"\n            size=\"icon\"\n            :aria-pressed=\"isQueueOverlayExpanded\"\n            :aria-label=\"\n              t('sideToolbar.queueProgressOverlay.expandCollapsedQueue')\n            \"\n            @click=\"toggleQueueOverlay\"\n          >\n            <i class=\"icon-[lucide--history] size-4\" />\n            <span\n              v-if=\"queuedCount > 0\"\n              class=\"absolute -top-1 -right-1 min-w-[16px] rounded-full bg-primary-background py-0.25 text-[10px] font-medium leading-[14px] text-base-foreground\"\n            >\n              {{ queuedCount }}\n            </span>\n          </Button>\n          <CurrentUserButton v-if=\"isLoggedIn\" class=\"shrink-0\" />\n          <LoginButton v-else-if=\"isDesktop\" />\n          <Button\n            v-if=\"!isRightSidePanelOpen\"\n            v-tooltip.bottom=\"rightSidePanelTooltipConfig\"\n            type=\"secondary\"\n            size=\"icon\"\n            :aria-label=\"t('rightSidePanel.togglePanel')\"\n            @click=\"rightSidePanelStore.togglePanel\"\n          >\n            <i class=\"icon-[lucide--panel-right] size-4\" />\n          </Button>\n        </div>\n      </div>\n      <QueueProgressOverlay\n        v-model:expanded=\"isQueueOverlayExpanded\"\n        :menu-hovered=\"isTopMenuHovered\"\n      />\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { storeToRefs } from 'pinia'\nimport { computed, onMounted, ref } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport ComfyActionbar from '@/components/actionbar/ComfyActionbar.vue'\nimport SubgraphBreadcrumb from '@/components/breadcrumb/SubgraphBreadcrumb.vue'\nimport QueueProgressOverlay from '@/components/queue/QueueProgressOverlay.vue'\nimport ActionBarButtons from '@/components/topbar/ActionBarButtons.vue'\nimport CurrentUserButton from '@/components/topbar/CurrentUserButton.vue'\nimport LoginButton from '@/components/topbar/LoginButton.vue'\nimport Button from '@/components/ui/button/Button.vue'\nimport { useCurrentUser } from '@/composables/auth/useCurrentUser'\nimport { useErrorHandling } from '@/composables/useErrorHandling'\nimport { buildTooltipConfig } from '@/composables/useTooltipConfig'\nimport { useReleaseStore } from '@/platform/updates/common/releaseStore'\nimport { app } from '@/scripts/app'\nimport { useCommandStore } from '@/stores/commandStore'\nimport { useQueueStore, useQueueUIStore } from '@/stores/queueStore'\nimport { useRightSidePanelStore } from '@/stores/workspace/rightSidePanelStore'\nimport { useWorkspaceStore } from '@/stores/workspaceStore'\nimport { isElectron } from '@/utils/envUtil'\nimport { useConflictAcknowledgment } from '@/workbench/extensions/manager/composables/useConflictAcknowledgment'\nimport { useManagerState } from '@/workbench/extensions/manager/composables/useManagerState'\nimport { ManagerTab } from '@/workbench/extensions/manager/types/comfyManagerTypes'\n\nconst workspaceStore = useWorkspaceStore()\nconst rightSidePanelStore = useRightSidePanelStore()\nconst managerState = useManagerState()\nconst { isLoggedIn } = useCurrentUser()\nconst isDesktop = isElectron()\nconst { t } = useI18n()\nconst { toastErrorHandler } = useErrorHandling()\nconst commandStore = useCommandStore()\nconst queueStore = useQueueStore()\nconst queueUIStore = useQueueUIStore()\nconst { isOverlayExpanded: isQueueOverlayExpanded } = storeToRefs(queueUIStore)\nconst releaseStore = useReleaseStore()\nconst { shouldShowRedDot: showReleaseRedDot } = storeToRefs(releaseStore)\nconst { shouldShowRedDot: shouldShowConflictRedDot } =\n  useConflictAcknowledgment()\nconst isTopMenuHovered = ref(false)\nconst queuedCount = computed(() => queueStore.pendingTasks.length)\nconst queueHistoryTooltipConfig = computed(() =>\n  buildTooltipConfig(t('sideToolbar.queueProgressOverlay.viewJobHistory'))\n)\nconst customNodesManagerTooltipConfig = computed(() =>\n  buildTooltipConfig(t('menu.customNodesManager'))\n)\n\n// Use either release red dot or conflict red dot\nconst shouldShowRedDot = computed((): boolean => {\n  const releaseRedDot = showReleaseRedDot.value\n  return releaseRedDot || shouldShowConflictRedDot.value\n})\n\n// Right side panel toggle\nconst { isOpen: isRightSidePanelOpen } = storeToRefs(rightSidePanelStore)\nconst rightSidePanelTooltipConfig = computed(() =>\n  buildTooltipConfig(t('rightSidePanel.togglePanel'))\n)\n\n// Maintain support for legacy topbar elements attached by custom scripts\nconst legacyCommandsContainerRef = ref<HTMLElement>()\nonMounted(() => {\n  if (legacyCommandsContainerRef.value) {\n    app.menu.element.style.width = 'fit-content'\n    legacyCommandsContainerRef.value.appendChild(app.menu.element)\n  }\n})\n\nconst toggleQueueOverlay = () => {\n  commandStore.execute('Comfy.Queue.ToggleOverlay')\n}\n\nconst openCustomNodeManager = async () => {\n  try {\n    await managerState.openManager({\n      initialTab: ManagerTab.All,\n      showToastOnLegacyError: false\n    })\n  } catch (error) {\n    try {\n      toastErrorHandler(error)\n    } catch (toastError) {\n      console.error(error)\n      console.error(toastError)\n    }\n  }\n}\n</script>\n","<template>\n  <component :is=\"extension.component\" v-if=\"extension.type === 'vue'\" />\n  <div\n    v-else\n    :ref=\"\n      (el) => {\n        if (el)\n          mountCustomExtension(\n            props.extension as CustomExtension,\n            el as HTMLElement\n          )\n      }\n    \"\n  />\n</template>\n\n<script setup lang=\"ts\">\nimport { onBeforeUnmount } from 'vue'\n\nimport type { CustomExtension, VueExtension } from '@/types/extensionTypes'\n\nconst props = defineProps<{\n  extension: VueExtension | CustomExtension\n}>()\n\nconst mountCustomExtension = (extension: CustomExtension, el: HTMLElement) => {\n  extension.render(el)\n}\n\nonBeforeUnmount(() => {\n  if (props.extension.type === 'custom' && props.extension.destroy) {\n    props.extension.destroy()\n  }\n})\n</script>\n","<template>\n  <div class=\"flex h-full flex-col\">\n    <Tabs\n      :key=\"$i18n.locale\"\n      v-model:value=\"bottomPanelStore.activeBottomPanelTabId\"\n      style=\"--p-tabs-tablist-background: var(--comfy-menu-bg)\"\n    >\n      <TabList\n        pt:tab-list=\"border-none h-full flex items-center py-2 border-b-1 border-solid\"\n        class=\"bg-transparent\"\n      >\n        <div class=\"flex w-full justify-between\">\n          <div class=\"tabs-container font-inter\">\n            <Tab\n              v-for=\"tab in bottomPanelStore.bottomPanelTabs\"\n              :key=\"tab.id\"\n              :value=\"tab.id\"\n              class=\"m-1 mx-2 border-none font-inter\"\n              :class=\"{\n                'tab-list-single-item':\n                  bottomPanelStore.bottomPanelTabs.length === 1\n              }\"\n              :pt:root=\"\n                (x: TabPassThroughMethodOptions) => ({\n                  class: {\n                    'p-3 rounded-lg': true,\n                    'pointer-events-none':\n                      bottomPanelStore.bottomPanelTabs.length === 1\n                  },\n                  style: {\n                    color: 'var(--fg-color)',\n                    backgroundColor:\n                      !x.context.active ||\n                      bottomPanelStore.bottomPanelTabs.length === 1\n                        ? ''\n                        : 'var(--bg-color)'\n                  }\n                })\n              \"\n            >\n              <span class=\"font-normal\">\n                {{ getTabDisplayTitle(tab) }}\n              </span>\n            </Tab>\n          </div>\n          <div class=\"flex items-center gap-2\">\n            <Button\n              v-if=\"isShortcutsTabActive\"\n              variant=\"muted-textonly\"\n              size=\"sm\"\n              @click=\"openKeybindingSettings\"\n            >\n              <i class=\"pi pi-cog\" />\n              {{ $t('shortcuts.manageShortcuts') }}\n            </Button>\n            <Button\n              class=\"justify-self-end\"\n              variant=\"muted-textonly\"\n              size=\"sm\"\n              :aria-label=\"t('g.close')\"\n              @click=\"closeBottomPanel\"\n            >\n              <i class=\"pi pi-times\" />\n            </Button>\n          </div>\n        </div>\n      </TabList>\n    </Tabs>\n    <!-- h-0 to force the div to grow -->\n    <div class=\"h-0 grow\">\n      <ExtensionSlot\n        v-if=\"\n          bottomPanelStore.bottomPanelVisible &&\n          bottomPanelStore.activeBottomPanelTab\n        \"\n        :extension=\"bottomPanelStore.activeBottomPanelTab\"\n      />\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport Tab from 'primevue/tab'\nimport type { TabPassThroughMethodOptions } from 'primevue/tab'\nimport TabList from 'primevue/tablist'\nimport Tabs from 'primevue/tabs'\nimport { computed } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport ExtensionSlot from '@/components/common/ExtensionSlot.vue'\nimport Button from '@/components/ui/button/Button.vue'\nimport { useDialogService } from '@/services/dialogService'\nimport { useBottomPanelStore } from '@/stores/workspace/bottomPanelStore'\nimport type { BottomPanelExtension } from '@/types/extensionTypes'\n\nconst bottomPanelStore = useBottomPanelStore()\nconst dialogService = useDialogService()\nconst { t } = useI18n()\n\nconst isShortcutsTabActive = computed(() => {\n  const activeTabId = bottomPanelStore.activeBottomPanelTabId\n  return (\n    activeTabId === 'shortcuts-essentials' ||\n    activeTabId === 'shortcuts-view-controls'\n  )\n})\n\nconst shouldCapitalizeTab = (tabId: string): boolean => {\n  return tabId !== 'shortcuts-essentials' && tabId !== 'shortcuts-view-controls'\n}\n\nconst getTabDisplayTitle = (tab: BottomPanelExtension): string => {\n  const title = tab.titleKey ? t(tab.titleKey) : tab.title || ''\n  return shouldCapitalizeTab(tab.id) ? title.toUpperCase() : title\n}\n\nconst openKeybindingSettings = async () => {\n  dialogService.showSettingsDialog('keybinding')\n}\n\nconst closeBottomPanel = () => {\n  bottomPanelStore.activePanel = null\n}\n</script>\n\n<style scoped>\n:deep(.p-tablist-active-bar) {\n  display: none;\n}\n</style>\n","import type { CSSProperties } from 'vue'\nimport { ref, watch } from 'vue'\n\nimport { useCanvasPositionConversion } from '@/composables/element/useCanvasPositionConversion'\nimport type { Size, Vector2 } from '@/lib/litegraph/src/litegraph'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\n\nexport interface PositionConfig {\n  /* The position of the element on litegraph canvas */\n  pos: Vector2\n  /* The size of the element on litegraph canvas */\n  size: Size\n  /* The scale factor of the canvas */\n  scale?: number\n}\n\nexport function useAbsolutePosition(options: { useTransform?: boolean } = {}) {\n  const { useTransform = false } = options\n\n  const canvasStore = useCanvasStore()\n  const lgCanvas = canvasStore.getCanvas()\n  const { canvasPosToClientPos, update: updateCanvasPosition } =\n    useCanvasPositionConversion(lgCanvas.canvas, lgCanvas)\n\n  const settingStore = useSettingStore()\n  watch(\n    [\n      () => settingStore.get('Comfy.Sidebar.Location'),\n      () => settingStore.get('Comfy.Sidebar.Size'),\n      () => settingStore.get('Comfy.UseNewMenu')\n    ],\n    () => updateCanvasPosition(),\n    { flush: 'post' }\n  )\n\n  /**\n   * @note Do NOT convert style to a computed value, as it will cause lag when\n   * updating the style on different animation frames. Vue's computed value is\n   * evaluated asynchronously.\n   */\n  const style = ref<CSSProperties>({})\n\n  /**\n   * Compute the style of the element based on the position and size.\n   *\n   * @param position\n   */\n  const computeStyle = (position: PositionConfig): CSSProperties => {\n    const { pos, size, scale = lgCanvas.ds.scale } = position\n    const [left, top] = canvasPosToClientPos(pos)\n    const [width, height] = size\n\n    return useTransform\n      ? {\n          position: 'fixed',\n          transformOrigin: '0 0',\n          transform: `scale(${scale})`,\n          left: `${left}px`,\n          top: `${top}px`,\n          width: `${width}px`,\n          height: `${height}px`\n        }\n      : {\n          position: 'fixed',\n          left: `${left}px`,\n          top: `${top}px`,\n          width: `${width * scale}px`,\n          height: `${height * scale}px`\n        }\n  }\n\n  /**\n   * Update the position of the element on the litegraph canvas.\n   *\n   * @param config\n   */\n  const updatePosition = (config: PositionConfig) => {\n    style.value = computeStyle(config)\n  }\n\n  return {\n    style,\n    updatePosition\n  }\n}\n","import type { CSSProperties } from 'vue'\nimport { ref } from 'vue'\n\ninterface Rect {\n  x: number\n  y: number\n  width: number\n  height: number\n}\n\n/**\n * Finds the intersection between two rectangles\n */\nfunction intersect(a: Rect, b: Rect): [number, number, number, number] | null {\n  const x1 = Math.max(a.x, b.x)\n  const y1 = Math.max(a.y, b.y)\n  const x2 = Math.min(a.x + a.width, b.x + b.width)\n  const y2 = Math.min(a.y + a.height, b.y + b.height)\n\n  if (x1 >= x2 || y1 >= y2) {\n    return null\n  }\n\n  return [x1, y1, x2 - x1, y2 - y1]\n}\n\ninterface ClippingOptions {\n  margin?: number\n}\n\nexport const useDomClipping = (options: ClippingOptions = {}) => {\n  const style = ref<CSSProperties>({})\n  const { margin = 4 } = options\n\n  /**\n   * Calculates a clip path for an element based on its intersection with a selected area\n   */\n  const calculateClipPath = (\n    elementRect: DOMRect,\n    canvasRect: DOMRect,\n    isSelected: boolean,\n    selectedArea?: {\n      x: number\n      y: number\n      width: number\n      height: number\n      scale: number\n      offset: [number, number]\n    }\n  ): string => {\n    if (!isSelected && selectedArea) {\n      const { scale, offset } = selectedArea\n\n      // Get intersection in browser space\n      const intersection = intersect(\n        {\n          x: elementRect.left - canvasRect.left,\n          y: elementRect.top - canvasRect.top,\n          width: elementRect.width,\n          height: elementRect.height\n        },\n        {\n          x: (selectedArea.x + offset[0] - margin) * scale,\n          y: (selectedArea.y + offset[1] - margin) * scale,\n          width: (selectedArea.width + 2 * margin) * scale,\n          height: (selectedArea.height + 2 * margin) * scale\n        }\n      )\n\n      if (!intersection) {\n        return ''\n      }\n\n      // Convert intersection to canvas scale (element has scale transform)\n      const clipX =\n        (intersection[0] - elementRect.left + canvasRect.left) / scale + 'px'\n      const clipY =\n        (intersection[1] - elementRect.top + canvasRect.top) / scale + 'px'\n      const clipWidth = intersection[2] / scale + 'px'\n      const clipHeight = intersection[3] / scale + 'px'\n\n      return `polygon(0% 0%, 0% 100%, ${clipX} 100%, ${clipX} ${clipY}, calc(${clipX} + ${clipWidth}) ${clipY}, calc(${clipX} + ${clipWidth}) calc(${clipY} + ${clipHeight}), ${clipX} calc(${clipY} + ${clipHeight}), ${clipX} 100%, 100% 100%, 100% 0%)`\n    }\n\n    return ''\n  }\n\n  /**\n   * Updates the clip-path style based on element and selection information\n   */\n  const updateClipPath = (\n    element: HTMLElement,\n    canvasElement: HTMLCanvasElement,\n    isSelected: boolean,\n    selectedArea?: {\n      x: number\n      y: number\n      width: number\n      height: number\n      scale: number\n      offset: [number, number]\n    }\n  ) => {\n    const elementRect = element.getBoundingClientRect()\n    const canvasRect = canvasElement.getBoundingClientRect()\n\n    const clipPath = calculateClipPath(\n      elementRect,\n      canvasRect,\n      isSelected,\n      selectedArea\n    )\n\n    style.value = {\n      clipPath: clipPath || 'none',\n      willChange: 'clip-path'\n    }\n  }\n\n  return {\n    style,\n    updateClipPath\n  }\n}\n","<template>\n  <div\n    v-show=\"widgetState.visible\"\n    ref=\"widgetElement\"\n    class=\"dom-widget\"\n    :title=\"tooltip\"\n    :style=\"style\"\n  >\n    <component\n      :is=\"widget.component\"\n      v-if=\"isComponentWidget(widget)\"\n      :model-value=\"widget.value\"\n      :widget=\"widget\"\n      v-bind=\"widget.props\"\n      @update:model-value=\"emit('update:widgetValue', $event)\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useElementBounding, useEventListener } from '@vueuse/core'\nimport type { CSSProperties } from 'vue'\nimport { computed, nextTick, onMounted, ref, watch } from 'vue'\n\nimport { useAbsolutePosition } from '@/composables/element/useAbsolutePosition'\nimport { useDomClipping } from '@/composables/element/useDomClipping'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { isComponentWidget, isDOMWidget } from '@/scripts/domWidget'\nimport type { DomWidgetState } from '@/stores/domWidgetStore'\n\nconst { widgetState } = defineProps<{\n  widgetState: DomWidgetState\n}>()\nconst widget = widgetState.widget\n\nconst emit = defineEmits<{\n  'update:widgetValue': [value: string | object]\n}>()\n\nconst widgetElement = ref<HTMLElement | undefined>()\n\n/**\n * @note Do NOT convert style to a computed value, as it will cause lag when\n * updating the style on different animation frames. Vue's computed value is\n * evaluated asynchronously.\n */\nconst style = ref<CSSProperties>({})\nconst { style: positionStyle, updatePosition } = useAbsolutePosition({\n  useTransform: true\n})\nconst { style: clippingStyle, updateClipPath } = useDomClipping()\n\nconst canvasStore = useCanvasStore()\nconst settingStore = useSettingStore()\nconst enableDomClipping = computed(() =>\n  settingStore.get('Comfy.DOMClippingEnabled')\n)\n\nconst updateDomClipping = () => {\n  const lgCanvas = canvasStore.canvas\n  if (!lgCanvas || !widgetElement.value) return\n\n  const selectedNode = Object.values(lgCanvas.selected_nodes ?? {})[0]\n  if (!selectedNode) {\n    // Clear clipping when no node is selected\n    updateClipPath(widgetElement.value, lgCanvas.canvas, false, undefined)\n    return\n  }\n\n  const isSelected = selectedNode === widgetState.widget.node\n  const renderArea = selectedNode?.renderArea\n  const offset = lgCanvas.ds.offset\n  const scale = lgCanvas.ds.scale\n  const selectedAreaConfig = renderArea\n    ? {\n        x: renderArea[0],\n        y: renderArea[1],\n        width: renderArea[2],\n        height: renderArea[3],\n        scale,\n        offset: [offset[0], offset[1]] as [number, number]\n      }\n    : undefined\n\n  updateClipPath(\n    widgetElement.value,\n    lgCanvas.canvas,\n    isSelected,\n    selectedAreaConfig\n  )\n}\n\n/**\n * @note mapping between canvas position and client position depends on the\n * canvas element's position, so we need to watch the canvas element's position\n * and update the position of the widget accordingly.\n */\nconst { left, top } = useElementBounding(canvasStore.getCanvas().canvas)\nwatch(\n  [() => widgetState, left, top],\n  ([widgetState, _, __]) => {\n    updatePosition(widgetState)\n    if (enableDomClipping.value) {\n      updateDomClipping()\n    }\n\n    style.value = {\n      ...positionStyle.value,\n      ...(enableDomClipping.value ? clippingStyle.value : {}),\n      zIndex: widgetState.zIndex,\n      pointerEvents:\n        widgetState.readonly || widget.computedDisabled ? 'none' : 'auto',\n      opacity: widget.computedDisabled ? 0.5 : 1\n    }\n  },\n  { deep: true }\n)\n\nwatch(\n  () => widgetState.visible,\n  (newVisible, oldVisible) => {\n    if (!newVisible && oldVisible) {\n      widget.options.onHide?.(widget)\n    }\n  }\n)\nuseEventListener(document, 'mousedown', (event) => {\n  if (!isDOMWidget(widget) || !widgetState.visible || !widget.element.blur) {\n    return\n  }\n  if (!widget.element.contains(event.target as HTMLElement)) {\n    widget.element.blur()\n  }\n})\n\nonMounted(() => {\n  if (!isDOMWidget(widget)) {\n    return\n  }\n  useEventListener(\n    widget.element,\n    widget.options.selectOn ?? ['focus', 'click'],\n    () => {\n      const lgCanvas = canvasStore.canvas\n      lgCanvas?.selectNode(widgetState.widget.node)\n      lgCanvas?.bringToFront(widgetState.widget.node)\n    }\n  )\n})\n\nconst inputSpec = widget.node.constructor.nodeData\nconst tooltip = inputSpec?.inputs?.[widget.name]?.tooltip\n\n// Mount DOM element when widget is or becomes visible\nconst mountElementIfVisible = () => {\n  if (!(widgetState.visible && isDOMWidget(widget) && widgetElement.value)) {\n    return\n  }\n  // Only append if not already a child\n  if (widgetElement.value.contains(widget.element)) {\n    return\n  }\n  widgetElement.value.appendChild(widget.element)\n}\n\n// Check on mount - but only after next tick to ensure visibility is calculated\nonMounted(() => {\n  nextTick(() => {\n    mountElementIfVisible()\n  }).catch((error) => {\n    console.error('Error mounting DOM widget element:', error)\n  })\n})\n\n// And watch for visibility changes\nwatch(\n  () => widgetState.visible,\n  () => {\n    mountElementIfVisible()\n  }\n)\n</script>\n\n<style scoped>\n@reference '../../../assets/css/style.css';\n\n.dom-widget > * {\n  @apply h-full w-full;\n}\n</style>\n","<template>\n  <!-- Create a new stacking context for widgets to avoid z-index issues -->\n  <div class=\"isolate\">\n    <DomWidget\n      v-for=\"widgetState in widgetStates\"\n      :key=\"widgetState.widget.id\"\n      :widget-state=\"widgetState\"\n      @update:widget-value=\"widgetState.widget.value = $event\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { whenever } from '@vueuse/core'\nimport { computed } from 'vue'\n\nimport DomWidget from '@/components/graph/widgets/DomWidget.vue'\nimport { useChainCallback } from '@/composables/functional/useChainCallback'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useDomWidgetStore } from '@/stores/domWidgetStore'\n\nconst domWidgetStore = useDomWidgetStore()\n\nconst widgetStates = computed(() => [...domWidgetStore.widgetStates.values()])\n\nconst updateWidgets = () => {\n  const lgCanvas = canvasStore.canvas\n  if (!lgCanvas) return\n\n  const lowQuality = lgCanvas.low_quality\n  const currentGraph = lgCanvas.graph\n\n  for (const widgetState of widgetStates.value) {\n    const widget = widgetState.widget\n\n    // Early exit for non-visible widgets\n    if (!widget.isVisible() || !widgetState.active) {\n      widgetState.visible = false\n      continue\n    }\n\n    // Check if the widget's node is in the current graph\n    const node = widget.node\n    const isInCorrectGraph = currentGraph?.nodes.includes(node)\n\n    widgetState.visible =\n      !!isInCorrectGraph &&\n      lgCanvas.isNodeVisible(node) &&\n      !(widget.options.hideOnZoom && lowQuality)\n\n    if (widgetState.visible && node) {\n      const margin = widget.margin\n      widgetState.pos = [node.pos[0] + margin, node.pos[1] + margin + widget.y]\n      widgetState.size = [\n        (widget.width ?? node.width) - margin * 2,\n        (widget.computedHeight ?? 50) - margin * 2\n      ]\n      // TODO: optimize this logic as it's O(n), where n is the number of nodes\n      widgetState.zIndex = lgCanvas.graph?.nodes.indexOf(node) ?? -1\n      widgetState.readonly = lgCanvas.read_only\n    }\n  }\n}\n\nconst canvasStore = useCanvasStore()\nwhenever(\n  () => canvasStore.canvas,\n  (canvas) =>\n    (canvas.onDrawForeground = useChainCallback(\n      canvas.onDrawForeground,\n      updateWidgets\n    )),\n  { immediate: true }\n)\n</script>\n","import { computed, ref } from 'vue'\n\nexport function useZoomControls() {\n  const isModalVisible = ref(false)\n\n  const showModal = () => {\n    isModalVisible.value = true\n  }\n\n  const hideModal = () => {\n    isModalVisible.value = false\n  }\n\n  const toggleModal = () => {\n    isModalVisible.value = !isModalVisible.value\n  }\n\n  const hasActivePopup = computed(() => isModalVisible.value)\n\n  return {\n    isModalVisible,\n    showModal,\n    hideModal,\n    toggleModal,\n    hasActivePopup\n  }\n}\n","import { useThrottleFn } from '@vueuse/core'\nimport { ref, watch } from 'vue'\nimport type { Ref } from 'vue'\n\nimport type {\n  LGraph,\n  LGraphNode,\n  LGraphTriggerEvent\n} from '@/lib/litegraph/src/litegraph'\nimport type { NodeId } from '@/platform/workflow/validation/schemas/workflowSchema'\nimport { layoutStore } from '@/renderer/core/layout/store/layoutStore'\nimport { api } from '@/scripts/api'\n\nimport { MinimapDataSourceFactory } from '../data/MinimapDataSourceFactory'\nimport type { UpdateFlags } from '../types'\n\ninterface GraphCallbacks {\n  onNodeAdded?: (node: LGraphNode) => void\n  onNodeRemoved?: (node: LGraphNode) => void\n  onConnectionChange?: (node: LGraphNode) => void\n  onTrigger?: (event: LGraphTriggerEvent) => void\n}\n\nexport function useMinimapGraph(\n  graph: Ref<LGraph | null>,\n  onGraphChanged: () => void\n) {\n  const nodeStatesCache = new Map<NodeId, string>()\n  const linksCache = ref<string>('')\n  const lastNodeCount = ref(0)\n  const updateFlags = ref<UpdateFlags>({\n    bounds: false,\n    nodes: false,\n    connections: false,\n    viewport: false\n  })\n\n  // Track LayoutStore version for change detection\n  const layoutStoreVersion = layoutStore.getVersion()\n\n  // Map to store original callbacks per graph ID\n  const originalCallbacksMap = new Map<string, GraphCallbacks>()\n\n  const handleGraphChangedThrottled = useThrottleFn(() => {\n    onGraphChanged()\n  }, 500)\n\n  const setupEventListeners = () => {\n    const g = graph.value\n    if (!g) return\n\n    // Check if we've already wrapped this graph's callbacks\n    if (originalCallbacksMap.has(g.id)) {\n      return\n    }\n\n    // Store the original callbacks for this graph\n    const originalCallbacks: GraphCallbacks = {\n      onNodeAdded: g.onNodeAdded,\n      onNodeRemoved: g.onNodeRemoved,\n      onConnectionChange: g.onConnectionChange,\n      onTrigger: g.onTrigger\n    }\n    originalCallbacksMap.set(g.id, originalCallbacks)\n\n    g.onNodeAdded = function (node: LGraphNode) {\n      originalCallbacks.onNodeAdded?.call(this, node)\n      void handleGraphChangedThrottled()\n    }\n\n    g.onNodeRemoved = function (node: LGraphNode) {\n      originalCallbacks.onNodeRemoved?.call(this, node)\n      nodeStatesCache.delete(node.id)\n      void handleGraphChangedThrottled()\n    }\n\n    g.onConnectionChange = function (node: LGraphNode) {\n      originalCallbacks.onConnectionChange?.call(this, node)\n      void handleGraphChangedThrottled()\n    }\n\n    g.onTrigger = function (event: LGraphTriggerEvent) {\n      originalCallbacks.onTrigger?.call(this, event)\n\n      // Listen for visual property changes that affect minimap rendering\n      if (\n        event.type === 'node:property:changed' &&\n        (event.property === 'mode' ||\n          event.property === 'bgcolor' ||\n          event.property === 'color')\n      ) {\n        // Invalidate cache for this node to force redraw\n        nodeStatesCache.delete(String(event.nodeId))\n        void handleGraphChangedThrottled()\n      }\n    }\n  }\n\n  const cleanupEventListeners = (oldGraph?: LGraph) => {\n    const g = oldGraph || graph.value\n    if (!g) return\n\n    const originalCallbacks = originalCallbacksMap.get(g.id)\n    if (!originalCallbacks) {\n      console.error(\n        'Attempted to cleanup event listeners for graph that was never set up'\n      )\n      return\n    }\n\n    g.onNodeAdded = originalCallbacks.onNodeAdded\n    g.onNodeRemoved = originalCallbacks.onNodeRemoved\n    g.onConnectionChange = originalCallbacks.onConnectionChange\n    g.onTrigger = originalCallbacks.onTrigger\n\n    originalCallbacksMap.delete(g.id)\n  }\n\n  const checkForChangesInternal = () => {\n    const g = graph.value\n    if (!g) return false\n\n    let structureChanged = false\n    let positionChanged = false\n    let connectionChanged = false\n\n    // Use unified data source for change detection\n    const dataSource = MinimapDataSourceFactory.create(g)\n\n    // Check for node count changes\n    const currentNodeCount = dataSource.getNodeCount()\n    if (currentNodeCount !== lastNodeCount.value) {\n      structureChanged = true\n      lastNodeCount.value = currentNodeCount\n    }\n\n    // Check for node position/size changes\n    const nodes = dataSource.getNodes()\n    for (const node of nodes) {\n      const nodeId = node.id\n      const currentState = `${node.x},${node.y},${node.width},${node.height}`\n\n      if (nodeStatesCache.get(nodeId) !== currentState) {\n        positionChanged = true\n        nodeStatesCache.set(nodeId, currentState)\n      }\n    }\n\n    // Clean up removed nodes from cache\n    const currentNodeIds = new Set(nodes.map((n) => n.id))\n    for (const [nodeId] of nodeStatesCache) {\n      if (!currentNodeIds.has(nodeId)) {\n        nodeStatesCache.delete(nodeId)\n        structureChanged = true\n      }\n    }\n\n    // TODO: update when Layoutstore tracks links\n    const currentLinks = JSON.stringify(g.links || {})\n    if (currentLinks !== linksCache.value) {\n      connectionChanged = true\n      linksCache.value = currentLinks\n    }\n\n    if (structureChanged || positionChanged) {\n      updateFlags.value.bounds = true\n      updateFlags.value.nodes = true\n    }\n\n    if (connectionChanged) {\n      updateFlags.value.connections = true\n    }\n\n    return structureChanged || positionChanged || connectionChanged\n  }\n\n  const init = () => {\n    setupEventListeners()\n    api.addEventListener('graphChanged', handleGraphChangedThrottled)\n\n    watch(layoutStoreVersion, () => {\n      void handleGraphChangedThrottled()\n    })\n  }\n\n  const destroy = () => {\n    cleanupEventListeners()\n    api.removeEventListener('graphChanged', handleGraphChangedThrottled)\n    nodeStatesCache.clear()\n  }\n\n  const clearCache = () => {\n    nodeStatesCache.clear()\n    linksCache.value = ''\n    lastNodeCount.value = 0\n  }\n\n  return {\n    updateFlags,\n    setupEventListeners,\n    cleanupEventListeners,\n    checkForChanges: checkForChangesInternal,\n    init,\n    destroy,\n    clearCache\n  }\n}\n","import { ref } from 'vue'\nimport type { Ref, ShallowRef } from 'vue'\n\nimport type { MinimapCanvas } from '../types'\n\nexport function useMinimapInteraction(\n  containerRef: Readonly<ShallowRef<HTMLDivElement | null>>,\n  bounds: Ref<{ minX: number; minY: number; width: number; height: number }>,\n  scale: Ref<number>,\n  width: number,\n  height: number,\n  centerViewOn: (worldX: number, worldY: number) => void,\n  canvas: Ref<MinimapCanvas | null>\n) {\n  const isDragging = ref(false)\n  const containerRect = ref({\n    left: 0,\n    top: 0,\n    width: width,\n    height: height\n  })\n\n  const updateContainerRect = () => {\n    if (!containerRef.value) return\n\n    const rect = containerRef.value.getBoundingClientRect()\n    containerRect.value = {\n      left: rect.left,\n      top: rect.top,\n      width: rect.width,\n      height: rect.height\n    }\n  }\n\n  const handlePointerDown = (e: PointerEvent) => {\n    isDragging.value = true\n    updateContainerRect()\n    const target = e.currentTarget\n    if (target instanceof HTMLElement) {\n      target.setPointerCapture(e.pointerId)\n    }\n    handlePointerMove(e)\n  }\n\n  const handlePointerMove = (e: PointerEvent) => {\n    if (!isDragging.value || !canvas.value) return\n\n    const x = e.clientX - containerRect.value.left\n    const y = e.clientY - containerRect.value.top\n\n    const offsetX = (width - bounds.value.width * scale.value) / 2\n    const offsetY = (height - bounds.value.height * scale.value) / 2\n\n    const worldX = (x - offsetX) / scale.value + bounds.value.minX\n    const worldY = (y - offsetY) / scale.value + bounds.value.minY\n\n    centerViewOn(worldX, worldY)\n  }\n\n  const releasePointer = (e?: PointerEvent) => {\n    isDragging.value = false\n    if (!e) return\n\n    const target = e.currentTarget\n    if (\n      target instanceof HTMLElement &&\n      target.hasPointerCapture(e.pointerId)\n    ) {\n      target.releasePointerCapture(e.pointerId)\n    }\n  }\n\n  const handlePointerUp = releasePointer\n\n  const handlePointerCancel = releasePointer\n\n  const handleWheel = (e: WheelEvent) => {\n    e.preventDefault()\n\n    const c = canvas.value\n    if (!c) return\n\n    if (\n      containerRect.value.left === 0 &&\n      containerRect.value.top === 0 &&\n      containerRef.value\n    ) {\n      updateContainerRect()\n    }\n\n    const ds = c.ds\n    const delta = e.deltaY > 0 ? 0.9 : 1.1\n\n    const newScale = ds.scale * delta\n\n    const MIN_SCALE = 0.1\n    const MAX_SCALE = 10\n\n    if (newScale < MIN_SCALE || newScale > MAX_SCALE) return\n\n    const x = e.clientX - containerRect.value.left\n    const y = e.clientY - containerRect.value.top\n\n    const offsetX = (width - bounds.value.width * scale.value) / 2\n    const offsetY = (height - bounds.value.height * scale.value) / 2\n\n    const worldX = (x - offsetX) / scale.value + bounds.value.minX\n    const worldY = (y - offsetY) / scale.value + bounds.value.minY\n\n    ds.scale = newScale\n\n    centerViewOn(worldX, worldY)\n  }\n\n  return {\n    isDragging,\n    containerRect,\n    updateContainerRect,\n    handlePointerDown,\n    handlePointerMove,\n    handlePointerUp,\n    handlePointerCancel,\n    handleWheel\n  }\n}\n","import { ref } from 'vue'\nimport type { Ref, ShallowRef } from 'vue'\n\nimport type { LGraph } from '@/lib/litegraph/src/litegraph'\n\nimport { renderMinimapToCanvas } from '../minimapCanvasRenderer'\nimport type { UpdateFlags } from '../types'\n\nexport function useMinimapRenderer(\n  canvasRef: Readonly<ShallowRef<HTMLCanvasElement | null>>,\n  graph: Ref<LGraph | null>,\n  bounds: Ref<{ minX: number; minY: number; width: number; height: number }>,\n  scale: Ref<number>,\n  updateFlags: Ref<UpdateFlags>,\n  settings: {\n    nodeColors: Ref<boolean>\n    showLinks: Ref<boolean>\n    showGroups: Ref<boolean>\n    renderBypass: Ref<boolean>\n    renderError: Ref<boolean>\n  },\n  width: number,\n  height: number\n) {\n  const needsFullRedraw = ref(true)\n  const needsBoundsUpdate = ref(true)\n\n  const renderMinimap = () => {\n    const g = graph.value\n    if (!canvasRef.value || !g) return\n\n    const ctx = canvasRef.value.getContext('2d')\n    if (!ctx) return\n\n    // Fast path for 0 nodes - just show background\n    if (!g._nodes || g._nodes.length === 0) {\n      ctx.clearRect(0, 0, width, height)\n      return\n    }\n\n    const needsRedraw =\n      needsFullRedraw.value ||\n      updateFlags.value.nodes ||\n      updateFlags.value.connections\n\n    if (needsRedraw) {\n      renderMinimapToCanvas(canvasRef.value, g, {\n        bounds: bounds.value,\n        scale: scale.value,\n        settings: {\n          nodeColors: settings.nodeColors.value,\n          showLinks: settings.showLinks.value,\n          showGroups: settings.showGroups.value,\n          renderBypass: settings.renderBypass.value,\n          renderError: settings.renderError.value\n        },\n        width,\n        height\n      })\n\n      needsFullRedraw.value = false\n      updateFlags.value.nodes = false\n      updateFlags.value.connections = false\n    }\n  }\n\n  const updateMinimap = (\n    updateBounds: () => void,\n    updateViewport: () => void\n  ) => {\n    if (needsBoundsUpdate.value || updateFlags.value.bounds) {\n      updateBounds()\n      needsBoundsUpdate.value = false\n      updateFlags.value.bounds = false\n      needsFullRedraw.value = true\n      // When bounds change, we need to update the viewport position\n      updateFlags.value.viewport = true\n    }\n\n    if (\n      needsFullRedraw.value ||\n      updateFlags.value.nodes ||\n      updateFlags.value.connections\n    ) {\n      renderMinimap()\n    }\n\n    // Update viewport if needed (e.g., after bounds change)\n    if (updateFlags.value.viewport) {\n      updateViewport()\n      updateFlags.value.viewport = false\n    }\n  }\n\n  const forceFullRedraw = () => {\n    needsFullRedraw.value = true\n    updateFlags.value.bounds = true\n    updateFlags.value.nodes = true\n    updateFlags.value.connections = true\n    updateFlags.value.viewport = true\n  }\n\n  return {\n    needsFullRedraw,\n    needsBoundsUpdate,\n    renderMinimap,\n    updateMinimap,\n    forceFullRedraw\n  }\n}\n","import { computed } from 'vue'\n\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useColorPaletteStore } from '@/stores/workspace/colorPaletteStore'\n\n/**\n * Composable for minimap configuration options that are set by the user in the\n * settings. Provides reactive computed properties for the settings.\n */\nexport function useMinimapSettings() {\n  const settingStore = useSettingStore()\n  const colorPaletteStore = useColorPaletteStore()\n\n  const nodeColors = computed(() =>\n    settingStore.get('Comfy.Minimap.NodeColors')\n  )\n  const showLinks = computed(() => settingStore.get('Comfy.Minimap.ShowLinks'))\n  const showGroups = computed(() =>\n    settingStore.get('Comfy.Minimap.ShowGroups')\n  )\n  const renderBypass = computed(() =>\n    settingStore.get('Comfy.Minimap.RenderBypassState')\n  )\n  const renderError = computed(() =>\n    settingStore.get('Comfy.Minimap.RenderErrorState')\n  )\n\n  const width = 253\n  const height = 200\n\n  // Theme-aware colors\n  const isLightTheme = computed(\n    () => colorPaletteStore.completedActivePalette.light_theme\n  )\n\n  const containerStyles = computed(() => ({\n    width: `${width}px`,\n    height: `${height}px`,\n    border: '1px solid var(--interface-stroke)',\n    borderRadius: '8px'\n  }))\n\n  const panelStyles = computed(() => ({\n    width: `210px`,\n    height: `${height}px`,\n    border: '1px solid var(--interface-stroke)',\n    borderRadius: '8px'\n  }))\n\n  return {\n    nodeColors,\n    showLinks,\n    showGroups,\n    renderBypass,\n    renderError,\n    containerStyles,\n    panelStyles,\n    isLightTheme\n  }\n}\n","import { useRafFn } from '@vueuse/core'\nimport { computed, ref } from 'vue'\nimport type { Ref } from 'vue'\n\nimport type { LGraph } from '@/lib/litegraph/src/litegraph'\nimport {\n  calculateMinimapScale,\n  enforceMinimumBounds\n} from '@/renderer/core/spatial/boundsCalculator'\nimport { MinimapDataSourceFactory } from '@/renderer/extensions/minimap/data/MinimapDataSourceFactory'\n\nimport type { MinimapBounds, MinimapCanvas, ViewportTransform } from '../types'\n\nexport function useMinimapViewport(\n  canvas: Ref<MinimapCanvas | null>,\n  graph: Ref<LGraph | null>,\n  width: number,\n  height: number\n) {\n  const bounds = ref<MinimapBounds>({\n    minX: 0,\n    minY: 0,\n    maxX: 0,\n    maxY: 0,\n    width: 0,\n    height: 0\n  })\n\n  const scale = ref(1)\n  const viewportTransform = ref<ViewportTransform>({\n    x: 0,\n    y: 0,\n    width: 0,\n    height: 0\n  })\n\n  const canvasDimensions = ref({\n    width: 0,\n    height: 0\n  })\n\n  const updateCanvasDimensions = () => {\n    const c = canvas.value\n    if (!c) return\n\n    const canvasEl = c.canvas\n    const dpr = window.devicePixelRatio || 1\n\n    canvasDimensions.value = {\n      width: canvasEl.clientWidth || canvasEl.width / dpr,\n      height: canvasEl.clientHeight || canvasEl.height / dpr\n    }\n  }\n\n  const calculateGraphBounds = (): MinimapBounds => {\n    // Use unified data source\n    const dataSource = MinimapDataSourceFactory.create(graph.value)\n\n    if (!dataSource.hasData()) {\n      return { minX: 0, minY: 0, maxX: 100, maxY: 100, width: 100, height: 100 }\n    }\n\n    const sourceBounds = dataSource.getBounds()\n    return enforceMinimumBounds(sourceBounds)\n  }\n\n  const calculateScale = () => {\n    return calculateMinimapScale(bounds.value, width, height)\n  }\n\n  const updateViewport = () => {\n    const c = canvas.value\n    if (!c) return\n\n    if (\n      canvasDimensions.value.width === 0 ||\n      canvasDimensions.value.height === 0\n    ) {\n      updateCanvasDimensions()\n    }\n\n    const ds = c.ds\n\n    const viewportWidth = canvasDimensions.value.width / ds.scale\n    const viewportHeight = canvasDimensions.value.height / ds.scale\n\n    const worldX = -ds.offset[0]\n    const worldY = -ds.offset[1]\n\n    const centerOffsetX = (width - bounds.value.width * scale.value) / 2\n    const centerOffsetY = (height - bounds.value.height * scale.value) / 2\n\n    viewportTransform.value = {\n      x: (worldX - bounds.value.minX) * scale.value + centerOffsetX,\n      y: (worldY - bounds.value.minY) * scale.value + centerOffsetY,\n      width: viewportWidth * scale.value,\n      height: viewportHeight * scale.value\n    }\n  }\n\n  const updateBounds = () => {\n    bounds.value = calculateGraphBounds()\n    scale.value = calculateScale()\n  }\n\n  const centerViewOn = (worldX: number, worldY: number) => {\n    const c = canvas.value\n    if (!c) return\n\n    if (\n      canvasDimensions.value.width === 0 ||\n      canvasDimensions.value.height === 0\n    ) {\n      updateCanvasDimensions()\n    }\n\n    const ds = c.ds\n\n    const viewportWidth = canvasDimensions.value.width / ds.scale\n    const viewportHeight = canvasDimensions.value.height / ds.scale\n\n    ds.offset[0] = -(worldX - viewportWidth / 2)\n    ds.offset[1] = -(worldY - viewportHeight / 2)\n\n    c.setDirty(true, true)\n  }\n  const { resume: startViewportSync, pause: stopViewportSync } =\n    useRafFn(updateViewport)\n\n  return {\n    bounds: computed(() => bounds.value),\n    scale: computed(() => scale.value),\n    viewportTransform: computed(() => viewportTransform.value),\n    canvasDimensions: computed(() => canvasDimensions.value),\n    updateCanvasDimensions,\n    updateViewport,\n    updateBounds,\n    centerViewOn,\n    startViewportSync,\n    stopViewportSync\n  }\n}\n","import { useRafFn } from '@vueuse/core'\nimport { computed, nextTick, ref, shallowRef, watch } from 'vue'\nimport type { ShallowRef } from 'vue'\n\nimport type { LGraph } from '@/lib/litegraph/src/litegraph'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\n\nimport type { MinimapCanvas, MinimapSettingsKey } from '../types'\nimport { useMinimapGraph } from './useMinimapGraph'\nimport { useMinimapInteraction } from './useMinimapInteraction'\nimport { useMinimapRenderer } from './useMinimapRenderer'\nimport { useMinimapSettings } from './useMinimapSettings'\nimport { useMinimapViewport } from './useMinimapViewport'\n\nexport function useMinimap({\n  canvasRefMaybe,\n  containerRefMaybe\n}: {\n  canvasRefMaybe?: Readonly<ShallowRef<HTMLCanvasElement | null>>\n  containerRefMaybe?: Readonly<ShallowRef<HTMLDivElement | null>>\n} = {}) {\n  const canvasStore = useCanvasStore()\n  const workflowStore = useWorkflowStore()\n  const settingStore = useSettingStore()\n\n  const minimapRef = ref<HTMLElement | null>(null)\n  const canvasRef = canvasRefMaybe ?? shallowRef(null)\n  const containerRef = containerRefMaybe ?? shallowRef(null)\n\n  const visible = ref(true)\n  const initialized = ref(false)\n\n  const width = 250\n  const height = 200\n\n  const canvas = computed(() => canvasStore.canvas as MinimapCanvas | null)\n  const graph = computed(() => {\n    // If we're in a subgraph, use that; otherwise use the canvas graph\n    const activeSubgraph = workflowStore.activeSubgraph\n    return (activeSubgraph || canvas.value?.graph) as LGraph | null\n  })\n\n  // Settings\n  const settings = useMinimapSettings()\n  const {\n    nodeColors,\n    showLinks,\n    showGroups,\n    renderBypass,\n    renderError,\n    containerStyles,\n    panelStyles\n  } = settings\n\n  const updateOption = async (key: MinimapSettingsKey, value: boolean) => {\n    await settingStore.set(key, value)\n    renderer.forceFullRedraw()\n    renderer.updateMinimap(viewport.updateBounds, viewport.updateViewport)\n  }\n\n  // Viewport management\n  const viewport = useMinimapViewport(canvas, graph, width, height)\n\n  // Interaction handling\n  const interaction = useMinimapInteraction(\n    containerRef,\n    viewport.bounds,\n    viewport.scale,\n    width,\n    height,\n    viewport.centerViewOn,\n    canvas\n  )\n\n  // Graph event management\n  const graphManager = useMinimapGraph(graph, () => {\n    renderer.forceFullRedraw()\n    renderer.updateMinimap(viewport.updateBounds, viewport.updateViewport)\n  })\n\n  // Rendering\n  const renderer = useMinimapRenderer(\n    canvasRef,\n    graph,\n    viewport.bounds,\n    viewport.scale,\n    graphManager.updateFlags,\n    settings,\n    width,\n    height\n  )\n\n  // RAF loop for continuous updates\n  const { pause: pauseChangeDetection, resume: resumeChangeDetection } =\n    useRafFn(\n      async () => {\n        if (visible.value) {\n          const hasChanges = await graphManager.checkForChanges()\n          if (hasChanges) {\n            renderer.updateMinimap(\n              viewport.updateBounds,\n              viewport.updateViewport\n            )\n          }\n        }\n      },\n      { immediate: false }\n    )\n\n  const init = async () => {\n    if (initialized.value) return\n\n    visible.value = settingStore.get('Comfy.Minimap.Visible')\n\n    if (canvas.value && graph.value) {\n      graphManager.init()\n\n      if (containerRef.value) {\n        interaction.updateContainerRect()\n      }\n      viewport.updateCanvasDimensions()\n\n      window.addEventListener('resize', interaction.updateContainerRect)\n      window.addEventListener('scroll', interaction.updateContainerRect)\n      window.addEventListener('resize', viewport.updateCanvasDimensions)\n\n      renderer.forceFullRedraw()\n      renderer.updateMinimap(viewport.updateBounds, viewport.updateViewport)\n      viewport.updateViewport()\n\n      if (visible.value) {\n        resumeChangeDetection()\n        viewport.startViewportSync()\n      }\n      initialized.value = true\n    }\n  }\n\n  const destroy = () => {\n    pauseChangeDetection()\n    viewport.stopViewportSync()\n    graphManager.destroy()\n\n    window.removeEventListener('resize', interaction.updateContainerRect)\n    window.removeEventListener('scroll', interaction.updateContainerRect)\n    window.removeEventListener('resize', viewport.updateCanvasDimensions)\n\n    initialized.value = false\n  }\n\n  watch(\n    canvas,\n    async (newCanvas, oldCanvas) => {\n      if (oldCanvas) {\n        graphManager.cleanupEventListeners()\n        pauseChangeDetection()\n        viewport.stopViewportSync()\n        graphManager.destroy()\n        window.removeEventListener('resize', interaction.updateContainerRect)\n        window.removeEventListener('scroll', interaction.updateContainerRect)\n        window.removeEventListener('resize', viewport.updateCanvasDimensions)\n      }\n      if (newCanvas && !initialized.value) {\n        await init()\n      }\n    },\n    { immediate: true, flush: 'post' }\n  )\n\n  // Watch for graph changes (e.g., when navigating to/from subgraphs)\n  watch(graph, (newGraph, oldGraph) => {\n    if (newGraph && newGraph !== oldGraph) {\n      graphManager.cleanupEventListeners(oldGraph || undefined)\n      graphManager.setupEventListeners()\n      renderer.forceFullRedraw()\n      renderer.updateMinimap(viewport.updateBounds, viewport.updateViewport)\n    }\n  })\n\n  watch(visible, async (isVisible) => {\n    if (isVisible) {\n      if (containerRef.value) {\n        interaction.updateContainerRect()\n      }\n      viewport.updateCanvasDimensions()\n\n      renderer.forceFullRedraw()\n\n      await nextTick()\n      await nextTick()\n\n      renderer.updateMinimap(viewport.updateBounds, viewport.updateViewport)\n      viewport.updateViewport()\n      resumeChangeDetection()\n      viewport.startViewportSync()\n    } else {\n      pauseChangeDetection()\n      viewport.stopViewportSync()\n    }\n  })\n\n  const toggle = async () => {\n    visible.value = !visible.value\n    await settingStore.set('Comfy.Minimap.Visible', visible.value)\n  }\n\n  const setMinimapRef = (ref: HTMLElement | null) => {\n    minimapRef.value = ref\n  }\n\n  // Dynamic viewport styles based on actual viewport transform\n  const viewportStyles = computed(() => {\n    const transform = viewport.viewportTransform.value\n    return {\n      transform: `translate(${transform.x}px, ${transform.y}px)`,\n      width: `${transform.width}px`,\n      height: `${transform.height}px`,\n      border: `2px solid ${settings.isLightTheme.value ? '#E0E0E0' : '#FFF'}`,\n      backgroundColor: `rgba(255, 255, 255, 0.2)`,\n      willChange: 'transform',\n      backfaceVisibility: 'hidden' as const,\n      perspective: '1000px',\n      pointerEvents: 'none' as const\n    }\n  })\n\n  return {\n    visible: computed(() => visible.value),\n    initialized: computed(() => initialized.value),\n\n    containerStyles,\n    viewportStyles,\n    panelStyles,\n    width,\n    height,\n\n    nodeColors,\n    showLinks,\n    showGroups,\n    renderBypass,\n    renderError,\n\n    init,\n    destroy,\n    toggle,\n    renderMinimap: renderer.renderMinimap,\n    handlePointerDown: interaction.handlePointerDown,\n    handlePointerMove: interaction.handlePointerMove,\n    handlePointerUp: interaction.handlePointerUp,\n    handlePointerCancel: interaction.handlePointerCancel,\n    handleWheel: interaction.handleWheel,\n    setMinimapRef,\n    updateOption\n  }\n}\n","<template>\n  <Button\n    ref=\"buttonRef\"\n    variant=\"secondary\"\n    class=\"group h-8 rounded-none! bg-comfy-menu-bg p-0 transition-none! hover:rounded-lg! hover:bg-interface-button-hover-surface!\"\n    :style=\"buttonStyles\"\n    @click=\"toggle\"\n  >\n    <div class=\"flex items-center gap-1 pr-0.5\">\n      <div\n        class=\"rounded-lg bg-interface-panel-selected-surface p-2 group-hover:bg-interface-button-hover-surface\"\n      >\n        <i :class=\"currentModeIcon\" class=\"block h-4 w-4\" />\n      </div>\n      <i class=\"icon-[lucide--chevron-down] block h-4 w-4 pr-1.5\" />\n    </div>\n  </Button>\n\n  <Popover\n    ref=\"popover\"\n    :auto-z-index=\"true\"\n    :base-z-index=\"1000\"\n    :dismissable=\"true\"\n    :close-on-escape=\"true\"\n    unstyled\n    :pt=\"popoverPt\"\n  >\n    <div class=\"flex flex-col gap-1\">\n      <div\n        class=\"flex cursor-pointer items-center justify-between px-3 py-2 text-sm hover:bg-node-component-surface-hovered\"\n        @click=\"setMode('select')\"\n      >\n        <div class=\"flex items-center gap-2\">\n          <i class=\"icon-[lucide--mouse-pointer-2] h-4 w-4\" />\n          <span>{{ $t('graphCanvasMenu.select') }}</span>\n        </div>\n        <span class=\"text-[9px] text-text-primary\">{{\n          unlockCommandText\n        }}</span>\n      </div>\n\n      <div\n        class=\"flex cursor-pointer items-center justify-between rounded px-3 py-2 text-sm hover:bg-node-component-surface-hovered\"\n        @click=\"setMode('hand')\"\n      >\n        <div class=\"flex items-center gap-2\">\n          <i class=\"icon-[lucide--hand] h-4 w-4\" />\n          <span>{{ $t('graphCanvasMenu.hand') }}</span>\n        </div>\n        <span class=\"text-[9px] text-text-primary\">{{ lockCommandText }}</span>\n      </div>\n    </div>\n  </Popover>\n</template>\n\n<script setup lang=\"ts\">\nimport Popover from 'primevue/popover'\nimport { computed, ref } from 'vue'\n\nimport Button from '@/components/ui/button/Button.vue'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useCommandStore } from '@/stores/commandStore'\n\ninterface Props {\n  buttonStyles?: Record<string, string>\n}\n\ndefineProps<Props>()\nconst buttonRef = ref<InstanceType<typeof Button>>()\nconst popover = ref<InstanceType<typeof Popover>>()\nconst commandStore = useCommandStore()\nconst canvasStore = useCanvasStore()\n\nconst isCanvasReadOnly = computed(() => canvasStore.canvas?.read_only ?? false)\n\nconst currentModeIcon = computed(() =>\n  isCanvasReadOnly.value\n    ? 'icon-[lucide--hand]'\n    : 'icon-[lucide--mouse-pointer-2]'\n)\n\nconst unlockCommandText = computed(() =>\n  commandStore\n    .formatKeySequence(commandStore.getCommand('Comfy.Canvas.Unlock'))\n    .toUpperCase()\n)\n\nconst lockCommandText = computed(() =>\n  commandStore\n    .formatKeySequence(commandStore.getCommand('Comfy.Canvas.Lock'))\n    .toUpperCase()\n)\n\nconst toggle = (event: Event) => {\n  const el = (buttonRef.value as any)?.$el || buttonRef.value\n  popover.value?.toggle(event, el)\n}\n\nconst setMode = (mode: 'select' | 'hand') => {\n  if (mode === 'select' && isCanvasReadOnly.value) {\n    void commandStore.execute('Comfy.Canvas.Unlock')\n  } else if (mode === 'hand' && !isCanvasReadOnly.value) {\n    void commandStore.execute('Comfy.Canvas.Lock')\n  }\n  popover.value?.hide()\n}\n\nconst popoverPt = computed(() => ({\n  root: {\n    class: 'absolute z-50 -translate-y-2'\n  },\n  content: {\n    class: [\n      'mb-2 text-text-primary',\n      'shadow-lg border border-interface-stroke',\n      'bg-nav-background',\n      'rounded-lg',\n      'p-2 px-3',\n      'min-w-39',\n      'select-none'\n    ]\n  }\n}))\n</script>\n","<template>\n  <div\n    v-if=\"visible\"\n    class=\"absolute right-0 bottom-[62px] z-1300 flex w-[250px] justify-center border-0! bg-inherit!\"\n  >\n    <div\n      class=\"w-4/5 rounded-lg border border-interface-stroke bg-interface-panel-surface p-2 text-text-primary shadow-lg select-none\"\n      :style=\"filteredMinimapStyles\"\n      @click.stop\n    >\n      <div class=\"flex flex-col gap-1\">\n        <div\n          class=\"flex cursor-pointer items-center justify-between rounded px-3 py-2 text-sm hover:bg-node-component-surface-hovered\"\n          @mousedown=\"startRepeat('Comfy.Canvas.ZoomIn')\"\n          @mouseup=\"stopRepeat\"\n          @mouseleave=\"stopRepeat\"\n        >\n          <span class=\"font-medium\">{{ $t('graphCanvasMenu.zoomIn') }}</span>\n          <span class=\"text-[9px] text-text-primary\">{{\n            zoomInCommandText\n          }}</span>\n        </div>\n\n        <div\n          class=\"flex cursor-pointer items-center justify-between rounded px-3 py-2 text-sm hover:bg-node-component-surface-hovered\"\n          @mousedown=\"startRepeat('Comfy.Canvas.ZoomOut')\"\n          @mouseup=\"stopRepeat\"\n          @mouseleave=\"stopRepeat\"\n        >\n          <span class=\"font-medium\">{{ $t('graphCanvasMenu.zoomOut') }}</span>\n          <span class=\"text-[9px] text-text-primary\">{{\n            zoomOutCommandText\n          }}</span>\n        </div>\n\n        <div\n          class=\"flex cursor-pointer items-center justify-between rounded px-3 py-2 text-sm hover:bg-node-component-surface-hovered\"\n          @click=\"executeCommand('Comfy.Canvas.FitView')\"\n        >\n          <span class=\"font-medium\">{{ $t('zoomControls.zoomToFit') }}</span>\n          <span class=\"text-[9px] text-text-primary\">{{\n            zoomToFitCommandText\n          }}</span>\n        </div>\n\n        <div\n          ref=\"zoomInputContainer\"\n          class=\"zoomInputContainer flex items-center gap-1 rounded bg-input-surface p-2\"\n        >\n          <InputNumber\n            :default-value=\"canvasStore.appScalePercentage\"\n            :min=\"1\"\n            :max=\"1000\"\n            :show-buttons=\"false\"\n            :use-grouping=\"false\"\n            :unstyled=\"true\"\n            input-class=\"bg-transparent border-none outline-hidden text-sm shadow-none my-0 w-full\"\n            fluid\n            @input=\"applyZoom\"\n            @keyup.enter=\"applyZoom\"\n          />\n          <span class=\"flex-shrink-0 text-sm text-text-primary\">%</span>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport type { InputNumberInputEvent } from 'primevue'\nimport { InputNumber } from 'primevue'\nimport { computed, nextTick, ref, watch } from 'vue'\n\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useMinimap } from '@/renderer/extensions/minimap/composables/useMinimap'\nimport { useCommandStore } from '@/stores/commandStore'\n\nconst minimap = useMinimap()\nconst commandStore = useCommandStore()\nconst canvasStore = useCanvasStore()\nconst { formatKeySequence } = useCommandStore()\n\ninterface Props {\n  visible: boolean\n}\n\nconst props = defineProps<Props>()\n\nconst interval = ref<number | null>(null)\n\nconst applyZoom = (val: InputNumberInputEvent) => {\n  const inputValue = val.value as number\n  if (isNaN(inputValue) || inputValue < 1 || inputValue > 1000) {\n    return\n  }\n  canvasStore.setAppZoomFromPercentage(inputValue)\n}\n\nconst executeCommand = (command: string) => {\n  void commandStore.execute(command)\n}\n\nconst startRepeat = (command: string) => {\n  if (interval.value) return\n  const cmd = () => commandStore.execute(command)\n  void cmd()\n  interval.value = window.setInterval(cmd, 100)\n}\n\nconst stopRepeat = () => {\n  if (interval.value) {\n    clearInterval(interval.value)\n    interval.value = null\n  }\n}\nconst filteredMinimapStyles = computed(() => {\n  return {\n    ...minimap.containerStyles.value,\n    height: undefined,\n    width: undefined\n  }\n})\nconst zoomInCommandText = computed(() =>\n  formatKeySequence(commandStore.getCommand('Comfy.Canvas.ZoomIn'))\n)\nconst zoomOutCommandText = computed(() =>\n  formatKeySequence(commandStore.getCommand('Comfy.Canvas.ZoomOut'))\n)\nconst zoomToFitCommandText = computed(() =>\n  formatKeySequence(commandStore.getCommand('Comfy.Canvas.FitView'))\n)\nconst zoomInputContainer = ref<HTMLDivElement | null>(null)\n\nwatch(\n  () => props.visible,\n  async (newVal) => {\n    if (newVal) {\n      await nextTick()\n      const input = zoomInputContainer.value?.querySelector(\n        'input'\n      ) as HTMLInputElement\n      input?.focus()\n    }\n  }\n)\n</script>\n<style>\n.zoomInputContainer:focus-within {\n  border: 1px solid var(--color-white);\n}\n</style>\n","<template>\n  <div>\n    <ZoomControlsModal :visible=\"isModalVisible\" @close=\"hideModal\" />\n\n    <!-- Backdrop -->\n    <div\n      v-if=\"hasActivePopup\"\n      class=\"fixed inset-0 z-1200\"\n      @click=\"hideModal\"\n    ></div>\n\n    <ButtonGroup\n      class=\"absolute right-0 bottom-0 z-1200 flex-row gap-1 border-[1px] border-interface-stroke bg-comfy-menu-bg p-2\"\n      :style=\"{\n        ...stringifiedMinimapStyles.buttonGroupStyles\n      }\"\n      @wheel=\"canvasInteractions.handleWheel\"\n    >\n      <CanvasModeSelector\n        :button-styles=\"stringifiedMinimapStyles.buttonStyles\"\n      />\n\n      <div class=\"h-[27px] w-[1px] self-center bg-node-divider\" />\n\n      <Button\n        v-tooltip.top=\"fitViewTooltip\"\n        variant=\"secondary\"\n        :aria-label=\"fitViewTooltip\"\n        :style=\"stringifiedMinimapStyles.buttonStyles\"\n        class=\"h-8 w-8 bg-comfy-menu-bg p-0 hover:bg-interface-button-hover-surface!\"\n        @click=\"() => commandStore.execute('Comfy.Canvas.FitView')\"\n      >\n        <i class=\"icon-[lucide--focus] h-4 w-4\" />\n      </Button>\n\n      <Button\n        v-tooltip.top=\"t('zoomControls.label')\"\n        variant=\"secondary\"\n        :class=\"zoomButtonClass\"\n        :aria-label=\"t('zoomControls.label')\"\n        data-testid=\"zoom-controls-button\"\n        :style=\"stringifiedMinimapStyles.buttonStyles\"\n        @click=\"toggleModal\"\n      >\n        <span class=\"inline-flex items-center gap-1 px-2 text-xs\">\n          <span>{{ canvasStore.appScalePercentage }}%</span>\n          <i class=\"icon-[lucide--chevron-down] h-4 w-4\" />\n        </span>\n      </Button>\n\n      <div class=\"h-[27px] w-[1px] self-center bg-node-divider\" />\n\n      <Button\n        v-tooltip.top=\"minimapTooltip\"\n        variant=\"secondary\"\n        :aria-label=\"minimapTooltip\"\n        data-testid=\"toggle-minimap-button\"\n        :style=\"stringifiedMinimapStyles.buttonStyles\"\n        :class=\"minimapButtonClass\"\n        @click=\"onMinimapToggleClick\"\n      >\n        <i class=\"icon-[lucide--map] h-4 w-4\" />\n      </Button>\n\n      <Button\n        v-tooltip.top=\"{\n          value: linkVisibilityTooltip,\n          pt: {\n            root: {\n              style: 'z-index: 2; transform: translateY(-20px);'\n            }\n          }\n        }\"\n        variant=\"secondary\"\n        :class=\"linkVisibleClass\"\n        :aria-label=\"linkVisibilityAriaLabel\"\n        data-testid=\"toggle-link-visibility-button\"\n        :style=\"stringifiedMinimapStyles.buttonStyles\"\n        @click=\"onLinkVisibilityToggleClick\"\n      >\n        <i class=\"icon-[lucide--route-off] h-4 w-4\" />\n      </Button>\n    </ButtonGroup>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport ButtonGroup from 'primevue/buttongroup'\nimport { computed, onBeforeUnmount, onMounted } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport Button from '@/components/ui/button/Button.vue'\nimport { useZoomControls } from '@/composables/useZoomControls'\nimport { LiteGraph } from '@/lib/litegraph/src/litegraph'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useCanvasInteractions } from '@/renderer/core/canvas/useCanvasInteractions'\nimport { useMinimap } from '@/renderer/extensions/minimap/composables/useMinimap'\nimport { useCommandStore } from '@/stores/commandStore'\n\nimport CanvasModeSelector from './CanvasModeSelector.vue'\nimport ZoomControlsModal from './modals/ZoomControlsModal.vue'\n\nconst { t } = useI18n()\nconst commandStore = useCommandStore()\nconst { formatKeySequence } = useCommandStore()\nconst canvasStore = useCanvasStore()\nconst settingStore = useSettingStore()\nconst canvasInteractions = useCanvasInteractions()\nconst minimap = useMinimap()\n\nconst { isModalVisible, toggleModal, hideModal, hasActivePopup } =\n  useZoomControls()\n\nconst stringifiedMinimapStyles = computed(() => {\n  const buttonGroupKeys = ['borderRadius']\n  const buttonKeys = ['borderRadius']\n  const additionalButtonStyles = {\n    border: 'none'\n  }\n\n  const containerStyles = minimap.containerStyles.value\n\n  const buttonStyles = {\n    ...Object.fromEntries(\n      Object.entries(containerStyles).filter(([key]) =>\n        buttonKeys.includes(key)\n      )\n    ),\n    ...additionalButtonStyles\n  }\n  const buttonGroupStyles = Object.entries(containerStyles)\n    .filter(([key]) => buttonGroupKeys.includes(key))\n    .reduce((acc, [key, value]) => ({ ...acc, [key]: value }), {})\n\n  return { buttonStyles, buttonGroupStyles }\n})\n\n// Computed properties for reactive states\nconst linkHidden = computed(\n  () => settingStore.get('Comfy.LinkRenderMode') === LiteGraph.HIDDEN_LINK\n)\n\n// Computed properties for command text\nconst fitViewCommandText = computed(() =>\n  formatKeySequence(\n    commandStore.getCommand('Comfy.Canvas.FitView')\n  ).toUpperCase()\n)\nconst minimapCommandText = computed(() =>\n  formatKeySequence(\n    commandStore.getCommand('Comfy.Canvas.ToggleMinimap')\n  ).toUpperCase()\n)\n\n// Computed properties for button classes and states\nconst zoomButtonClass = computed(() => [\n  'bg-comfy-menu-bg',\n  isModalVisible.value ? 'not-active:bg-interface-panel-selected-surface!' : '',\n  'hover:bg-interface-button-hover-surface!',\n  'p-0',\n  'h-8',\n  'w-15'\n])\n\nconst minimapButtonClass = computed(() => ({\n  'bg-comfy-menu-bg': true,\n  'hover:bg-interface-button-hover-surface!': true,\n  'not-active:bg-interface-panel-selected-surface!': settingStore.get(\n    'Comfy.Minimap.Visible'\n  ),\n  'p-0': true,\n  'w-8': true,\n  'h-8': true\n}))\n\n// Computed properties for tooltip and aria-label texts\nconst fitViewTooltip = computed(() => {\n  const label = t('graphCanvasMenu.fitView')\n  const shortcut = fitViewCommandText.value\n  return shortcut ? `${label} (${shortcut})` : label\n})\nconst minimapTooltip = computed(() => {\n  const label = settingStore.get('Comfy.Minimap.Visible')\n    ? t('zoomControls.hideMinimap')\n    : t('zoomControls.showMinimap')\n  const shortcut = minimapCommandText.value\n  return shortcut ? `${label} (${shortcut})` : label\n})\nconst linkVisibilityTooltip = computed(() =>\n  linkHidden.value\n    ? t('graphCanvasMenu.showLinks')\n    : t('graphCanvasMenu.hideLinks')\n)\nconst linkVisibilityAriaLabel = computed(() =>\n  linkHidden.value\n    ? t('graphCanvasMenu.showLinks')\n    : t('graphCanvasMenu.hideLinks')\n)\nconst linkVisibleClass = computed(() => [\n  'bg-comfy-menu-bg',\n  linkHidden.value ? 'not-active:bg-interface-panel-selected-surface!' : '',\n  'hover:bg-interface-button-hover-surface!',\n  'p-0',\n  'w-8',\n  'h-8'\n])\n\nonMounted(() => {\n  canvasStore.initScaleSync()\n})\n\n/**\n * Track minimap toggle button click and execute the command.\n */\nconst onMinimapToggleClick = () => {\n  useTelemetry()?.trackUiButtonClicked({\n    button_id: 'graph_menu_minimap_toggle_clicked'\n  })\n  void commandStore.execute('Comfy.Canvas.ToggleMinimap')\n}\n\n/**\n * Track hide/show links button click and execute the command.\n */\nconst onLinkVisibilityToggleClick = () => {\n  useTelemetry()?.trackUiButtonClicked({\n    button_id: 'graph_menu_hide_links_toggle_clicked'\n  })\n  void commandStore.execute('Comfy.Canvas.ToggleLinkVisibility')\n}\n\nonBeforeUnmount(() => {\n  canvasStore.cleanupScaleSync()\n})\n</script>\n","<template>\n  <div\n    v-if=\"tooltipText\"\n    ref=\"tooltipRef\"\n    class=\"node-tooltip\"\n    :style=\"{ left, top }\"\n  >\n    {{ tooltipText }}\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useEventListener } from '@vueuse/core'\nimport { nextTick, ref } from 'vue'\n\nimport { st } from '@/i18n'\nimport {\n  LiteGraph,\n  isOverNodeInput,\n  isOverNodeOutput\n} from '@/lib/litegraph/src/litegraph'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { app as comfyApp } from '@/scripts/app'\nimport { isDOMWidget } from '@/scripts/domWidget'\nimport { useNodeDefStore } from '@/stores/nodeDefStore'\nimport { normalizeI18nKey } from '@/utils/formatUtil'\n\nlet idleTimeout: number\nconst nodeDefStore = useNodeDefStore()\nconst settingStore = useSettingStore()\nconst tooltipRef = ref<HTMLDivElement | undefined>()\nconst tooltipText = ref('')\nconst left = ref<string>()\nconst top = ref<string>()\n\nfunction hideTooltip() {\n  return (tooltipText.value = '')\n}\n\nasync function showTooltip(tooltip: string | null | undefined) {\n  if (!tooltip) return\n\n  left.value = comfyApp.canvas.mouse[0] + 'px'\n  top.value = comfyApp.canvas.mouse[1] + 'px'\n  tooltipText.value = tooltip\n\n  await nextTick()\n\n  const rect = tooltipRef.value?.getBoundingClientRect()\n  if (!rect) return\n\n  if (rect.right > window.innerWidth) {\n    left.value = comfyApp.canvas.mouse[0] - rect.width + 'px'\n  }\n\n  if (rect.top < 0) {\n    top.value = comfyApp.canvas.mouse[1] + rect.height + 'px'\n  }\n}\n\nfunction onIdle() {\n  const { canvas } = comfyApp\n  const node = canvas?.node_over\n  if (!node) return\n\n  const ctor = node.constructor as { title_mode?: 0 | 1 | 2 | 3 }\n  const nodeDef = nodeDefStore.nodeDefsByName[node.type ?? '']\n\n  if (\n    ctor.title_mode !== LiteGraph.NO_TITLE &&\n    canvas.graph_mouse[1] < node.pos[1] // If we are over a node, but not within the node then we are on its title\n  ) {\n    return showTooltip(nodeDef?.description)\n  }\n\n  if (node.flags?.collapsed) return\n\n  const inputSlot = isOverNodeInput(\n    node,\n    canvas.graph_mouse[0],\n    canvas.graph_mouse[1],\n    [0, 0]\n  )\n  if (inputSlot !== -1) {\n    const inputName = node.inputs[inputSlot].name\n    const translatedTooltip = st(\n      `nodeDefs.${normalizeI18nKey(node.type ?? '')}.inputs.${normalizeI18nKey(inputName)}.tooltip`,\n      nodeDef?.inputs[inputName]?.tooltip ?? ''\n    )\n    return showTooltip(translatedTooltip)\n  }\n\n  const outputSlot = isOverNodeOutput(\n    node,\n    canvas.graph_mouse[0],\n    canvas.graph_mouse[1],\n    [0, 0]\n  )\n  if (outputSlot !== -1) {\n    const translatedTooltip = st(\n      `nodeDefs.${normalizeI18nKey(node.type ?? '')}.outputs.${outputSlot}.tooltip`,\n      nodeDef?.outputs[outputSlot]?.tooltip ?? ''\n    )\n    return showTooltip(translatedTooltip)\n  }\n\n  const widget = comfyApp.canvas.getWidgetAtCursor()\n  // Dont show for DOM widgets, these use native browser tooltips as we dont get proper mouse events on these\n  if (widget && !isDOMWidget(widget)) {\n    const translatedTooltip = st(\n      `nodeDefs.${normalizeI18nKey(node.type ?? '')}.inputs.${normalizeI18nKey(widget.name)}.tooltip`,\n      nodeDef?.inputs[widget.name]?.tooltip ?? ''\n    )\n    // Widget tooltip can be set dynamically, current translation collection does not support this.\n    return showTooltip(widget.tooltip ?? translatedTooltip)\n  }\n}\n\nconst onMouseMove = (e: MouseEvent) => {\n  hideTooltip()\n  clearTimeout(idleTimeout)\n\n  if ((e.target as Node).nodeName !== 'CANVAS') return\n  idleTimeout = window.setTimeout(\n    onIdle,\n    settingStore.get('LiteGraph.Node.TooltipDelay')\n  )\n}\n\nuseEventListener(window, 'mousemove', onMouseMove)\nuseEventListener(window, 'click', hideTooltip)\n</script>\n\n<style lang=\"css\" scoped>\n.node-tooltip {\n  pointer-events: none;\n  background: var(--comfy-input-bg);\n  border-radius: 5px;\n  box-shadow: 0 0 5px rgb(0 0 0 / 0.4);\n  color: var(--input-text);\n  left: 0;\n  max-width: 30vw;\n  padding: 4px 8px;\n  position: absolute;\n  top: 0;\n  transform: translate(5px, calc(-100% - 5px));\n  white-space: pre-wrap;\n  z-index: 99999;\n}\n</style>\n","<template>\n  <Button\n    v-tooltip.top=\"{\n      value: $t('commands.Comfy_Canvas_ToggleSelectedNodes_Bypass.label'),\n      showDelay: 1000\n    }\"\n    variant=\"muted-textonly\"\n    :aria-label=\"$t('commands.Comfy_Canvas_ToggleSelectedNodes_Bypass.label')\"\n    data-testid=\"bypass-button\"\n    class=\"hover:bg-secondary-background\"\n    @click=\"toggleBypass\"\n  >\n    <i class=\"icon-[lucide--redo-dot] size-4\" />\n  </Button>\n</template>\n\n<script setup lang=\"ts\">\nimport Button from '@/components/ui/button/Button.vue'\nimport { useCommandStore } from '@/stores/commandStore'\n\nconst commandStore = useCommandStore()\n\nconst toggleBypass = async () => {\n  await commandStore.execute('Comfy.Canvas.ToggleSelectedNodes.Bypass')\n}\n</script>\n","<template>\n  <div class=\"relative\">\n    <Button\n      v-tooltip.top=\"{\n        value: localizedCurrentColorName ?? t('color.noColor'),\n        showDelay: 1000\n      }\"\n      data-testid=\"color-picker-button\"\n      variant=\"muted-textonly\"\n      :aria-label=\"t('g.color')\"\n      @click=\"() => (showColorPicker = !showColorPicker)\"\n    >\n      <div class=\"flex items-center gap-1 px-0\">\n        <i class=\"pi pi-circle-fill\" :style=\"{ color: currentColor ?? '' }\" />\n        <i class=\"icon-[lucide--chevron-down]\" />\n      </div>\n    </Button>\n    <div\n      v-if=\"showColorPicker\"\n      class=\"color-picker-container absolute -top-10 left-1/2\"\n    >\n      <SelectButton\n        :model-value=\"selectedColorOption\"\n        :options=\"colorOptions\"\n        option-label=\"name\"\n        data-key=\"value\"\n        @update:model-value=\"applyColor\"\n      >\n        <template #option=\"{ option }\">\n          <i\n            v-tooltip.top=\"option.localizedName\"\n            class=\"pi pi-circle-fill\"\n            :style=\"{\n              color: isLightTheme ? option.value.light : option.value.dark\n            }\"\n            :data-testid=\"option.name\"\n          />\n        </template>\n      </SelectButton>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport SelectButton from 'primevue/selectbutton'\nimport type { Raw } from 'vue'\nimport { computed, ref, watch } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport Button from '@/components/ui/button/Button.vue'\nimport type {\n  ColorOption as CanvasColorOption,\n  Positionable\n} from '@/lib/litegraph/src/litegraph'\nimport {\n  LGraphCanvas,\n  LiteGraph,\n  isColorable\n} from '@/lib/litegraph/src/litegraph'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useColorPaletteStore } from '@/stores/workspace/colorPaletteStore'\nimport { adjustColor } from '@/utils/colorUtil'\nimport { getItemsColorOption } from '@/utils/litegraphUtil'\n\nconst { t } = useI18n()\nconst canvasStore = useCanvasStore()\nconst colorPaletteStore = useColorPaletteStore()\nconst workflowStore = useWorkflowStore()\nconst isLightTheme = computed(\n  () => colorPaletteStore.completedActivePalette.light_theme\n)\nconst toLightThemeColor = (color: string) =>\n  adjustColor(color, { lightness: 0.5 })\n\nconst showColorPicker = ref(false)\n\ntype ColorOption = {\n  name: string\n  localizedName: string\n  value: {\n    dark: string\n    light: string\n  }\n}\n\nconst NO_COLOR_OPTION: ColorOption = {\n  name: 'noColor',\n  localizedName: t('color.noColor'),\n  value: {\n    dark: LiteGraph.NODE_DEFAULT_BGCOLOR,\n    light: toLightThemeColor(LiteGraph.NODE_DEFAULT_BGCOLOR)\n  }\n}\nconst colorOptions: ColorOption[] = [\n  NO_COLOR_OPTION,\n  ...Object.entries(LGraphCanvas.node_colors).map(([name, color]) => ({\n    name,\n    localizedName: t(`color.${name}`),\n    value: {\n      dark: color.bgcolor,\n      light: toLightThemeColor(color.bgcolor)\n    }\n  }))\n]\n\nconst selectedColorOption = ref<ColorOption | null>(null)\nconst applyColor = (colorOption: ColorOption | null) => {\n  const colorName = colorOption?.name ?? NO_COLOR_OPTION.name\n  const canvasColorOption =\n    colorName === NO_COLOR_OPTION.name\n      ? null\n      : LGraphCanvas.node_colors[colorName]\n\n  for (const item of canvasStore.selectedItems) {\n    if (isColorable(item)) {\n      item.setColorOption(canvasColorOption)\n    }\n  }\n\n  canvasStore.canvas?.setDirty(true, true)\n  currentColorOption.value = canvasColorOption\n  showColorPicker.value = false\n  workflowStore.activeWorkflow?.changeTracker.checkState()\n}\n\nconst currentColorOption = ref<CanvasColorOption | null>(null)\nconst currentColor = computed(() =>\n  currentColorOption.value\n    ? isLightTheme.value\n      ? toLightThemeColor(currentColorOption.value?.bgcolor)\n      : currentColorOption.value?.bgcolor\n    : null\n)\n\nconst localizedCurrentColorName = computed(() => {\n  if (!currentColorOption.value?.bgcolor) return null\n  const colorOption = colorOptions.find(\n    (option) =>\n      option.value.dark === currentColorOption.value?.bgcolor ||\n      option.value.light === currentColorOption.value?.bgcolor\n  )\n  return colorOption?.localizedName ?? NO_COLOR_OPTION.localizedName\n})\nconst updateColorSelectionFromNode = (\n  newSelectedItems: Raw<Positionable[]>\n) => {\n  showColorPicker.value = false\n  selectedColorOption.value = null\n  currentColorOption.value = getItemsColorOption(newSelectedItems)\n}\nwatch(\n  () => canvasStore.selectedItems,\n  (newSelectedItems) => {\n    updateColorSelectionFromNode(newSelectedItems)\n  },\n  { immediate: true }\n)\n</script>\n\n<style scoped>\n@reference '../../../assets/css/style.css';\n\n.color-picker-container {\n  transform: translateX(-50%);\n}\n\n:deep(.p-togglebutton) {\n  @apply py-2 px-1;\n}\n</style>\n","<template>\n  <Button\n    v-tooltip.top=\"{\n      value: $t('commands.Comfy_Graph_EditSubgraphWidgets.label'),\n      showDelay: 1000\n    }\"\n    variant=\"muted-textonly\"\n    :aria-label=\"$t('commands.Comfy_Graph_EditSubgraphWidgets.label')\"\n    @click=\"handleClick\"\n  >\n    <i class=\"icon-[lucide--settings-2]\" />\n  </Button>\n</template>\n<script setup lang=\"ts\">\nimport Button from '@/components/ui/button/Button.vue'\nimport { useRightSidePanelStore } from '@/stores/workspace/rightSidePanelStore'\n\nconst rightSidePanelStore = useRightSidePanelStore()\n\nconst handleClick = () => {\n  rightSidePanelStore.openPanel('subgraph')\n}\n</script>\n","<template>\n  <Button\n    v-if=\"isUnpackVisible\"\n    v-tooltip.top=\"{\n      value: $t('commands.Comfy_Graph_UnpackSubgraph.label'),\n      showDelay: 1000\n    }\"\n    variant=\"muted-textonly\"\n    :aria-label=\"$t('commands.Comfy_Graph_UnpackSubgraph.label')\"\n    data-testid=\"convert-to-subgraph-button\"\n    @click=\"() => commandStore.execute('Comfy.Graph.UnpackSubgraph')\"\n  >\n    <i class=\"icon-[lucide--expand] size-4\" />\n  </Button>\n  <Button\n    v-else-if=\"isConvertVisible\"\n    v-tooltip.top=\"{\n      value: $t('commands.Comfy_Graph_ConvertToSubgraph.label'),\n      showDelay: 1000\n    }\"\n    variant=\"muted-textonly\"\n    size=\"icon\"\n    :aria-label=\"$t('commands.Comfy_Graph_ConvertToSubgraph.label')\"\n    data-testid=\"convert-to-subgraph-button\"\n    @click=\"() => commandStore.execute('Comfy.Graph.ConvertToSubgraph')\"\n  >\n    <i class=\"icon-[lucide--shrink] size-4\" />\n  </Button>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\n\nimport Button from '@/components/ui/button/Button.vue'\nimport { useSelectionState } from '@/composables/graph/useSelectionState'\nimport { useCommandStore } from '@/stores/commandStore'\n\nconst commandStore = useCommandStore()\nconst { isSingleSubgraph, hasAnySelection } = useSelectionState()\n\nconst isUnpackVisible = isSingleSubgraph\nconst isConvertVisible = computed(\n  () => hasAnySelection.value && !isSingleSubgraph.value\n)\n</script>\n","<template>\n  <Button\n    v-show=\"isDeletable\"\n    v-tooltip.top=\"{\n      value: $t('commands.Comfy_Canvas_DeleteSelectedItems.label'),\n      showDelay: 1000\n    }\"\n    variant=\"muted-textonly\"\n    :aria-label=\"$t('commands.Comfy_Canvas_DeleteSelectedItems.label')\"\n    data-testid=\"delete-button\"\n    @click=\"() => commandStore.execute('Comfy.Canvas.DeleteSelectedItems')\"\n  >\n    <i class=\"icon-[lucide--trash-2]\" />\n  </Button>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\n\nimport Button from '@/components/ui/button/Button.vue'\nimport { useSelectionState } from '@/composables/graph/useSelectionState'\nimport type { Positionable } from '@/lib/litegraph/src/interfaces'\nimport { useCommandStore } from '@/stores/commandStore'\n\nconst commandStore = useCommandStore()\nconst { selectedItems } = useSelectionState()\n\nconst isDeletable = computed(() =>\n  selectedItems.value.some((x: Positionable) => x.removable !== false)\n)\n</script>\n","<template>\n  <Button\n    v-tooltip.top=\"{\n      value: t('selectionToolbox.executeButton.tooltip'),\n      showDelay: 1000\n    }\"\n    variant=\"primary\"\n    :aria-label=\"t('selectionToolbox.executeButton.tooltip')\"\n    @mouseenter=\"() => handleMouseEnter()\"\n    @mouseleave=\"() => handleMouseLeave()\"\n    @click=\"handleClick\"\n  >\n    <i class=\"icon-[lucide--play]\" />\n  </Button>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, ref } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport Button from '@/components/ui/button/Button.vue'\nimport { useSelectionState } from '@/composables/graph/useSelectionState'\nimport type { LGraphNode } from '@/lib/litegraph/src/litegraph'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useCommandStore } from '@/stores/commandStore'\nimport { isLGraphNode } from '@/utils/litegraphUtil'\nimport { isOutputNode } from '@/utils/nodeFilterUtil'\n\nconst { t } = useI18n()\nconst commandStore = useCommandStore()\nconst canvasStore = useCanvasStore()\nconst { selectedNodes } = useSelectionState()\n\nconst canvas = canvasStore.getCanvas()\nconst buttonHovered = ref(false)\nconst selectedOutputNodes = computed(() =>\n  selectedNodes.value.filter(isLGraphNode).filter(isOutputNode)\n)\n\nfunction outputNodeStokeStyle(this: LGraphNode) {\n  if (\n    this.selected &&\n    this.constructor.nodeData?.output_node &&\n    buttonHovered.value\n  ) {\n    return { color: 'orange', lineWidth: 2, padding: 10 }\n  }\n}\n\nconst handleMouseEnter = () => {\n  buttonHovered.value = true\n  for (const node of selectedOutputNodes.value) {\n    node.strokeStyles['outputNode'] = outputNodeStokeStyle\n  }\n  canvas.setDirty(true)\n}\n\nconst handleMouseLeave = () => {\n  buttonHovered.value = false\n  canvas.setDirty(true)\n}\n\nconst handleClick = async () => {\n  await commandStore.execute('Comfy.QueueSelectedOutputNodes')\n}\n</script>\n","<template>\n  <Button\n    v-tooltip.top=\"{\n      value:\n        st(`commands.${normalizeI18nKey(command.id)}.label`, '') || undefined,\n      showDelay: 1000\n    }\"\n    variant=\"muted-textonly\"\n    :aria-label=\"st(`commands.${normalizeI18nKey(command.id)}.label`, '')\"\n    @click=\"() => commandStore.execute(command.id)\"\n  >\n    <i\n      :class=\"[\n        typeof command.icon === 'function' ? command.icon() : command.icon\n      ]\"\n    />\n  </Button>\n</template>\n\n<script setup lang=\"ts\">\nimport Button from '@/components/ui/button/Button.vue'\nimport { st } from '@/i18n'\nimport type { ComfyCommand } from '@/stores/commandStore'\nimport { useCommandStore } from '@/stores/commandStore'\nimport { normalizeI18nKey } from '@/utils/formatUtil'\n\ndefineProps<{\n  command: ComfyCommand\n}>()\n\nconst commandStore = useCommandStore()\n</script>\n","<template>\n  <Button\n    v-tooltip.top=\"{\n      value: $t('g.info'),\n      showDelay: 1000\n    }\"\n    data-testid=\"info-button\"\n    variant=\"muted-textonly\"\n    :aria-label=\"$t('g.info')\"\n    @click=\"onInfoClick\"\n  >\n    <i class=\"icon-[lucide--info]\" />\n  </Button>\n</template>\n\n<script setup lang=\"ts\">\nimport Button from '@/components/ui/button/Button.vue'\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useRightSidePanelStore } from '@/stores/workspace/rightSidePanelStore'\n\nconst rightSidePanelStore = useRightSidePanelStore()\n\n/**\n * Track node info button click and toggle node help.\n */\nconst onInfoClick = () => {\n  useTelemetry()?.trackUiButtonClicked({\n    button_id: 'selection_toolbox_node_info_opened'\n  })\n  rightSidePanelStore.openPanel('info')\n}\n</script>\n","<template>\n  <Button\n    v-tooltip.top=\"{\n      value: $t('commands.Comfy_3DViewer_Open3DViewer.label'),\n      showDelay: 1000\n    }\"\n    variant=\"muted-textonly\"\n    :aria-label=\"$t('commands.Comfy_3DViewer_Open3DViewer.label')\"\n    @click=\"open3DViewer\"\n  >\n    <i class=\"icon-[lucide--pencil]\" />\n  </Button>\n</template>\n\n<script setup lang=\"ts\">\nimport Button from '@/components/ui/button/Button.vue'\nimport { useCommandStore } from '@/stores/commandStore'\n\nconst commandStore = useCommandStore()\n\nconst open3DViewer = () => {\n  void commandStore.execute('Comfy.3DViewer.Open3DViewer')\n}\n</script>\n","<template>\n  <Button\n    v-show=\"isSingleImageNode\"\n    v-tooltip.top=\"{\n      value: $t('commands.Comfy_MaskEditor_OpenMaskEditor.label'),\n      showDelay: 1000\n    }\"\n    variant=\"muted-textonly\"\n    :aria-label=\"$t('commands.Comfy_MaskEditor_OpenMaskEditor.label')\"\n    @click=\"openMaskEditor\"\n  >\n    <i class=\"icon-[comfy--mask]\" />\n  </Button>\n</template>\n\n<script setup lang=\"ts\">\nimport Button from '@/components/ui/button/Button.vue'\nimport { useSelectionState } from '@/composables/graph/useSelectionState'\nimport { useCommandStore } from '@/stores/commandStore'\n\nconst commandStore = useCommandStore()\nconst { isSingleImageNode } = useSelectionState()\n\nconst openMaskEditor = () => {\n  void commandStore.execute('Comfy.MaskEditor.OpenMaskEditor')\n}\n</script>\n","import { computed, ref, watchEffect } from 'vue'\n\nimport type { LGraphNode } from '@/lib/litegraph/src/litegraph'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { isLGraphNode } from '@/utils/litegraphUtil'\n\ninterface RefreshableItem {\n  refresh: () => Promise<void> | void\n}\n\nconst isRefreshableWidget = (widget: unknown): widget is RefreshableItem =>\n  widget != null &&\n  typeof widget === 'object' &&\n  'refresh' in widget &&\n  typeof widget.refresh === 'function'\n\n/**\n * Tracks selected nodes and their refreshable widgets\n */\nexport const useRefreshableSelection = () => {\n  const graphStore = useCanvasStore()\n  const selectedNodes = ref<LGraphNode[]>([])\n\n  watchEffect(() => {\n    selectedNodes.value = graphStore.selectedItems.filter(isLGraphNode)\n  })\n\n  const refreshableWidgets = computed<RefreshableItem[]>(() =>\n    selectedNodes.value.flatMap((node) => {\n      if (!node.widgets) return []\n      const items: RefreshableItem[] = []\n      for (const widget of node.widgets) {\n        if (isRefreshableWidget(widget)) {\n          items.push(widget)\n        }\n      }\n      return items\n    })\n  )\n\n  const isRefreshable = computed(() => refreshableWidgets.value.length > 0)\n\n  async function refreshSelected() {\n    if (!isRefreshable.value) return\n\n    await Promise.all(refreshableWidgets.value.map((item) => item.refresh()))\n  }\n\n  return {\n    isRefreshable,\n    refreshSelected\n  }\n}\n","<template>\n  <Button\n    v-show=\"isRefreshable\"\n    v-tooltip.top=\"t('g.refreshNode')\"\n    variant=\"muted-textonly\"\n    :aria-label=\"t('g.refreshNode')\"\n    data-testid=\"refresh-button\"\n    @click=\"refreshSelected\"\n  >\n    <i class=\"icon-[lucide--refresh-cw]\" />\n  </Button>\n</template>\n\n<script setup lang=\"ts\">\nimport { useI18n } from 'vue-i18n'\n\nimport Button from '@/components/ui/button/Button.vue'\nimport { useRefreshableSelection } from '@/composables/useRefreshableSelection'\n\nconst { t } = useI18n()\nconst { isRefreshable, refreshSelected } = useRefreshableSelection()\n</script>\n","<template>\n  <Button\n    v-show=\"isVisible\"\n    v-tooltip.top=\"{\n      value: $t('commands.Comfy_PublishSubgraph.label'),\n      showDelay: 1000\n    }\"\n    variant=\"muted-textonly\"\n    :aria-label=\"$t('commands.Comfy_PublishSubgraph.label')\"\n    @click=\"() => commandStore.execute('Comfy.PublishSubgraph')\"\n  >\n    <i class=\"icon-[lucide--book-open]\" />\n  </Button>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\n\nimport Button from '@/components/ui/button/Button.vue'\nimport { SubgraphNode } from '@/lib/litegraph/src/litegraph'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useCommandStore } from '@/stores/commandStore'\n\nconst commandStore = useCommandStore()\nconst canvasStore = useCanvasStore()\n\nconst isVisible = computed(() => {\n  return (\n    canvasStore.selectedItems?.length === 1 &&\n    canvasStore.selectedItems[0] instanceof SubgraphNode\n  )\n})\n</script>\n","import { useElementBounding, useRafFn } from '@vueuse/core'\nimport { computed, onUnmounted, ref, watch, watchEffect } from 'vue'\nimport type { Ref } from 'vue'\n\nimport { useSelectedLiteGraphItems } from '@/composables/canvas/useSelectedLiteGraphItems'\nimport { useVueFeatureFlags } from '@/composables/useVueFeatureFlags'\nimport type { ReadOnlyRect } from '@/lib/litegraph/src/interfaces'\nimport {\n  LGraphGroup,\n  LGraphNode,\n  LiteGraph\n} from '@/lib/litegraph/src/litegraph'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { layoutStore } from '@/renderer/core/layout/store/layoutStore'\nimport { isLGraphGroup, isLGraphNode } from '@/utils/litegraphUtil'\nimport { computeUnionBounds } from '@/utils/mathUtil'\n\n/**\n * Manages the position of the selection toolbox independently.\n * Uses CSS custom properties for performant transform updates.\n */\n\n// Shared signals for auxiliary UI (e.g., MoreOptions) to coordinate hide/restore\nconst moreOptionsOpen = ref(false)\nconst forceCloseMoreOptionsSignal = ref(0)\nconst restoreMoreOptionsSignal = ref(0)\nconst moreOptionsRestorePending = ref(false)\nlet moreOptionsWasOpenBeforeDrag = false\nlet moreOptionsSelectionSignature: string | null = null\n\nfunction buildSelectionSignature(\n  store: ReturnType<typeof useCanvasStore>\n): string | null {\n  const c = store.canvas\n  if (!c) return null\n  const items = Array.from(c.selectedItems)\n  if (items.length !== 1) return null\n  const item = items[0]\n  if (isLGraphNode(item)) return `N:${item.id}`\n  if (isLGraphGroup(item)) return `G:${item.id}`\n  return null\n}\n\nfunction currentSelectionMatchesSignature(\n  store: ReturnType<typeof useCanvasStore>\n) {\n  if (!moreOptionsSelectionSignature) return false\n  return buildSelectionSignature(store) === moreOptionsSelectionSignature\n}\n\nexport function useSelectionToolboxPosition(\n  toolboxRef: Ref<HTMLElement | undefined>\n) {\n  const canvasStore = useCanvasStore()\n  const lgCanvas = canvasStore.getCanvas()\n  const { getSelectableItems } = useSelectedLiteGraphItems()\n  const { shouldRenderVueNodes } = useVueFeatureFlags()\n\n  // World position of selection center\n  const worldPosition = ref({ x: 0, y: 0 })\n\n  const visible = ref(false)\n\n  // Use VueUse to reactively track canvas bounding rect\n  const { left: canvasLeft, top: canvasTop } = useElementBounding(\n    lgCanvas.canvas\n  )\n\n  // Unified dragging state - combines both LiteGraph and Vue node dragging\n  const isDragging = computed((): boolean => {\n    const litegraphDragging = canvasStore.canvas?.state?.draggingItems ?? false\n    const vueNodeDragging =\n      shouldRenderVueNodes.value && layoutStore.isDraggingVueNodes.value\n    return litegraphDragging || vueNodeDragging\n  })\n\n  /**\n   * Update position based on selection\n   */\n  const updateSelectionBounds = () => {\n    const selectableItems = getSelectableItems()\n\n    if (!selectableItems.size) {\n      visible.value = false\n      return\n    }\n\n    // Don't show toolbox while dragging\n    if (isDragging.value) {\n      visible.value = false\n      return\n    }\n\n    visible.value = true\n\n    // Get bounds for all selected items\n    const allBounds: ReadOnlyRect[] = []\n    for (const item of selectableItems) {\n      // Skip items without valid IDs\n      if (item.id == null) continue\n\n      if (shouldRenderVueNodes.value && typeof item.id === 'string') {\n        // Use layout store for Vue nodes (only works with string IDs)\n        const layout = layoutStore.getNodeLayoutRef(item.id).value\n        if (layout) {\n          allBounds.push([\n            layout.bounds.x,\n            layout.bounds.y,\n            layout.bounds.width,\n            layout.bounds.height\n          ])\n        }\n      } else {\n        // Fallback to LiteGraph bounds for regular nodes or non-string IDs\n        if (item instanceof LGraphNode || item instanceof LGraphGroup) {\n          allBounds.push([\n            item.pos[0],\n            item.pos[1] - LiteGraph.NODE_TITLE_HEIGHT,\n            item.size[0],\n            item.size[1] + LiteGraph.NODE_TITLE_HEIGHT\n          ])\n        }\n      }\n    }\n\n    // Compute union bounds\n    const unionBounds = computeUnionBounds(allBounds)\n    if (!unionBounds) return\n\n    worldPosition.value = {\n      x: unionBounds.x + unionBounds.width / 2,\n      // createBounds() applied a default padding of 10px\n      // so adjust Y to maintain visual consistency\n      y: unionBounds.y - 10\n    }\n\n    updateTransform()\n  }\n\n  const updateTransform = () => {\n    if (!visible.value) return\n\n    const { scale, offset } = lgCanvas.ds\n\n    const screenX =\n      (worldPosition.value.x + offset[0]) * scale + canvasLeft.value\n    const screenY =\n      (worldPosition.value.y + offset[1]) * scale + canvasTop.value\n\n    // Update CSS custom properties directly for best performance\n    if (toolboxRef.value) {\n      toolboxRef.value.style.setProperty('--tb-x', `${screenX}px`)\n      toolboxRef.value.style.setProperty('--tb-y', `${screenY}px`)\n    }\n  }\n\n  // Sync with canvas transform\n  const { resume: startSync, pause: stopSync } = useRafFn(updateTransform)\n\n  watchEffect(() => {\n    if (visible.value) {\n      startSync()\n    } else {\n      stopSync()\n    }\n  })\n\n  // Watch for selection changes\n  watch(\n    () => canvasStore.getCanvas().state.selectionChanged,\n    (changed) => {\n      if (changed) {\n        if (moreOptionsRestorePending.value || moreOptionsSelectionSignature) {\n          moreOptionsRestorePending.value = false\n          moreOptionsWasOpenBeforeDrag = false\n          if (!moreOptionsOpen.value) {\n            moreOptionsSelectionSignature = null\n          } else {\n            moreOptionsSelectionSignature = buildSelectionSignature(canvasStore)\n          }\n        }\n        updateSelectionBounds()\n        canvasStore.getCanvas().state.selectionChanged = false\n      }\n    },\n    { immediate: true }\n  )\n  watch(\n    () => moreOptionsOpen.value,\n    (v) => {\n      if (v) {\n        moreOptionsSelectionSignature = buildSelectionSignature(canvasStore)\n      } else if (!canvasStore.canvas?.state?.draggingItems) {\n        moreOptionsSelectionSignature = null\n        if (moreOptionsRestorePending.value)\n          moreOptionsRestorePending.value = false\n      }\n    }\n  )\n\n  const handleDragStateChange = (dragging: boolean) => {\n    if (dragging) {\n      handleDragStart()\n      return\n    }\n\n    handleDragEnd()\n  }\n\n  const handleDragStart = () => {\n    visible.value = false\n\n    // Early return if more options wasn't open\n    if (!moreOptionsOpen.value) {\n      moreOptionsRestorePending.value = false\n      moreOptionsWasOpenBeforeDrag = false\n      return\n    }\n\n    // Handle more options cleanup\n    const currentSig = buildSelectionSignature(canvasStore)\n    const selectionChanged = currentSig !== moreOptionsSelectionSignature\n\n    if (selectionChanged) {\n      moreOptionsSelectionSignature = null\n    }\n    moreOptionsOpen.value = false\n    moreOptionsWasOpenBeforeDrag = true\n    moreOptionsRestorePending.value = !!moreOptionsSelectionSignature\n\n    if (moreOptionsRestorePending.value) {\n      forceCloseMoreOptionsSignal.value++\n      return\n    }\n\n    moreOptionsWasOpenBeforeDrag = false\n  }\n\n  const handleDragEnd = () => {\n    requestAnimationFrame(() => {\n      updateSelectionBounds()\n\n      const selectionMatches = currentSelectionMatchesSignature(canvasStore)\n      const shouldRestore =\n        moreOptionsWasOpenBeforeDrag &&\n        visible.value &&\n        moreOptionsRestorePending.value &&\n        selectionMatches\n\n      // Single point of assignment for each ref\n      moreOptionsRestorePending.value =\n        shouldRestore && moreOptionsRestorePending.value\n      moreOptionsWasOpenBeforeDrag = false\n\n      if (shouldRestore) {\n        restoreMoreOptionsSignal.value++\n      }\n    })\n  }\n\n  watch(isDragging, handleDragStateChange)\n\n  onUnmounted(() => {\n    resetMoreOptionsState()\n  })\n\n  return {\n    visible\n  }\n}\n\n// External cleanup utility to be called when SelectionToolbox component unmounts\nfunction resetMoreOptionsState() {\n  moreOptionsOpen.value = false\n  moreOptionsRestorePending.value = false\n  moreOptionsWasOpenBeforeDrag = false\n  moreOptionsSelectionSignature = null\n}\n","import { default as DOMPurify } from 'dompurify'\n\nimport { LiteGraph } from '@/lib/litegraph/src/litegraph'\nimport type {\n  IContextMenuValue,\n  LGraphNode,\n  IContextMenuOptions,\n  ContextMenu\n} from '@/lib/litegraph/src/litegraph'\n\nimport type { MenuOption, SubMenuOption } from './useMoreOptionsMenu'\nimport type { ContextMenuDivElement } from '@/lib/litegraph/src/interfaces'\n\n/**\n * Hard blacklist - items that should NEVER be included\n */\nconst HARD_BLACKLIST = new Set([\n  'Properties', // Never include Properties submenu\n  'Colors', // Use singular \"Color\" instead\n  'Shapes', // Use singular \"Shape\" instead\n  'Title',\n  'Mode',\n  'Properties Panel',\n  'Copy (Clipspace)'\n])\n\n/**\n * Core menu items - items that should appear in the main menu, not under Extensions\n * Includes both LiteGraph base menu items and ComfyUI built-in functionality\n */\nconst CORE_MENU_ITEMS = new Set([\n  // Basic operations\n  'Rename',\n  'Copy',\n  'Duplicate',\n  'Clone',\n  // Node state operations\n  'Run Branch',\n  'Pin',\n  'Unpin',\n  'Bypass',\n  'Remove Bypass',\n  'Mute',\n  // Structure operations\n  'Convert to Subgraph',\n  'Frame selection',\n  'Minimize Node',\n  'Expand',\n  'Collapse',\n  // Info and adjustments\n  'Node Info',\n  'Resize',\n  'Title',\n  'Properties Panel',\n  'Adjust Size',\n  // Visual\n  'Color',\n  'Colors',\n  'Shape',\n  'Shapes',\n  'Mode',\n  // Built-in node operations (node-specific)\n  'Open Image',\n  'Copy Image',\n  'Save Image',\n  'Open in Mask Editor',\n  'Edit Subgraph Widgets',\n  'Unpack Subgraph',\n  'Copy (Clipspace)',\n  'Paste (Clipspace)',\n  // Selection and alignment\n  'Align Selected To',\n  'Distribute Nodes',\n  // Deletion\n  'Delete',\n  'Remove',\n  // LiteGraph base items\n  'Show Advanced',\n  'Hide Advanced'\n])\n\n/**\n * Normalize menu item label for duplicate detection\n * Handles variations like Colors/Color, Shapes/Shape, Pin/Unpin, Remove/Delete\n */\nfunction normalizeLabel(label: string): string {\n  return label\n    .toLowerCase()\n    .replace(/^un/, '') // Remove 'un' prefix (Unpin -> Pin)\n    .trim()\n}\n\n/**\n * Check if a similar menu item already exists in the results\n * Returns true if an item with the same normalized label exists\n */\nfunction isDuplicateItem(label: string, existingItems: MenuOption[]): boolean {\n  const normalizedLabel = normalizeLabel(label)\n\n  // Map of equivalent items\n  const equivalents: Record<string, string[]> = {\n    color: ['color', 'colors'],\n    shape: ['shape', 'shapes'],\n    pin: ['pin', 'unpin'],\n    delete: ['remove', 'delete'],\n    duplicate: ['clone', 'duplicate']\n  }\n\n  return existingItems.some((item) => {\n    if (!item.label) return false\n\n    const existingNormalized = normalizeLabel(item.label)\n\n    // Check direct match\n    if (existingNormalized === normalizedLabel) return true\n\n    // Check if they're in the same equivalence group\n    for (const values of Object.values(equivalents)) {\n      if (\n        values.includes(normalizedLabel) &&\n        values.includes(existingNormalized)\n      ) {\n        return true\n      }\n    }\n\n    return false\n  })\n}\n\n/**\n * Check if a menu item is a core menu item (not an extension)\n * Core items include LiteGraph base items and ComfyUI built-in functionality\n */\nfunction isCoreMenuItem(label: string): boolean {\n  return CORE_MENU_ITEMS.has(label)\n}\n\n/**\n * Filter out duplicate menu items based on label\n * Gives precedence to Vue hardcoded options over LiteGraph options\n */\nfunction removeDuplicateMenuOptions(options: MenuOption[]): MenuOption[] {\n  // Group items by label\n  const itemsByLabel = new Map<string, MenuOption[]>()\n  const itemsWithoutLabel: MenuOption[] = []\n\n  for (const opt of options) {\n    // Always keep dividers and category items\n    if (opt.type === 'divider' || opt.type === 'category') {\n      itemsWithoutLabel.push(opt)\n      continue\n    }\n\n    // Items without labels are kept as-is\n    if (!opt.label) {\n      itemsWithoutLabel.push(opt)\n      continue\n    }\n\n    // Group by label\n    if (!itemsByLabel.has(opt.label)) {\n      itemsByLabel.set(opt.label, [])\n    }\n    itemsByLabel.get(opt.label)!.push(opt)\n  }\n\n  // Select best item for each label (prefer vue over litegraph)\n  const result: MenuOption[] = []\n  const seenLabels = new Set<string>()\n\n  for (const opt of options) {\n    // Add non-labeled items in original order\n    if (opt.type === 'divider' || opt.type === 'category' || !opt.label) {\n      if (itemsWithoutLabel.includes(opt)) {\n        result.push(opt)\n        const idx = itemsWithoutLabel.indexOf(opt)\n        itemsWithoutLabel.splice(idx, 1)\n      }\n      continue\n    }\n\n    // Skip if we already processed this label\n    if (seenLabels.has(opt.label)) {\n      continue\n    }\n    seenLabels.add(opt.label)\n\n    // Get all items with this label\n    const duplicates = itemsByLabel.get(opt.label)!\n\n    // If only one item, add it\n    if (duplicates.length === 1) {\n      result.push(duplicates[0])\n      continue\n    }\n\n    // Multiple items: prefer vue source over litegraph\n    const vueItem = duplicates.find((item) => item.source === 'vue')\n    if (vueItem) {\n      result.push(vueItem)\n    } else {\n      // No vue item, just take the first one\n      result.push(duplicates[0])\n    }\n  }\n\n  return result\n}\n\n/**\n * Order groups for menu items - defines the display order of sections\n */\nconst MENU_ORDER: string[] = [\n  // Section 1: Basic operations\n  'Rename',\n  'Copy',\n  'Duplicate',\n  // Section 2: Node actions\n  'Run Branch',\n  'Pin',\n  'Unpin',\n  'Bypass',\n  'Remove Bypass',\n  'Mute',\n  // Section 3: Structure operations\n  'Convert to Subgraph',\n  'Frame selection',\n  'Minimize Node',\n  'Expand',\n  'Collapse',\n  'Resize',\n  'Clone',\n  // Section 4: Node properties\n  'Node Info',\n  'Color',\n  // Section 5: Node-specific operations\n  'Open in Mask Editor',\n  'Open Image',\n  'Copy Image',\n  'Save Image',\n  'Copy (Clipspace)',\n  'Paste (Clipspace)',\n  // Fallback for other core items\n  'Convert to Group Node (Deprecated)'\n]\n\n/**\n * Get the order index for a menu item (lower = earlier in menu)\n */\nfunction getMenuItemOrder(label: string): number {\n  const index = MENU_ORDER.indexOf(label)\n  return index === -1 ? 999 : index\n}\n\n/**\n * Build structured menu with core items first, then extensions under a labeled section\n * Ensures Delete always appears at the bottom\n */\nexport function buildStructuredMenu(options: MenuOption[]): MenuOption[] {\n  // First, remove duplicates (giving precedence to Vue hardcoded options)\n  const deduplicated = removeDuplicateMenuOptions(options)\n  const coreItemsMap = new Map<string, MenuOption>()\n  const extensionItems: MenuOption[] = []\n  let deleteItem: MenuOption | undefined\n\n  // Separate items into core and extension categories\n  for (const option of deduplicated) {\n    // Skip dividers for now - we'll add them between sections later\n    if (option.type === 'divider') {\n      continue\n    }\n\n    // Skip category labels (they'll be added separately)\n    if (option.type === 'category') {\n      continue\n    }\n\n    // Check if this is the Delete/Remove item - save it for the end\n    const isDeleteItem = option.label === 'Delete' || option.label === 'Remove'\n    if (isDeleteItem && !option.hasSubmenu) {\n      deleteItem = option\n      continue\n    }\n\n    // Categorize based on label\n    if (option.label && isCoreMenuItem(option.label)) {\n      coreItemsMap.set(option.label, option)\n    } else {\n      extensionItems.push(option)\n    }\n  }\n  // Build ordered core items based on MENU_ORDER\n  const orderedCoreItems: MenuOption[] = []\n  const coreLabels = Array.from(coreItemsMap.keys())\n  coreLabels.sort((a, b) => getMenuItemOrder(a) - getMenuItemOrder(b))\n\n  // Section boundaries based on MENU_ORDER indices\n  // Section 1: 0-2 (Rename, Copy, Duplicate)\n  // Section 2: 3-8 (Run Branch, Pin, Unpin, Bypass, Remove Bypass, Mute)\n  // Section 3: 9-15 (Convert to Subgraph, Frame selection, Minimize Node, Expand, Collapse, Resize, Clone)\n  // Section 4: 16-17 (Node Info, Color)\n  // Section 5: 18+ (Image operations and fallback items)\n  const getSectionNumber = (index: number): number => {\n    if (index <= 2) return 1\n    if (index <= 8) return 2\n    if (index <= 15) return 3\n    if (index <= 17) return 4\n    return 5\n  }\n\n  let lastSection = 0\n  for (const label of coreLabels) {\n    const item = coreItemsMap.get(label)!\n    const itemIndex = getMenuItemOrder(label)\n    const currentSection = getSectionNumber(itemIndex)\n\n    // Add divider when moving to a new section\n    if (lastSection > 0 && currentSection !== lastSection) {\n      orderedCoreItems.push({ type: 'divider' })\n    }\n\n    orderedCoreItems.push(item)\n    lastSection = currentSection\n  }\n\n  // Build the final menu structure\n  const result: MenuOption[] = []\n\n  // Add ordered core items with their dividers\n  result.push(...orderedCoreItems)\n\n  // Add extensions section if there are extension items\n  if (extensionItems.length > 0) {\n    // Add divider before Extensions section\n    result.push({ type: 'divider' })\n\n    // Add non-clickable Extensions label\n    result.push({\n      label: 'Extensions',\n      type: 'category',\n      disabled: true\n    })\n\n    // Add extension items\n    result.push(...extensionItems)\n  }\n\n  // Add Delete at the bottom if it exists\n  if (deleteItem) {\n    result.push({ type: 'divider' })\n    result.push(deleteItem)\n  }\n\n  return result\n}\n\n/**\n * Convert LiteGraph IContextMenuValue items to Vue MenuOption format\n * Used to bridge LiteGraph context menus into Vue node menus\n * @param items - The LiteGraph menu items to convert\n * @param node - The node context (optional)\n * @param applyStructuring - Whether to apply menu structuring (core/extensions separation). Defaults to true.\n */\nexport function convertContextMenuToOptions(\n  items: (IContextMenuValue | null)[],\n  node?: LGraphNode,\n  applyStructuring: boolean = true\n): MenuOption[] {\n  const result: MenuOption[] = []\n\n  for (const item of items) {\n    // Null items are separators in LiteGraph\n    if (item === null) {\n      result.push({ type: 'divider' })\n      continue\n    }\n\n    // Skip items without content (shouldn't happen, but be safe)\n    if (!item.content) {\n      continue\n    }\n\n    // Skip hard blacklisted items\n    if (HARD_BLACKLIST.has(item.content)) {\n      continue\n    }\n\n    // Skip if a similar item already exists in results\n    if (isDuplicateItem(item.content, result)) {\n      continue\n    }\n\n    const option: MenuOption = {\n      label: item.content,\n      source: 'litegraph'\n    }\n\n    // Pass through disabled state\n    if (item.disabled) {\n      option.disabled = true\n    }\n\n    // Handle submenus\n    if (item.has_submenu) {\n      // Static submenu with pre-defined options\n      if (item.submenu?.options) {\n        option.hasSubmenu = true\n        option.submenu = convertSubmenuToOptions(item.submenu.options)\n      }\n      // Dynamic submenu - callback creates it on-demand\n      else if (item.callback && !item.disabled) {\n        option.hasSubmenu = true\n        // Intercept the callback to capture dynamic submenu items\n        const capturedSubmenu = captureDynamicSubmenu(item, node)\n        if (capturedSubmenu) {\n          option.submenu = capturedSubmenu\n        } else {\n          console.warn(\n            '[ContextMenuConverter] Failed to capture submenu for:',\n            item.content\n          )\n        }\n      }\n    }\n    // Handle callback (only if not disabled and not a submenu)\n    else if (item.callback && !item.disabled) {\n      // Wrap the callback to match the () => void signature\n      option.action = () => {\n        try {\n          void item.callback?.call(\n            item as unknown as ContextMenuDivElement,\n            item.value,\n            {},\n            undefined,\n            undefined,\n            item\n          )\n        } catch (error) {\n          console.error('Error executing context menu callback:', error)\n        }\n      }\n    }\n\n    result.push(option)\n  }\n\n  // Apply structured menu with core items and extensions section (if requested)\n  if (applyStructuring) {\n    return buildStructuredMenu(result)\n  }\n\n  return result\n}\n\n/**\n * Capture submenu items from a dynamic submenu callback\n * Intercepts ContextMenu constructor to extract items without creating HTML menu\n */\nfunction captureDynamicSubmenu(\n  item: IContextMenuValue,\n  node?: LGraphNode\n): SubMenuOption[] | undefined {\n  let capturedItems: readonly (IContextMenuValue | string | null)[] | undefined\n  let capturedOptions: IContextMenuOptions | undefined\n\n  // Store original ContextMenu constructor\n  const OriginalContextMenu = LiteGraph.ContextMenu\n\n  try {\n    // Mock ContextMenu constructor to capture submenu items and options\n    LiteGraph.ContextMenu = function (\n      items: readonly (IContextMenuValue | string | null)[],\n      options?: IContextMenuOptions\n    ) {\n      // Capture both items and options\n      capturedItems = items\n      capturedOptions = options\n      // Return a minimal mock object to prevent errors\n      return {\n        close: () => {},\n        root: document.createElement('div')\n      } as unknown as ContextMenu\n    } as unknown as typeof ContextMenu\n\n    // Execute the callback to trigger submenu creation\n    try {\n      // Create a mock MouseEvent for the callback\n      const mockEvent = new MouseEvent('click', {\n        bubbles: true,\n        cancelable: true,\n        clientX: 0,\n        clientY: 0\n      })\n\n      // Create a mock parent menu\n      const mockMenu = {\n        close: () => {},\n        root: document.createElement('div')\n      } as unknown as ContextMenu\n\n      // Call the callback which should trigger ContextMenu constructor\n      // Callback signature varies, but typically: (value, options, event, menu, node)\n      void item.callback?.call(\n        item as unknown as ContextMenuDivElement,\n        item.value,\n        {},\n        mockEvent,\n        mockMenu,\n        node // Pass the node context for callbacks that need it\n      )\n    } catch (error) {\n      console.warn(\n        '[ContextMenuConverter] Error executing callback for:',\n        item.content,\n        error\n      )\n    }\n  } finally {\n    // Always restore original constructor\n    LiteGraph.ContextMenu = OriginalContextMenu\n  }\n\n  // Convert captured items to Vue submenu format\n  if (capturedItems) {\n    const converted = convertSubmenuToOptions(capturedItems, capturedOptions)\n    return converted\n  }\n\n  console.warn('[ContextMenuConverter] No items captured for:', item.content)\n  return undefined\n}\n\n/**\n * Convert LiteGraph submenu items to Vue SubMenuOption format\n */\nfunction convertSubmenuToOptions(\n  items: readonly (IContextMenuValue | string | null)[],\n  options?: IContextMenuOptions\n): SubMenuOption[] {\n  const result: SubMenuOption[] = []\n\n  for (const item of items) {\n    // Skip null separators\n    if (item === null) {\n      continue\n    }\n\n    // Handle string items (simple labels like in Mode/Shapes menus)\n    if (typeof item === 'string') {\n      const subOption: SubMenuOption = {\n        label: item,\n        action: () => {\n          try {\n            // Call the options callback with the string value\n            if (options?.callback) {\n              void options.callback.call(\n                null,\n                item,\n                options,\n                undefined,\n                undefined,\n                options.extra\n              )\n            }\n          } catch (error) {\n            console.error('Error executing string item callback:', error)\n          }\n        }\n      }\n      result.push(subOption)\n      continue\n    }\n\n    // Handle object items\n    if (!item.content) {\n      continue\n    }\n\n    // Extract text content from HTML if present\n    const content = stripHtmlTags(item.content)\n\n    const subOption: SubMenuOption = {\n      label: content,\n      action: () => {\n        try {\n          void item.callback?.call(\n            item as unknown as ContextMenuDivElement,\n            item.value,\n            {},\n            undefined,\n            undefined,\n            item\n          )\n        } catch (error) {\n          console.error('Error executing submenu callback:', error)\n        }\n      }\n    }\n\n    // Pass through disabled state\n    if (item.disabled) {\n      subOption.disabled = true\n    }\n\n    result.push(subOption)\n  }\n  return result\n}\n\n/**\n * Strip HTML tags from content string safely\n * LiteGraph menu items often include HTML for styling\n */\nfunction stripHtmlTags(html: string): string {\n  // Use DOMPurify to sanitize and strip all HTML tags\n  const sanitized = DOMPurify.sanitize(html, { ALLOWED_TAGS: [] })\n  const result = sanitized.trim()\n  return result || html.replace(/<[^>]*>/g, '').trim() || html\n}\n","// call nextTick on all changeTracker\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\n\n/**\n * Composable for refreshing nodes in the graph\n * */\nexport function useCanvasRefresh() {\n  const canvasStore = useCanvasStore()\n  const workflowStore = useWorkflowStore()\n  const refreshCanvas = () => {\n    canvasStore.canvas?.emitBeforeChange()\n    canvasStore.canvas?.setDirty(true, true)\n    canvasStore.canvas?.graph?.afterChange()\n    canvasStore.canvas?.emitAfterChange()\n    workflowStore.activeWorkflow?.changeTracker?.checkState()\n  }\n\n  return {\n    refreshCanvas\n  }\n}\n","import { computed } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport {\n  LGraphCanvas,\n  LGraphNode,\n  LiteGraph,\n  RenderShape,\n  isColorable\n} from '@/lib/litegraph/src/litegraph'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useColorPaletteStore } from '@/stores/workspace/colorPaletteStore'\nimport { adjustColor } from '@/utils/colorUtil'\n\nimport { useCanvasRefresh } from './useCanvasRefresh'\n\ninterface ColorOption {\n  name: string\n  localizedName: string\n  value: {\n    dark: string\n    light: string\n  }\n}\n\ninterface ShapeOption {\n  name: string\n  localizedName: string\n  value: RenderShape\n}\n\n/**\n * Composable for handling node color and shape customization\n */\nexport function useNodeCustomization() {\n  const { t } = useI18n()\n  const canvasStore = useCanvasStore()\n  const colorPaletteStore = useColorPaletteStore()\n  const canvasRefresh = useCanvasRefresh()\n  const isLightTheme = computed(\n    () => colorPaletteStore.completedActivePalette.light_theme\n  )\n\n  const toLightThemeColor = (color: string) =>\n    adjustColor(color, { lightness: 0.5 })\n\n  // Color options\n  const NO_COLOR_OPTION: ColorOption = {\n    name: 'noColor',\n    localizedName: t('color.noColor'),\n    value: {\n      dark: LiteGraph.NODE_DEFAULT_BGCOLOR,\n      light: toLightThemeColor(LiteGraph.NODE_DEFAULT_BGCOLOR)\n    }\n  }\n\n  const colorOptions: ColorOption[] = [\n    NO_COLOR_OPTION,\n    ...Object.entries(LGraphCanvas.node_colors).map(([name, color]) => ({\n      name,\n      localizedName: t(`color.${name}`),\n      value: {\n        dark: color.bgcolor,\n        light: toLightThemeColor(color.bgcolor)\n      }\n    }))\n  ]\n\n  // Shape options\n  const shapeOptions: ShapeOption[] = [\n    {\n      name: 'default',\n      localizedName: t('shape.default'),\n      value: RenderShape.ROUND\n    },\n    {\n      name: 'box',\n      localizedName: t('shape.box'),\n      value: RenderShape.BOX\n    },\n    {\n      name: 'card',\n      localizedName: t('shape.CARD'),\n      value: RenderShape.CARD\n    }\n  ]\n\n  const applyColor = (colorOption: ColorOption | null) => {\n    const colorName = colorOption?.name ?? NO_COLOR_OPTION.name\n    const canvasColorOption =\n      colorName === NO_COLOR_OPTION.name\n        ? null\n        : LGraphCanvas.node_colors[colorName]\n\n    for (const item of canvasStore.selectedItems) {\n      if (isColorable(item)) {\n        item.setColorOption(canvasColorOption)\n      }\n    }\n\n    canvasRefresh.refreshCanvas()\n  }\n\n  const applyShape = (shapeOption: ShapeOption) => {\n    const selectedNodes = Array.from(canvasStore.selectedItems).filter(\n      (item): item is LGraphNode => item instanceof LGraphNode\n    )\n\n    if (selectedNodes.length === 0) {\n      return\n    }\n\n    selectedNodes.forEach((node) => {\n      node.shape = shapeOption.value\n    })\n\n    canvasRefresh.refreshCanvas()\n  }\n\n  const getCurrentColor = (): ColorOption | null => {\n    const selectedItems = Array.from(canvasStore.selectedItems)\n    if (selectedItems.length === 0) return null\n\n    // Get color from first colorable item\n    const firstColorableItem = selectedItems.find((item) => isColorable(item))\n    if (!firstColorableItem || !isColorable(firstColorableItem)) return null\n\n    // Get the current color option from the colorable item\n    const currentColorOption = firstColorableItem.getColorOption()\n    const currentBgColor = currentColorOption?.bgcolor ?? null\n\n    // Find matching color option\n    return (\n      colorOptions.find(\n        (option) =>\n          option.value.dark === currentBgColor ||\n          option.value.light === currentBgColor\n      ) ?? NO_COLOR_OPTION\n    )\n  }\n\n  const getCurrentShape = (): ShapeOption | null => {\n    const selectedNodes = Array.from(canvasStore.selectedItems).filter(\n      (item): item is LGraphNode => item instanceof LGraphNode\n    )\n\n    if (selectedNodes.length === 0) return null\n\n    const firstNode = selectedNodes[0]\n    const currentShape = firstNode.shape ?? RenderShape.ROUND\n\n    return (\n      shapeOptions.find((option) => option.value === currentShape) ??\n      shapeOptions[0]\n    )\n  }\n\n  return {\n    colorOptions,\n    shapeOptions,\n    applyColor,\n    applyShape,\n    getCurrentColor,\n    getCurrentShape,\n    isLightTheme\n  }\n}\n","import { useI18n } from 'vue-i18n'\n\nimport { LGraphEventMode } from '@/lib/litegraph/src/litegraph'\nimport type { LGraphGroup, LGraphNode } from '@/lib/litegraph/src/litegraph'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\n\nimport { useCanvasRefresh } from './useCanvasRefresh'\nimport type { MenuOption } from './useMoreOptionsMenu'\nimport { useNodeCustomization } from './useNodeCustomization'\n\n/**\n * Composable for group-related menu operations\n */\nexport function useGroupMenuOptions() {\n  const { t } = useI18n()\n  const canvasStore = useCanvasStore()\n  const workflowStore = useWorkflowStore()\n  const settingStore = useSettingStore()\n  const canvasRefresh = useCanvasRefresh()\n  const { shapeOptions, colorOptions, isLightTheme } = useNodeCustomization()\n\n  const getFitGroupToNodesOption = (groupContext: LGraphGroup): MenuOption => ({\n    label: 'Fit Group To Nodes',\n    icon: 'icon-[lucide--move-diagonal-2]',\n    action: () => {\n      try {\n        groupContext.recomputeInsideNodes()\n      } catch (e) {\n        console.warn('Failed to recompute group nodes:', e)\n        return\n      }\n\n      const padding = settingStore.get('Comfy.GroupSelectedNodes.Padding')\n      groupContext.resizeTo(groupContext.children, padding)\n      groupContext.graph?.change()\n      canvasStore.canvas?.setDirty(true, true)\n      workflowStore.activeWorkflow?.changeTracker?.checkState()\n    }\n  })\n\n  const getGroupShapeOptions = (\n    groupContext: LGraphGroup,\n    bump: () => void\n  ): MenuOption => ({\n    label: t('contextMenu.Shape'),\n    icon: 'icon-[lucide--box]',\n    hasSubmenu: true,\n    submenu: shapeOptions.map((shape) => ({\n      label: shape.localizedName,\n      action: () => {\n        const nodes = (groupContext.nodes || []) as LGraphNode[]\n        nodes.forEach((node) => (node.shape = shape.value))\n        canvasRefresh.refreshCanvas()\n        bump()\n      }\n    }))\n  })\n\n  const getGroupColorOptions = (\n    groupContext: LGraphGroup,\n    bump: () => void\n  ): MenuOption => ({\n    label: t('contextMenu.Color'),\n    icon: 'icon-[lucide--palette]',\n    hasSubmenu: true,\n    submenu: colorOptions.map((colorOption) => ({\n      label: colorOption.localizedName,\n      color: isLightTheme.value\n        ? colorOption.value.light\n        : colorOption.value.dark,\n      action: () => {\n        groupContext.color = isLightTheme.value\n          ? colorOption.value.light\n          : colorOption.value.dark\n        canvasRefresh.refreshCanvas()\n        bump()\n      }\n    }))\n  })\n\n  const getGroupModeOptions = (\n    groupContext: LGraphGroup,\n    bump: () => void\n  ): MenuOption[] => {\n    const options: MenuOption[] = []\n\n    try {\n      groupContext.recomputeInsideNodes()\n    } catch (e) {\n      console.warn('Failed to recompute group nodes for mode options:', e)\n      return options\n    }\n\n    const groupNodes = (groupContext.nodes || []) as LGraphNode[]\n    if (!groupNodes.length) return options\n\n    // Check if all nodes have the same mode\n    let allSame = true\n    for (let i = 1; i < groupNodes.length; i++) {\n      if (groupNodes[i].mode !== groupNodes[0].mode) {\n        allSame = false\n        break\n      }\n    }\n\n    const createModeAction = (label: string, mode: LGraphEventMode) => ({\n      label: t(`selectionToolbox.${label}`),\n      icon:\n        mode === LGraphEventMode.BYPASS\n          ? 'icon-[lucide--ban]'\n          : mode === LGraphEventMode.NEVER\n            ? 'icon-[lucide--zap-off]'\n            : 'icon-[lucide--play]',\n      action: () => {\n        groupNodes.forEach((n) => {\n          n.mode = mode\n        })\n        canvasStore.canvas?.setDirty(true, true)\n        groupContext.graph?.change()\n        workflowStore.activeWorkflow?.changeTracker?.checkState()\n        bump()\n      }\n    })\n\n    if (allSame) {\n      const current = groupNodes[0].mode\n      switch (current) {\n        case LGraphEventMode.ALWAYS:\n          options.push(\n            createModeAction('Set Group Nodes to Never', LGraphEventMode.NEVER)\n          )\n          options.push(\n            createModeAction('Bypass Group Nodes', LGraphEventMode.BYPASS)\n          )\n          break\n        case LGraphEventMode.NEVER:\n          options.push(\n            createModeAction(\n              'Set Group Nodes to Always',\n              LGraphEventMode.ALWAYS\n            )\n          )\n          options.push(\n            createModeAction('Bypass Group Nodes', LGraphEventMode.BYPASS)\n          )\n          break\n        case LGraphEventMode.BYPASS:\n          options.push(\n            createModeAction(\n              'Set Group Nodes to Always',\n              LGraphEventMode.ALWAYS\n            )\n          )\n          options.push(\n            createModeAction('Set Group Nodes to Never', LGraphEventMode.NEVER)\n          )\n          break\n        default:\n          options.push(\n            createModeAction(\n              'Set Group Nodes to Always',\n              LGraphEventMode.ALWAYS\n            )\n          )\n          options.push(\n            createModeAction('Set Group Nodes to Never', LGraphEventMode.NEVER)\n          )\n          options.push(\n            createModeAction('Bypass Group Nodes', LGraphEventMode.BYPASS)\n          )\n          break\n      }\n    } else {\n      options.push(\n        createModeAction('Set Group Nodes to Always', LGraphEventMode.ALWAYS)\n      )\n      options.push(\n        createModeAction('Set Group Nodes to Never', LGraphEventMode.NEVER)\n      )\n      options.push(\n        createModeAction('Bypass Group Nodes', LGraphEventMode.BYPASS)\n      )\n    }\n\n    return options\n  }\n\n  return {\n    getFitGroupToNodesOption,\n    getGroupShapeOptions,\n    getGroupColorOptions,\n    getGroupModeOptions\n  }\n}\n","import { useI18n } from 'vue-i18n'\n\nimport { downloadFile } from '@/base/common/downloadUtil'\nimport { useCommandStore } from '@/stores/commandStore'\n\nimport type { MenuOption } from './useMoreOptionsMenu'\n\n/**\n * Composable for image-related menu operations\n */\nexport function useImageMenuOptions() {\n  const { t } = useI18n()\n\n  const openMaskEditor = () => {\n    const commandStore = useCommandStore()\n    void commandStore.execute('Comfy.MaskEditor.OpenMaskEditor')\n  }\n\n  const openImage = (node: any) => {\n    if (!node?.imgs?.length) return\n    const img = node.imgs[node.imageIndex ?? 0]\n    if (!img) return\n    const url = new URL(img.src)\n    url.searchParams.delete('preview')\n    window.open(url.toString(), '_blank')\n  }\n\n  const copyImage = async (node: any) => {\n    if (!node?.imgs?.length) return\n    const img = node.imgs[node.imageIndex ?? 0]\n    if (!img) return\n\n    const canvas = document.createElement('canvas')\n    const ctx = canvas.getContext('2d')\n    if (!ctx) return\n\n    canvas.width = img.naturalWidth\n    canvas.height = img.naturalHeight\n    ctx.drawImage(img, 0, 0)\n\n    try {\n      const blob = await new Promise<Blob | null>((resolve) => {\n        canvas.toBlob(resolve, 'image/png')\n      })\n\n      if (!blob) {\n        console.warn('Failed to create image blob')\n        return\n      }\n\n      // Check if clipboard API is available\n      if (!navigator.clipboard?.write) {\n        console.warn('Clipboard API not available')\n        return\n      }\n\n      await navigator.clipboard.write([\n        new ClipboardItem({ 'image/png': blob })\n      ])\n    } catch (error) {\n      console.error('Failed to copy image to clipboard:', error)\n    }\n  }\n\n  const saveImage = (node: any) => {\n    if (!node?.imgs?.length) return\n    const img = node.imgs[node.imageIndex ?? 0]\n    if (!img) return\n\n    try {\n      const url = new URL(img.src)\n      url.searchParams.delete('preview')\n      downloadFile(url.toString())\n    } catch (error) {\n      console.error('Failed to save image:', error)\n    }\n  }\n\n  const getImageMenuOptions = (node: any): MenuOption[] => {\n    if (!node?.imgs?.length) return []\n\n    return [\n      {\n        label: t('contextMenu.Open in Mask Editor'),\n        action: () => openMaskEditor()\n      },\n      {\n        label: t('contextMenu.Open Image'),\n        icon: 'icon-[lucide--external-link]',\n        action: () => openImage(node)\n      },\n      {\n        label: t('contextMenu.Copy Image'),\n        icon: 'icon-[lucide--copy]',\n        action: () => copyImage(node)\n      },\n      {\n        label: t('contextMenu.Save Image'),\n        icon: 'icon-[lucide--download]',\n        action: () => saveImage(node)\n      }\n    ]\n  }\n\n  return {\n    getImageMenuOptions\n  }\n}\n","import { useSelectedLiteGraphItems } from '@/composables/canvas/useSelectedLiteGraphItems'\nimport { LGraphEventMode } from '@/lib/litegraph/src/litegraph'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { app } from '@/scripts/app'\nimport { useCommandStore } from '@/stores/commandStore'\nimport { filterOutputNodes } from '@/utils/nodeFilterUtil'\n\n/**\n * Composable for handling node information and utility operations\n */\nexport function useSelectedNodeActions() {\n  const { getSelectedNodes, toggleSelectedNodesMode } =\n    useSelectedLiteGraphItems()\n  const commandStore = useCommandStore()\n  const workflowStore = useWorkflowStore()\n\n  const adjustNodeSize = () => {\n    const selectedNodes = getSelectedNodes()\n\n    selectedNodes.forEach((node) => {\n      const optimalSize = node.computeSize()\n      node.setSize([optimalSize[0], optimalSize[1]])\n    })\n\n    app.canvas.setDirty(true, true)\n    workflowStore.activeWorkflow?.changeTracker?.checkState()\n  }\n\n  const toggleNodeCollapse = () => {\n    const selectedNodes = getSelectedNodes()\n    selectedNodes.forEach((node) => {\n      node.collapse()\n    })\n\n    app.canvas.setDirty(true, true)\n    workflowStore.activeWorkflow?.changeTracker?.checkState()\n  }\n\n  const toggleNodePin = () => {\n    const selectedNodes = getSelectedNodes()\n    selectedNodes.forEach((node) => {\n      node.pin(!node.pinned)\n    })\n\n    app.canvas.setDirty(true, true)\n    workflowStore.activeWorkflow?.changeTracker?.checkState()\n  }\n\n  const toggleNodeBypass = () => {\n    toggleSelectedNodesMode(LGraphEventMode.BYPASS)\n    app.canvas.setDirty(true, true)\n  }\n\n  const runBranch = async () => {\n    const selectedNodes = getSelectedNodes()\n    const selectedOutputNodes = filterOutputNodes(selectedNodes)\n    if (selectedOutputNodes.length === 0) return\n    await commandStore.execute('Comfy.QueueSelectedOutputNodes')\n  }\n\n  return {\n    adjustNodeSize,\n    toggleNodeCollapse,\n    toggleNodePin,\n    toggleNodeBypass,\n    runBranch\n  }\n}\n","import { computed } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport type { MenuOption } from './useMoreOptionsMenu'\nimport { useNodeCustomization } from './useNodeCustomization'\nimport { useSelectedNodeActions } from './useSelectedNodeActions'\nimport type { NodeSelectionState } from './useSelectionState'\n\n/**\n * Composable for node-related menu operations\n */\nexport function useNodeMenuOptions() {\n  const { t } = useI18n()\n  const { shapeOptions, applyShape, applyColor, colorOptions, isLightTheme } =\n    useNodeCustomization()\n  const {\n    adjustNodeSize,\n    toggleNodeCollapse,\n    toggleNodePin,\n    toggleNodeBypass,\n    runBranch\n  } = useSelectedNodeActions()\n\n  const shapeSubmenu = computed(() =>\n    shapeOptions.map((shape) => ({\n      label: shape.localizedName,\n      action: () => applyShape(shape)\n    }))\n  )\n\n  const colorSubmenu = computed(() => {\n    return colorOptions.map((colorOption) => ({\n      label: colorOption.localizedName,\n      color: isLightTheme.value\n        ? colorOption.value.light\n        : colorOption.value.dark,\n      action: () =>\n        applyColor(colorOption.name === 'noColor' ? null : colorOption)\n    }))\n  })\n\n  const getAdjustSizeOption = (): MenuOption => ({\n    label: t('contextMenu.Adjust Size'),\n    icon: 'icon-[lucide--move-diagonal-2]',\n    action: adjustNodeSize\n  })\n\n  const getNodeVisualOptions = (\n    states: NodeSelectionState,\n    bump: () => void\n  ): MenuOption[] => [\n    {\n      label: states.collapsed\n        ? t('contextMenu.Expand Node')\n        : t('contextMenu.Minimize Node'),\n      icon: states.collapsed\n        ? 'icon-[lucide--maximize-2]'\n        : 'icon-[lucide--minimize-2]',\n      action: () => {\n        toggleNodeCollapse()\n        bump()\n      }\n    },\n    {\n      label: t('contextMenu.Shape'),\n      icon: 'icon-[lucide--box]',\n      hasSubmenu: true,\n      submenu: shapeSubmenu.value,\n      action: () => {}\n    },\n    {\n      label: t('contextMenu.Color'),\n      icon: 'icon-[lucide--palette]',\n      hasSubmenu: true,\n      submenu: colorSubmenu.value,\n      isColorPicker: true,\n      action: () => {}\n    }\n  ]\n\n  const getPinOption = (\n    states: NodeSelectionState,\n    bump: () => void\n  ): MenuOption => ({\n    label: states.pinned ? t('contextMenu.Unpin') : t('contextMenu.Pin'),\n    icon: states.pinned ? 'icon-[lucide--pin-off]' : 'icon-[lucide--pin]',\n    action: () => {\n      toggleNodePin()\n      bump()\n    }\n  })\n\n  const getBypassOption = (\n    states: NodeSelectionState,\n    bump: () => void\n  ): MenuOption => ({\n    label: states.bypassed\n      ? t('contextMenu.Remove Bypass')\n      : t('contextMenu.Bypass'),\n    icon: 'icon-[lucide--redo-dot]',\n    shortcut: 'Ctrl+B',\n    action: () => {\n      toggleNodeBypass()\n      bump()\n    }\n  })\n\n  const getRunBranchOption = (): MenuOption => ({\n    label: t('contextMenu.Run Branch'),\n    icon: 'icon-[lucide--play]',\n    action: runBranch\n  })\n\n  const getNodeInfoOption = (showNodeHelp: () => void): MenuOption => ({\n    label: t('contextMenu.Node Info'),\n    icon: 'icon-[lucide--info]',\n    action: showNodeHelp\n  })\n\n  return {\n    getNodeInfoOption,\n    getAdjustSizeOption,\n    getNodeVisualOptions,\n    getPinOption,\n    getBypassOption,\n    getRunBranchOption,\n    colorSubmenu\n  }\n}\n","import { computed } from 'vue'\n\nimport { useSelectionState } from '@/composables/graph/useSelectionState'\nimport { LGraphGroup } from '@/lib/litegraph/src/litegraph'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useTitleEditorStore } from '@/renderer/core/canvas/canvasStore'\nimport { app } from '@/scripts/app'\n\n/**\n * Composable encapsulating logic for framing currently selected nodes into a group.\n */\nexport function useFrameNodes() {\n  const settingStore = useSettingStore()\n  const titleEditorStore = useTitleEditorStore()\n  const { hasMultipleSelection } = useSelectionState()\n\n  const canFrame = computed(() => hasMultipleSelection.value)\n\n  const frameNodes = () => {\n    const { canvas } = app\n    if (!canvas.selectedItems?.size) return\n    const group = new LGraphGroup()\n    const padding = settingStore.get('Comfy.GroupSelectedNodes.Padding')\n    group.resizeTo(canvas.selectedItems, padding)\n    canvas.graph?.add(group)\n    titleEditorStore.titleEditorTarget = group\n  }\n\n  return { frameNodes, canFrame }\n}\n","import { useI18n } from 'vue-i18n'\n\nimport type { Direction } from '@/lib/litegraph/src/interfaces'\nimport { alignNodes, distributeNodes } from '@/lib/litegraph/src/utils/arrange'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { isLGraphNode } from '@/utils/litegraphUtil'\n\nimport { useCanvasRefresh } from './useCanvasRefresh'\n\ninterface AlignOption {\n  name: string\n  localizedName: string\n  value: Direction\n  icon: string\n}\n\ninterface DistributeOption {\n  name: string\n  localizedName: string\n  value: boolean // true for horizontal, false for vertical\n  icon: string\n}\n\n/**\n * Composable for handling node alignment and distribution\n */\nexport function useNodeArrangement() {\n  const { t } = useI18n()\n  const canvasStore = useCanvasStore()\n  const canvasRefresh = useCanvasRefresh()\n  const alignOptions: AlignOption[] = [\n    {\n      name: 'top',\n      localizedName: t('contextMenu.Top'),\n      value: 'top',\n      icon: 'icon-[lucide--align-start-vertical]'\n    },\n    {\n      name: 'bottom',\n      localizedName: t('contextMenu.Bottom'),\n      value: 'bottom',\n      icon: 'icon-[lucide--align-end-vertical]'\n    },\n    {\n      name: 'left',\n      localizedName: t('contextMenu.Left'),\n      value: 'left',\n      icon: 'icon-[lucide--align-start-horizontal]'\n    },\n    {\n      name: 'right',\n      localizedName: t('contextMenu.Right'),\n      value: 'right',\n      icon: 'icon-[lucide--align-end-horizontal]'\n    }\n  ]\n\n  const distributeOptions: DistributeOption[] = [\n    {\n      name: 'horizontal',\n      localizedName: t('contextMenu.Horizontal'),\n      value: true,\n      icon: 'icon-[lucide--align-center-horizontal]'\n    },\n    {\n      name: 'vertical',\n      localizedName: t('contextMenu.Vertical'),\n      value: false,\n      icon: 'icon-[lucide--align-center-vertical]'\n    }\n  ]\n\n  const applyAlign = (alignOption: AlignOption) => {\n    const selectedNodes = Array.from(canvasStore.selectedItems).filter((item) =>\n      isLGraphNode(item)\n    )\n\n    if (selectedNodes.length === 0) {\n      return\n    }\n\n    const newPositions = alignNodes(selectedNodes, alignOption.value)\n    canvasStore.canvas?.repositionNodesVueMode(newPositions)\n\n    canvasRefresh.refreshCanvas()\n  }\n\n  const applyDistribute = (distributeOption: DistributeOption) => {\n    const selectedNodes = Array.from(canvasStore.selectedItems).filter((item) =>\n      isLGraphNode(item)\n    )\n\n    if (selectedNodes.length < 2) {\n      return\n    }\n\n    const newPositions = distributeNodes(selectedNodes, distributeOption.value)\n    canvasStore.canvas?.repositionNodesVueMode(newPositions)\n    canvasRefresh.refreshCanvas()\n  }\n\n  return {\n    alignOptions,\n    distributeOptions,\n    applyAlign,\n    applyDistribute\n  }\n}\n","// import { useSelectedLiteGraphItems } from '@/composables/canvas/useSelectedLiteGraphItems' // Unused for now\nimport { t } from '@/i18n'\nimport { LGraphNode } from '@/lib/litegraph/src/litegraph'\nimport { useToastStore } from '@/platform/updates/common/toastStore'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport {\n  useCanvasStore,\n  useTitleEditorStore\n} from '@/renderer/core/canvas/canvasStore'\nimport { app } from '@/scripts/app'\nimport { useDialogService } from '@/services/dialogService'\n\n/**\n * Composable for handling basic selection operations like copy, paste, duplicate, delete, rename\n */\nexport function useSelectionOperations() {\n  // const { getSelectedNodes } = useSelectedLiteGraphItems() // Unused for now\n  const canvasStore = useCanvasStore()\n  const toastStore = useToastStore()\n  const dialogService = useDialogService()\n  const titleEditorStore = useTitleEditorStore()\n  const workflowStore = useWorkflowStore()\n\n  const copySelection = () => {\n    const canvas = app.canvas\n    if (!canvas.selectedItems || canvas.selectedItems.size === 0) {\n      toastStore.add({\n        severity: 'warn',\n        summary: t('g.nothingToCopy'),\n        detail: t('g.selectItemsToCopy'),\n        life: 3000\n      })\n      return\n    }\n\n    canvas.copyToClipboard()\n    toastStore.add({\n      severity: 'success',\n      summary: t('g.copied'),\n      detail: t('g.itemsCopiedToClipboard'),\n      life: 2000\n    })\n  }\n\n  const pasteSelection = () => {\n    const canvas = app.canvas\n    canvas.pasteFromClipboard({ connectInputs: false })\n\n    // Trigger change tracking\n    workflowStore.activeWorkflow?.changeTracker?.checkState()\n  }\n\n  const duplicateSelection = () => {\n    const canvas = app.canvas\n    if (!canvas.selectedItems || canvas.selectedItems.size === 0) {\n      toastStore.add({\n        severity: 'warn',\n        summary: t('g.nothingToDuplicate'),\n        detail: t('g.selectItemsToDuplicate'),\n        life: 3000\n      })\n      return\n    }\n\n    // Copy current selection\n    canvas.copyToClipboard()\n\n    // Clear selection to avoid confusion\n    canvas.selectedItems.clear()\n    canvasStore.updateSelectedItems()\n\n    // Paste to create duplicates\n    canvas.pasteFromClipboard({ connectInputs: false })\n\n    // Trigger change tracking\n    workflowStore.activeWorkflow?.changeTracker?.checkState()\n  }\n\n  const deleteSelection = () => {\n    const canvas = app.canvas\n    if (!canvas.selectedItems || canvas.selectedItems.size === 0) {\n      toastStore.add({\n        severity: 'warn',\n        summary: t('g.nothingToDelete'),\n        detail: t('g.selectItemsToDelete'),\n        life: 3000\n      })\n      return\n    }\n\n    canvas.deleteSelected()\n    canvas.setDirty(true, true)\n\n    // Trigger change tracking\n    workflowStore.activeWorkflow?.changeTracker?.checkState()\n  }\n\n  const renameSelection = async () => {\n    const selectedItems = Array.from(canvasStore.selectedItems)\n\n    // Handle single node selection\n    if (selectedItems.length === 1) {\n      const item = selectedItems[0]\n\n      // For nodes, use the title editor\n      if (item instanceof LGraphNode) {\n        titleEditorStore.titleEditorTarget = item\n        return\n      }\n\n      // For other items like groups, use prompt dialog\n      const currentTitle = 'title' in item ? (item.title as string) : ''\n      const newTitle = await dialogService.prompt({\n        title: t('g.rename'),\n        message: t('g.enterNewName'),\n        defaultValue: currentTitle\n      })\n\n      if (newTitle && newTitle !== currentTitle) {\n        if ('title' in item) {\n          // Type-safe assignment for items with title property\n          const titledItem = item as { title: string }\n          titledItem.title = newTitle\n          app.canvas.setDirty(true, true)\n          workflowStore.activeWorkflow?.changeTracker?.checkState()\n        }\n      }\n      return\n    }\n\n    // Handle multiple selections - batch rename\n    if (selectedItems.length > 1) {\n      const baseTitle = await dialogService.prompt({\n        title: t('g.batchRename'),\n        message: t('g.enterBaseName'),\n        defaultValue: 'Item'\n      })\n\n      if (baseTitle) {\n        selectedItems.forEach((item, index) => {\n          if ('title' in item) {\n            // Type-safe assignment for items with title property\n            const titledItem = item as { title: string }\n            titledItem.title = `${baseTitle} ${index + 1}`\n          }\n        })\n        app.canvas.setDirty(true, true)\n        workflowStore.activeWorkflow?.changeTracker?.checkState()\n      }\n      return\n    }\n\n    toastStore.add({\n      severity: 'warn',\n      summary: t('g.nothingToRename'),\n      detail: t('g.selectItemsToRename'),\n      life: 3000\n    })\n  }\n\n  return {\n    copySelection,\n    pasteSelection,\n    duplicateSelection,\n    deleteSelection,\n    renameSelection\n  }\n}\n","import { computed } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport { useCommandStore } from '@/stores/commandStore'\n\nimport { useFrameNodes } from './useFrameNodes'\nimport { BadgeVariant } from './useMoreOptionsMenu'\nimport type { MenuOption } from './useMoreOptionsMenu'\nimport { useNodeArrangement } from './useNodeArrangement'\nimport { useSelectionOperations } from './useSelectionOperations'\nimport { useSubgraphOperations } from './useSubgraphOperations'\n\n/**\n * Composable for selection-related menu operations\n */\nexport function useSelectionMenuOptions() {\n  const { t } = useI18n()\n  const {\n    copySelection,\n    duplicateSelection,\n    deleteSelection,\n    renameSelection\n  } = useSelectionOperations()\n\n  const { alignOptions, distributeOptions, applyAlign, applyDistribute } =\n    useNodeArrangement()\n\n  const { convertToSubgraph, unpackSubgraph, addSubgraphToLibrary } =\n    useSubgraphOperations()\n\n  const { frameNodes } = useFrameNodes()\n\n  const alignSubmenu = computed(() =>\n    alignOptions.map((align) => ({\n      label: align.localizedName,\n      icon: align.icon,\n      action: () => applyAlign(align)\n    }))\n  )\n\n  const distributeSubmenu = computed(() =>\n    distributeOptions.map((distribute) => ({\n      label: distribute.localizedName,\n      icon: distribute.icon,\n      action: () => applyDistribute(distribute)\n    }))\n  )\n\n  const getBasicSelectionOptions = (): MenuOption[] => [\n    {\n      label: t('contextMenu.Rename'),\n      action: renameSelection\n    },\n    {\n      label: t('contextMenu.Copy'),\n      shortcut: 'Ctrl+C',\n      action: copySelection\n    },\n    {\n      label: t('contextMenu.Duplicate'),\n      shortcut: 'Ctrl+D',\n      action: duplicateSelection\n    }\n  ]\n\n  const getSubgraphOptions = ({\n    hasSubgraphs,\n    hasMultipleSelection\n  }: {\n    hasSubgraphs: boolean\n    hasMultipleSelection: boolean\n  }): MenuOption[] => {\n    const convertOption: MenuOption = {\n      label: t('contextMenu.Convert to Subgraph'),\n      icon: 'icon-[lucide--shrink]',\n      action: convertToSubgraph,\n      badge: BadgeVariant.NEW\n    }\n\n    const options: MenuOption[] = []\n    const showConvertOption = !hasSubgraphs || hasMultipleSelection\n\n    if (showConvertOption) {\n      options.push(convertOption)\n    }\n\n    if (hasSubgraphs) {\n      options.push(\n        {\n          label: t('contextMenu.Add Subgraph to Library'),\n          icon: 'icon-[lucide--folder-plus]',\n          action: addSubgraphToLibrary\n        },\n        {\n          label: t('contextMenu.Unpack Subgraph'),\n          icon: 'icon-[lucide--expand]',\n          action: unpackSubgraph\n        }\n      )\n    }\n\n    return options\n  }\n\n  const getMultipleNodesOptions = (): MenuOption[] => {\n    const convertToGroupNodes = () => {\n      const commandStore = useCommandStore()\n      void commandStore.execute(\n        'Comfy.GroupNode.ConvertSelectedNodesToGroupNode'\n      )\n    }\n\n    return [\n      {\n        label: t('contextMenu.Convert to Group Node'),\n        icon: 'icon-[lucide--group]',\n        action: convertToGroupNodes,\n        badge: BadgeVariant.DEPRECATED\n      },\n      {\n        label: t('g.frameNodes'),\n        icon: 'icon-[lucide--frame]',\n        action: frameNodes\n      }\n    ]\n  }\n\n  const getAlignmentOptions = (): MenuOption[] => [\n    {\n      label: t('contextMenu.Align Selected To'),\n      icon: 'icon-[lucide--align-start-horizontal]',\n      hasSubmenu: true,\n      submenu: alignSubmenu.value,\n      action: () => {}\n    },\n    {\n      label: t('contextMenu.Distribute Nodes'),\n      icon: 'icon-[lucide--align-center-horizontal]',\n      hasSubmenu: true,\n      submenu: distributeSubmenu.value,\n      action: () => {}\n    }\n  ]\n\n  const getDeleteOption = (): MenuOption => ({\n    label: t('contextMenu.Delete'),\n    icon: 'icon-[lucide--trash-2]',\n    shortcut: 'Delete',\n    action: deleteSelection\n  })\n\n  return {\n    getBasicSelectionOptions,\n    getSubgraphOptions,\n    getMultipleNodesOptions,\n    getDeleteOption,\n    getAlignmentOptions,\n    alignSubmenu,\n    distributeSubmenu\n  }\n}\n","import { computed, ref } from 'vue'\nimport type { Ref } from 'vue'\n\nimport type { LGraphGroup } from '@/lib/litegraph/src/litegraph'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { isLGraphGroup } from '@/utils/litegraphUtil'\n\nimport {\n  buildStructuredMenu,\n  convertContextMenuToOptions\n} from './contextMenuConverter'\nimport { useGroupMenuOptions } from './useGroupMenuOptions'\nimport { useImageMenuOptions } from './useImageMenuOptions'\nimport { useNodeMenuOptions } from './useNodeMenuOptions'\nimport { useSelectionMenuOptions } from './useSelectionMenuOptions'\nimport { useSelectionState } from './useSelectionState'\n\nexport interface MenuOption {\n  label?: string\n  icon?: string\n  shortcut?: string\n  hasSubmenu?: boolean\n  type?: 'divider' | 'category'\n  action?: () => void\n  submenu?: SubMenuOption[]\n  badge?: BadgeVariant\n  disabled?: boolean\n  source?: 'litegraph' | 'vue'\n  isColorPicker?: boolean\n}\n\nexport interface SubMenuOption {\n  label: string\n  icon?: string\n  action: () => void\n  color?: string\n  disabled?: boolean\n}\n\nexport enum BadgeVariant {\n  NEW = 'new',\n  DEPRECATED = 'deprecated'\n}\n\n// Global singleton for NodeOptions component reference\nlet nodeOptionsInstance: null | NodeOptionsInstance = null\n\n/**\n * Toggle the node options popover\n * @param event - The trigger event\n */\nexport function toggleNodeOptions(event: Event) {\n  if (nodeOptionsInstance?.toggle) {\n    nodeOptionsInstance.toggle(event)\n  }\n}\n\n/**\n * Show the node options popover (always shows, doesn't toggle)\n * Use this for contextmenu events where we always want to show at the new position\n * @param event - The trigger event (must be MouseEvent for position)\n */\nexport function showNodeOptions(event: MouseEvent) {\n  if (nodeOptionsInstance?.show) {\n    nodeOptionsInstance.show(event)\n  }\n}\n\n/**\n * Hide the node options popover\n */\ninterface NodeOptionsInstance {\n  toggle: (event: Event) => void\n  show: (event: MouseEvent) => void\n  hide: () => void\n  isOpen: Ref<boolean>\n}\n\n/**\n * Register the NodeOptions component instance\n * @param instance - The NodeOptions component instance\n */\nexport function registerNodeOptionsInstance(\n  instance: null | NodeOptionsInstance\n) {\n  nodeOptionsInstance = instance\n}\n\n/**\n * Mark menu options as coming from Vue hardcoded menu\n */\nfunction markAsVueOptions(options: MenuOption[]): MenuOption[] {\n  return options.map((opt) => {\n    // Don't mark dividers or category labels\n    if (opt.type === 'divider' || opt.type === 'category') {\n      return opt\n    }\n    return { ...opt, source: 'vue' }\n  })\n}\n\n/**\n * Composable for managing the More Options menu configuration\n * Refactored to use smaller, focused composables for better maintainability\n */\nexport function useMoreOptionsMenu() {\n  const {\n    selectedItems,\n    selectedNodes,\n    nodeDef,\n    showNodeHelp,\n    hasSubgraphs: hasSubgraphsComputed,\n    hasImageNode,\n    hasOutputNodesSelected,\n    hasMultipleSelection,\n    computeSelectionFlags\n  } = useSelectionState()\n\n  const canvasStore = useCanvasStore()\n\n  const { getImageMenuOptions } = useImageMenuOptions()\n  const {\n    getNodeInfoOption,\n    getNodeVisualOptions,\n    getPinOption,\n    getBypassOption,\n    getRunBranchOption\n  } = useNodeMenuOptions()\n  const {\n    getFitGroupToNodesOption,\n    getGroupColorOptions,\n    getGroupModeOptions\n  } = useGroupMenuOptions()\n  const {\n    getBasicSelectionOptions,\n    getSubgraphOptions,\n    getMultipleNodesOptions\n  } = useSelectionMenuOptions()\n\n  const hasSubgraphs = hasSubgraphsComputed\n  const hasMultipleNodes = hasMultipleSelection\n\n  // Internal version to force menu rebuild after state mutations\n  const optionsVersion = ref(0)\n  const bump = () => {\n    optionsVersion.value++\n  }\n\n  const menuOptions = computed((): MenuOption[] => {\n    // Reference selection flags to ensure re-computation when they change\n\n    optionsVersion.value\n    const states = computeSelectionFlags()\n\n    // Detect single group selection context (and no nodes explicitly selected)\n    const selectedGroups = selectedItems.value.filter(\n      isLGraphGroup\n    ) as LGraphGroup[]\n    const groupContext: LGraphGroup | null =\n      selectedGroups.length === 1 && selectedNodes.value.length === 0\n        ? selectedGroups[0]\n        : null\n    const hasSubgraphsSelected = hasSubgraphs.value\n\n    // For single node selection, also get LiteGraph menu items to merge\n    const litegraphOptions: MenuOption[] = []\n    if (\n      selectedNodes.value.length === 1 &&\n      !groupContext &&\n      canvasStore.canvas\n    ) {\n      try {\n        const node = selectedNodes.value[0]\n        const rawItems = canvasStore.canvas.getNodeMenuOptions(node)\n        // Don't apply structuring yet - we'll do it after merging with Vue options\n        litegraphOptions.push(\n          ...convertContextMenuToOptions(rawItems, node, false)\n        )\n      } catch (error) {\n        console.error('Error getting LiteGraph menu items:', error)\n      }\n    }\n\n    const options: MenuOption[] = []\n\n    // Section 1: Basic selection operations (Rename, Copy, Duplicate)\n    const basicOps = getBasicSelectionOptions()\n    options.push(...basicOps)\n    options.push({ type: 'divider' })\n\n    // Section 2: Node actions (Run Branch, Pin, Bypass, Mute)\n    if (hasOutputNodesSelected.value) {\n      const runBranch = getRunBranchOption()\n      options.push(runBranch)\n    }\n    if (!groupContext) {\n      const pin = getPinOption(states, bump)\n      const bypass = getBypassOption(states, bump)\n      options.push(pin)\n      options.push(bypass)\n    }\n    if (groupContext) {\n      const groupModes = getGroupModeOptions(groupContext, bump)\n      options.push(...groupModes)\n    }\n    options.push({ type: 'divider' })\n\n    // Section 3: Structure operations (Convert to Subgraph, Frame selection, Minimize Node)\n    options.push(\n      ...getSubgraphOptions({\n        hasSubgraphs: hasSubgraphsSelected,\n        hasMultipleSelection: hasMultipleNodes.value\n      })\n    )\n    if (hasMultipleNodes.value) {\n      options.push(...getMultipleNodesOptions())\n    }\n    if (groupContext) {\n      options.push(getFitGroupToNodesOption(groupContext))\n    } else {\n      // Node context: Expand/Minimize\n      const visualOptions = getNodeVisualOptions(states, bump)\n      if (visualOptions.length > 0) {\n        options.push(visualOptions[0]) // Expand/Minimize (index 0)\n      }\n    }\n    options.push({ type: 'divider' })\n\n    // Section 4: Node properties (Node Info, Shape, Color)\n    if (nodeDef.value) {\n      options.push(getNodeInfoOption(showNodeHelp))\n    }\n    if (groupContext) {\n      options.push(getGroupColorOptions(groupContext, bump))\n    } else {\n      // Add shape and color options\n      const visualOptions = getNodeVisualOptions(states, bump)\n      if (visualOptions.length > 1) {\n        options.push(visualOptions[1]) // Shape (index 1)\n      }\n      if (visualOptions.length > 2) {\n        options.push(visualOptions[2]) // Color (index 2)\n      }\n    }\n    options.push({ type: 'divider' })\n\n    // Section 5: Image operations (if image node)\n    if (hasImageNode.value && selectedNodes.value.length > 0) {\n      options.push(...getImageMenuOptions(selectedNodes.value[0]))\n      options.push({ type: 'divider' })\n    }\n    // Section 6 & 7: Extensions and Delete are handled by buildStructuredMenu\n\n    // Mark all Vue options with source\n    const markedVueOptions = markAsVueOptions(options)\n\n    if (litegraphOptions.length > 0) {\n      // Merge: LiteGraph options first, then Vue options (Vue will win in dedup)\n      const merged = [...litegraphOptions, ...markedVueOptions]\n      return buildStructuredMenu(merged)\n    }\n    // For other cases, structure the Vue options\n    const result = buildStructuredMenu(markedVueOptions)\n    return result\n  })\n\n  // Computed property to get only menu items with submenus\n  const menuOptionsWithSubmenu = computed(() =>\n    menuOptions.value.filter((option) => option.hasSubmenu && option.submenu)\n  )\n\n  return {\n    menuOptions,\n    menuOptionsWithSubmenu,\n    bump,\n    hasSubgraphs,\n    registerNodeOptionsInstance\n  }\n}\n","<template>\n  <Popover\n    ref=\"popoverRef\"\n    :auto-z-index=\"true\"\n    :base-z-index=\"1100\"\n    :dismissable=\"true\"\n    :close-on-escape=\"true\"\n    unstyled\n    :pt=\"{\n      root: {\n        class: 'absolute z-60'\n      },\n      content: {\n        class: [\n          'text-base-foreground rounded-lg',\n          'shadow-lg border border-base-background',\n          'bg-interface-panel-surface'\n        ]\n      }\n    }\"\n  >\n    <div\n      :class=\"\n        isColorSubmenu\n          ? 'flex flex-col gap-1 p-2'\n          : 'flex flex-col p-2 min-w-40'\n      \"\n    >\n      <div\n        v-for=\"subOption in option.submenu\"\n        :key=\"subOption.label\"\n        :class=\"\n          cn(\n            'hover:bg-secondary-background-hover rounded cursor-pointer',\n            isColorSubmenu\n              ? 'w-7 h-7 flex items-center justify-center'\n              : 'flex items-center gap-2 px-3 py-1.5 text-sm',\n            subOption.disabled\n              ? 'cursor-not-allowed pointer-events-none text-node-icon-disabled'\n              : 'hover:bg-secondary-background-hover'\n          )\n        \"\n        :title=\"subOption.label\"\n        @click=\"handleSubmenuClick(subOption)\"\n      >\n        <div\n          v-if=\"subOption.color\"\n          class=\"size-5 rounded-full border border-border-default\"\n          :style=\"{ backgroundColor: subOption.color }\"\n        />\n        <template v-else-if=\"!subOption.color\">\n          <i\n            v-if=\"isShapeSelected(subOption)\"\n            class=\"icon-[lucide--check] size-4 flex-shrink-0\"\n          />\n          <div v-else class=\"w-4 flex-shrink-0\" />\n          <span>{{ subOption.label }}</span>\n        </template>\n      </div>\n    </div>\n  </Popover>\n</template>\n\n<script setup lang=\"ts\">\nimport { cn } from '@comfyorg/tailwind-utils'\nimport Popover from 'primevue/popover'\nimport { computed, ref } from 'vue'\n\nimport type {\n  MenuOption,\n  SubMenuOption\n} from '@/composables/graph/useMoreOptionsMenu'\nimport { useNodeCustomization } from '@/composables/graph/useNodeCustomization'\n\ninterface Props {\n  option: MenuOption\n}\n\ninterface Emits {\n  (e: 'submenu-click', subOption: SubMenuOption): void\n}\n\nconst props = defineProps<Props>()\nconst emit = defineEmits<Emits>()\n\nconst { getCurrentShape } = useNodeCustomization()\n\nconst popoverRef = ref<InstanceType<typeof Popover>>()\n\nconst toggle = (event: Event, target?: HTMLElement) => {\n  popoverRef.value?.toggle(event, target)\n}\ndefineExpose({\n  toggle\n})\n\nconst handleSubmenuClick = (subOption: SubMenuOption) => {\n  if (subOption.disabled) {\n    return\n  }\n  emit('submenu-click', subOption)\n  popoverRef.value?.hide()\n}\n\nconst isShapeSelected = (subOption: SubMenuOption): boolean => {\n  if (subOption.color) return false\n\n  const currentShape = getCurrentShape()\n  if (!currentShape) return false\n\n  return currentShape.localizedName === subOption.label\n}\n\nconst isColorSubmenu = computed(() => {\n  return (\n    props.option.submenu &&\n    props.option.submenu.length > 0 &&\n    props.option.submenu.every((item) => item.color && !item.icon)\n  )\n})\n</script>\n","<template>\n  <ContextMenu\n    ref=\"contextMenu\"\n    :model=\"menuItems\"\n    class=\"max-h-[80vh] md:max-h-none overflow-y-auto md:overflow-y-visible\"\n    @show=\"onMenuShow\"\n    @hide=\"onMenuHide\"\n  >\n    <template #item=\"{ item, props, hasSubmenu }\">\n      <a\n        v-bind=\"props.action\"\n        class=\"flex items-center gap-2 px-3 py-1.5\"\n        @click=\"item.isColorSubmenu ? showColorPopover($event) : undefined\"\n      >\n        <i v-if=\"item.icon\" :class=\"[item.icon, 'size-4']\" />\n        <span class=\"flex-1\">{{ item.label }}</span>\n        <span\n          v-if=\"item.shortcut\"\n          class=\"flex h-3.5 min-w-3.5 items-center justify-center rounded bg-interface-menu-keybind-surface-default px-1 py-0 text-xs\"\n        >\n          {{ item.shortcut }}\n        </span>\n        <i\n          v-if=\"hasSubmenu || item.isColorSubmenu\"\n          class=\"icon-[lucide--chevron-right] size-4 opacity-60\"\n        />\n      </a>\n    </template>\n  </ContextMenu>\n\n  <!-- Color picker menu (custom with color circles) -->\n  <ColorPickerMenu\n    v-if=\"colorOption\"\n    ref=\"colorPickerMenu\"\n    key=\"color-picker-menu\"\n    :option=\"colorOption\"\n    @submenu-click=\"handleColorSelect\"\n  />\n</template>\n\n<script setup lang=\"ts\">\nimport { useElementBounding, useEventListener, useRafFn } from '@vueuse/core'\nimport ContextMenu from 'primevue/contextmenu'\nimport type { MenuItem } from 'primevue/menuitem'\nimport { computed, onMounted, onUnmounted, ref, watchEffect } from 'vue'\n\nimport {\n  registerNodeOptionsInstance,\n  useMoreOptionsMenu\n} from '@/composables/graph/useMoreOptionsMenu'\nimport type {\n  MenuOption,\n  SubMenuOption\n} from '@/composables/graph/useMoreOptionsMenu'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\n\nimport ColorPickerMenu from './selectionToolbox/ColorPickerMenu.vue'\n\ninterface ExtendedMenuItem extends MenuItem {\n  isColorSubmenu?: boolean\n  shortcut?: string\n  originalOption?: MenuOption\n}\n\nconst contextMenu = ref<InstanceType<typeof ContextMenu>>()\nconst colorPickerMenu = ref<InstanceType<typeof ColorPickerMenu>>()\nconst isOpen = ref(false)\n\nconst { menuOptions, bump } = useMoreOptionsMenu()\nconst canvasStore = useCanvasStore()\n\n// World position (canvas coordinates) where menu was opened\nconst worldPosition = ref({ x: 0, y: 0 })\n\n// Get canvas bounding rect reactively\nconst lgCanvas = canvasStore.getCanvas()\nconst { left: canvasLeft, top: canvasTop } = useElementBounding(lgCanvas.canvas)\n\n// Track last canvas transform to detect actual changes\nlet lastScale = 0\nlet lastOffsetX = 0\nlet lastOffsetY = 0\n\n// Update menu position based on canvas transform\nconst updateMenuPosition = () => {\n  if (!isOpen.value) return\n\n  const menuInstance = contextMenu.value as unknown as {\n    container?: HTMLElement\n  }\n  const menuEl = menuInstance?.container\n  if (!menuEl) return\n\n  const { scale, offset } = lgCanvas.ds\n\n  // Only update if canvas transform actually changed\n  if (\n    scale === lastScale &&\n    offset[0] === lastOffsetX &&\n    offset[1] === lastOffsetY\n  ) {\n    return\n  }\n\n  lastScale = scale\n  lastOffsetX = offset[0]\n  lastOffsetY = offset[1]\n\n  // Convert world position to screen position\n  const screenX = (worldPosition.value.x + offset[0]) * scale + canvasLeft.value\n  const screenY = (worldPosition.value.y + offset[1]) * scale + canvasTop.value\n\n  // Update menu position\n  menuEl.style.left = `${screenX}px`\n  menuEl.style.top = `${screenY}px`\n}\n\n// Sync with canvas transform using requestAnimationFrame\nconst { resume: startSync, pause: stopSync } = useRafFn(updateMenuPosition, {\n  immediate: false\n})\n\n// Start/stop syncing based on menu visibility\nwatchEffect(() => {\n  if (isOpen.value) {\n    startSync()\n  } else {\n    stopSync()\n  }\n})\n\n// Close on touch outside to handle mobile devices where click might be swallowed\nuseEventListener(\n  window,\n  'touchstart',\n  (event: TouchEvent) => {\n    if (!isOpen.value || !contextMenu.value) return\n\n    const target = event.target as Node\n    const contextMenuInstance = contextMenu.value as unknown as {\n      container?: HTMLElement\n      $el?: HTMLElement\n    }\n    const menuEl = contextMenuInstance.container || contextMenuInstance.$el\n\n    if (menuEl && !menuEl.contains(target)) {\n      hide()\n    }\n  },\n  { passive: true }\n)\n\n// Find color picker option\nconst colorOption = computed(() =>\n  menuOptions.value.find((opt) => opt.isColorPicker)\n)\n\n// Check if option is the color picker\nfunction isColorOption(option: MenuOption): boolean {\n  return Boolean(option.isColorPicker)\n}\n\n// Convert MenuOption to PrimeVue MenuItem\nfunction convertToMenuItem(option: MenuOption): ExtendedMenuItem {\n  if (option.type === 'divider') return { separator: true }\n\n  const isColor = isColorOption(option)\n\n  const item: ExtendedMenuItem = {\n    label: option.label,\n    icon: option.icon,\n    disabled: option.disabled,\n    shortcut: option.shortcut,\n    isColorSubmenu: isColor,\n    originalOption: option\n  }\n\n  // Native submenus for non-color options\n  if (option.hasSubmenu && option.submenu && !isColor) {\n    item.items = option.submenu.map((sub) => ({\n      label: sub.label,\n      icon: sub.icon,\n      disabled: sub.disabled,\n      command: () => {\n        sub.action()\n        hide()\n      }\n    }))\n  }\n\n  // Regular action items\n  if (!option.hasSubmenu && option.action) {\n    item.command = () => {\n      option.action?.()\n      hide()\n    }\n  }\n\n  return item\n}\n\n// Build menu items\nconst menuItems = computed<ExtendedMenuItem[]>(() =>\n  menuOptions.value.map(convertToMenuItem)\n)\n\n// Show context menu\nfunction show(event: MouseEvent) {\n  bump()\n\n  // Convert screen position to world coordinates\n  // Screen position relative to canvas = event position - canvas offset\n  const screenX = event.clientX - canvasLeft.value\n  const screenY = event.clientY - canvasTop.value\n\n  // Convert to world coordinates using canvas transform\n  const { scale, offset } = lgCanvas.ds\n  worldPosition.value = {\n    x: screenX / scale - offset[0],\n    y: screenY / scale - offset[1]\n  }\n\n  isOpen.value = true\n  contextMenu.value?.show(event)\n}\n\n// Hide context menu\nfunction hide() {\n  contextMenu.value?.hide()\n}\n\nfunction toggle(event: Event) {\n  if (isOpen.value) {\n    hide()\n  } else {\n    show(event as MouseEvent)\n  }\n}\n\ndefineExpose({ toggle, hide, isOpen, show })\n\nfunction showColorPopover(event: MouseEvent) {\n  event.stopPropagation()\n  event.preventDefault()\n  const target = Array.from((event.currentTarget as HTMLElement).children).find(\n    (el) => el.classList.contains('icon-[lucide--chevron-right]')\n  ) as HTMLElement\n  colorPickerMenu.value?.toggle(event, target)\n}\n\n// Handle color selection\nfunction handleColorSelect(subOption: SubMenuOption) {\n  subOption.action()\n  hide()\n}\n\nfunction onMenuShow() {\n  isOpen.value = true\n}\n\nfunction onMenuHide() {\n  isOpen.value = false\n}\n\nonMounted(() => {\n  registerNodeOptionsInstance({ toggle, show, hide, isOpen })\n})\n\nonUnmounted(() => {\n  registerNodeOptionsInstance(null)\n})\n</script>\n","<template>\n  <Button\n    v-tooltip.top=\"{\n      value: $t('g.frameNodes'),\n      showDelay: 1000\n    }\"\n    variant=\"muted-textonly\"\n    :aria-label=\"$t('g.frameNodes')\"\n    @click=\"frameNodes\"\n  >\n    <i class=\"icon-[lucide--frame]\" />\n  </Button>\n</template>\n\n<script setup lang=\"ts\">\nimport Button from '@/components/ui/button/Button.vue'\nimport { useFrameNodes } from '@/composables/graph/useFrameNodes'\n\nconst { frameNodes } = useFrameNodes()\n</script>\n","<template>\n  <Button\n    v-tooltip.top=\"{\n      value: $t('g.moreOptions'),\n      showDelay: 1000\n    }\"\n    data-testid=\"more-options-button\"\n    variant=\"muted-textonly\"\n    :aria-label=\"$t('g.moreOptions')\"\n    @click=\"handleClick\"\n  >\n    <i class=\"icon-[lucide--more-vertical]\" />\n  </Button>\n</template>\n\n<script setup lang=\"ts\">\nimport Button from '@/components/ui/button/Button.vue'\nimport { toggleNodeOptions } from '@/composables/graph/useMoreOptionsMenu'\n\nconst handleClick = (event: Event) => {\n  toggleNodeOptions(event)\n}\n</script>\n","<template>\n  <div class=\"h-6 w-px self-center bg-border-default\" />\n</template>\n","<template>\n  <div\n    ref=\"toolboxRef\"\n    style=\"transform: translate(var(--tb-x), var(--tb-y))\"\n    class=\"pointer-events-none fixed top-0 left-0 z-40\"\n  >\n    <Transition name=\"slide-up\">\n      <Panel\n        v-if=\"visible\"\n        class=\"selection-toolbox pointer-events-auto rounded-lg border border-interface-stroke bg-interface-panel-surface\"\n        :pt=\"{\n          header: 'hidden',\n          content: 'p-2 h-12 flex flex-row gap-1'\n        }\"\n        @wheel=\"canvasInteractions.forwardEventToCanvas\"\n      >\n        <DeleteButton v-if=\"showDelete\" />\n        <VerticalDivider v-if=\"showInfoButton && showAnyPrimaryActions\" />\n        <InfoButton v-if=\"showInfoButton\" />\n\n        <ColorPickerButton v-if=\"showColorPicker\" />\n        <FrameNodes v-if=\"showFrameNodes\" />\n        <ConvertToSubgraphButton v-if=\"showConvertToSubgraph\" />\n        <ConfigureSubgraph v-if=\"showSubgraphButtons\" />\n        <PublishSubgraphButton v-if=\"showSubgraphButtons\" />\n        <MaskEditorButton v-if=\"showMaskEditor\" />\n        <VerticalDivider\n          v-if=\"showAnyPrimaryActions && showAnyControlActions\"\n        />\n\n        <BypassButton v-if=\"showBypass\" />\n        <RefreshSelectionButton v-if=\"showRefresh\" />\n        <Load3DViewerButton v-if=\"showLoad3DViewer\" />\n\n        <ExtensionCommandButton\n          v-for=\"command in extensionToolboxCommands\"\n          :key=\"command.id\"\n          :command=\"command\"\n        />\n        <ExecuteButton v-if=\"showExecute\" />\n        <NodeOptionsButton />\n      </Panel>\n    </Transition>\n  </div>\n  <NodeContextMenu />\n</template>\n\n<script setup lang=\"ts\">\nimport Panel from 'primevue/panel'\nimport { computed, ref } from 'vue'\n\nimport BypassButton from '@/components/graph/selectionToolbox/BypassButton.vue'\nimport ColorPickerButton from '@/components/graph/selectionToolbox/ColorPickerButton.vue'\nimport ConfigureSubgraph from '@/components/graph/selectionToolbox/ConfigureSubgraph.vue'\nimport ConvertToSubgraphButton from '@/components/graph/selectionToolbox/ConvertToSubgraphButton.vue'\nimport DeleteButton from '@/components/graph/selectionToolbox/DeleteButton.vue'\nimport ExecuteButton from '@/components/graph/selectionToolbox/ExecuteButton.vue'\nimport ExtensionCommandButton from '@/components/graph/selectionToolbox/ExtensionCommandButton.vue'\nimport InfoButton from '@/components/graph/selectionToolbox/InfoButton.vue'\nimport Load3DViewerButton from '@/components/graph/selectionToolbox/Load3DViewerButton.vue'\nimport MaskEditorButton from '@/components/graph/selectionToolbox/MaskEditorButton.vue'\nimport RefreshSelectionButton from '@/components/graph/selectionToolbox/RefreshSelectionButton.vue'\nimport PublishSubgraphButton from '@/components/graph/selectionToolbox/SaveToSubgraphLibrary.vue'\nimport { useSelectionToolboxPosition } from '@/composables/canvas/useSelectionToolboxPosition'\nimport { useSelectionState } from '@/composables/graph/useSelectionState'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useCanvasInteractions } from '@/renderer/core/canvas/useCanvasInteractions'\nimport { useExtensionService } from '@/services/extensionService'\nimport { useCommandStore } from '@/stores/commandStore'\nimport type { ComfyCommandImpl } from '@/stores/commandStore'\n\nimport NodeContextMenu from './NodeContextMenu.vue'\nimport FrameNodes from './selectionToolbox/FrameNodes.vue'\nimport NodeOptionsButton from './selectionToolbox/NodeOptionsButton.vue'\nimport VerticalDivider from './selectionToolbox/VerticalDivider.vue'\n\nconst commandStore = useCommandStore()\nconst canvasStore = useCanvasStore()\nconst extensionService = useExtensionService()\nconst canvasInteractions = useCanvasInteractions()\n\nconst toolboxRef = ref<HTMLElement | undefined>()\nconst { visible } = useSelectionToolboxPosition(toolboxRef)\n\nconst extensionToolboxCommands = computed<ComfyCommandImpl[]>(() => {\n  const commandIds = new Set<string>(\n    canvasStore.selectedItems\n      .map(\n        (item) =>\n          extensionService\n            .invokeExtensions('getSelectionToolboxCommands', item)\n            .flat() as string[]\n      )\n      .flat()\n  )\n  return Array.from(commandIds)\n    .map((commandId) => commandStore.getCommand(commandId))\n    .filter((command): command is ComfyCommandImpl => command !== undefined)\n})\n\nconst {\n  hasAnySelection,\n  hasMultipleSelection,\n  isSingleNode,\n  isSingleSubgraph,\n  isSingleImageNode,\n  hasAny3DNodeSelected,\n  hasOutputNodesSelected,\n  nodeDef\n} = useSelectionState()\nconst showInfoButton = computed(() => !!nodeDef.value)\n\nconst showColorPicker = computed(() => hasAnySelection.value)\nconst showConvertToSubgraph = computed(() => hasAnySelection.value)\nconst showFrameNodes = computed(() => hasMultipleSelection.value)\nconst showSubgraphButtons = computed(() => isSingleSubgraph.value)\n\nconst showBypass = computed(\n  () =>\n    isSingleNode.value || isSingleSubgraph.value || hasMultipleSelection.value\n)\nconst showLoad3DViewer = computed(() => hasAny3DNodeSelected.value)\nconst showMaskEditor = computed(() => isSingleImageNode.value)\n\nconst showDelete = computed(() => hasAnySelection.value)\nconst showRefresh = computed(() => hasAnySelection.value)\nconst showExecute = computed(() => hasOutputNodesSelected.value)\n\nconst showAnyPrimaryActions = computed(\n  () =>\n    showColorPicker.value ||\n    showConvertToSubgraph.value ||\n    showFrameNodes.value ||\n    showSubgraphButtons.value\n)\n\nconst showAnyControlActions = computed(() => showBypass.value)\n</script>\n\n<style scoped>\n.selection-toolbox {\n  transform: translateX(-50%) translateY(-120%);\n}\n\n@keyframes slideUp {\n  0% {\n    transform: translateX(-50%) translateY(-100%);\n    opacity: 0;\n  }\n  50% {\n    transform: translateX(-50%) translateY(-125%);\n    opacity: 0.5;\n  }\n  100% {\n    transform: translateX(-50%) translateY(-120%);\n    opacity: 1;\n  }\n}\n\n.slide-up-enter-active {\n  animation: slideUp 125ms ease-out;\n}\n\n.slide-up-leave-active {\n  animation: slideUp 25ms ease-out reverse;\n}\n</style>\n","<template>\n  <div\n    v-if=\"showInput\"\n    class=\"group-title-editor node-title-editor\"\n    :style=\"inputStyle\"\n  >\n    <EditableText\n      :is-editing=\"showInput\"\n      :model-value=\"editedTitle\"\n      @edit=\"onEdit\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useEventListener } from '@vueuse/core'\nimport { computed, ref, watch } from 'vue'\nimport type { CSSProperties } from 'vue'\n\nimport EditableText from '@/components/common/EditableText.vue'\nimport { useAbsolutePosition } from '@/composables/element/useAbsolutePosition'\nimport {\n  LGraphGroup,\n  LGraphNode,\n  LiteGraph\n} from '@/lib/litegraph/src/litegraph'\nimport type { LiteGraphCanvasEvent } from '@/lib/litegraph/src/litegraph'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport {\n  useCanvasStore,\n  useTitleEditorStore\n} from '@/renderer/core/canvas/canvasStore'\nimport { app } from '@/scripts/app'\n\nconst settingStore = useSettingStore()\n\nconst showInput = ref(false)\nconst editedTitle = ref('')\nconst { style: inputPositionStyle, updatePosition } = useAbsolutePosition()\nconst inputFontStyle = ref<CSSProperties>({})\nconst inputStyle = computed<CSSProperties>(() => ({\n  ...inputPositionStyle.value,\n  ...inputFontStyle.value\n}))\n\nconst titleEditorStore = useTitleEditorStore()\nconst canvasStore = useCanvasStore()\nconst previousCanvasDraggable = ref(true)\n\nconst onEdit = (newValue: string) => {\n  if (titleEditorStore.titleEditorTarget && newValue?.trim()) {\n    const trimmedTitle = newValue.trim()\n    titleEditorStore.titleEditorTarget.title = trimmedTitle\n\n    // If this is a subgraph node, sync the runtime subgraph name for breadcrumb reactivity\n    const target = titleEditorStore.titleEditorTarget\n    if (target instanceof LGraphNode && target.isSubgraphNode?.()) {\n      target.subgraph.name = trimmedTitle\n    }\n\n    app.canvas.setDirty(true, true)\n  }\n  showInput.value = false\n  titleEditorStore.titleEditorTarget = null\n  canvasStore.canvas!.allow_dragcanvas = previousCanvasDraggable.value\n}\n\nwatch(\n  () => titleEditorStore.titleEditorTarget,\n  (target) => {\n    if (target === null) {\n      return\n    }\n    editedTitle.value = target.title\n    showInput.value = true\n    const canvas = canvasStore.canvas!\n    previousCanvasDraggable.value = canvas.allow_dragcanvas\n    canvas.allow_dragcanvas = false\n    const scale = canvas.ds.scale\n\n    if (target instanceof LGraphGroup) {\n      const group = target\n      updatePosition({\n        pos: group.pos,\n        size: [group.size[0], group.titleHeight]\n      })\n      inputFontStyle.value = { fontSize: `${group.font_size * scale}px` }\n    } else if (target instanceof LGraphNode) {\n      const node = target\n      const [x, y] = node.getBounding()\n      updatePosition({\n        pos: [x, y],\n        size: [node.width, LiteGraph.NODE_TITLE_HEIGHT]\n      })\n      inputFontStyle.value = { fontSize: `${12 * scale}px` }\n    }\n  }\n)\n\nconst canvasEventHandler = (event: LiteGraphCanvasEvent) => {\n  if (event.detail.subType === 'group-double-click') {\n    if (!settingStore.get('Comfy.Group.DoubleClickTitleToEdit')) {\n      return\n    }\n\n    const group: LGraphGroup = event.detail.group\n    const [_, y] = group.pos\n\n    const e = event.detail.originalEvent\n    const relativeY = e.canvasY - y\n    // Only allow editing if the click is on the title bar\n    if (relativeY <= group.titleHeight) {\n      titleEditorStore.titleEditorTarget = group\n    }\n  } else if (event.detail.subType === 'node-double-click') {\n    if (!settingStore.get('Comfy.Node.DoubleClickTitleToEdit')) {\n      return\n    }\n\n    const node: LGraphNode = event.detail.node\n    const [_, y] = node.pos\n\n    const e = event.detail.originalEvent\n    const relativeY = e.canvasY - y\n    // Only allow editing if the click is on the title bar\n    if (relativeY <= 0) {\n      titleEditorStore.titleEditorTarget = node\n    }\n  }\n}\n\nuseEventListener(document, 'litegraph:canvas', canvasEventHandler)\n</script>\n\n<style scoped>\n.group-title-editor.node-title-editor {\n  z-index: 9999;\n  padding: 0.25rem;\n}\n\n:deep(.editable-text) {\n  width: 100%;\n  height: 100%;\n}\n\n:deep(.editable-text input) {\n  width: 100%;\n  height: 100%;\n  /* Override the default font size */\n  font-size: inherit;\n}\n</style>\n","<script setup lang=\"ts\">\nimport { whenever } from '@vueuse/core'\nimport { computed } from 'vue'\n\nimport NodeHelpContent from '@/components/node/NodeHelpContent.vue'\nimport type { LGraphNode } from '@/lib/litegraph/src/litegraph'\nimport { useNodeDefStore } from '@/stores/nodeDefStore'\nimport { useNodeHelpStore } from '@/stores/workspace/nodeHelpStore'\n\nconst { nodes } = defineProps<{\n  nodes: LGraphNode[]\n}>()\nconst node = computed(() => nodes[0])\n\nconst nodeDefStore = useNodeDefStore()\nconst nodeHelpStore = useNodeHelpStore()\n\nconst nodeInfo = computed(() => {\n  return nodeDefStore.fromLGraphNode(node.value)\n})\n\n// Open node help when the selected node changes\nwhenever(\n  nodeInfo,\n  (info) => {\n    nodeHelpStore.openHelp(info)\n  },\n  { immediate: true }\n)\n</script>\n\n<template>\n  <div v-if=\"nodeInfo\" class=\"p-3\">\n    <NodeHelpContent :node=\"nodeInfo\" />\n  </div>\n</template>\n","<script setup lang=\"ts\">\nimport { refDebounced } from '@vueuse/core'\nimport { ref, toRef, toValue, watch } from 'vue'\nimport type { MaybeRefOrGetter } from 'vue'\n\nimport { cn } from '@/utils/tailwindUtil'\n\nconst { searcher = async () => {}, updateKey } = defineProps<{\n  searcher?: (\n    query: string,\n    onCleanup: (cleanupFn: () => void) => void\n  ) => Promise<void>\n  updateKey?: MaybeRefOrGetter<unknown>\n}>()\n\nconst searchQuery = defineModel<string>({ default: '' })\n\nconst isQuerying = ref(false)\nconst debouncedSearchQuery = refDebounced(searchQuery, 100, {\n  maxWait: 100\n})\nwatch(searchQuery, (value) => {\n  isQuerying.value = value !== debouncedSearchQuery.value\n})\nconst updateKeyRef = toRef(() => toValue(updateKey))\n\nwatch(\n  [debouncedSearchQuery, updateKeyRef],\n  (_, __, onCleanup) => {\n    let isCleanup = false\n    let cleanupFn: undefined | (() => void)\n    onCleanup(() => {\n      isCleanup = true\n      cleanupFn?.()\n    })\n\n    void searcher(debouncedSearchQuery.value, (cb) => (cleanupFn = cb))\n      .catch((error) => {\n        console.error('[SidePanelSearch] searcher failed', error)\n      })\n      .finally(() => {\n        if (!isCleanup) isQuerying.value = false\n      })\n  },\n  { immediate: true }\n)\n</script>\n\n<template>\n  <label\n    :class=\"\n      cn(\n        'mt-1 py-1.5 bg-secondary-background rounded-lg transition-all duration-150',\n        'flex-1 flex gap-2 px-2 items-center',\n        'text-base-foreground border-0',\n        'focus-within:ring focus-within:ring-component-node-widget-background-highlighted/80'\n      )\n    \"\n  >\n    <i\n      :class=\"\n        cn(\n          'size-4 text-muted-foreground',\n          isQuerying\n            ? 'icon-[lucide--loader-circle] animate-spin'\n            : 'icon-[lucide--search]'\n        )\n      \"\n    />\n    <input\n      v-model=\"searchQuery\"\n      type=\"text\"\n      class=\"bg-transparent border-0 outline-0 ring-0 h-5\"\n      :placeholder=\"$t('g.searchPlaceholder')\"\n    />\n  </label>\n</template>\n","/**\n * Simplified widget interface for Vue-based node rendering\n * Removes all DOM manipulation and positioning concerns\n */\nimport type { InputSpec as InputSpecV2 } from '@/schemas/nodeDef/nodeDefSchemaV2'\n\n/** Valid types for widget values */\nexport type WidgetValue =\n  | string\n  | number\n  | boolean\n  | object\n  | undefined\n  | null\n  | void\n  | File[]\n\nconst CONTROL_OPTIONS = [\n  'fixed',\n  'increment',\n  'decrement',\n  'randomize'\n] as const\nexport type ControlOptions = (typeof CONTROL_OPTIONS)[number]\n\nfunction isControlOption(val: WidgetValue): val is ControlOptions {\n  return CONTROL_OPTIONS.includes(val as ControlOptions)\n}\n\nexport function normalizeControlOption(val: WidgetValue): ControlOptions {\n  if (isControlOption(val)) return val\n  return 'randomize'\n}\n\nexport type SafeControlWidget = {\n  value: ControlOptions\n  update: (value: WidgetValue) => void\n}\n\nexport interface SimplifiedWidget<\n  T extends WidgetValue = WidgetValue,\n  O = Record<string, any>\n> {\n  /** Display name of the widget */\n  name: string\n\n  /** Widget type identifier (e.g., 'STRING', 'INT', 'COMBO') */\n  type: string\n\n  /** Current value of the widget */\n  value: T\n\n  borderStyle?: string\n\n  /** Callback fired when value changes */\n  callback?: (value: T) => void\n\n  /** Optional method to compute widget size requirements */\n  computeSize?: () => { minHeight: number; maxHeight?: number }\n\n  /** Localized display label (falls back to name if not provided) */\n  label?: string\n\n  /** Widget options including filtered PrimeVue props */\n  options?: O\n\n  /** Override for use with subgraph promoted asset widgets*/\n  nodeType?: string\n\n  /** Optional serialization method for custom value handling */\n  serializeValue?: () => any\n\n  /** Optional input specification backing this widget */\n  spec?: InputSpecV2\n\n  controlWidget?: SafeControlWidget\n}\n\nexport interface SimplifiedControlWidget<\n  T extends WidgetValue = WidgetValue,\n  O = Record<string, any>\n> extends SimplifiedWidget<T, O> {\n  controlWidget: SafeControlWidget\n}\n","/**\n * Vue node lifecycle management for LiteGraph integration\n * Provides event-driven reactivity with performance optimizations\n */\nimport { reactiveComputed } from '@vueuse/core'\nimport { customRef, reactive, shallowReactive } from 'vue'\n\nimport { useChainCallback } from '@/composables/functional/useChainCallback'\nimport { isProxyWidget } from '@/core/graph/subgraph/proxyWidget'\nimport type {\n  INodeInputSlot,\n  INodeOutputSlot\n} from '@/lib/litegraph/src/interfaces'\nimport type {\n  IBaseWidget,\n  IWidgetOptions\n} from '@/lib/litegraph/src/types/widgets'\nimport { useLayoutMutations } from '@/renderer/core/layout/operations/layoutMutations'\nimport { LayoutSource } from '@/renderer/core/layout/types'\nimport type { NodeId } from '@/renderer/core/layout/types'\nimport type { InputSpec } from '@/schemas/nodeDef/nodeDefSchemaV2'\nimport { isDOMWidget } from '@/scripts/domWidget'\nimport { useNodeDefStore } from '@/stores/nodeDefStore'\nimport type { WidgetValue, SafeControlWidget } from '@/types/simplifiedWidget'\nimport { normalizeControlOption } from '@/types/simplifiedWidget'\n\nimport type {\n  LGraph,\n  LGraphBadge,\n  LGraphNode,\n  LGraphTriggerAction,\n  LGraphTriggerEvent,\n  LGraphTriggerParam\n} from '@/lib/litegraph/src/litegraph'\nimport type { TitleMode } from '@/lib/litegraph/src/types/globalEnums'\nimport { NodeSlotType } from '@/lib/litegraph/src/types/globalEnums'\nimport { app } from '@/scripts/app'\n\nexport interface WidgetSlotMetadata {\n  index: number\n  linked: boolean\n}\n\nexport interface SafeWidgetData {\n  name: string\n  type: string\n  value: WidgetValue\n  borderStyle?: string\n  callback?: ((value: unknown) => void) | undefined\n  controlWidget?: SafeControlWidget\n  hasLayoutSize?: boolean\n  isDOMWidget?: boolean\n  label?: string\n  nodeType?: string\n  options?: IWidgetOptions<unknown>\n  spec?: InputSpec\n  slotMetadata?: WidgetSlotMetadata\n}\n\nexport interface VueNodeData {\n  executing: boolean\n  id: NodeId\n  mode: number\n  selected: boolean\n  title: string\n  type: string\n  apiNode?: boolean\n  badges?: (LGraphBadge | (() => LGraphBadge))[]\n  bgcolor?: string\n  color?: string\n  flags?: {\n    collapsed?: boolean\n    pinned?: boolean\n  }\n  hasErrors?: boolean\n  inputs?: INodeInputSlot[]\n  outputs?: INodeOutputSlot[]\n  shape?: number\n  subgraphId?: string | null\n  titleMode?: TitleMode\n  widgets?: SafeWidgetData[]\n}\n\nexport interface GraphNodeManager {\n  // Reactive state - safe data extracted from LiteGraph nodes\n  vueNodeData: ReadonlyMap<string, VueNodeData>\n\n  // Access to original LiteGraph nodes (non-reactive)\n  getNode(id: string): LGraphNode | undefined\n\n  // Lifecycle methods\n  cleanup(): void\n}\n\nfunction widgetWithVueTrack(\n  widget: IBaseWidget\n): asserts widget is IBaseWidget & { vueTrack: () => void } {\n  if (widget.vueTrack) return\n\n  customRef((track, trigger) => {\n    widget.callback = useChainCallback(widget.callback, trigger)\n    widget.vueTrack = track\n    return { get() {}, set() {} }\n  })\n}\nexport function useReactiveWidgetValue(widget: IBaseWidget) {\n  widgetWithVueTrack(widget)\n  widget.vueTrack()\n  return widget.value\n}\n\nfunction getControlWidget(widget: IBaseWidget): SafeControlWidget | undefined {\n  const cagWidget = widget.linkedWidgets?.find(\n    (w) => w.name == 'control_after_generate'\n  )\n  if (!cagWidget) return\n  return {\n    value: normalizeControlOption(cagWidget.value),\n    update: (value) => (cagWidget.value = normalizeControlOption(value))\n  }\n}\nfunction getNodeType(node: LGraphNode, widget: IBaseWidget) {\n  if (!node.isSubgraphNode() || !isProxyWidget(widget)) return undefined\n  const subNode = node.subgraph.getNodeById(widget._overlay.nodeId)\n  return subNode?.type\n}\n\n/**\n * Validates that a value is a valid WidgetValue type\n */\nconst normalizeWidgetValue = (value: unknown): WidgetValue => {\n  if (value === null || value === undefined || value === void 0) {\n    return undefined\n  }\n  if (\n    typeof value === 'string' ||\n    typeof value === 'number' ||\n    typeof value === 'boolean'\n  ) {\n    return value\n  }\n  if (typeof value === 'object') {\n    // Check if it's a File array\n    if (\n      Array.isArray(value) &&\n      value.length > 0 &&\n      value.every((item): item is File => item instanceof File)\n    ) {\n      return value\n    }\n    // Otherwise it's a generic object\n    return value\n  }\n  // If none of the above, return undefined\n  console.warn(`Invalid widget value type: ${typeof value}`, value)\n  return undefined\n}\n\nexport function safeWidgetMapper(\n  node: LGraphNode,\n  slotMetadata: Map<string, WidgetSlotMetadata>\n): (widget: IBaseWidget) => SafeWidgetData {\n  const nodeDefStore = useNodeDefStore()\n  return function (widget) {\n    try {\n      const spec = nodeDefStore.getInputSpecForWidget(node, widget.name)\n      const slotInfo = slotMetadata.get(widget.name)\n      const borderStyle = widget.promoted\n        ? 'ring ring-component-node-widget-promoted'\n        : widget.advanced\n          ? 'ring ring-component-node-widget-advanced'\n          : undefined\n      const callback = (v: unknown) => {\n        const value = normalizeWidgetValue(v)\n        widget.value = value ?? undefined\n        // Match litegraph callback signature: (value, canvas, node, pos, event)\n        // Some extensions (e.g., Impact Pack) expect node as the 3rd parameter\n        widget.callback?.(value, app.canvas, node)\n        // Trigger redraw for all legacy widgets on this node (e.g., mask preview)\n        // This ensures widgets that depend on other widget values get updated\n        node.widgets?.forEach((w) => w.triggerDraw?.())\n      }\n\n      return {\n        name: widget.name,\n        type: widget.type,\n        value: useReactiveWidgetValue(widget),\n        borderStyle,\n        callback,\n        controlWidget: getControlWidget(widget),\n        hasLayoutSize: typeof widget.computeLayoutSize === 'function',\n        isDOMWidget: isDOMWidget(widget),\n        label: widget.label,\n        nodeType: getNodeType(node, widget),\n        options: widget.options,\n        spec,\n        slotMetadata: slotInfo\n      }\n    } catch (error) {\n      return {\n        name: widget.name || 'unknown',\n        type: widget.type || 'text',\n        value: undefined\n      }\n    }\n  }\n}\n\nexport function isValidWidgetValue(value: unknown): value is WidgetValue {\n  return (\n    value === null ||\n    value === undefined ||\n    typeof value === 'string' ||\n    typeof value === 'number' ||\n    typeof value === 'boolean' ||\n    typeof value === 'object'\n  )\n}\n\nexport function useGraphNodeManager(graph: LGraph): GraphNodeManager {\n  // Get layout mutations composable\n  const { createNode, deleteNode, setSource } = useLayoutMutations()\n  // Safe reactive data extracted from LiteGraph nodes\n  const vueNodeData = reactive(new Map<string, VueNodeData>())\n\n  // Non-reactive storage for original LiteGraph nodes\n  const nodeRefs = new Map<string, LGraphNode>()\n\n  const refreshNodeSlots = (nodeId: string) => {\n    const nodeRef = nodeRefs.get(nodeId)\n    const currentData = vueNodeData.get(nodeId)\n\n    if (!nodeRef || !currentData) return\n\n    // Only extract slot-related data instead of full node re-extraction\n    const slotMetadata = new Map<string, WidgetSlotMetadata>()\n\n    nodeRef.inputs?.forEach((input, index) => {\n      if (!input?.widget?.name) return\n      slotMetadata.set(input.widget.name, {\n        index,\n        linked: input.link != null\n      })\n    })\n\n    // Update only widgets with new slot metadata, keeping other widget data intact\n    const updatedWidgets = currentData.widgets?.map((widget) => {\n      const slotInfo = slotMetadata.get(widget.name)\n      return slotInfo ? { ...widget, slotMetadata: slotInfo } : widget\n    })\n\n    vueNodeData.set(nodeId, {\n      ...currentData,\n      widgets: updatedWidgets,\n      inputs: nodeRef.inputs ? [...nodeRef.inputs] : undefined,\n      outputs: nodeRef.outputs ? [...nodeRef.outputs] : undefined\n    })\n  }\n\n  // Extract safe data from LiteGraph node for Vue consumption\n  function extractVueNodeData(node: LGraphNode): VueNodeData {\n    // Determine subgraph ID - null for root graph, string for subgraphs\n    const subgraphId =\n      node.graph && 'id' in node.graph && node.graph !== node.graph.rootGraph\n        ? String(node.graph.id)\n        : null\n    // Extract safe widget data\n    const slotMetadata = new Map<string, WidgetSlotMetadata>()\n\n    const reactiveWidgets = shallowReactive<IBaseWidget[]>(node.widgets ?? [])\n    Object.defineProperty(node, 'widgets', {\n      get() {\n        return reactiveWidgets\n      },\n      set(v) {\n        reactiveWidgets.splice(0, reactiveWidgets.length, ...v)\n      }\n    })\n    const reactiveInputs = shallowReactive<INodeInputSlot[]>(node.inputs ?? [])\n    Object.defineProperty(node, 'inputs', {\n      get() {\n        return reactiveInputs\n      },\n      set(v) {\n        reactiveInputs.splice(0, reactiveInputs.length, ...v)\n      }\n    })\n\n    const safeWidgets = reactiveComputed<SafeWidgetData[]>(() => {\n      node.inputs?.forEach((input, index) => {\n        if (!input?.widget?.name) return\n        slotMetadata.set(input.widget.name, {\n          index,\n          linked: input.link != null\n        })\n      })\n      return node.widgets?.map(safeWidgetMapper(node, slotMetadata)) ?? []\n    })\n\n    const nodeType =\n      node.type ||\n      node.constructor?.comfyClass ||\n      node.constructor?.title ||\n      node.constructor?.name ||\n      'Unknown'\n\n    const apiNode = node.constructor?.nodeData?.api_node ?? false\n    const badges = node.badges\n\n    return {\n      id: String(node.id),\n      title: typeof node.title === 'string' ? node.title : '',\n      type: nodeType,\n      mode: node.mode || 0,\n      titleMode: node.title_mode,\n      selected: node.selected || false,\n      executing: false, // Will be updated separately based on execution state\n      subgraphId,\n      apiNode,\n      badges,\n      hasErrors: !!node.has_errors,\n      widgets: safeWidgets,\n      inputs: reactiveInputs,\n      outputs: node.outputs ? [...node.outputs] : undefined,\n      flags: node.flags ? { ...node.flags } : undefined,\n      color: node.color || undefined,\n      bgcolor: node.bgcolor || undefined,\n      shape: node.shape\n    }\n  }\n\n  // Get access to original LiteGraph node (non-reactive)\n  const getNode = (id: string): LGraphNode | undefined => {\n    return nodeRefs.get(id)\n  }\n\n  const syncWithGraph = () => {\n    if (!graph?._nodes) return\n\n    const currentNodes = new Set(graph._nodes.map((n) => String(n.id)))\n\n    // Remove deleted nodes\n    for (const id of Array.from(vueNodeData.keys())) {\n      if (!currentNodes.has(id)) {\n        nodeRefs.delete(id)\n        vueNodeData.delete(id)\n      }\n    }\n\n    // Add/update existing nodes\n    graph._nodes.forEach((node) => {\n      const id = String(node.id)\n\n      // Store non-reactive reference\n      nodeRefs.set(id, node)\n\n      // Extract and store safe data for Vue\n      vueNodeData.set(id, extractVueNodeData(node))\n    })\n  }\n\n  /**\n   * Handles node addition to the graph - sets up Vue state and spatial indexing\n   * Defers position extraction until after potential configure() calls\n   */\n  const handleNodeAdded = (\n    node: LGraphNode,\n    originalCallback?: (node: LGraphNode) => void\n  ) => {\n    const id = String(node.id)\n\n    // Store non-reactive reference to original node\n    nodeRefs.set(id, node)\n\n    // Extract initial data for Vue (may be incomplete during graph configure)\n    vueNodeData.set(id, extractVueNodeData(node))\n\n    const initializeVueNodeLayout = () => {\n      // Extract actual positions after configure() has potentially updated them\n      const nodePosition = { x: node.pos[0], y: node.pos[1] }\n      const nodeSize = { width: node.size[0], height: node.size[1] }\n\n      // Add node to layout store with final positions\n      setSource(LayoutSource.Canvas)\n      void createNode(id, {\n        position: nodePosition,\n        size: nodeSize,\n        zIndex: node.order || 0,\n        visible: true\n      })\n    }\n\n    // Check if we're in the middle of configuring the graph (workflow loading)\n    if (window.app?.configuringGraph) {\n      // During workflow loading - defer layout initialization until configure completes\n      // Chain our callback with any existing onAfterGraphConfigured callback\n      node.onAfterGraphConfigured = useChainCallback(\n        node.onAfterGraphConfigured,\n        () => {\n          // Re-extract data now that configure() has populated title/slots/widgets/etc.\n          vueNodeData.set(id, extractVueNodeData(node))\n          initializeVueNodeLayout()\n        }\n      )\n    } else {\n      // Not during workflow loading - initialize layout immediately\n      // This handles individual node additions during normal operation\n      initializeVueNodeLayout()\n    }\n\n    // Call original callback if provided\n    if (originalCallback) {\n      void originalCallback(node)\n    }\n  }\n\n  /**\n   * Handles node removal from the graph - cleans up all references\n   */\n  const handleNodeRemoved = (\n    node: LGraphNode,\n    originalCallback?: (node: LGraphNode) => void\n  ) => {\n    const id = String(node.id)\n\n    // Remove node from layout store\n    setSource(LayoutSource.Canvas)\n    void deleteNode(id)\n\n    // Clean up all tracking references\n    nodeRefs.delete(id)\n    vueNodeData.delete(id)\n\n    // Call original callback if provided\n    if (originalCallback) {\n      originalCallback(node)\n    }\n  }\n\n  /**\n   * Creates cleanup function for event listeners and state\n   */\n  const createCleanupFunction = (\n    originalOnNodeAdded: ((node: LGraphNode) => void) | undefined,\n    originalOnNodeRemoved: ((node: LGraphNode) => void) | undefined,\n    originalOnTrigger: ((event: LGraphTriggerEvent) => void) | undefined\n  ) => {\n    return () => {\n      // Restore original callbacks\n      graph.onNodeAdded = originalOnNodeAdded || undefined\n      graph.onNodeRemoved = originalOnNodeRemoved || undefined\n      graph.onTrigger = originalOnTrigger || undefined\n\n      // Clear all state maps\n      nodeRefs.clear()\n      vueNodeData.clear()\n    }\n  }\n\n  /**\n   * Sets up event listeners - now simplified with extracted handlers\n   */\n  const setupEventListeners = (): (() => void) => {\n    // Store original callbacks\n    const originalOnNodeAdded = graph.onNodeAdded\n    const originalOnNodeRemoved = graph.onNodeRemoved\n    const originalOnTrigger = graph.onTrigger\n\n    // Set up graph event handlers\n    graph.onNodeAdded = (node: LGraphNode) => {\n      handleNodeAdded(node, originalOnNodeAdded)\n    }\n\n    graph.onNodeRemoved = (node: LGraphNode) => {\n      handleNodeRemoved(node, originalOnNodeRemoved)\n    }\n\n    const triggerHandlers: {\n      [K in LGraphTriggerAction]: (event: LGraphTriggerParam<K>) => void\n    } = {\n      'node:property:changed': (propertyEvent) => {\n        const nodeId = String(propertyEvent.nodeId)\n        const currentData = vueNodeData.get(nodeId)\n\n        if (currentData) {\n          switch (propertyEvent.property) {\n            case 'title':\n              vueNodeData.set(nodeId, {\n                ...currentData,\n                title: String(propertyEvent.newValue)\n              })\n              break\n            case 'flags.collapsed':\n              vueNodeData.set(nodeId, {\n                ...currentData,\n                flags: {\n                  ...currentData.flags,\n                  collapsed: Boolean(propertyEvent.newValue)\n                }\n              })\n              break\n            case 'flags.pinned':\n              vueNodeData.set(nodeId, {\n                ...currentData,\n                flags: {\n                  ...currentData.flags,\n                  pinned: Boolean(propertyEvent.newValue)\n                }\n              })\n              break\n            case 'mode':\n              vueNodeData.set(nodeId, {\n                ...currentData,\n                mode:\n                  typeof propertyEvent.newValue === 'number'\n                    ? propertyEvent.newValue\n                    : 0\n              })\n              break\n            case 'color':\n              vueNodeData.set(nodeId, {\n                ...currentData,\n                color:\n                  typeof propertyEvent.newValue === 'string'\n                    ? propertyEvent.newValue\n                    : undefined\n              })\n              break\n            case 'bgcolor':\n              vueNodeData.set(nodeId, {\n                ...currentData,\n                bgcolor:\n                  typeof propertyEvent.newValue === 'string'\n                    ? propertyEvent.newValue\n                    : undefined\n              })\n              break\n            case 'shape':\n              vueNodeData.set(nodeId, {\n                ...currentData,\n                shape:\n                  typeof propertyEvent.newValue === 'number'\n                    ? propertyEvent.newValue\n                    : undefined\n              })\n          }\n        }\n      },\n      'node:slot-errors:changed': (slotErrorsEvent) => {\n        refreshNodeSlots(String(slotErrorsEvent.nodeId))\n      },\n      'node:slot-links:changed': (slotLinksEvent) => {\n        if (slotLinksEvent.slotType === NodeSlotType.INPUT) {\n          refreshNodeSlots(String(slotLinksEvent.nodeId))\n        }\n      }\n    }\n\n    graph.onTrigger = (event: LGraphTriggerEvent) => {\n      switch (event.type) {\n        case 'node:property:changed':\n          triggerHandlers['node:property:changed'](event)\n          break\n        case 'node:slot-errors:changed':\n          triggerHandlers['node:slot-errors:changed'](event)\n          break\n        case 'node:slot-links:changed':\n          triggerHandlers['node:slot-links:changed'](event)\n          break\n      }\n\n      // Chain to original handler\n      originalOnTrigger?.(event)\n    }\n\n    // Initialize state\n    syncWithGraph()\n\n    // Return cleanup function\n    return createCleanupFunction(\n      originalOnNodeAdded || undefined,\n      originalOnNodeRemoved || undefined,\n      originalOnTrigger || undefined\n    )\n  }\n\n  // Set up event listeners immediately\n  const cleanup = setupEventListeners()\n\n  // Process any existing nodes after event listeners are set up\n  if (graph._nodes && graph._nodes.length > 0) {\n    graph._nodes.forEach((node: LGraphNode) => {\n      if (graph.onNodeAdded) {\n        graph.onNodeAdded(node)\n      }\n    })\n  }\n\n  return {\n    vueNodeData,\n    getNode,\n    cleanup\n  }\n}\n","<script lang=\"ts\" setup>\nimport { cn } from '@/utils/tailwindUtil'\n\ndefineProps<{\n  isEmpty?: boolean\n}>()\n\nconst isCollapse = defineModel<boolean>('collapse', { default: false })\n</script>\n\n<template>\n  <div class=\"flex flex-col bg-interface-panel-surface\">\n    <div\n      class=\"sticky top-0 z-10 flex items-center justify-between backdrop-blur-xl bg-inherit\"\n    >\n      <button\n        v-tooltip=\"\n          isEmpty\n            ? {\n                value: $t('rightSidePanel.inputsNoneTooltip'),\n                showDelay: 1_000\n              }\n            : undefined\n        \"\n        type=\"button\"\n        :class=\"\n          cn(\n            'group min-h-12 bg-transparent border-0 outline-0 ring-0 w-full text-left flex items-center justify-between pl-4 pr-3',\n            !isEmpty && 'cursor-pointer'\n          )\n        \"\n        :disabled=\"isEmpty\"\n        @click=\"isCollapse = !isCollapse\"\n      >\n        <span class=\"text-sm font-semibold line-clamp-2\">\n          <slot name=\"label\" />\n        </span>\n\n        <i\n          v-if=\"!isEmpty\"\n          :class=\"\n            cn(\n              'text-muted-foreground group-hover:text-base-foreground group-focus:text-base-foreground icon-[lucide--chevron-up] size-4 transition-all',\n              isCollapse && '-rotate-180'\n            )\n          \"\n        />\n      </button>\n    </div>\n    <div v-if=\"!isCollapse && !isEmpty\" class=\"pb-4\">\n      <slot />\n    </div>\n  </div>\n</template>\n","<script setup lang=\"ts\">\nimport { computed, provide } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport { useReactiveWidgetValue } from '@/composables/graph/useGraphNodeManager'\nimport type { LGraphNode } from '@/lib/litegraph/src/litegraph'\nimport type { IBaseWidget } from '@/lib/litegraph/src/types/widgets'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport WidgetLegacy from '@/renderer/extensions/vueNodes/widgets/components/WidgetLegacy.vue'\nimport {\n  getComponent,\n  shouldExpand\n} from '@/renderer/extensions/vueNodes/widgets/registry/widgetRegistry'\nimport { cn } from '@/utils/tailwindUtil'\n\nimport PropertiesAccordionItem from '../layout/PropertiesAccordionItem.vue'\n\nconst { label, widgets } = defineProps<{\n  label?: string\n  widgets: { widget: IBaseWidget; node: LGraphNode }[]\n}>()\n\nprovide('hideLayoutField', true)\n\nconst canvasStore = useCanvasStore()\nconst { t } = useI18n()\n\nfunction getWidgetComponent(widget: IBaseWidget) {\n  const component = getComponent(widget.type, widget.name)\n  return component || WidgetLegacy\n}\n\nfunction onWidgetValueChange(\n  widget: IBaseWidget,\n  value: string | number | boolean | object\n) {\n  widget.value = value\n  widget.callback?.(value)\n  canvasStore.canvas?.setDirty(true, true)\n}\n\nconst isEmpty = computed(() => widgets.length === 0)\n\nconst displayLabel = computed(\n  () =>\n    label ??\n    (isEmpty.value\n      ? t('rightSidePanel.inputsNone')\n      : t('rightSidePanel.inputs'))\n)\n</script>\n\n<template>\n  <PropertiesAccordionItem :is-empty>\n    <template #label>\n      <slot name=\"label\">\n        {{ displayLabel }}\n      </slot>\n    </template>\n\n    <div v-if=\"!isEmpty\" class=\"space-y-4 rounded-lg bg-interface-surface px-4\">\n      <div\n        v-for=\"({ widget, node }, index) in widgets\"\n        :key=\"`widget-${index}-${widget.name}`\"\n        class=\"widget-item gap-1.5 col-span-full grid grid-cols-subgrid\"\n      >\n        <div class=\"min-h-8\">\n          <p v-if=\"widget.name\" class=\"text-sm leading-8 p-0 m-0 line-clamp-1\">\n            {{ widget.label || widget.name }}\n          </p>\n        </div>\n        <component\n          :is=\"getWidgetComponent(widget)\"\n          :widget=\"widget\"\n          :model-value=\"useReactiveWidgetValue(widget)\"\n          :node-id=\"String(node.id)\"\n          :node-type=\"node.type\"\n          :class=\"cn('col-span-1', shouldExpand(widget.type) && 'min-h-36')\"\n          @update:model-value=\"\n            (value: string | number | boolean | object) =>\n              onWidgetValueChange(widget, value)\n          \"\n        />\n      </div>\n    </div>\n  </PropertiesAccordionItem>\n</template>\n","<script setup lang=\"ts\">\nimport { computed, shallowRef } from 'vue'\n\nimport type { LGraphNode } from '@/lib/litegraph/src/litegraph'\nimport type { IBaseWidget } from '@/lib/litegraph/src/types/widgets'\n\nimport SidePanelSearch from '../layout/SidePanelSearch.vue'\nimport SectionWidgets from './SectionWidgets.vue'\n\nconst { nodes } = defineProps<{\n  nodes: LGraphNode[]\n}>()\n\ntype NodeWidgetsList = Array<{ node: LGraphNode; widget: IBaseWidget }>\ntype NodeWidgetsListList = Array<{\n  node: LGraphNode\n  widgets: NodeWidgetsList\n}>\n\nconst widgetsSectionDataList = computed((): NodeWidgetsListList => {\n  return nodes.map((node) => {\n    const { widgets = [] } = node\n    const shownWidgets = widgets\n      .filter((w) => !(w.options?.canvasOnly || w.options?.hidden))\n      .map((widget) => ({ node, widget }))\n    return {\n      widgets: shownWidgets,\n      node\n    }\n  })\n})\n\nconst searchedWidgetsSectionDataList = shallowRef<NodeWidgetsListList>([])\n\n/**\n * Searches widgets in all selected nodes and returns search results.\n * Filters by name, localized label, type, and user-input value.\n * Performs basic tokenization of the query string.\n */\nasync function searcher(query: string) {\n  if (query.trim() === '') {\n    searchedWidgetsSectionDataList.value = widgetsSectionDataList.value\n    return\n  }\n  const words = query.trim().toLowerCase().split(' ')\n  searchedWidgetsSectionDataList.value = widgetsSectionDataList.value\n    .map((item) => {\n      return {\n        ...item,\n        widgets: item.widgets.filter(({ widget }) => {\n          const label = widget.label?.toLowerCase()\n          const name = widget.name.toLowerCase()\n          const type = widget.type.toLowerCase()\n          const value = widget.value?.toString().toLowerCase()\n          return words.every(\n            (word) =>\n              name.includes(word) ||\n              label?.includes(word) ||\n              type?.includes(word) ||\n              value?.includes(word)\n          )\n        })\n      }\n    })\n    .filter((item) => item.widgets.length > 0)\n}\n</script>\n\n<template>\n  <div class=\"px-4 pb-4 flex gap-2 border-b border-interface-stroke\">\n    <SidePanelSearch :searcher :update-key=\"widgetsSectionDataList\" />\n  </div>\n  <SectionWidgets\n    v-for=\"section in searchedWidgetsSectionDataList\"\n    :key=\"section.node.id\"\n    :label=\"widgetsSectionDataList.length > 1 ? section.node.title : undefined\"\n    :widgets=\"section.widgets\"\n    :default-collapse=\"\n      widgetsSectionDataList.length > 1 &&\n      widgetsSectionDataList === searchedWidgetsSectionDataList\n    \"\n    class=\"border-b border-interface-stroke\"\n  />\n</template>\n","<template>\n  <div\n    :class=\"\n      cn(\n        WidgetInputBaseClass,\n        'p-1 inline-flex justify-center items-center gap-1'\n      )\n    \"\n  >\n    <button\n      v-for=\"(option, index) in options\"\n      :key=\"getOptionValue(option, index)\"\n      :class=\"\n        cn(\n          'flex-1 h-6 px-5 py-[5px] rounded flex justify-center items-center gap-1 transition-all duration-150 ease-in-out truncate min-w-[4ch]',\n          'bg-transparent border-none',\n          'text-center text-xs font-normal',\n          {\n            'bg-interface-menu-component-surface-selected':\n              isSelected(index) && !disabled,\n            'hover:bg-interface-menu-component-surface-selected/50':\n              !isSelected(index) && !disabled,\n            'opacity-50 cursor-not-allowed': disabled,\n            'cursor-pointer': !disabled\n          },\n          isSelected(index) && !disabled\n            ? 'text-text-primary'\n            : 'text-text-secondary'\n        )\n      \"\n      :disabled=\"disabled\"\n      @click=\"handleSelect(index)\"\n    >\n      {{ getOptionLabel(option) }}\n    </button>\n  </div>\n</template>\n\n<script\n  setup\n  lang=\"ts\"\n  generic=\"\n    T extends string | number | { label: string; value: string | number }\n  \"\n>\nimport { cn } from '@/utils/tailwindUtil'\n\nimport { WidgetInputBaseClass } from '../layout'\n\ntype ModelValue = T extends object ? T['value'] : T\n\ninterface Props {\n  modelValue: ModelValue | null | undefined\n  options: T[]\n  optionLabel?: string // PrimeVue compatible prop\n  optionValue?: string // PrimeVue compatible prop\n  disabled?: boolean\n}\n\ninterface Emits {\n  'update:modelValue': [value: ModelValue]\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  disabled: false,\n  optionLabel: 'label',\n  optionValue: 'value'\n})\n\nconst emit = defineEmits<Emits>()\n\n// handle both string/number arrays and object arrays with PrimeVue compatibility\nconst getOptionValue = (option: T, index: number): ModelValue => {\n  if (typeof option !== 'object') {\n    return option as ModelValue\n  }\n\n  const valueField = props.optionValue\n  const value =\n    (option as any)[valueField] ??\n    option.value ??\n    (option as any).name ??\n    option.label ??\n    index\n  return value\n}\n\n// for display with PrimeVue compatibility\nconst getOptionLabel = (option: T): string => {\n  if (typeof option === 'object' && option !== null) {\n    const labelField = props.optionLabel\n    return (\n      (option as any)[labelField] ??\n      option.label ??\n      (option as any).name ??\n      option.value ??\n      String(option)\n    )\n  }\n  return String(option)\n}\n\nconst isSelected = (index: number): boolean => {\n  const optionValue = getOptionValue(props.options[index], index)\n  return String(optionValue) === String(props.modelValue ?? '')\n}\n\nconst handleSelect = (index: number) => {\n  if (props.disabled) return\n\n  const optionValue = getOptionValue(props.options[index], index)\n  emit('update:modelValue', optionValue)\n}\n</script>\n","<template>\n  <div class=\"space-y-4 p-3 text-sm text-muted-foreground\">\n    <!-- Node State -->\n    <div class=\"flex flex-col gap-2\">\n      <span>\n        {{ t('rightSidePanel.nodeState') }}\n      </span>\n      <FormSelectButton\n        v-model=\"nodeState\"\n        class=\"w-full\"\n        :options=\"[\n          {\n            label: t('rightSidePanel.normal'),\n            value: LGraphEventMode.ALWAYS\n          },\n          {\n            label: t('rightSidePanel.bypass'),\n            value: LGraphEventMode.BYPASS\n          },\n          {\n            label: t('rightSidePanel.mute'),\n            value: LGraphEventMode.NEVER\n          }\n        ]\"\n      />\n    </div>\n\n    <!-- Color Picker -->\n    <div class=\"flex flex-col gap-2\">\n      <span>\n        {{ t('rightSidePanel.color') }}\n      </span>\n      <div\n        class=\"bg-secondary-background border-none rounded-lg p-1 grid grid-cols-5 gap-1 justify-items-center\"\n      >\n        <button\n          v-for=\"option of colorOptions\"\n          :key=\"option.name\"\n          :class=\"\n            cn(\n              'size-8 rounded-lg bg-transparent border-0 outline-0 ring-0 text-left flex justify-center items-center cursor-pointer',\n              option.name === nodeColor\n                ? 'bg-interface-menu-component-surface-selected'\n                : 'hover:bg-interface-menu-component-surface-selected'\n            )\n          \"\n          @click=\"nodeColor = option.name\"\n        >\n          <div\n            v-tooltip.top=\"option.localizedName()\"\n            :class=\"cn('size-4 rounded-full ring-2 ring-gray-500/10')\"\n            :style=\"{\n              backgroundColor: isLightTheme\n                ? option.value.light\n                : option.value.dark,\n              '--tw-ring-color':\n                option.name === nodeColor\n                  ? isLightTheme\n                    ? option.value.ringLight\n                    : option.value.ringDark\n                  : undefined\n            }\"\n            :data-testid=\"option.name\"\n          />\n        </button>\n      </div>\n    </div>\n\n    <!-- Pinned Toggle -->\n    <div class=\"flex items-center justify-between\">\n      <span>\n        {{ t('rightSidePanel.pinned') }}\n      </span>\n      <ToggleSwitch v-model=\"isPinned\" />\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport ToggleSwitch from 'primevue/toggleswitch'\nimport { computed, shallowRef, triggerRef, watchEffect } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport { LGraphCanvas, LiteGraph } from '@/lib/litegraph/src/litegraph'\nimport type { ColorOption, LGraphNode } from '@/lib/litegraph/src/litegraph'\nimport { LGraphEventMode } from '@/lib/litegraph/src/types/globalEnums'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport FormSelectButton from '@/renderer/extensions/vueNodes/widgets/components/form/FormSelectButton.vue'\nimport { useColorPaletteStore } from '@/stores/workspace/colorPaletteStore'\nimport { adjustColor } from '@/utils/colorUtil'\nimport { cn } from '@/utils/tailwindUtil'\n\nconst props = defineProps<{\n  nodes?: LGraphNode[]\n}>()\n\n/**\n * This is not random writing. It is very important.\n * Otherwise, the UI cannot be updated correctly.\n */\nconst targetNodes = shallowRef<LGraphNode[]>([])\nwatchEffect(() => {\n  if (props.nodes) {\n    targetNodes.value = props.nodes\n  } else {\n    targetNodes.value = []\n  }\n})\n\nconst { t } = useI18n()\n\nconst canvasStore = useCanvasStore()\nconst colorPaletteStore = useColorPaletteStore()\nconst isLightTheme = computed(\n  () => colorPaletteStore.completedActivePalette.light_theme\n)\n\nconst nodeState = computed({\n  get() {\n    let mode: LGraphNode['mode'] | null = null\n    const nodes = targetNodes.value\n\n    if (nodes.length === 0) return null\n\n    // For multiple nodes, if all nodes have the same mode, return that mode, otherwise return null\n    if (nodes.length > 1) {\n      mode = nodes[0].mode\n      if (!nodes.every((node) => node.mode === mode)) {\n        mode = null\n      }\n    } else {\n      mode = nodes[0].mode\n    }\n\n    return mode\n  },\n  set(value: LGraphNode['mode']) {\n    targetNodes.value.forEach((node) => {\n      node.mode = value\n    })\n    /*\n     * This is not random writing. It is very important.\n     * Otherwise, the UI cannot be updated correctly.\n     */\n    triggerRef(targetNodes)\n    canvasStore.canvas?.setDirty(true, true)\n  }\n})\n\n// Pinned state\nconst isPinned = computed<boolean>({\n  get() {\n    return targetNodes.value.some((node) => node.pinned)\n  },\n  set(value) {\n    targetNodes.value.forEach((node) => node.pin(value))\n    /*\n     * This is not random writing. It is very important.\n     * Otherwise, the UI cannot be updated correctly.\n     */\n    triggerRef(targetNodes)\n    canvasStore.canvas?.setDirty(true, true)\n  }\n})\n\ntype NodeColorOption = {\n  name: string\n  localizedName: () => string\n  value: {\n    dark: string\n    light: string\n    ringDark: string\n    ringLight: string\n  }\n}\n\nfunction getColorValue(color: string): NodeColorOption['value'] {\n  return {\n    dark: adjustColor(color, { lightness: 0.3 }),\n    light: adjustColor(color, { lightness: 0.4 }),\n    ringDark: adjustColor(color, { lightness: 0.5 }),\n    ringLight: adjustColor(color, { lightness: 0.1 })\n  }\n}\n\nconst NO_COLOR_OPTION: NodeColorOption = {\n  name: 'noColor',\n  localizedName: () => t('color.noColor'),\n  value: getColorValue(LiteGraph.NODE_DEFAULT_BGCOLOR)\n}\n\nconst nodeColorEntries = Object.entries(LGraphCanvas.node_colors)\n\nconst colorOptions: NodeColorOption[] = [\n  NO_COLOR_OPTION,\n  ...nodeColorEntries.map(([name, color]) => ({\n    name,\n    localizedName: () => t(`color.${name}`),\n    value: getColorValue(color.bgcolor)\n  }))\n]\n\nconst nodeColor = computed<NodeColorOption['name'] | null>({\n  get() {\n    if (targetNodes.value.length === 0) return null\n    const theColorOptions = targetNodes.value.map((item) =>\n      item.getColorOption()\n    )\n\n    let colorOption: ColorOption | null | false = theColorOptions[0]\n    if (!theColorOptions.every((option) => option === colorOption)) {\n      colorOption = false\n    }\n\n    if (colorOption === false) return null\n    if (colorOption == null || (!colorOption.bgcolor && !colorOption.color))\n      return NO_COLOR_OPTION.name\n    return (\n      nodeColorEntries.find(\n        ([_, color]) =>\n          color.bgcolor === colorOption.bgcolor &&\n          color.color === colorOption.color\n      )?.[0] ?? null\n    )\n  },\n  set(colorName) {\n    if (colorName === null) return\n\n    const canvasColorOption =\n      colorName === NO_COLOR_OPTION.name\n        ? null\n        : LGraphCanvas.node_colors[colorName]\n\n    for (const item of targetNodes.value) {\n      item.setColorOption(canvasColorOption)\n    }\n    /*\n     * This is not random writing. It is very important.\n     * Otherwise, the UI cannot be updated correctly.\n     */\n    triggerRef(targetNodes)\n    canvasStore.canvas?.setDirty(true, true)\n  }\n})\n</script>\n","<script setup lang=\"ts\">\nimport Button from '@/components/ui/button/Button.vue'\nimport { cn } from '@/utils/tailwindUtil'\nimport type { ClassValue } from '@/utils/tailwindUtil'\n\nconst props = defineProps<{\n  nodeTitle: string\n  widgetName: string\n  isDraggable?: boolean\n  isPhysical?: boolean\n  class?: ClassValue\n}>()\ndefineEmits<{\n  (e: 'toggleVisibility'): void\n}>()\n\nfunction getIcon() {\n  return props.isPhysical\n    ? 'icon-[lucide--link]'\n    : props.isDraggable\n      ? 'icon-[lucide--eye]'\n      : 'icon-[lucide--eye-off]'\n}\n</script>\n\n<template>\n  <div\n    :class=\"\n      cn(\n        'flex py-1 px-2 break-all rounded items-center gap-1',\n        'bg-node-component-surface',\n        props.isDraggable &&\n          'draggable-item drag-handle cursor-grab [&.is-draggable]:cursor-grabbing hover:ring-1 ring-accent-background',\n        props.class\n      )\n    \"\n  >\n    <div class=\"pointer-events-none flex-1\">\n      <div class=\"text-xs text-text-secondary line-clamp-1\">\n        {{ nodeTitle }}\n      </div>\n      <div class=\"text-sm line-clamp-1 leading-8\">{{ widgetName }}</div>\n    </div>\n    <Button\n      variant=\"muted-textonly\"\n      size=\"sm\"\n      :disabled=\"isPhysical\"\n      @click.stop=\"$emit('toggleVisibility')\"\n    >\n      <i :class=\"getIcon()\" />\n    </Button>\n    <div\n      v-if=\"isDraggable\"\n      class=\"size-4 pointer-events-none icon-[lucide--grip-vertical]\"\n    />\n  </div>\n</template>\n","<script setup lang=\"ts\">\nimport { watchDebounced } from '@vueuse/core'\nimport {\n  computed,\n  customRef,\n  onBeforeUnmount,\n  onMounted,\n  ref,\n  triggerRef\n} from 'vue'\n\nimport Button from '@/components/ui/button/Button.vue'\nimport {\n  demoteWidget,\n  isRecommendedWidget,\n  matchesPropertyItem,\n  matchesWidgetItem,\n  promoteWidget,\n  pruneDisconnected,\n  widgetItemToProperty\n} from '@/core/graph/subgraph/proxyWidgetUtils'\nimport type { WidgetItem } from '@/core/graph/subgraph/proxyWidgetUtils'\nimport { parseProxyWidgets } from '@/core/schemas/proxyWidget'\nimport type { ProxyWidgetsProperty } from '@/core/schemas/proxyWidget'\nimport type { LGraphNode } from '@/lib/litegraph/src/litegraph'\nimport { SubgraphNode } from '@/lib/litegraph/src/subgraph/SubgraphNode'\nimport type { IBaseWidget } from '@/lib/litegraph/src/types/widgets'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { DraggableList } from '@/scripts/ui/draggableList'\nimport { useLitegraphService } from '@/services/litegraphService'\n\nimport SidePanelSearch from '../layout/SidePanelSearch.vue'\nimport SubgraphNodeWidget from './SubgraphNodeWidget.vue'\n\nconst canvasStore = useCanvasStore()\n\nconst draggableList = ref<DraggableList | undefined>(undefined)\nconst draggableItems = ref()\nconst searchQuery = ref<string>('')\nconst proxyWidgets = customRef<ProxyWidgetsProperty>((track, trigger) => ({\n  get() {\n    track()\n    const node = activeNode.value\n    if (!node) return []\n    return parseProxyWidgets(node.properties.proxyWidgets)\n  },\n  set(value?: ProxyWidgetsProperty) {\n    trigger()\n    const node = activeNode.value\n    if (!value) return\n    if (!node) {\n      console.error('Attempted to toggle widgets with no node selected')\n      return\n    }\n    node.properties.proxyWidgets = value\n  }\n}))\n\nasync function searcher(query: string) {\n  searchQuery.value = query\n}\n\nconst activeNode = computed(() => {\n  const node = canvasStore.selectedItems[0]\n  if (node instanceof SubgraphNode) return node\n  return undefined\n})\n\nconst activeWidgets = computed<WidgetItem[]>({\n  get() {\n    if (!activeNode.value) return []\n    const node = activeNode.value\n    function mapWidgets([id, name]: [string, string]): WidgetItem[] {\n      if (id === '-1') {\n        const widget = node.widgets.find((w) => w.name === name)\n        if (!widget) return []\n        return [[{ id: -1, title: '(Linked)', type: '' }, widget]]\n      }\n      const wNode = node.subgraph._nodes_by_id[id]\n      if (!wNode?.widgets) return []\n      const widget = wNode.widgets.find((w) => w.name === name)\n      if (!widget) return []\n      return [[wNode, widget]]\n    }\n    return proxyWidgets.value.flatMap(mapWidgets)\n  },\n  set(value: WidgetItem[]) {\n    const node = activeNode.value\n    if (!node) {\n      console.error('Attempted to toggle widgets with no node selected')\n      return\n    }\n    proxyWidgets.value = value.map(widgetItemToProperty)\n  }\n})\n\nconst interiorWidgets = computed<WidgetItem[]>(() => {\n  const node = activeNode.value\n  if (!node) return []\n  const { updatePreviews } = useLitegraphService()\n  const interiorNodes = node.subgraph.nodes\n  for (const node of interiorNodes) {\n    node.updateComputedDisabled()\n    updatePreviews(node)\n  }\n  return interiorNodes\n    .flatMap(nodeWidgets)\n    .filter(([_, w]: WidgetItem) => !w.computedDisabled)\n})\n\nconst candidateWidgets = computed<WidgetItem[]>(() => {\n  const node = activeNode.value\n  if (!node) return []\n  const widgets = proxyWidgets.value\n  return interiorWidgets.value.filter(\n    (widgetItem: WidgetItem) => !widgets.some(matchesPropertyItem(widgetItem))\n  )\n})\nconst filteredCandidates = computed<WidgetItem[]>(() => {\n  const query = searchQuery.value.toLowerCase()\n  if (!query) return candidateWidgets.value\n  return candidateWidgets.value.filter(\n    ([n, w]: WidgetItem) =>\n      n.title.toLowerCase().includes(query) ||\n      w.name.toLowerCase().includes(query)\n  )\n})\n\nconst recommendedWidgets = computed(() => {\n  const node = activeNode.value\n  if (!node) return []\n  return filteredCandidates.value.filter(isRecommendedWidget)\n})\n\nconst filteredActive = computed<WidgetItem[]>(() => {\n  const query = searchQuery.value.toLowerCase()\n  if (!query) return activeWidgets.value\n  return activeWidgets.value.filter(\n    ([n, w]: WidgetItem) =>\n      n.title.toLowerCase().includes(query) ||\n      w.name.toLowerCase().includes(query)\n  )\n})\n\nfunction toKey(item: WidgetItem) {\n  return `${item[0].id}: ${item[1].name}`\n}\nfunction nodeWidgets(n: LGraphNode): WidgetItem[] {\n  if (!n.widgets) return []\n  return n.widgets.map((w: IBaseWidget) => [n, w])\n}\nfunction demote([node, widget]: WidgetItem) {\n  const subgraphNode = activeNode.value\n  if (!subgraphNode) return []\n  demoteWidget(node, widget, [subgraphNode])\n  triggerRef(proxyWidgets)\n}\nfunction promote([node, widget]: WidgetItem) {\n  const subgraphNode = activeNode.value\n  if (!subgraphNode) return []\n  promoteWidget(node, widget, [subgraphNode])\n  triggerRef(proxyWidgets)\n}\nfunction showAll() {\n  const node = activeNode.value\n  if (!node) return\n  const widgets = proxyWidgets.value\n  const toAdd: ProxyWidgetsProperty =\n    filteredCandidates.value.map(widgetItemToProperty)\n  widgets.push(...toAdd)\n  proxyWidgets.value = widgets\n}\nfunction hideAll() {\n  const node = activeNode.value\n  if (!node) return\n  proxyWidgets.value = proxyWidgets.value.filter(\n    (propertyItem) =>\n      !filteredActive.value.some(matchesWidgetItem(propertyItem)) ||\n      propertyItem[0] === '-1'\n  )\n}\nfunction showRecommended() {\n  const node = activeNode.value\n  if (!node) return\n  const widgets = proxyWidgets.value\n  const toAdd: ProxyWidgetsProperty =\n    recommendedWidgets.value.map(widgetItemToProperty)\n  widgets.push(...toAdd)\n  proxyWidgets.value = widgets\n}\n\nfunction setDraggableState() {\n  draggableList.value?.dispose()\n  if (searchQuery.value || !draggableItems.value?.children?.length) return\n  draggableList.value = new DraggableList(\n    draggableItems.value,\n    '.draggable-item'\n  )\n  draggableList.value.applyNewItemsOrder = function () {\n    const reorderedItems = []\n\n    let oldPosition = -1\n    this.getAllItems().forEach((item, index) => {\n      if (item === this.draggableItem) {\n        oldPosition = index\n        return\n      }\n      if (!this.isItemToggled(item)) {\n        reorderedItems[index] = item\n        return\n      }\n      const newIndex = this.isItemAbove(item) ? index + 1 : index - 1\n      reorderedItems[newIndex] = item\n    })\n\n    for (let index = 0; index < this.getAllItems().length; index++) {\n      const item = reorderedItems[index]\n      if (typeof item === 'undefined') {\n        reorderedItems[index] = this.draggableItem\n      }\n    }\n    const newPosition = reorderedItems.indexOf(this.draggableItem)\n    const aw = activeWidgets.value\n    const [w] = aw.splice(oldPosition, 1)\n    aw.splice(newPosition, 0, w)\n    activeWidgets.value = aw\n  }\n}\nwatchDebounced(\n  filteredActive,\n  () => {\n    setDraggableState()\n  },\n  { debounce: 100 }\n)\nonMounted(() => {\n  setDraggableState()\n  if (activeNode.value) pruneDisconnected(activeNode.value)\n})\nonBeforeUnmount(() => {\n  draggableList.value?.dispose()\n})\n</script>\n\n<template>\n  <div v-if=\"activeNode\" class=\"subgraph-edit-section flex h-full flex-col\">\n    <div class=\"p-4 flex gap-2\">\n      <SidePanelSearch :searcher />\n    </div>\n\n    <div class=\"flex-1\">\n      <div\n        v-if=\"filteredActive.length\"\n        class=\"flex flex-col border-t border-interface-stroke\"\n      >\n        <div\n          class=\"sticky top-0 z-10 flex items-center justify-between backdrop-blur-xl min-h-12 px-4\"\n        >\n          <div class=\"text-sm font-semibold uppercase line-clamp-1\">\n            {{ $t('subgraphStore.shown') }}\n          </div>\n          <a\n            class=\"cursor-pointer text-right text-xs font-normal text-text-secondary hover:text-azure-600 whitespace-nowrap\"\n            @click.stop=\"hideAll\"\n          >\n            {{ $t('subgraphStore.hideAll') }}</a\n          >\n        </div>\n        <div ref=\"draggableItems\" class=\"pb-2 px-2 space-y-0.5 mt-0.5\">\n          <SubgraphNodeWidget\n            v-for=\"[node, widget] in filteredActive\"\n            :key=\"toKey([node, widget])\"\n            class=\"bg-interface-panel-surface\"\n            :node-title=\"node.title\"\n            :widget-name=\"widget.name\"\n            :is-shown=\"true\"\n            :is-draggable=\"!searchQuery\"\n            :is-physical=\"node.id === -1\"\n            @toggle-visibility=\"demote([node, widget])\"\n          />\n        </div>\n      </div>\n\n      <div\n        v-if=\"filteredCandidates.length\"\n        class=\"flex flex-col border-t border-interface-stroke\"\n      >\n        <div\n          class=\"sticky top-0 z-10 flex items-center justify-between backdrop-blur-xl min-h-12 px-4\"\n        >\n          <div class=\"text-sm font-semibold uppercase line-clamp-1\">\n            {{ $t('subgraphStore.hidden') }}\n          </div>\n          <a\n            class=\"cursor-pointer text-right text-xs font-normal text-text-secondary hover:text-azure-600 whitespace-nowrap\"\n            @click.stop=\"showAll\"\n          >\n            {{ $t('subgraphStore.showAll') }}</a\n          >\n        </div>\n        <div class=\"pb-2 px-2 space-y-0.5 mt-0.5\">\n          <SubgraphNodeWidget\n            v-for=\"[node, widget] in filteredCandidates\"\n            :key=\"toKey([node, widget])\"\n            class=\"bg-interface-panel-surface\"\n            :node-title=\"node.title\"\n            :widget-name=\"widget.name\"\n            @toggle-visibility=\"promote([node, widget])\"\n          />\n        </div>\n      </div>\n\n      <div\n        v-if=\"recommendedWidgets.length\"\n        class=\"flex justify-center border-t border-interface-stroke py-4\"\n      >\n        <Button\n          size=\"sm\"\n          class=\"rounded border-none px-3 py-0.5\"\n          @click.stop=\"showRecommended\"\n        >\n          {{ $t('subgraphStore.showRecommended') }}\n        </Button>\n      </div>\n    </div>\n  </div>\n</template>\n","<script setup lang=\"ts\">\nimport { storeToRefs } from 'pinia'\nimport { computed, ref, toValue, watchEffect } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport EditableText from '@/components/common/EditableText.vue'\nimport Tab from '@/components/tab/Tab.vue'\nimport TabList from '@/components/tab/TabList.vue'\nimport Button from '@/components/ui/button/Button.vue'\nimport { SubgraphNode } from '@/lib/litegraph/src/litegraph'\nimport type { LGraphNode } from '@/lib/litegraph/src/litegraph'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useRightSidePanelStore } from '@/stores/workspace/rightSidePanelStore'\nimport type { RightSidePanelTab } from '@/stores/workspace/rightSidePanelStore'\nimport { isLGraphNode } from '@/utils/litegraphUtil'\nimport { cn } from '@/utils/tailwindUtil'\n\nimport TabInfo from './info/TabInfo.vue'\nimport TabParameters from './parameters/TabParameters.vue'\nimport TabSettings from './settings/TabSettings.vue'\nimport SubgraphEditor from './subgraph/SubgraphEditor.vue'\n\nconst canvasStore = useCanvasStore()\nconst rightSidePanelStore = useRightSidePanelStore()\nconst settingStore = useSettingStore()\nconst { t } = useI18n()\n\nconst { selectedItems } = storeToRefs(canvasStore)\nconst { activeTab, isEditingSubgraph } = storeToRefs(rightSidePanelStore)\n\nconst sidebarLocation = computed<'left' | 'right'>(() =>\n  settingStore.get('Comfy.Sidebar.Location')\n)\n\n// Panel is on the left when sidebar is on the right, and vice versa\nconst panelIcon = computed(() =>\n  sidebarLocation.value === 'right'\n    ? 'icon-[lucide--panel-left]'\n    : 'icon-[lucide--panel-right]'\n)\n\nconst hasSelection = computed(() => selectedItems.value.length > 0)\n\nconst selectedNodes = computed((): LGraphNode[] => {\n  return selectedItems.value.filter(isLGraphNode)\n})\n\nconst isSubgraphNode = computed(() => {\n  return selectedNode.value instanceof SubgraphNode\n})\n\nconst isSingleNodeSelected = computed(() => selectedNodes.value.length === 1)\n\nconst selectedNode = computed(() => {\n  return isSingleNodeSelected.value ? selectedNodes.value[0] : null\n})\n\nconst selectionCount = computed(() => selectedItems.value.length)\n\nconst panelTitle = computed(() => {\n  if (isSingleNodeSelected.value && selectedNode.value) {\n    return selectedNode.value.title || selectedNode.value.type || 'Node'\n  }\n  return t('rightSidePanel.title', { count: selectionCount.value })\n})\n\nfunction closePanel() {\n  rightSidePanelStore.closePanel()\n}\n\ntype RightSidePanelTabList = Array<{\n  label: () => string\n  value: RightSidePanelTab\n}>\n\nconst tabs = computed<RightSidePanelTabList>(() => {\n  const list: RightSidePanelTabList = [\n    {\n      label: () => t('rightSidePanel.parameters'),\n      value: 'parameters'\n    },\n    {\n      label: () => t('g.settings'),\n      value: 'settings'\n    }\n  ]\n  if (\n    !hasSelection.value ||\n    (isSingleNodeSelected.value && !isSubgraphNode.value)\n  ) {\n    list.push({\n      label: () => t('rightSidePanel.info'),\n      value: 'info'\n    })\n  }\n  return list\n})\n\n// Use global state for activeTab and ensure it's valid\nwatchEffect(() => {\n  if (\n    !tabs.value.some((tab) => tab.value === activeTab.value) &&\n    !(activeTab.value === 'subgraph' && isSubgraphNode.value)\n  ) {\n    rightSidePanelStore.openPanel(tabs.value[0].value)\n  }\n})\n\nconst isEditing = ref(false)\n\nfunction handleTitleEdit(newTitle: string) {\n  isEditing.value = false\n\n  const trimmedTitle = newTitle.trim()\n  if (!trimmedTitle) return\n\n  const node = toValue(selectedNode)\n  if (!node) return\n\n  if (trimmedTitle === node.title) return\n\n  node.title = trimmedTitle\n  canvasStore.canvas?.setDirty(true, false)\n}\n\nfunction handleTitleCancel() {\n  isEditing.value = false\n}\n</script>\n\n<template>\n  <div\n    data-testid=\"properties-panel\"\n    class=\"flex size-full flex-col bg-interface-panel-surface\"\n  >\n    <!-- Panel Header -->\n    <section class=\"pt-1\">\n      <div class=\"flex items-center justify-between pl-4 pr-3\">\n        <h3 class=\"my-3.5 text-sm font-semibold line-clamp-2\">\n          <EditableText\n            v-if=\"isSingleNodeSelected\"\n            :model-value=\"panelTitle\"\n            :is-editing=\"isEditing\"\n            :input-attrs=\"{ 'data-testid': 'node-title-input' }\"\n            @edit=\"handleTitleEdit\"\n            @cancel=\"handleTitleCancel\"\n            @dblclick=\"isEditing = true\"\n          />\n          <template v-else>\n            {{ panelTitle }}\n          </template>\n        </h3>\n\n        <div class=\"flex gap-2\">\n          <Button\n            v-if=\"isSubgraphNode\"\n            variant=\"secondary\"\n            size=\"icon\"\n            :class=\"cn(isEditingSubgraph && 'bg-secondary-background-selected')\"\n            @click=\"\n              rightSidePanelStore.openPanel(\n                isEditingSubgraph ? 'parameters' : 'subgraph'\n              )\n            \"\n          >\n            <i class=\"icon-[lucide--settings-2]\" />\n          </Button>\n          <Button\n            variant=\"secondary\"\n            size=\"icon\"\n            :aria-pressed=\"rightSidePanelStore.isOpen\"\n            :aria-label=\"t('rightSidePanel.togglePanel')\"\n            @click=\"closePanel\"\n          >\n            <i :class=\"cn(panelIcon, 'size-4')\" />\n          </Button>\n        </div>\n      </div>\n      <nav v-if=\"hasSelection\" class=\"px-4 pb-2 pt-1\">\n        <TabList\n          :model-value=\"activeTab\"\n          @update:model-value=\"\n            (newTab: RightSidePanelTab) => {\n              rightSidePanelStore.openPanel(newTab)\n            }\n          \"\n        >\n          <Tab\n            v-for=\"tab in tabs\"\n            :key=\"tab.value\"\n            class=\"text-sm py-1 px-2 font-inter\"\n            :value=\"tab.value\"\n          >\n            {{ tab.label() }}\n          </Tab>\n        </TabList>\n      </nav>\n    </section>\n\n    <!-- Panel Content -->\n    <div class=\"scrollbar-thin flex-1 overflow-y-auto\">\n      <div\n        v-if=\"!hasSelection\"\n        class=\"flex size-full p-4 items-start justify-start text-sm text-muted-foreground\"\n      >\n        {{ $t('rightSidePanel.noSelection') }}\n      </div>\n      <SubgraphEditor\n        v-else-if=\"isSubgraphNode && isEditingSubgraph\"\n        :node=\"selectedNode\"\n      />\n      <template v-else>\n        <TabParameters\n          v-if=\"activeTab === 'parameters'\"\n          :nodes=\"selectedNodes\"\n        />\n        <TabInfo v-else-if=\"activeTab === 'info'\" :nodes=\"selectedNodes\" />\n        <TabSettings\n          v-else-if=\"activeTab === 'settings'\"\n          :nodes=\"selectedNodes\"\n        />\n      </template>\n    </div>\n  </div>\n</template>\n","import { useMouse } from '@vueuse/core'\nimport { defineStore } from 'pinia'\nimport { computed, ref, shallowRef } from 'vue'\n\nimport type NodeSearchBoxPopover from '@/components/searchbox/NodeSearchBoxPopover.vue'\nimport type { CanvasPointerEvent } from '@/lib/litegraph/src/litegraph'\nimport { useSettingStore } from '@/platform/settings/settingStore'\n\nexport const useSearchBoxStore = defineStore('searchBox', () => {\n  const settingStore = useSettingStore()\n  const { x, y } = useMouse()\n\n  const newSearchBoxEnabled = computed(\n    () => settingStore.get('Comfy.NodeSearchBoxImpl') === 'default'\n  )\n\n  const popoverRef = shallowRef<InstanceType<\n    typeof NodeSearchBoxPopover\n  > | null>(null)\n\n  function setPopoverRef(\n    popover: InstanceType<typeof NodeSearchBoxPopover> | null\n  ) {\n    popoverRef.value = popover\n  }\n\n  const visible = ref(false)\n  function toggleVisible() {\n    if (newSearchBoxEnabled.value) {\n      visible.value = !visible.value\n      return\n    }\n    if (!popoverRef.value) return\n    popoverRef.value.showSearchBox(\n      new MouseEvent('click', {\n        clientX: x.value,\n        clientY: y.value,\n        // @ts-expect-error layerY is a nonstandard property\n        layerY: y.value\n      }) as unknown as CanvasPointerEvent\n    )\n  }\n\n  return {\n    newSearchBoxEnabled,\n    setPopoverRef,\n    toggleVisible,\n    visible\n  }\n})\n","<!-- Auto complete with extra event \"focused-option-changed\" -->\n<script>\nimport AutoComplete from 'primevue/autocomplete'\n\nexport default {\n  name: 'AutoCompletePlus',\n  extends: AutoComplete,\n  emits: ['focused-option-changed'],\n  data() {\n    return {\n      // Flag to determine if IME is active\n      isComposing: false\n    }\n  },\n  mounted() {\n    if (typeof AutoComplete.mounted === 'function') {\n      AutoComplete.mounted.call(this)\n    }\n\n    // Retrieve the actual <input> element and attach IME events\n    const inputEl = this.$el.querySelector('input')\n    if (inputEl) {\n      inputEl.addEventListener('compositionstart', () => {\n        this.isComposing = true\n      })\n      inputEl.addEventListener('compositionend', () => {\n        this.isComposing = false\n      })\n    }\n    // Add a watcher on the focusedOptionIndex property\n    this.$watch(\n      () => this.focusedOptionIndex,\n      (newVal, oldVal) => {\n        // Emit a custom event when focusedOptionIndex changes\n        this.$emit('focused-option-changed', newVal)\n      }\n    )\n  },\n  methods: {\n    // Override onKeyDown to block Enter when IME is active\n    onKeyDown(event) {\n      if (event.key === 'Enter' && this.isComposing) {\n        event.preventDefault()\n        event.stopPropagation()\n        return\n      }\n\n      AutoComplete.methods.onKeyDown.call(this, event)\n    }\n  }\n}\n</script>\n","<template>\n  <div\n    class=\"option-container flex w-full cursor-pointer items-center justify-between overflow-hidden px-2 py-0\"\n  >\n    <div class=\"option-display-name flex flex-col font-semibold\">\n      <div>\n        <span v-if=\"isBookmarked\">\n          <i class=\"pi pi-bookmark-fill mr-1 text-sm\" />\n        </span>\n        <span v-html=\"highlightQuery(nodeDef.display_name, currentQuery)\" />\n        <span>&nbsp;</span>\n        <Tag v-if=\"showIdName\" severity=\"secondary\">\n          <span v-html=\"highlightQuery(nodeDef.name, currentQuery)\" />\n        </Tag>\n      </div>\n      <div\n        v-if=\"showCategory\"\n        class=\"option-category truncate text-sm font-light text-muted\"\n      >\n        {{ nodeDef.category.replaceAll('/', ' > ') }}\n      </div>\n    </div>\n    <div class=\"option-badges\">\n      <Tag\n        v-if=\"nodeDef.experimental\"\n        :value=\"$t('g.experimental')\"\n        severity=\"primary\"\n      />\n      <Tag\n        v-if=\"nodeDef.deprecated\"\n        :value=\"$t('g.deprecated')\"\n        severity=\"danger\"\n      />\n      <Tag\n        v-if=\"showNodeFrequency && nodeFrequency > 0\"\n        :value=\"formatNumberWithSuffix(nodeFrequency, { roundToInt: true })\"\n        severity=\"secondary\"\n      />\n      <Chip\n        v-if=\"nodeDef.nodeSource.type !== NodeSourceType.Unknown\"\n        class=\"text-sm font-light\"\n      >\n        {{ nodeDef.nodeSource.displayText }}\n      </Chip>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport Chip from 'primevue/chip'\nimport Tag from 'primevue/tag'\nimport { computed } from 'vue'\n\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useNodeBookmarkStore } from '@/stores/nodeBookmarkStore'\nimport type { ComfyNodeDefImpl } from '@/stores/nodeDefStore'\nimport { useNodeFrequencyStore } from '@/stores/nodeDefStore'\nimport { NodeSourceType } from '@/types/nodeSource'\nimport { formatNumberWithSuffix, highlightQuery } from '@/utils/formatUtil'\n\nconst settingStore = useSettingStore()\nconst showCategory = computed(() =>\n  settingStore.get('Comfy.NodeSearchBoxImpl.ShowCategory')\n)\nconst showIdName = computed(() =>\n  settingStore.get('Comfy.NodeSearchBoxImpl.ShowIdName')\n)\nconst showNodeFrequency = computed(() =>\n  settingStore.get('Comfy.NodeSearchBoxImpl.ShowNodeFrequency')\n)\nconst nodeFrequencyStore = useNodeFrequencyStore()\nconst nodeFrequency = computed(() =>\n  nodeFrequencyStore.getNodeFrequency(props.nodeDef)\n)\n\nconst nodeBookmarkStore = useNodeBookmarkStore()\nconst isBookmarked = computed(() =>\n  nodeBookmarkStore.isBookmarked(props.nodeDef)\n)\n\nconst props = defineProps<{\n  nodeDef: ComfyNodeDefImpl\n  currentQuery: string\n}>()\n</script>\n\n<style scoped>\n:deep(.highlight) {\n  background-color: var(--p-primary-color);\n  color: var(--p-primary-contrast-color);\n  font-weight: 700;\n  border-radius: 0.25rem;\n  padding: 0 0.125rem;\n  margin: -0.125rem 0.125rem;\n}\n</style>\n","<template>\n  <div\n    class=\"comfy-vue-node-search-container flex w-full min-w-96 items-center justify-center\"\n  >\n    <div\n      v-if=\"enableNodePreview && hoveredSuggestion\"\n      class=\"comfy-vue-node-preview-container absolute top-[50px] left-[-375px] z-50 cursor-pointer\"\n      @mousedown.stop=\"onAddNode(hoveredSuggestion!)\"\n    >\n      <NodePreview\n        :key=\"hoveredSuggestion?.name || ''\"\n        :node-def=\"hoveredSuggestion\"\n      />\n    </div>\n\n    <Button\n      variant=\"secondary\"\n      :aria-label=\"$t('g.addNodeFilterCondition')\"\n      class=\"filter-button z-10\"\n      @click=\"nodeSearchFilterVisible = true\"\n    >\n      <i class=\"pi pi-filter\" />\n    </Button>\n    <Dialog\n      v-model:visible=\"nodeSearchFilterVisible\"\n      class=\"min-w-96\"\n      dismissable-mask\n      modal\n      @hide=\"reFocusInput\"\n    >\n      <template #header>\n        <h3>{{ $t('g.addNodeFilterCondition') }}</h3>\n      </template>\n      <div class=\"_dialog-body\">\n        <NodeSearchFilter @add-filter=\"onAddFilter\" />\n      </div>\n    </Dialog>\n\n    <AutoCompletePlus\n      ref=\"autoCompletePlus\"\n      :model-value=\"filters\"\n      class=\"comfy-vue-node-search-box z-10 grow\"\n      scroll-height=\"40vh\"\n      :placeholder=\"placeholder\"\n      :input-id=\"inputId\"\n      append-to=\"self\"\n      :suggestions=\"suggestions\"\n      :delay=\"100\"\n      :loading=\"!nodeFrequencyStore.isLoaded\"\n      complete-on-focus\n      auto-option-focus\n      force-selection\n      multiple\n      option-label=\"display_name\"\n      @complete=\"search($event.query)\"\n      @option-select=\"onAddNode($event.value)\"\n      @focused-option-changed=\"setHoverSuggestion($event)\"\n    >\n      <template #option=\"{ option }\">\n        <NodeSearchItem :node-def=\"option\" :current-query=\"currentQuery\" />\n      </template>\n      <!-- FilterAndValue -->\n      <template #chip=\"{ value }\">\n        <SearchFilterChip\n          v-if=\"value.filterDef && value.value\"\n          :key=\"`${value.filterDef.id}-${value.value}`\"\n          :text=\"value.value\"\n          :badge=\"value.filterDef.invokeSequence.toUpperCase()\"\n          :badge-class=\"value.filterDef.invokeSequence + '-badge'\"\n          @remove=\"\n            onRemoveFilter(\n              $event,\n              value as FuseFilterWithValue<ComfyNodeDefImpl, string>\n            )\n          \"\n        />\n      </template>\n    </AutoCompletePlus>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { debounce } from 'es-toolkit/compat'\nimport Dialog from 'primevue/dialog'\nimport { computed, nextTick, onMounted, ref } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport NodePreview from '@/components/node/NodePreview.vue'\nimport AutoCompletePlus from '@/components/primevueOverride/AutoCompletePlus.vue'\nimport NodeSearchFilter from '@/components/searchbox/NodeSearchFilter.vue'\nimport NodeSearchItem from '@/components/searchbox/NodeSearchItem.vue'\nimport Button from '@/components/ui/button/Button.vue'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useTelemetry } from '@/platform/telemetry'\nimport type { ComfyNodeDefImpl } from '@/stores/nodeDefStore'\nimport { useNodeDefStore, useNodeFrequencyStore } from '@/stores/nodeDefStore'\nimport type { FuseFilterWithValue } from '@/utils/fuseUtil'\n\nimport SearchFilterChip from '../common/SearchFilterChip.vue'\n\nconst settingStore = useSettingStore()\nconst { t } = useI18n()\nconst telemetry = useTelemetry()\n\nconst enableNodePreview = computed(() =>\n  settingStore.get('Comfy.NodeSearchBoxImpl.NodePreview')\n)\n\nconst { filters, searchLimit = 64 } = defineProps<{\n  filters: FuseFilterWithValue<ComfyNodeDefImpl, string>[]\n  searchLimit?: number\n}>()\n\nconst autoCompletePlus = ref()\nconst nodeSearchFilterVisible = ref(false)\nconst inputId = `comfy-vue-node-search-box-input-${Math.random()}`\nconst suggestions = ref<ComfyNodeDefImpl[]>([])\nconst hoveredSuggestion = ref<ComfyNodeDefImpl | null>(null)\nconst currentQuery = ref('')\nconst placeholder = computed(() => {\n  return filters.length === 0 ? t('g.searchNodes') + '...' : ''\n})\n\nconst nodeDefStore = useNodeDefStore()\nconst nodeFrequencyStore = useNodeFrequencyStore()\n\n// Debounced search tracking (500ms as per implementation plan)\nconst debouncedTrackSearch = debounce((query: string) => {\n  if (query.trim()) {\n    telemetry?.trackNodeSearch({ query })\n  }\n}, 500)\n\nconst search = (query: string) => {\n  const queryIsEmpty = query === '' && filters.length === 0\n  currentQuery.value = query\n  suggestions.value = queryIsEmpty\n    ? nodeFrequencyStore.topNodeDefs\n    : [\n        ...nodeDefStore.nodeSearchService.searchNode(query, filters, {\n          limit: searchLimit\n        })\n      ]\n\n  // Track search queries with debounce\n  debouncedTrackSearch(query)\n}\n\nconst emit = defineEmits(['addFilter', 'removeFilter', 'addNode'])\n\n// Track node selection and emit addNode event\nconst onAddNode = (nodeDef: ComfyNodeDefImpl) => {\n  telemetry?.trackNodeSearchResultSelected({\n    node_type: nodeDef.name,\n    last_query: currentQuery.value\n  })\n  emit('addNode', nodeDef)\n}\n\nlet inputElement: HTMLInputElement | null = null\nconst reFocusInput = async () => {\n  inputElement ??= document.getElementById(inputId) as HTMLInputElement\n  if (inputElement) {\n    inputElement.blur()\n    await nextTick(() => inputElement?.focus())\n  }\n}\n\nonMounted(() => {\n  inputElement ??= document.getElementById(inputId) as HTMLInputElement\n  if (inputElement) inputElement.focus()\n  autoCompletePlus.value.hide = () => search('')\n  search('')\n  autoCompletePlus.value.show()\n})\nconst onAddFilter = (\n  filterAndValue: FuseFilterWithValue<ComfyNodeDefImpl, string>\n) => {\n  nodeSearchFilterVisible.value = false\n  emit('addFilter', filterAndValue)\n}\nconst onRemoveFilter = async (\n  event: Event,\n  filterAndValue: FuseFilterWithValue<ComfyNodeDefImpl, string>\n) => {\n  event.stopPropagation()\n  event.preventDefault()\n  emit('removeFilter', filterAndValue)\n  await reFocusInput()\n}\nconst setHoverSuggestion = (index: number) => {\n  if (index === -1) {\n    hoveredSuggestion.value = null\n    return\n  }\n  const value = suggestions.value[index]\n  hoveredSuggestion.value = value\n}\n</script>\n","<template>\n  <div>\n    <Dialog\n      v-model:visible=\"visible\"\n      modal\n      :dismissable-mask=\"dismissable\"\n      :pt=\"{\n        root: {\n          class: 'invisible-dialog-root',\n          role: 'search'\n        },\n        mask: { class: 'node-search-box-dialog-mask' },\n        transition: {\n          enterFromClass: 'opacity-0 scale-75',\n          // 100ms is the duration of the transition in the dialog component\n          enterActiveClass: 'transition-all duration-100 ease-out',\n          leaveActiveClass: 'transition-all duration-100 ease-in',\n          leaveToClass: 'opacity-0 scale-75'\n        }\n      }\"\n      @hide=\"clearFilters\"\n    >\n      <template #container>\n        <NodeSearchBox\n          :filters=\"nodeFilters\"\n          @add-filter=\"addFilter\"\n          @remove-filter=\"removeFilter\"\n          @add-node=\"addNode\"\n        />\n      </template>\n    </Dialog>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useEventListener } from '@vueuse/core'\nimport { storeToRefs } from 'pinia'\nimport Dialog from 'primevue/dialog'\nimport { computed, ref, toRaw, watch, watchEffect } from 'vue'\n\nimport type { Point } from '@/lib/litegraph/src/interfaces'\nimport type { LiteGraphCanvasEvent } from '@/lib/litegraph/src/litegraph'\nimport { LGraphNode, LiteGraph } from '@/lib/litegraph/src/litegraph'\nimport type { CanvasPointerEvent } from '@/lib/litegraph/src/types/events'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useLitegraphService } from '@/services/litegraphService'\nimport type { ComfyNodeDefImpl } from '@/stores/nodeDefStore'\nimport { useNodeDefStore } from '@/stores/nodeDefStore'\nimport { useSearchBoxStore } from '@/stores/workspace/searchBoxStore'\nimport { LinkReleaseTriggerAction } from '@/types/searchBoxTypes'\nimport type { FuseFilterWithValue } from '@/utils/fuseUtil'\n\nimport NodeSearchBox from './NodeSearchBox.vue'\n\nlet triggerEvent: CanvasPointerEvent | null = null\nlet listenerController: AbortController | null = null\nlet disconnectOnReset = false\n\nconst settingStore = useSettingStore()\nconst searchBoxStore = useSearchBoxStore()\nconst litegraphService = useLitegraphService()\n\nconst { visible, newSearchBoxEnabled } = storeToRefs(searchBoxStore)\nconst dismissable = ref(true)\nfunction getNewNodeLocation(): Point {\n  return triggerEvent\n    ? [triggerEvent.canvasX, triggerEvent.canvasY]\n    : litegraphService.getCanvasCenter()\n}\nconst nodeFilters = ref<FuseFilterWithValue<ComfyNodeDefImpl, string>[]>([])\nfunction addFilter(filter: FuseFilterWithValue<ComfyNodeDefImpl, string>) {\n  nodeFilters.value.push(filter)\n}\nfunction removeFilter(filter: FuseFilterWithValue<ComfyNodeDefImpl, string>) {\n  nodeFilters.value = nodeFilters.value.filter(\n    (f) => toRaw(f) !== toRaw(filter)\n  )\n}\nfunction clearFilters() {\n  nodeFilters.value = []\n}\nfunction closeDialog() {\n  visible.value = false\n}\nconst canvasStore = useCanvasStore()\n\nfunction addNode(nodeDef: ComfyNodeDefImpl) {\n  const node = litegraphService.addNodeOnGraph(nodeDef, {\n    pos: getNewNodeLocation()\n  })\n\n  if (disconnectOnReset && triggerEvent) {\n    canvasStore.getCanvas().linkConnector.connectToNode(node, triggerEvent)\n  } else if (!triggerEvent) {\n    console.warn('The trigger event was undefined when addNode was called.')\n  }\n\n  disconnectOnReset = false\n\n  // Notify changeTracker - new step should be added\n  useWorkflowStore().activeWorkflow?.changeTracker?.checkState()\n  window.requestAnimationFrame(closeDialog)\n}\n\nfunction showSearchBox(e: CanvasPointerEvent | null) {\n  if (newSearchBoxEnabled.value) {\n    if (e?.pointerType === 'touch') {\n      setTimeout(() => {\n        showNewSearchBox(e)\n      }, 128)\n    } else {\n      showNewSearchBox(e)\n    }\n  } else {\n    canvasStore.getCanvas().showSearchBox(e)\n  }\n}\n\nfunction getFirstLink() {\n  return canvasStore.getCanvas().linkConnector.renderLinks.at(0)\n}\n\nconst nodeDefStore = useNodeDefStore()\nfunction showNewSearchBox(e: CanvasPointerEvent | null) {\n  const firstLink = getFirstLink()\n  if (firstLink) {\n    const filter =\n      firstLink.toType === 'input'\n        ? nodeDefStore.nodeSearchService.inputTypeFilter\n        : nodeDefStore.nodeSearchService.outputTypeFilter\n\n    const dataType = firstLink.fromSlot.type?.toString() ?? ''\n    addFilter({\n      filterDef: filter,\n      value: dataType\n    })\n  }\n\n  visible.value = true\n  triggerEvent = e\n\n  // Prevent the dialog from being dismissed immediately\n  dismissable.value = false\n  setTimeout(() => {\n    dismissable.value = true\n  }, 300)\n}\n\nfunction showContextMenu(e: CanvasPointerEvent) {\n  const firstLink = getFirstLink()\n  if (!firstLink) return\n\n  const { node, fromSlot, toType } = firstLink\n  const commonOptions = {\n    e,\n    allow_searchbox: true,\n    showSearchBox: () => {\n      cancelResetOnContextClose()\n      showSearchBox(e)\n    }\n  }\n  const afterRerouteId = firstLink.fromReroute?.id\n  const connectionOptions =\n    toType === 'input'\n      ? { nodeFrom: node, slotFrom: fromSlot, afterRerouteId }\n      : { nodeTo: node, slotTo: fromSlot, afterRerouteId }\n\n  const canvas = canvasStore.getCanvas()\n  const menu = canvas.showConnectionMenu({\n    ...connectionOptions,\n    ...commonOptions\n  })\n\n  if (!menu) {\n    console.warn('No menu was returned from showConnectionMenu')\n    return\n  }\n\n  triggerEvent = e\n  listenerController = new AbortController()\n  const { signal } = listenerController\n  const options = { once: true, signal }\n\n  // Connect the node after it is created via context menu\n  useEventListener(\n    canvas.canvas,\n    'connect-new-default-node',\n    (createEvent) => {\n      if (!(createEvent instanceof CustomEvent))\n        throw new Error('Invalid event')\n\n      const node: unknown = createEvent.detail?.node\n      if (!(node instanceof LGraphNode)) throw new Error('Invalid node')\n\n      disconnectOnReset = false\n      createEvent.preventDefault()\n      canvas.linkConnector.connectToNode(node, e)\n    },\n    options\n  )\n\n  // Reset when the context menu is closed\n  const cancelResetOnContextClose = useEventListener(\n    menu.controller.signal,\n    'abort',\n    reset,\n    options\n  )\n}\n\n// Disable litegraph's default behavior of release link and search box.\nwatchEffect(() => {\n  const { canvas } = canvasStore\n  if (!canvas) return\n\n  LiteGraph.release_link_on_empty_shows_menu = false\n  canvas.allow_searchbox = false\n\n  useEventListener(\n    canvas.linkConnector.events,\n    'dropped-on-canvas',\n    handleDroppedOnCanvas\n  )\n})\n\nfunction canvasEventHandler(e: LiteGraphCanvasEvent) {\n  if (e.detail.subType === 'empty-double-click') {\n    showSearchBox(e.detail.originalEvent)\n  } else if (e.detail.subType === 'group-double-click') {\n    const group = e.detail.group\n    const [_, y] = group.pos\n    const relativeY = e.detail.originalEvent.canvasY - y\n    // Show search box if the click is NOT on the title bar\n    if (relativeY > group.titleHeight) {\n      showSearchBox(e.detail.originalEvent)\n    }\n  }\n}\n\nconst linkReleaseAction = computed(() =>\n  settingStore.get('Comfy.LinkRelease.Action')\n)\n\nconst linkReleaseActionShift = computed(() =>\n  settingStore.get('Comfy.LinkRelease.ActionShift')\n)\n\n// Prevent normal LinkConnector reset (called by CanvasPointer.finally)\nfunction preventDefault(e: Event) {\n  return e.preventDefault()\n}\nfunction cancelNextReset(e: CustomEvent<CanvasPointerEvent>) {\n  e.preventDefault()\n\n  const canvas = canvasStore.getCanvas()\n  canvas.linkConnector.state.snapLinksPos = [e.detail.canvasX, e.detail.canvasY]\n  useEventListener(canvas.linkConnector.events, 'reset', preventDefault, {\n    once: true\n  })\n}\n\nfunction handleDroppedOnCanvas(e: CustomEvent<CanvasPointerEvent>) {\n  disconnectOnReset = true\n  const action = e.detail.shiftKey\n    ? linkReleaseActionShift.value\n    : linkReleaseAction.value\n  switch (action) {\n    case LinkReleaseTriggerAction.SEARCH_BOX:\n      cancelNextReset(e)\n      showSearchBox(e.detail)\n      break\n    case LinkReleaseTriggerAction.CONTEXT_MENU:\n      cancelNextReset(e)\n      showContextMenu(e.detail)\n      break\n    case LinkReleaseTriggerAction.NO_ACTION:\n    default:\n      break\n  }\n}\n\n// Resets litegraph state\nfunction reset() {\n  listenerController?.abort()\n  listenerController = null\n  triggerEvent = null\n\n  const canvas = canvasStore.getCanvas()\n  canvas.linkConnector.events.removeEventListener('reset', preventDefault)\n  if (disconnectOnReset) canvas.linkConnector.disconnectLinks()\n\n  canvas.linkConnector.reset()\n  canvas.setDirty(true, true)\n}\n\n// Reset connecting links when the search box is closed\nwatch(visible, () => {\n  if (!visible.value) reset()\n})\n\nuseEventListener(document, 'litegraph:canvas', canvasEventHandler)\ndefineExpose({ showSearchBox })\n</script>\n\n<style>\n.invisible-dialog-root {\n  width: 60%;\n  min-width: 24rem;\n  max-width: 48rem;\n  border: 0 !important;\n  background-color: transparent !important;\n  margin-top: 25vh;\n  margin-left: 400px;\n}\n@media all and (max-width: 768px) {\n  .invisible-dialog-root {\n    margin-left: 0;\n  }\n}\n\n.node-search-box-dialog-mask {\n  align-items: flex-start !important;\n}\n</style>\n","<template>\n  <svg\n    :class=\"iconClass\"\n    :width=\"size\"\n    :height=\"size\"\n    viewBox=\"0 0 18 18\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <path\n      d=\"M14.8193 0.600586C15.1248 0.600586 15.3296 0.70893 15.459 0.881836C15.5914 1.05888 15.6471 1.33774 15.5527 1.66895L14.8037 4.30176C14.7063 4.64386 14.4729 4.97024 14.1641 5.21191C13.8544 5.45415 13.496 5.58984 13.1699 5.58984H13.1689L9.5791 5.59668H7.90625C7.52654 5.59668 7.19496 5.84986 7.09082 6.21289L5.69434 11.0889C5.63007 11.3133 5.66134 11.5534 5.77734 11.7529L5.83203 11.8359C5.99177 12.0491 6.24252 12.1758 6.50977 12.1758H6.51074L8.88281 12.1709H11.4971C11.7643 12.171 11.9541 12.254 12.084 12.3906L12.1357 12.4521C12.2685 12.6295 12.3249 12.9089 12.2305 13.2402L11.4805 15.8721C11.383 16.2144 11.1498 16.5415 10.8408 16.7832C10.5314 17.0252 10.1736 17.161 9.84766 17.1611H9.84668L6.25684 17.168H3.64258C3.33762 17.1679 3.13349 17.0588 3.00391 16.8857C2.87135 16.7087 2.81482 16.43 2.90918 16.0986L3.39551 14.3887C3.46841 14.1327 3.41794 13.8576 3.25879 13.6445V13.6436C3.09901 13.4303 2.84745 13.3037 2.58008 13.3037H1.18066C0.875088 13.3037 0.670398 13.1953 0.541016 13.0225C0.408483 12.8451 0.351891 12.5655 0.446289 12.2344L2.11914 6.38965L2.30371 5.74707V5.74609C2.40139 5.40341 2.63456 5.07671 2.94336 4.83496C3.25302 4.59258 3.61143 4.45705 3.9375 4.45703H5.6123C5.94484 4.45703 6.24083 4.26316 6.37891 3.9707L6.42773 3.83984L6.98145 1.89551C7.07894 1.55317 7.31212 1.22614 7.62109 0.984375C7.93074 0.742127 8.2892 0.606445 8.61523 0.606445H8.61621L12.1982 0.600586H14.8193Z\"\n      v-bind=\"attributes\"\n    />\n  </svg>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\n\ninterface Props {\n  size?: number | string\n  color?: string\n  class?: string\n  mode?: 'outline' | 'fill'\n}\nconst {\n  size = 16,\n  color = 'currentColor',\n  mode = 'outline',\n  class: className\n} = defineProps<Props>()\nconst iconClass = computed(() => className || '')\nconst attributes = computed(() => ({\n  stroke: mode === 'outline' ? color : undefined,\n  strokeWidth: mode === 'outline' ? 1 : undefined,\n  fill: mode === 'fill' ? color : 'none'\n}))\n</script>\n","<template>\n  <div :class=\"containerClasses\">\n    <slot></slot>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\n\nimport { cn } from '@/utils/tailwindUtil'\n\nconst { fullHeight = true } = defineProps<{\n  fullHeight?: boolean\n}>()\n\nconst containerClasses = computed(() =>\n  cn('flex-1 w-full', fullHeight && 'h-full')\n)\n</script>\n","<template>\n  <div :class=\"containerClasses\">\n    <slot name=\"top\"></slot>\n    <slot name=\"bottom\"></slot>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\n\nimport { cn } from '@/utils/tailwindUtil'\n\nconst {\n  size = 'regular',\n  variant = 'default',\n  rounded = 'md',\n  customAspectRatio,\n  hasBorder = true,\n  hasBackground = true,\n  hasShadow = true,\n  hasCursor = true,\n  class: customClass = ''\n} = defineProps<{\n  size?: 'mini' | 'compact' | 'regular' | 'portrait' | 'tall'\n  variant?: 'default' | 'ghost' | 'outline'\n  rounded?: 'none' | 'md' | 'lg' | 'xl'\n  customAspectRatio?: string\n  hasBorder?: boolean\n  hasBackground?: boolean\n  hasShadow?: boolean\n  hasCursor?: boolean\n  class?: string\n}>()\n\n// Base structure classes\nconst structureClasses = 'flex flex-col overflow-hidden'\n\n// Rounded corners\nconst roundedClasses = {\n  none: 'rounded-none',\n  md: 'rounded',\n  lg: 'rounded-lg',\n  xl: 'rounded-xl'\n} as const\n\nconst containerClasses = computed(() => {\n  // Variant styles\n  const variantClasses = {\n    default: cn(\n      hasBackground && 'bg-modal-card-background',\n      hasBorder && 'border border-border-default',\n      hasShadow && 'shadow-sm',\n      hasCursor && 'cursor-pointer'\n    ),\n    ghost: cn(\n      hasCursor && 'cursor-pointer',\n      'p-2 transition-colors duration-200'\n    ),\n    outline: cn(\n      hasBorder && 'border-2 border-border-subtle',\n      hasCursor && 'cursor-pointer',\n      'hover:border-border-subtle/50 transition-colors'\n    )\n  }\n\n  // Size/aspect ratio\n  const aspectRatio = customAspectRatio\n    ? `aspect-[${customAspectRatio}]`\n    : {\n        mini: 'aspect-100/120',\n        compact: 'aspect-240/311',\n        regular: 'aspect-256/308',\n        portrait: 'aspect-256/325',\n        tall: 'aspect-256/353'\n      }[size]\n\n  return cn(\n    structureClasses,\n    roundedClasses[rounded],\n    variantClasses[variant],\n    aspectRatio,\n    customClass\n  )\n})\n</script>\n","<template>\n  <div :class=\"topStyle\">\n    <slot class=\"absolute top-0 left-0 h-full w-full\"></slot>\n\n    <div v-if=\"slots['top-left']\" :class=\"slotClasses['top-left']\">\n      <slot name=\"top-left\"></slot>\n    </div>\n\n    <div v-if=\"slots['top-right']\" :class=\"slotClasses['top-right']\">\n      <slot name=\"top-right\"></slot>\n    </div>\n\n    <div v-if=\"slots['center-left']\" :class=\"slotClasses['center-left']\">\n      <slot name=\"center-left\"></slot>\n    </div>\n\n    <div v-if=\"slots['center-right']\" :class=\"slotClasses['center-right']\">\n      <slot name=\"center-right\"></slot>\n    </div>\n\n    <div v-if=\"slots['bottom-left']\" :class=\"slotClasses['bottom-left']\">\n      <slot name=\"bottom-left\"></slot>\n    </div>\n\n    <div v-if=\"slots['bottom-right']\" :class=\"slotClasses['bottom-right']\">\n      <slot name=\"bottom-right\"></slot>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, useSlots } from 'vue'\n\nimport { cn } from '@/utils/tailwindUtil'\n\nconst slots = useSlots()\n\nconst {\n  ratio = 'square',\n  topLeftClass,\n  topRightClass,\n  centerLeftClass,\n  centerRightClass,\n  bottomLeftClass,\n  bottomRightClass\n} = defineProps<{\n  ratio?: 'square' | 'landscape'\n  topLeftClass?: string\n  topRightClass?: string\n  centerLeftClass?: string\n  centerRightClass?: string\n  bottomLeftClass?: string\n  bottomRightClass?: string\n}>()\n\nconst topStyle = computed(() => {\n  const baseClasses = 'relative p-0 overflow-hidden'\n\n  const ratioClasses = {\n    square: 'aspect-square',\n    landscape: 'aspect-48/27'\n  }\n\n  return `${baseClasses} ${ratioClasses[ratio]}`\n})\n\n// Get default classes for each slot position\nconst defaultSlotClasses = {\n  'top-left': 'absolute top-2 left-2 flex flex-wrap justify-start gap-2',\n  'top-right': 'absolute top-2 right-2 flex flex-wrap justify-end gap-2',\n  'center-left':\n    'absolute top-1/2 left-2 flex -translate-y-1/2 flex-wrap justify-start gap-2',\n  'center-right':\n    'absolute top-1/2 right-2 flex -translate-y-1/2 flex-wrap justify-end gap-2',\n  'bottom-left': 'absolute bottom-2 left-2 flex flex-wrap justify-start gap-2',\n  'bottom-right': 'absolute right-2 bottom-2 flex flex-wrap justify-end gap-2'\n}\n\n// Compute all slot classes once and cache them\nconst slotClasses = computed(() => ({\n  'top-left': cn(defaultSlotClasses['top-left'], topLeftClass),\n  'top-right': cn(defaultSlotClasses['top-right'], topRightClass),\n  'center-left': cn(defaultSlotClasses['center-left'], centerLeftClass),\n  'center-right': cn(defaultSlotClasses['center-right'], centerRightClass),\n  'bottom-left': cn(defaultSlotClasses['bottom-left'], bottomLeftClass),\n  'bottom-right': cn(defaultSlotClasses['bottom-right'], bottomRightClass)\n}))\n</script>\n","<template>\n  <div :class=\"chipClasses\">\n    <slot name=\"icon\"></slot>\n    <span>{{ label }}</span>\n  </div>\n</template>\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\n\nimport { cn } from '@/utils/tailwindUtil'\n\nconst { label, variant = 'dark' } = defineProps<{\n  label: string\n  variant?: 'dark' | 'light' | 'gray'\n}>()\n\nconst baseClasses =\n  'inline-flex shrink-0 items-center justify-center gap-1 rounded px-2 py-1 text-xs font-bold'\n\nconst variantStyles = {\n  dark: 'bg-zinc-500/40 text-white/90',\n  light: cn('backdrop-blur-[2px] bg-base-background/50 text-base-foreground'),\n  gray: cn(\n    'backdrop-blur-[2px] bg-modal-card-tag-background text-base-foreground'\n  )\n}\n\nconst chipClasses = computed(() => {\n  return cn(baseClasses, variantStyles[variant])\n})\n</script>\n","<template>\n  <div\n    class=\"relative aspect-square w-full overflow-hidden rounded-t-lg select-none\"\n  >\n    <div\n      v-if=\"!error\"\n      ref=\"contentRef\"\n      class=\"h-full w-full transform-gpu transition-transform duration-1000 ease-out\"\n      :style=\"\n        isHovered ? { transform: `scale(${1 + hoverZoom / 100})` } : undefined\n      \"\n    >\n      <slot />\n    </div>\n    <div v-else class=\"flex h-full w-full items-center justify-center\">\n      <img\n        src=\"/assets/images/default-template.png\"\n        draggable=\"false\"\n        class=\"h-full w-full transform-gpu object-cover transition-transform duration-300 ease-out\"\n      />\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useEventListener } from '@vueuse/core'\nimport { onMounted, ref } from 'vue'\n\nconst error = ref(false)\nconst contentRef = ref<HTMLElement | null>(null)\n\nconst { hoverZoom = 4 } = defineProps<{\n  hoverZoom?: number\n  isHovered?: boolean\n}>()\n\nonMounted(() => {\n  const images = Array.from(contentRef.value?.getElementsByTagName('img') ?? [])\n  images.forEach((img) => {\n    useEventListener(img, 'error', () => {\n      error.value = true\n    })\n  })\n})\n</script>\n<style scoped>\nimg {\n  transition: transform 1s cubic-bezier(0.2, 0, 0.4, 1);\n}\n</style>\n","<template>\n  <BaseThumbnail :is-hovered=\"isHovered\">\n    <LazyImage\n      :src=\"baseImageSrc\"\n      :alt=\"alt\"\n      :image-class=\"\n        isVideoType\n          ? 'w-full h-full object-cover'\n          : 'max-w-full max-h-64 object-contain'\n      \"\n    />\n    <div ref=\"containerRef\" class=\"absolute inset-0\">\n      <LazyImage\n        :src=\"overlayImageSrc\"\n        :alt=\"alt\"\n        :image-class=\"\n          isVideoType\n            ? 'w-full h-full object-cover'\n            : 'max-w-full max-h-64 object-contain'\n        \"\n        :image-style=\"{\n          clipPath: `inset(0 ${100 - sliderPosition}% 0 0)`\n        }\"\n      />\n      <div\n        class=\"pointer-events-none absolute inset-y-0 z-10 w-0.5 bg-white/30 backdrop-blur-sm\"\n        :style=\"{\n          left: `${sliderPosition}%`\n        }\"\n      />\n    </div>\n  </BaseThumbnail>\n</template>\n\n<script setup lang=\"ts\">\nimport { useMouseInElement } from '@vueuse/core'\nimport { ref, watch } from 'vue'\n\nimport LazyImage from '@/components/common/LazyImage.vue'\nimport BaseThumbnail from '@/components/templates/thumbnails/BaseThumbnail.vue'\n\nconst SLIDER_START_POSITION = 50\n\nconst { baseImageSrc, overlayImageSrc, isHovered, isVideo } = defineProps<{\n  baseImageSrc: string\n  overlayImageSrc: string\n  alt: string\n  isHovered?: boolean\n  isVideo?: boolean\n}>()\n\nconst isVideoType =\n  isVideo ||\n  baseImageSrc?.toLowerCase().endsWith('.webp') ||\n  overlayImageSrc?.toLowerCase().endsWith('.webp') ||\n  false\n\nconst sliderPosition = ref(SLIDER_START_POSITION)\nconst containerRef = ref<HTMLElement | null>(null)\n\nconst { elementX, elementWidth, isOutside } = useMouseInElement(containerRef)\n\n// Update slider position based on mouse position when hovered\nwatch(\n  [() => isHovered, elementX, elementWidth, isOutside],\n  ([isHovered, x, width, outside]) => {\n    if (!isHovered) return\n    if (!outside) {\n      sliderPosition.value = (x / width) * 100\n    }\n  }\n)\n</script>\n","<template>\n  <BaseThumbnail :hover-zoom=\"hoverZoom\" :is-hovered=\"isHovered\">\n    <LazyImage\n      :src=\"src\"\n      :alt=\"alt\"\n      :image-class=\"[\n        'transform-gpu transition-transform duration-300 ease-out',\n        isVideoType\n          ? 'w-full h-full object-cover'\n          : 'max-w-full max-h-64 object-contain'\n      ]\"\n      :image-style=\"\n        isHovered ? { transform: `scale(${1 + hoverZoom / 100})` } : undefined\n      \"\n    />\n  </BaseThumbnail>\n</template>\n\n<script setup lang=\"ts\">\nimport LazyImage from '@/components/common/LazyImage.vue'\nimport BaseThumbnail from '@/components/templates/thumbnails/BaseThumbnail.vue'\n\nconst { src, isVideo } = defineProps<{\n  src: string\n  alt: string\n  hoverZoom: number\n  isHovered?: boolean\n  isVideo?: boolean\n}>()\n\nconst isVideoType = isVideo ?? (src?.toLowerCase().endsWith('.webp') || false)\n</script>\n","<template>\n  <BaseThumbnail :is-hovered=\"isHovered\">\n    <div class=\"relative h-full w-full\">\n      <div class=\"absolute inset-0\">\n        <LazyImage\n          :src=\"baseImageSrc\"\n          :alt=\"alt\"\n          :image-class=\"baseImageClass\"\n        />\n      </div>\n      <div class=\"absolute inset-0 z-10\">\n        <LazyImage\n          :src=\"overlayImageSrc\"\n          :alt=\"alt\"\n          :image-class=\"overlayImageClass\"\n        />\n      </div>\n    </div>\n  </BaseThumbnail>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\n\nimport LazyImage from '@/components/common/LazyImage.vue'\nimport BaseThumbnail from '@/components/templates/thumbnails/BaseThumbnail.vue'\n\nconst { baseImageSrc, overlayImageSrc, isVideo, isHovered } = defineProps<{\n  baseImageSrc: string\n  overlayImageSrc: string\n  alt: string\n  isHovered: boolean\n  isVideo?: boolean\n}>()\n\nconst isVideoType =\n  isVideo ||\n  baseImageSrc?.toLowerCase().endsWith('.webp') ||\n  overlayImageSrc?.toLowerCase().endsWith('.webp') ||\n  false\n\nconst baseImageClass = computed(() => {\n  const sizeClasses = isVideoType\n    ? 'size-full object-cover'\n    : 'size-full object-contain'\n  return sizeClasses\n})\n\nconst overlayImageClass = computed(() => {\n  const baseClasses = 'size-full transition-opacity duration-300'\n  const sizeClasses = isVideoType ? 'object-cover' : 'object-contain'\n  const opacityClasses = isHovered ? 'opacity-100' : 'opacity-0'\n  return `${baseClasses} ${sizeClasses} ${opacityClasses}`\n})\n</script>\n","import { computed, ref, shallowRef, watch } from 'vue'\nimport type { Ref } from 'vue'\n\ninterface LazyPaginationOptions {\n  itemsPerPage?: number\n  initialPage?: number\n}\n\nexport function useLazyPagination<T>(\n  items: Ref<T[]> | T[],\n  options: LazyPaginationOptions = {}\n) {\n  const { itemsPerPage = 12, initialPage = 1 } = options\n\n  const currentPage = ref(initialPage)\n  const isLoading = ref(false)\n  const loadedPages = shallowRef(new Set<number>([]))\n\n  // Get reactive items array\n  const itemsArray = computed(() => {\n    const itemData = 'value' in items ? items.value : items\n    return Array.isArray(itemData) ? itemData : []\n  })\n\n  // Simulate pagination by slicing the items\n  const paginatedItems = computed(() => {\n    const itemData = itemsArray.value\n    if (itemData.length === 0) {\n      return []\n    }\n\n    const loadedPageNumbers = Array.from(loadedPages.value).sort(\n      (a, b) => a - b\n    )\n    const maxLoadedPage = Math.max(...loadedPageNumbers, 0)\n    const endIndex = maxLoadedPage * itemsPerPage\n    return itemData.slice(0, endIndex)\n  })\n\n  const hasMoreItems = computed(() => {\n    const itemData = itemsArray.value\n    if (itemData.length === 0) {\n      return false\n    }\n\n    const loadedPagesArray = Array.from(loadedPages.value)\n    const maxLoadedPage = Math.max(...loadedPagesArray, 0)\n    return maxLoadedPage * itemsPerPage < itemData.length\n  })\n\n  const totalPages = computed(() => {\n    const itemData = itemsArray.value\n    if (itemData.length === 0) {\n      return 0\n    }\n    return Math.ceil(itemData.length / itemsPerPage)\n  })\n\n  const loadNextPage = async () => {\n    if (isLoading.value || !hasMoreItems.value) return\n\n    isLoading.value = true\n    const loadedPagesArray = Array.from(loadedPages.value)\n    const nextPage = Math.max(...loadedPagesArray, 0) + 1\n\n    // Simulate network delay\n    // await new Promise((resolve) => setTimeout(resolve, 5000))\n\n    const newLoadedPages = new Set(loadedPages.value)\n    newLoadedPages.add(nextPage)\n    loadedPages.value = newLoadedPages\n    currentPage.value = nextPage\n    isLoading.value = false\n  }\n\n  // Initialize with first page\n  watch(\n    () => itemsArray.value.length,\n    (length) => {\n      if (length > 0 && loadedPages.value.size === 0) {\n        loadedPages.value = new Set([1])\n      }\n    },\n    { immediate: true }\n  )\n\n  const reset = () => {\n    currentPage.value = initialPage\n    loadedPages.value = new Set([])\n    isLoading.value = false\n\n    // Immediately load first page if we have items\n    const itemData = itemsArray.value\n    if (itemData.length > 0) {\n      loadedPages.value = new Set([1])\n    }\n  }\n\n  return {\n    paginatedItems,\n    isLoading,\n    hasMoreItems,\n    currentPage,\n    totalPages,\n    loadNextPage,\n    reset\n  }\n}\n","/**\n * Store for template ranking scores.\n * Loads pre-computed usage scores from static JSON.\n * Internal ranks come from template.searchRank in index.json.\n * See docs/TEMPLATE_RANKING.md for details.\n */\n\nimport { defineStore } from 'pinia'\nimport { ref } from 'vue'\n\nexport const useTemplateRankingStore = defineStore('templateRanking', () => {\n  const largestUsageScore = ref<number>()\n\n  const normalizeUsageScore = (usage: number): number => {\n    return usage / (largestUsageScore.value ?? usage)\n  }\n\n  /**\n   * Compute freshness score based on template date.\n   * Returns 1.0 for brand new, decays to 0.1 over ~6 months.\n   */\n  const computeFreshness = (dateStr: string | undefined): number => {\n    if (!dateStr) return 0.5 // Default for templates without dates\n\n    const date = new Date(dateStr)\n    if (isNaN(date.getTime())) return 0.5\n\n    const daysSinceAdded = (Date.now() - date.getTime()) / (1000 * 60 * 60 * 24)\n    return Math.max(0.1, 1.0 / (1 + daysSinceAdded / 90))\n  }\n\n  /**\n   * Compute composite score for \"default\" sort.\n   * Formula: usage  0.5 + internal  0.3 + freshness  0.2\n   */\n  const computeDefaultScore = (\n    dateStr: string | undefined,\n    searchRank: number | undefined,\n    usage: number = 0\n  ): number => {\n    const internal = (searchRank ?? 5) / 10 // Normalize 1-10 to 0-1\n    const freshness = computeFreshness(dateStr)\n\n    return normalizeUsageScore(usage) * 0.5 + internal * 0.3 + freshness * 0.2\n  }\n\n  /**\n   * Compute composite score for \"popular\" sort.\n   * Formula: usage  0.9 + freshness  0.1\n   */\n  const computePopularScore = (\n    dateStr: string | undefined,\n    usage: number = 0\n  ): number => {\n    const freshness = computeFreshness(dateStr)\n\n    return normalizeUsageScore(usage) * 0.9 + freshness * 0.1\n  }\n\n  return {\n    largestUsageScore,\n    computeFreshness,\n    computeDefaultScore,\n    computePopularScore\n  }\n})\n","import { refDebounced, watchDebounced } from '@vueuse/core'\nimport Fuse from 'fuse.js'\nimport { computed, ref, watch } from 'vue'\nimport type { Ref } from 'vue'\n\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useTelemetry } from '@/platform/telemetry'\nimport type { TemplateInfo } from '@/platform/workflow/templates/types/template'\nimport { useTemplateRankingStore } from '@/stores/templateRankingStore'\nimport { debounce } from 'es-toolkit/compat'\n\nexport function useTemplateFiltering(\n  templates: Ref<TemplateInfo[]> | TemplateInfo[]\n) {\n  const settingStore = useSettingStore()\n  const rankingStore = useTemplateRankingStore()\n\n  const searchQuery = ref('')\n  const selectedModels = ref<string[]>(\n    settingStore.get('Comfy.Templates.SelectedModels')\n  )\n  const selectedUseCases = ref<string[]>(\n    settingStore.get('Comfy.Templates.SelectedUseCases')\n  )\n  const selectedRunsOn = ref<string[]>(\n    settingStore.get('Comfy.Templates.SelectedRunsOn')\n  )\n  const sortBy = ref<\n    | 'default'\n    | 'recommended'\n    | 'popular'\n    | 'alphabetical'\n    | 'newest'\n    | 'vram-low-to-high'\n    | 'model-size-low-to-high'\n  >(settingStore.get('Comfy.Templates.SortBy'))\n\n  const templatesArray = computed(() => {\n    const templateData = 'value' in templates ? templates.value : templates\n    return Array.isArray(templateData) ? templateData : []\n  })\n\n  // Fuse.js configuration for fuzzy search\n  const fuseOptions = {\n    keys: [\n      { name: 'name', weight: 0.3 },\n      { name: 'title', weight: 0.3 },\n      { name: 'description', weight: 0.1 },\n      { name: 'tags', weight: 0.2 },\n      { name: 'models', weight: 0.3 }\n    ],\n    threshold: 0.33,\n    includeScore: true,\n    includeMatches: true\n  }\n\n  const fuse = computed(() => new Fuse(templatesArray.value, fuseOptions))\n\n  const availableModels = computed(() => {\n    const modelSet = new Set<string>()\n    templatesArray.value.forEach((template) => {\n      if (Array.isArray(template.models)) {\n        template.models.forEach((model) => modelSet.add(model))\n      }\n    })\n    return Array.from(modelSet).sort()\n  })\n\n  const availableUseCases = computed(() => {\n    const tagSet = new Set<string>()\n    templatesArray.value.forEach((template) => {\n      if (template.tags && Array.isArray(template.tags)) {\n        template.tags.forEach((tag) => tagSet.add(tag))\n      }\n    })\n    return Array.from(tagSet).sort()\n  })\n\n  const availableRunsOn = computed(() => {\n    return ['ComfyUI', 'External or Remote API']\n  })\n\n  const debouncedSearchQuery = refDebounced(searchQuery, 50)\n\n  const filteredBySearch = computed(() => {\n    if (!debouncedSearchQuery.value.trim()) {\n      return templatesArray.value\n    }\n\n    const results = fuse.value.search(debouncedSearchQuery.value)\n    return results.map((result) => result.item)\n  })\n\n  const filteredByModels = computed(() => {\n    if (selectedModels.value.length === 0) {\n      return filteredBySearch.value\n    }\n\n    return filteredBySearch.value.filter((template) => {\n      if (!template.models || !Array.isArray(template.models)) {\n        return false\n      }\n      return selectedModels.value.some((selectedModel) =>\n        template.models?.includes(selectedModel)\n      )\n    })\n  })\n\n  const filteredByUseCases = computed(() => {\n    if (selectedUseCases.value.length === 0) {\n      return filteredByModels.value\n    }\n\n    return filteredByModels.value.filter((template) => {\n      if (!template.tags || !Array.isArray(template.tags)) {\n        return false\n      }\n      return selectedUseCases.value.some((selectedTag) =>\n        template.tags?.includes(selectedTag)\n      )\n    })\n  })\n\n  const filteredByRunsOn = computed(() => {\n    if (selectedRunsOn.value.length === 0) {\n      return filteredByUseCases.value\n    }\n\n    return filteredByUseCases.value.filter((template) => {\n      // Use openSource field to determine where template runs\n      // openSource === false -> External/Remote API\n      // openSource !== false -> ComfyUI (includes true and undefined)\n      const isExternalAPI = template.openSource === false\n      const isComfyUI = template.openSource !== false\n\n      return selectedRunsOn.value.some((selectedRunsOn) => {\n        if (selectedRunsOn === 'External or Remote API') {\n          return isExternalAPI\n        } else if (selectedRunsOn === 'ComfyUI') {\n          return isComfyUI\n        }\n        return false\n      })\n    })\n  })\n\n  const getVramMetric = (template: TemplateInfo) => {\n    if (\n      typeof template.vram === 'number' &&\n      Number.isFinite(template.vram) &&\n      template.vram > 0\n    ) {\n      return template.vram\n    }\n    return Number.POSITIVE_INFINITY\n  }\n\n  watch(\n    filteredByRunsOn,\n    (templates) => {\n      rankingStore.largestUsageScore = Math.max(\n        ...templates.map((t) => t.usage || 0)\n      )\n    },\n    { immediate: true }\n  )\n\n  const sortedTemplates = computed(() => {\n    const templates = [...filteredByRunsOn.value]\n\n    switch (sortBy.value) {\n      case 'recommended':\n        // Curated: usage  0.5 + internal  0.3 + freshness  0.2\n        return templates.sort((a, b) => {\n          const scoreA = rankingStore.computeDefaultScore(\n            a.date,\n            a.searchRank,\n            a.usage\n          )\n          const scoreB = rankingStore.computeDefaultScore(\n            b.date,\n            b.searchRank,\n            b.usage\n          )\n          return scoreB - scoreA\n        })\n      case 'popular':\n        // User-driven: usage  0.9 + freshness  0.1\n        return templates.sort((a, b) => {\n          const scoreA = rankingStore.computePopularScore(a.date, a.usage)\n          const scoreB = rankingStore.computePopularScore(b.date, b.usage)\n          return scoreB - scoreA\n        })\n      case 'alphabetical':\n        return templates.sort((a, b) => {\n          const nameA = a.title || a.name || ''\n          const nameB = b.title || b.name || ''\n          return nameA.localeCompare(nameB)\n        })\n      case 'newest':\n        return templates.sort((a, b) => {\n          const dateA = new Date(a.date || '1970-01-01')\n          const dateB = new Date(b.date || '1970-01-01')\n          return dateB.getTime() - dateA.getTime()\n        })\n      case 'vram-low-to-high':\n        return templates.sort((a, b) => {\n          const vramA = getVramMetric(a)\n          const vramB = getVramMetric(b)\n\n          if (vramA === vramB) {\n            const nameA = a.title || a.name || ''\n            const nameB = b.title || b.name || ''\n            return nameA.localeCompare(nameB)\n          }\n\n          if (vramA === Number.POSITIVE_INFINITY) return 1\n          if (vramB === Number.POSITIVE_INFINITY) return -1\n\n          return vramA - vramB\n        })\n      case 'model-size-low-to-high':\n        return templates.sort((a, b) => {\n          const sizeA =\n            typeof a.size === 'number' ? a.size : Number.POSITIVE_INFINITY\n          const sizeB =\n            typeof b.size === 'number' ? b.size : Number.POSITIVE_INFINITY\n          if (sizeA === sizeB) return 0\n          return sizeA - sizeB\n        })\n      case 'default':\n      default:\n        return templates\n    }\n  })\n\n  const filteredTemplates = computed(() => sortedTemplates.value)\n\n  const resetFilters = () => {\n    searchQuery.value = ''\n    selectedModels.value = []\n    selectedUseCases.value = []\n    selectedRunsOn.value = []\n    sortBy.value = 'default'\n  }\n\n  const removeModelFilter = (model: string) => {\n    selectedModels.value = selectedModels.value.filter((m) => m !== model)\n  }\n\n  const removeUseCaseFilter = (tag: string) => {\n    selectedUseCases.value = selectedUseCases.value.filter((t) => t !== tag)\n  }\n\n  const removeRunsOnFilter = (runsOn: string) => {\n    selectedRunsOn.value = selectedRunsOn.value.filter((r) => r !== runsOn)\n  }\n\n  const filteredCount = computed(() => filteredTemplates.value.length)\n  const totalCount = computed(() => templatesArray.value.length)\n\n  // Template filter tracking (debounced to avoid excessive events)\n  const debouncedTrackFilterChange = debounce(() => {\n    useTelemetry()?.trackTemplateFilterChanged({\n      search_query: searchQuery.value || undefined,\n      selected_models: selectedModels.value,\n      selected_use_cases: selectedUseCases.value,\n      selected_runs_on: selectedRunsOn.value,\n      sort_by: sortBy.value,\n      filtered_count: filteredCount.value,\n      total_count: totalCount.value\n    })\n  }, 500)\n\n  // Watch for filter changes and track them\n  watch(\n    [searchQuery, selectedModels, selectedUseCases, selectedRunsOn, sortBy],\n    () => {\n      // Only track if at least one filter is active (to avoid tracking initial state)\n      const hasActiveFilters =\n        searchQuery.value.trim() !== '' ||\n        selectedModels.value.length > 0 ||\n        selectedUseCases.value.length > 0 ||\n        selectedRunsOn.value.length > 0 ||\n        sortBy.value !== 'default'\n\n      if (hasActiveFilters) {\n        debouncedTrackFilterChange()\n      }\n    },\n    { deep: true }\n  )\n\n  // Persist filter changes to settings (debounced to avoid excessive saves)\n  watchDebounced(\n    selectedModels,\n    (newValue) => {\n      void settingStore.set('Comfy.Templates.SelectedModels', newValue)\n    },\n    { debounce: 500, deep: true }\n  )\n\n  watchDebounced(\n    selectedUseCases,\n    (newValue) => {\n      void settingStore.set('Comfy.Templates.SelectedUseCases', newValue)\n    },\n    { debounce: 500, deep: true }\n  )\n\n  watchDebounced(\n    selectedRunsOn,\n    (newValue) => {\n      void settingStore.set('Comfy.Templates.SelectedRunsOn', newValue)\n    },\n    { debounce: 500, deep: true }\n  )\n\n  watchDebounced(\n    sortBy,\n    (newValue) => {\n      void settingStore.set('Comfy.Templates.SortBy', newValue)\n    },\n    { debounce: 500 }\n  )\n\n  return {\n    // State\n    searchQuery,\n    selectedModels,\n    selectedUseCases,\n    selectedRunsOn,\n    sortBy,\n\n    // Computed\n    filteredTemplates,\n    availableModels,\n    availableUseCases,\n    availableRunsOn,\n    filteredCount,\n    totalCount,\n\n    // Methods\n    resetFilters,\n    removeModelFilter,\n    removeUseCaseFilter,\n    removeRunsOnFilter\n  }\n}\n","import { computed, ref } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport { isCloud } from '@/platform/distribution/types'\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useWorkflowTemplatesStore } from '@/platform/workflow/templates/repositories/workflowTemplatesStore'\nimport type {\n  TemplateGroup,\n  TemplateInfo,\n  WorkflowTemplates\n} from '@/platform/workflow/templates/types/template'\nimport { api } from '@/scripts/api'\nimport { app } from '@/scripts/app'\nimport { useDialogStore } from '@/stores/dialogStore'\n\nexport function useTemplateWorkflows() {\n  const { t } = useI18n()\n  const workflowTemplatesStore = useWorkflowTemplatesStore()\n  const dialogStore = useDialogStore()\n\n  // State\n  const selectedTemplate = ref<WorkflowTemplates | null>(null)\n  const loadingTemplateId = ref<string | null>(null)\n\n  // Computed\n  const isTemplatesLoaded = computed(() => workflowTemplatesStore.isLoaded)\n  const allTemplateGroups = computed<TemplateGroup[]>(\n    () => workflowTemplatesStore.groupedTemplates\n  )\n\n  /**\n   * Loads all template workflows from the API\n   */\n  const loadTemplates = async () => {\n    if (!workflowTemplatesStore.isLoaded) {\n      await workflowTemplatesStore.loadWorkflowTemplates()\n    }\n    return workflowTemplatesStore.isLoaded\n  }\n\n  /**\n   * Selects the first template category as default\n   */\n  const selectFirstTemplateCategory = () => {\n    if (allTemplateGroups.value.length > 0) {\n      const firstCategory = allTemplateGroups.value[0].modules[0]\n      selectTemplateCategory(firstCategory)\n    }\n  }\n\n  /**\n   * Selects a template category\n   */\n  const selectTemplateCategory = (category: WorkflowTemplates | null) => {\n    selectedTemplate.value = category\n    return category !== null\n  }\n\n  /**\n   * Gets template thumbnail URL\n   */\n  const getTemplateThumbnailUrl = (\n    template: TemplateInfo,\n    sourceModule: string,\n    index = '1'\n  ) => {\n    const basePath =\n      sourceModule === 'default'\n        ? api.fileURL(`/templates/${template.name}`)\n        : api.apiURL(`/workflow_templates/${sourceModule}/${template.name}`)\n\n    const indexSuffix = sourceModule === 'default' && index ? `-${index}` : ''\n    return `${basePath}${indexSuffix}.${template.mediaSubtype}`\n  }\n\n  /**\n   * Gets formatted template title\n   */\n  const getTemplateTitle = (template: TemplateInfo, sourceModule: string) => {\n    const fallback =\n      template.title ?? template.name ?? `${sourceModule} Template`\n    return sourceModule === 'default'\n      ? (template.localizedTitle ?? fallback)\n      : fallback\n  }\n\n  /**\n   * Gets formatted template description\n   */\n  const getTemplateDescription = (template: TemplateInfo) => {\n    return (\n      (template.localizedDescription || template.description)\n        ?.replace(/[-_]/g, ' ')\n        .trim() ?? ''\n    )\n  }\n\n  /**\n   * Loads a workflow template\n   */\n  const loadWorkflowTemplate = async (id: string, sourceModule: string) => {\n    if (!isTemplatesLoaded.value) return false\n\n    loadingTemplateId.value = id\n    let json\n\n    try {\n      // Handle \"All\" category as a special case\n      if (sourceModule === 'all') {\n        // Find \"All\" category in the ComfyUI Examples group\n        const comfyExamplesGroup = allTemplateGroups.value.find(\n          (g) =>\n            g.label ===\n            t('templateWorkflows.category.ComfyUI Examples', 'ComfyUI Examples')\n        )\n        const allCategory = comfyExamplesGroup?.modules.find(\n          (m) => m.moduleName === 'all'\n        )\n        const template = allCategory?.templates.find((t) => t.name === id)\n\n        if (!template || !template.sourceModule) return false\n\n        // Use the stored source module for loading\n        const actualSourceModule = template.sourceModule\n        json = await fetchTemplateJson(id, actualSourceModule)\n\n        // Use source module for name\n        const workflowName =\n          actualSourceModule === 'default'\n            ? t(`templateWorkflows.template.${id}`, id)\n            : id\n\n        if (isCloud) {\n          useTelemetry()?.trackTemplate({\n            workflow_name: id,\n            template_source: actualSourceModule\n          })\n        }\n\n        dialogStore.closeDialog()\n        await app.loadGraphData(json, true, true, workflowName, {\n          openSource: 'template'\n        })\n\n        return true\n      }\n\n      // Regular case for normal categories\n      json = await fetchTemplateJson(id, sourceModule)\n\n      const workflowName =\n        sourceModule === 'default'\n          ? t(`templateWorkflows.template.${id}`, id)\n          : id\n\n      if (isCloud) {\n        useTelemetry()?.trackTemplate({\n          workflow_name: id,\n          template_source: sourceModule\n        })\n      }\n\n      dialogStore.closeDialog()\n      await app.loadGraphData(json, true, true, workflowName, {\n        openSource: 'template'\n      })\n\n      return true\n    } catch (error) {\n      console.error('Error loading workflow template:', error)\n      return false\n    } finally {\n      loadingTemplateId.value = null\n    }\n  }\n\n  /**\n   * Fetches template JSON from the appropriate endpoint\n   */\n  const fetchTemplateJson = async (id: string, sourceModule: string) => {\n    if (sourceModule === 'default') {\n      // Default templates provided by frontend are served on this separate endpoint\n      return fetch(api.fileURL(`/templates/${id}.json`)).then((r) => r.json())\n    } else {\n      return fetch(\n        api.apiURL(`/workflow_templates/${sourceModule}/${id}.json`)\n      ).then((r) => r.json())\n    }\n  }\n\n  return {\n    // State\n    selectedTemplate,\n    loadingTemplateId,\n\n    // Computed\n    isTemplatesLoaded,\n    allTemplateGroups,\n\n    // Methods\n    loadTemplates,\n    selectFirstTemplateCategory,\n    selectTemplateCategory,\n    getTemplateThumbnailUrl,\n    getTemplateTitle,\n    getTemplateDescription,\n    loadWorkflowTemplate\n  }\n}\n","import type { CSSProperties } from 'vue'\n\ninterface GridOptions {\n  /** Minimum width for each grid item (default: 15rem) */\n  minWidth?: string\n  /** Maximum width for each grid item (default: 1fr) */\n  maxWidth?: string\n  /** Padding around the grid (default: 0) */\n  padding?: string\n  /** Gap between grid items (default: 1rem) */\n  gap?: string\n  /** Fixed number of columns (overrides auto-fill with minmax) */\n  columns?: number\n}\n\n/**\n * @deprecated Just use tailwind utilities directly.\n * TODO: Create a common grid layout component if needed.\n * Creates CSS grid styles for responsive grid layouts\n * @param options Grid configuration options\n * @returns CSS properties object for grid styling\n */\nexport function createGridStyle(options: GridOptions = {}): CSSProperties {\n  const {\n    minWidth = '15rem',\n    maxWidth = '1fr',\n    padding = '0',\n    gap = '1rem',\n    columns\n  } = options\n\n  // Runtime validation for columns\n  if (columns !== undefined && columns < 1) {\n    console.warn('createGridStyle: columns must be >= 1, defaulting to 1')\n  }\n\n  const gridTemplateColumns = columns\n    ? `repeat(${Math.max(1, columns ?? 1)}, 1fr)`\n    : `repeat(auto-fill, minmax(${minWidth}, ${maxWidth}))`\n\n  return {\n    display: 'grid',\n    gridTemplateColumns,\n    padding,\n    gap\n  }\n}\n","<template>\n  <BaseModalLayout\n    :content-title=\"$t('templateWorkflows.title', 'Workflow Templates')\"\n    class=\"workflow-template-selector-dialog\"\n  >\n    <template #leftPanel>\n      <LeftSidePanel v-model=\"selectedNavItem\" :nav-items=\"navItems\">\n        <template #header-icon>\n          <i class=\"icon-[comfy--template]\" />\n        </template>\n        <template #header-title>\n          <span class=\"text-neutral text-base\">{{\n            $t('sideToolbar.templates', 'Templates')\n          }}</span>\n        </template>\n      </LeftSidePanel>\n    </template>\n\n    <template #header>\n      <SearchBox v-model=\"searchQuery\" size=\"lg\" class=\"max-w-[384px]\" />\n    </template>\n\n    <template #header-right-area>\n      <div class=\"flex gap-2\">\n        <Button\n          v-if=\"filteredCount !== totalCount\"\n          variant=\"secondary\"\n          size=\"lg\"\n          @click=\"resetFilters\"\n        >\n          <i class=\"icon-[lucide--filter-x]\" />\n          <span>{{\n            $t('templateWorkflows.resetFilters', 'Clear Filters')\n          }}</span>\n        </Button>\n      </div>\n    </template>\n\n    <template #contentFilter>\n      <div class=\"relative flex flex-wrap justify-between gap-2 px-6 pb-4\">\n        <div class=\"flex flex-wrap gap-2\">\n          <!-- Model Filter -->\n          <MultiSelect\n            v-model=\"selectedModelObjects\"\n            v-model:search-query=\"modelSearchText\"\n            class=\"w-[250px]\"\n            :label=\"modelFilterLabel\"\n            :options=\"modelOptions\"\n            :show-search-box=\"true\"\n            :show-selected-count=\"true\"\n            :show-clear-button=\"true\"\n          >\n            <template #icon>\n              <i class=\"icon-[lucide--cpu]\" />\n            </template>\n          </MultiSelect>\n\n          <!-- Use Case Filter -->\n          <MultiSelect\n            v-model=\"selectedUseCaseObjects\"\n            :label=\"useCaseFilterLabel\"\n            :options=\"useCaseOptions\"\n            :show-search-box=\"true\"\n            :show-selected-count=\"true\"\n            :show-clear-button=\"true\"\n          >\n            <template #icon>\n              <i class=\"icon-[lucide--target]\" />\n            </template>\n          </MultiSelect>\n\n          <!-- Runs On Filter -->\n          <MultiSelect\n            v-model=\"selectedRunsOnObjects\"\n            :label=\"runsOnFilterLabel\"\n            :options=\"runsOnOptions\"\n            :show-search-box=\"true\"\n            :show-selected-count=\"true\"\n            :show-clear-button=\"true\"\n          >\n            <template #icon>\n              <i class=\"icon-[lucide--server]\" />\n            </template>\n          </MultiSelect>\n        </div>\n\n        <!-- Sort Options -->\n        <div>\n          <SingleSelect\n            v-model=\"sortBy\"\n            :label=\"$t('templateWorkflows.sorting', 'Sort by')\"\n            :options=\"sortOptions\"\n            class=\"w-62.5\"\n          >\n            <template #icon>\n              <i class=\"icon-[lucide--arrow-up-down] text-muted-foreground\" />\n            </template>\n          </SingleSelect>\n        </div>\n      </div>\n      <div\n        v-if=\"!isLoading\"\n        class=\"text-neutral px-6 pt-4 pb-2 text-2xl font-semibold\"\n      >\n        <span>\n          {{ pageTitle }}\n        </span>\n      </div>\n    </template>\n\n    <template #content>\n      <!-- No Results State (only show when loaded and no results) -->\n      <div\n        v-if=\"!isLoading && filteredTemplates.length === 0\"\n        class=\"flex h-64 flex-col items-center justify-center text-neutral-500\"\n      >\n        <i class=\"mb-4 icon-[lucide--search] h-12 w-12 opacity-50\" />\n        <p class=\"mb-2 text-lg\">\n          {{ $t('templateWorkflows.noResults', 'No templates found') }}\n        </p>\n        <p class=\"text-sm\">\n          {{\n            $t(\n              'templateWorkflows.noResultsHint',\n              'Try adjusting your search or filters'\n            )\n          }}\n        </p>\n      </div>\n      <div v-else>\n        <!-- Title -->\n        <span\n          v-if=\"isLoading\"\n          class=\"inline-block h-8 w-48 animate-pulse rounded bg-dialog-surface\"\n        ></span>\n\n        <!-- Template Cards Grid -->\n        <div\n          :key=\"templateListKey\"\n          :style=\"gridStyle\"\n          data-testid=\"template-workflows-content\"\n        >\n          <!-- Loading Skeletons (show while loading initial data) -->\n          <CardContainer\n            v-for=\"n in isLoading ? 12 : 0\"\n            :key=\"`initial-skeleton-${n}`\"\n            size=\"compact\"\n            variant=\"ghost\"\n            rounded=\"lg\"\n            class=\"hover:bg-base-background\"\n          >\n            <template #top>\n              <CardTop ratio=\"landscape\">\n                <template #default>\n                  <div\n                    class=\"h-full w-full animate-pulse bg-dialog-surface\"\n                  ></div>\n                </template>\n              </CardTop>\n            </template>\n            <template #bottom>\n              <CardBottom>\n                <div class=\"px-4 py-3\">\n                  <div\n                    class=\"mb-2 h-6 animate-pulse rounded bg-dialog-surface\"\n                  ></div>\n                  <div\n                    class=\"h-4 animate-pulse rounded bg-dialog-surface\"\n                  ></div>\n                </div>\n              </CardBottom>\n            </template>\n          </CardContainer>\n\n          <!-- Actual Template Cards -->\n          <CardContainer\n            v-for=\"template in isLoading ? [] : displayTemplates\"\n            v-show=\"isTemplateVisibleOnDistribution(template)\"\n            :key=\"template.name\"\n            ref=\"cardRefs\"\n            size=\"compact\"\n            variant=\"ghost\"\n            rounded=\"lg\"\n            :data-testid=\"`template-workflow-${template.name}`\"\n            class=\"hover:bg-base-background\"\n            @mouseenter=\"hoveredTemplate = template.name\"\n            @mouseleave=\"hoveredTemplate = null\"\n            @click=\"onLoadWorkflow(template)\"\n          >\n            <template #top>\n              <CardTop ratio=\"square\">\n                <template #default>\n                  <!-- Template Thumbnail -->\n                  <div\n                    class=\"relative h-full w-full overflow-hidden rounded-lg\"\n                  >\n                    <template v-if=\"template.mediaType === 'audio'\">\n                      <AudioThumbnail :src=\"getBaseThumbnailSrc(template)\" />\n                    </template>\n                    <template\n                      v-else-if=\"template.thumbnailVariant === 'compareSlider'\"\n                    >\n                      <CompareSliderThumbnail\n                        :base-image-src=\"getBaseThumbnailSrc(template)\"\n                        :overlay-image-src=\"getOverlayThumbnailSrc(template)\"\n                        :alt=\"\n                          getTemplateTitle(\n                            template,\n                            getEffectiveSourceModule(template)\n                          )\n                        \"\n                        :is-hovered=\"hoveredTemplate === template.name\"\n                        :is-video=\"\n                          template.mediaType === 'video' ||\n                          template.mediaSubtype === 'webp'\n                        \"\n                      />\n                    </template>\n                    <template\n                      v-else-if=\"template.thumbnailVariant === 'hoverDissolve'\"\n                    >\n                      <HoverDissolveThumbnail\n                        :base-image-src=\"getBaseThumbnailSrc(template)\"\n                        :overlay-image-src=\"getOverlayThumbnailSrc(template)\"\n                        :alt=\"\n                          getTemplateTitle(\n                            template,\n                            getEffectiveSourceModule(template)\n                          )\n                        \"\n                        :is-hovered=\"hoveredTemplate === template.name\"\n                        :is-video=\"\n                          template.mediaType === 'video' ||\n                          template.mediaSubtype === 'webp'\n                        \"\n                      />\n                    </template>\n                    <template v-else>\n                      <DefaultThumbnail\n                        :src=\"getBaseThumbnailSrc(template)\"\n                        :alt=\"\n                          getTemplateTitle(\n                            template,\n                            getEffectiveSourceModule(template)\n                          )\n                        \"\n                        :is-hovered=\"hoveredTemplate === template.name\"\n                        :is-video=\"\n                          template.mediaType === 'video' ||\n                          template.mediaSubtype === 'webp'\n                        \"\n                        :hover-zoom=\"\n                          template.thumbnailVariant === 'zoomHover' ? 16 : 5\n                        \"\n                      />\n                    </template>\n                    <ProgressSpinner\n                      v-if=\"loadingTemplate === template.name\"\n                      class=\"absolute inset-0 z-10 m-auto h-12 w-12\"\n                    />\n                  </div>\n                </template>\n                <template #bottom-right>\n                  <template v-if=\"template.tags && template.tags.length > 0\">\n                    <SquareChip\n                      v-for=\"tag in template.tags\"\n                      :key=\"tag\"\n                      :label=\"tag\"\n                    />\n                  </template>\n                </template>\n              </CardTop>\n            </template>\n            <template #bottom>\n              <CardBottom>\n                <div class=\"flex flex-col gap-2 pt-3\">\n                  <h3\n                    class=\"m-0 line-clamp-1 text-sm\"\n                    :title=\"\n                      getTemplateTitle(\n                        template,\n                        getEffectiveSourceModule(template)\n                      )\n                    \"\n                  >\n                    {{\n                      getTemplateTitle(\n                        template,\n                        getEffectiveSourceModule(template)\n                      )\n                    }}\n                  </h3>\n                  <div class=\"flex justify-between gap-2\">\n                    <div class=\"flex-1\">\n                      <p\n                        class=\"m-0 line-clamp-2 text-sm text-muted\"\n                        :title=\"getTemplateDescription(template)\"\n                      >\n                        {{ getTemplateDescription(template) }}\n                      </p>\n                    </div>\n                    <div\n                      v-if=\"template.tutorialUrl\"\n                      class=\"flex flex-col-reverse justify-center\"\n                    >\n                      <Button\n                        v-if=\"hoveredTemplate === template.name\"\n                        v-tooltip.bottom=\"$t('g.seeTutorial')\"\n                        v-bind=\"$attrs\"\n                        variant=\"inverted\"\n                        size=\"icon\"\n                        @click.stop=\"openTutorial(template)\"\n                      >\n                        <i class=\"icon-[lucide--info] size-4\" />\n                      </Button>\n                    </div>\n                  </div>\n                </div>\n              </CardBottom>\n            </template>\n          </CardContainer>\n\n          <!-- Loading More Skeletons -->\n          <CardContainer\n            v-for=\"n in isLoadingMore ? 6 : 0\"\n            :key=\"`skeleton-${n}`\"\n            size=\"compact\"\n            variant=\"ghost\"\n            rounded=\"lg\"\n            class=\"hover:bg-base-background\"\n          >\n            <template #top>\n              <CardTop ratio=\"square\">\n                <template #default>\n                  <div\n                    class=\"h-full w-full animate-pulse bg-dialog-surface\"\n                  ></div>\n                </template>\n              </CardTop>\n            </template>\n            <template #bottom>\n              <CardBottom>\n                <div class=\"px-4 py-3\">\n                  <div\n                    class=\"mb-2 h-6 animate-pulse rounded bg-dialog-surface\"\n                  ></div>\n                  <div\n                    class=\"h-4 animate-pulse rounded bg-dialog-surface\"\n                  ></div>\n                </div>\n              </CardBottom>\n            </template>\n          </CardContainer>\n        </div>\n      </div>\n\n      <!-- Load More Trigger -->\n      <div\n        v-if=\"!isLoading && hasMoreTemplates\"\n        ref=\"loadTrigger\"\n        class=\"mt-4 flex h-4 w-full items-center justify-center\"\n      >\n        <div v-if=\"isLoadingMore\" class=\"text-sm text-muted\">\n          {{ $t('templateWorkflows.loadingMore', 'Loading more...') }}\n        </div>\n      </div>\n\n      <!-- Results Summary -->\n      <div v-if=\"!isLoading\" class=\"mt-6 px-6 text-sm text-muted\">\n        {{\n          $t('templateWorkflows.resultsCount', {\n            count: filteredCount,\n            total: totalCount\n          })\n        }}\n      </div>\n    </template>\n  </BaseModalLayout>\n</template>\n\n<script setup lang=\"ts\">\nimport { useAsyncState } from '@vueuse/core'\nimport ProgressSpinner from 'primevue/progressspinner'\nimport { computed, onBeforeUnmount, onMounted, provide, ref, watch } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport CardBottom from '@/components/card/CardBottom.vue'\nimport CardContainer from '@/components/card/CardContainer.vue'\nimport CardTop from '@/components/card/CardTop.vue'\nimport SquareChip from '@/components/chip/SquareChip.vue'\nimport SearchBox from '@/components/common/SearchBox.vue'\nimport MultiSelect from '@/components/input/MultiSelect.vue'\nimport SingleSelect from '@/components/input/SingleSelect.vue'\nimport AudioThumbnail from '@/components/templates/thumbnails/AudioThumbnail.vue'\nimport CompareSliderThumbnail from '@/components/templates/thumbnails/CompareSliderThumbnail.vue'\nimport DefaultThumbnail from '@/components/templates/thumbnails/DefaultThumbnail.vue'\nimport HoverDissolveThumbnail from '@/components/templates/thumbnails/HoverDissolveThumbnail.vue'\nimport Button from '@/components/ui/button/Button.vue'\nimport BaseModalLayout from '@/components/widget/layout/BaseModalLayout.vue'\nimport LeftSidePanel from '@/components/widget/panel/LeftSidePanel.vue'\nimport { useIntersectionObserver } from '@/composables/useIntersectionObserver'\nimport { useLazyPagination } from '@/composables/useLazyPagination'\nimport { useTemplateFiltering } from '@/composables/useTemplateFiltering'\nimport { isCloud } from '@/platform/distribution/types'\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useTemplateWorkflows } from '@/platform/workflow/templates/composables/useTemplateWorkflows'\nimport { useWorkflowTemplatesStore } from '@/platform/workflow/templates/repositories/workflowTemplatesStore'\nimport type { TemplateInfo } from '@/platform/workflow/templates/types/template'\nimport { TemplateIncludeOnDistributionEnum } from '@/platform/workflow/templates/types/template'\nimport { useSystemStatsStore } from '@/stores/systemStatsStore'\nimport type { NavGroupData, NavItemData } from '@/types/navTypes'\nimport { OnCloseKey } from '@/types/widgetTypes'\nimport { createGridStyle } from '@/utils/gridUtil'\n\nconst { t } = useI18n()\n\nconst { onClose: originalOnClose } = defineProps<{\n  onClose: () => void\n}>()\n\n// Track session time for telemetry\nconst sessionStartTime = ref<number>(0)\nconst templateWasSelected = ref(false)\n\nonMounted(() => {\n  sessionStartTime.value = Date.now()\n})\n\nconst systemStatsStore = useSystemStatsStore()\n\nconst distributions = computed(() => {\n  // eslint-disable-next-line no-undef\n  switch (__DISTRIBUTION__) {\n    case 'cloud':\n      return [TemplateIncludeOnDistributionEnum.Cloud]\n    case 'localhost':\n      return [TemplateIncludeOnDistributionEnum.Local]\n    case 'desktop':\n    default:\n      if (systemStatsStore.systemStats?.system.os === 'darwin') {\n        return [\n          TemplateIncludeOnDistributionEnum.Desktop,\n          TemplateIncludeOnDistributionEnum.Mac\n        ]\n      }\n      return [\n        TemplateIncludeOnDistributionEnum.Desktop,\n        TemplateIncludeOnDistributionEnum.Windows\n      ]\n  }\n})\n\n// Wrap onClose to track session end\nconst onClose = () => {\n  if (isCloud) {\n    const timeSpentSeconds = Math.floor(\n      (Date.now() - sessionStartTime.value) / 1000\n    )\n\n    useTelemetry()?.trackTemplateLibraryClosed({\n      template_selected: templateWasSelected.value,\n      time_spent_seconds: timeSpentSeconds\n    })\n  }\n\n  originalOnClose()\n}\n\nprovide(OnCloseKey, onClose)\n\n// Workflow templates store and composable\nconst workflowTemplatesStore = useWorkflowTemplatesStore()\nconst {\n  loadTemplates,\n  loadWorkflowTemplate,\n  getTemplateThumbnailUrl,\n  getTemplateTitle,\n  getTemplateDescription\n} = useTemplateWorkflows()\n\nconst getEffectiveSourceModule = (template: TemplateInfo) =>\n  template.sourceModule || 'default'\n\nconst getBaseThumbnailSrc = (template: TemplateInfo) => {\n  const sm = getEffectiveSourceModule(template)\n  return getTemplateThumbnailUrl(template, sm, sm === 'default' ? '1' : '')\n}\n\nconst getOverlayThumbnailSrc = (template: TemplateInfo) => {\n  const sm = getEffectiveSourceModule(template)\n  return getTemplateThumbnailUrl(template, sm, sm === 'default' ? '2' : '')\n}\n\n// Open tutorial in new tab\nconst openTutorial = (template: TemplateInfo) => {\n  if (template.tutorialUrl) {\n    window.open(template.tutorialUrl, '_blank')\n  }\n}\n\n// Get navigation items from the store, with skeleton items while loading\nconst navItems = computed<(NavItemData | NavGroupData)[]>(() => {\n  // Show skeleton navigation items while loading\n  if (isLoading.value) {\n    return [\n      {\n        id: 'skeleton-all',\n        label: 'All Templates',\n        icon: 'icon-[lucide--layout-grid]'\n      },\n      {\n        id: 'skeleton-basics',\n        label: 'Basics',\n        icon: 'icon-[lucide--graduation-cap]'\n      },\n      {\n        title: 'Generation Type',\n        items: [\n          { id: 'skeleton-1', label: '...', icon: 'icon-[lucide--loader-2]' },\n          { id: 'skeleton-2', label: '...', icon: 'icon-[lucide--loader-2]' }\n        ]\n      },\n      {\n        title: 'Closed Source Models',\n        items: [\n          { id: 'skeleton-3', label: '...', icon: 'icon-[lucide--loader-2]' }\n        ]\n      }\n    ]\n  }\n  return workflowTemplatesStore.navGroupedTemplates\n})\n\nconst gridStyle = computed(() => createGridStyle())\n\n// Get enhanced templates for better filtering\nconst allTemplates = computed(() => {\n  return workflowTemplatesStore.enhancedTemplates\n})\n\n// Navigation\nconst selectedNavItem = ref<string | null>('all')\n\n// Filter templates based on selected navigation item\nconst navigationFilteredTemplates = computed(() => {\n  if (!selectedNavItem.value) {\n    return allTemplates.value\n  }\n\n  return workflowTemplatesStore.filterTemplatesByCategory(selectedNavItem.value)\n})\n\n// Template filtering\nconst {\n  searchQuery,\n  selectedModels,\n  selectedUseCases,\n  selectedRunsOn,\n  sortBy,\n  filteredTemplates,\n  availableModels,\n  availableUseCases,\n  availableRunsOn,\n  filteredCount,\n  totalCount,\n  resetFilters\n} = useTemplateFiltering(navigationFilteredTemplates)\n\n/**\n * Coordinates state between the selected navigation item and the sort order to\n * create deterministic, predictable behavior.\n * @param source The origin of the change ('nav' or 'sort').\n */\nconst coordinateNavAndSort = (source: 'nav' | 'sort') => {\n  const isPopularNav = selectedNavItem.value === 'popular'\n  const isPopularSort = sortBy.value === 'popular'\n\n  if (source === 'nav') {\n    if (isPopularNav && !isPopularSort) {\n      // When navigating to 'Popular' category, automatically set sort to 'Popular'.\n      sortBy.value = 'popular'\n    } else if (!isPopularNav && isPopularSort) {\n      // When navigating away from 'Popular' category while sort is 'Popular', reset sort to default.\n      sortBy.value = 'default'\n    }\n  } else if (source === 'sort') {\n    // When sort is changed away from 'Popular' while in the 'Popular' category,\n    // reset the category to 'All Templates' to avoid a confusing state.\n    if (isPopularNav && !isPopularSort) {\n      selectedNavItem.value = 'all'\n    }\n  }\n}\n\n// Watch for changes from the two sources ('nav' and 'sort') and trigger the coordinator.\nwatch(selectedNavItem, () => coordinateNavAndSort('nav'))\nwatch(sortBy, () => coordinateNavAndSort('sort'))\n\n// Convert between string array and object array for MultiSelect component\nconst selectedModelObjects = computed({\n  get() {\n    return selectedModels.value.map((model) => ({ name: model, value: model }))\n  },\n  set(value: { name: string; value: string }[]) {\n    selectedModels.value = value.map((item) => item.value)\n  }\n})\n\nconst selectedUseCaseObjects = computed({\n  get() {\n    return selectedUseCases.value.map((useCase) => ({\n      name: useCase,\n      value: useCase\n    }))\n  },\n  set(value: { name: string; value: string }[]) {\n    selectedUseCases.value = value.map((item) => item.value)\n  }\n})\n\nconst selectedRunsOnObjects = computed({\n  get() {\n    return selectedRunsOn.value.map((runsOn) => ({\n      name: runsOn,\n      value: runsOn\n    }))\n  },\n  set(value: { name: string; value: string }[]) {\n    selectedRunsOn.value = value.map((item) => item.value)\n  }\n})\n\n// Loading states\nconst loadingTemplate = ref<string | null>(null)\nconst hoveredTemplate = ref<string | null>(null)\nconst cardRefs = ref<HTMLElement[]>([])\n\n// Force re-render key for templates when sorting changes\nconst templateListKey = ref(0)\n\n// Search text for model filter\nconst modelSearchText = ref<string>('')\n\n// Filter options\nconst modelOptions = computed(() =>\n  availableModels.value.map((model) => ({\n    name: model,\n    value: model\n  }))\n)\n\nconst useCaseOptions = computed(() =>\n  availableUseCases.value.map((useCase) => ({\n    name: useCase,\n    value: useCase\n  }))\n)\n\nconst runsOnOptions = computed(() =>\n  availableRunsOn.value.map((runsOn) => ({\n    name: runsOn,\n    value: runsOn\n  }))\n)\n\n// Filter labels\nconst modelFilterLabel = computed(() => {\n  if (selectedModelObjects.value.length === 0) {\n    return t('templateWorkflows.modelFilter', 'Model Filter')\n  } else if (selectedModelObjects.value.length === 1) {\n    return selectedModelObjects.value[0].name\n  } else {\n    return t('templateWorkflows.modelsSelected', {\n      count: selectedModelObjects.value.length\n    })\n  }\n})\n\nconst useCaseFilterLabel = computed(() => {\n  if (selectedUseCaseObjects.value.length === 0) {\n    return t('templateWorkflows.useCaseFilter', 'Use Case')\n  } else if (selectedUseCaseObjects.value.length === 1) {\n    return selectedUseCaseObjects.value[0].name\n  } else {\n    return t('templateWorkflows.useCasesSelected', {\n      count: selectedUseCaseObjects.value.length\n    })\n  }\n})\n\nconst runsOnFilterLabel = computed(() => {\n  if (selectedRunsOnObjects.value.length === 0) {\n    return t('templateWorkflows.runsOnFilter', 'Runs On')\n  } else if (selectedRunsOnObjects.value.length === 1) {\n    return selectedRunsOnObjects.value[0].name\n  } else {\n    return t('templateWorkflows.runsOnSelected', {\n      count: selectedRunsOnObjects.value.length\n    })\n  }\n})\n\n// Sort options\nconst sortOptions = computed(() => [\n  {\n    name: t('templateWorkflows.sort.default', 'Default'),\n    value: 'default'\n  },\n  {\n    name: t('templateWorkflows.sort.recommended', 'Recommended'),\n    value: 'recommended'\n  },\n  {\n    name: t('templateWorkflows.sort.popular', 'Popular'),\n    value: 'popular'\n  },\n  { name: t('templateWorkflows.sort.newest', 'Newest'), value: 'newest' },\n  {\n    name: t('templateWorkflows.sort.vramLowToHigh', 'VRAM Usage (Low to High)'),\n    value: 'vram-low-to-high'\n  },\n  {\n    name: t(\n      'templateWorkflows.sort.modelSizeLowToHigh',\n      'Model Size (Low to High)'\n    ),\n    value: 'model-size-low-to-high'\n  },\n  {\n    name: t('templateWorkflows.sort.alphabetical', 'Alphabetical (A-Z)'),\n    value: 'alphabetical'\n  }\n])\n\n// Lazy pagination setup\nconst loadTrigger = ref<HTMLElement | null>(null)\nconst shouldUsePagination = computed(() => !searchQuery.value.trim())\n\nconst {\n  paginatedItems: paginatedTemplates,\n  isLoading: isLoadingMore,\n  hasMoreItems: hasMoreTemplates,\n  loadNextPage,\n  reset: resetPagination\n} = useLazyPagination(filteredTemplates, { itemsPerPage: 24 }) // Load 24 items per page\n\n// Display templates (all when searching, paginated when not)\nconst displayTemplates = computed(() => {\n  return shouldUsePagination.value\n    ? paginatedTemplates.value\n    : filteredTemplates.value\n})\n\n// Set up intersection observer for lazy loading\nuseIntersectionObserver(loadTrigger, () => {\n  if (\n    shouldUsePagination.value &&\n    hasMoreTemplates.value &&\n    !isLoadingMore.value\n  ) {\n    void loadNextPage()\n  }\n})\n\n// Reset pagination when filters change\nwatch(\n  [\n    searchQuery,\n    selectedNavItem,\n    sortBy,\n    selectedModels,\n    selectedUseCases,\n    selectedRunsOn\n  ],\n  () => {\n    resetPagination()\n    // Clear loading state and force re-render of template list\n    loadingTemplate.value = null\n    templateListKey.value++\n  }\n)\n\n// Methods\nconst onLoadWorkflow = async (template: any) => {\n  loadingTemplate.value = template.name\n  try {\n    await loadWorkflowTemplate(\n      template.name,\n      getEffectiveSourceModule(template)\n    )\n    templateWasSelected.value = true\n    onClose()\n  } finally {\n    loadingTemplate.value = null\n  }\n}\n\nconst pageTitle = computed(() => {\n  const navItem = navItems.value.find((item) =>\n    'id' in item\n      ? item.id === selectedNavItem.value\n      : item.items?.some((sub) => sub.id === selectedNavItem.value)\n  )\n\n  if (!navItem) {\n    return t('templateWorkflows.allTemplates', 'All Templates')\n  }\n\n  return 'id' in navItem\n    ? navItem.label\n    : navItem.items?.find((i) => i.id === selectedNavItem.value)?.label ||\n        t('templateWorkflows.allTemplates', 'All Templates')\n})\n\n// Initialize templates loading with useAsyncState\nconst { isLoading } = useAsyncState(\n  async () => {\n    // Run all operations in parallel for better performance\n    await Promise.all([\n      loadTemplates(),\n      workflowTemplatesStore.loadWorkflowTemplates()\n    ])\n    return true\n  },\n  false, // initial state\n  {\n    immediate: true // Start loading immediately\n  }\n)\n\nconst isTemplateVisibleOnDistribution = (template: TemplateInfo) => {\n  return (template.includeOnDistributions?.length ?? 0) > 0\n    ? distributions.value.some((d) =>\n        template.includeOnDistributions?.includes(d)\n      )\n    : true\n}\n\nonBeforeUnmount(() => {\n  cardRefs.value = [] // Release DOM refs\n})\n</script>\n\n<style>\n/* Ensure the workflow template selector dialog fits within provided dialog */\n.workflow-template-selector-dialog.base-widget-layout {\n  width: 100% !important;\n  max-width: 1400px;\n  height: 100% !important;\n  aspect-ratio: auto !important;\n}\n\n@media (min-width: 1600px) {\n  .workflow-template-selector-dialog.base-widget-layout {\n    max-width: 1600px;\n  }\n}\n</style>\n","import WorkflowTemplateSelectorDialog from '@/components/custom/widget/WorkflowTemplateSelectorDialog.vue'\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useDialogService } from '@/services/dialogService'\nimport { useDialogStore } from '@/stores/dialogStore'\n\nconst DIALOG_KEY = 'global-workflow-template-selector'\n\nexport const useWorkflowTemplateSelectorDialog = () => {\n  const dialogService = useDialogService()\n  const dialogStore = useDialogStore()\n\n  function hide() {\n    dialogStore.closeDialog({ key: DIALOG_KEY })\n  }\n\n  function show(source: 'sidebar' | 'menu' | 'command' = 'command') {\n    useTelemetry()?.trackTemplateLibraryOpened({ source })\n\n    dialogService.showLayoutDialog({\n      key: DIALOG_KEY,\n      component: WorkflowTemplateSelectorDialog,\n      props: {\n        onClose: hide\n      },\n      dialogComponentProps: {\n        pt: {\n          content: { class: '!px-0 overflow-hidden h-full !py-0' },\n          root: {\n            style:\n              'width: 90vw; height: 85vh; max-width: 1400px; display: flex;'\n          }\n        }\n      }\n    })\n  }\n\n  return {\n    show,\n    hide\n  }\n}\n","import { useEventListener } from '@vueuse/core'\n\nexport const whileMouseDown = (\n  elementOrEvent: HTMLElement | Event,\n  callback: (iteration: number) => void,\n  interval: number = 30\n) => {\n  const element =\n    elementOrEvent instanceof HTMLElement\n      ? elementOrEvent\n      : (elementOrEvent.target as HTMLElement)\n\n  let iteration = 0\n\n  const intervalId = setInterval(() => {\n    callback(iteration++)\n  }, interval)\n\n  const dispose = () => {\n    clearInterval(intervalId)\n    disposeGlobal()\n    disposeLocal()\n  }\n\n  // Listen for mouseup globally to catch cases where user drags out of element\n  const disposeGlobal = useEventListener(document, 'mouseup', dispose)\n  const disposeLocal = useEventListener(element, 'mouseup', dispose)\n\n  return {\n    dispose: dispose\n  }\n}\n","<template>\n  <div\n    v-tooltip=\"{\n      value: t('sideToolbar.labels.menu'),\n      showDelay: 300,\n      hideDelay: 300\n    }\"\n    class=\"comfy-menu-button-wrapper flex shrink-0 cursor-pointer flex-col items-center justify-center p-2 transition-colors\"\n    :class=\"{\n      'comfy-menu-button-active': menuRef?.visible\n    }\"\n    @click=\"onLogoMenuClick($event)\"\n  >\n    <div class=\"flex h-8 w-8 items-center justify-center rounded-lg bg-black\">\n      <ComfyLogo\n        alt=\"ComfyUI Logo\"\n        class=\"comfyui-logo h-[18px] w-[18px] text-white\"\n        mode=\"fill\"\n      />\n    </div>\n  </div>\n\n  <TieredMenu\n    ref=\"menuRef\"\n    :model=\"translatedItems\"\n    :popup=\"true\"\n    class=\"comfy-command-menu\"\n    @show=\"onMenuShow\"\n  >\n    <template #item=\"{ item, props }\">\n      <a\n        v-if=\"item.key !== 'nodes-2.0-toggle'\"\n        class=\"p-menubar-item-link px-4 py-2\"\n        v-bind=\"props.action\"\n        :href=\"item.url\"\n        target=\"_blank\"\n        :class=\"typeof item.class === 'function' ? item.class() : item.class\"\n        @mousedown=\"\n          isZoomCommand(item) ? handleZoomMouseDown(item, $event) : undefined\n        \"\n        @click=\"handleItemClick(item, $event)\"\n      >\n        <i\n          v-if=\"hasActiveStateSiblings(item)\"\n          class=\"p-menubar-item-icon pi pi-check text-sm\"\n          :class=\"{ invisible: !item.comfyCommand?.active?.() }\"\n        />\n        <span\n          v-else-if=\"\n            item.icon && item.comfyCommand?.id !== 'Comfy.NewBlankWorkflow'\n          \"\n          class=\"p-menubar-item-icon text-sm\"\n          :class=\"item.icon\"\n        />\n        <span class=\"p-menubar-item-label text-nowrap\">{{ item.label }}</span>\n        <i\n          v-if=\"item.comfyCommand?.id === 'Comfy.NewBlankWorkflow'\"\n          class=\"ml-auto\"\n          :class=\"item.icon\"\n        />\n        <span\n          v-if=\"item?.comfyCommand?.keybinding\"\n          class=\"keybinding-tag ml-auto rounded border border-surface p-1 text-xs text-nowrap text-muted\"\n        >\n          {{ item.comfyCommand.keybinding.combo.toString() }}\n        </span>\n        <i v-if=\"item.items\" class=\"pi pi-angle-right ml-auto\" />\n      </a>\n      <div\n        v-else\n        class=\"flex items-center justify-between px-4 py-2\"\n        @click.stop=\"handleNodes2ToggleClick\"\n      >\n        <span class=\"p-menubar-item-label text-nowrap\">{{ item.label }}</span>\n        <Tag severity=\"info\" class=\"ml-2 text-xs\">{{ $t('g.beta') }}</Tag>\n        <ToggleSwitch\n          v-model=\"nodes2Enabled\"\n          class=\"ml-4\"\n          :aria-label=\"item.label\"\n          :pt=\"{\n            root: {\n              style: {\n                width: '38px',\n                height: '20px'\n              }\n            },\n            handle: {\n              style: {\n                width: '16px',\n                height: '16px'\n              }\n            }\n          }\"\n          @click.stop\n          @update:model-value=\"onNodes2ToggleChange\"\n        />\n      </div>\n    </template>\n  </TieredMenu>\n</template>\n\n<script setup lang=\"ts\">\nimport type { MenuItem } from 'primevue/menuitem'\nimport Tag from 'primevue/tag'\nimport TieredMenu from 'primevue/tieredmenu'\nimport type { TieredMenuMethods, TieredMenuState } from 'primevue/tieredmenu'\nimport ToggleSwitch from 'primevue/toggleswitch'\nimport { computed, nextTick, ref } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport SettingDialogHeader from '@/components/dialog/header/SettingDialogHeader.vue'\nimport ComfyLogo from '@/components/icons/ComfyLogo.vue'\nimport { useWorkflowTemplateSelectorDialog } from '@/composables/useWorkflowTemplateSelectorDialog'\nimport SettingDialogContent from '@/platform/settings/components/SettingDialogContent.vue'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useColorPaletteService } from '@/services/colorPaletteService'\nimport { useCommandStore } from '@/stores/commandStore'\nimport { useDialogStore } from '@/stores/dialogStore'\nimport { useMenuItemStore } from '@/stores/menuItemStore'\nimport { useColorPaletteStore } from '@/stores/workspace/colorPaletteStore'\nimport { normalizeI18nKey } from '@/utils/formatUtil'\nimport { whileMouseDown } from '@/utils/mouseDownUtil'\nimport { useManagerState } from '@/workbench/extensions/manager/composables/useManagerState'\nimport { ManagerTab } from '@/workbench/extensions/manager/types/comfyManagerTypes'\n\nconst { t } = useI18n()\nconst commandStore = useCommandStore()\nconst menuItemStore = useMenuItemStore()\nconst colorPaletteStore = useColorPaletteStore()\nconst colorPaletteService = useColorPaletteService()\nconst dialogStore = useDialogStore()\nconst managerState = useManagerState()\nconst settingStore = useSettingStore()\n\nconst menuRef = ref<\n  ({ dirty: boolean } & TieredMenuMethods & TieredMenuState) | null\n>(null)\n\nconst nodes2Enabled = computed({\n  get: () => settingStore.get('Comfy.VueNodes.Enabled') ?? false,\n  set: async (value: boolean) => {\n    await settingStore.set('Comfy.VueNodes.Enabled', value)\n  }\n})\n\nconst telemetry = useTelemetry()\n\nfunction onLogoMenuClick(event: MouseEvent) {\n  telemetry?.trackUiButtonClicked({\n    button_id: 'sidebar_comfy_menu_opened'\n  })\n  menuRef.value?.toggle(event)\n}\n\nconst translateMenuItem = (item: MenuItem): MenuItem => {\n  const label = typeof item.label === 'function' ? item.label() : item.label\n  const translatedLabel = label\n    ? t(`menuLabels.${normalizeI18nKey(label)}`, label)\n    : undefined\n\n  return {\n    ...item,\n    label: translatedLabel,\n    items: item.items?.map(translateMenuItem)\n  }\n}\n\nconst showSettings = (defaultPanel?: string) => {\n  dialogStore.showDialog({\n    key: 'global-settings',\n    headerComponent: SettingDialogHeader,\n    component: SettingDialogContent,\n    props: {\n      defaultPanel\n    }\n  })\n}\n\nconst showManageExtensions = async () => {\n  await managerState.openManager({\n    initialTab: ManagerTab.All,\n    showToastOnLegacyError: false\n  })\n}\n\nconst themeMenuItems = computed(() => {\n  return colorPaletteStore.palettes.map((palette) => ({\n    key: `theme-${palette.id}`,\n    label: palette.name,\n    parentPath: 'theme',\n    comfyCommand: {\n      active: () => colorPaletteStore.activePaletteId === palette.id\n    },\n    command: async () => {\n      await colorPaletteService.loadColorPalette(palette.id)\n    }\n  }))\n})\n\nconst extraMenuItems = computed(() => [\n  { separator: true },\n  {\n    key: 'theme',\n    label: t('menu.theme'),\n    items: themeMenuItems.value\n  },\n  {\n    key: 'nodes-2.0-toggle',\n    label: 'Nodes 2.0'\n  },\n  { separator: true },\n  {\n    key: 'browse-templates',\n    label: t('menuLabels.Browse Templates'),\n    icon: 'icon-[comfy--template]',\n    command: () => useWorkflowTemplateSelectorDialog().show('menu')\n  },\n  {\n    key: 'settings',\n    label: t('g.settings'),\n    icon: 'mdi mdi-cog-outline',\n    command: () => {\n      telemetry?.trackUiButtonClicked({\n        button_id: 'sidebar_settings_menu_opened'\n      })\n      showSettings()\n    }\n  },\n  {\n    key: 'manage-extensions',\n    label: t('menu.manageExtensions'),\n    icon: 'mdi mdi-puzzle-outline',\n    command: showManageExtensions\n  }\n])\n\nconst translatedItems = computed(() => {\n  const items = menuItemStore.menuItems.map(translateMenuItem)\n  let helpIndex = items.findIndex((item) => item.key === 'Help')\n  let helpItem: MenuItem | undefined\n\n  if (helpIndex !== -1) {\n    items[helpIndex].icon = 'mdi mdi-help-circle-outline'\n    // If help is not the last item (i.e. we have extension commands), separate them\n    const isLastItem = helpIndex !== items.length - 1\n    helpItem = items.splice(\n      helpIndex,\n      1,\n      ...(isLastItem\n        ? [\n            {\n              separator: true\n            }\n          ]\n        : [])\n    )[0]\n  }\n  helpIndex = items.length\n\n  items.splice(\n    helpIndex,\n    0,\n    ...extraMenuItems.value,\n    ...(helpItem\n      ? [\n          {\n            separator: true\n          },\n          helpItem\n        ]\n      : [])\n  )\n\n  return items\n})\n\nconst onMenuShow = () => {\n  void nextTick(() => {\n    // Force the menu to show submenus on hover\n    if (menuRef.value) {\n      menuRef.value.dirty = true\n    }\n  })\n}\n\nconst isZoomCommand = (item: MenuItem) => {\n  return (\n    item.comfyCommand?.id === 'Comfy.Canvas.ZoomIn' ||\n    item.comfyCommand?.id === 'Comfy.Canvas.ZoomOut'\n  )\n}\n\nconst handleZoomMouseDown = (item: MenuItem, event: MouseEvent) => {\n  if (item.comfyCommand) {\n    whileMouseDown(\n      event,\n      async () => {\n        await commandStore.execute(item.comfyCommand!.id)\n      },\n      50\n    )\n  }\n}\n\nconst handleItemClick = (item: MenuItem, event: MouseEvent) => {\n  // Prevent the menu from closing for zoom commands or commands that have active state\n  if (isZoomCommand(item) || item.comfyCommand?.active) {\n    event.preventDefault()\n    event.stopPropagation()\n    if (item.comfyCommand?.active) {\n      item.command?.({\n        item,\n        originalEvent: event\n      })\n    }\n    return false\n  }\n}\n\nconst hasActiveStateSiblings = (item: MenuItem): boolean => {\n  // Check if this item has siblings with active state (either from store or theme items)\n  return (\n    item.parentPath &&\n    (item.parentPath === 'theme' ||\n      menuItemStore.menuItemHasActiveStateChildren[item.parentPath])\n  )\n}\n\nconst handleNodes2ToggleClick = () => {\n  return false\n}\n\nconst onNodes2ToggleChange = async (value: boolean) => {\n  await settingStore.set('Comfy.VueNodes.Enabled', value)\n  telemetry?.trackUiButtonClicked({\n    button_id: `menu_nodes_2.0_toggle_${value ? 'enabled' : 'disabled'}`\n  })\n}\n</script>\n\n<style scoped>\n.comfy-menu-button-wrapper {\n  width: var(--sidebar-width);\n  height: var(--sidebar-item-height);\n}\n\n.comfy-menu-button-wrapper:hover {\n  background: var(--interface-panel-hover-surface);\n}\n\n.comfy-menu-button-active,\n.comfy-menu-button-active:hover {\n  background: var(--interface-panel-selected-surface);\n}\n\n.keybinding-tag {\n  background: var(--p-content-hover-background);\n  border-color: var(--p-content-border-color);\n  border-style: solid;\n}\n</style>\n\n<style>\n.comfy-command-menu {\n  --p-tieredmenu-item-focus-background: color-mix(\n    in srgb,\n    var(--fg-color) 15%,\n    transparent\n  );\n  --p-tieredmenu-item-active-background: color-mix(\n    in srgb,\n    var(--fg-color) 10%,\n    transparent\n  );\n}\n\n.comfy-command-menu ul {\n  background-color: var(--comfy-menu-bg) !important;\n}\n</style>\n","<template>\n  <Button\n    v-tooltip=\"{\n      value: computedTooltip,\n      showDelay: 300,\n      hideDelay: 300\n    }\"\n    :class=\"\n      cn(\n        'side-bar-button cursor-pointer border-none',\n        selected && 'side-bar-button-selected'\n      )\n    \"\n    variant=\"muted-textonly\"\n    :aria-label=\"computedTooltip\"\n    @click=\"emit('click', $event)\"\n  >\n    <div class=\"side-bar-button-content\">\n      <slot name=\"icon\">\n        <OverlayBadge v-if=\"shouldShowBadge\" :value=\"overlayValue\">\n          <i\n            v-if=\"typeof icon === 'string'\"\n            :class=\"icon + ' side-bar-button-icon'\"\n          />\n          <component :is=\"icon\" v-else class=\"side-bar-button-icon\" />\n        </OverlayBadge>\n        <i\n          v-else-if=\"typeof icon === 'string'\"\n          :class=\"icon + ' side-bar-button-icon'\"\n        />\n        <component\n          :is=\"icon\"\n          v-else-if=\"typeof icon === 'object'\"\n          class=\"side-bar-button-icon\"\n        />\n      </slot>\n      <span v-if=\"label && !isSmall\" class=\"side-bar-button-label\">{{\n        t(label)\n      }}</span>\n    </div>\n  </Button>\n</template>\n\n<script setup lang=\"ts\">\nimport OverlayBadge from 'primevue/overlaybadge'\nimport { computed } from 'vue'\nimport type { Component } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport Button from '@/components/ui/button/Button.vue'\nimport { cn } from '@/utils/tailwindUtil'\n\nconst { t } = useI18n()\nconst {\n  icon = '',\n  selected = false,\n  tooltip = '',\n  tooltipSuffix = '',\n  iconBadge = '',\n  label = '',\n  isSmall = false\n} = defineProps<{\n  icon?: string | Component\n  selected?: boolean\n  tooltip?: string\n  tooltipSuffix?: string\n  iconBadge?: string | (() => string | null)\n  label?: string\n  isSmall?: boolean\n}>()\n\nconst emit = defineEmits<{\n  (e: 'click', event: MouseEvent): void\n}>()\nconst overlayValue = computed(() =>\n  typeof iconBadge === 'function' ? (iconBadge() ?? '') : iconBadge\n)\nconst shouldShowBadge = computed(() => !!overlayValue.value)\nconst computedTooltip = computed(() => t(tooltip) + tooltipSuffix)\n</script>\n\n<style>\n.side-bar-button-icon {\n  font-size: var(--sidebar-icon-size) !important;\n}\n\n.side-bar-button-selected {\n  background-color: var(--interface-panel-selected-surface);\n  color: var(--content-hover-fg);\n}\n.side-bar-button:hover {\n  background-color: var(--interface-panel-hover-surface);\n  color: var(--content-hover-fg);\n}\n\n.side-bar-button-selected .side-bar-button-icon {\n  font-size: var(--sidebar-icon-size) !important;\n}\n</style>\n\n<style scoped>\n@reference '../../assets/css/style.css';\n\n.side-bar-button {\n  width: var(--sidebar-width);\n  height: var(--sidebar-item-height);\n  border-radius: 0;\n  flex-shrink: 0;\n}\n\n.side-tool-bar-end .side-bar-button {\n  height: var(--sidebar-width);\n}\n\n.side-bar-button-content {\n  @apply flex flex-col items-center gap-2;\n}\n\n.side-bar-button-label {\n  @apply text-[10px] text-center;\n  line-height: 1;\n}\n\n.comfyui-body-left .side-bar-button.side-bar-button-selected,\n.comfyui-body-left .side-bar-button.side-bar-button-selected:hover {\n  border-left: 4px solid var(--p-button-text-primary-color);\n}\n\n.comfyui-body-right .side-bar-button.side-bar-button-selected,\n.comfyui-body-right .side-bar-button.side-bar-button-selected:hover {\n  border-right: 4px solid var(--p-button-text-primary-color);\n}\n</style>\n","<template>\n  <SidebarIcon\n    icon=\"icon-[ph--terminal-bold]\"\n    :label=\"$t('sideToolbar.labels.console')\"\n    :tooltip=\"$t('menu.toggleBottomPanel')\"\n    :selected=\"bottomPanelStore.activePanel == 'terminal'\"\n    @click=\"toggleConsole\"\n  />\n</template>\n\n<script setup lang=\"ts\">\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useBottomPanelStore } from '@/stores/workspace/bottomPanelStore'\n\nimport SidebarIcon from './SidebarIcon.vue'\n\nconst bottomPanelStore = useBottomPanelStore()\n\n/**\n * Toggle console bottom panel and track UI button click.\n */\nconst toggleConsole = () => {\n  useTelemetry()?.trackUiButtonClicked({\n    button_id: 'sidebar_bottom_panel_console_toggled'\n  })\n  bottomPanelStore.toggleBottomPanel()\n}\n</script>\n","<template>\n  <SidebarIcon\n    icon=\"icon-[lucide--settings]\"\n    :label=\"$t('g.settings')\"\n    :tooltip=\"tooltipText\"\n    @click=\"showSettingsDialog\"\n  />\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useCommandStore } from '@/stores/commandStore'\n\nimport SidebarIcon from './SidebarIcon.vue'\n\nconst { t } = useI18n()\nconst { getCommand, formatKeySequence } = useCommandStore()\nconst command = getCommand('Comfy.ShowSettingsDialog')\n\nconst tooltipText = computed(\n  () => `${t('g.settings')} (${formatKeySequence(command)})`\n)\n\n/**\n * Toggle keyboard shortcuts panel and track UI button click.\n */\nconst showSettingsDialog = () => {\n  command.function()\n  useTelemetry()?.trackUiButtonClicked({\n    button_id: 'sidebar_settings_button_clicked'\n  })\n}\n</script>\n","<template>\n  <SidebarIcon\n    icon=\"icon-[lucide--keyboard]\"\n    :label=\"$t('shortcuts.shortcuts')\"\n    :tooltip=\"tooltipText\"\n    :selected=\"isShortcutsPanelVisible\"\n    @click=\"toggleShortcutsPanel\"\n  />\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useCommandStore } from '@/stores/commandStore'\nimport { useBottomPanelStore } from '@/stores/workspace/bottomPanelStore'\n\nimport SidebarIcon from './SidebarIcon.vue'\n\nconst { t } = useI18n()\nconst bottomPanelStore = useBottomPanelStore()\nconst commandStore = useCommandStore()\nconst command = commandStore.getCommand('Workspace.ToggleBottomPanel.Shortcuts')\nconst { formatKeySequence } = commandStore\n\nconst isShortcutsPanelVisible = computed(\n  () => bottomPanelStore.activePanel === 'shortcuts'\n)\n\nconst tooltipText = computed(\n  () => `${t('shortcuts.keyboardShortcuts')} (${formatKeySequence(command)})`\n)\n\n/**\n * Toggle keyboard shortcuts panel and track UI button click.\n */\nconst toggleShortcutsPanel = () => {\n  useTelemetry()?.trackUiButtonClicked({\n    button_id: 'sidebar_shortcuts_panel_toggled'\n  })\n  bottomPanelStore.togglePanel('shortcuts')\n}\n</script>\n","<template>\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    :width=\"size\"\n    :height=\"size\"\n    viewBox=\"0 0 16 16\"\n    fill=\"none\"\n    :class=\"iconClass\"\n  >\n    <g clip-path=\"url(#clip0_1099_16244)\">\n      <path\n        d=\"M4.99992 3.00016C4.99992 2.07969 5.74611 1.3335 6.66658 1.3335C7.58706 1.3335 8.33325 2.07969 8.33325 3.00016V4.00016H8.99992C9.9318 4.00016 10.3977 4.00016 10.7653 4.1524C11.2553 4.35539 11.6447 4.74474 11.8477 5.2348C11.9999 5.60234 11.9999 6.06828 11.9999 7.00016H12.9999C13.9204 7.00016 14.6666 7.74635 14.6666 8.66683C14.6666 9.5873 13.9204 10.3335 12.9999 10.3335H11.9999V11.4668C11.9999 12.5869 11.9999 13.147 11.7819 13.5748C11.5902 13.9511 11.2842 14.2571 10.9079 14.4488C10.4801 14.6668 9.92002 14.6668 8.79992 14.6668H8.33325V13.5002C8.33325 12.6717 7.66168 12.0002 6.83325 12.0002C6.00482 12.0002 5.33325 12.6717 5.33325 13.5002V14.6668H4.53325C3.41315 14.6668 2.85309 14.6668 2.42527 14.4488C2.04895 14.2571 1.74299 13.9511 1.55124 13.5748C1.33325 13.147 1.33325 12.5869 1.33325 11.4668V10.3335H2.33325C3.25373 10.3335 3.99992 9.5873 3.99992 8.66683C3.99992 7.74635 3.25373 7.00016 2.33325 7.00016H1.33325C1.33325 6.06828 1.33325 5.60234 1.48549 5.2348C1.68848 4.74474 2.07783 4.35539 2.56789 4.1524C2.93543 4.00016 3.40137 4.00016 4.33325 4.00016H4.99992V3.00016Z\"\n        :stroke=\"color\"\n        stroke-width=\"1.2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n      />\n    </g>\n    <defs>\n      <clipPath id=\"clip0_1099_16244\">\n        <rect width=\"16\" height=\"16\" fill=\"white\" />\n      </clipPath>\n    </defs>\n  </svg>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\n\ninterface Props {\n  size?: number | string\n  color?: string\n  class?: string\n}\nconst {\n  size = 16,\n  color = 'currentColor',\n  class: className\n} = defineProps<Props>()\nconst iconClass = computed(() => className || '')\n</script>\n","<template>\n  <div\n    class=\"help-center-menu flex flex-col items-start gap-1\"\n    role=\"menu\"\n    :aria-label=\"$t('help.helpCenterMenu')\"\n  >\n    <!-- Main Menu Items -->\n    <div class=\"w-full\">\n      <nav class=\"flex w-full flex-col gap-2\" role=\"menubar\">\n        <button\n          v-for=\"menuItem in menuItems\"\n          v-show=\"menuItem.visible !== false\"\n          :key=\"menuItem.key\"\n          type=\"button\"\n          class=\"help-menu-item\"\n          :class=\"{ 'more-item': menuItem.key === 'more' }\"\n          role=\"menuitem\"\n          @click=\"menuItem.action\"\n          @mouseenter=\"onMenuItemHover(menuItem.key, $event)\"\n          @mouseleave=\"onMenuItemLeave(menuItem.key)\"\n        >\n          <div class=\"help-menu-icon-container\">\n            <div class=\"help-menu-icon\">\n              <component\n                :is=\"menuItem.icon\"\n                v-if=\"typeof menuItem.icon === 'object'\"\n                :size=\"16\"\n              />\n              <i v-else :class=\"menuItem.icon\" />\n            </div>\n            <div v-if=\"menuItem.showRedDot\" class=\"menu-red-dot\" />\n          </div>\n          <span class=\"menu-label\">{{ menuItem.label }}</span>\n          <i\n            v-if=\"menuItem.showExternalIcon\"\n            class=\"icon-[lucide--external-link] text-primary w-4 h-4 ml-auto\"\n          />\n          <i\n            v-if=\"menuItem.key === 'more'\"\n            class=\"pi pi-chevron-right ml-auto\"\n          />\n        </button>\n      </nav>\n      <div\n        class=\"flex h-4 flex-col items-center justify-between self-stretch p-2\"\n      >\n        <div class=\"w-full border-b border-interface-menu-stroke\" />\n      </div>\n    </div>\n\n    <!-- More Submenu -->\n    <Teleport to=\"body\">\n      <div\n        v-if=\"isSubmenuVisible\"\n        ref=\"submenuRef\"\n        class=\"more-submenu\"\n        :style=\"submenuStyle\"\n        @mouseenter=\"onSubmenuHover\"\n        @mouseleave=\"onSubmenuLeave\"\n      >\n        <template\n          v-for=\"submenuItem in moreMenuItem?.items\"\n          :key=\"submenuItem.key\"\n        >\n          <div\n            v-if=\"submenuItem.type === 'divider'\"\n            v-show=\"submenuItem.visible !== false\"\n            class=\"submenu-divider\"\n          />\n          <button\n            v-else\n            v-show=\"submenuItem.visible !== false\"\n            type=\"button\"\n            class=\"help-menu-item submenu-item\"\n            role=\"menuitem\"\n            @click=\"submenuItem.action\"\n          >\n            <span class=\"menu-label\">{{ submenuItem.label }}</span>\n          </button>\n        </template>\n      </div>\n    </Teleport>\n\n    <!-- What's New Section -->\n    <section\n      v-if=\"showVersionUpdates\"\n      class=\"w-full\"\n      data-testid=\"whats-new-section\"\n    >\n      <h3\n        class=\"section-description flex items-center gap-2.5 self-stretch px-8 pt-2 pb-2\"\n      >\n        {{ $t('helpCenter.whatsNew') }}\n      </h3>\n\n      <!-- Release Items -->\n      <div\n        v-if=\"hasReleases\"\n        role=\"group\"\n        :aria-label=\"$t('help.recentReleases')\"\n      >\n        <article\n          v-for=\"release in releaseStore.recentReleases\"\n          :key=\"release.id || release.version\"\n          class=\"release-menu-item flex h-12 min-h-6 cursor-pointer items-center gap-2 self-stretch rounded p-2 transition-colors hover:bg-interface-menu-component-surface-hovered\"\n          role=\"button\"\n          tabindex=\"0\"\n          @click=\"onReleaseClick(release)\"\n          @keydown.enter=\"onReleaseClick(release)\"\n          @keydown.space.prevent=\"onReleaseClick(release)\"\n        >\n          <i class=\"help-menu-icon icon-[lucide--package]\" aria-hidden=\"true\" />\n          <div class=\"release-content\">\n            <span class=\"release-title\">\n              {{\n                $t('g.releaseTitle', {\n                  package: 'Comfy',\n                  version: release.version\n                })\n              }}\n            </span>\n            <time class=\"release-date\" :datetime=\"release.published_at\">\n              <span class=\"normal-state\">\n                {{ formatReleaseDate(release.published_at) }}\n              </span>\n              <span class=\"hover-state\">\n                {{ $t('helpCenter.clickToLearnMore') }}\n              </span>\n            </time>\n          </div>\n        </article>\n      </div>\n\n      <!-- Loading State -->\n      <div\n        v-else-if=\"releaseStore.isLoading\"\n        class=\"help-menu-item\"\n        role=\"status\"\n        aria-live=\"polite\"\n      >\n        <i class=\"pi pi-spin pi-spinner help-menu-icon\" aria-hidden=\"true\" />\n        <span>{{ $t('helpCenter.loadingReleases') }}</span>\n      </div>\n\n      <!-- No Releases State -->\n      <div v-else class=\"help-menu-item\" role=\"status\">\n        <i class=\"pi pi-info-circle help-menu-icon\" aria-hidden=\"true\" />\n        <span>{{ $t('helpCenter.noRecentReleases') }}</span>\n      </div>\n    </section>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useToast } from 'primevue/usetoast'\nimport { computed, nextTick, onBeforeUnmount, onMounted, ref } from 'vue'\nimport type { CSSProperties, Component } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport PuzzleIcon from '@/components/icons/PuzzleIcon.vue'\nimport { useExternalLink } from '@/composables/useExternalLink'\nimport { isCloud } from '@/platform/distribution/types'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useTelemetry } from '@/platform/telemetry'\nimport type { ReleaseNote } from '@/platform/updates/common/releaseService'\nimport { useReleaseStore } from '@/platform/updates/common/releaseStore'\nimport { useCommandStore } from '@/stores/commandStore'\nimport { electronAPI, isElectron } from '@/utils/envUtil'\nimport { formatVersionAnchor } from '@/utils/formatUtil'\nimport { useConflictAcknowledgment } from '@/workbench/extensions/manager/composables/useConflictAcknowledgment'\nimport { useManagerState } from '@/workbench/extensions/manager/composables/useManagerState'\nimport { useComfyManagerService } from '@/workbench/extensions/manager/services/comfyManagerService'\nimport { ManagerTab } from '@/workbench/extensions/manager/types/comfyManagerTypes'\n\n// Types\ninterface MenuItem {\n  key: string\n  icon?: string | Component\n  label?: string\n  action?: () => void\n  visible?: boolean\n  type?: 'item' | 'divider'\n  items?: MenuItem[]\n  showRedDot?: boolean\n  showExternalIcon?: boolean\n}\n\n// Constants\nconst TIME_UNITS = {\n  MINUTE: 60 * 1000,\n  HOUR: 60 * 60 * 1000,\n  DAY: 24 * 60 * 60 * 1000,\n  WEEK: 7 * 24 * 60 * 60 * 1000,\n  MONTH: 30 * 24 * 60 * 60 * 1000,\n  YEAR: 365 * 24 * 60 * 60 * 1000\n} as const\n\nconst SUBMENU_CONFIG = {\n  DELAY_MS: 100,\n  OFFSET_PX: 8,\n  Z_INDEX: 10001\n} as const\n\n// Composables\nconst { t } = useI18n()\nconst toast = useToast()\nconst { staticUrls, buildDocsUrl } = useExternalLink()\nconst releaseStore = useReleaseStore()\nconst commandStore = useCommandStore()\nconst settingStore = useSettingStore()\nconst telemetry = useTelemetry()\n\n// Track when help center was opened\nconst openedAt = ref(Date.now())\n\n// Emits\nconst emit = defineEmits<{\n  close: []\n}>()\n\n// State\nconst isSubmenuVisible = ref(false)\nconst submenuRef = ref<HTMLElement | null>(null)\nconst submenuStyle = ref<CSSProperties>({})\nlet hoverTimeout: number | null = null\n\n// Computed\nconst hasReleases = computed(() => releaseStore.releases.length > 0)\nconst showVersionUpdates = computed(() =>\n  settingStore.get('Comfy.Notification.ShowVersionUpdates')\n)\n\n// Use conflict acknowledgment state from composable\nconst { shouldShowRedDot: shouldShowManagerRedDot } =\n  useConflictAcknowledgment()\nconst { isNewManagerUI } = useManagerState()\n\nconst moreItems = computed<MenuItem[]>(() => {\n  const allMoreItems: MenuItem[] = [\n    {\n      key: 'desktop-guide',\n      type: 'item',\n      label: t('helpCenter.desktopUserGuide'),\n      visible: isElectron(),\n      action: () => {\n        trackResourceClick('docs', true)\n        openExternalLink(\n          buildDocsUrl('/installation/desktop', {\n            includeLocale: true,\n            platform: true\n          })\n        )\n        emit('close')\n      }\n    },\n    {\n      key: 'dev-tools',\n      type: 'item',\n      label: t('helpCenter.openDevTools'),\n      visible: isElectron(),\n      action: () => {\n        openDevTools()\n        emit('close')\n      }\n    },\n    {\n      key: 'divider-1',\n      type: 'divider',\n      visible: isElectron()\n    },\n    {\n      key: 'reinstall',\n      type: 'item',\n      label: t('helpCenter.reinstall'),\n      visible: isElectron(),\n      action: () => {\n        onReinstall()\n        emit('close')\n      }\n    }\n  ]\n\n  // Filter for visible items only\n  return allMoreItems.filter((item) => item.visible !== false)\n})\n\nconst hasVisibleMoreItems = computed(() => {\n  return !!moreItems.value.length\n})\n\nconst moreMenuItem = computed(() =>\n  menuItems.value.find((item) => item.key === 'more')\n)\n\nconst menuItems = computed<MenuItem[]>(() => {\n  const items: MenuItem[] = [\n    {\n      key: 'feedback',\n      type: 'item',\n      icon: 'icon-[lucide--clipboard-pen]',\n      label: t('helpCenter.feedback'),\n      action: () => {\n        trackResourceClick('help_feedback', false)\n        void commandStore.execute('Comfy.ContactSupport')\n        emit('close')\n      }\n    },\n    {\n      key: 'help',\n      type: 'item',\n      icon: 'icon-[lucide--message-circle-question]',\n      label: t('helpCenter.help'),\n      action: () => {\n        trackResourceClick('help_feedback', false)\n        void commandStore.execute('Comfy.ContactSupport')\n        emit('close')\n      }\n    },\n    {\n      key: 'docs',\n      type: 'item',\n      icon: 'icon-[lucide--book-open]',\n      label: t('helpCenter.docs'),\n      showExternalIcon: true,\n      action: () => {\n        trackResourceClick('docs', true)\n        const path = isCloud ? '/get_started/cloud' : '/'\n        openExternalLink(buildDocsUrl(path, { includeLocale: true }))\n        emit('close')\n      }\n    },\n    {\n      key: 'discord',\n      type: 'item',\n      icon: 'pi pi-discord',\n      label: 'Discord',\n      showExternalIcon: true,\n      action: () => {\n        trackResourceClick('discord', true)\n        openExternalLink(staticUrls.discord)\n        emit('close')\n      }\n    },\n    {\n      key: 'github',\n      type: 'item',\n      icon: 'icon-[lucide--github]',\n      label: t('helpCenter.github'),\n      showExternalIcon: true,\n      action: () => {\n        trackResourceClick('github', true)\n        openExternalLink(staticUrls.github)\n        emit('close')\n      }\n    }\n  ]\n\n  // Extension manager - only in non-cloud distributions\n  if (!isCloud) {\n    items.push({\n      key: 'manager',\n      type: 'item',\n      icon: PuzzleIcon,\n      label: t('helpCenter.managerExtension'),\n      showRedDot: shouldShowManagerRedDot.value,\n      action: async () => {\n        trackResourceClick('manager', false)\n        await useManagerState().openManager({\n          initialTab: ManagerTab.All,\n          showToastOnLegacyError: false\n        })\n        emit('close')\n      }\n    })\n  }\n  // Update ComfyUI - only for non-desktop, non-cloud with new manager UI\n  if (!isElectron() && !isCloud && isNewManagerUI.value) {\n    items.push({\n      key: 'update-comfyui',\n      type: 'item',\n      icon: 'icon-[lucide--download]',\n      label: t('helpCenter.updateComfyUI'),\n      action: () => {\n        onUpdateComfyUI()\n        emit('close')\n      }\n    })\n  }\n\n  items.push({\n    key: 'more',\n    type: 'item',\n    icon: '',\n    label: t('helpCenter.more'),\n    visible: hasVisibleMoreItems.value,\n    action: () => {}, // No action for more item\n    items: moreItems.value\n  })\n\n  return items\n})\n\n// Utility Functions\nconst trackResourceClick = (\n  resourceType:\n    | 'docs'\n    | 'discord'\n    | 'github'\n    | 'help_feedback'\n    | 'manager'\n    | 'release_notes',\n  isExternal: boolean\n): void => {\n  telemetry?.trackHelpResourceClicked({\n    resource_type: resourceType,\n    is_external: isExternal,\n    source: 'help_center'\n  })\n}\n\nconst openExternalLink = (url: string): void => {\n  window.open(url, '_blank', 'noopener,noreferrer')\n}\n\nconst clearHoverTimeout = (): void => {\n  if (hoverTimeout) {\n    clearTimeout(hoverTimeout)\n    hoverTimeout = null\n  }\n}\n\nconst calculateSubmenuPosition = (button: HTMLElement): CSSProperties => {\n  const rect = button.getBoundingClientRect()\n  const submenuWidth = 210 // Width defined in CSS\n\n  // Get actual submenu height if available, otherwise estimate based on visible item count\n  const visibleItemCount =\n    moreMenuItem.value?.items?.filter((item) => item.visible !== false)\n      .length || 0\n  const estimatedHeight = visibleItemCount * 48 + 16 // ~48px per item + padding\n  const submenuHeight = submenuRef.value?.offsetHeight || estimatedHeight\n\n  // Get viewport dimensions\n  const viewportWidth = window.innerWidth\n  const viewportHeight = window.innerHeight\n\n  // Calculate basic position (aligned with button)\n  let top = rect.top\n  let left = rect.right + SUBMENU_CONFIG.OFFSET_PX\n\n  // Check if submenu would overflow viewport on the right\n  if (left + submenuWidth > viewportWidth) {\n    // Position submenu to the left of the button instead\n    left = rect.left - submenuWidth - SUBMENU_CONFIG.OFFSET_PX\n  }\n\n  // Check if submenu would overflow viewport at the bottom\n  if (top + submenuHeight > viewportHeight) {\n    // Position submenu above the button, aligned to bottom\n    top = Math.max(\n      SUBMENU_CONFIG.OFFSET_PX, // Minimum distance from top of viewport\n      rect.bottom - submenuHeight\n    )\n  }\n\n  // Ensure submenu doesn't go above viewport\n  if (top < SUBMENU_CONFIG.OFFSET_PX) {\n    top = SUBMENU_CONFIG.OFFSET_PX\n  }\n\n  top -= 8\n\n  return {\n    position: 'fixed',\n    top: `${top}px`,\n    left: `${left}px`,\n    zIndex: SUBMENU_CONFIG.Z_INDEX\n  }\n}\n\nconst formatReleaseDate = (dateString?: string): string => {\n  if (!dateString) return 'date'\n\n  const date = new Date(dateString)\n  const now = new Date()\n  const diffTime = Math.abs(now.getTime() - date.getTime())\n\n  const timeUnits = [\n    { unit: TIME_UNITS.YEAR, key: 'yearsAgo' },\n    { unit: TIME_UNITS.MONTH, key: 'monthsAgo' },\n    { unit: TIME_UNITS.WEEK, key: 'weeksAgo' },\n    { unit: TIME_UNITS.DAY, key: 'daysAgo' },\n    { unit: TIME_UNITS.HOUR, key: 'hoursAgo' },\n    { unit: TIME_UNITS.MINUTE, key: 'minutesAgo' }\n  ]\n\n  for (const { unit, key } of timeUnits) {\n    const value = Math.floor(diffTime / unit)\n    if (value > 0) {\n      return t(`g.relativeTime.${key}`, { count: value })\n    }\n  }\n\n  return t('g.relativeTime.now')\n}\n\n// Event Handlers\nconst onMenuItemHover = async (\n  key: string,\n  event: MouseEvent\n): Promise<void> => {\n  if (key !== 'more' || !moreMenuItem.value?.items) return\n\n  // Don't show submenu if all items are hidden\n  const hasVisibleItems = moreMenuItem.value.items.some(\n    (item) => item.visible !== false\n  )\n  if (!hasVisibleItems) return\n\n  clearHoverTimeout()\n\n  const moreButton = event.currentTarget as HTMLElement\n\n  // Calculate initial position before showing submenu\n  submenuStyle.value = calculateSubmenuPosition(moreButton)\n\n  // Show submenu with correct position\n  isSubmenuVisible.value = true\n\n  // After submenu is rendered, refine position if needed\n  await nextTick()\n  if (submenuRef.value) {\n    submenuStyle.value = calculateSubmenuPosition(moreButton)\n  }\n}\n\nconst onMenuItemLeave = (key: string): void => {\n  if (key !== 'more') return\n\n  hoverTimeout = window.setTimeout(() => {\n    isSubmenuVisible.value = false\n  }, SUBMENU_CONFIG.DELAY_MS)\n}\n\nconst onSubmenuHover = (): void => {\n  clearHoverTimeout()\n}\n\nconst onSubmenuLeave = (): void => {\n  isSubmenuVisible.value = false\n}\n\nconst openDevTools = (): void => {\n  if (isElectron()) {\n    electronAPI().openDevTools()\n  }\n}\n\nconst onReinstall = (): void => {\n  if (isElectron()) {\n    void electronAPI().reinstall()\n  }\n}\n\nconst onUpdateComfyUI = async (): Promise<void> => {\n  const { updateComfyUI, rebootComfyUI, error } = useComfyManagerService()\n\n  toast.add({\n    severity: 'info',\n    summary: t('helpCenter.updateComfyUIStarted'),\n    detail: t('helpCenter.updateComfyUIStartedDetail'),\n    life: 3000\n  })\n\n  try {\n    const result = await updateComfyUI({ is_stable: true })\n\n    if (result === null || error.value) {\n      toast.add({\n        severity: 'error',\n        summary: t('g.error'),\n        detail: error.value || t('helpCenter.updateComfyUIFailed'),\n        life: 5000\n      })\n      return\n    }\n\n    toast.add({\n      severity: 'success',\n      summary: t('helpCenter.updateComfyUISuccess'),\n      detail: t('helpCenter.updateComfyUISuccessDetail'),\n      life: 3000\n    })\n\n    await rebootComfyUI()\n  } catch (err) {\n    toast.add({\n      severity: 'error',\n      summary: t('g.error'),\n      detail: err instanceof Error ? err.message : t('g.unknownError'),\n      life: 5000\n    })\n  }\n}\n\nconst onReleaseClick = (release: ReleaseNote): void => {\n  trackResourceClick('release_notes', true)\n  void releaseStore.handleShowChangelog(release.version)\n  const versionAnchor = formatVersionAnchor(release.version)\n  const changelogUrl = `${buildDocsUrl('/changelog', { includeLocale: true })}#${versionAnchor}`\n  openExternalLink(changelogUrl)\n  emit('close')\n}\n\n// Lifecycle\nonMounted(async () => {\n  telemetry?.trackHelpCenterOpened({ source: 'sidebar' })\n  if (!hasReleases.value) {\n    await releaseStore.fetchReleases()\n  }\n})\n\nonBeforeUnmount(() => {\n  const timeSpentSeconds = Math.round((Date.now() - openedAt.value) / 1000)\n  telemetry?.trackHelpCenterClosed({ time_spent_seconds: timeSpentSeconds })\n})\n</script>\n\n<style scoped>\n.help-center-menu {\n  width: 256px;\n  max-height: 500px;\n  overflow-y: auto;\n  background: var(--interface-menu-surface);\n  border-radius: 8px;\n  box-shadow: 0 2px 12px 0 rgb(0 0 0 / 0.1);\n  border: 1px solid var(--interface-menu-stroke);\n  padding: 12px 8px;\n  position: relative;\n}\n\n.help-menu-item {\n  display: flex;\n  align-items: center;\n  width: 100%;\n  height: 32px;\n  min-height: 24px;\n  padding: 8px;\n  gap: 8px;\n  background: transparent;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n  transition: background-color 0.2s;\n  font-size: 0.9rem;\n  color: var(--text-primary);\n  text-align: left;\n}\n\n.help-menu-item:hover {\n  background-color: var(--interface-menu-component-surface-hovered);\n}\n\n.help-menu-item:focus,\n.help-menu-item:focus-visible {\n  outline: none;\n  box-shadow: none;\n}\n\n.help-menu-icon-container {\n  position: relative;\n  width: 16px;\n  height: 16px;\n  flex-shrink: 0;\n}\n\n.help-menu-icon {\n  width: 16px;\n  height: 16px;\n  font-size: 16px;\n  color: var(--text-primary);\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-shrink: 0;\n}\n\n.help-menu-icon svg {\n  width: 16px;\n  height: 16px;\n  color: var(--text-primary);\n}\n\n.menu-red-dot {\n  position: absolute;\n  top: -2px;\n  right: -2px;\n  width: 8px;\n  height: 8px;\n  background: #ff3b30;\n  border-radius: 50%;\n  border: 1.5px solid var(--p-content-background);\n  z-index: 1;\n}\n\n.menu-label {\n  flex: 1;\n}\n\n.more-item {\n  justify-content: space-between;\n}\n\n.section-description {\n  color: var(--text-secondary);\n  font-family: var(--font-inter);\n  font-size: 12px;\n  font-style: normal;\n  font-weight: 700;\n  line-height: normal;\n  margin: 0;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n}\n\n.release-menu-item {\n  position: relative;\n}\n\n.release-content {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n  min-width: 0;\n}\n\n.release-title {\n  font-size: 0.9rem;\n  line-height: 1.2;\n  font-weight: 500;\n  color: var(--text-primary);\n}\n\n.release-date {\n  height: 16px;\n  color: var(--text-secondary);\n  font-family: var(--font-inter);\n  font-size: 12px;\n  font-style: normal;\n  font-weight: 400;\n  line-height: normal;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  display: -webkit-box;\n  -webkit-line-clamp: 1;\n  -webkit-box-orient: vertical;\n}\n\n.release-date .hover-state {\n  display: none;\n}\n\n.release-menu-item:hover .release-date .normal-state,\n.release-menu-item:focus-within .release-date .normal-state {\n  display: none;\n}\n\n.release-menu-item:hover .release-date .hover-state,\n.release-menu-item:focus-within .release-date .hover-state {\n  display: inline;\n}\n\n/* Submenu Styles */\n.more-submenu {\n  width: 210px;\n  padding: 12px 8px;\n  background: var(--interface-menu-surface);\n  border-radius: 8px;\n  border: 1px solid var(--interface-menu-stroke);\n  box-shadow: 0 2px 12px 0 rgb(0 0 0 / 0.1);\n  overflow: hidden;\n  transition: opacity 0.15s ease-out;\n}\n\n.submenu-item {\n  padding: 8px;\n  height: 32px;\n  min-height: 24px;\n  border-radius: 4px;\n  color: var(--text-primary);\n  font-size: 0.9rem;\n  font-weight: inherit;\n  line-height: inherit;\n}\n\n.submenu-item:hover {\n  background-color: var(--interface-menu-component-surface-hovered);\n}\n\n.submenu-item:focus,\n.submenu-item:focus-visible {\n  outline: none;\n  box-shadow: none;\n}\n\n.submenu-divider {\n  height: 1px;\n  background: var(--interface-menu-stroke);\n  margin: 4px 0;\n}\n\n/* Scrollbar Styling */\n.help-center-menu::-webkit-scrollbar {\n  width: 6px;\n}\n\n.help-center-menu::-webkit-scrollbar-track {\n  background: transparent;\n}\n\n.help-center-menu::-webkit-scrollbar-thumb {\n  background: var(--interface-menu-stroke);\n  border-radius: 3px;\n}\n\n.help-center-menu::-webkit-scrollbar-thumb:hover {\n  background: var(--text-secondary);\n}\n\n/* Reduced Motion */\n@media (prefers-reduced-motion: reduce) {\n  .help-menu-item {\n    transition: none;\n  }\n}\n</style>\n","<template>\n  <div v-if=\"shouldShow\" class=\"release-toast-popup\">\n    <div\n      class=\"w-96 max-h-96 bg-base-background border border-border-default rounded-lg shadow-[1px_1px_8px_0_rgba(0,0,0,0.4)] flex flex-col\"\n    >\n      <!-- Main content -->\n      <div class=\"p-4 flex flex-col gap-4 flex-1 min-h-0\">\n        <!-- Header section with icon and text -->\n        <div class=\"flex items-center gap-4\">\n          <div\n            class=\"p-3 bg-primary-background-hover rounded-lg flex items-center justify-center shrink-0\"\n          >\n            <i class=\"icon-[lucide--rocket] w-4 h-4 text-white\" />\n          </div>\n          <div class=\"flex flex-col gap-1\">\n            <div\n              class=\"text-sm font-normal text-base-foreground leading-[1.429]\"\n            >\n              {{ $t('releaseToast.newVersionAvailable') }}\n            </div>\n            <div\n              class=\"text-sm font-normal text-muted-foreground leading-[1.21]\"\n            >\n              {{ latestRelease?.version }}\n            </div>\n          </div>\n        </div>\n\n        <!-- Description section -->\n        <div\n          class=\"pl-14 text-sm font-normal text-muted-foreground leading-[1.21] overflow-y-auto flex-1 min-h-0\"\n          v-html=\"formattedContent\"\n        ></div>\n      </div>\n\n      <!-- Footer section -->\n      <div class=\"flex justify-between items-center px-4 pb-4\">\n        <a\n          class=\"flex items-center gap-2 text-sm font-normal py-1 text-muted-foreground hover:text-base-foreground\"\n          :href=\"changelogUrl\"\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n          @click=\"handleLearnMore\"\n        >\n          <i class=\"icon-[lucide--external-link] w-4 h-4\"></i>\n          {{ $t('releaseToast.whatsNew') }}\n        </a>\n        <div class=\"flex items-center gap-4\">\n          <button\n            class=\"h-6 px-0 bg-transparent border-none text-sm font-normal text-muted-foreground hover:text-base-foreground cursor-pointer\"\n            @click=\"handleSkip\"\n          >\n            {{ $t('releaseToast.skip') }}\n          </button>\n          <button\n            class=\"h-10 px-4 bg-secondary-background hover:bg-secondary-background-hover rounded-lg border-none text-sm font-normal text-base-foreground cursor-pointer\"\n            @click=\"handleUpdate\"\n          >\n            {{ $t('releaseToast.update') }}\n          </button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { default as DOMPurify } from 'dompurify'\nimport { computed, onMounted, ref, watch } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport { useErrorHandling } from '@/composables/useErrorHandling'\nimport { useExternalLink } from '@/composables/useExternalLink'\nimport { useCommandStore } from '@/stores/commandStore'\nimport { isElectron } from '@/utils/envUtil'\nimport { formatVersionAnchor } from '@/utils/formatUtil'\nimport { renderMarkdownToHtml } from '@/utils/markdownRendererUtil'\n\nimport type { ReleaseNote } from '../common/releaseService'\nimport { useReleaseStore } from '../common/releaseStore'\n\nconst { buildDocsUrl } = useExternalLink()\nconst { toastErrorHandler } = useErrorHandling()\nconst releaseStore = useReleaseStore()\nconst { t } = useI18n()\n\n// Local state for dismissed status\nconst isDismissed = ref(false)\n\n// Get latest release from store\nconst latestRelease = computed<ReleaseNote | null>(() => {\n  return releaseStore.recentRelease\n})\n\n// Show toast when new version available and not dismissed\nconst shouldShow = computed(\n  () => releaseStore.shouldShowToast && !isDismissed.value\n)\n\n// Generate changelog URL with version anchor (language-aware)\nconst changelogUrl = computed(() => {\n  const changelogBaseUrl = buildDocsUrl('/changelog', { includeLocale: true })\n  if (latestRelease.value?.version) {\n    const versionAnchor = formatVersionAnchor(latestRelease.value.version)\n    return `${changelogBaseUrl}#${versionAnchor}`\n  }\n  return changelogBaseUrl\n})\n\nconst formattedContent = computed(() => {\n  if (!latestRelease.value?.content) {\n    return DOMPurify.sanitize(`<p>${t('releaseToast.description')}</p>`)\n  }\n\n  try {\n    const markdown = latestRelease.value.content\n    // Remove the h1 title line and images for toast mode\n    const contentWithoutTitle = markdown.replace(/^# .+$/m, '')\n    const contentWithoutImages = contentWithoutTitle.replace(\n      /!\\[.*?\\]\\(.*?\\)/g,\n      ''\n    )\n\n    // Check if there's meaningful content left after cleanup\n    const trimmedContent = contentWithoutImages.trim()\n    if (!trimmedContent || trimmedContent.replace(/\\s+/g, '') === '') {\n      return DOMPurify.sanitize(`<p>${t('releaseToast.description')}</p>`)\n    }\n\n    // renderMarkdownToHtml already sanitizes with DOMPurify, so this is safe\n    return renderMarkdownToHtml(contentWithoutImages)\n  } catch (error) {\n    console.error('Error parsing markdown:', error)\n    // Fallback to plain text with line breaks - sanitize the HTML we create\n    const fallbackContent = latestRelease.value.content.replace(/\\n/g, '<br>')\n    return fallbackContent.trim()\n      ? DOMPurify.sanitize(fallbackContent)\n      : DOMPurify.sanitize(`<p>${t('releaseToast.description')}</p>`)\n  }\n})\n\n// Auto-hide timer\nlet hideTimer: ReturnType<typeof setTimeout> | null = null\n\nconst startAutoHide = () => {\n  if (hideTimer) clearTimeout(hideTimer)\n  hideTimer = setTimeout(() => {\n    dismissToast()\n  }, 8000) // 8 second auto-hide\n}\n\nconst clearAutoHide = () => {\n  if (hideTimer) {\n    clearTimeout(hideTimer)\n    hideTimer = null\n  }\n}\n\nconst dismissToast = () => {\n  isDismissed.value = true\n  clearAutoHide()\n}\n\nconst handleSkip = () => {\n  if (latestRelease.value) {\n    void releaseStore.handleSkipRelease(latestRelease.value.version)\n  }\n  dismissToast()\n}\n\nconst handleLearnMore = () => {\n  if (latestRelease.value) {\n    void releaseStore.handleShowChangelog(latestRelease.value.version)\n  }\n  // Do not dismiss; anchor will navigate in new tab but keep toast? spec maybe wants dismiss? We'll dismiss.\n  dismissToast()\n}\n\nconst handleUpdate = async () => {\n  if (isElectron()) {\n    try {\n      await useCommandStore().execute('Comfy-Desktop.CheckForUpdates')\n      dismissToast()\n    } catch (error) {\n      toastErrorHandler(error)\n    }\n    return\n  }\n\n  window.open(\n    buildDocsUrl('/installation/update_comfyui', { includeLocale: true }),\n    '_blank'\n  )\n  dismissToast()\n}\n\n// Start auto-hide when toast becomes visible\nwatch(shouldShow, (isVisible) => {\n  if (isVisible) {\n    startAutoHide()\n  } else {\n    clearAutoHide()\n  }\n})\n\n// Initialize on mount\nonMounted(async () => {\n  // Fetch releases if not already loaded\n  if (!releaseStore.releases.length) {\n    await releaseStore.fetchReleases()\n  }\n})\n\n// Expose methods for testing\ndefineExpose({\n  handleSkip,\n  handleLearnMore,\n  handleUpdate\n})\n</script>\n\n<style scoped>\n/* Toast popup - positioning handled by parent */\n.release-toast-popup {\n  position: absolute;\n  bottom: 1rem;\n  z-index: 1000;\n  pointer-events: auto;\n}\n\n/* Sidebar positioning classes applied by parent - matching help center */\n.release-toast-popup.sidebar-left,\n.release-toast-popup.sidebar-left.small-sidebar {\n  left: 1rem;\n}\n\n.release-toast-popup.sidebar-right {\n  right: 1rem;\n}\n</style>\n","<template>\n  <div v-if=\"shouldShow\" class=\"whats-new-popup-container left-4\">\n    <div class=\"whats-new-popup\" @click.stop>\n      <!-- Close Button -->\n      <Button\n        class=\"close-button absolute top-2 right-2 z-10 w-8 h-8 p-2 rounded-lg opacity-50\"\n        :aria-label=\"$t('g.close')\"\n        size=\"icon-sm\"\n        variant=\"muted-textonly\"\n        @click=\"closePopup\"\n      >\n        <i class=\"icon-[lucide--x]\" />\n      </Button>\n\n      <!-- Modal Body -->\n      <div class=\"modal-body flex flex-col gap-4 px-0 pt-0 pb-2 flex-1\">\n        <!-- Release Content -->\n        <div\n          class=\"content-text max-h-96 overflow-y-auto\"\n          v-html=\"formattedContent\"\n        ></div>\n      </div>\n\n      <!-- Modal Footer -->\n      <div\n        class=\"modal-footer flex justify-between items-center gap-4 px-4 pb-4\"\n      >\n        <a\n          class=\"learn-more-link flex items-center gap-2 text-sm font-normal py-1\"\n          :href=\"changelogUrl\"\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n          @click=\"closePopup\"\n        >\n          <i class=\"icon-[lucide--external-link]\"></i>\n          {{ $t('whatsNewPopup.learnMore') }}\n        </a>\n        <div class=\"footer-actions flex items-center gap-4\">\n          <Button\n            class=\"h-8\"\n            size=\"sm\"\n            variant=\"muted-textonly\"\n            @click=\"closePopup\"\n          >\n            {{ $t('whatsNewPopup.later') }}\n          </Button>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { default as DOMPurify } from 'dompurify'\nimport { computed, onMounted, ref } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport Button from '@/components/ui/button/Button.vue'\nimport { useExternalLink } from '@/composables/useExternalLink'\nimport { formatVersionAnchor } from '@/utils/formatUtil'\nimport { renderMarkdownToHtml } from '@/utils/markdownRendererUtil'\n\nimport type { ReleaseNote } from '../common/releaseService'\nimport { useReleaseStore } from '../common/releaseStore'\n\nconst { buildDocsUrl } = useExternalLink()\nconst releaseStore = useReleaseStore()\nconst { t } = useI18n()\n\n// Define emits\nconst emit = defineEmits<{\n  'whats-new-dismissed': []\n}>()\n\n// Local state for dismissed status\nconst isDismissed = ref(false)\n\n// Get latest release from store\nconst latestRelease = computed<ReleaseNote | null>(() => {\n  return releaseStore.recentRelease\n})\n\n// Show popup when on latest version and not dismissed\nconst shouldShow = computed(\n  () => releaseStore.shouldShowPopup && !isDismissed.value\n)\n\n// Generate changelog URL with version anchor (language-aware)\nconst changelogUrl = computed(() => {\n  const changelogBaseUrl = buildDocsUrl('/changelog', { includeLocale: true })\n  if (latestRelease.value?.version) {\n    const versionAnchor = formatVersionAnchor(latestRelease.value.version)\n    return `${changelogBaseUrl}#${versionAnchor}`\n  }\n  return changelogBaseUrl\n})\n\nconst formattedContent = computed(() => {\n  if (!latestRelease.value?.content) {\n    return DOMPurify.sanitize(`<p>${t('whatsNewPopup.noReleaseNotes')}</p>`)\n  }\n\n  try {\n    const markdown = latestRelease.value.content\n\n    // Check if content is meaningful (not just whitespace)\n    const trimmedContent = markdown.trim()\n    if (!trimmedContent || trimmedContent.replace(/\\s+/g, '') === '') {\n      return DOMPurify.sanitize(`<p>${t('whatsNewPopup.noReleaseNotes')}</p>`)\n    }\n\n    // Extract image and remaining content separately\n    const imageMatch = markdown.match(/!\\[.*?\\]\\(.*?\\)/)\n    const image = imageMatch ? imageMatch[0] : ''\n\n    // Remove image from content but keep original title\n    const contentWithoutImage = markdown.replace(/!\\[.*?\\]\\(.*?\\)/, '').trim()\n\n    // Reorder: image first, then original content\n    const reorderedContent = [image, contentWithoutImage]\n      .filter(Boolean)\n      .join('\\n\\n')\n\n    // renderMarkdownToHtml already sanitizes with DOMPurify, so this is safe\n    return renderMarkdownToHtml(reorderedContent)\n  } catch (error) {\n    console.error('Error parsing markdown:', error)\n    // Fallback to plain text with line breaks - sanitize the HTML we create\n    const fallbackContent = latestRelease.value.content.replace(/\\n/g, '<br>')\n    return fallbackContent.trim()\n      ? DOMPurify.sanitize(fallbackContent)\n      : DOMPurify.sanitize(`<p>${t('whatsNewPopup.noReleaseNotes')}</p>`)\n  }\n})\n\nconst show = () => {\n  isDismissed.value = false\n}\n\nconst hide = () => {\n  isDismissed.value = true\n  emit('whats-new-dismissed')\n}\n\nconst closePopup = async () => {\n  // Mark \"what's new\" seen when popup is closed\n  if (latestRelease.value) {\n    await releaseStore.handleWhatsNewSeen(latestRelease.value.version)\n  }\n  hide()\n}\n\n// Initialize on mount\nonMounted(async () => {\n  // Fetch releases if not already loaded\n  if (!releaseStore.releases.length) {\n    await releaseStore.fetchReleases()\n  }\n})\n\n// Expose methods for parent component and tests\ndefineExpose({\n  show,\n  hide,\n  closePopup\n})\n</script>\n\n<style scoped>\n/* Popup container - positioning handled by parent */\n.whats-new-popup-container {\n  --whats-new-popup-bottom: 1rem;\n\n  position: absolute;\n  bottom: var(--whats-new-popup-bottom);\n  z-index: 1000;\n  pointer-events: auto;\n}\n\n.whats-new-popup {\n  background: var(--interface-menu-surface);\n  border-radius: 8px;\n  max-width: 400px;\n  width: 400px;\n  border: 1px solid var(--interface-menu-stroke);\n  box-shadow: 1px 1px 8px 0 rgb(0 0 0 / 0.2);\n  position: relative;\n  display: flex;\n  flex-direction: column;\n}\n\n/* Modal Body */\n.modal-body {\n  display: flex;\n  flex-direction: column;\n  gap: 1rem;\n  padding: 0;\n  flex: 1;\n}\n\n.modal-header {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n\n.content-text {\n  color: var(--text-primary);\n  font-size: 14px;\n  line-height: 1.5;\n  word-wrap: break-word;\n  padding: 0 1rem;\n}\n\n/* Style the markdown content */\n/* Title */\n.content-text :deep(*) {\n  box-sizing: border-box;\n}\n\n.content-text :deep(h1) {\n  color: var(--text-secondary);\n  font-family: Inter, sans-serif;\n  font-size: 14px;\n  font-weight: 400;\n  margin-top: 1rem;\n  margin-bottom: 8px;\n  text-transform: uppercase;\n  letter-spacing: 0.05em;\n}\n\n/* What's new title - targets h2 or strong text after h1 */\n.content-text :deep(h2),\n.content-text :deep(h1 + p strong) {\n  color: var(--text-primary);\n  font-family: Inter, sans-serif;\n  font-size: 14px;\n  font-weight: 600;\n  margin: 0 0 8px;\n  line-height: 1.429;\n}\n\n/* Regular paragraphs - short description */\n.content-text :deep(p) {\n  color: var(--text-secondary);\n  font-family: Inter, sans-serif;\n  margin: 1rem 0;\n}\n\n/* List */\n.content-text :deep(ul),\n.content-text :deep(ol) {\n  margin-bottom: 0;\n  padding-left: 0;\n  list-style: none;\n}\n\n.content-text :deep(ul:first-child),\n.content-text :deep(ol:first-child) {\n  margin-top: 0;\n}\n\n.content-text :deep(ul:last-child),\n.content-text :deep(ol:last-child) {\n  margin-bottom: 0;\n}\n\n.content-text :deep(li) {\n  margin-bottom: 6px;\n  position: relative;\n  padding-left: 18px;\n  color: var(--text-secondary);\n  font-family: Inter, sans-serif;\n  font-size: 14px;\n  font-weight: 400;\n  line-height: 1.2102;\n}\n\n.content-text :deep(li:last-child) {\n  margin-bottom: 0;\n}\n\n.content-text :deep(li::before) {\n  content: '';\n  position: absolute;\n  left: 4px;\n  top: 7px;\n  width: 6px;\n  height: 6px;\n  border: 2px solid var(--text-secondary);\n  border-radius: 50%;\n  background: transparent;\n}\n\n.content-text :deep(li strong) {\n  color: var(--text-secondary);\n  font-family: Inter, sans-serif;\n  font-size: 14px;\n  font-weight: 400;\n  line-height: 1.2102;\n  margin-right: 4px;\n}\n\n.content-text :deep(li p) {\n  margin: 2px 0 0;\n  display: inline;\n}\n\n/* Code styling */\n.content-text :deep(code) {\n  background-color: var(--input-surface);\n  border: 1px solid var(--interface-menu-stroke);\n  border-radius: 4px;\n  padding: 2px 6px;\n  color: var(--text-primary);\n  white-space: nowrap;\n}\n\n.content-text :deep(img) {\n  width: 100%;\n  height: 200px;\n  margin: 0 0 16px;\n  object-fit: cover;\n  display: block;\n  border-radius: 8px;\n}\n\n.content-text :deep(img:first-child) {\n  margin: -1rem -1rem 16px;\n  width: calc(100% + 2rem);\n  border-top-left-radius: 8px;\n  border-top-right-radius: 8px;\n  border-bottom-left-radius: 0;\n  border-bottom-right-radius: 0;\n}\n\n/* Add border to content when image is present */\n.content-text:has(img:first-child) {\n  border-left: 1px solid var(--interface-menu-stroke);\n  border-right: 1px solid var(--interface-menu-stroke);\n  border-top: 1px solid var(--interface-menu-stroke);\n  border-bottom-left-radius: 8px;\n  border-bottom-right-radius: 8px;\n  margin: -1px;\n  margin-bottom: 0;\n}\n\n.content-text :deep(img + h1) {\n  margin-top: 0;\n}\n\n/* Secondary headings */\n.content-text :deep(h3) {\n  color: var(--text-primary);\n  font-family: Inter, sans-serif;\n  font-size: 16px;\n  font-weight: 600;\n  margin: 16px 0 8px;\n  line-height: 1.4;\n}\n\n/* Modal Footer */\n.modal-footer {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  gap: 16px;\n  padding: 16px;\n  border-top: none;\n}\n\n.footer-actions {\n  display: flex;\n  align-items: center;\n  gap: 16px;\n}\n\n.learn-more-link {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  color: var(--text-secondary);\n  font-size: 14px;\n  font-weight: 400;\n  line-height: 1.2102;\n  text-decoration: none;\n  padding: 4px 0;\n}\n\n.learn-more-link:hover {\n  color: var(--text-primary);\n}\n\n.learn-more-link i {\n  width: 16px;\n  height: 16px;\n}\n\n.action-secondary {\n  height: 32px;\n  padding: 4px 0;\n  background: transparent;\n  border: none;\n  color: var(--text-secondary);\n  font-size: 14px;\n  font-weight: 400;\n  line-height: 1.2102;\n  cursor: pointer;\n  border-radius: 4px;\n}\n\n.action-secondary:hover {\n  color: var(--text-primary);\n}\n\n.action-primary {\n  height: 40px;\n  padding: 8px 16px;\n  background: var(--interface-menu-component-surface-hovered);\n  border-radius: 8px;\n  border: none;\n  color: var(--text-primary);\n  font-size: 14px;\n  font-weight: 400;\n  line-height: 1.2102;\n  cursor: pointer;\n}\n\n.action-primary:hover {\n  background: var(--button-hover-surface);\n}\n</style>\n","import { defineStore } from 'pinia'\nimport { ref } from 'vue'\n\nexport const useHelpCenterStore = defineStore('helpCenter', () => {\n  const isVisible = ref(false)\n\n  const toggle = () => {\n    isVisible.value = !isVisible.value\n  }\n\n  const show = () => {\n    isVisible.value = true\n  }\n\n  const hide = () => {\n    isVisible.value = false\n  }\n\n  return {\n    isVisible,\n    toggle,\n    show,\n    hide\n  }\n})\n","<template>\n  <div>\n    <SidebarIcon\n      icon=\"pi pi-question-circle\"\n      class=\"comfy-help-center-btn\"\n      :label=\"$t('menu.help')\"\n      :tooltip=\"$t('sideToolbar.helpCenter')\"\n      :icon-badge=\"shouldShowRedDot ? '' : ''\"\n      :is-small=\"isSmall\"\n      @click=\"toggleHelpCenter\"\n    />\n\n    <!-- Help Center Popup positioned within canvas area -->\n    <Teleport to=\"#graph-canvas-container\">\n      <div\n        v-if=\"isHelpCenterVisible\"\n        class=\"help-center-popup\"\n        :class=\"{\n          'sidebar-left': sidebarLocation === 'left',\n          'sidebar-right': sidebarLocation === 'right',\n          'small-sidebar': isSmall\n        }\"\n      >\n        <HelpCenterMenuContent @close=\"closeHelpCenter\" />\n      </div>\n    </Teleport>\n\n    <!-- Release Notification Toast positioned within canvas area -->\n    <Teleport to=\"#graph-canvas-container\">\n      <ReleaseNotificationToast\n        :class=\"{\n          'sidebar-left': sidebarLocation === 'left',\n          'sidebar-right': sidebarLocation === 'right',\n          'small-sidebar': isSmall\n        }\"\n      />\n    </Teleport>\n\n    <!-- WhatsNew Popup positioned within canvas area -->\n    <Teleport to=\"#graph-canvas-container\">\n      <WhatsNewPopup\n        :class=\"{\n          'sidebar-left': sidebarLocation === 'left',\n          'sidebar-right': sidebarLocation === 'right',\n          'small-sidebar': isSmall\n        }\"\n        @whats-new-dismissed=\"handleWhatsNewDismissed\"\n      />\n    </Teleport>\n\n    <!-- Backdrop to close popup when clicking outside -->\n    <Teleport to=\"body\">\n      <div\n        v-if=\"isHelpCenterVisible\"\n        class=\"help-center-backdrop\"\n        @click=\"closeHelpCenter\"\n      />\n    </Teleport>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { storeToRefs } from 'pinia'\nimport { computed, onMounted, toRefs } from 'vue'\n\nimport HelpCenterMenuContent from '@/components/helpcenter/HelpCenterMenuContent.vue'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useReleaseStore } from '@/platform/updates/common/releaseStore'\nimport ReleaseNotificationToast from '@/platform/updates/components/ReleaseNotificationToast.vue'\nimport WhatsNewPopup from '@/platform/updates/components/WhatsNewPopup.vue'\nimport { useDialogService } from '@/services/dialogService'\nimport { useHelpCenterStore } from '@/stores/helpCenterStore'\nimport { useConflictAcknowledgment } from '@/workbench/extensions/manager/composables/useConflictAcknowledgment'\nimport { useConflictDetection } from '@/workbench/extensions/manager/composables/useConflictDetection'\n\nimport SidebarIcon from './SidebarIcon.vue'\n\nconst settingStore = useSettingStore()\nconst releaseStore = useReleaseStore()\nconst helpCenterStore = useHelpCenterStore()\nconst { isVisible: isHelpCenterVisible } = storeToRefs(helpCenterStore)\nconst { shouldShowRedDot: showReleaseRedDot } = storeToRefs(releaseStore)\n\nconst conflictDetection = useConflictDetection()\n\nconst { showNodeConflictDialog } = useDialogService()\n\n// Use conflict acknowledgment state from composable - call only once\nconst { shouldShowRedDot: shouldShowConflictRedDot, markConflictsAsSeen } =\n  useConflictAcknowledgment()\n\nconst props = defineProps<{\n  isSmall: boolean\n}>()\nconst { isSmall } = toRefs(props)\n\n// Use either release red dot or conflict red dot\nconst shouldShowRedDot = computed((): boolean => {\n  const releaseRedDot = showReleaseRedDot.value\n  return releaseRedDot || shouldShowConflictRedDot.value\n})\n\nconst sidebarLocation = computed(() =>\n  settingStore.get('Comfy.Sidebar.Location')\n)\n\n/**\n * Toggle Help Center and track UI button click.\n */\nconst toggleHelpCenter = () => {\n  useTelemetry()?.trackUiButtonClicked({\n    button_id: 'sidebar_help_center_toggled'\n  })\n  helpCenterStore.toggle()\n}\n\nconst closeHelpCenter = () => {\n  helpCenterStore.hide()\n}\n\n/**\n * Handle What's New popup dismissal\n * Check if conflict modal should be shown after ComfyUI update\n */\nconst handleWhatsNewDismissed = async () => {\n  try {\n    // Check if conflict modal should be shown after update\n    const shouldShow =\n      await conflictDetection.shouldShowConflictModalAfterUpdate()\n    if (shouldShow) {\n      showConflictModal()\n    }\n  } catch (error) {\n    console.error('[HelpCenter] Error checking conflict modal:', error)\n  }\n}\n/**\n * Show the node conflict dialog with current conflict data\n */\nconst showConflictModal = () => {\n  showNodeConflictDialog({\n    showAfterWhatsNew: true,\n    dialogComponentProps: {\n      onClose: () => {\n        markConflictsAsSeen()\n      }\n    }\n  })\n}\n\n// Initialize release store on mount\nonMounted(async () => {\n  // Initialize release store to fetch releases for toast and popup\n  await releaseStore.initialize()\n})\n</script>\n\n<style scoped>\n.help-center-backdrop {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  z-index: 9999;\n  background: transparent;\n}\n\n.help-center-popup {\n  position: absolute;\n  bottom: 1rem;\n  z-index: 10000;\n  animation: slideInUp 0.2s ease-out;\n  pointer-events: auto;\n}\n\n.help-center-popup.sidebar-left {\n  left: 1rem;\n}\n\n.help-center-popup.sidebar-left.small-sidebar {\n  left: 1rem;\n}\n\n.help-center-popup.sidebar-right {\n  right: 1rem;\n}\n\n@keyframes slideInUp {\n  from {\n    opacity: 0;\n    transform: translateY(20px);\n  }\n\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n:deep(.p-badge) {\n  background: #ff3b30;\n  color: #ff3b30;\n  min-width: 8px;\n  height: 8px;\n  padding: 0;\n  border-radius: 9999px;\n  font-size: 0;\n  margin-top: 4px;\n  margin-right: 4px;\n  border: none;\n  outline: none;\n  box-shadow: none;\n}\n\n:deep(.p-badge.p-badge-dot) {\n  width: 8px !important;\n}\n</style>\n","<template>\n  <SidebarIcon\n    icon=\"pi pi-sign-out\"\n    :tooltip=\"tooltip\"\n    :label=\"$t('sideToolbar.logout')\"\n    @click=\"logout\"\n  />\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport { useUserStore } from '@/stores/userStore'\n\nimport SidebarIcon from './SidebarIcon.vue'\n\nconst { t } = useI18n()\nconst userStore = useUserStore()\n\nconst tooltip = computed(\n  () => `${t('sideToolbar.logout')} (${userStore.currentUser?.username})`\n)\nconst logout = async () => {\n  await userStore.logout()\n  window.location.reload()\n}\n</script>\n","<template>\n  <SidebarIcon\n    icon=\"icon-[comfy--template]\"\n    :tooltip=\"$t('sideToolbar.templates')\"\n    :label=\"$t('sideToolbar.labels.templates')\"\n    :is-small=\"isSmall\"\n    class=\"templates-tab-button\"\n    @click=\"openTemplates\"\n  />\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\n\nimport { useWorkflowTemplateSelectorDialog } from '@/composables/useWorkflowTemplateSelectorDialog'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useTelemetry } from '@/platform/telemetry'\n\nimport SidebarIcon from './SidebarIcon.vue'\n\nconst settingStore = useSettingStore()\n\nconst isSmall = computed(\n  () => settingStore.get('Comfy.Sidebar.Size') === 'small'\n)\n\n/**\n * Open templates dialog from sidebar and track UI button click.\n */\nconst openTemplates = () => {\n  useTelemetry()?.trackUiButtonClicked({\n    button_id: 'sidebar_templates_dialog_opened'\n  })\n  useWorkflowTemplateSelectorDialog().show('sidebar')\n}\n</script>\n","<template>\n  <nav\n    ref=\"sideToolbarRef\"\n    class=\"side-tool-bar-container flex h-full flex-col items-center bg-transparent [.floating-sidebar]:-mr-2 pointer-events-auto\"\n    :class=\"{\n      'small-sidebar': isSmall,\n      'connected-sidebar': isConnected,\n      'floating-sidebar': !isConnected,\n      'overflowing-sidebar': isOverflowing,\n      'border-r border-[var(--interface-stroke)] shadow-interface': isConnected\n    }\"\n  >\n    <div\n      :class=\"\n        isOverflowing\n          ? 'side-tool-bar-container overflow-y-auto'\n          : 'flex flex-col h-full'\n      \"\n    >\n      <div ref=\"topToolbarRef\" :class=\"groupClasses\">\n        <ComfyMenuButton />\n        <SidebarIcon\n          v-for=\"tab in tabs\"\n          :key=\"tab.id\"\n          :icon=\"tab.icon\"\n          :icon-badge=\"tab.iconBadge\"\n          :tooltip=\"tab.tooltip\"\n          :tooltip-suffix=\"getTabTooltipSuffix(tab)\"\n          :label=\"tab.label || tab.title\"\n          :is-small=\"isSmall\"\n          :selected=\"tab.id === selectedTab?.id\"\n          :class=\"tab.id + '-tab-button'\"\n          @click=\"onTabClick(tab)\"\n        />\n        <SidebarTemplatesButton />\n      </div>\n\n      <div ref=\"bottomToolbarRef\" class=\"mt-auto\" :class=\"groupClasses\">\n        <SidebarLogoutIcon\n          v-if=\"userStore.isMultiUserServer\"\n          :is-small=\"isSmall\"\n        />\n        <SidebarHelpCenterIcon :is-small=\"isSmall\" />\n        <SidebarBottomPanelToggleButton :is-small=\"isSmall\" />\n        <SidebarShortcutsToggleButton :is-small=\"isSmall\" />\n        <SidebarSettingsButton :is-small=\"isSmall\" />\n      </div>\n    </div>\n  </nav>\n</template>\n\n<script setup lang=\"ts\">\nimport { useResizeObserver } from '@vueuse/core'\nimport { debounce } from 'es-toolkit/compat'\nimport { computed, nextTick, onBeforeUnmount, onMounted, ref, watch } from 'vue'\n\nimport ComfyMenuButton from '@/components/sidebar/ComfyMenuButton.vue'\nimport SidebarBottomPanelToggleButton from '@/components/sidebar/SidebarBottomPanelToggleButton.vue'\nimport SidebarSettingsButton from '@/components/sidebar/SidebarSettingsButton.vue'\nimport SidebarShortcutsToggleButton from '@/components/sidebar/SidebarShortcutsToggleButton.vue'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useCommandStore } from '@/stores/commandStore'\nimport { useKeybindingStore } from '@/stores/keybindingStore'\nimport { useUserStore } from '@/stores/userStore'\nimport { useWorkspaceStore } from '@/stores/workspaceStore'\nimport type { SidebarTabExtension } from '@/types/extensionTypes'\nimport { cn } from '@/utils/tailwindUtil'\n\nimport SidebarHelpCenterIcon from './SidebarHelpCenterIcon.vue'\nimport SidebarIcon from './SidebarIcon.vue'\nimport SidebarLogoutIcon from './SidebarLogoutIcon.vue'\nimport SidebarTemplatesButton from './SidebarTemplatesButton.vue'\n\nconst workspaceStore = useWorkspaceStore()\nconst settingStore = useSettingStore()\nconst userStore = useUserStore()\nconst commandStore = useCommandStore()\nconst canvasStore = useCanvasStore()\nconst sideToolbarRef = ref<HTMLElement>()\nconst topToolbarRef = ref<HTMLElement>()\nconst bottomToolbarRef = ref<HTMLElement>()\n\nconst isSmall = computed(\n  () => settingStore.get('Comfy.Sidebar.Size') === 'small'\n)\nconst sidebarLocation = computed<'left' | 'right'>(() =>\n  settingStore.get('Comfy.Sidebar.Location')\n)\nconst sidebarStyle = computed(() => settingStore.get('Comfy.Sidebar.Style'))\nconst isConnected = computed(\n  () =>\n    selectedTab.value ||\n    isOverflowing.value ||\n    sidebarStyle.value === 'connected'\n)\n\nconst tabs = computed(() => workspaceStore.getSidebarTabs())\nconst selectedTab = computed(() => workspaceStore.sidebarTab.activeSidebarTab)\n\n/**\n * Handle sidebar tab icon click.\n * - Emits UI button telemetry for known tabs\n * - Delegates to the corresponding toggle command\n */\nconst onTabClick = async (item: SidebarTabExtension) => {\n  const telemetry = useTelemetry()\n\n  const isNodeLibraryTab = item.id === 'node-library'\n  const isModelLibraryTab = item.id === 'model-library'\n  const isWorkflowsTab = item.id === 'workflows'\n  const isAssetsTab = item.id === 'assets'\n\n  if (isNodeLibraryTab)\n    telemetry?.trackUiButtonClicked({\n      button_id: 'sidebar_tab_node_library_selected'\n    })\n  else if (isModelLibraryTab)\n    telemetry?.trackUiButtonClicked({\n      button_id: 'sidebar_tab_model_library_selected'\n    })\n  else if (isWorkflowsTab)\n    telemetry?.trackUiButtonClicked({\n      button_id: 'sidebar_tab_workflows_selected'\n    })\n  else if (isAssetsTab)\n    telemetry?.trackUiButtonClicked({\n      button_id: 'sidebar_tab_assets_media_selected'\n    })\n\n  await commandStore.commands\n    .find((cmd) => cmd.id === `Workspace.ToggleSidebarTab.${item.id}`)\n    ?.function?.()\n}\n\nconst keybindingStore = useKeybindingStore()\nconst getTabTooltipSuffix = (tab: SidebarTabExtension) => {\n  const keybinding = keybindingStore.getKeybindingByCommandId(\n    `Workspace.ToggleSidebarTab.${tab.id}`\n  )\n  return keybinding ? ` (${keybinding.combo.toString()})` : ''\n}\n\nconst isOverflowing = ref(false)\nconst groupClasses = computed(() =>\n  cn(\n    'sidebar-item-group flex flex-col items-center overflow-hidden flex-shrink-0' +\n      (isConnected.value ? '' : ' rounded-lg shadow-interface')\n  )\n)\n\nconst ENTER_OVERFLOW_MARGIN = 20\nconst EXIT_OVERFLOW_MARGIN = 50\n\nconst checkOverflow = debounce(() => {\n  if (!sideToolbarRef.value || !topToolbarRef.value || !bottomToolbarRef.value)\n    return\n\n  const containerHeight = sideToolbarRef.value.clientHeight\n  const topHeight = topToolbarRef.value.scrollHeight\n  const bottomHeight = bottomToolbarRef.value.scrollHeight\n  const contentHeight = topHeight + bottomHeight\n\n  if (isOverflowing.value) {\n    isOverflowing.value = containerHeight < contentHeight + EXIT_OVERFLOW_MARGIN\n  } else {\n    isOverflowing.value =\n      containerHeight < contentHeight + ENTER_OVERFLOW_MARGIN\n  }\n}, 16)\n\nonMounted(() => {\n  if (!sideToolbarRef.value) return\n\n  const overflowObserver = useResizeObserver(\n    sideToolbarRef.value,\n    checkOverflow\n  )\n\n  checkOverflow()\n\n  onBeforeUnmount(() => {\n    overflowObserver.stop()\n  })\n\n  watch(\n    [isSmall, sidebarLocation],\n    async () => {\n      if (canvasStore.canvas) {\n        if (sidebarLocation.value === 'left') {\n          await nextTick()\n          canvasStore.canvas.fpsInfoLocation = [\n            sideToolbarRef.value?.getBoundingClientRect()?.right,\n            null\n          ]\n        } else {\n          canvasStore.canvas.fpsInfoLocation = null\n        }\n        canvasStore.canvas.setDirty(false, true)\n      }\n    },\n    { immediate: true }\n  )\n})\n</script>\n\n<style>\n/* Global CSS variables for sidebar\n * These variables need to be global (not scoped) because they are used by\n * teleported components like WhatsNewPopup that render outside the sidebar\n * but need to reference sidebar dimensions for proper positioning.\n */\n:root {\n  --sidebar-padding: 4px;\n  --sidebar-icon-size: 1rem;\n\n  --sidebar-default-floating-width: 48px;\n  --sidebar-default-connected-width: calc(\n    var(--sidebar-default-floating-width) + var(--sidebar-padding) * 2\n  );\n  --sidebar-default-item-height: 56px;\n\n  --sidebar-small-floating-width: 48px;\n  --sidebar-small-connected-width: calc(\n    var(--sidebar-small-floating-width) + var(--sidebar-padding) * 2\n  );\n  --sidebar-small-item-height: 48px;\n\n  --sidebar-width: var(--sidebar-default-floating-width);\n  --sidebar-item-height: var(--sidebar-default-item-height);\n}\n\n:root:has(.side-tool-bar-container.small-sidebar) {\n  --sidebar-width: var(--sidebar-small-floating-width);\n  --sidebar-item-height: var(--sidebar-small-item-height);\n}\n\n:root:has(.side-tool-bar-container.connected-sidebar) {\n  --sidebar-width: var(--sidebar-default-connected-width);\n}\n\n:root:has(.side-tool-bar-container.small-sidebar.connected-sidebar) {\n  --sidebar-width: var(--sidebar-small-connected-width);\n}\n</style>\n\n<style scoped>\n@reference \"tailwindcss\";\n\n.floating-sidebar {\n  padding: var(--sidebar-padding);\n}\n\n.floating-sidebar .sidebar-item-group {\n  border-color: var(--p-panel-border-color);\n}\n\n.connected-sidebar {\n  padding: var(--sidebar-padding) 0;\n  background-color: var(--comfy-menu-bg);\n}\n\n.sidebar-item-group {\n  background-color: var(--comfy-menu-bg);\n  border: 1px solid transparent;\n}\n\n.overflowing-sidebar :deep(.comfy-menu-button-wrapper) {\n  position: sticky;\n  top: 0;\n  z-index: 1;\n  background-color: var(--comfy-menu-bg);\n}\n</style>\n","import { defineStore } from 'pinia'\nimport { computed } from 'vue'\n\nimport type { TopbarBadge } from '@/types/comfy'\n\nimport { useExtensionStore } from './extensionStore'\n\nexport const useTopbarBadgeStore = defineStore('topbarBadge', () => {\n  const extensionStore = useExtensionStore()\n\n  const badges = computed<TopbarBadge[]>(() =>\n    extensionStore.extensions.flatMap((e) => e.topbarBadges ?? [])\n  )\n\n  return {\n    badges\n  }\n})\n","<template>\n  <div class=\"flex h-full shrink-0 items-center\">\n    <TopbarBadge\n      v-for=\"badge in topbarBadgeStore.badges\"\n      :key=\"badge.text\"\n      :badge\n      :display-mode=\"displayMode\"\n      :reverse-order=\"reverseOrder\"\n      :no-padding=\"noPadding\"\n    />\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport { breakpointsTailwind, useBreakpoints } from '@vueuse/core'\nimport { computed } from 'vue'\n\nimport { useTopbarBadgeStore } from '@/stores/topbarBadgeStore'\n\nimport TopbarBadge from './TopbarBadge.vue'\n\nwithDefaults(\n  defineProps<{\n    reverseOrder?: boolean\n    noPadding?: boolean\n  }>(),\n  {\n    reverseOrder: false,\n    noPadding: false\n  }\n)\n\nconst breakpoints = useBreakpoints(breakpointsTailwind)\nconst isXl = breakpoints.greaterOrEqual('xl')\nconst isLg = breakpoints.greaterOrEqual('lg')\n\nconst displayMode = computed<'full' | 'compact' | 'icon-only'>(() => {\n  if (isXl.value) return 'full'\n  if (isLg.value) return 'compact'\n  return 'icon-only'\n})\n\nconst topbarBadgeStore = useTopbarBadgeStore()\n</script>\n","<template>\n  <div\n    ref=\"positionRef\"\n    class=\"absolute bottom-0 left-1/2 -translate-x-1/2\"\n  ></div>\n  <Popover\n    ref=\"popoverRef\"\n    append-to=\"body\"\n    :pt=\"{\n      root: {\n        class: 'workflow-popover-fade fit-content',\n        'data-popover-id': id\n      }\n    }\"\n    @mouseenter=\"cancelHidePopover\"\n    @mouseleave=\"hidePopover\"\n  >\n    <div class=\"workflow-preview-content\">\n      <div\n        v-if=\"thumbnailUrl && !isActiveTab\"\n        class=\"workflow-preview-thumbnail relative\"\n      >\n        <img\n          :src=\"thumbnailUrl\"\n          class=\"block h-[200px] rounded-lg object-cover p-2\"\n          :style=\"{ width: `${POPOVER_WIDTH}px` }\"\n        />\n      </div>\n      <div class=\"workflow-preview-footer\">\n        <span class=\"workflow-preview-name\">{{ workflowFilename }}</span>\n      </div>\n    </div>\n  </Popover>\n</template>\n\n<script setup lang=\"ts\">\nimport Popover from 'primevue/popover'\nimport { nextTick, ref, toRefs, useId } from 'vue'\n\nconst POPOVER_WIDTH = 250\n\ninterface Props {\n  workflowFilename: string\n  thumbnailUrl?: string\n  isActiveTab: boolean\n}\n\nconst props = defineProps<Props>()\nconst { thumbnailUrl, isActiveTab } = toRefs(props)\nconst popoverRef = ref<InstanceType<typeof Popover> | null>(null)\nconst positionRef = ref<HTMLElement | null>(null)\nlet hideTimeout: ReturnType<typeof setTimeout> | null = null\nlet showTimeout: ReturnType<typeof setTimeout> | null = null\nconst id = useId()\n\nconst showPopover = (event: Event) => {\n  // Clear any existing timeouts\n  if (hideTimeout) {\n    clearTimeout(hideTimeout)\n    hideTimeout = null\n  }\n  if (showTimeout) {\n    clearTimeout(showTimeout)\n    showTimeout = null\n  }\n\n  // Show popover after a short delay\n  showTimeout = setTimeout(async () => {\n    if (popoverRef.value && positionRef.value) {\n      popoverRef.value.show(event, positionRef.value)\n      await nextTick()\n      // PrimeVue has a bug where when the tabs are scrolled, it positions the element incorrectly\n      // Manually set the position to the middle of the tab and prevent it from going off the left/right edge\n      const el = document.querySelector(\n        `.workflow-popover-fade[data-popover-id=\"${id}\"]`\n      ) as HTMLElement\n      if (el) {\n        const middle = positionRef.value!.getBoundingClientRect().left\n        const popoverWidth = el.getBoundingClientRect().width\n        const halfWidth = popoverWidth / 2\n        let pos = middle - halfWidth\n        let shift = 0\n\n        // Calculate shift when clamping is needed\n        if (pos < 0) {\n          shift = pos - 8 // Negative shift to move arrow left\n          pos = 8\n        } else if (pos + popoverWidth > window.innerWidth) {\n          const newPos = window.innerWidth - popoverWidth - 16\n          shift = pos - newPos // Positive shift to move arrow right\n          pos = newPos\n        }\n\n        if (shift + halfWidth < 0) {\n          shift = -halfWidth + 24\n        }\n\n        el.style.left = `${pos}px`\n        el.style.setProperty('--shift', `${shift}px`)\n      }\n    }\n  }, 200) // 200ms delay before showing\n}\n\nconst cancelHidePopover = () => {\n  // Temporarily disable this functionality until we need the popover to be interactive:\n  /*\n  if (hideTimeout) {\n    clearTimeout(hideTimeout)\n    hideTimeout = null\n  }\n  */\n}\n\nconst hidePopover = () => {\n  // Clear show timeout if mouse leaves before popover appears\n  if (showTimeout) {\n    clearTimeout(showTimeout)\n    showTimeout = null\n  }\n\n  hideTimeout = setTimeout(() => {\n    if (popoverRef.value) {\n      popoverRef.value.hide()\n    }\n  }, 100) // Minimal delay to allow moving to popover\n}\n\nconst togglePopover = (event: Event) => {\n  if (popoverRef.value) {\n    popoverRef.value.toggle(event)\n  }\n}\n\ndefineExpose({\n  showPopover,\n  hidePopover,\n  togglePopover\n})\n</script>\n\n<style scoped>\n@reference '../../assets/css/style.css';\n\n.workflow-preview-content {\n  @apply flex flex-col rounded-xl overflow-hidden;\n  max-width: var(--popover-width);\n  background-color: var(--comfy-menu-bg);\n  color: var(--fg-color);\n}\n\n.workflow-preview-thumbnail {\n  @apply relative p-2;\n}\n\n.workflow-preview-thumbnail img {\n  @apply shadow-md;\n  background-color: color-mix(in srgb, var(--comfy-menu-bg) 70%, black);\n}\n\n.dark-theme .workflow-preview-thumbnail img {\n  @apply shadow-lg;\n}\n\n.workflow-preview-footer {\n  @apply pt-1 pb-2 px-3;\n}\n\n.workflow-preview-name {\n  @apply block text-sm font-medium overflow-hidden text-ellipsis whitespace-nowrap;\n  color: var(--fg-color);\n}\n</style>\n\n<style>\n@reference '../../assets/css/style.css';\n\n.workflow-popover-fade {\n  --p-popover-background: transparent;\n  --p-popover-content-padding: 0;\n  @apply bg-transparent rounded-xl shadow-lg;\n  transition: opacity 0.15s ease-out !important;\n}\n\n.workflow-popover-fade.p-popover-flipped {\n  @apply -translate-y-full;\n}\n\n.dark-theme .workflow-popover-fade {\n  @apply shadow-2xl;\n}\n\n.workflow-popover-fade.p-popover::after,\n.workflow-popover-fade.p-popover::before {\n  --p-popover-border-color: var(--comfy-menu-secondary-bg);\n  left: 50%;\n  transform: translateX(calc(-50% + var(--shift)));\n  margin-left: 0;\n}\n</style>\n","<template>\n  <div\n    ref=\"workflowTabRef\"\n    class=\"workflow-tab group flex gap-2 p-2\"\n    v-bind=\"$attrs\"\n    @mouseenter=\"handleMouseEnter\"\n    @mouseleave=\"handleMouseLeave\"\n    @click=\"handleClick\"\n  >\n    <span class=\"workflow-label inline-block max-w-[150px] truncate text-sm\">\n      {{ workflowOption.workflow.filename }}\n    </span>\n    <div class=\"relative\">\n      <span\n        v-if=\"shouldShowStatusIndicator\"\n        class=\"absolute top-1/2 left-1/2 z-10 w-4 -translate-1/2 bg-(--comfy-menu-bg) text-2xl font-bold group-hover:hidden\"\n        ></span\n      >\n      <Button\n        class=\"close-button invisible w-auto p-0\"\n        variant=\"muted-textonly\"\n        size=\"icon-sm\"\n        :aria-label=\"t('g.close')\"\n        @click.stop=\"onCloseWorkflow(workflowOption)\"\n      >\n        <i class=\"pi pi-times\" />\n      </Button>\n    </div>\n  </div>\n\n  <WorkflowTabPopover\n    ref=\"popoverRef\"\n    :workflow-filename=\"workflowOption.workflow.filename\"\n    :thumbnail-url=\"thumbnailUrl\"\n    :is-active-tab=\"isActiveTab\"\n  />\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, onUnmounted, ref } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport Button from '@/components/ui/button/Button.vue'\nimport {\n  usePragmaticDraggable,\n  usePragmaticDroppable\n} from '@/composables/usePragmaticDragAndDrop'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useWorkflowService } from '@/platform/workflow/core/services/workflowService'\nimport type { ComfyWorkflow } from '@/platform/workflow/management/stores/workflowStore'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { useWorkflowThumbnail } from '@/renderer/core/thumbnail/useWorkflowThumbnail'\nimport { useWorkspaceStore } from '@/stores/workspaceStore'\n\nimport WorkflowTabPopover from './WorkflowTabPopover.vue'\n\ninterface WorkflowOption {\n  value: string\n  workflow: ComfyWorkflow\n}\n\nconst props = defineProps<{\n  workflowOption: WorkflowOption\n}>()\n\nconst { t } = useI18n()\n\nconst workspaceStore = useWorkspaceStore()\nconst workflowStore = useWorkflowStore()\nconst settingStore = useSettingStore()\nconst workflowTabRef = ref<HTMLElement | null>(null)\nconst popoverRef = ref<InstanceType<typeof WorkflowTabPopover> | null>(null)\nconst workflowThumbnail = useWorkflowThumbnail()\n\n// Use computed refs to cache autosave settings\nconst autoSaveSetting = computed(() =>\n  settingStore.get('Comfy.Workflow.AutoSave')\n)\nconst autoSaveDelay = computed(() =>\n  settingStore.get('Comfy.Workflow.AutoSaveDelay')\n)\n\nconst shouldShowStatusIndicator = computed(() => {\n  if (workspaceStore.shiftDown) {\n    // Branch 1: Shift key is held down, do not show the status indicator.\n    return false\n  }\n  if (!props.workflowOption.workflow.isPersisted) {\n    // Branch 2: Workflow is not persisted, show the status indicator.\n    return true\n  }\n  if (props.workflowOption.workflow.isModified) {\n    // Branch 3: Workflow is modified.\n    if (autoSaveSetting.value === 'off') {\n      // Sub-branch 3a: Autosave is off, so show the status indicator.\n      return true\n    }\n    if (autoSaveSetting.value === 'after delay' && autoSaveDelay.value > 3000) {\n      // Sub-branch 3b: Autosave delay is too high, so show the status indicator.\n      return true\n    }\n    // Sub-branch 3c: Workflow is modified but no condition applies, do not show the status indicator.\n    return false\n  }\n  // Default: do not show the status indicator. This should not be reachable.\n  return false\n})\n\nconst isActiveTab = computed(() => {\n  return workflowStore.activeWorkflow?.key === props.workflowOption.workflow.key\n})\n\nconst thumbnailUrl = computed(() => {\n  return workflowThumbnail.getThumbnail(props.workflowOption.workflow.key)\n})\n\n// Event handlers that delegate to the popover component\nconst handleMouseEnter = (event: Event) => {\n  popoverRef.value?.showPopover(event)\n}\n\nconst handleMouseLeave = () => {\n  popoverRef.value?.hidePopover()\n}\n\nconst handleClick = (event: Event) => {\n  popoverRef.value?.togglePopover(event)\n}\n\nconst closeWorkflows = async (options: WorkflowOption[]) => {\n  for (const opt of options) {\n    if (\n      !(await useWorkflowService().closeWorkflow(opt.workflow, {\n        warnIfUnsaved: !workspaceStore.shiftDown,\n        hint: t('sideToolbar.workflowTab.dirtyCloseHint')\n      }))\n    ) {\n      // User clicked cancel\n      break\n    }\n  }\n}\n\nconst onCloseWorkflow = async (option: WorkflowOption) => {\n  await closeWorkflows([option])\n}\nconst tabGetter = () => workflowTabRef.value as HTMLElement\n\nusePragmaticDraggable(tabGetter, {\n  getInitialData: () => {\n    return {\n      workflowKey: props.workflowOption.workflow.key\n    }\n  }\n})\n\nusePragmaticDroppable(tabGetter, {\n  getData: () => {\n    return {\n      workflowKey: props.workflowOption.workflow.key\n    }\n  },\n  onDrop: (e) => {\n    const fromIndex = workflowStore.openWorkflows.findIndex(\n      (wf) => wf.key === e.source.data.workflowKey\n    )\n    const toIndex = workflowStore.openWorkflows.findIndex(\n      (wf) => wf.key === e.location.current.dropTargets[0]?.data.workflowKey\n    )\n    if (fromIndex !== toIndex) {\n      workflowStore.reorderWorkflows(fromIndex, toIndex)\n    }\n  }\n})\n\nonUnmounted(() => {\n  popoverRef.value?.hidePopover()\n})\n</script>\n\n<style>\n.p-tooltip.workflow-tab-tooltip {\n  z-index: 1200 !important;\n}\n</style>\n","<template>\n  <div>\n    <Button\n      v-tooltip=\"{ value: $t('g.moreWorkflows'), showDelay: 300 }\"\n      class=\"rounded-none h-full w-auto aspect-square\"\n      variant=\"muted-textonly\"\n      size=\"icon\"\n      :aria-label=\"$t('g.moreWorkflows')\"\n      @click=\"menu?.toggle($event)\"\n    >\n      <i class=\"pi pi-ellipsis-h\" />\n    </Button>\n    <Menu\n      ref=\"menu\"\n      :model=\"menuItems\"\n      :popup=\"true\"\n      class=\"max-h-[40vh] overflow-auto\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport Menu from 'primevue/menu'\nimport { computed, ref } from 'vue'\n\nimport Button from '@/components/ui/button/Button.vue'\nimport { useWorkflowService } from '@/platform/workflow/core/services/workflowService'\nimport type { ComfyWorkflow } from '@/platform/workflow/management/stores/workflowStore'\n\nconst props = defineProps<{\n  workflows: ComfyWorkflow[]\n  activeWorkflow: ComfyWorkflow | null\n}>()\n\nconst menu = ref<InstanceType<typeof Menu> | null>(null)\nconst workflowService = useWorkflowService()\n\nconst menuItems = computed(() =>\n  props.workflows.map((workflow: ComfyWorkflow) => ({\n    label: workflow.filename,\n    icon:\n      props.activeWorkflow?.key === workflow.key ? 'pi pi-check' : undefined,\n    command: () => {\n      void workflowService.openWorkflow(workflow)\n    }\n  }))\n)\n</script>\n","<template>\n  <div\n    ref=\"containerRef\"\n    class=\"workflow-tabs-container flex h-full max-w-full flex-auto flex-row overflow-hidden\"\n    :class=\"{ 'workflow-tabs-container-desktop': isDesktop }\"\n  >\n    <Button\n      v-if=\"showOverflowArrows\"\n      variant=\"muted-textonly\"\n      size=\"icon\"\n      class=\"overflow-arrow overflow-arrow-left h-full w-auto aspect-square\"\n      :aria-label=\"$t('g.scrollLeft')\"\n      :disabled=\"!leftArrowEnabled\"\n      @mousedown=\"whileMouseDown($event, () => scroll(-1))\"\n    >\n      <i class=\"icon-[lucide--chevron-left] size-full\" />\n    </Button>\n    <ScrollPanel\n      class=\"no-drag overflow-hidden\"\n      :pt:content=\"{\n        class: 'p-0 w-full flex',\n        onwheel: handleWheel\n      }\"\n      pt:bar-x=\"h-1\"\n    >\n      <SelectButton\n        class=\"workflow-tabs bg-transparent\"\n        :class=\"props.class\"\n        :model-value=\"selectedWorkflow\"\n        :options=\"options\"\n        option-label=\"label\"\n        data-key=\"value\"\n        @update:model-value=\"onWorkflowChange\"\n      >\n        <template #option=\"{ option }\">\n          <WorkflowTab\n            :workflow-option=\"option\"\n            @contextmenu=\"showContextMenu($event, option)\"\n            @click.middle=\"onCloseWorkflow(option)\"\n          />\n        </template>\n      </SelectButton>\n    </ScrollPanel>\n    <Button\n      v-if=\"showOverflowArrows\"\n      variant=\"muted-textonly\"\n      size=\"icon\"\n      class=\"overflow-arrow overflow-arrow-right h-full w-auto aspect-square\"\n      :aria-label=\"$t('g.scrollRight')\"\n      :disabled=\"!rightArrowEnabled\"\n      @mousedown=\"whileMouseDown($event, () => scroll(1))\"\n    >\n      <i class=\"icon-[lucide--chevron-right] size-full\" />\n    </Button>\n    <WorkflowOverflowMenu\n      v-if=\"showOverflowArrows\"\n      :workflows=\"workflowStore.openWorkflows\"\n      :active-workflow=\"workflowStore.activeWorkflow\"\n    />\n    <Button\n      v-tooltip=\"{ value: $t('sideToolbar.newBlankWorkflow'), showDelay: 300 }\"\n      class=\"new-blank-workflow-button no-drag shrink-0 rounded-none h-full w-auto aspect-square\"\n      variant=\"muted-textonly\"\n      size=\"icon\"\n      :aria-label=\"$t('sideToolbar.newBlankWorkflow')\"\n      @click=\"() => commandStore.execute('Comfy.NewBlankWorkflow')\"\n    >\n      <i class=\"pi pi-plus\" />\n    </Button>\n    <ContextMenu ref=\"menu\" :model=\"contextMenuItems\" />\n    <div v-if=\"isDesktop\" class=\"window-actions-spacer app-drag shrink-0\" />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useScroll } from '@vueuse/core'\nimport ContextMenu from 'primevue/contextmenu'\nimport ScrollPanel from 'primevue/scrollpanel'\nimport SelectButton from 'primevue/selectbutton'\nimport { computed, nextTick, onUpdated, ref, watch } from 'vue'\nimport type { WatchStopHandle } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport WorkflowTab from '@/components/topbar/WorkflowTab.vue'\nimport Button from '@/components/ui/button/Button.vue'\nimport { useOverflowObserver } from '@/composables/element/useOverflowObserver'\nimport { useWorkflowService } from '@/platform/workflow/core/services/workflowService'\nimport type { ComfyWorkflow } from '@/platform/workflow/management/stores/workflowStore'\nimport {\n  useWorkflowBookmarkStore,\n  useWorkflowStore\n} from '@/platform/workflow/management/stores/workflowStore'\nimport { useCommandStore } from '@/stores/commandStore'\nimport { useWorkspaceStore } from '@/stores/workspaceStore'\nimport { isElectron } from '@/utils/envUtil'\nimport { whileMouseDown } from '@/utils/mouseDownUtil'\n\nimport WorkflowOverflowMenu from './WorkflowOverflowMenu.vue'\n\ninterface WorkflowOption {\n  value: string\n  workflow: ComfyWorkflow\n}\n\nconst props = defineProps<{\n  class?: string\n}>()\n\nconst { t } = useI18n()\nconst workspaceStore = useWorkspaceStore()\nconst workflowStore = useWorkflowStore()\nconst workflowBookmarkStore = useWorkflowBookmarkStore()\nconst workflowService = useWorkflowService()\n\nconst rightClickedTab = ref<WorkflowOption | undefined>()\nconst menu = ref()\nconst containerRef = ref<HTMLElement | null>(null)\nconst showOverflowArrows = ref(false)\nconst leftArrowEnabled = ref(false)\nconst rightArrowEnabled = ref(false)\n\nconst isDesktop = isElectron()\n\nconst workflowToOption = (workflow: ComfyWorkflow): WorkflowOption => ({\n  value: workflow.path,\n  workflow\n})\n\nconst options = computed<WorkflowOption[]>(() =>\n  workflowStore.openWorkflows.map(workflowToOption)\n)\nconst selectedWorkflow = computed<WorkflowOption | null>(() =>\n  workflowStore.activeWorkflow\n    ? workflowToOption(workflowStore.activeWorkflow as ComfyWorkflow)\n    : null\n)\n\nconst onWorkflowChange = async (option: WorkflowOption) => {\n  // Prevent unselecting the current workflow\n  if (!option) {\n    return\n  }\n  // Prevent reloading the current workflow\n  if (selectedWorkflow.value?.value === option.value) {\n    return\n  }\n\n  await workflowService.openWorkflow(option.workflow)\n}\n\nconst closeWorkflows = async (options: WorkflowOption[]) => {\n  for (const opt of options) {\n    if (\n      !(await workflowService.closeWorkflow(opt.workflow, {\n        warnIfUnsaved: !workspaceStore.shiftDown\n      }))\n    ) {\n      // User clicked cancel\n      break\n    }\n  }\n}\n\nconst onCloseWorkflow = async (option: WorkflowOption) => {\n  await closeWorkflows([option])\n}\n\nconst showContextMenu = (event: MouseEvent, option: WorkflowOption) => {\n  rightClickedTab.value = option\n  menu.value.show(event)\n}\nconst contextMenuItems = computed(() => {\n  const tab = rightClickedTab.value as WorkflowOption\n  if (!tab) return []\n  const index = options.value.findIndex((v) => v.workflow === tab.workflow)\n\n  return [\n    {\n      label: t('tabMenu.duplicateTab'),\n      command: async () => {\n        await workflowService.duplicateWorkflow(tab.workflow)\n      }\n    },\n    {\n      separator: true\n    },\n    {\n      label: t('tabMenu.closeTab'),\n      command: () => onCloseWorkflow(tab)\n    },\n    {\n      label: t('tabMenu.closeTabsToLeft'),\n      command: () => closeWorkflows(options.value.slice(0, index)),\n      disabled: index <= 0\n    },\n    {\n      label: t('tabMenu.closeTabsToRight'),\n      command: () => closeWorkflows(options.value.slice(index + 1)),\n      disabled: index === options.value.length - 1\n    },\n    {\n      label: t('tabMenu.closeOtherTabs'),\n      command: () =>\n        closeWorkflows([\n          ...options.value.slice(index + 1),\n          ...options.value.slice(0, index)\n        ]),\n      disabled: options.value.length <= 1\n    },\n    {\n      label: workflowBookmarkStore.isBookmarked(tab.workflow.path)\n        ? t('tabMenu.removeFromBookmarks')\n        : t('tabMenu.addToBookmarks'),\n      command: () => workflowBookmarkStore.toggleBookmarked(tab.workflow.path),\n      disabled: tab.workflow.isTemporary\n    }\n  ]\n})\nconst commandStore = useCommandStore()\n\n// Horizontal scroll on wheel\nconst handleWheel = (event: WheelEvent) => {\n  const scrollElement = event.currentTarget as HTMLElement\n  const scrollAmount = event.deltaX || event.deltaY\n  scrollElement.scroll({\n    left: scrollElement.scrollLeft + scrollAmount\n  })\n}\n\nconst scrollContent = computed(\n  () =>\n    (containerRef.value?.querySelector(\n      '.p-scrollpanel-content'\n    ) as HTMLElement | null) ?? null\n)\n\nconst scroll = (direction: number) => {\n  const el = scrollContent.value\n  if (!el) return\n  el.scrollBy({ left: direction * 20 })\n}\n\nconst ensureActiveTabVisible = async (\n  options: { waitForDom?: boolean } = {}\n) => {\n  if (!selectedWorkflow.value) return\n\n  if (options.waitForDom !== false) {\n    await nextTick()\n  }\n\n  const containerElement = containerRef.value\n  if (!containerElement) return\n\n  const activeTabElement = containerElement.querySelector(\n    '.p-togglebutton-checked'\n  )\n  if (!activeTabElement) return\n\n  activeTabElement.scrollIntoView({ block: 'nearest', inline: 'nearest' })\n}\n\n// Scroll to active offscreen tab when opened\nwatch(\n  () => workflowStore.activeWorkflow,\n  () => {\n    void ensureActiveTabVisible()\n  },\n  { immediate: true }\n)\n\nlet overflowObserver: ReturnType<typeof useOverflowObserver> | null = null\nlet stopArrivedWatch: WatchStopHandle | null = null\nlet stopOverflowWatch: WatchStopHandle | null = null\n\nwatch(\n  scrollContent,\n  (el, _prev, onCleanup) => {\n    stopArrivedWatch?.()\n    stopOverflowWatch?.()\n    overflowObserver?.dispose()\n\n    if (!el) return\n\n    const scrollState = useScroll(el)\n\n    stopArrivedWatch = watch(\n      [\n        () => scrollState.arrivedState.left,\n        () => scrollState.arrivedState.right\n      ],\n      ([atLeft, atRight]) => {\n        leftArrowEnabled.value = !atLeft\n        rightArrowEnabled.value = !atRight\n      },\n      { immediate: true }\n    )\n\n    overflowObserver = useOverflowObserver(el)\n    stopOverflowWatch = watch(\n      overflowObserver.isOverflowing,\n      (isOverflow) => {\n        showOverflowArrows.value = isOverflow\n        if (!isOverflow) return\n        void nextTick(() => {\n          // Force a new check after arrows are updated\n          scrollState.measure()\n          void ensureActiveTabVisible({ waitForDom: false })\n        })\n      },\n      { immediate: true }\n    )\n\n    onCleanup(() => {\n      stopArrivedWatch?.()\n      stopOverflowWatch?.()\n      overflowObserver?.dispose()\n    })\n  },\n  { immediate: true }\n)\n\nonUpdated(() => {\n  if (!overflowObserver?.disposed.value) {\n    overflowObserver?.checkOverflow()\n  }\n})\n</script>\n\n<style scoped>\n@reference '../../assets/css/style.css';\n\n.workflow-tabs-container {\n  background-color: var(--comfy-menu-bg);\n}\n\n:deep(.p-togglebutton) {\n  @apply p-0 bg-transparent rounded-none shrink relative border-0 border-r border-solid;\n  border-right-color: var(--border-color);\n  min-width: 90px;\n}\n\n.overflow-arrow {\n  @apply px-2 rounded-none;\n}\n\n.overflow-arrow[disabled] {\n  @apply opacity-25;\n}\n\n:deep(.p-togglebutton > .p-togglebutton-content) {\n  @apply max-w-full;\n}\n\n:deep(.workflow-tab) {\n  @apply max-w-full;\n}\n\n:deep(.p-togglebutton::before) {\n  @apply hidden;\n}\n\n:deep(.p-togglebutton:first-child) {\n  @apply border-l border-solid;\n  border-left-color: var(--border-color);\n}\n\n:deep(.p-togglebutton:not(:first-child)) {\n  @apply border-l-0;\n}\n\n:deep(.p-togglebutton.p-togglebutton-checked) {\n  @apply border-b border-solid h-full;\n  border-bottom-color: var(--p-button-text-primary-color);\n}\n\n:deep(.p-togglebutton:not(.p-togglebutton-checked)) {\n  @apply opacity-75;\n}\n\n:deep(.p-togglebutton-checked) .close-button,\n:deep(.p-togglebutton:hover) .close-button {\n  @apply visible;\n}\n\n:deep(.p-scrollpanel-content) {\n  @apply h-full;\n}\n\n:deep(.workflow-tabs) {\n  display: flex;\n}\n\n/* Scrollbar half opacity to avoid blocking the active tab bottom border */\n:deep(.p-scrollpanel:hover .p-scrollpanel-bar),\n:deep(.p-scrollpanel:active .p-scrollpanel-bar) {\n  @apply opacity-50;\n}\n\n:deep(.p-selectbutton) {\n  @apply rounded-none h-full;\n}\n\n.workflow-tabs-container-desktop {\n  max-width: env(titlebar-area-width, 100vw);\n}\n\n.window-actions-spacer {\n  @apply flex-auto;\n  /* If we are using custom titlebar, then we need to add a gap for the user to drag the window */\n  --window-actions-spacer-width: min(75px, env(titlebar-area-width, 0) * 9999);\n  min-width: var(--window-actions-spacer-width);\n}\n</style>\n","/**\n * Composable for syncing LiteGraph with the Layout system\n *\n * Implements one-way sync from Layout Store to LiteGraph.\n * The layout store is the single source of truth.\n */\nimport { onUnmounted, ref } from 'vue'\n\nimport type { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { layoutStore } from '@/renderer/core/layout/store/layoutStore'\n\n/**\n * Composable for syncing LiteGraph with the Layout system\n * This replaces the bidirectional sync with a one-way sync\n */\nexport function useLayoutSync() {\n  const unsubscribe = ref<() => void>()\n\n  /**\n   * Start syncing from Layout  LiteGraph\n   */\n  function startSync(canvas: ReturnType<typeof useCanvasStore>['canvas']) {\n    if (!canvas?.graph) return\n\n    // Cancel last subscription\n    stopSync()\n    // Subscribe to layout changes\n    unsubscribe.value = layoutStore.onChange((change) => {\n      // Apply changes to LiteGraph regardless of source\n      // The layout store is the single source of truth\n      for (const nodeId of change.nodeIds) {\n        const layout = layoutStore.getNodeLayoutRef(nodeId).value\n        if (!layout) continue\n\n        const liteNode = canvas.graph?.getNodeById(parseInt(nodeId))\n        if (!liteNode) continue\n\n        if (\n          liteNode.pos[0] !== layout.position.x ||\n          liteNode.pos[1] !== layout.position.y\n        ) {\n          liteNode.pos[0] = layout.position.x\n          liteNode.pos[1] = layout.position.y\n        }\n\n        // Note: layout.size.height is the content height without title.\n        // LiteGraph's measure() will add titleHeight to get boundingRect.\n        // Do NOT use addNodeTitleHeight here - that would double-count the title.\n        if (\n          liteNode.size[0] !== layout.size.width ||\n          liteNode.size[1] !== layout.size.height\n        ) {\n          // Use setSize() to trigger onResize callback\n          liteNode.setSize([layout.size.width, layout.size.height])\n        }\n      }\n\n      // Trigger single redraw for all changes\n      canvas.setDirty(true, true)\n    })\n  }\n\n  function stopSync() {\n    unsubscribe.value?.()\n    unsubscribe.value = undefined\n  }\n\n  onUnmounted(stopSync)\n\n  return {\n    startSync,\n    stopSync\n  }\n}\n","import { createSharedComposable, whenever } from '@vueuse/core'\nimport { shallowRef, watch } from 'vue'\n\nimport { useGraphNodeManager } from '@/composables/graph/useGraphNodeManager'\nimport type { GraphNodeManager } from '@/composables/graph/useGraphNodeManager'\nimport { useVueFeatureFlags } from '@/composables/useVueFeatureFlags'\nimport type { LGraphNode } from '@/lib/litegraph/src/litegraph'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useLayoutMutations } from '@/renderer/core/layout/operations/layoutMutations'\nimport { layoutStore } from '@/renderer/core/layout/store/layoutStore'\nimport { useLayoutSync } from '@/renderer/core/layout/sync/useLayoutSync'\nimport { removeNodeTitleHeight } from '@/renderer/core/layout/utils/nodeSizeUtil'\nimport { ensureCorrectLayoutScale } from '@/renderer/extensions/vueNodes/layout/ensureCorrectLayoutScale'\nimport { app as comfyApp } from '@/scripts/app'\n\nfunction useVueNodeLifecycleIndividual() {\n  const canvasStore = useCanvasStore()\n  const layoutMutations = useLayoutMutations()\n  const { shouldRenderVueNodes } = useVueFeatureFlags()\n  const nodeManager = shallowRef<GraphNodeManager | null>(null)\n  const { startSync } = useLayoutSync()\n\n  const initializeNodeManager = () => {\n    // Use canvas graph if available (handles subgraph contexts), fallback to app graph\n    const activeGraph = comfyApp.canvas?.graph\n    if (!activeGraph || nodeManager.value) return\n\n    // Initialize the core node manager\n    const manager = useGraphNodeManager(activeGraph)\n    nodeManager.value = manager\n\n    // Initialize layout system with existing nodes from active graph\n    const nodes = activeGraph._nodes.map((node: LGraphNode) => ({\n      id: node.id.toString(),\n      pos: [node.pos[0], node.pos[1]] as [number, number],\n      size: [node.size[0], removeNodeTitleHeight(node.size[1])] as [\n        number,\n        number\n      ]\n    }))\n    layoutStore.initializeFromLiteGraph(nodes)\n\n    // Seed reroutes into the Layout Store so hit-testing uses the new path\n    for (const reroute of activeGraph.reroutes.values()) {\n      const [x, y] = reroute.pos\n      const parent = reroute.parentId ?? undefined\n      const linkIds = Array.from(reroute.linkIds)\n      layoutMutations.createReroute(reroute.id, { x, y }, parent, linkIds)\n    }\n\n    // Seed existing links into the Layout Store (topology only)\n    for (const link of activeGraph._links.values()) {\n      layoutMutations.createLink(\n        link.id,\n        link.origin_id,\n        link.origin_slot,\n        link.target_id,\n        link.target_slot\n      )\n    }\n\n    // Initialize layout sync (one-way: Layout Store  LiteGraph)\n    startSync(canvasStore.canvas)\n  }\n\n  const disposeNodeManagerAndSyncs = () => {\n    if (!nodeManager.value) return\n\n    try {\n      nodeManager.value.cleanup()\n    } catch {\n      /* empty */\n    }\n    nodeManager.value = null\n  }\n\n  // Watch for Vue nodes enabled state changes\n  watch(\n    () => shouldRenderVueNodes.value && Boolean(comfyApp.canvas?.graph),\n    (enabled) => {\n      if (enabled) {\n        initializeNodeManager()\n        ensureCorrectLayoutScale(\n          comfyApp.canvas?.graph?.extra.workflowRendererVersion\n        )\n      }\n    },\n    { immediate: true }\n  )\n\n  whenever(\n    () => !shouldRenderVueNodes.value,\n    () => {\n      ensureCorrectLayoutScale(\n        comfyApp.canvas?.graph?.extra.workflowRendererVersion\n      )\n      disposeNodeManagerAndSyncs()\n      comfyApp.canvas?.setDirty(true, true)\n    }\n  )\n\n  // Consolidated watch for slot layout sync management\n  watch(\n    () => shouldRenderVueNodes.value,\n    (vueMode, oldVueMode) => {\n      const modeChanged = vueMode !== oldVueMode\n\n      // Clear stale slot layouts when switching modes\n      if (modeChanged) {\n        layoutStore.clearAllSlotLayouts()\n      }\n    },\n    { immediate: true, flush: 'sync' }\n  )\n\n  // Handle case where Vue nodes are enabled but graph starts empty\n  const setupEmptyGraphListener = () => {\n    const activeGraph = comfyApp.canvas?.graph\n    if (\n      !shouldRenderVueNodes.value ||\n      nodeManager.value ||\n      activeGraph?._nodes.length !== 0\n    ) {\n      return\n    }\n    const originalOnNodeAdded = activeGraph.onNodeAdded\n    activeGraph.onNodeAdded = function (node: LGraphNode) {\n      // Restore original handler\n      activeGraph.onNodeAdded = originalOnNodeAdded\n\n      // Initialize node manager if needed\n      if (shouldRenderVueNodes.value && !nodeManager.value) {\n        initializeNodeManager()\n      }\n\n      // Call original handler\n      if (originalOnNodeAdded) {\n        originalOnNodeAdded.call(this, node)\n      }\n    }\n  }\n\n  // Cleanup function for component unmounting\n  const cleanup = () => {\n    if (nodeManager.value) {\n      nodeManager.value.cleanup()\n      nodeManager.value = null\n    }\n  }\n\n  return {\n    nodeManager,\n\n    // Lifecycle methods\n    initializeNodeManager,\n    disposeNodeManagerAndSyncs,\n    setupEmptyGraphListener,\n    cleanup\n  }\n}\n\nexport const useVueNodeLifecycle = createSharedComposable(\n  useVueNodeLifecycleIndividual\n)\n","import { formatCreditsFromUsd } from '@/base/credits/comfyCredits'\nimport type { INodeInputSlot, LGraphNode } from '@/lib/litegraph/src/litegraph'\nimport type { IComboWidget } from '@/lib/litegraph/src/types/widgets'\n\nconst DEFAULT_NUMBER_OPTIONS: Intl.NumberFormatOptions = {\n  minimumFractionDigits: 0,\n  maximumFractionDigits: 0\n}\n\ntype CreditFormatOptions = {\n  suffix?: string\n  note?: string\n  approximate?: boolean\n  separator?: string\n}\n\nconst formatCreditsValue = (usd: number): string =>\n  formatCreditsFromUsd({\n    usd,\n    numberOptions: DEFAULT_NUMBER_OPTIONS\n  })\n\nconst makePrefix = (approximate?: boolean) => (approximate ? '~' : '')\n\nconst makeSuffix = (suffix?: string) => suffix ?? '/Run'\n\nconst appendNote = (note?: string) => (note ? ` ${note}` : '')\n\nconst formatCreditsLabel = (\n  usd: number,\n  { suffix, note, approximate }: CreditFormatOptions = {}\n): string =>\n  `${makePrefix(approximate)}${formatCreditsValue(usd)} credits${makeSuffix(suffix)}${appendNote(note)}`\n\nconst formatCreditsRangeLabel = (\n  minUsd: number,\n  maxUsd: number,\n  { suffix, note, approximate }: CreditFormatOptions = {}\n): string => {\n  const min = formatCreditsValue(minUsd)\n  const max = formatCreditsValue(maxUsd)\n  const rangeValue = min === max ? min : `${min}-${max}`\n  return `${makePrefix(approximate)}${rangeValue} credits${makeSuffix(suffix)}${appendNote(note)}`\n}\n\nconst formatCreditsListLabel = (\n  usdValues: number[],\n  { suffix, note, approximate, separator }: CreditFormatOptions = {}\n): string => {\n  const parts = usdValues.map((value) => formatCreditsValue(value))\n  const value = parts.join(separator ?? '/')\n  return `${makePrefix(approximate)}${value} credits${makeSuffix(suffix)}${appendNote(note)}`\n}\n\n/**\n * Function that calculates dynamic pricing based on node widget values\n */\ntype PricingFunction = (node: LGraphNode) => string\n\n/**\n * Safely executes a pricing function with error handling\n * Returns null if the function throws an error, allowing the node to still render\n */\nfunction safePricingExecution(\n  fn: PricingFunction,\n  node: LGraphNode,\n  fallback: string = ''\n): string {\n  try {\n    return fn(node)\n  } catch (error) {\n    // Log error in development but don't throw to avoid breaking node rendering\n    if (process.env.NODE_ENV === 'development') {\n      console.warn(\n        'Pricing calculation failed for node:',\n        node.constructor?.nodeData?.name,\n        error\n      )\n    }\n    return fallback\n  }\n}\n\n/**\n * Helper function to calculate Runway duration-based pricing\n * @param node - The LiteGraph node\n * @returns Formatted price string\n */\nconst calculateRunwayDurationPrice = (node: LGraphNode): string => {\n  const durationWidget = node.widgets?.find(\n    (w) => w.name === 'duration'\n  ) as IComboWidget\n\n  if (!durationWidget) return formatCreditsLabel(0.0715, { suffix: '/second' })\n\n  const duration = Number(durationWidget.value)\n  const validDuration = isNaN(duration) ? 5 : duration\n  const cost = 0.0715 * validDuration\n  return formatCreditsLabel(cost)\n}\n\nconst makeOmniProDurationCalculator =\n  (pricePerSecond: number): PricingFunction =>\n  (node: LGraphNode): string => {\n    const durationWidget = node.widgets?.find(\n      (w) => w.name === 'duration'\n    ) as IComboWidget\n    if (!durationWidget)\n      return formatCreditsLabel(pricePerSecond, { suffix: '/second' })\n\n    const seconds = parseFloat(String(durationWidget.value))\n    if (!Number.isFinite(seconds))\n      return formatCreditsLabel(pricePerSecond, { suffix: '/second' })\n\n    const cost = pricePerSecond * seconds\n    return formatCreditsLabel(cost)\n  }\n\nconst klingMotionControlPricingCalculator: PricingFunction = (\n  node: LGraphNode\n): string => {\n  const modeWidget = node.widgets?.find(\n    (w) => w.name === 'mode'\n  ) as IComboWidget\n\n  if (!modeWidget) {\n    return formatCreditsListLabel([0.07, 0.112], {\n      suffix: '/second',\n      note: '(std/pro)'\n    })\n  }\n\n  const mode = String(modeWidget.value).toLowerCase()\n\n  if (mode === 'pro') return formatCreditsLabel(0.112, { suffix: '/second' })\n  if (mode === 'std') return formatCreditsLabel(0.07, { suffix: '/second' })\n\n  return formatCreditsListLabel([0.07, 0.112], {\n    suffix: '/second',\n    note: '(std/pro)'\n  })\n}\n\nconst pixversePricingCalculator = (node: LGraphNode): string => {\n  const durationWidget = node.widgets?.find(\n    (w) => w.name === 'duration_seconds'\n  ) as IComboWidget\n  const qualityWidget = node.widgets?.find(\n    (w) => w.name === 'quality'\n  ) as IComboWidget\n  const motionModeWidget = node.widgets?.find(\n    (w) => w.name === 'motion_mode'\n  ) as IComboWidget\n\n  if (!durationWidget || !qualityWidget) {\n    return formatCreditsRangeLabel(0.45, 1.2, {\n      note: '(varies with duration, quality & motion mode)'\n    })\n  }\n\n  const duration = String(durationWidget.value)\n  const quality = String(qualityWidget.value)\n  const motionMode = String(motionModeWidget?.value)\n\n  // Basic pricing based on duration and quality\n  if (duration.includes('5')) {\n    if (quality.includes('1080p')) return formatCreditsLabel(1.2)\n    if (quality.includes('720p') && motionMode?.includes('fast'))\n      return formatCreditsLabel(1.2)\n    if (quality.includes('720p') && motionMode?.includes('normal'))\n      return formatCreditsLabel(0.6)\n    if (quality.includes('540p') && motionMode?.includes('fast'))\n      return formatCreditsLabel(0.9)\n    if (quality.includes('540p') && motionMode?.includes('normal'))\n      return formatCreditsLabel(0.45)\n    if (quality.includes('360p') && motionMode?.includes('fast'))\n      return formatCreditsLabel(0.9)\n    if (quality.includes('360p') && motionMode?.includes('normal'))\n      return formatCreditsLabel(0.45)\n  } else if (duration.includes('8')) {\n    if (quality.includes('540p') && motionMode?.includes('normal'))\n      return formatCreditsLabel(0.9)\n    if (quality.includes('540p') && motionMode?.includes('fast'))\n      return formatCreditsLabel(1.2)\n    if (quality.includes('360p') && motionMode?.includes('normal'))\n      return formatCreditsLabel(0.9)\n    if (quality.includes('360p') && motionMode?.includes('fast'))\n      return formatCreditsLabel(1.2)\n    if (quality.includes('1080p') && motionMode?.includes('normal'))\n      return formatCreditsLabel(1.2)\n    if (quality.includes('1080p') && motionMode?.includes('fast'))\n      return formatCreditsLabel(1.2)\n    if (quality.includes('720p') && motionMode?.includes('normal'))\n      return formatCreditsLabel(1.2)\n    if (quality.includes('720p') && motionMode?.includes('fast'))\n      return formatCreditsLabel(1.2)\n  }\n\n  return formatCreditsLabel(0.9)\n}\n\nconst byteDanceVideoPricingCalculator = (node: LGraphNode): string => {\n  const modelWidget = node.widgets?.find(\n    (w) => w.name === 'model'\n  ) as IComboWidget\n  const durationWidget = node.widgets?.find(\n    (w) => w.name === 'duration'\n  ) as IComboWidget\n  const resolutionWidget = node.widgets?.find(\n    (w) => w.name === 'resolution'\n  ) as IComboWidget\n\n  if (!modelWidget || !durationWidget || !resolutionWidget) return 'Token-based'\n\n  const model = String(modelWidget.value).toLowerCase()\n  const resolution = String(resolutionWidget.value).toLowerCase()\n  const seconds = parseFloat(String(durationWidget.value))\n  const priceByModel: Record<string, Record<string, [number, number]>> = {\n    'seedance-1-0-pro': {\n      '480p': [0.23, 0.24],\n      '720p': [0.51, 0.56],\n      '1080p': [1.18, 1.22]\n    },\n    'seedance-1-0-pro-fast': {\n      '480p': [0.09, 0.1],\n      '720p': [0.21, 0.23],\n      '1080p': [0.47, 0.49]\n    },\n    'seedance-1-0-lite': {\n      '480p': [0.17, 0.18],\n      '720p': [0.37, 0.41],\n      '1080p': [0.85, 0.88]\n    }\n  }\n\n  const modelKey = model.includes('seedance-1-0-pro-fast')\n    ? 'seedance-1-0-pro-fast'\n    : model.includes('seedance-1-0-pro')\n      ? 'seedance-1-0-pro'\n      : model.includes('seedance-1-0-lite')\n        ? 'seedance-1-0-lite'\n        : ''\n\n  const resKey = resolution.includes('1080')\n    ? '1080p'\n    : resolution.includes('720')\n      ? '720p'\n      : resolution.includes('480')\n        ? '480p'\n        : ''\n\n  const baseRange =\n    modelKey && resKey ? priceByModel[modelKey]?.[resKey] : undefined\n  if (!baseRange) return 'Token-based'\n\n  const [min10s, max10s] = baseRange\n  const scale = seconds / 10\n  const minCost = min10s * scale\n  const maxCost = max10s * scale\n\n  if (minCost === maxCost) return formatCreditsLabel(minCost)\n  return formatCreditsRangeLabel(minCost, maxCost)\n}\n\nconst ltxvPricingCalculator = (node: LGraphNode): string => {\n  const modelWidget = node.widgets?.find(\n    (w) => w.name === 'model'\n  ) as IComboWidget\n  const durationWidget = node.widgets?.find(\n    (w) => w.name === 'duration'\n  ) as IComboWidget\n  const resolutionWidget = node.widgets?.find(\n    (w) => w.name === 'resolution'\n  ) as IComboWidget\n\n  const fallback = formatCreditsRangeLabel(0.04, 0.24, {\n    suffix: '/second'\n  })\n  if (!modelWidget || !durationWidget || !resolutionWidget) return fallback\n\n  const model = String(modelWidget.value).toLowerCase()\n  const resolution = String(resolutionWidget.value).toLowerCase()\n  const seconds = parseFloat(String(durationWidget.value))\n  const priceByModel: Record<string, Record<string, number>> = {\n    'ltx-2 (pro)': {\n      '1920x1080': 0.06,\n      '2560x1440': 0.12,\n      '3840x2160': 0.24\n    },\n    'ltx-2 (fast)': {\n      '1920x1080': 0.04,\n      '2560x1440': 0.08,\n      '3840x2160': 0.16\n    }\n  }\n\n  const modelTable = priceByModel[model]\n  if (!modelTable) return fallback\n\n  const pps = modelTable[resolution]\n  if (!pps) return fallback\n\n  const cost = pps * seconds\n  return formatCreditsLabel(cost)\n}\n\nconst klingVideoWithAudioPricingCalculator: PricingFunction = (\n  node: LGraphNode\n): string => {\n  const durationWidget = node.widgets?.find(\n    (w) => w.name === 'duration'\n  ) as IComboWidget\n  const generateAudioWidget = node.widgets?.find(\n    (w) => w.name === 'generate_audio'\n  ) as IComboWidget\n\n  if (!durationWidget || !generateAudioWidget) {\n    return formatCreditsRangeLabel(0.35, 1.4, {\n      note: '(varies with duration & audio)'\n    })\n  }\n\n  const duration = String(durationWidget.value)\n  const generateAudio =\n    String(generateAudioWidget.value).toLowerCase() === 'true'\n\n  if (duration === '5') {\n    return generateAudio ? formatCreditsLabel(0.7) : formatCreditsLabel(0.35)\n  }\n\n  if (duration === '10') {\n    return generateAudio ? formatCreditsLabel(1.4) : formatCreditsLabel(0.7)\n  }\n\n  // Fallback for unexpected duration values\n  return formatCreditsRangeLabel(0.35, 1.4, {\n    note: '(varies with duration & audio)'\n  })\n}\n\n// ---- constants ----\nconst SORA_SIZES = {\n  BASIC: new Set(['720x1280', '1280x720']),\n  PRO: new Set(['1024x1792', '1792x1024'])\n}\nconst ALL_SIZES = new Set([...SORA_SIZES.BASIC, ...SORA_SIZES.PRO])\n\n// ---- sora-2 pricing helpers ----\nfunction validateSora2Selection(\n  modelRaw: string,\n  duration: number,\n  sizeRaw: string\n): string | undefined {\n  const model = modelRaw?.toLowerCase() ?? ''\n  const size = sizeRaw?.toLowerCase() ?? ''\n\n  if (!duration || Number.isNaN(duration)) return 'Set duration (4s / 8s / 12s)'\n  if (!size) return 'Set size (720x1280, 1280x720, 1024x1792, 1792x1024)'\n  if (!ALL_SIZES.has(size))\n    return 'Invalid size. Must be 720x1280, 1280x720, 1024x1792, or 1792x1024.'\n\n  if (model.includes('sora-2-pro')) return undefined\n\n  if (model.includes('sora-2') && !SORA_SIZES.BASIC.has(size))\n    return 'sora-2 supports only 720x1280 or 1280x720'\n\n  if (!model.includes('sora-2')) return 'Unsupported model'\n\n  return undefined\n}\n\nfunction perSecForSora2(modelRaw: string, sizeRaw: string): number {\n  const model = modelRaw?.toLowerCase() ?? ''\n  const size = sizeRaw?.toLowerCase() ?? ''\n\n  if (model.includes('sora-2-pro')) {\n    return SORA_SIZES.PRO.has(size) ? 0.5 : 0.3\n  }\n  if (model.includes('sora-2')) return 0.1\n\n  return SORA_SIZES.PRO.has(size) ? 0.5 : 0.1\n}\n\nfunction formatRunPrice(perSec: number, duration: number) {\n  return formatCreditsLabel(Number((perSec * duration).toFixed(2)))\n}\n\n// ---- pricing calculator ----\nconst sora2PricingCalculator: PricingFunction = (node: LGraphNode): string => {\n  const getWidgetValue = (name: string) =>\n    String(node.widgets?.find((w) => w.name === name)?.value ?? '')\n\n  const model = getWidgetValue('model')\n  const size = getWidgetValue('size')\n  const duration = Number(\n    node.widgets?.find((w) => ['duration', 'duration_s'].includes(w.name))\n      ?.value\n  )\n\n  if (!model || !size || !duration) return 'Set model, duration & size'\n\n  const validationError = validateSora2Selection(model, duration, size)\n  if (validationError) return validationError\n\n  const perSec = perSecForSora2(model, size)\n  return formatRunPrice(perSec, duration)\n}\n\n/**\n * Pricing for Tripo 3D generation nodes (Text / Image / Multiview)\n * based on Tripo credits:\n *\n * Turbo / V3 / V2.5 / V2.0:\n *   Text  -> 10 (no texture) / 20 (standard texture)\n *   Image -> 20 (no texture) / 30 (standard texture)\n *   Multiview -> 20 (no texture) / 30 (standard texture)\n *\n * V1.4:\n *   Text  -> 20\n *   Image -> 30\n *   (Multiview treated same as Image if used)\n *\n * Advanced extras (added on top of generation credits):\n *   quad               -> +5 credits\n *   style              -> +5 credits (if style != \"None\")\n *   HD texture         -> +10 credits (texture_quality = \"detailed\")\n *   detailed geometry  -> +20 credits (geometry_quality = \"detailed\")\n *\n * 1 credit = $0.01\n */\nconst calculateTripo3DGenerationPrice = (\n  node: LGraphNode,\n  task: 'text' | 'image' | 'multiview'\n): string => {\n  const getWidget = (name: string): IComboWidget | undefined =>\n    node.widgets?.find((w) => w.name === name) as IComboWidget | undefined\n\n  const getString = (name: string, defaultValue: string): string => {\n    const widget = getWidget(name)\n    if (!widget || widget.value === undefined || widget.value === null) {\n      return defaultValue\n    }\n    return String(widget.value)\n  }\n\n  const getBool = (name: string, defaultValue: boolean): boolean => {\n    const widget = getWidget(name)\n    if (!widget || widget.value === undefined || widget.value === null) {\n      return defaultValue\n    }\n\n    const v = widget.value\n    if (typeof v === 'number') return v !== 0\n    const lower = String(v).toLowerCase()\n    if (lower === 'true') return true\n    if (lower === 'false') return false\n\n    return defaultValue\n  }\n\n  // ---- read widget values with sensible defaults (mirroring backend) ----\n  const modelVersionRaw = getString('model_version', '').toLowerCase()\n  if (modelVersionRaw === '')\n    return formatCreditsRangeLabel(0.1, 0.65, {\n      note: '(varies with quad, style, texture & quality)'\n    })\n  const styleRaw = getString('style', 'None')\n  const hasStyle = styleRaw.toLowerCase() !== 'none'\n\n  // Backend defaults: texture=true, pbr=true, quad=false, qualities=\"standard\"\n  const hasTexture = getBool('texture', false)\n  const hasPbr = getBool('pbr', false)\n  const quad = getBool('quad', false)\n\n  const textureQualityRaw = getString(\n    'texture_quality',\n    'standard'\n  ).toLowerCase()\n  const geometryQualityRaw = getString(\n    'geometry_quality',\n    'standard'\n  ).toLowerCase()\n\n  const isHdTexture = textureQualityRaw === 'detailed'\n  const isDetailedGeometry = geometryQualityRaw === 'detailed'\n\n  const withTexture = hasTexture || hasPbr\n\n  let baseCredits: number\n\n  if (modelVersionRaw.includes('v1.4')) {\n    // V1.4 model: Text=20, Image=30, Refine=30\n    if (task === 'text') {\n      baseCredits = 20\n    } else {\n      // treat Multiview same as Image if V1.4 is ever used there\n      baseCredits = 30\n    }\n  } else {\n    // V3.0, V2.5, V2.0 models\n    if (!withTexture) {\n      if (task === 'text') {\n        baseCredits = 10 // Text to 3D without texture\n      } else {\n        baseCredits = 20 // Image/Multiview to 3D without texture\n      }\n    } else {\n      if (task === 'text') {\n        baseCredits = 20 // Text to 3D with standard texture\n      } else {\n        baseCredits = 30 // Image/Multiview to 3D with standard texture\n      }\n    }\n  }\n\n  // ---- advanced extras on top of base generation ----\n  let credits = baseCredits\n\n  if (hasStyle) credits += 5 // Style\n  if (quad) credits += 5 // Quad Topology\n  if (isHdTexture) credits += 10 // HD Texture\n  if (isDetailedGeometry) credits += 20 // Detailed Geometry Quality\n\n  const dollars = credits * 0.01\n  return formatCreditsLabel(dollars)\n}\n\n/**\n * Static pricing data for API nodes, now supporting both strings and functions\n */\nconst apiNodeCosts: Record<string, { displayPrice: string | PricingFunction }> =\n  {\n    FluxProCannyNode: {\n      displayPrice: formatCreditsLabel(0.05)\n    },\n    FluxProDepthNode: {\n      displayPrice: formatCreditsLabel(0.05)\n    },\n    FluxProExpandNode: {\n      displayPrice: formatCreditsLabel(0.05)\n    },\n    FluxProFillNode: {\n      displayPrice: formatCreditsLabel(0.05)\n    },\n    FluxProUltraImageNode: {\n      displayPrice: formatCreditsLabel(0.06)\n    },\n    FluxProKontextProNode: {\n      displayPrice: formatCreditsLabel(0.04)\n    },\n    FluxProKontextMaxNode: {\n      displayPrice: formatCreditsLabel(0.08)\n    },\n    Flux2ProImageNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const widthW = node.widgets?.find(\n          (w) => w.name === 'width'\n        ) as IComboWidget\n        const heightW = node.widgets?.find(\n          (w) => w.name === 'height'\n        ) as IComboWidget\n\n        const w = Number(widthW?.value)\n        const h = Number(heightW?.value)\n        if (!Number.isFinite(w) || !Number.isFinite(h) || w <= 0 || h <= 0) {\n          // global min/max for this node given schema bounds (1MP..4MP output)\n          return formatCreditsRangeLabel(0.03, 0.15)\n        }\n\n        // Is the 'images' input connected?\n        const imagesInput = node.inputs?.find(\n          (i) => i.name === 'images'\n        ) as INodeInputSlot\n        const hasRefs =\n          typeof imagesInput?.link !== 'undefined' && imagesInput.link != null\n\n        // Output cost: ceil((w*h)/MP); first MP $0.03, each additional $0.015\n        const MP = 1024 * 1024\n        const outMP = Math.max(1, Math.floor((w * h + MP - 1) / MP))\n        const outputCost = 0.03 + 0.015 * Math.max(outMP - 1, 0)\n\n        if (hasRefs) {\n          // Unknown ref count/size on the frontend:\n          // min extra is $0.015, max extra is $0.120 (8 MP cap / 8 refs)\n          const minTotal = outputCost + 0.015\n          const maxTotal = outputCost + 0.12\n          return formatCreditsRangeLabel(minTotal, maxTotal, {\n            approximate: true\n          })\n        }\n\n        // Precise text-to-image price\n        return formatCreditsLabel(outputCost)\n      }\n    },\n    Flux2MaxImageNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const widthW = node.widgets?.find(\n          (w) => w.name === 'width'\n        ) as IComboWidget\n        const heightW = node.widgets?.find(\n          (w) => w.name === 'height'\n        ) as IComboWidget\n\n        const w = Number(widthW?.value)\n        const h = Number(heightW?.value)\n        if (!Number.isFinite(w) || !Number.isFinite(h) || w <= 0 || h <= 0) {\n          // global min/max for this node given schema bounds (1MP..4MP output)\n          return formatCreditsRangeLabel(0.07, 0.35)\n        }\n\n        // Is the 'images' input connected?\n        const imagesInput = node.inputs?.find(\n          (i) => i.name === 'images'\n        ) as INodeInputSlot\n        const hasRefs =\n          typeof imagesInput?.link !== 'undefined' && imagesInput.link != null\n\n        // Output cost: ceil((w*h)/MP); first MP $0.07, each additional $0.03\n        const MP = 1024 * 1024\n        const outMP = Math.max(1, Math.floor((w * h + MP - 1) / MP))\n        const outputCost = 0.07 + 0.03 * Math.max(outMP - 1, 0)\n\n        if (hasRefs) {\n          // Unknown ref count/size on the frontend:\n          // min extra is $0.03, max extra is $0.24 (8 MP cap / 8 refs)\n          const minTotal = outputCost + 0.03\n          const maxTotal = outputCost + 0.24\n          return formatCreditsRangeLabel(minTotal, maxTotal)\n        }\n\n        return formatCreditsLabel(outputCost)\n      }\n    },\n    OpenAIVideoSora2: {\n      displayPrice: sora2PricingCalculator\n    },\n    IdeogramV1: {\n      displayPrice: (node: LGraphNode): string => {\n        const numImagesWidget = node.widgets?.find(\n          (w) => w.name === 'num_images'\n        ) as IComboWidget\n        const turboWidget = node.widgets?.find(\n          (w) => w.name === 'turbo'\n        ) as IComboWidget\n\n        if (!numImagesWidget)\n          return formatCreditsRangeLabel(0.03, 0.09, {\n            suffix: ' x num_images/Run'\n          })\n\n        const numImages = Number(numImagesWidget.value) || 1\n        const turbo = String(turboWidget?.value).toLowerCase() === 'true'\n        const basePrice = turbo ? 0.0286 : 0.0858\n        const cost = Number((basePrice * numImages).toFixed(2))\n        return formatCreditsLabel(cost)\n      }\n    },\n    IdeogramV2: {\n      displayPrice: (node: LGraphNode): string => {\n        const numImagesWidget = node.widgets?.find(\n          (w) => w.name === 'num_images'\n        ) as IComboWidget\n        const turboWidget = node.widgets?.find(\n          (w) => w.name === 'turbo'\n        ) as IComboWidget\n\n        if (!numImagesWidget)\n          return formatCreditsRangeLabel(0.07, 0.11, {\n            suffix: ' x num_images/Run'\n          })\n\n        const numImages = Number(numImagesWidget.value) || 1\n        const turbo = String(turboWidget?.value).toLowerCase() === 'true'\n        const basePrice = turbo ? 0.0715 : 0.1144\n        const cost = Number((basePrice * numImages).toFixed(2))\n        return formatCreditsLabel(cost)\n      }\n    },\n    IdeogramV3: {\n      displayPrice: (node: LGraphNode): string => {\n        const renderingSpeedWidget = node.widgets?.find(\n          (w) => w.name === 'rendering_speed'\n        ) as IComboWidget\n        const numImagesWidget = node.widgets?.find(\n          (w) => w.name === 'num_images'\n        ) as IComboWidget\n        const characterInput = node.inputs?.find(\n          (i) => i.name === 'character_image'\n        ) as INodeInputSlot\n        const hasCharacter =\n          typeof characterInput?.link !== 'undefined' &&\n          characterInput.link != null\n\n        if (!renderingSpeedWidget)\n          return formatCreditsRangeLabel(0.04, 0.11, {\n            suffix: ' x num_images/Run',\n            note: '(varies with rendering speed & num_images)'\n          })\n\n        const numImages = Number(numImagesWidget?.value) || 1\n        let basePrice = 0.0858 // default balanced price\n\n        const renderingSpeed = String(renderingSpeedWidget.value)\n        if (renderingSpeed.toLowerCase().includes('quality')) {\n          if (hasCharacter) {\n            basePrice = 0.286\n          } else {\n            basePrice = 0.1287\n          }\n        } else if (renderingSpeed.toLowerCase().includes('default')) {\n          if (hasCharacter) {\n            basePrice = 0.2145\n          } else {\n            basePrice = 0.0858\n          }\n        } else if (renderingSpeed.toLowerCase().includes('turbo')) {\n          if (hasCharacter) {\n            basePrice = 0.143\n          } else {\n            basePrice = 0.0429\n          }\n        }\n\n        const totalCost = Number((basePrice * numImages).toFixed(2))\n        return formatCreditsLabel(totalCost)\n      }\n    },\n    KlingCameraControlI2VNode: {\n      displayPrice: formatCreditsLabel(0.49)\n    },\n    KlingCameraControlT2VNode: {\n      displayPrice: formatCreditsLabel(0.14)\n    },\n    KlingDualCharacterVideoEffectNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const modeWidget = node.widgets?.find(\n          (w) => w.name === 'mode'\n        ) as IComboWidget\n        const modelWidget = node.widgets?.find(\n          (w) => w.name === 'model_name'\n        ) as IComboWidget\n        const durationWidget = node.widgets?.find(\n          (w) => w.name === 'duration'\n        ) as IComboWidget\n        if (!modeWidget || !modelWidget || !durationWidget)\n          return formatCreditsRangeLabel(0.14, 2.8, {\n            note: '(varies with model, mode & duration)'\n          })\n\n        const modeValue = String(modeWidget.value)\n        const durationValue = String(durationWidget.value)\n        const modelValue = String(modelWidget.value)\n\n        // Same pricing matrix as KlingTextToVideoNode\n        if (modelValue.includes('v1-6') || modelValue.includes('v1-5')) {\n          if (modeValue.includes('pro')) {\n            return durationValue.includes('10')\n              ? formatCreditsLabel(0.98)\n              : formatCreditsLabel(0.49)\n          } else {\n            return durationValue.includes('10')\n              ? formatCreditsLabel(0.56)\n              : formatCreditsLabel(0.28)\n          }\n        } else if (modelValue.includes('v1')) {\n          if (modeValue.includes('pro')) {\n            return durationValue.includes('10')\n              ? formatCreditsLabel(0.98)\n              : formatCreditsLabel(0.49)\n          } else {\n            return durationValue.includes('10')\n              ? formatCreditsLabel(0.28)\n              : formatCreditsLabel(0.14)\n          }\n        }\n\n        return formatCreditsLabel(0.14)\n      }\n    },\n    KlingImage2VideoNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const modeWidget = node.widgets?.find(\n          (w) => w.name === 'mode'\n        ) as IComboWidget\n        const modelWidget = node.widgets?.find(\n          (w) => w.name === 'model_name'\n        ) as IComboWidget\n        const durationWidget = node.widgets?.find(\n          (w) => w.name === 'duration'\n        ) as IComboWidget\n\n        if (!modeWidget) {\n          if (!modelWidget)\n            return formatCreditsRangeLabel(0.14, 2.8, {\n              note: '(varies with model, mode & duration)'\n            })\n\n          const modelValue = String(modelWidget.value)\n          if (\n            modelValue.includes('v2-1-master') ||\n            modelValue.includes('v2-master')\n          ) {\n            return formatCreditsLabel(1.4)\n          } else if (\n            modelValue.includes('v1-6') ||\n            modelValue.includes('v1-5')\n          ) {\n            return formatCreditsLabel(0.28)\n          }\n          return formatCreditsLabel(0.14)\n        }\n\n        const modeValue = String(modeWidget.value)\n        const durationValue = String(durationWidget.value)\n        const modelValue = String(modelWidget.value)\n\n        // Same pricing matrix as KlingTextToVideoNode\n        if (modelValue.includes('v2-5-turbo')) {\n          if (durationValue.includes('10')) {\n            return formatCreditsLabel(0.7)\n          }\n          return formatCreditsLabel(0.35) // 5s default\n        } else if (\n          modelValue.includes('v2-1-master') ||\n          modelValue.includes('v2-master')\n        ) {\n          if (durationValue.includes('10')) {\n            return formatCreditsLabel(2.8)\n          }\n          return formatCreditsLabel(1.4) // 5s default\n        } else if (\n          modelValue.includes('v2-1') ||\n          modelValue.includes('v1-6') ||\n          modelValue.includes('v1-5')\n        ) {\n          if (modeValue.includes('pro')) {\n            return durationValue.includes('10')\n              ? formatCreditsLabel(0.98)\n              : formatCreditsLabel(0.49)\n          } else {\n            return durationValue.includes('10')\n              ? formatCreditsLabel(0.56)\n              : formatCreditsLabel(0.28)\n          }\n        } else if (modelValue.includes('v1')) {\n          if (modeValue.includes('pro')) {\n            return durationValue.includes('10')\n              ? formatCreditsLabel(0.98)\n              : formatCreditsLabel(0.49)\n          } else {\n            return durationValue.includes('10')\n              ? formatCreditsLabel(0.28)\n              : formatCreditsLabel(0.14)\n          }\n        }\n\n        return formatCreditsLabel(0.14)\n      }\n    },\n    KlingImageGenerationNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const imageInputWidget = node.inputs?.find((i) => i.name === 'image')\n        // If link is not null => image is connected => modality is image to image\n        const modality = imageInputWidget?.link\n          ? 'image to image'\n          : 'text to image'\n        const modelWidget = node.widgets?.find(\n          (w) => w.name === 'model_name'\n        ) as IComboWidget\n        const nWidget = node.widgets?.find(\n          (w) => w.name === 'n'\n        ) as IComboWidget\n\n        if (!modelWidget)\n          return formatCreditsRangeLabel(0.0035, 0.028, {\n            suffix: ' x n/Run',\n            note: '(varies with modality & model)'\n          })\n\n        const model = String(modelWidget.value)\n        const n = Number(nWidget?.value) || 1\n        let basePrice = 0.014 // default\n\n        if (modality.includes('text to image')) {\n          if (model.includes('kling-v1-5') || model.includes('kling-v2')) {\n            basePrice = 0.014\n          } else if (model.includes('kling-v1')) {\n            basePrice = 0.0035\n          }\n        } else if (modality.includes('image to image')) {\n          if (model.includes('kling-v1-5')) {\n            basePrice = 0.028\n          } else if (model.includes('kling-v1')) {\n            basePrice = 0.0035\n          }\n        }\n\n        const totalCost = basePrice * n\n        return formatCreditsLabel(totalCost)\n      }\n    },\n    KlingLipSyncAudioToVideoNode: {\n      displayPrice: formatCreditsLabel(0.1, { approximate: true })\n    },\n    KlingLipSyncTextToVideoNode: {\n      displayPrice: formatCreditsLabel(0.1, { approximate: true })\n    },\n    KlingSingleImageVideoEffectNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const effectSceneWidget = node.widgets?.find(\n          (w) => w.name === 'effect_scene'\n        ) as IComboWidget\n\n        if (!effectSceneWidget)\n          return formatCreditsRangeLabel(0.28, 0.49, {\n            note: '(varies with effect scene)'\n          })\n\n        const effectScene = String(effectSceneWidget.value)\n        if (\n          effectScene.includes('fuzzyfuzzy') ||\n          effectScene.includes('squish')\n        ) {\n          return formatCreditsLabel(0.28)\n        } else if (effectScene.includes('dizzydizzy')) {\n          return formatCreditsLabel(0.49)\n        } else if (effectScene.includes('bloombloom')) {\n          return formatCreditsLabel(0.49)\n        } else if (effectScene.includes('expansion')) {\n          return formatCreditsLabel(0.28)\n        }\n\n        return formatCreditsLabel(0.28)\n      }\n    },\n    KlingStartEndFrameNode: {\n      displayPrice: (node: LGraphNode): string => {\n        // Same pricing as KlingTextToVideoNode per CSV (\"Same as text to video\")\n        const modeWidget = node.widgets?.find(\n          (w) => w.name === 'mode'\n        ) as IComboWidget\n        if (!modeWidget)\n          return formatCreditsRangeLabel(0.14, 2.8, {\n            note: '(varies with model, mode & duration)'\n          })\n\n        const modeValue = String(modeWidget.value)\n\n        // Same pricing matrix as KlingTextToVideoNode\n        if (modeValue.includes('v2-5-turbo')) {\n          if (modeValue.includes('10')) {\n            return formatCreditsLabel(0.7)\n          }\n          return formatCreditsLabel(0.35) // 5s default\n        } else if (modeValue.includes('v2-1')) {\n          if (modeValue.includes('10s')) {\n            return formatCreditsLabel(0.98) // pro, 10s\n          }\n          return formatCreditsLabel(0.49) // pro, 5s default\n        } else if (modeValue.includes('v2-master')) {\n          if (modeValue.includes('10s')) {\n            return formatCreditsLabel(2.8)\n          }\n          return formatCreditsLabel(1.4) // 5s default\n        } else if (modeValue.includes('v1-6')) {\n          if (modeValue.includes('pro')) {\n            return modeValue.includes('10s')\n              ? formatCreditsLabel(0.98)\n              : formatCreditsLabel(0.49)\n          } else {\n            return modeValue.includes('10s')\n              ? formatCreditsLabel(0.56)\n              : formatCreditsLabel(0.28)\n          }\n        } else if (modeValue.includes('v1')) {\n          if (modeValue.includes('pro')) {\n            return modeValue.includes('10s')\n              ? formatCreditsLabel(0.98)\n              : formatCreditsLabel(0.49)\n          } else {\n            return modeValue.includes('10s')\n              ? formatCreditsLabel(0.28)\n              : formatCreditsLabel(0.14)\n          }\n        }\n\n        return formatCreditsLabel(0.14)\n      }\n    },\n    KlingTextToVideoNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const modeWidget = node.widgets?.find(\n          (w) => w.name === 'mode'\n        ) as IComboWidget\n        if (!modeWidget)\n          return formatCreditsRangeLabel(0.14, 2.8, {\n            note: '(varies with model, mode & duration)'\n          })\n\n        const modeValue = String(modeWidget.value)\n\n        // Pricing matrix from CSV data based on mode string content\n        if (modeValue.includes('v2-5-turbo')) {\n          if (modeValue.includes('10')) {\n            return formatCreditsLabel(0.7)\n          }\n          return formatCreditsLabel(0.35) // 5s default\n        } else if (modeValue.includes('v2-1-master')) {\n          if (modeValue.includes('10s')) {\n            return formatCreditsLabel(2.8) // price is the same as for v2-master model\n          }\n          return formatCreditsLabel(1.4) // price is the same as for v2-master model\n        } else if (modeValue.includes('v2-master')) {\n          if (modeValue.includes('10s')) {\n            return formatCreditsLabel(2.8)\n          }\n          return formatCreditsLabel(1.4) // 5s default\n        } else if (modeValue.includes('v1-6')) {\n          if (modeValue.includes('pro')) {\n            return modeValue.includes('10s')\n              ? formatCreditsLabel(0.98)\n              : formatCreditsLabel(0.49)\n          } else {\n            return modeValue.includes('10s')\n              ? formatCreditsLabel(0.56)\n              : formatCreditsLabel(0.28)\n          }\n        } else if (modeValue.includes('v1')) {\n          if (modeValue.includes('pro')) {\n            return modeValue.includes('10s')\n              ? formatCreditsLabel(0.98)\n              : formatCreditsLabel(0.49)\n          } else {\n            return modeValue.includes('10s')\n              ? formatCreditsLabel(0.28)\n              : formatCreditsLabel(0.14)\n          }\n        }\n\n        return formatCreditsLabel(0.14)\n      }\n    },\n    KlingVideoExtendNode: {\n      displayPrice: formatCreditsLabel(0.28)\n    },\n    KlingVirtualTryOnNode: {\n      displayPrice: formatCreditsLabel(0.07)\n    },\n    KlingOmniProTextToVideoNode: {\n      displayPrice: makeOmniProDurationCalculator(0.112)\n    },\n    KlingOmniProFirstLastFrameNode: {\n      displayPrice: makeOmniProDurationCalculator(0.112)\n    },\n    KlingOmniProImageToVideoNode: {\n      displayPrice: makeOmniProDurationCalculator(0.112)\n    },\n    KlingOmniProVideoToVideoNode: {\n      displayPrice: makeOmniProDurationCalculator(0.168)\n    },\n    KlingMotionControl: {\n      displayPrice: klingMotionControlPricingCalculator\n    },\n    KlingOmniProEditVideoNode: {\n      displayPrice: formatCreditsLabel(0.168, { suffix: '/second' })\n    },\n    KlingOmniProImageNode: {\n      displayPrice: formatCreditsLabel(0.028)\n    },\n    KlingTextToVideoWithAudio: {\n      displayPrice: klingVideoWithAudioPricingCalculator\n    },\n    KlingImageToVideoWithAudio: {\n      displayPrice: klingVideoWithAudioPricingCalculator\n    },\n    LumaImageToVideoNode: {\n      displayPrice: (node: LGraphNode): string => {\n        // Same pricing as LumaVideoNode per CSV\n        const modelWidget = node.widgets?.find(\n          (w) => w.name === 'model'\n        ) as IComboWidget\n        const resolutionWidget = node.widgets?.find(\n          (w) => w.name === 'resolution'\n        ) as IComboWidget\n        const durationWidget = node.widgets?.find(\n          (w) => w.name === 'duration'\n        ) as IComboWidget\n\n        if (!modelWidget || !resolutionWidget || !durationWidget) {\n          return formatCreditsRangeLabel(0.2, 16.4, {\n            note: '(varies with model, resolution & duration)'\n          })\n        }\n\n        const model = String(modelWidget.value)\n        const resolution = String(resolutionWidget.value).toLowerCase()\n        const duration = String(durationWidget.value)\n\n        if (model.includes('ray-flash-2')) {\n          if (duration.includes('5s')) {\n            if (resolution.includes('4k')) return formatCreditsLabel(3.13)\n            if (resolution.includes('1080p')) return formatCreditsLabel(0.79)\n            if (resolution.includes('720p')) return formatCreditsLabel(0.34)\n            if (resolution.includes('540p')) return formatCreditsLabel(0.2)\n          } else if (duration.includes('9s')) {\n            if (resolution.includes('4k')) return formatCreditsLabel(5.65)\n            if (resolution.includes('1080p')) return formatCreditsLabel(1.42)\n            if (resolution.includes('720p')) return formatCreditsLabel(0.61)\n            if (resolution.includes('540p')) return formatCreditsLabel(0.36)\n          }\n        } else if (model.includes('ray-2')) {\n          if (duration.includes('5s')) {\n            if (resolution.includes('4k')) return formatCreditsLabel(9.11)\n            if (resolution.includes('1080p')) return formatCreditsLabel(2.27)\n            if (resolution.includes('720p')) return formatCreditsLabel(1.02)\n            if (resolution.includes('540p')) return formatCreditsLabel(0.57)\n          } else if (duration.includes('9s')) {\n            if (resolution.includes('4k')) return formatCreditsLabel(16.4)\n            if (resolution.includes('1080p')) return formatCreditsLabel(4.1)\n            if (resolution.includes('720p')) return formatCreditsLabel(1.83)\n            if (resolution.includes('540p')) return formatCreditsLabel(1.03)\n          }\n        } else if (model.includes('ray-1-6')) {\n          return formatCreditsLabel(0.5)\n        }\n\n        return formatCreditsLabel(0.79)\n      }\n    },\n    LumaVideoNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const modelWidget = node.widgets?.find(\n          (w) => w.name === 'model'\n        ) as IComboWidget\n        const resolutionWidget = node.widgets?.find(\n          (w) => w.name === 'resolution'\n        ) as IComboWidget\n        const durationWidget = node.widgets?.find(\n          (w) => w.name === 'duration'\n        ) as IComboWidget\n\n        if (!modelWidget || !resolutionWidget || !durationWidget) {\n          return formatCreditsRangeLabel(0.2, 16.4, {\n            note: '(varies with model, resolution & duration)'\n          })\n        }\n\n        const model = String(modelWidget.value)\n        const resolution = String(resolutionWidget.value).toLowerCase()\n        const duration = String(durationWidget.value)\n\n        if (model.includes('ray-flash-2')) {\n          if (duration.includes('5s')) {\n            if (resolution.includes('4k')) return formatCreditsLabel(3.13)\n            if (resolution.includes('1080p')) return formatCreditsLabel(0.79)\n            if (resolution.includes('720p')) return formatCreditsLabel(0.34)\n            if (resolution.includes('540p')) return formatCreditsLabel(0.2)\n          } else if (duration.includes('9s')) {\n            if (resolution.includes('4k')) return formatCreditsLabel(5.65)\n            if (resolution.includes('1080p')) return formatCreditsLabel(1.42)\n            if (resolution.includes('720p')) return formatCreditsLabel(0.61)\n            if (resolution.includes('540p')) return formatCreditsLabel(0.36)\n          }\n        } else if (model.includes('ray-2')) {\n          if (duration.includes('5s')) {\n            if (resolution.includes('4k')) return formatCreditsLabel(9.11)\n            if (resolution.includes('1080p')) return formatCreditsLabel(2.27)\n            if (resolution.includes('720p')) return formatCreditsLabel(1.02)\n            if (resolution.includes('540p')) return formatCreditsLabel(0.57)\n          } else if (duration.includes('9s')) {\n            if (resolution.includes('4k')) return formatCreditsLabel(16.4)\n            if (resolution.includes('1080p')) return formatCreditsLabel(4.1)\n            if (resolution.includes('720p')) return formatCreditsLabel(1.83)\n            if (resolution.includes('540p')) return formatCreditsLabel(1.03)\n          }\n        } else if (model.includes('ray-1-6')) {\n          return formatCreditsLabel(0.5)\n        }\n\n        return formatCreditsLabel(0.79)\n      }\n    },\n    MinimaxImageToVideoNode: {\n      displayPrice: formatCreditsLabel(0.43)\n    },\n    MinimaxTextToVideoNode: {\n      displayPrice: formatCreditsLabel(0.43)\n    },\n    MinimaxHailuoVideoNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const resolutionWidget = node.widgets?.find(\n          (w) => w.name === 'resolution'\n        ) as IComboWidget\n        const durationWidget = node.widgets?.find(\n          (w) => w.name === 'duration'\n        ) as IComboWidget\n\n        if (!resolutionWidget || !durationWidget) {\n          return formatCreditsRangeLabel(0.28, 0.56, {\n            note: '(varies with resolution & duration)'\n          })\n        }\n\n        const resolution = String(resolutionWidget.value)\n        const duration = String(durationWidget.value)\n\n        if (resolution.includes('768P')) {\n          if (duration.includes('6')) return formatCreditsLabel(0.28)\n          if (duration.includes('10')) return formatCreditsLabel(0.56)\n        } else if (resolution.includes('1080P')) {\n          if (duration.includes('6')) return formatCreditsLabel(0.49)\n        }\n\n        return formatCreditsLabel(0.43) // default median\n      }\n    },\n    OpenAIDalle2: {\n      displayPrice: (node: LGraphNode): string => {\n        const sizeWidget = node.widgets?.find(\n          (w) => w.name === 'size'\n        ) as IComboWidget\n        const nWidget = node.widgets?.find(\n          (w) => w.name === 'n'\n        ) as IComboWidget\n\n        if (!sizeWidget)\n          return formatCreditsRangeLabel(0.016, 0.02, {\n            suffix: ' x n/Run',\n            note: '(varies with size & n)'\n          })\n\n        const size = String(sizeWidget.value)\n        const n = Number(nWidget?.value) || 1\n        let basePrice = 0.02 // default\n\n        if (size.includes('1024x1024')) {\n          basePrice = 0.02\n        } else if (size.includes('512x512')) {\n          basePrice = 0.018\n        } else if (size.includes('256x256')) {\n          basePrice = 0.016\n        }\n\n        const totalCost = Number((basePrice * n).toFixed(3))\n        return formatCreditsLabel(totalCost)\n      }\n    },\n    OpenAIDalle3: {\n      displayPrice: (node: LGraphNode): string => {\n        // Get size and quality widgets\n        const sizeWidget = node.widgets?.find(\n          (w) => w.name === 'size'\n        ) as IComboWidget\n        const qualityWidget = node.widgets?.find(\n          (w) => w.name === 'quality'\n        ) as IComboWidget\n\n        if (!sizeWidget || !qualityWidget)\n          return formatCreditsRangeLabel(0.04, 0.12, {\n            note: '(varies with size & quality)'\n          })\n\n        const size = String(sizeWidget.value)\n        const quality = String(qualityWidget.value)\n\n        // Pricing matrix based on CSV data\n        if (size.includes('1024x1024')) {\n          return quality.includes('hd')\n            ? formatCreditsLabel(0.08)\n            : formatCreditsLabel(0.04)\n        } else if (size.includes('1792x1024') || size.includes('1024x1792')) {\n          return quality.includes('hd')\n            ? formatCreditsLabel(0.12)\n            : formatCreditsLabel(0.08)\n        }\n\n        // Default value\n        return formatCreditsLabel(0.04)\n      }\n    },\n    OpenAIGPTImage1: {\n      displayPrice: (node: LGraphNode): string => {\n        const qualityWidget = node.widgets?.find(\n          (w) => w.name === 'quality'\n        ) as IComboWidget\n        const nWidget = node.widgets?.find(\n          (w) => w.name === 'n'\n        ) as IComboWidget\n\n        if (!qualityWidget)\n          return formatCreditsRangeLabel(0.011, 0.3, {\n            suffix: ' x n/Run',\n            note: '(varies with quality & n)'\n          })\n\n        const quality = String(qualityWidget.value)\n        const n = Number(nWidget?.value) || 1\n        let range: [number, number] = [0.046, 0.07] // default medium\n\n        if (quality.includes('high')) {\n          range = [0.167, 0.3]\n        } else if (quality.includes('medium')) {\n          range = [0.046, 0.07]\n        } else if (quality.includes('low')) {\n          range = [0.011, 0.02]\n        }\n\n        if (n === 1) {\n          return formatCreditsRangeLabel(range[0], range[1])\n        }\n        return formatCreditsRangeLabel(range[0], range[1], {\n          suffix: ` x ${n}/Run`\n        })\n      }\n    },\n    PixverseImageToVideoNode: {\n      displayPrice: pixversePricingCalculator\n    },\n    PixverseTextToVideoNode: {\n      displayPrice: pixversePricingCalculator\n    },\n    PixverseTransitionVideoNode: {\n      displayPrice: pixversePricingCalculator\n    },\n    RecraftCreativeUpscaleNode: {\n      displayPrice: formatCreditsLabel(0.25)\n    },\n    RecraftCrispUpscaleNode: {\n      displayPrice: formatCreditsLabel(0.004)\n    },\n    RecraftGenerateColorFromImageNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const nWidget = node.widgets?.find(\n          (w) => w.name === 'n'\n        ) as IComboWidget\n        if (!nWidget) return formatCreditsLabel(0.04, { suffix: ' x n/Run' })\n\n        const n = Number(nWidget.value) || 1\n        const cost = Number((0.04 * n).toFixed(2))\n        return formatCreditsLabel(cost)\n      }\n    },\n    RecraftGenerateImageNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const nWidget = node.widgets?.find(\n          (w) => w.name === 'n'\n        ) as IComboWidget\n        if (!nWidget) return formatCreditsLabel(0.04, { suffix: ' x n/Run' })\n\n        const n = Number(nWidget.value) || 1\n        const cost = Number((0.04 * n).toFixed(2))\n        return formatCreditsLabel(cost)\n      }\n    },\n    RecraftGenerateVectorImageNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const nWidget = node.widgets?.find(\n          (w) => w.name === 'n'\n        ) as IComboWidget\n        if (!nWidget) return formatCreditsLabel(0.08, { suffix: ' x n/Run' })\n\n        const n = Number(nWidget.value) || 1\n        const cost = Number((0.08 * n).toFixed(2))\n        return formatCreditsLabel(cost)\n      }\n    },\n    RecraftImageInpaintingNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const nWidget = node.widgets?.find(\n          (w) => w.name === 'n'\n        ) as IComboWidget\n        if (!nWidget) return formatCreditsLabel(0.04, { suffix: ' x n/Run' })\n\n        const n = Number(nWidget.value) || 1\n        const cost = Number((0.04 * n).toFixed(2))\n        return formatCreditsLabel(cost)\n      }\n    },\n    RecraftImageToImageNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const nWidget = node.widgets?.find(\n          (w) => w.name === 'n'\n        ) as IComboWidget\n        if (!nWidget) return formatCreditsLabel(0.04, { suffix: ' x n/Run' })\n\n        const n = Number(nWidget.value) || 1\n        const cost = Number((0.04 * n).toFixed(2))\n        return formatCreditsLabel(cost)\n      }\n    },\n    RecraftRemoveBackgroundNode: {\n      displayPrice: formatCreditsLabel(0.01)\n    },\n    RecraftReplaceBackgroundNode: {\n      displayPrice: formatCreditsLabel(0.04)\n    },\n    RecraftTextToImageNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const nWidget = node.widgets?.find(\n          (w) => w.name === 'n'\n        ) as IComboWidget\n        if (!nWidget) return formatCreditsLabel(0.04, { suffix: ' x n/Run' })\n\n        const n = Number(nWidget.value) || 1\n        const cost = Number((0.04 * n).toFixed(2))\n        return formatCreditsLabel(cost)\n      }\n    },\n    RecraftTextToVectorNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const nWidget = node.widgets?.find(\n          (w) => w.name === 'n'\n        ) as IComboWidget\n        if (!nWidget) return formatCreditsLabel(0.08, { suffix: ' x n/Run' })\n\n        const n = Number(nWidget.value) || 1\n        const cost = Number((0.08 * n).toFixed(2))\n        return formatCreditsLabel(cost)\n      }\n    },\n    RecraftVectorizeImageNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const nWidget = node.widgets?.find(\n          (w) => w.name === 'n'\n        ) as IComboWidget\n        if (!nWidget) return formatCreditsLabel(0.01, { suffix: ' x n/Run' })\n\n        const n = Number(nWidget.value) || 1\n        const cost = Number((0.01 * n).toFixed(2))\n        return formatCreditsLabel(cost)\n      }\n    },\n    StabilityStableImageSD_3_5Node: {\n      displayPrice: (node: LGraphNode): string => {\n        const modelWidget = node.widgets?.find(\n          (w) => w.name === 'model'\n        ) as IComboWidget\n\n        if (!modelWidget)\n          return formatCreditsRangeLabel(0.035, 0.065, {\n            note: '(varies with model)'\n          })\n\n        const model = String(modelWidget.value).toLowerCase()\n        if (model.includes('large')) {\n          return formatCreditsLabel(0.065)\n        } else if (model.includes('medium')) {\n          return formatCreditsLabel(0.035)\n        }\n\n        return formatCreditsLabel(0.035)\n      }\n    },\n    StabilityStableImageUltraNode: {\n      displayPrice: formatCreditsLabel(0.08)\n    },\n    StabilityUpscaleConservativeNode: {\n      displayPrice: formatCreditsLabel(0.25)\n    },\n    StabilityUpscaleCreativeNode: {\n      displayPrice: formatCreditsLabel(0.25)\n    },\n    StabilityUpscaleFastNode: {\n      displayPrice: formatCreditsLabel(0.01)\n    },\n    StabilityTextToAudio: {\n      displayPrice: formatCreditsLabel(0.2)\n    },\n    StabilityAudioToAudio: {\n      displayPrice: formatCreditsLabel(0.2)\n    },\n    StabilityAudioInpaint: {\n      displayPrice: formatCreditsLabel(0.2)\n    },\n    VeoVideoGenerationNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const durationWidget = node.widgets?.find(\n          (w) => w.name === 'duration_seconds'\n        ) as IComboWidget\n\n        if (!durationWidget)\n          return formatCreditsRangeLabel(2.5, 5.0, {\n            note: '(varies with duration)'\n          })\n\n        const price = 0.5 * Number(durationWidget.value)\n        return formatCreditsLabel(price)\n      }\n    },\n    Veo3VideoGenerationNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const modelWidget = node.widgets?.find(\n          (w) => w.name === 'model'\n        ) as IComboWidget\n        const generateAudioWidget = node.widgets?.find(\n          (w) => w.name === 'generate_audio'\n        ) as IComboWidget\n\n        if (!modelWidget || !generateAudioWidget) {\n          return formatCreditsRangeLabel(0.8, 3.2, {\n            note: '(varies with model & audio generation)'\n          })\n        }\n\n        const model = String(modelWidget.value)\n        const generateAudio =\n          String(generateAudioWidget.value).toLowerCase() === 'true'\n\n        if (\n          model.includes('veo-3.0-fast-generate-001') ||\n          model.includes('veo-3.1-fast-generate')\n        ) {\n          return generateAudio\n            ? formatCreditsLabel(1.2)\n            : formatCreditsLabel(0.8)\n        } else if (\n          model.includes('veo-3.0-generate-001') ||\n          model.includes('veo-3.1-generate')\n        ) {\n          return generateAudio\n            ? formatCreditsLabel(3.2)\n            : formatCreditsLabel(1.6)\n        }\n\n        // Default fallback\n        return formatCreditsRangeLabel(0.8, 3.2)\n      }\n    },\n    Veo3FirstLastFrameNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const modelWidget = node.widgets?.find(\n          (w) => w.name === 'model'\n        ) as IComboWidget\n        const generateAudioWidget = node.widgets?.find(\n          (w) => w.name === 'generate_audio'\n        ) as IComboWidget\n        const durationWidget = node.widgets?.find(\n          (w) => w.name === 'duration'\n        ) as IComboWidget\n\n        if (!modelWidget || !generateAudioWidget || !durationWidget) {\n          return formatCreditsRangeLabel(0.4, 3.2, {\n            note: '(varies with model & audio generation)'\n          })\n        }\n\n        const model = String(modelWidget.value)\n        const generateAudio =\n          String(generateAudioWidget.value).toLowerCase() === 'true'\n        const seconds = parseFloat(String(durationWidget.value))\n\n        let pricePerSecond: number | null = null\n        if (model.includes('veo-3.1-fast-generate')) {\n          pricePerSecond = generateAudio ? 0.15 : 0.1\n        } else if (model.includes('veo-3.1-generate')) {\n          pricePerSecond = generateAudio ? 0.4 : 0.2\n        }\n        if (pricePerSecond === null) {\n          return formatCreditsRangeLabel(0.4, 3.2)\n        }\n        const cost = pricePerSecond * seconds\n        return formatCreditsLabel(cost)\n      }\n    },\n    LumaImageNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const modelWidget = node.widgets?.find(\n          (w) => w.name === 'model'\n        ) as IComboWidget\n        const aspectRatioWidget = node.widgets?.find(\n          (w) => w.name === 'aspect_ratio'\n        ) as IComboWidget\n\n        if (!modelWidget || !aspectRatioWidget) {\n          return formatCreditsRangeLabel(0.0064, 0.026, {\n            note: '(varies with model & aspect ratio)'\n          })\n        }\n\n        const model = String(modelWidget.value)\n\n        if (model.includes('photon-flash-1')) {\n          return formatCreditsLabel(0.0027)\n        } else if (model.includes('photon-1')) {\n          return formatCreditsLabel(0.0104)\n        }\n\n        return formatCreditsLabel(0.0246)\n      }\n    },\n    LumaImageModifyNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const modelWidget = node.widgets?.find(\n          (w) => w.name === 'model'\n        ) as IComboWidget\n\n        if (!modelWidget) {\n          return formatCreditsRangeLabel(0.0027, 0.0104, {\n            note: '(varies with model)'\n          })\n        }\n\n        const model = String(modelWidget.value)\n\n        if (model.includes('photon-flash-1')) {\n          return formatCreditsLabel(0.0027)\n        } else if (model.includes('photon-1')) {\n          return formatCreditsLabel(0.0104)\n        }\n\n        return formatCreditsLabel(0.0246)\n      }\n    },\n    MoonvalleyTxt2VideoNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const lengthWidget = node.widgets?.find(\n          (w) => w.name === 'length'\n        ) as IComboWidget\n\n        // If no length widget exists, default to 5s pricing\n        if (!lengthWidget) return formatCreditsLabel(1.5)\n\n        const length = String(lengthWidget.value)\n        if (length === '5s') {\n          return formatCreditsLabel(1.5)\n        } else if (length === '10s') {\n          return formatCreditsLabel(3.0)\n        }\n\n        return formatCreditsLabel(1.5)\n      }\n    },\n    MoonvalleyImg2VideoNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const lengthWidget = node.widgets?.find(\n          (w) => w.name === 'length'\n        ) as IComboWidget\n\n        // If no length widget exists, default to 5s pricing\n        if (!lengthWidget) return formatCreditsLabel(1.5)\n\n        const length = String(lengthWidget.value)\n        if (length === '5s') {\n          return formatCreditsLabel(1.5)\n        } else if (length === '10s') {\n          return formatCreditsLabel(3.0)\n        }\n\n        return formatCreditsLabel(1.5)\n      }\n    },\n    MoonvalleyVideo2VideoNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const lengthWidget = node.widgets?.find(\n          (w) => w.name === 'length'\n        ) as IComboWidget\n\n        // If no length widget exists, default to 5s pricing\n        if (!lengthWidget) return formatCreditsLabel(2.25)\n\n        const length = String(lengthWidget.value)\n        if (length === '5s') {\n          return formatCreditsLabel(2.25)\n        } else if (length === '10s') {\n          return formatCreditsLabel(4.0)\n        }\n\n        return formatCreditsLabel(2.25)\n      }\n    },\n    // Runway nodes - using actual node names from ComfyUI\n    RunwayTextToImageNode: {\n      displayPrice: formatCreditsLabel(0.11)\n    },\n    RunwayImageToVideoNodeGen3a: {\n      displayPrice: calculateRunwayDurationPrice\n    },\n    RunwayImageToVideoNodeGen4: {\n      displayPrice: calculateRunwayDurationPrice\n    },\n    RunwayFirstLastFrameNode: {\n      displayPrice: calculateRunwayDurationPrice\n    },\n    // Rodin nodes - all have the same pricing structure\n    Rodin3D_Regular: {\n      displayPrice: formatCreditsLabel(0.4)\n    },\n    Rodin3D_Detail: {\n      displayPrice: formatCreditsLabel(0.4)\n    },\n    Rodin3D_Smooth: {\n      displayPrice: formatCreditsLabel(0.4)\n    },\n    Rodin3D_Sketch: {\n      displayPrice: formatCreditsLabel(0.4)\n    },\n    // Tripo nodes - using actual node names from ComfyUI\n    TripoTextToModelNode: {\n      displayPrice: (node: LGraphNode): string =>\n        calculateTripo3DGenerationPrice(node, 'text')\n    },\n    TripoImageToModelNode: {\n      displayPrice: (node: LGraphNode): string =>\n        calculateTripo3DGenerationPrice(node, 'image')\n    },\n    TripoMultiviewToModelNode: {\n      displayPrice: (node: LGraphNode): string =>\n        calculateTripo3DGenerationPrice(node, 'multiview')\n    },\n    TripoTextureNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const textureQualityWidget = node.widgets?.find(\n          (w) => w.name === 'texture_quality'\n        ) as IComboWidget\n\n        if (!textureQualityWidget)\n          return formatCreditsRangeLabel(0.1, 0.2, {\n            note: '(varies with quality)'\n          })\n\n        const textureQuality = String(textureQualityWidget.value)\n        return textureQuality.includes('detailed')\n          ? formatCreditsLabel(0.2)\n          : formatCreditsLabel(0.1)\n      }\n    },\n    TripoRigNode: {\n      displayPrice: '$0.25/Run'\n    },\n    TripoConversionNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const getWidgetValue = (name: string) =>\n          node.widgets?.find((w) => w.name === name)?.value\n\n        const getNumber = (name: string, defaultValue: number): number => {\n          const raw = getWidgetValue(name)\n          if (raw === undefined || raw === null || raw === '')\n            return defaultValue\n          if (typeof raw === 'number')\n            return Number.isFinite(raw) ? raw : defaultValue\n          const n = Number(raw)\n          return Number.isFinite(n) ? n : defaultValue\n        }\n\n        const getBool = (name: string, defaultValue: boolean): boolean => {\n          const v = getWidgetValue(name)\n          if (v === undefined || v === null) return defaultValue\n\n          if (typeof v === 'number') return v !== 0\n          const lower = String(v).toLowerCase()\n          if (lower === 'true') return true\n          if (lower === 'false') return false\n          return defaultValue\n        }\n\n        let hasAdvancedParam = false\n\n        // ---- booleans that trigger advanced when true ----\n        if (getBool('quad', false)) hasAdvancedParam = true\n        if (getBool('force_symmetry', false)) hasAdvancedParam = true\n        if (getBool('flatten_bottom', false)) hasAdvancedParam = true\n        if (getBool('pivot_to_center_bottom', false)) hasAdvancedParam = true\n        if (getBool('with_animation', false)) hasAdvancedParam = true\n        if (getBool('pack_uv', false)) hasAdvancedParam = true\n        if (getBool('bake', false)) hasAdvancedParam = true\n        if (getBool('export_vertex_colors', false)) hasAdvancedParam = true\n        if (getBool('animate_in_place', false)) hasAdvancedParam = true\n\n        // ---- numeric params with special default sentinels ----\n        const faceLimit = getNumber('face_limit', -1)\n        if (faceLimit !== -1) hasAdvancedParam = true\n\n        const textureSize = getNumber('texture_size', 4096)\n        if (textureSize !== 4096) hasAdvancedParam = true\n\n        const flattenBottomThreshold = getNumber(\n          'flatten_bottom_threshold',\n          0.0\n        )\n        if (flattenBottomThreshold !== 0.0) hasAdvancedParam = true\n\n        const scaleFactor = getNumber('scale_factor', 1.0)\n        if (scaleFactor !== 1.0) hasAdvancedParam = true\n\n        // ---- string / combo params with non-default values ----\n        const textureFormatRaw = String(\n          getWidgetValue('texture_format') ?? 'JPEG'\n        ).toUpperCase()\n        if (textureFormatRaw !== 'JPEG') hasAdvancedParam = true\n\n        const partNamesRaw = String(getWidgetValue('part_names') ?? '')\n        if (partNamesRaw.trim().length > 0) hasAdvancedParam = true\n\n        const fbxPresetRaw = String(\n          getWidgetValue('fbx_preset') ?? 'blender'\n        ).toLowerCase()\n        if (fbxPresetRaw !== 'blender') hasAdvancedParam = true\n\n        const exportOrientationRaw = String(\n          getWidgetValue('export_orientation') ?? 'default'\n        ).toLowerCase()\n        if (exportOrientationRaw !== 'default') hasAdvancedParam = true\n\n        const credits = hasAdvancedParam ? 10 : 5\n        return formatCreditsLabel(credits * 0.01)\n      }\n    },\n    TripoRetargetNode: {\n      displayPrice: formatCreditsLabel(0.1)\n    },\n    TripoRefineNode: {\n      displayPrice: formatCreditsLabel(0.3)\n    },\n    // Google/Gemini nodes\n    GeminiNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const modelWidget = node.widgets?.find(\n          (w) => w.name === 'model'\n        ) as IComboWidget\n\n        if (!modelWidget) return 'Token-based'\n\n        const model = String(modelWidget.value)\n\n        if (model.includes('gemini-2.5-flash-preview-04-17')) {\n          return formatCreditsListLabel([0.0003, 0.0025], {\n            suffix: ' per 1K tokens',\n            approximate: true,\n            separator: '-'\n          })\n        } else if (model.includes('gemini-2.5-flash')) {\n          return formatCreditsListLabel([0.0003, 0.0025], {\n            suffix: ' per 1K tokens',\n            approximate: true,\n            separator: '-'\n          })\n        } else if (model.includes('gemini-2.5-pro-preview-05-06')) {\n          return formatCreditsListLabel([0.00125, 0.01], {\n            suffix: ' per 1K tokens',\n            approximate: true,\n            separator: '-'\n          })\n        } else if (model.includes('gemini-2.5-pro')) {\n          return formatCreditsListLabel([0.00125, 0.01], {\n            suffix: ' per 1K tokens',\n            approximate: true,\n            separator: '-'\n          })\n        } else if (model.includes('gemini-3-pro-preview')) {\n          return formatCreditsListLabel([0.002, 0.012], {\n            suffix: ' per 1K tokens',\n            approximate: true,\n            separator: '-'\n          })\n        }\n        // For other Gemini models, show token-based pricing info\n        return 'Token-based'\n      }\n    },\n    GeminiImageNode: {\n      displayPrice: formatCreditsLabel(0.039, {\n        suffix: '/Image (1K)',\n        approximate: true\n      })\n    },\n    GeminiImage2Node: {\n      displayPrice: (node: LGraphNode): string => {\n        const resolutionWidget = node.widgets?.find(\n          (w) => w.name === 'resolution'\n        ) as IComboWidget\n\n        if (!resolutionWidget) return 'Token-based'\n\n        const resolution = String(resolutionWidget.value)\n        if (resolution.includes('1K')) {\n          return formatCreditsLabel(0.134, {\n            suffix: '/Image',\n            approximate: true\n          })\n        } else if (resolution.includes('2K')) {\n          return formatCreditsLabel(0.134, {\n            suffix: '/Image',\n            approximate: true\n          })\n        } else if (resolution.includes('4K')) {\n          return formatCreditsLabel(0.24, {\n            suffix: '/Image',\n            approximate: true\n          })\n        }\n        return 'Token-based'\n      }\n    },\n    LLMNode: {\n      displayPrice: '$0.00005/$0.0004 per 1K tokens'\n    },\n    // OpenAI nodes\n    OpenAIChatNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const modelWidget = node.widgets?.find(\n          (w) => w.name === 'model'\n        ) as IComboWidget\n\n        if (!modelWidget) return 'Token-based'\n\n        const model = String(modelWidget.value)\n\n        // Specific pricing for exposed models based on official pricing data (converted to per 1K tokens)\n        if (model.includes('o4-mini')) {\n          return formatCreditsListLabel([0.0011, 0.0044], {\n            suffix: ' per 1K tokens',\n            approximate: true,\n            separator: '-'\n          })\n        } else if (model.includes('o1-pro')) {\n          return formatCreditsListLabel([0.15, 0.6], {\n            suffix: ' per 1K tokens',\n            approximate: true,\n            separator: '-'\n          })\n        } else if (model.includes('o1')) {\n          return formatCreditsListLabel([0.015, 0.06], {\n            suffix: ' per 1K tokens',\n            approximate: true,\n            separator: '-'\n          })\n        } else if (model.includes('o3-mini')) {\n          return formatCreditsListLabel([0.0011, 0.0044], {\n            suffix: ' per 1K tokens',\n            approximate: true,\n            separator: '-'\n          })\n        } else if (model.includes('o3')) {\n          return formatCreditsListLabel([0.01, 0.04], {\n            suffix: ' per 1K tokens',\n            approximate: true,\n            separator: '-'\n          })\n        } else if (model.includes('gpt-4o')) {\n          return formatCreditsListLabel([0.0025, 0.01], {\n            suffix: ' per 1K tokens',\n            approximate: true,\n            separator: '-'\n          })\n        } else if (model.includes('gpt-4.1-nano')) {\n          return formatCreditsListLabel([0.0001, 0.0004], {\n            suffix: ' per 1K tokens',\n            approximate: true,\n            separator: '-'\n          })\n        } else if (model.includes('gpt-4.1-mini')) {\n          return formatCreditsListLabel([0.0004, 0.0016], {\n            suffix: ' per 1K tokens',\n            approximate: true,\n            separator: '-'\n          })\n        } else if (model.includes('gpt-4.1')) {\n          return formatCreditsListLabel([0.002, 0.008], {\n            suffix: ' per 1K tokens',\n            approximate: true,\n            separator: '-'\n          })\n        } else if (model.includes('gpt-5-nano')) {\n          return formatCreditsListLabel([0.00005, 0.0004], {\n            suffix: ' per 1K tokens',\n            approximate: true,\n            separator: '-'\n          })\n        } else if (model.includes('gpt-5-mini')) {\n          return formatCreditsListLabel([0.00025, 0.002], {\n            suffix: ' per 1K tokens',\n            approximate: true,\n            separator: '-'\n          })\n        } else if (model.includes('gpt-5')) {\n          return formatCreditsListLabel([0.00125, 0.01], {\n            suffix: ' per 1K tokens',\n            approximate: true,\n            separator: '-'\n          })\n        }\n        return 'Token-based'\n      }\n    },\n    ViduTextToVideoNode: {\n      displayPrice: formatCreditsLabel(0.4)\n    },\n    ViduImageToVideoNode: {\n      displayPrice: formatCreditsLabel(0.4)\n    },\n    ViduReferenceVideoNode: {\n      displayPrice: formatCreditsLabel(0.4)\n    },\n    ViduStartEndToVideoNode: {\n      displayPrice: formatCreditsLabel(0.4)\n    },\n    ByteDanceImageNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const modelWidget = node.widgets?.find(\n          (w) => w.name === 'model'\n        ) as IComboWidget\n\n        if (!modelWidget) return 'Token-based'\n\n        const model = String(modelWidget.value)\n\n        if (model.includes('seedream-3-0-t2i')) {\n          return formatCreditsLabel(0.03)\n        }\n        return 'Token-based'\n      }\n    },\n    ByteDanceImageEditNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const modelWidget = node.widgets?.find(\n          (w) => w.name === 'model'\n        ) as IComboWidget\n\n        if (!modelWidget) return 'Token-based'\n\n        const model = String(modelWidget.value)\n\n        if (model.includes('seededit-3-0-i2i')) {\n          return formatCreditsLabel(0.03)\n        }\n        return 'Token-based'\n      }\n    },\n    ByteDanceSeedreamNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const modelWidget = node.widgets?.find(\n          (w) => w.name === 'model'\n        ) as IComboWidget\n\n        const model = String(modelWidget?.value ?? '').toLowerCase()\n        let pricePerImage = 0.03 // default for seedream-4-0-250828 and fallback\n        if (model.includes('seedream-4-5-251128')) {\n          pricePerImage = 0.04\n        } else if (model.includes('seedream-4-0-250828')) {\n          pricePerImage = 0.03\n        }\n        return formatCreditsLabel(pricePerImage, {\n          suffix: ' x images/Run',\n          approximate: true\n        })\n      }\n    },\n    ByteDanceTextToVideoNode: {\n      displayPrice: byteDanceVideoPricingCalculator\n    },\n    ByteDanceImageToVideoNode: {\n      displayPrice: byteDanceVideoPricingCalculator\n    },\n    ByteDanceFirstLastFrameNode: {\n      displayPrice: byteDanceVideoPricingCalculator\n    },\n    ByteDanceImageReferenceNode: {\n      displayPrice: byteDanceVideoPricingCalculator\n    },\n    WanTextToVideoApi: {\n      displayPrice: (node: LGraphNode): string => {\n        const durationWidget = node.widgets?.find(\n          (w) => w.name === 'duration'\n        ) as IComboWidget\n        const resolutionWidget = node.widgets?.find(\n          (w) => w.name === 'size'\n        ) as IComboWidget\n\n        if (!durationWidget || !resolutionWidget)\n          return formatCreditsRangeLabel(0.05, 0.15, { suffix: '/second' })\n\n        const seconds = parseFloat(String(durationWidget.value))\n        const resolutionStr = String(resolutionWidget.value).toLowerCase()\n\n        const resKey = resolutionStr.includes('1080')\n          ? '1080p'\n          : resolutionStr.includes('720')\n            ? '720p'\n            : resolutionStr.includes('480')\n              ? '480p'\n              : (resolutionStr.match(/^\\s*(\\d{3,4}p)/)?.[1] ?? '')\n\n        const pricePerSecond: Record<string, number> = {\n          '480p': 0.05,\n          '720p': 0.1,\n          '1080p': 0.15\n        }\n\n        const pps = pricePerSecond[resKey]\n        if (isNaN(seconds) || !pps)\n          return formatCreditsRangeLabel(0.05, 0.15, { suffix: '/second' })\n\n        const cost = Number((pps * seconds).toFixed(2))\n        return formatCreditsLabel(cost)\n      }\n    },\n    WanImageToVideoApi: {\n      displayPrice: (node: LGraphNode): string => {\n        const durationWidget = node.widgets?.find(\n          (w) => w.name === 'duration'\n        ) as IComboWidget\n        const resolutionWidget = node.widgets?.find(\n          (w) => w.name === 'resolution'\n        ) as IComboWidget\n\n        if (!durationWidget || !resolutionWidget)\n          return formatCreditsRangeLabel(0.05, 0.15, { suffix: '/second' })\n\n        const seconds = parseFloat(String(durationWidget.value))\n        const resolution = String(resolutionWidget.value).trim().toLowerCase()\n\n        const pricePerSecond: Record<string, number> = {\n          '480p': 0.05,\n          '720p': 0.1,\n          '1080p': 0.15\n        }\n\n        const pps = pricePerSecond[resolution]\n        if (isNaN(seconds) || !pps)\n          return formatCreditsRangeLabel(0.05, 0.15, { suffix: '/second' })\n\n        const cost = Number((pps * seconds).toFixed(2))\n        return formatCreditsLabel(cost)\n      }\n    },\n    WanTextToImageApi: {\n      displayPrice: formatCreditsLabel(0.03)\n    },\n    WanImageToImageApi: {\n      displayPrice: formatCreditsLabel(0.03)\n    },\n    LtxvApiTextToVideo: {\n      displayPrice: ltxvPricingCalculator\n    },\n    LtxvApiImageToVideo: {\n      displayPrice: ltxvPricingCalculator\n    },\n    WanReferenceVideoApi: {\n      displayPrice: (node: LGraphNode): string => {\n        const durationWidget = node.widgets?.find(\n          (w) => w.name === 'duration'\n        ) as IComboWidget\n        const sizeWidget = node.widgets?.find(\n          (w) => w.name === 'size'\n        ) as IComboWidget\n\n        if (!durationWidget || !sizeWidget) {\n          return formatCreditsRangeLabel(0.7, 1.5, {\n            note: '(varies with size & duration)'\n          })\n        }\n\n        const seconds = parseFloat(String(durationWidget.value))\n        const sizeStr = String(sizeWidget.value).toLowerCase()\n\n        const rate = sizeStr.includes('1080p') ? 0.15 : 0.1\n        const inputMin = 2 * rate\n        const inputMax = 5 * rate\n        const outputPrice = seconds * rate\n\n        const minTotal = inputMin + outputPrice\n        const maxTotal = inputMax + outputPrice\n\n        return formatCreditsRangeLabel(minTotal, maxTotal)\n      }\n    }\n  }\n\n/**\n * Composable to get node pricing information for API nodes\n */\nexport const useNodePricing = () => {\n  /**\n   * Get the price display for a node\n   */\n  const getNodeDisplayPrice = (node: LGraphNode): string => {\n    if (!node.constructor?.nodeData?.api_node) return ''\n\n    const nodeName = node.constructor.nodeData.name\n    const priceConfig = apiNodeCosts[nodeName]\n\n    if (!priceConfig) return ''\n\n    // If it's a function, call it with the node to get dynamic pricing\n    if (typeof priceConfig.displayPrice === 'function') {\n      return safePricingExecution(priceConfig.displayPrice, node, '')\n    }\n\n    // Otherwise return the static price\n    return priceConfig.displayPrice\n  }\n\n  const getNodePricingConfig = (node: LGraphNode) =>\n    apiNodeCosts[node.constructor.nodeData?.name ?? '']\n\n  const getRelevantWidgetNames = (nodeType: string): string[] => {\n    const widgetMap: Record<string, string[]> = {\n      KlingTextToVideoNode: ['mode', 'model_name', 'duration'],\n      KlingImage2VideoNode: ['mode', 'model_name', 'duration'],\n      KlingImageGenerationNode: ['modality', 'model_name', 'n'],\n      KlingDualCharacterVideoEffectNode: ['mode', 'model_name', 'duration'],\n      KlingSingleImageVideoEffectNode: ['effect_scene'],\n      KlingStartEndFrameNode: ['mode', 'model_name', 'duration'],\n      KlingTextToVideoWithAudio: ['duration', 'generate_audio'],\n      KlingImageToVideoWithAudio: ['duration', 'generate_audio'],\n      KlingOmniProTextToVideoNode: ['duration'],\n      KlingOmniProFirstLastFrameNode: ['duration'],\n      KlingOmniProImageToVideoNode: ['duration'],\n      KlingOmniProVideoToVideoNode: ['duration'],\n      KlingMotionControl: ['mode'],\n      MinimaxHailuoVideoNode: ['resolution', 'duration'],\n      OpenAIDalle3: ['size', 'quality'],\n      OpenAIDalle2: ['size', 'n'],\n      OpenAIVideoSora2: ['model', 'size', 'duration'],\n      OpenAIGPTImage1: ['quality', 'n'],\n      IdeogramV1: ['num_images', 'turbo'],\n      IdeogramV2: ['num_images', 'turbo'],\n      IdeogramV3: ['rendering_speed', 'num_images', 'character_image'],\n      FluxProKontextProNode: [],\n      FluxProKontextMaxNode: [],\n      Flux2ProImageNode: ['width', 'height', 'images'],\n      Flux2MaxImageNode: ['width', 'height', 'images'],\n      VeoVideoGenerationNode: ['duration_seconds'],\n      Veo3VideoGenerationNode: ['model', 'generate_audio'],\n      Veo3FirstLastFrameNode: ['model', 'generate_audio', 'duration'],\n      LumaVideoNode: ['model', 'resolution', 'duration'],\n      LumaImageToVideoNode: ['model', 'resolution', 'duration'],\n      LumaImageNode: ['model', 'aspect_ratio'],\n      LumaImageModifyNode: ['model', 'aspect_ratio'],\n      PixverseTextToVideoNode: ['duration_seconds', 'quality', 'motion_mode'],\n      PixverseTransitionVideoNode: [\n        'duration_seconds',\n        'motion_mode',\n        'quality'\n      ],\n      PixverseImageToVideoNode: ['duration_seconds', 'quality', 'motion_mode'],\n      StabilityStableImageSD_3_5Node: ['model'],\n      RecraftTextToImageNode: ['n'],\n      RecraftImageToImageNode: ['n'],\n      RecraftImageInpaintingNode: ['n'],\n      RecraftTextToVectorNode: ['n'],\n      RecraftVectorizeImageNode: ['n'],\n      RecraftGenerateColorFromImageNode: ['n'],\n      RecraftGenerateImageNode: ['n'],\n      RecraftGenerateVectorImageNode: ['n'],\n      MoonvalleyTxt2VideoNode: ['length'],\n      MoonvalleyImg2VideoNode: ['length'],\n      MoonvalleyVideo2VideoNode: ['length'],\n      // Runway nodes\n      RunwayImageToVideoNodeGen3a: ['duration'],\n      RunwayImageToVideoNodeGen4: ['duration'],\n      RunwayFirstLastFrameNode: ['duration'],\n      // Tripo nodes\n      TripoTextToModelNode: [\n        'model_version',\n        'quad',\n        'style',\n        'texture',\n        'pbr',\n        'texture_quality',\n        'geometry_quality'\n      ],\n      TripoImageToModelNode: [\n        'model_version',\n        'quad',\n        'style',\n        'texture',\n        'pbr',\n        'texture_quality',\n        'geometry_quality'\n      ],\n      TripoMultiviewToModelNode: [\n        'model_version',\n        'quad',\n        'texture',\n        'pbr',\n        'texture_quality',\n        'geometry_quality'\n      ],\n      TripoConversionNode: [\n        'quad',\n        'face_limit',\n        'texture_size',\n        'texture_format',\n        'force_symmetry',\n        'flatten_bottom',\n        'flatten_bottom_threshold',\n        'pivot_to_center_bottom',\n        'scale_factor',\n        'with_animation',\n        'pack_uv',\n        'bake',\n        'part_names',\n        'fbx_preset',\n        'export_vertex_colors',\n        'export_orientation',\n        'animate_in_place'\n      ],\n      TripoTextureNode: ['texture_quality'],\n      // Google/Gemini nodes\n      GeminiNode: ['model'],\n      GeminiImage2Node: ['resolution'],\n      // OpenAI nodes\n      OpenAIChatNode: ['model'],\n      // ByteDance\n      ByteDanceImageNode: ['model'],\n      ByteDanceImageEditNode: ['model'],\n      ByteDanceSeedreamNode: [\n        'model',\n        'sequential_image_generation',\n        'max_images'\n      ],\n      ByteDanceTextToVideoNode: ['model', 'duration', 'resolution'],\n      ByteDanceImageToVideoNode: ['model', 'duration', 'resolution'],\n      ByteDanceFirstLastFrameNode: ['model', 'duration', 'resolution'],\n      ByteDanceImageReferenceNode: ['model', 'duration', 'resolution'],\n      WanTextToVideoApi: ['duration', 'size'],\n      WanImageToVideoApi: ['duration', 'resolution'],\n      WanReferenceVideoApi: ['duration', 'size'],\n      LtxvApiTextToVideo: ['model', 'duration', 'resolution'],\n      LtxvApiImageToVideo: ['model', 'duration', 'resolution']\n    }\n    return widgetMap[nodeType] || []\n  }\n\n  return {\n    getNodeDisplayPrice,\n    getNodePricingConfig,\n    getRelevantWidgetNames\n  }\n}\n","import type { LGraph, LGraphNode } from '@/lib/litegraph/src/litegraph'\nimport { LGraphBadge } from '@/lib/litegraph/src/litegraph'\n\nimport { useColorPaletteStore } from '@/stores/workspace/colorPaletteStore'\nimport { adjustColor } from '@/utils/colorUtil'\n\nconst componentIconSvg = new Image()\ncomponentIconSvg.src =\n  \"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='none' stroke='oklch(83.01%25 0.163 83.16)' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M15.536 11.293a1 1 0 0 0 0 1.414l2.376 2.377a1 1 0 0 0 1.414 0l2.377-2.377a1 1 0 0 0 0-1.414l-2.377-2.377a1 1 0 0 0-1.414 0zm-13.239 0a1 1 0 0 0 0 1.414l2.377 2.377a1 1 0 0 0 1.414 0l2.377-2.377a1 1 0 0 0 0-1.414L6.088 8.916a1 1 0 0 0-1.414 0zm6.619 6.619a1 1 0 0 0 0 1.415l2.377 2.376a1 1 0 0 0 1.414 0l2.377-2.376a1 1 0 0 0 0-1.415l-2.377-2.376a1 1 0 0 0-1.414 0zm0-13.238a1 1 0 0 0 0 1.414l2.377 2.376a1 1 0 0 0 1.414 0l2.377-2.376a1 1 0 0 0 0-1.414l-2.377-2.377a1 1 0 0 0-1.414 0z'/%3E%3C/svg%3E\"\n\nexport const usePriceBadge = () => {\n  function updateSubgraphCredits(node: LGraphNode) {\n    if (!node.isSubgraphNode()) return\n    node.badges = node.badges.filter((b) => !isCreditsBadge(b))\n    const newBadges = collectCreditsBadges(node.subgraph)\n    if (newBadges.length > 1) {\n      node.badges.push(getCreditsBadge('Partner Nodes x ' + newBadges.length))\n    } else {\n      node.badges.push(...newBadges)\n    }\n  }\n  function collectCreditsBadges(\n    graph: LGraph,\n    visited: Set<string> = new Set()\n  ): (LGraphBadge | (() => LGraphBadge))[] {\n    if (visited.has(graph.id)) return []\n    visited.add(graph.id)\n    const badges = []\n    for (const node of graph.nodes) {\n      badges.push(\n        ...(node.isSubgraphNode()\n          ? collectCreditsBadges(node.subgraph, visited)\n          : node.badges.filter((b) => isCreditsBadge(b)))\n      )\n    }\n    return badges\n  }\n\n  function isCreditsBadge(badge: LGraphBadge | (() => LGraphBadge)): boolean {\n    const badgeInstance = typeof badge === 'function' ? badge() : badge\n    return badgeInstance.icon?.image === componentIconSvg\n  }\n\n  const colorPaletteStore = useColorPaletteStore()\n  function getCreditsBadge(price: string): LGraphBadge {\n    const isLightTheme = colorPaletteStore.completedActivePalette.light_theme\n\n    return new LGraphBadge({\n      text: price,\n      iconOptions: {\n        image: componentIconSvg,\n        size: 8\n      },\n      fgColor:\n        colorPaletteStore.completedActivePalette.colors.litegraph_base\n          .BADGE_FG_COLOR,\n      bgColor: isLightTheme\n        ? adjustColor('#8D6932', { lightness: 0.5 })\n        : '#8D6932'\n    })\n  }\n  return {\n    getCreditsBadge,\n    updateSubgraphCredits\n  }\n}\n","import { computedWithControl } from '@vueuse/core'\nimport { ref } from 'vue'\nimport type { ComputedRef } from 'vue'\n\nimport { useChainCallback } from '@/composables/functional/useChainCallback'\nimport type { LGraphNode } from '@/lib/litegraph/src/litegraph'\n\ninterface UseComputedWithWidgetWatchOptions {\n  /**\n   * Names of widgets to observe for changes.\n   * If not provided, all widgets will be observed.\n   */\n  widgetNames?: string[]\n\n  /**\n   * Whether to trigger a canvas redraw when widget values change.\n   * @default false\n   */\n  triggerCanvasRedraw?: boolean\n}\n\n/**\n * A composable that creates a computed that has a node's widget values as a dependencies.\n * Essentially `computedWithControl` (https://vueuse.org/shared/computedWithControl/) where\n * the explicitly defined extra dependencies are LGraphNode widgets.\n *\n * @param node - The LGraphNode whose widget values are to be watched\n * @param options - Configuration options for the watcher\n * @returns A function to create computed that responds to widget changes\n *\n * @example\n * ```ts\n * const computedWithWidgetWatch = useComputedWithWidgetWatch(node, {\n *   widgetNames: ['width', 'height'],\n *   triggerCanvasRedraw: true\n * })\n *\n * const dynamicPrice = computedWithWidgetWatch(() => {\n *   return calculatePrice(node)\n * })\n * ```\n */\nexport const useComputedWithWidgetWatch = (\n  node: LGraphNode,\n  options: UseComputedWithWidgetWatchOptions = {}\n) => {\n  const { widgetNames, triggerCanvasRedraw = false } = options\n\n  // Create a reactive trigger based on widget values\n  const widgetValues = ref<Record<string, any>>({})\n\n  // Initialize widget observers\n  if (node.widgets) {\n    const widgetsToObserve = widgetNames\n      ? node.widgets.filter((widget) => widgetNames.includes(widget.name))\n      : node.widgets\n\n    // Initialize current values\n    const currentValues: Record<string, any> = {}\n    widgetsToObserve.forEach((widget) => {\n      currentValues[widget.name] = widget.value\n    })\n    widgetValues.value = currentValues\n\n    widgetsToObserve.forEach((widget) => {\n      widget.callback = useChainCallback(widget.callback, () => {\n        // Update the reactive widget values\n        widgetValues.value = {\n          ...widgetValues.value,\n          [widget.name]: widget.value\n        }\n\n        // Optionally trigger a canvas redraw\n        if (triggerCanvasRedraw) {\n          node.graph?.setDirtyCanvas(true, true)\n        }\n      })\n    })\n    if (widgetNames && widgetNames.length > widgetsToObserve.length) {\n      //Inputs have been included\n      const indexesToObserve = widgetNames\n        .map((name) =>\n          widgetsToObserve.some((w) => w.name == name)\n            ? -1\n            : node.inputs.findIndex((i) => i.name == name)\n        )\n        .filter((i) => i >= 0)\n      node.onConnectionsChange = useChainCallback(\n        node.onConnectionsChange,\n        (_type: unknown, index: number, isConnected: boolean) => {\n          if (!indexesToObserve.includes(index)) return\n          widgetValues.value = {\n            ...widgetValues.value,\n            [indexesToObserve[index]]: isConnected\n          }\n          if (triggerCanvasRedraw) {\n            node.graph?.setDirtyCanvas(true, true)\n          }\n        }\n      )\n    }\n  }\n\n  // Returns a function that creates a computed that responds to widget changes.\n  // The computed will be re-evaluated whenever any observed widget changes.\n  return <T>(computeFn: () => T): ComputedRef<T> => {\n    return computedWithControl(widgetValues, computeFn)\n  }\n}\n","import _ from 'es-toolkit/compat'\nimport { computed, onMounted, watch } from 'vue'\n\nimport { useNodePricing } from '@/composables/node/useNodePricing'\nimport { usePriceBadge } from '@/composables/node/usePriceBadge'\nimport { useComputedWithWidgetWatch } from '@/composables/node/useWatchWidget'\nimport { BadgePosition, LGraphBadge } from '@/lib/litegraph/src/litegraph'\nimport type { LGraphNode } from '@/lib/litegraph/src/litegraph'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { app } from '@/scripts/app'\nimport { useExtensionStore } from '@/stores/extensionStore'\nimport type { ComfyNodeDefImpl } from '@/stores/nodeDefStore'\nimport { useNodeDefStore } from '@/stores/nodeDefStore'\nimport { useColorPaletteStore } from '@/stores/workspace/colorPaletteStore'\nimport { NodeBadgeMode } from '@/types/nodeSource'\n\n/**\n * Add LGraphBadge to LGraphNode based on settings.\n *\n * Following badges are added:\n * - Node ID badge\n * - Node source badge\n * - Node life cycle badge\n * - API node credits badge\n */\nexport const useNodeBadge = () => {\n  const settingStore = useSettingStore()\n  const extensionStore = useExtensionStore()\n  const colorPaletteStore = useColorPaletteStore()\n  const priceBadge = usePriceBadge()\n\n  const nodeSourceBadgeMode = computed(\n    () =>\n      settingStore.get('Comfy.NodeBadge.NodeSourceBadgeMode') as NodeBadgeMode\n  )\n  const nodeIdBadgeMode = computed(\n    () => settingStore.get('Comfy.NodeBadge.NodeIdBadgeMode') as NodeBadgeMode\n  )\n  const nodeLifeCycleBadgeMode = computed(\n    () =>\n      settingStore.get(\n        'Comfy.NodeBadge.NodeLifeCycleBadgeMode'\n      ) as NodeBadgeMode\n  )\n\n  const showApiPricingBadge = computed(() =>\n    settingStore.get('Comfy.NodeBadge.ShowApiPricing')\n  )\n\n  watch(\n    [\n      nodeSourceBadgeMode,\n      nodeIdBadgeMode,\n      nodeLifeCycleBadgeMode,\n      showApiPricingBadge\n    ],\n    () => {\n      app.canvas?.setDirty(true, true)\n    }\n  )\n\n  const nodeDefStore = useNodeDefStore()\n  function badgeTextVisible(\n    nodeDef: ComfyNodeDefImpl | null,\n    badgeMode: NodeBadgeMode\n  ): boolean {\n    return !(\n      badgeMode === NodeBadgeMode.None ||\n      (nodeDef?.isCoreNode && badgeMode === NodeBadgeMode.HideBuiltIn)\n    )\n  }\n\n  onMounted(() => {\n    const nodePricing = useNodePricing()\n\n    extensionStore.registerExtension({\n      name: 'Comfy.NodeBadge',\n      nodeCreated(node: LGraphNode) {\n        node.badgePosition = BadgePosition.TopRight\n\n        const badge = computed(() => {\n          const nodeDef = nodeDefStore.fromLGraphNode(node)\n          return new LGraphBadge({\n            text: _.truncate(\n              [\n                badgeTextVisible(nodeDef, nodeIdBadgeMode.value)\n                  ? `#${node.id}`\n                  : '',\n                badgeTextVisible(nodeDef, nodeLifeCycleBadgeMode.value)\n                  ? (nodeDef?.nodeLifeCycleBadgeText ?? '')\n                  : '',\n                badgeTextVisible(nodeDef, nodeSourceBadgeMode.value)\n                  ? (nodeDef?.nodeSource?.badgeText ?? '')\n                  : ''\n              ]\n                .filter((s) => s.length > 0)\n                .join(' '),\n              {\n                length: 31\n              }\n            ),\n            fgColor:\n              colorPaletteStore.completedActivePalette.colors.litegraph_base\n                .BADGE_FG_COLOR,\n            bgColor:\n              colorPaletteStore.completedActivePalette.colors.litegraph_base\n                .BADGE_BG_COLOR\n          })\n        })\n\n        node.badges.push(() => badge.value)\n\n        if (node.constructor.nodeData?.api_node && showApiPricingBadge.value) {\n          // Get the pricing function to determine if this node has dynamic pricing\n          const pricingConfig = nodePricing.getNodePricingConfig(node)\n          const hasDynamicPricing =\n            typeof pricingConfig?.displayPrice === 'function'\n\n          let creditsBadge\n          const createBadge = () => {\n            const price = nodePricing.getNodeDisplayPrice(node)\n            return priceBadge.getCreditsBadge(price)\n          }\n\n          if (hasDynamicPricing) {\n            // For dynamic pricing nodes, use computed that watches widget changes\n            const relevantWidgetNames = nodePricing.getRelevantWidgetNames(\n              node.constructor.nodeData?.name\n            )\n\n            const computedWithWidgetWatch = useComputedWithWidgetWatch(node, {\n              widgetNames: relevantWidgetNames,\n              triggerCanvasRedraw: true\n            })\n\n            creditsBadge = computedWithWidgetWatch(createBadge)\n          } else {\n            // For static pricing nodes, use regular computed\n            creditsBadge = computed(createBadge)\n          }\n\n          node.badges.push(() => creditsBadge.value)\n        }\n      },\n      init() {\n        app.canvas.canvas.addEventListener<'litegraph:set-graph'>(\n          'litegraph:set-graph',\n          () => {\n            for (const node of app.canvas.graph?.nodes ?? [])\n              priceBadge.updateSubgraphCredits(node)\n          }\n        )\n        app.canvas.canvas.addEventListener<'subgraph-converted'>(\n          'subgraph-converted',\n          (e) => priceBadge.updateSubgraphCredits(e.detail.subgraphNode)\n        )\n      },\n      afterConfigureGraph() {\n        for (const node of app.canvas.graph?.nodes ?? [])\n          priceBadge.updateSubgraphCredits(node)\n      }\n    })\n  })\n}\n","import type { Ref } from 'vue'\n\nimport { useSharedCanvasPositionConversion } from '@/composables/element/useCanvasPositionConversion'\nimport { usePragmaticDroppable } from '@/composables/usePragmaticDragAndDrop'\nimport type { LGraphNode } from '@/lib/litegraph/src/litegraph'\nimport { LiteGraph } from '@/lib/litegraph/src/litegraph'\nimport { useWorkflowService } from '@/platform/workflow/core/services/workflowService'\nimport { ComfyWorkflow } from '@/platform/workflow/management/stores/workflowStore'\nimport { app as comfyApp } from '@/scripts/app'\nimport { useLitegraphService } from '@/services/litegraphService'\nimport { ComfyModelDef } from '@/stores/modelStore'\nimport type { ModelNodeProvider } from '@/stores/modelToNodeStore'\nimport { useModelToNodeStore } from '@/stores/modelToNodeStore'\nimport { ComfyNodeDefImpl } from '@/stores/nodeDefStore'\nimport type { RenderedTreeExplorerNode } from '@/types/treeExplorerTypes'\n\nexport const useCanvasDrop = (canvasRef: Ref<HTMLCanvasElement | null>) => {\n  const modelToNodeStore = useModelToNodeStore()\n  const litegraphService = useLitegraphService()\n  const workflowService = useWorkflowService()\n\n  usePragmaticDroppable(() => canvasRef.value, {\n    getDropEffect: (args): Exclude<DataTransfer['dropEffect'], 'none'> =>\n      args.source.data.type === 'tree-explorer-node' ? 'copy' : 'move',\n    onDrop: async (event) => {\n      const loc = event.location.current.input\n      const dndData = event.source.data\n\n      if (dndData.type === 'tree-explorer-node') {\n        const node = dndData.data as RenderedTreeExplorerNode\n        const conv = useSharedCanvasPositionConversion()\n        const basePos = conv.clientPosToCanvasPos([loc.clientX, loc.clientY])\n\n        if (node.data instanceof ComfyNodeDefImpl) {\n          const nodeDef = node.data\n          const pos = [...basePos]\n          // Add an offset on y to make sure after adding the node, the cursor\n          // is on the node (top left corner)\n          pos[1] += LiteGraph.NODE_TITLE_HEIGHT\n          litegraphService.addNodeOnGraph(nodeDef, { pos })\n        } else if (node.data instanceof ComfyModelDef) {\n          const model = node.data\n          const pos = basePos\n          const nodeAtPos = comfyApp.canvas.graph?.getNodeOnPos(pos[0], pos[1])\n          let targetProvider: ModelNodeProvider | null = null\n          let targetGraphNode: LGraphNode | null = null\n          if (nodeAtPos) {\n            const providers = modelToNodeStore.getAllNodeProviders(\n              model.directory\n            )\n            for (const provider of providers) {\n              if (provider.nodeDef.name === nodeAtPos.comfyClass) {\n                targetGraphNode = nodeAtPos\n                targetProvider = provider\n              }\n            }\n          }\n          if (!targetGraphNode) {\n            const provider = modelToNodeStore.getNodeProvider(model.directory)\n            if (provider) {\n              targetGraphNode = litegraphService.addNodeOnGraph(\n                provider.nodeDef,\n                {\n                  pos\n                }\n              )\n              targetProvider = provider\n            }\n          }\n          if (targetGraphNode) {\n            const widget = targetGraphNode.widgets?.find(\n              (widget) => widget.name === targetProvider?.key\n            )\n            if (widget) {\n              widget.value = model.file_name\n            }\n          }\n        } else if (node.data instanceof ComfyWorkflow) {\n          const workflow = node.data\n          await workflowService.insertWorkflow(workflow, { position: basePos })\n        }\n      }\n    }\n  })\n}\n","import { st, te } from '@/i18n'\nimport { legacyMenuCompat } from '@/lib/litegraph/src/contextMenuCompat'\nimport type {\n  IContextMenuOptions,\n  IContextMenuValue,\n  INodeInputSlot,\n  IWidget\n} from '@/lib/litegraph/src/litegraph'\nimport { LGraphCanvas, LiteGraph } from '@/lib/litegraph/src/litegraph'\nimport { app } from '@/scripts/app'\nimport { normalizeI18nKey } from '@/utils/formatUtil'\n\n/**\n * Add translation for litegraph context menu.\n */\nexport const useContextMenuTranslation = () => {\n  // Install compatibility layer BEFORE any extensions load\n  legacyMenuCompat.install(LGraphCanvas.prototype, 'getCanvasMenuOptions')\n\n  const { getCanvasMenuOptions } = LGraphCanvas.prototype\n  const getCanvasCenterMenuOptions = function (\n    this: LGraphCanvas,\n    ...args: Parameters<typeof getCanvasMenuOptions>\n  ) {\n    const res: (IContextMenuValue | null)[] = getCanvasMenuOptions.apply(\n      this,\n      args\n    )\n\n    // Add items from new extension API\n    const newApiItems = app.collectCanvasMenuItems(this)\n    for (const item of newApiItems) {\n      res.push(item)\n    }\n\n    // Add legacy monkey-patched items\n    const legacyItems = legacyMenuCompat.extractLegacyItems(\n      'getCanvasMenuOptions',\n      this,\n      ...args\n    )\n    for (const item of legacyItems) {\n      res.push(item)\n    }\n\n    // Translate all items\n    for (const item of res) {\n      if (item?.content) {\n        item.content = st(`contextMenu.${item.content}`, item.content)\n      }\n    }\n    return res\n  }\n\n  LGraphCanvas.prototype.getCanvasMenuOptions = getCanvasCenterMenuOptions\n\n  legacyMenuCompat.registerWrapper(\n    'getCanvasMenuOptions',\n    getCanvasCenterMenuOptions,\n    getCanvasMenuOptions,\n    LGraphCanvas.prototype\n  )\n\n  // Install compatibility layer for getNodeMenuOptions\n  legacyMenuCompat.install(LGraphCanvas.prototype, 'getNodeMenuOptions')\n\n  // Wrap getNodeMenuOptions to add new API items\n  const nodeMenuFn = LGraphCanvas.prototype.getNodeMenuOptions\n  const getNodeMenuOptionsWithExtensions = function (\n    this: LGraphCanvas,\n    ...args: Parameters<typeof nodeMenuFn>\n  ) {\n    const res = nodeMenuFn.apply(this, args) as (IContextMenuValue | null)[]\n\n    // Add items from new extension API\n    const node = args[0]\n    const newApiItems = app.collectNodeMenuItems(node)\n    for (const item of newApiItems) {\n      res.push(item)\n    }\n\n    // Add legacy monkey-patched items\n    const legacyItems = legacyMenuCompat.extractLegacyItems(\n      'getNodeMenuOptions',\n      this,\n      ...args\n    )\n    for (const item of legacyItems) {\n      res.push(item)\n    }\n\n    return res\n  }\n\n  LGraphCanvas.prototype.getNodeMenuOptions = getNodeMenuOptionsWithExtensions\n\n  legacyMenuCompat.registerWrapper(\n    'getNodeMenuOptions',\n    getNodeMenuOptionsWithExtensions,\n    nodeMenuFn,\n    LGraphCanvas.prototype\n  )\n\n  function translateMenus(\n    values: readonly (IContextMenuValue | string | null)[] | undefined,\n    options: IContextMenuOptions\n  ) {\n    if (!values) return\n    const reInput = /Convert (.*) to input/\n    const reWidget = /Convert (.*) to widget/\n    const cvt = st('contextMenu.Convert ', 'Convert ')\n    const tinp = st('contextMenu. to input', ' to input')\n    const twgt = st('contextMenu. to widget', ' to widget')\n    for (const value of values) {\n      if (typeof value === 'string') continue\n\n      translateMenus(value?.submenu?.options, options)\n      if (!value?.content) {\n        continue\n      }\n      if (te(`contextMenu.${value.content}`)) {\n        value.content = st(`contextMenu.${value.content}`, value.content)\n      }\n\n      // for capture translation text of input and widget\n      const extraInfo: any = options.extra || options.parentMenu?.options?.extra\n      // widgets and inputs\n      const matchInput = value.content?.match(reInput)\n      if (matchInput) {\n        let match = matchInput[1]\n        extraInfo?.inputs?.find((i: INodeInputSlot) => {\n          if (i.name != match) return false\n          match = i.label ? i.label : i.name\n        })\n        extraInfo?.widgets?.find((i: IWidget) => {\n          if (i.name != match) return false\n          match = i.label ? i.label : i.name\n        })\n        value.content = cvt + match + tinp\n        continue\n      }\n      const matchWidget = value.content?.match(reWidget)\n      if (matchWidget) {\n        let match = matchWidget[1]\n        extraInfo?.inputs?.find((i: INodeInputSlot) => {\n          if (i.name != match) return false\n          match = i.label ? i.label : i.name\n        })\n        extraInfo?.widgets?.find((i: IWidget) => {\n          if (i.name != match) return false\n          match = i.label ? i.label : i.name\n        })\n        value.content = cvt + match + twgt\n        continue\n      }\n    }\n  }\n\n  const OriginalContextMenu = LiteGraph.ContextMenu\n  function ContextMenu(\n    values: (IContextMenuValue | string)[],\n    options: IContextMenuOptions\n  ) {\n    if (options.title) {\n      options.title = st(\n        `nodeDefs.${normalizeI18nKey(options.title)}.display_name`,\n        options.title\n      )\n    }\n    translateMenus(values, options)\n    const ctx = new OriginalContextMenu(values, options)\n    return ctx\n  }\n\n  LiteGraph.ContextMenu = ContextMenu as unknown as typeof LiteGraph.ContextMenu\n  LiteGraph.ContextMenu.prototype = OriginalContextMenu.prototype\n}\n","import { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\n/**\n * Utility functions for handling workbench events\n */\n\n/**\n * Check if there is selected text in the document.\n */\nfunction hasTextSelection(): boolean {\n  const selection = window.getSelection()\n  return selection !== null && selection.toString().trim().length > 0\n}\n\n/**\n * Used by clipboard handlers to determine if copy/paste events should be\n * intercepted for graph operations vs. allowing default browser behavior\n * for text inputs and other UI elements.\n *\n * @param target - The event target to check\n * @returns true if copy paste events will be handled by target\n */\nexport function shouldIgnoreCopyPaste(target: EventTarget | null): boolean {\n  const isTextInput =\n    target instanceof HTMLTextAreaElement ||\n    (target instanceof HTMLInputElement &&\n      ![\n        'button',\n        'checkbox',\n        'file',\n        'hidden',\n        'image',\n        'radio',\n        'range',\n        'reset',\n        'search',\n        'submit'\n      ].includes(target.type))\n  return isTextInput || useCanvasStore().linearMode || hasTextSelection()\n}\n","import { useEventListener } from '@vueuse/core'\n\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { shouldIgnoreCopyPaste } from '@/workbench/eventHelpers'\n\nconst clipboardHTMLWrapper = [\n  '<meta charset=\"utf-8\"><div><span data-metadata=\"',\n  '\"></span></div><span style=\"white-space:pre-wrap;\">Text</span>'\n]\n\n/**\n * Adds a handler on copy that serializes selected nodes to JSON\n */\nexport const useCopy = () => {\n  const canvasStore = useCanvasStore()\n\n  useEventListener(document, 'copy', (e) => {\n    if (shouldIgnoreCopyPaste(e.target)) {\n      // Default system copy\n      return\n    }\n    // copy nodes and clear clipboard\n    const canvas = canvasStore.canvas\n    if (canvas?.selectedItems) {\n      const serializedData = canvas.copyToClipboard()\n      // Use TextEncoder to handle Unicode characters properly\n      const base64Data = btoa(\n        String.fromCharCode(\n          ...Array.from(new TextEncoder().encode(serializedData))\n        )\n      )\n      // clearData doesn't remove images from clipboard\n      e.clipboardData?.setData(\n        'text/html',\n        clipboardHTMLWrapper.join(base64Data)\n      )\n      e.preventDefault()\n      e.stopImmediatePropagation()\n      return false\n    }\n  })\n}\n","import {\n  ContextMenu,\n  DragAndScale,\n  LGraph,\n  LGraphBadge,\n  LGraphCanvas,\n  LGraphGroup,\n  LGraphNode,\n  LLink,\n  LiteGraph\n} from '@/lib/litegraph/src/litegraph'\n\n/**\n * Assign all properties of LiteGraph to window to make it backward compatible.\n */\nexport const useGlobalLitegraph = () => {\n  // @ts-expect-error fixme ts strict error\n  window['LiteGraph'] = LiteGraph\n  // @ts-expect-error fixme ts strict error\n  window['LGraph'] = LGraph\n  // @ts-expect-error fixme ts strict error\n  window['LLink'] = LLink\n  // @ts-expect-error fixme ts strict error\n  window['LGraphNode'] = LGraphNode\n  // @ts-expect-error fixme ts strict error\n  window['LGraphGroup'] = LGraphGroup\n  // @ts-expect-error fixme ts strict error\n  window['DragAndScale'] = DragAndScale\n  // @ts-expect-error fixme ts strict error\n  window['LGraphCanvas'] = LGraphCanvas\n  // @ts-expect-error fixme ts strict error\n  window['ContextMenu'] = ContextMenu\n  // @ts-expect-error fixme ts strict error\n  window['LGraphBadge'] = LGraphBadge\n}\n","import { useEventListener } from '@vueuse/core'\n\nimport { LiteGraph } from '@/lib/litegraph/src/litegraph'\nimport type { LGraphNode } from '@/lib/litegraph/src/litegraph'\nimport type { ComfyWorkflowJSON } from '@/platform/workflow/validation/schemas/workflowSchema'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { app } from '@/scripts/app'\nimport { useWorkspaceStore } from '@/stores/workspaceStore'\nimport { isAudioNode, isImageNode, isVideoNode } from '@/utils/litegraphUtil'\nimport { shouldIgnoreCopyPaste } from '@/workbench/eventHelpers'\n\nfunction pasteClipboardItems(data: DataTransfer): boolean {\n  const rawData = data.getData('text/html')\n  const match = rawData.match(/data-metadata=\"([A-Za-z0-9+/=]+)\"/)?.[1]\n  if (!match) return false\n  try {\n    // Decode UTF-8 safe base64\n    const binaryString = atob(match)\n    const bytes = Uint8Array.from(binaryString, (c) => c.charCodeAt(0))\n    const decodedData = new TextDecoder().decode(bytes)\n    useCanvasStore().getCanvas()._deserializeItems(JSON.parse(decodedData), {})\n    return true\n  } catch (err) {\n    console.error(err)\n  }\n  return false\n}\n\n/**\n * Adds a handler on paste that extracts and loads images or workflows from pasted JSON data\n */\nexport const usePaste = () => {\n  const workspaceStore = useWorkspaceStore()\n  const canvasStore = useCanvasStore()\n\n  const pasteItemsOnNode = (\n    items: DataTransferItemList,\n    node: LGraphNode | null,\n    contentType: string\n  ) => {\n    if (!node) return\n\n    const filteredItems = Array.from(items).filter((item) =>\n      item.type.startsWith(contentType)\n    )\n\n    const blob = filteredItems[0]?.getAsFile()\n    if (!blob) return\n\n    node.pasteFile?.(blob)\n    node.pasteFiles?.(\n      Array.from(filteredItems)\n        .map((i) => i.getAsFile())\n        .filter((f) => f !== null)\n    )\n  }\n\n  useEventListener(document, 'paste', async (e) => {\n    if (shouldIgnoreCopyPaste(e.target)) {\n      // Default system copy\n      return\n    }\n    // ctrl+shift+v is used to paste nodes with connections\n    // this is handled by litegraph\n    if (workspaceStore.shiftDown) return\n\n    const { canvas } = canvasStore\n    if (!canvas) return\n\n    const { graph } = canvas\n    let data: DataTransfer | string | null = e.clipboardData\n    if (!data) throw new Error('No clipboard data on clipboard event')\n\n    const { items } = data\n\n    const currentNode = canvas.current_node as LGraphNode\n    const isNodeSelected = currentNode?.is_selected\n\n    const isImageNodeSelected = isNodeSelected && isImageNode(currentNode)\n    const isVideoNodeSelected = isNodeSelected && isVideoNode(currentNode)\n    const isAudioNodeSelected = isNodeSelected && isAudioNode(currentNode)\n\n    let imageNode: LGraphNode | null = isImageNodeSelected ? currentNode : null\n    let audioNode: LGraphNode | null = isAudioNodeSelected ? currentNode : null\n    const videoNode: LGraphNode | null = isVideoNodeSelected\n      ? currentNode\n      : null\n\n    // Look for image paste data\n    for (const item of items) {\n      if (item.type.startsWith('image/')) {\n        if (!imageNode) {\n          // No image node selected: add a new one\n          const newNode = LiteGraph.createNode('LoadImage')\n          if (newNode) {\n            newNode.pos = [canvas.graph_mouse[0], canvas.graph_mouse[1]]\n            imageNode = graph?.add(newNode) ?? null\n          }\n          graph?.change()\n        }\n        pasteItemsOnNode(items, imageNode, 'image')\n        return\n      } else if (item.type.startsWith('video/')) {\n        if (!videoNode) {\n          // No video node selected: add a new one\n          // TODO: when video node exists\n        } else {\n          pasteItemsOnNode(items, videoNode, 'video')\n          return\n        }\n      } else if (item.type.startsWith('audio/')) {\n        if (!audioNode) {\n          // No audio node selected: add a new one\n          const newNode = LiteGraph.createNode('LoadAudio')\n          if (newNode) {\n            newNode.pos = [canvas.graph_mouse[0], canvas.graph_mouse[1]]\n            audioNode = graph?.add(newNode) ?? null\n          }\n          graph?.change()\n        }\n        pasteItemsOnNode(items, audioNode, 'audio')\n        return\n      }\n    }\n    if (pasteClipboardItems(data)) return\n\n    // No image found. Look for node data\n    data = data.getData('text/plain')\n    let workflow: ComfyWorkflowJSON | null = null\n    try {\n      data = data.slice(data.indexOf('{'))\n      workflow = JSON.parse(data)\n    } catch (err) {\n      try {\n        data = data.slice(data.indexOf('workflow\\n'))\n        data = data.slice(data.indexOf('{'))\n        workflow = JSON.parse(data)\n      } catch (error) {\n        workflow = null\n      }\n    }\n\n    if (workflow && workflow.version && workflow.nodes && workflow.extra) {\n      await app.loadGraphData(workflow)\n    } else {\n      if (\n        (e.target instanceof HTMLTextAreaElement &&\n          e.target.type === 'textarea') ||\n        (e.target instanceof HTMLInputElement && e.target.type === 'text')\n      ) {\n        return\n      }\n\n      // Litegraph default paste\n      canvas.pasteFromClipboard()\n    }\n  })\n}\n","import { watchEffect } from 'vue'\n\nimport {\n  CanvasPointer,\n  LGraphNode,\n  LiteGraph\n} from '@/lib/litegraph/src/litegraph'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\n\n/**\n * Watch for changes in the setting store and update the LiteGraph settings accordingly.\n */\nexport const useLitegraphSettings = () => {\n  const settingStore = useSettingStore()\n  const canvasStore = useCanvasStore()\n\n  watchEffect(() => {\n    const canvasInfoEnabled = settingStore.get('Comfy.Graph.CanvasInfo')\n    if (canvasStore.canvas) {\n      canvasStore.canvas.show_info = canvasInfoEnabled\n      canvasStore.canvas.draw(false, true)\n    }\n  })\n\n  watchEffect(() => {\n    const zoomSpeed = settingStore.get('Comfy.Graph.ZoomSpeed')\n    if (canvasStore.canvas) {\n      canvasStore.canvas.zoom_speed = zoomSpeed\n    }\n  })\n\n  watchEffect(() => {\n    LiteGraph.snaps_for_comfy = settingStore.get(\n      'Comfy.Node.AutoSnapLinkToSlot'\n    )\n  })\n\n  watchEffect(() => {\n    LiteGraph.snap_highlights_node = settingStore.get(\n      'Comfy.Node.SnapHighlightsNode'\n    )\n  })\n\n  watchEffect(() => {\n    LGraphNode.keepAllLinksOnBypass = settingStore.get(\n      'Comfy.Node.BypassAllLinksOnDelete'\n    )\n  })\n\n  watchEffect(() => {\n    LiteGraph.middle_click_slot_add_default_node = settingStore.get(\n      'Comfy.Node.MiddleClickRerouteNode'\n    )\n  })\n\n  watchEffect(() => {\n    const linkRenderMode = settingStore.get('Comfy.LinkRenderMode')\n    if (canvasStore.canvas) {\n      canvasStore.canvas.links_render_mode = linkRenderMode\n      canvasStore.canvas.setDirty(/* fg */ false, /* bg */ true)\n    }\n  })\n\n  watchEffect(() => {\n    const minFontSizeForLOD = settingStore.get(\n      'LiteGraph.Canvas.MinFontSizeForLOD'\n    )\n    if (canvasStore.canvas) {\n      canvasStore.canvas.min_font_size_for_lod = minFontSizeForLOD\n      canvasStore.canvas.setDirty(/* fg */ true, /* bg */ true)\n    }\n  })\n\n  watchEffect(() => {\n    const linkMarkerShape = settingStore.get('Comfy.Graph.LinkMarkers')\n    const { canvas } = canvasStore\n    if (canvas) {\n      canvas.linkMarkerShape = linkMarkerShape\n      canvas.setDirty(false, true)\n    }\n  })\n\n  watchEffect(() => {\n    const maximumFps = settingStore.get('LiteGraph.Canvas.MaximumFps')\n    const { canvas } = canvasStore\n    if (canvas) canvas.maximumFps = maximumFps\n  })\n\n  watchEffect(() => {\n    const dragZoomEnabled = settingStore.get('Comfy.Graph.CtrlShiftZoom')\n    const { canvas } = canvasStore\n    if (canvas) canvas.dragZoomEnabled = dragZoomEnabled\n  })\n\n  watchEffect(() => {\n    const liveSelection = settingStore.get('Comfy.Graph.LiveSelection')\n    const { canvas } = canvasStore\n    if (canvas) canvas.liveSelection = liveSelection\n  })\n\n  watchEffect(() => {\n    CanvasPointer.doubleClickTime = settingStore.get(\n      'Comfy.Pointer.DoubleClickTime'\n    )\n  })\n\n  watchEffect(() => {\n    CanvasPointer.bufferTime = settingStore.get('Comfy.Pointer.ClickBufferTime')\n  })\n\n  watchEffect(() => {\n    CanvasPointer.maxClickDrift = settingStore.get('Comfy.Pointer.ClickDrift')\n  })\n\n  watchEffect(() => {\n    LiteGraph.CANVAS_GRID_SIZE = settingStore.get('Comfy.SnapToGrid.GridSize')\n  })\n\n  watchEffect(() => {\n    LiteGraph.alwaysSnapToGrid = settingStore.get('pysssss.SnapToGrid')\n  })\n\n  watchEffect(() => {\n    LiteGraph.context_menu_scaling = settingStore.get(\n      'LiteGraph.ContextMenu.Scaling'\n    )\n  })\n\n  watchEffect(() => {\n    LiteGraph.Reroute.maxSplineOffset = settingStore.get(\n      'LiteGraph.Reroute.SplineOffset'\n    )\n  })\n\n  watchEffect(() => {\n    const navigationMode = settingStore.get('Comfy.Canvas.NavigationMode') as\n      | 'standard'\n      | 'legacy'\n      | 'custom'\n\n    LiteGraph.canvasNavigationMode = navigationMode\n    LiteGraph.macTrackpadGestures = navigationMode === 'standard'\n  })\n\n  watchEffect(() => {\n    const leftMouseBehavior = settingStore.get(\n      'Comfy.Canvas.LeftMouseClickBehavior'\n    ) as 'panning' | 'select'\n    LiteGraph.leftMouseClickBehavior = leftMouseBehavior\n  })\n\n  watchEffect(() => {\n    const mouseWheelScroll = settingStore.get(\n      'Comfy.Canvas.MouseWheelScroll'\n    ) as 'panning' | 'zoom'\n    LiteGraph.mouseWheelScroll = mouseWheelScroll\n  })\n\n  watchEffect(() => {\n    LiteGraph.saveViewportWithGraph = settingStore.get(\n      'Comfy.EnableWorkflowViewRestore'\n    )\n  })\n}\n","import { LinkMarkerShape, LiteGraph } from '@/lib/litegraph/src/litegraph'\nimport { isCloud } from '@/platform/distribution/types'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport type { SettingParams } from '@/platform/settings/types'\nimport type { ColorPalettes } from '@/schemas/colorPaletteSchema'\nimport type { Keybinding } from '@/schemas/keyBindingSchema'\nimport { NodeBadgeMode } from '@/types/nodeSource'\nimport { LinkReleaseTriggerAction } from '@/types/searchBoxTypes'\nimport { breakpointsTailwind } from '@vueuse/core'\n\n/**\n * Core settings are essential configuration parameters required for ComfyUI's basic functionality.\n * These settings must be present in the settings store and cannot be omitted.\n *\n * IMPORTANT: To prevent ID conflicts, settings should be marked as deprecated rather than removed\n * when they are no longer needed.\n */\nexport const CORE_SETTINGS: SettingParams[] = [\n  {\n    id: 'Comfy.Memory.AllowManualUnload',\n    name: 'Allow manual unload of models and execution cache via user command',\n    type: 'hidden',\n    defaultValue: isCloud ? false : true,\n    versionAdded: '1.18.0'\n  },\n  {\n    id: 'Comfy.Validation.Workflows',\n    name: 'Validate workflows',\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'Comfy.NodeSearchBoxImpl',\n    category: ['Comfy', 'Node Search Box', 'Implementation'],\n    experimental: true,\n    name: 'Node search box implementation',\n    type: 'combo',\n    options: ['default', 'litegraph (legacy)'],\n    defaultValue: 'default'\n  },\n  {\n    id: 'Comfy.LinkRelease.Action',\n    category: ['LiteGraph', 'LinkRelease', 'Action'],\n    name: 'Action on link release (No modifier)',\n    type: 'combo',\n    options: Object.values(LinkReleaseTriggerAction),\n    defaultValue: LinkReleaseTriggerAction.CONTEXT_MENU,\n    defaultsByInstallVersion: {\n      '1.24.1': LinkReleaseTriggerAction.SEARCH_BOX\n    }\n  },\n  {\n    id: 'Comfy.LinkRelease.ActionShift',\n    category: ['LiteGraph', 'LinkRelease', 'ActionShift'],\n    name: 'Action on link release (Shift)',\n    type: 'combo',\n    options: Object.values(LinkReleaseTriggerAction),\n    defaultValue: LinkReleaseTriggerAction.SEARCH_BOX,\n    defaultsByInstallVersion: {\n      '1.24.1': LinkReleaseTriggerAction.CONTEXT_MENU\n    }\n  },\n  {\n    id: 'Comfy.NodeSearchBoxImpl.NodePreview',\n    category: ['Comfy', 'Node Search Box', 'NodePreview'],\n    name: 'Node preview',\n    tooltip: 'Only applies to the default implementation',\n    type: 'boolean',\n    defaultValue: true\n  },\n  {\n    id: 'Comfy.NodeSearchBoxImpl.ShowCategory',\n    category: ['Comfy', 'Node Search Box', 'ShowCategory'],\n    name: 'Show node category in search results',\n    tooltip: 'Only applies to the default implementation',\n    type: 'boolean',\n    defaultValue: true\n  },\n  {\n    id: 'Comfy.NodeSearchBoxImpl.ShowIdName',\n    category: ['Comfy', 'Node Search Box', 'ShowIdName'],\n    name: 'Show node id name in search results',\n    tooltip: 'Only applies to the default implementation',\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'Comfy.NodeSearchBoxImpl.ShowNodeFrequency',\n    category: ['Comfy', 'Node Search Box', 'ShowNodeFrequency'],\n    name: 'Show node frequency in search results',\n    tooltip: 'Only applies to the default implementation',\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'Comfy.Sidebar.Location',\n    category: ['Appearance', 'Sidebar', 'Location'],\n    name: 'Sidebar location',\n    type: 'combo',\n    options: ['left', 'right'],\n    defaultValue: 'left'\n  },\n  {\n    id: 'Comfy.Sidebar.Size',\n    category: ['Appearance', 'Sidebar', 'Size'],\n    name: 'Sidebar size',\n    type: 'combo',\n    options: ['normal', 'small'],\n    // Default to small if the window is less than 1536px(2xl) wide.\n    defaultValue: () => (window.innerWidth < 1536 ? 'small' : 'normal')\n  },\n  {\n    id: 'Comfy.Sidebar.UnifiedWidth',\n    category: ['Appearance', 'Sidebar', 'UnifiedWidth'],\n    name: 'Unified sidebar width',\n    type: 'boolean',\n    defaultValue: true,\n    versionAdded: '1.18.1'\n  },\n  {\n    id: 'Comfy.Sidebar.Style',\n    category: ['Appearance', 'Sidebar', 'Style'],\n    name: 'Sidebar style',\n    type: 'combo',\n    options: ['floating', 'connected'],\n    defaultValue: 'connected'\n  },\n  {\n    id: 'Comfy.TextareaWidget.FontSize',\n    category: ['Appearance', 'Node Widget', 'TextareaWidget', 'FontSize'],\n    name: 'Textarea widget font size',\n    type: 'slider',\n    defaultValue: 10,\n    attrs: {\n      min: 8,\n      max: 24\n    }\n  },\n  {\n    id: 'Comfy.TextareaWidget.Spellcheck',\n    category: ['Comfy', 'Node Widget', 'TextareaWidget', 'Spellcheck'],\n    name: 'Textarea widget spellcheck',\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'Comfy.Workflow.SortNodeIdOnSave',\n    name: 'Sort node IDs when saving workflow',\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'Comfy.Canvas.NavigationMode',\n    category: ['LiteGraph', 'Canvas Navigation', 'NavigationMode'],\n    name: 'Navigation Mode',\n    defaultValue: 'legacy',\n    type: 'combo',\n    sortOrder: 100,\n    options: [\n      { value: 'standard', text: 'Standard (New)' },\n      { value: 'legacy', text: 'Drag Navigation' },\n      { value: 'custom', text: 'Custom' }\n    ],\n    versionAdded: '1.25.0',\n    defaultsByInstallVersion: {\n      '1.25.0': 'legacy'\n    },\n    onChange: async (newValue: string, oldValue?: string) => {\n      if (!oldValue) return\n      const settingStore = useSettingStore()\n\n      if (newValue === 'standard') {\n        // Update related settings to match standard mode - select + panning\n        await settingStore.set('Comfy.Canvas.LeftMouseClickBehavior', 'select')\n        await settingStore.set('Comfy.Canvas.MouseWheelScroll', 'panning')\n      } else if (newValue === 'legacy') {\n        // Update related settings to match legacy mode - panning + zoom\n        await settingStore.set('Comfy.Canvas.LeftMouseClickBehavior', 'panning')\n        await settingStore.set('Comfy.Canvas.MouseWheelScroll', 'zoom')\n      }\n    }\n  },\n  {\n    id: 'Comfy.Canvas.LeftMouseClickBehavior',\n    category: ['LiteGraph', 'Canvas Navigation', 'LeftMouseClickBehavior'],\n    name: 'Left Mouse Click Behavior',\n    defaultValue: 'panning',\n    type: 'radio',\n    sortOrder: 50,\n    options: [\n      { value: 'panning', text: 'Panning' },\n      { value: 'select', text: 'Select' }\n    ],\n    versionAdded: '1.27.4',\n    onChange: async (newValue: string) => {\n      const settingStore = useSettingStore()\n\n      const navigationMode = settingStore.get('Comfy.Canvas.NavigationMode')\n\n      if (navigationMode !== 'custom') {\n        if (\n          (newValue === 'select' && navigationMode === 'standard') ||\n          (newValue === 'panning' && navigationMode === 'legacy')\n        ) {\n          return\n        }\n\n        // only set to custom if it doesn't match the preset modes\n        await settingStore.set('Comfy.Canvas.NavigationMode', 'custom')\n      }\n    }\n  },\n  {\n    id: 'Comfy.Canvas.MouseWheelScroll',\n    category: ['LiteGraph', 'Canvas Navigation', 'MouseWheelScroll'],\n    name: 'Mouse Wheel Scroll',\n    defaultValue: 'zoom',\n    type: 'radio',\n    options: [\n      { value: 'panning', text: 'Panning' },\n      { value: 'zoom', text: 'Zoom in/out' }\n    ],\n    versionAdded: '1.27.4',\n    onChange: async (newValue: string) => {\n      const settingStore = useSettingStore()\n\n      const navigationMode = settingStore.get('Comfy.Canvas.NavigationMode')\n\n      if (navigationMode !== 'custom') {\n        if (\n          (newValue === 'panning' && navigationMode === 'standard') ||\n          (newValue === 'zoom' && navigationMode === 'legacy')\n        ) {\n          return\n        }\n\n        // only set to custom if it doesn't match the preset modes\n        await settingStore.set('Comfy.Canvas.NavigationMode', 'custom')\n      }\n    }\n  },\n  {\n    id: 'Comfy.Graph.CanvasInfo',\n    category: ['LiteGraph', 'Canvas', 'CanvasInfo'],\n    name: 'Show canvas info on bottom left corner (fps, etc.)',\n    type: 'boolean',\n    defaultValue: true\n  },\n  {\n    id: 'Comfy.Node.ShowDeprecated',\n    name: 'Show deprecated nodes in search',\n    tooltip:\n      'Deprecated nodes are hidden by default in the UI, but remain functional in existing workflows that use them.',\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'Comfy.Node.ShowExperimental',\n    name: 'Show experimental nodes in search',\n    tooltip:\n      'Experimental nodes are marked as such in the UI and may be subject to significant changes or removal in future versions. Use with caution in production workflows',\n    type: 'boolean',\n    defaultValue: true\n  },\n  {\n    id: 'Comfy.Node.Opacity',\n    category: ['Appearance', 'Node', 'Opacity'],\n    name: 'Node opacity',\n    type: 'slider',\n    defaultValue: 1,\n    attrs: {\n      min: 0.01,\n      max: 1,\n      step: 0.01\n    }\n  },\n  {\n    id: 'Comfy.Workflow.ShowMissingNodesWarning',\n    name: 'Show missing nodes warning',\n    type: 'boolean',\n    defaultValue: true\n  },\n  {\n    id: 'Comfy.Workflow.ShowMissingModelsWarning',\n    name: 'Show missing models warning',\n    type: isCloud ? 'hidden' : 'boolean',\n    defaultValue: isCloud ? false : true,\n    experimental: true\n  },\n  {\n    id: 'Comfy.Workflow.WarnBlueprintOverwrite',\n    name: 'Require confirmation to overwrite an existing subgraph blueprint',\n    type: 'boolean',\n    defaultValue: true\n  },\n  {\n    id: 'Comfy.Graph.ZoomSpeed',\n    category: ['LiteGraph', 'Canvas', 'ZoomSpeed'],\n    name: 'Canvas zoom speed',\n    type: 'slider',\n    defaultValue: 1.1,\n    attrs: {\n      min: 1.01,\n      max: 2.5,\n      step: 0.01\n    }\n  },\n  // Bookmarks are stored in the settings store.\n  // Bookmarks are in format of category/display_name. e.g. \"conditioning/CLIPTextEncode\"\n  {\n    id: 'Comfy.NodeLibrary.Bookmarks',\n    name: 'Node library bookmarks with display name (deprecated)',\n    type: 'hidden',\n    defaultValue: [],\n    deprecated: true\n  },\n  {\n    id: 'Comfy.NodeLibrary.Bookmarks.V2',\n    name: 'Node library bookmarks v2 with unique name',\n    type: 'hidden',\n    defaultValue: []\n  },\n  // Stores mapping from bookmark folder name to its customization.\n  {\n    id: 'Comfy.NodeLibrary.BookmarksCustomization',\n    name: 'Node library bookmarks customization',\n    type: 'hidden',\n    defaultValue: {}\n  },\n  {\n    id: 'Comfy.GroupSelectedNodes.Padding',\n    category: ['LiteGraph', 'Group', 'Padding'],\n    name: 'Group selected nodes padding',\n    type: 'slider',\n    defaultValue: 10,\n    attrs: {\n      min: 0,\n      max: 100\n    }\n  },\n  {\n    id: 'Comfy.Node.DoubleClickTitleToEdit',\n    category: ['LiteGraph', 'Node', 'DoubleClickTitleToEdit'],\n    name: 'Double click node title to edit',\n    type: 'boolean',\n    defaultValue: true\n  },\n  {\n    id: 'Comfy.Node.AllowImageSizeDraw',\n    category: ['LiteGraph', 'Node Widget', 'AllowImageSizeDraw'],\n    name: 'Show width  height below the image preview',\n    type: 'boolean',\n    defaultValue: true\n  },\n  {\n    id: 'Comfy.Group.DoubleClickTitleToEdit',\n    category: ['LiteGraph', 'Group', 'DoubleClickTitleToEdit'],\n    name: 'Double click group title to edit',\n    type: 'boolean',\n    defaultValue: true\n  },\n  {\n    id: 'Comfy.Window.UnloadConfirmation',\n    name: 'Show confirmation when closing window',\n    type: 'boolean',\n    defaultValue: true,\n    versionModified: '1.7.12'\n  },\n  {\n    id: 'Comfy.TreeExplorer.ItemPadding',\n    category: ['Appearance', 'Tree Explorer', 'ItemPadding'],\n    name: 'Tree explorer item padding',\n    type: 'slider',\n    defaultValue: 2,\n    attrs: {\n      min: 0,\n      max: 8,\n      step: 1\n    }\n  },\n  {\n    id: 'Comfy.ModelLibrary.AutoLoadAll',\n    name: 'Automatically load all model folders',\n    tooltip:\n      'If true, all folders will load as soon as you open the model library (this may cause delays while it loads). If false, root level model folders will only load once you click on them.',\n    type: isCloud ? 'hidden' : 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'Comfy.ModelLibrary.NameFormat',\n    name: 'What name to display in the model library tree view',\n    tooltip:\n      'Select \"filename\" to render a simplified view of the raw filename (without directory or \".safetensors\" extension) in the model list. Select \"title\" to display the configurable model metadata title.',\n    type: 'combo',\n    options: ['filename', 'title'],\n    defaultValue: 'title'\n  },\n  {\n    id: 'Comfy.Locale',\n    name: 'Language',\n    type: 'combo',\n    options: [\n      { value: 'en', text: 'English' },\n      { value: 'zh', text: '' },\n      { value: 'zh-TW', text: '' },\n      { value: 'ru', text: '' },\n      { value: 'ja', text: '' },\n      { value: 'ko', text: '' },\n      { value: 'fr', text: 'Franais' },\n      { value: 'es', text: 'Espaol' },\n      { value: 'ar', text: '' },\n      { value: 'tr', text: 'Trke' },\n      { value: 'pt-BR', text: 'Portugus (BR)' }\n    ],\n    defaultValue: () => navigator.language.split('-')[0] || 'en'\n  },\n  {\n    id: 'Comfy.NodeBadge.NodeSourceBadgeMode',\n    category: ['LiteGraph', 'Node', 'NodeSourceBadgeMode'],\n    name: 'Node source badge mode',\n    type: 'combo',\n    options: Object.values(NodeBadgeMode),\n    defaultValue: NodeBadgeMode.HideBuiltIn\n  },\n  {\n    id: 'Comfy.NodeBadge.NodeIdBadgeMode',\n    category: ['LiteGraph', 'Node', 'NodeIdBadgeMode'],\n    name: 'Node ID badge mode',\n    type: 'combo',\n    options: [NodeBadgeMode.None, NodeBadgeMode.ShowAll],\n    defaultValue: NodeBadgeMode.None\n  },\n  {\n    id: 'Comfy.NodeBadge.NodeLifeCycleBadgeMode',\n    category: ['LiteGraph', 'Node', 'NodeLifeCycleBadgeMode'],\n    name: 'Node life cycle badge mode',\n    type: 'combo',\n    options: [NodeBadgeMode.None, NodeBadgeMode.ShowAll],\n    defaultValue: NodeBadgeMode.ShowAll\n  },\n  {\n    id: 'Comfy.NodeBadge.ShowApiPricing',\n    category: ['Comfy', 'API Nodes'],\n    name: 'Show API node pricing badge',\n    type: 'boolean',\n    defaultValue: true,\n    versionAdded: '1.20.3'\n  },\n  {\n    id: 'Comfy.Notification.ShowVersionUpdates',\n    category: ['Comfy', 'Notification Preferences'],\n    name: 'Show version updates',\n    tooltip: 'Show updates for new models, and major new features.',\n    type: 'boolean',\n    defaultValue: true\n  },\n  {\n    id: 'Comfy.ConfirmClear',\n    category: ['Comfy', 'Workflow', 'ConfirmClear'],\n    name: 'Require confirmation when clearing workflow',\n    type: 'boolean',\n    defaultValue: true\n  },\n  {\n    id: 'Comfy.PromptFilename',\n    category: ['Comfy', 'Workflow', 'PromptFilename'],\n    name: 'Prompt for filename when saving workflow',\n    type: 'boolean',\n    defaultValue: true\n  },\n  /**\n   * file format for preview\n   *\n   * format;quality\n   *\n   * ex)\n   * webp;50 -> webp, quality 50\n   * jpeg;80 -> rgb, jpeg, quality 80\n   *\n   * @type {string}\n   */\n  {\n    id: 'Comfy.PreviewFormat',\n    category: ['LiteGraph', 'Node Widget', 'PreviewFormat'],\n    name: 'Preview image format',\n    tooltip:\n      'When displaying a preview in the image widget, convert it to a lightweight image, e.g. webp, jpeg, webp;50, etc.',\n    type: 'text',\n    defaultValue: ''\n  },\n  {\n    id: 'Comfy.DisableSliders',\n    category: ['LiteGraph', 'Node Widget', 'DisableSliders'],\n    name: 'Disable node widget sliders',\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'Comfy.DisableFloatRounding',\n    category: ['LiteGraph', 'Node Widget', 'DisableFloatRounding'],\n    name: 'Disable default float widget rounding.',\n    tooltip:\n      '(requires page reload) Cannot disable round when round is set by the node in the backend.',\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'Comfy.FloatRoundingPrecision',\n    category: ['LiteGraph', 'Node Widget', 'FloatRoundingPrecision'],\n    name: 'Float widget rounding decimal places [0 = auto].',\n    tooltip: '(requires page reload)',\n    type: 'slider',\n    attrs: {\n      min: 0,\n      max: 6,\n      step: 1\n    },\n    defaultValue: 0\n  },\n  {\n    id: 'LiteGraph.Node.TooltipDelay',\n    name: 'Tooltip Delay',\n    type: 'number',\n    attrs: {\n      min: 100,\n      max: 3000,\n      step: 50\n    },\n    defaultValue: 500,\n    versionAdded: '1.9.0'\n  },\n  {\n    id: 'Comfy.EnableTooltips',\n    category: ['LiteGraph', 'Node', 'EnableTooltips'],\n    name: 'Enable Tooltips',\n    type: 'boolean',\n    defaultValue: true\n  },\n  {\n    id: 'Comfy.DevMode',\n    name: 'Enable dev mode options (API save, etc.)',\n    type: 'boolean',\n    defaultValue: false,\n    onChange: (value) => {\n      const element = document.getElementById('comfy-dev-save-api-button')\n      if (element) {\n        element.style.display = value ? 'flex' : 'none'\n      }\n    }\n  },\n  {\n    id: 'Comfy.UseNewMenu',\n    category: ['Comfy', 'Menu', 'UseNewMenu'],\n    defaultValue: 'Top',\n    name: 'Use new menu',\n    type: 'combo',\n    options: ['Disabled', 'Top'],\n    tooltip: 'Enable the redesigned top menu bar.',\n    migrateDeprecatedValue: (value: string) => {\n      // Floating is now supported by dragging the docked actionbar off.\n      if (value === 'Floating') {\n        return 'Top'\n      } else if (value === 'Bottom') {\n        return 'Top'\n      }\n      return value\n    }\n  },\n  {\n    id: 'Comfy.Workflow.WorkflowTabsPosition',\n    name: 'Opened workflows position',\n    type: 'combo',\n    options: ['Sidebar', 'Topbar'],\n    defaultValue: 'Topbar',\n    migrateDeprecatedValue: (value: string) => {\n      if (value === 'Topbar (2nd-row)') {\n        return 'Topbar'\n      }\n      return value\n    }\n  },\n  {\n    id: 'Comfy.Graph.CanvasMenu',\n    category: ['LiteGraph', 'Canvas', 'CanvasMenu'],\n    name: 'Show graph canvas menu',\n    type: 'boolean',\n    defaultValue: true\n  },\n  {\n    id: 'Comfy.QueueButton.BatchCountLimit',\n    name: 'Batch count limit',\n    tooltip:\n      'The maximum number of tasks added to the queue at one button click',\n    type: 'number',\n    defaultValue: isCloud ? 4 : 100,\n    versionAdded: '1.3.5'\n  },\n  {\n    id: 'Comfy.Keybinding.UnsetBindings',\n    name: 'Keybindings unset by the user',\n    type: 'hidden',\n    defaultValue: [] as Keybinding[],\n    versionAdded: '1.3.7',\n    versionModified: '1.7.3',\n    migrateDeprecatedValue: (\n      value: (Keybinding & { targetSelector?: string })[]\n    ) => {\n      return value.map((keybinding) => {\n        if (keybinding.targetSelector === '#graph-canvas') {\n          keybinding.targetElementId = 'graph-canvas-container'\n        }\n        return keybinding\n      })\n    }\n  },\n  {\n    id: 'Comfy.Keybinding.NewBindings',\n    name: 'Keybindings set by the user',\n    type: 'hidden',\n    defaultValue: [] as Keybinding[],\n    versionAdded: '1.3.7'\n  },\n  {\n    id: 'Comfy.Extension.Disabled',\n    name: 'Disabled extension names',\n    type: 'hidden',\n    defaultValue: [] as string[],\n    versionAdded: '1.3.11'\n  },\n  {\n    id: 'Comfy.LinkRenderMode',\n    category: ['LiteGraph', 'Graph', 'LinkRenderMode'],\n    name: 'Link Render Mode',\n    defaultValue: 2,\n    type: 'combo',\n    options: [\n      { value: LiteGraph.STRAIGHT_LINK, text: 'Straight' },\n      { value: LiteGraph.LINEAR_LINK, text: 'Linear' },\n      { value: LiteGraph.SPLINE_LINK, text: 'Spline' },\n      { value: LiteGraph.HIDDEN_LINK, text: 'Hidden' }\n    ]\n  },\n  {\n    id: 'Comfy.Node.AutoSnapLinkToSlot',\n    category: ['LiteGraph', 'Node', 'AutoSnapLinkToSlot'],\n    name: 'Auto snap link to node slot',\n    tooltip:\n      'When dragging a link over a node, the link automatically snap to a viable input slot on the node',\n    type: 'boolean',\n    defaultValue: true,\n    versionAdded: '1.3.29'\n  },\n  {\n    id: 'Comfy.Node.SnapHighlightsNode',\n    category: ['LiteGraph', 'Node', 'SnapHighlightsNode'],\n    name: 'Snap highlights node',\n    tooltip:\n      'When dragging a link over a node with viable input slot, highlight the node',\n    type: 'boolean',\n    defaultValue: true,\n    versionAdded: '1.3.29'\n  },\n  {\n    id: 'Comfy.Node.BypassAllLinksOnDelete',\n    category: ['LiteGraph', 'Node', 'BypassAllLinksOnDelete'],\n    name: 'Keep all links when deleting nodes',\n    tooltip:\n      'When deleting a node, attempt to reconnect all of its input and output links (bypassing the deleted node)',\n    type: 'boolean',\n    defaultValue: true,\n    versionAdded: '1.3.40'\n  },\n  {\n    id: 'Comfy.Node.MiddleClickRerouteNode',\n    category: ['LiteGraph', 'Node', 'MiddleClickRerouteNode'],\n    name: 'Middle-click creates a new Reroute node',\n    type: 'boolean',\n    defaultValue: true,\n    versionAdded: '1.3.42'\n  },\n  {\n    id: 'Comfy.Graph.LinkMarkers',\n    category: ['LiteGraph', 'Link', 'LinkMarkers'],\n    name: 'Link midpoint markers',\n    defaultValue: LinkMarkerShape.Circle,\n    type: 'combo',\n    options: [\n      { value: LinkMarkerShape.None, text: 'None' },\n      { value: LinkMarkerShape.Circle, text: 'Circle' },\n      { value: LinkMarkerShape.Arrow, text: 'Arrow' }\n    ],\n    versionAdded: '1.3.42'\n  },\n  {\n    id: 'Comfy.DOMClippingEnabled',\n    category: ['LiteGraph', 'Node', 'DOMClippingEnabled'],\n    name: 'Enable DOM element clipping (enabling may reduce performance)',\n    type: 'boolean',\n    defaultValue: true\n  },\n  {\n    id: 'Comfy.Graph.CtrlShiftZoom',\n    category: ['LiteGraph', 'Canvas', 'CtrlShiftZoom'],\n    name: 'Enable fast-zoom shortcut (Ctrl + Shift + Drag)',\n    type: 'boolean',\n    defaultValue: true,\n    versionAdded: '1.4.0'\n  },\n  {\n    id: 'Comfy.Graph.LiveSelection',\n    category: ['LiteGraph', 'Canvas', 'LiveSelection'],\n    name: 'Live selection',\n    tooltip:\n      'When enabled, nodes are selected/deselected in real-time as you drag the selection rectangle, similar to other design tools.',\n    type: 'boolean',\n    defaultValue: false,\n    versionAdded: '1.36.1'\n  },\n  {\n    id: 'Comfy.Pointer.ClickDrift',\n    category: ['LiteGraph', 'Pointer', 'ClickDrift'],\n    name: 'Pointer click drift (maximum distance)',\n    tooltip:\n      'If the pointer moves more than this distance while holding a button down, it is considered dragging (rather than clicking).\\n\\nHelps prevent objects from being unintentionally nudged if the pointer is moved whilst clicking.',\n    experimental: true,\n    type: 'slider',\n    attrs: {\n      min: 0,\n      max: 20,\n      step: 1\n    },\n    defaultValue: 6,\n    versionAdded: '1.4.3'\n  },\n  {\n    id: 'Comfy.Pointer.ClickBufferTime',\n    category: ['LiteGraph', 'Pointer', 'ClickBufferTime'],\n    name: 'Pointer click drift delay',\n    tooltip:\n      'After pressing a pointer button down, this is the maximum time (in milliseconds) that pointer movement can be ignored for.\\n\\nHelps prevent objects from being unintentionally nudged if the pointer is moved whilst clicking.',\n    experimental: true,\n    type: 'slider',\n    attrs: {\n      min: 0,\n      max: 1000,\n      step: 25\n    },\n    defaultValue: 150,\n    versionAdded: '1.4.3'\n  },\n  {\n    id: 'Comfy.Pointer.DoubleClickTime',\n    category: ['LiteGraph', 'Pointer', 'DoubleClickTime'],\n    name: 'Double click interval (maximum)',\n    tooltip:\n      'The maximum time in milliseconds between the two clicks of a double-click.  Increasing this value may assist if double-clicks are sometimes not registered.',\n    type: 'slider',\n    attrs: {\n      min: 100,\n      max: 1000,\n      step: 50\n    },\n    defaultValue: 300,\n    versionAdded: '1.4.3'\n  },\n  {\n    id: 'Comfy.SnapToGrid.GridSize',\n    category: ['LiteGraph', 'Canvas', 'GridSize'],\n    name: 'Snap to grid size',\n    type: 'slider',\n    attrs: {\n      min: 1,\n      max: 500\n    },\n    tooltip:\n      'When dragging and resizing nodes while holding shift they will be aligned to the grid, this controls the size of that grid.',\n    defaultValue: LiteGraph.CANVAS_GRID_SIZE\n  },\n  // Keep the 'pysssss.SnapToGrid' setting id so we don't need to migrate setting values.\n  // Using a new setting id can cause existing users to lose their existing settings.\n  {\n    id: 'pysssss.SnapToGrid',\n    category: ['LiteGraph', 'Canvas', 'AlwaysSnapToGrid'],\n    name: 'Always snap to grid',\n    type: 'boolean',\n    defaultValue: false,\n    versionAdded: '1.3.13'\n  },\n  {\n    id: 'Comfy.Server.ServerConfigValues',\n    name: 'Server config values for frontend display',\n    tooltip: 'Server config values used for frontend display only',\n    type: 'hidden',\n    // Mapping from server config id to value.\n    defaultValue: {} as Record<string, unknown>,\n    versionAdded: '1.4.8'\n  },\n  {\n    id: 'Comfy.Server.LaunchArgs',\n    name: 'Server launch arguments',\n    tooltip:\n      'These are the actual arguments that are passed to the server when it is launched.',\n    type: 'hidden',\n    defaultValue: {} as Record<string, string>,\n    versionAdded: '1.4.8'\n  },\n  {\n    id: 'Comfy.Queue.MaxHistoryItems',\n    name: 'Queue history size',\n    tooltip: 'The maximum number of tasks that show in the queue history.',\n    type: 'slider',\n    attrs: {\n      min: 2,\n      max: 256,\n      step: 2\n    },\n    defaultValue: 64,\n    versionAdded: '1.4.12'\n  },\n  {\n    id: 'Comfy.Execution.PreviewMethod',\n    category: ['Comfy', 'Execution', 'PreviewMethod'],\n    name: 'Live preview method',\n    tooltip:\n      'Live preview method during image generation. \"default\" uses the server CLI setting.',\n    type: 'combo',\n    options: ['default', 'none', 'auto', 'latent2rgb', 'taesd'],\n    defaultValue: 'default',\n    versionAdded: '1.36.0'\n  },\n  {\n    id: 'LiteGraph.Canvas.MaximumFps',\n    name: 'Maximum FPS',\n    tooltip:\n      'The maximum frames per second that the canvas is allowed to render. Caps GPU usage at the cost of smoothness. If 0, the screen refresh rate is used. Default: 0',\n    type: 'slider',\n    attrs: {\n      min: 0,\n      max: 120\n    },\n    defaultValue: 0,\n    versionAdded: '1.5.1'\n  },\n  {\n    id: 'Comfy.EnableWorkflowViewRestore',\n    category: ['Comfy', 'Workflow', 'EnableWorkflowViewRestore'],\n    name: 'Save and restore canvas position and zoom level in workflows',\n    type: 'boolean',\n    defaultValue: true,\n    versionModified: '1.5.4'\n  },\n  {\n    id: 'Comfy.Workflow.ConfirmDelete',\n    name: 'Show confirmation when deleting workflows',\n    type: 'boolean',\n    defaultValue: true,\n    versionAdded: '1.5.6'\n  },\n  {\n    id: 'Comfy.ColorPalette',\n    name: 'The active color palette id',\n    type: 'hidden',\n    defaultValue: 'dark',\n    versionModified: '1.6.7',\n    migrateDeprecatedValue(value: string) {\n      // Legacy custom palettes were prefixed with 'custom_'\n      return value.startsWith('custom_') ? value.replace('custom_', '') : value\n    }\n  },\n  {\n    id: 'Comfy.CustomColorPalettes',\n    name: 'Custom color palettes',\n    type: 'hidden',\n    defaultValue: {} as ColorPalettes,\n    versionModified: '1.6.7'\n  },\n  {\n    id: 'Comfy.WidgetControlMode',\n    category: ['Comfy', 'Node Widget', 'WidgetControlMode'],\n    name: 'Widget control mode',\n    tooltip:\n      'Controls when widget values are updated (randomize/increment/decrement), either before the prompt is queued or after.',\n    type: 'combo',\n    defaultValue: 'after',\n    options: ['before', 'after'],\n    versionModified: '1.6.10'\n  },\n  {\n    id: 'Comfy.TutorialCompleted',\n    name: 'Tutorial completed',\n    type: 'hidden',\n    defaultValue: false,\n    versionAdded: '1.8.7'\n  },\n  {\n    id: 'Comfy.InstalledVersion',\n    name: 'The frontend version that was running when the user first installed ComfyUI',\n    type: 'hidden',\n    defaultValue: null,\n    versionAdded: '1.24.0'\n  },\n  {\n    id: 'LiteGraph.ContextMenu.Scaling',\n    name: 'Scale node combo widget menus (lists) when zoomed in',\n    defaultValue: false,\n    type: 'boolean',\n    versionAdded: '1.8.8'\n  },\n\n  {\n    id: 'LiteGraph.Canvas.LowQualityRenderingZoomThreshold',\n    type: 'hidden',\n    deprecated: true,\n    name: 'Low quality rendering zoom threshold (deprecated)',\n    tooltip:\n      'Zoom level threshold for performance mode. Lower values (0.1) = quality at all zoom levels. Higher values (1.0) = performance mode even when zoomed in. Performance mode simplifies rendering by hiding text labels, shadows, and details.',\n    attrs: {\n      min: 0.1,\n      max: 1,\n      step: 0.01\n    },\n    defaultValue: 0.6,\n    versionAdded: '1.9.1',\n    versionModified: '1.26.7'\n  },\n  {\n    id: 'LiteGraph.Canvas.MinFontSizeForLOD',\n    name: 'Zoom Node Level of Detail - font size threshold',\n    tooltip:\n      'Controls when the nodes switch to low quality LOD rendering. Uses font size in pixels to determine when to switch. Set to 0 to disable. Values 1-24 set the minimum font size threshold for LOD - higher values (24px) = switch nodes to simplified rendering sooner when zooming out, lower values (1px) = maintain full node quality longer.',\n    type: 'slider',\n    attrs: {\n      min: 0,\n      max: 24,\n      step: 1\n    },\n    defaultValue: 8,\n    versionAdded: '1.26.7',\n    hideInVueNodes: true\n  },\n  {\n    id: 'Comfy.Canvas.SelectionToolbox',\n    category: ['LiteGraph', 'Canvas', 'SelectionToolbox'],\n    name: 'Show selection toolbox',\n    type: 'boolean',\n    defaultValue: true,\n    versionAdded: '1.10.5'\n  },\n  {\n    id: 'LiteGraph.Reroute.SplineOffset',\n    name: 'Reroute spline offset',\n    tooltip: 'The bezier control point offset from the reroute centre point',\n    type: 'slider',\n    defaultValue: 20,\n    attrs: {\n      min: 0,\n      max: 400\n    },\n    versionAdded: '1.15.7'\n  },\n  {\n    id: 'Comfy.Toast.DisableReconnectingToast',\n    name: 'Disable toasts when reconnecting or reconnected',\n    type: 'hidden',\n    defaultValue: false,\n    versionAdded: '1.15.12'\n  },\n  {\n    id: 'Comfy.Minimap.Visible',\n    name: 'Display minimap on canvas',\n    type: 'hidden',\n    defaultValue: window.innerWidth >= breakpointsTailwind.lg,\n    versionAdded: '1.25.0'\n  },\n  {\n    id: 'Comfy.Minimap.NodeColors',\n    name: 'Display node with its original color on minimap',\n    type: 'hidden',\n    defaultValue: false,\n    versionAdded: '1.26.0'\n  },\n  {\n    id: 'Comfy.Minimap.ShowLinks',\n    name: 'Display links on minimap',\n    type: 'hidden',\n    defaultValue: true,\n    versionAdded: '1.26.0'\n  },\n  {\n    id: 'Comfy.Minimap.ShowGroups',\n    name: 'Display node groups on minimap',\n    type: 'hidden',\n    defaultValue: true,\n    versionAdded: '1.26.0'\n  },\n  {\n    id: 'Comfy.Minimap.RenderBypassState',\n    name: 'Render bypass state on minimap',\n    type: 'hidden',\n    defaultValue: true,\n    versionAdded: '1.26.0'\n  },\n  {\n    id: 'Comfy.Minimap.RenderErrorState',\n    name: 'Render error state on minimap',\n    type: 'hidden',\n    defaultValue: true,\n    versionAdded: '1.26.0'\n  },\n  {\n    id: 'Comfy.Workflow.AutoSaveDelay',\n    name: 'Auto Save Delay (ms)',\n    defaultValue: 1000,\n    type: 'number',\n    tooltip: 'Only applies if Auto Save is set to \"after delay\".',\n    versionAdded: '1.16.0'\n  },\n  {\n    id: 'Comfy.Workflow.AutoSave',\n    name: 'Auto Save',\n    type: 'combo',\n    options: ['off', 'after delay'], // Room for other options like on focus change, tab change, window change\n    defaultValue: 'off', // Popular request by users (https://github.com/Comfy-Org/ComfyUI_frontend/issues/1584#issuecomment-2536610154)\n    versionAdded: '1.16.0'\n  },\n  {\n    id: 'Comfy.Workflow.Persist',\n    name: 'Persist workflow state and restore on page (re)load',\n    type: 'boolean',\n    defaultValue: true,\n    versionAdded: '1.16.1'\n  },\n  {\n    id: 'LiteGraph.Node.DefaultPadding',\n    name: 'Always shrink new nodes',\n    tooltip:\n      'Resize nodes to the smallest possible size when created. When disabled, a newly added node will be widened slightly to show widget values.',\n    type: 'boolean',\n    defaultValue: false,\n    versionAdded: '1.18.0'\n  },\n  {\n    id: 'Comfy.Canvas.BackgroundImage',\n    category: ['Appearance', 'Canvas', 'Background'],\n    name: 'Canvas background image',\n    type: 'backgroundImage',\n    tooltip:\n      'Image URL for the canvas background. You can right-click an image in the outputs panel and select \"Set as Background\" to use it, or upload your own image using the upload button.',\n    defaultValue: '',\n    versionAdded: '1.20.4',\n    versionModified: '1.20.5'\n  },\n  // Release data stored in settings\n  {\n    id: 'Comfy.Release.Version',\n    name: 'Last seen release version',\n    type: 'hidden',\n    defaultValue: ''\n  },\n  {\n    id: 'Comfy.Release.Status',\n    name: 'Release status',\n    type: 'hidden',\n    defaultValue: 'skipped'\n  },\n  {\n    id: 'Comfy.Release.Timestamp',\n    name: 'Release seen timestamp',\n    type: 'hidden',\n    defaultValue: 0\n  },\n\n  /**\n   * Template Library Filter Settings\n   */\n  {\n    id: 'Comfy.Templates.SelectedModels',\n    name: 'Template library - Selected model filters',\n    type: 'hidden',\n    defaultValue: []\n  },\n  {\n    id: 'Comfy.Templates.SelectedUseCases',\n    name: 'Template library - Selected use case filters',\n    type: 'hidden',\n    defaultValue: []\n  },\n  {\n    id: 'Comfy.Templates.SelectedRunsOn',\n    name: 'Template library - Selected runs on filters',\n    type: 'hidden',\n    defaultValue: []\n  },\n  {\n    id: 'Comfy.Templates.SortBy',\n    name: 'Template library - Sort preference',\n    type: 'hidden',\n    defaultValue: 'default'\n  },\n\n  /**\n   * Nodes 2.0 Settings\n   */\n  {\n    id: 'Comfy.VueNodes.Enabled',\n    category: ['Comfy', 'Nodes 2.0', 'VueNodesEnabled'],\n    name: 'Modern Node Design (Nodes 2.0)',\n    type: 'boolean',\n    tooltip:\n      'Modern: DOM-based rendering with enhanced interactivity, native browser features, and updated visual design. Classic: Traditional canvas rendering.',\n    defaultValue: false,\n    sortOrder: 100,\n    experimental: true,\n    versionAdded: '1.27.1'\n  },\n  {\n    id: 'Comfy.VueNodes.AutoScaleLayout',\n    category: ['Comfy', 'Nodes 2.0', 'AutoScaleLayout'],\n    name: 'Auto-scale layout (Nodes 2.0)',\n    tooltip:\n      'Automatically scale node positions when switching to Nodes 2.0 rendering to prevent overlap',\n    type: 'boolean',\n    sortOrder: 50,\n    experimental: true,\n    defaultValue: true,\n    versionAdded: '1.30.3'\n  },\n  {\n    id: 'Comfy.Assets.UseAssetAPI',\n    name: 'Use Asset API for model library',\n    type: 'hidden',\n    tooltip: 'Use new Asset API for model browsing',\n    defaultValue: isCloud ? true : false,\n    experimental: true\n  },\n  {\n    id: 'Comfy.VersionCompatibility.DisableWarnings',\n    name: 'Disable version compatibility warnings',\n    type: 'hidden',\n    defaultValue: false,\n    versionAdded: '1.34.1'\n  },\n  {\n    id: 'Comfy.Queue.QPOV2',\n    name: 'Queue Panel V2',\n    type: 'hidden',\n    tooltip: 'Enable the new Assets Panel design with list/grid view toggle',\n    defaultValue: false,\n    experimental: true\n  }\n]\n","import { computed, onUnmounted, watch } from 'vue'\n\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useWorkflowService } from '@/platform/workflow/core/services/workflowService'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { api } from '@/scripts/api'\n\nexport function useWorkflowAutoSave() {\n  const workflowStore = useWorkflowStore()\n  const settingStore = useSettingStore()\n  const workflowService = useWorkflowService()\n\n  // Use computed refs to cache autosave settings\n  const autoSaveSetting = computed(() =>\n    settingStore.get('Comfy.Workflow.AutoSave')\n  )\n  const autoSaveDelay = computed(() =>\n    settingStore.get('Comfy.Workflow.AutoSaveDelay')\n  )\n\n  let autoSaveTimeout: NodeJS.Timeout | null = null\n  let isSaving = false\n  let needsAutoSave = false\n\n  const scheduleAutoSave = () => {\n    // Clear any existing timeout\n    if (autoSaveTimeout) {\n      clearTimeout(autoSaveTimeout)\n      autoSaveTimeout = null\n    }\n\n    // If autosave is enabled\n    if (autoSaveSetting.value === 'after delay') {\n      // If a save is in progress, mark that we need an autosave after saving\n      if (isSaving) {\n        needsAutoSave = true\n        return\n      }\n      const delay = autoSaveDelay.value\n      autoSaveTimeout = setTimeout(async () => {\n        const activeWorkflow = workflowStore.activeWorkflow\n        if (activeWorkflow?.isModified && activeWorkflow.isPersisted) {\n          try {\n            isSaving = true\n            await workflowService.saveWorkflow(activeWorkflow)\n          } catch (err) {\n            console.error('Auto save failed:', err)\n          } finally {\n            isSaving = false\n            if (needsAutoSave) {\n              needsAutoSave = false\n              scheduleAutoSave()\n            }\n          }\n        }\n      }, delay)\n    }\n  }\n\n  // Watch for autosave setting changes\n  watch(\n    autoSaveSetting,\n    (newSetting) => {\n      // Clear any existing timeout when settings change\n      if (autoSaveTimeout) {\n        clearTimeout(autoSaveTimeout)\n        autoSaveTimeout = null\n      }\n\n      // If there's an active modified workflow and autosave is enabled, schedule a save\n      if (\n        newSetting === 'after delay' &&\n        workflowStore.activeWorkflow?.isModified\n      ) {\n        scheduleAutoSave()\n      }\n    },\n    { immediate: true }\n  )\n\n  // Listen for graph changes and schedule autosave when they occur\n  const onGraphChanged = () => {\n    scheduleAutoSave()\n  }\n\n  api.addEventListener('graphChanged', onGraphChanged)\n\n  onUnmounted(() => {\n    if (autoSaveTimeout) {\n      clearTimeout(autoSaveTimeout)\n      autoSaveTimeout = null\n    }\n    api.removeEventListener('graphChanged', onGraphChanged)\n  })\n}\n","import { useToast } from 'primevue/usetoast'\nimport { useI18n } from 'vue-i18n'\nimport { useRoute, useRouter } from 'vue-router'\n\nimport { clearPreservedQuery } from '@/platform/navigation/preservedQueryManager'\nimport { PRESERVED_QUERY_NAMESPACES } from '@/platform/navigation/preservedQueryNamespaces'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\n\nimport { useTemplateWorkflows } from './useTemplateWorkflows'\n\n/**\n * Composable for loading templates from URL query parameters\n *\n * Supports URLs like:\n * - /?template=flux_simple (loads with default source)\n * - /?template=flux_simple&source=custom (loads from custom source)\n * - /?template=flux_simple&mode=linear (loads template in linear mode)\n *\n * Input validation:\n * - Template, source, and mode parameters must match: ^[a-zA-Z0-9_-]+$\n * - Invalid formats are rejected with console warnings\n */\nexport function useTemplateUrlLoader() {\n  const route = useRoute()\n  const router = useRouter()\n  const { t } = useI18n()\n  const toast = useToast()\n  const templateWorkflows = useTemplateWorkflows()\n  const canvasStore = useCanvasStore()\n  const TEMPLATE_NAMESPACE = PRESERVED_QUERY_NAMESPACES.TEMPLATE\n  const SUPPORTED_MODES = ['linear'] as const\n  type SupportedMode = (typeof SUPPORTED_MODES)[number]\n\n  /**\n   * Validates parameter format to prevent path traversal and injection attacks\n   * Allows: letters, numbers, underscores, hyphens, and dots (for version numbers)\n   * Blocks: path separators (/, \\), special chars that could enable injection\n   */\n  const isValidParameter = (param: string): boolean => {\n    return /^[a-zA-Z0-9_.-]+$/.test(param)\n  }\n\n  /**\n   * Type guard to check if a value is a supported mode\n   */\n  const isSupportedMode = (mode: string): mode is SupportedMode => {\n    return SUPPORTED_MODES.includes(mode as SupportedMode)\n  }\n\n  /**\n   * Removes template, source, and mode parameters from URL\n   */\n  const cleanupUrlParams = () => {\n    const newQuery = { ...route.query }\n    delete newQuery.template\n    delete newQuery.source\n    delete newQuery.mode\n    void router.replace({ query: newQuery })\n  }\n\n  /**\n   * Loads template from URL query parameters if present\n   * Handles errors internally and shows appropriate user feedback\n   */\n  const loadTemplateFromUrl = async () => {\n    const templateParam = route.query.template\n\n    if (!templateParam || typeof templateParam !== 'string') {\n      return\n    }\n\n    if (!isValidParameter(templateParam)) {\n      console.warn(\n        `[useTemplateUrlLoader] Invalid template parameter format: ${templateParam}`\n      )\n      return\n    }\n\n    const sourceParam = (route.query.source as string | undefined) || 'default'\n\n    if (!isValidParameter(sourceParam)) {\n      console.warn(\n        `[useTemplateUrlLoader] Invalid source parameter format: ${sourceParam}`\n      )\n      return\n    }\n\n    const modeParam = route.query.mode as string | undefined\n\n    if (\n      modeParam &&\n      (typeof modeParam !== 'string' || !isValidParameter(modeParam))\n    ) {\n      console.warn(\n        `[useTemplateUrlLoader] Invalid mode parameter format: ${modeParam}`\n      )\n      return\n    }\n\n    if (modeParam && !isSupportedMode(modeParam)) {\n      console.warn(\n        `[useTemplateUrlLoader] Unsupported mode parameter: ${modeParam}. Supported modes: ${SUPPORTED_MODES.join(', ')}`\n      )\n    }\n\n    try {\n      await templateWorkflows.loadTemplates()\n\n      const success = await templateWorkflows.loadWorkflowTemplate(\n        templateParam,\n        sourceParam\n      )\n\n      if (!success) {\n        toast.add({\n          severity: 'error',\n          summary: t('g.error'),\n          detail: t('templateWorkflows.error.templateNotFound', {\n            templateName: templateParam\n          }),\n          life: 3000\n        })\n      } else if (modeParam === 'linear') {\n        // Set linear mode after successful template load\n        canvasStore.linearMode = true\n      }\n    } catch (error) {\n      console.error(\n        '[useTemplateUrlLoader] Failed to load template from URL:',\n        error\n      )\n      toast.add({\n        severity: 'error',\n        summary: t('g.error'),\n        detail: t('g.errorLoadingTemplate'),\n        life: 3000\n      })\n    } finally {\n      cleanupUrlParams()\n      clearPreservedQuery(TEMPLATE_NAMESPACE)\n    }\n  }\n\n  return {\n    loadTemplateFromUrl\n  }\n}\n","import { tryOnScopeDispose } from '@vueuse/core'\nimport { computed, watch } from 'vue'\nimport { useRoute, useRouter } from 'vue-router'\n\nimport {\n  hydratePreservedQuery,\n  mergePreservedQueryIntoQuery\n} from '@/platform/navigation/preservedQueryManager'\nimport { PRESERVED_QUERY_NAMESPACES } from '@/platform/navigation/preservedQueryNamespaces'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useWorkflowService } from '@/platform/workflow/core/services/workflowService'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { useTemplateUrlLoader } from '@/platform/workflow/templates/composables/useTemplateUrlLoader'\nimport { api } from '@/scripts/api'\nimport { app as comfyApp } from '@/scripts/app'\nimport { getStorageValue, setStorageValue } from '@/scripts/utils'\nimport { useCommandStore } from '@/stores/commandStore'\n\nexport function useWorkflowPersistence() {\n  const workflowStore = useWorkflowStore()\n  const settingStore = useSettingStore()\n  const route = useRoute()\n  const router = useRouter()\n  const templateUrlLoader = useTemplateUrlLoader()\n  const TEMPLATE_NAMESPACE = PRESERVED_QUERY_NAMESPACES.TEMPLATE\n\n  const ensureTemplateQueryFromIntent = async () => {\n    hydratePreservedQuery(TEMPLATE_NAMESPACE)\n    const mergedQuery = mergePreservedQueryIntoQuery(\n      TEMPLATE_NAMESPACE,\n      route.query\n    )\n\n    if (mergedQuery) {\n      await router.replace({ query: mergedQuery })\n    }\n\n    return mergedQuery ?? route.query\n  }\n\n  const workflowPersistenceEnabled = computed(() =>\n    settingStore.get('Comfy.Workflow.Persist')\n  )\n\n  const persistCurrentWorkflow = () => {\n    if (!workflowPersistenceEnabled.value) return\n    const workflow = JSON.stringify(comfyApp.rootGraph.serialize())\n\n    try {\n      localStorage.setItem('workflow', workflow)\n      if (api.clientId) {\n        sessionStorage.setItem(`workflow:${api.clientId}`, workflow)\n      }\n    } catch (error) {\n      // Only log our own keys and aggregate stats\n      const ourKeys = Object.keys(sessionStorage).filter(\n        (key) => key.startsWith('workflow:') || key === 'workflow'\n      )\n      console.error('QuotaExceededError details:', {\n        workflowSizeKB: Math.round(workflow.length / 1024),\n        totalStorageItems: Object.keys(sessionStorage).length,\n        ourWorkflowKeys: ourKeys.length,\n        ourWorkflowSizes: ourKeys.map((key) => ({\n          key,\n          sizeKB: Math.round(sessionStorage[key].length / 1024)\n        })),\n        error: error instanceof Error ? error.message : String(error)\n      })\n      throw error\n    }\n  }\n\n  const loadWorkflowFromStorage = async (\n    json: string | null,\n    workflowName: string | null\n  ) => {\n    if (!json) return false\n    const workflow = JSON.parse(json)\n    await comfyApp.loadGraphData(workflow, true, true, workflowName)\n    return true\n  }\n\n  const loadPreviousWorkflowFromStorage = async () => {\n    const workflowName = getStorageValue('Comfy.PreviousWorkflow')\n    const clientId = api.initialClientId ?? api.clientId\n\n    // Try loading from session storage first\n    if (clientId) {\n      const sessionWorkflow = sessionStorage.getItem(`workflow:${clientId}`)\n      if (await loadWorkflowFromStorage(sessionWorkflow, workflowName)) {\n        return true\n      }\n    }\n\n    // Fall back to local storage\n    const localWorkflow = localStorage.getItem('workflow')\n    return await loadWorkflowFromStorage(localWorkflow, workflowName)\n  }\n\n  const loadDefaultWorkflow = async () => {\n    if (!settingStore.get('Comfy.TutorialCompleted')) {\n      await settingStore.set('Comfy.TutorialCompleted', true)\n      await useWorkflowService().loadBlankWorkflow()\n      await useCommandStore().execute('Comfy.BrowseTemplates')\n    } else {\n      await comfyApp.loadGraphData()\n    }\n  }\n\n  const initializeWorkflow = async () => {\n    if (!workflowPersistenceEnabled.value) return\n\n    try {\n      const restored = await loadPreviousWorkflowFromStorage()\n      if (!restored) {\n        await loadDefaultWorkflow()\n      }\n    } catch (err) {\n      console.error('Error loading previous workflow', err)\n      await loadDefaultWorkflow()\n    }\n  }\n\n  const loadTemplateFromUrlIfPresent = async () => {\n    const query = await ensureTemplateQueryFromIntent()\n    const hasTemplateUrl = query.template && typeof query.template === 'string'\n\n    if (hasTemplateUrl) {\n      await templateUrlLoader.loadTemplateFromUrl()\n    }\n  }\n\n  // Setup watchers\n  watch(\n    () => workflowStore.activeWorkflow?.key,\n    (activeWorkflowKey) => {\n      if (!activeWorkflowKey) return\n      setStorageValue('Comfy.PreviousWorkflow', activeWorkflowKey)\n      // When the activeWorkflow changes, the graph has already been loaded.\n      // Saving the current state of the graph to the localStorage.\n      persistCurrentWorkflow()\n    }\n  )\n  api.addEventListener('graphChanged', persistCurrentWorkflow)\n\n  // Clean up event listener when component unmounts\n  tryOnScopeDispose(() => {\n    api.removeEventListener('graphChanged', persistCurrentWorkflow)\n  })\n\n  // Restore workflow tabs states\n  const openWorkflows = computed(() => workflowStore.openWorkflows)\n  const activeWorkflow = computed(() => workflowStore.activeWorkflow)\n  const restoreState = computed<{ paths: string[]; activeIndex: number }>(\n    () => {\n      if (!openWorkflows.value || !activeWorkflow.value) {\n        return { paths: [], activeIndex: -1 }\n      }\n\n      const paths = openWorkflows.value\n        .filter((workflow) => workflow?.isPersisted)\n        .map((workflow) => workflow.path)\n      const activeIndex = openWorkflows.value.findIndex(\n        (workflow) => workflow.path === activeWorkflow.value?.path\n      )\n\n      return { paths, activeIndex }\n    }\n  )\n\n  // Get storage values before setting watchers\n  const storedWorkflows = JSON.parse(\n    getStorageValue('Comfy.OpenWorkflowsPaths') || '[]'\n  )\n  const storedActiveIndex = JSON.parse(\n    getStorageValue('Comfy.ActiveWorkflowIndex') || '-1'\n  )\n\n  watch(restoreState, ({ paths, activeIndex }) => {\n    if (workflowPersistenceEnabled.value) {\n      setStorageValue('Comfy.OpenWorkflowsPaths', JSON.stringify(paths))\n      setStorageValue('Comfy.ActiveWorkflowIndex', JSON.stringify(activeIndex))\n    }\n  })\n\n  const restoreWorkflowTabsState = () => {\n    if (!workflowPersistenceEnabled.value) return\n    const isRestorable = storedWorkflows?.length > 0 && storedActiveIndex >= 0\n    if (isRestorable) {\n      workflowStore.openWorkflowsInBackground({\n        left: storedWorkflows.slice(0, storedActiveIndex),\n        right: storedWorkflows.slice(storedActiveIndex)\n      })\n    }\n  }\n\n  return {\n    initializeWorkflow,\n    loadTemplateFromUrlIfPresent,\n    restoreWorkflowTabsState\n  }\n}\n","import { useDebounceFn, useEventListener } from '@vueuse/core'\nimport { ref } from 'vue'\nimport type { MaybeRefOrGetter } from 'vue'\n\ninterface TransformSettlingOptions {\n  /**\n   * Delay in ms before transform is considered \"settled\" after last interaction\n   * @default 200\n   */\n  settleDelay?: number\n  /**\n   * Whether to use passive event listeners (better performance but can't preventDefault)\n   * @default true\n   */\n  passive?: boolean\n}\n\n/**\n * Tracks when canvas zoom transforms are actively changing vs settled.\n *\n * This composable helps optimize rendering quality during zoom transformations.\n * When the user is actively zooming, we can reduce rendering quality\n * for better performance. Once the transform \"settles\" (stops changing), we can\n * trigger high-quality re-rasterization.\n *\n * The settling concept prevents constant quality switching during interactions\n * by waiting for a period of inactivity before considering the transform complete.\n *\n * Uses VueUse's useEventListener for automatic cleanup and useDebounceFn for\n * efficient settle detection.\n *\n * @example\n * ```ts\n * const { isTransforming } = useTransformSettling(canvasRef, {\n *   settleDelay: 200\n * })\n *\n * // Use in CSS classes or rendering logic\n * const cssClass = computed(() => ({\n *   'low-quality': isTransforming.value,\n *   'high-quality': !isTransforming.value\n * }))\n * ```\n */\nexport function useTransformSettling(\n  target: MaybeRefOrGetter<HTMLElement | null | undefined>,\n  options: TransformSettlingOptions = {}\n) {\n  const { settleDelay = 256, passive = true } = options\n\n  const isTransforming = ref(false)\n\n  /**\n   * Mark transform as active\n   */\n  const markTransformActive = () => {\n    isTransforming.value = true\n  }\n\n  /**\n   * Mark transform as settled (debounced)\n   */\n  const markTransformSettled = useDebounceFn(() => {\n    isTransforming.value = false\n  }, settleDelay)\n\n  /**\n   * Handle zoom transform event - mark active then queue settle\n   */\n  const handleWheel = () => {\n    markTransformActive()\n    void markTransformSettled()\n  }\n\n  // Register wheel event listener with auto-cleanup\n  useEventListener(target, 'wheel', handleWheel, {\n    capture: true,\n    passive\n  })\n\n  return {\n    isTransforming\n  }\n}\n","/**\n * Composable for managing transform state synchronized with LiteGraph canvas\n *\n * This composable is a critical part of the hybrid rendering architecture that\n * allows Vue components to render in perfect alignment with LiteGraph's canvas.\n *\n * ## Core Concept\n *\n * LiteGraph uses a canvas for rendering connections, grid, and handling interactions.\n * Vue components need to render nodes on top of this canvas. The challenge is\n * synchronizing the coordinate systems:\n *\n * - LiteGraph: Uses canvas coordinates with its own transform matrix\n * - Vue/DOM: Uses screen coordinates with CSS transforms\n *\n * ## Solution: Transform Container Pattern\n *\n * Instead of transforming individual nodes (O(n) complexity), we:\n * 1. Mirror LiteGraph's transform matrix to a single CSS container\n * 2. Place all Vue nodes as children with simple absolute positioning\n * 3. Achieve O(1) transform updates regardless of node count\n *\n * ## Coordinate Systems\n *\n * - **Canvas coordinates**: LiteGraph's internal coordinate system\n * - **Screen coordinates**: Browser's viewport coordinate system\n * - **Transform sync**: camera.x/y/z mirrors canvas.ds.offset/scale\n *\n * ## Performance Benefits\n *\n * - GPU acceleration via CSS transforms\n * - No layout thrashing (only transform changes)\n * - Efficient viewport culling calculations\n * - Scales to 1000+ nodes while maintaining 60 FPS\n *\n * @example\n * ```typescript\n * const { camera, transformStyle, canvasToScreen } = useTransformState()\n *\n * // In template\n * <div :style=\"transformStyle\">\n *   <NodeComponent\n *     v-for=\"node in nodes\"\n *     :style=\"{ left: node.x + 'px', top: node.y + 'px' }\"\n *   />\n * </div>\n *\n * // Convert coordinates\n * const screenPos = canvasToScreen({ x: nodeX, y: nodeY })\n * ```\n */\nimport { computed, reactive, readonly } from 'vue'\n\nimport type { LGraphCanvas } from '@/lib/litegraph/src/litegraph'\nimport { createSharedComposable } from '@vueuse/core'\n\ninterface Point {\n  x: number\n  y: number\n}\n\ninterface Camera {\n  x: number\n  y: number\n  z: number // scale/zoom\n}\n\nfunction useTransformStateIndividual() {\n  // Reactive state mirroring LiteGraph's canvas transform\n  const camera = reactive<Camera>({\n    x: 0,\n    y: 0,\n    z: 1\n  })\n\n  // Computed transform string for CSS\n  const transformStyle = computed(() => ({\n    // Match LiteGraph DragAndScale.toCanvasContext():\n    // ctx.scale(scale); ctx.translate(offset)\n    // CSS applies right-to-left, so \"scale() translate()\" -> translate first, then scale\n    // Effective mapping: screen = (canvas + offset) * scale\n    transform: `scale(${camera.z}) translate(${camera.x}px, ${camera.y}px)`,\n    transformOrigin: '0 0'\n  }))\n\n  /**\n   * Synchronizes Vue's reactive camera state with LiteGraph's canvas transform\n   *\n   * Called every frame via RAF to ensure Vue components stay aligned with canvas.\n   * This is the heart of the hybrid rendering system - it bridges the gap between\n   * LiteGraph's canvas transforms and Vue's reactive system.\n   *\n   * @param canvas - LiteGraph canvas instance with DragAndScale (ds) transform state\n   */\n  function syncWithCanvas(canvas: LGraphCanvas) {\n    if (!canvas || !canvas.ds) return\n\n    // Mirror LiteGraph's transform state to Vue's reactive state\n    // ds.offset = pan offset, ds.scale = zoom level\n    camera.x = canvas.ds.offset[0]\n    camera.y = canvas.ds.offset[1]\n    camera.z = canvas.ds.scale || 1\n  }\n\n  /**\n   * Converts canvas coordinates to screen coordinates\n   *\n   * Applies the same transform that LiteGraph uses for rendering.\n   * Essential for positioning Vue components to align with canvas elements.\n   *\n   * Formula: screen = (canvas + offset) * scale\n   *\n   * @param point - Point in canvas coordinate system\n   * @returns Point in screen coordinate system\n   */\n  function canvasToScreen(point: Point): Point {\n    return {\n      x: (point.x + camera.x) * camera.z,\n      y: (point.y + camera.y) * camera.z\n    }\n  }\n\n  /**\n   * Converts screen coordinates to canvas coordinates\n   *\n   * Inverse of canvasToScreen. Useful for hit testing and converting\n   * mouse events back to canvas space.\n   *\n   * Formula: canvas = screen / scale - offset\n   *\n   * @param point - Point in screen coordinate system\n   * @returns Point in canvas coordinate system\n   */\n  const screenToCanvas = (point: Point): Point => {\n    return {\n      x: point.x / camera.z - camera.x,\n      y: point.y / camera.z - camera.y\n    }\n  }\n\n  // Get node's screen bounds for culling\n  function getNodeScreenBounds(\n    pos: [number, number],\n    size: [number, number]\n  ): DOMRect {\n    const topLeft = canvasToScreen({ x: pos[0], y: pos[1] })\n    const width = size[0] * camera.z\n    const height = size[1] * camera.z\n\n    return new DOMRect(topLeft.x, topLeft.y, width, height)\n  }\n\n  // Helper: Calculate zoom-adjusted margin for viewport culling\n  function calculateAdjustedMargin(baseMargin: number): number {\n    if (camera.z < 0.1) return Math.min(baseMargin * 5, 2.0)\n    if (camera.z > 3.0) return Math.max(baseMargin * 0.5, 0.05)\n    return baseMargin\n  }\n\n  // Helper: Check if node is too small to be visible at current zoom\n  function isNodeTooSmall(nodeSize: [number, number]): boolean {\n    const nodeScreenSize = Math.max(nodeSize[0], nodeSize[1]) * camera.z\n    return nodeScreenSize < 4\n  }\n\n  // Helper: Calculate expanded viewport bounds with margin\n  function getExpandedViewportBounds(\n    viewport: { width: number; height: number },\n    margin: number\n  ) {\n    const marginX = viewport.width * margin\n    const marginY = viewport.height * margin\n    return {\n      left: -marginX,\n      right: viewport.width + marginX,\n      top: -marginY,\n      bottom: viewport.height + marginY\n    }\n  }\n\n  // Helper: Test if node intersects with viewport bounds\n  function testViewportIntersection(\n    screenPos: { x: number; y: number },\n    nodeSize: [number, number],\n    bounds: { left: number; right: number; top: number; bottom: number }\n  ): boolean {\n    const nodeRight = screenPos.x + nodeSize[0] * camera.z\n    const nodeBottom = screenPos.y + nodeSize[1] * camera.z\n\n    return !(\n      nodeRight < bounds.left ||\n      screenPos.x > bounds.right ||\n      nodeBottom < bounds.top ||\n      screenPos.y > bounds.bottom\n    )\n  }\n\n  // Check if node is within viewport with frustum and size-based culling\n  function isNodeInViewport(\n    nodePos: [number, number],\n    nodeSize: [number, number],\n    viewport: { width: number; height: number },\n    margin: number = 0.2\n  ): boolean {\n    // Early exit for tiny nodes\n    if (isNodeTooSmall(nodeSize)) return false\n\n    const screenPos = canvasToScreen({ x: nodePos[0], y: nodePos[1] })\n    const adjustedMargin = calculateAdjustedMargin(margin)\n    const bounds = getExpandedViewportBounds(viewport, adjustedMargin)\n\n    return testViewportIntersection(screenPos, nodeSize, bounds)\n  }\n\n  // Get viewport bounds in canvas coordinates (for spatial index queries)\n  function getViewportBounds(\n    viewport: { width: number; height: number },\n    margin: number = 0.2\n  ) {\n    const marginX = viewport.width * margin\n    const marginY = viewport.height * margin\n\n    const topLeft = screenToCanvas({ x: -marginX, y: -marginY })\n    const bottomRight = screenToCanvas({\n      x: viewport.width + marginX,\n      y: viewport.height + marginY\n    })\n\n    return {\n      x: topLeft.x,\n      y: topLeft.y,\n      width: bottomRight.x - topLeft.x,\n      height: bottomRight.y - topLeft.y\n    }\n  }\n\n  return {\n    camera: readonly(camera),\n    transformStyle,\n    syncWithCanvas,\n    canvasToScreen,\n    screenToCanvas,\n    getNodeScreenBounds,\n    isNodeInViewport,\n    getViewportBounds\n  }\n}\n\nexport const useTransformState = createSharedComposable(\n  useTransformStateIndividual\n)\n","<template>\n  <div\n    data-testid=\"transform-pane\"\n    :class=\"\n      cn(\n        'absolute inset-0 w-full h-full pointer-events-none',\n        isInteracting ? 'transform-pane--interacting' : 'will-change-auto'\n      )\n    \"\n    :style=\"transformStyle\"\n  >\n    <!-- Vue nodes will be rendered here -->\n    <slot />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useRafFn } from '@vueuse/core'\nimport { computed } from 'vue'\n\nimport type { LGraphCanvas } from '@/lib/litegraph/src/litegraph'\nimport { useTransformSettling } from '@/renderer/core/layout/transform/useTransformSettling'\nimport { useTransformState } from '@/renderer/core/layout/transform/useTransformState'\nimport { cn } from '@/utils/tailwindUtil'\n\ninterface TransformPaneProps {\n  canvas?: LGraphCanvas\n}\n\nconst props = defineProps<TransformPaneProps>()\n\nconst { transformStyle, syncWithCanvas } = useTransformState()\n\nconst canvasElement = computed(() => props.canvas?.canvas)\nconst { isTransforming: isInteracting } = useTransformSettling(canvasElement, {\n  settleDelay: 16\n})\n\nuseRafFn(\n  () => {\n    if (!props.canvas) {\n      return\n    }\n    syncWithCanvas(props.canvas)\n  },\n  { immediate: true }\n)\n</script>\n\n<style scoped>\n.transform-pane--interacting {\n  will-change: transform;\n}\n</style>\n","<template>\n  <div\n    v-if=\"visible && initialized\"\n    ref=\"minimapRef\"\n    class=\"minimap-main-container absolute right-0 bottom-[54px] z-1000 flex\"\n  >\n    <MiniMapPanel\n      v-if=\"showOptionsPanel\"\n      :panel-styles=\"panelStyles\"\n      :node-colors=\"nodeColors\"\n      :show-links=\"showLinks\"\n      :show-groups=\"showGroups\"\n      :render-bypass=\"renderBypass\"\n      :render-error=\"renderError\"\n      @update-option=\"updateOption\"\n    />\n\n    <div\n      ref=\"containerRef\"\n      class=\"litegraph-minimap relative border border-interface-stroke bg-comfy-menu-bg shadow-interface\"\n      :style=\"containerStyles\"\n    >\n      <Button\n        class=\"absolute top-0 left-0 z-10\"\n        size=\"icon\"\n        variant=\"muted-textonly\"\n        :aria-label=\"$t('g.settings')\"\n        @click.stop=\"toggleOptionsPanel\"\n      >\n        <i class=\"icon-[lucide--settings-2]\" />\n      </Button>\n      <Button\n        class=\"absolute top-0 right-0 z-10\"\n        size=\"icon\"\n        variant=\"muted-textonly\"\n        :aria-label=\"$t('g.close')\"\n        data-testid=\"close-minmap-button\"\n        @click.stop=\"() => commandStore.execute('Comfy.Canvas.ToggleMinimap')\"\n      >\n        <i class=\"icon-[lucide--x]\" />\n      </Button>\n\n      <hr\n        class=\"absolute top-6 h-px border-0 bg-node-component-border\"\n        :style=\"{\n          width: containerStyles.width\n        }\"\n      />\n\n      <canvas\n        ref=\"canvasRef\"\n        :width=\"width\"\n        :height=\"height\"\n        class=\"minimap-canvas\"\n      />\n\n      <div class=\"minimap-viewport\" :style=\"viewportStyles\" />\n\n      <div\n        class=\"absolute inset-0 touch-none\"\n        @pointerdown=\"handlePointerDown\"\n        @pointermove=\"handlePointerMove\"\n        @pointerup=\"handlePointerUp\"\n        @pointerleave=\"handlePointerUp\"\n        @pointercancel=\"handlePointerCancel\"\n        @wheel=\"handleWheel\"\n      />\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { onMounted, onUnmounted, ref, useTemplateRef } from 'vue'\n\nimport Button from '@/components/ui/button/Button.vue'\nimport { useMinimap } from '@/renderer/extensions/minimap/composables/useMinimap'\nimport { useCommandStore } from '@/stores/commandStore'\n\nimport MiniMapPanel from './MiniMapPanel.vue'\n\nconst commandStore = useCommandStore()\nconst minimapRef = ref<HTMLDivElement>()\nconst containerRef = useTemplateRef<HTMLDivElement>('containerRef')\nconst canvasRef = useTemplateRef<HTMLCanvasElement>('canvasRef')\n\nconst {\n  initialized,\n  visible,\n  containerStyles,\n  viewportStyles,\n  width,\n  height,\n  panelStyles,\n  nodeColors,\n  showLinks,\n  showGroups,\n  renderBypass,\n  renderError,\n  updateOption,\n  destroy,\n  handlePointerDown,\n  handlePointerMove,\n  handlePointerUp,\n  handlePointerCancel,\n  handleWheel,\n  setMinimapRef\n} = useMinimap({\n  containerRefMaybe: containerRef,\n  canvasRefMaybe: canvasRef\n})\n\nconst showOptionsPanel = ref(false)\n\nconst toggleOptionsPanel = () => {\n  showOptionsPanel.value = !showOptionsPanel.value\n}\n\nonMounted(() => {\n  if (minimapRef.value) {\n    setMinimapRef(minimapRef.value)\n  }\n})\n\nonUnmounted(() => {\n  destroy()\n})\n</script>\n\n<style scoped>\n.litegraph-minimap {\n  overflow: hidden;\n}\n\n.minimap-canvas {\n  display: block;\n  width: 100%;\n  height: 100%;\n  pointer-events: none;\n}\n\n.minimap-viewport {\n  position: absolute;\n  top: 0;\n  left: 0;\n  pointer-events: none;\n}\n</style>\n","/**\n * Checks if a pointer/mouse event has multi-select modifier keys pressed.\n * Multi-select keys are: Ctrl (Windows/Linux), Cmd (Mac), or Shift\n *\n * @param event - The pointer or mouse event to check\n * @returns true if any multi-select modifier key is pressed\n */\nexport function isMultiSelectKey(event: PointerEvent | MouseEvent): boolean {\n  return event.ctrlKey || event.metaKey || event.shiftKey\n}\n","/**\n * Node Event Handlers Composable\n *\n * Handles all Vue node interaction events including:\n * - Node selection with multi-select support\n * - Node collapse/expand state management\n * - Node title editing and updates\n * - Layout mutations for visual feedback\n * - Integration with LiteGraph canvas selection system\n */\nimport { createSharedComposable } from '@vueuse/core'\n\nimport { useVueNodeLifecycle } from '@/composables/graph/useVueNodeLifecycle'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useCanvasInteractions } from '@/renderer/core/canvas/useCanvasInteractions'\nimport { useNodeZIndex } from '@/renderer/extensions/vueNodes/composables/useNodeZIndex'\nimport { isMultiSelectKey } from '@/renderer/extensions/vueNodes/utils/selectionUtils'\nimport type { NodeId } from '@/renderer/core/layout/types'\n\nfunction useNodeEventHandlersIndividual() {\n  const canvasStore = useCanvasStore()\n  const { nodeManager } = useVueNodeLifecycle()\n  const { bringNodeToFront } = useNodeZIndex()\n  const { shouldHandleNodePointerEvents } = useCanvasInteractions()\n\n  /**\n   * Handle node selection events\n   * Supports single selection and multi-select with Ctrl/Cmd\n   */\n  function handleNodeSelect(event: PointerEvent, nodeId: NodeId) {\n    if (!shouldHandleNodePointerEvents.value) return\n\n    if (!canvasStore.canvas || !nodeManager.value) return\n\n    const node = nodeManager.value.getNode(nodeId)\n    if (!node) return\n\n    const multiSelect = isMultiSelectKey(event)\n    const selectedItemsCount = canvasStore.selectedItems.length\n    const preserveExistingSelection =\n      !multiSelect && node.selected && selectedItemsCount > 1\n\n    if (multiSelect) {\n      if (!node.selected) {\n        canvasStore.canvas.select(node)\n      }\n    } else if (!preserveExistingSelection) {\n      // Regular click -> single select\n      canvasStore.canvas.deselectAll()\n      canvasStore.canvas.select(node)\n    }\n\n    // Bring node to front when clicked (similar to LiteGraph behavior)\n    // Skip if node is pinned to avoid unwanted movement\n    if (!node.flags?.pinned) {\n      bringNodeToFront(nodeId)\n    }\n\n    // Update canvas selection tracking\n    canvasStore.updateSelectedItems()\n  }\n\n  /**\n   * Handle node collapse/expand state changes\n   * Uses LiteGraph's native collapse method for proper state management\n   */\n  function handleNodeCollapse(nodeId: NodeId, collapsed: boolean) {\n    if (!shouldHandleNodePointerEvents.value) return\n\n    if (!nodeManager.value) return\n\n    const node = nodeManager.value.getNode(nodeId)\n    if (!node) return\n\n    // Use LiteGraph's collapse method if the state needs to change\n    const currentCollapsed = node.flags?.collapsed ?? false\n    if (currentCollapsed !== collapsed) {\n      node.collapse()\n    }\n  }\n\n  /**\n   * Handle node title updates\n   * Updates the title in LiteGraph for persistence across sessions\n   */\n  function handleNodeTitleUpdate(nodeId: NodeId, newTitle: string) {\n    if (!shouldHandleNodePointerEvents.value) return\n\n    if (!nodeManager.value) return\n\n    const node = nodeManager.value.getNode(nodeId)\n    if (!node) return\n\n    // Update the node title in LiteGraph for persistence\n    node.title = newTitle\n  }\n\n  /**\n   * Handle node right-click context menu events\n   * Integrates with LiteGraph's context menu system\n   */\n  function handleNodeRightClick(event: PointerEvent, nodeId: NodeId) {\n    if (!shouldHandleNodePointerEvents.value) return\n\n    if (!canvasStore.canvas || !nodeManager.value) return\n\n    const node = nodeManager.value.getNode(nodeId)\n    if (!node) return\n\n    // Prevent default context menu\n    event.preventDefault()\n\n    // Select the node if not already selected\n    if (!node.selected) {\n      handleNodeSelect(event, nodeId)\n    }\n\n    // Let LiteGraph handle the context menu\n    // The canvas will handle showing the appropriate context menu\n  }\n\n  function toggleNodeSelectionAfterPointerUp(\n    nodeId: NodeId,\n    multiSelect: boolean\n  ) {\n    if (!shouldHandleNodePointerEvents.value) return\n\n    if (!canvasStore.canvas || !nodeManager.value) return\n\n    const node = nodeManager.value.getNode(nodeId)\n    if (!node) return\n\n    if (!multiSelect) {\n      canvasStore.canvas.deselectAll()\n      canvasStore.canvas.select(node)\n      canvasStore.updateSelectedItems()\n      // Bring node to front when selected (unless pinned)\n      if (!node.flags?.pinned) {\n        bringNodeToFront(nodeId)\n      }\n      return\n    }\n\n    if (node.selected) {\n      canvasStore.canvas.deselect(node)\n    } else {\n      canvasStore.canvas.select(node)\n      // Bring node to front when selected (unless pinned)\n      if (!node.flags?.pinned) {\n        bringNodeToFront(nodeId)\n      }\n    }\n\n    canvasStore.updateSelectedItems()\n  }\n\n  return {\n    // Core event handlers\n    handleNodeSelect,\n    handleNodeCollapse,\n    handleNodeTitleUpdate,\n    handleNodeRightClick,\n\n    // Batch operations\n    toggleNodeSelectionAfterPointerUp\n  }\n}\n\nexport const useNodeEventHandlers = createSharedComposable(\n  useNodeEventHandlersIndividual\n)\n","import { computed } from 'vue'\n\nimport { snapPoint } from '@/lib/litegraph/src/measure'\nimport { useSettingStore } from '@/platform/settings/settingStore'\n\n/**\n * Composable for node snap-to-grid functionality\n *\n * Provides reactive access to snap settings and utilities for applying\n * snap-to-grid behavior to Vue nodes during drag and resize operations.\n */\nexport function useNodeSnap() {\n  const settingStore = useSettingStore()\n\n  // Reactive snap settings\n  const gridSize = computed(() => settingStore.get('Comfy.SnapToGrid.GridSize'))\n  const alwaysSnap = computed(() => settingStore.get('pysssss.SnapToGrid'))\n\n  /**\n   * Determines if snap-to-grid should be applied based on shift key and settings\n   * @param event - The pointer event to check for shift key\n   * @returns true if snapping should be applied\n   */\n  function shouldSnap(event: PointerEvent): boolean {\n    return event.shiftKey || alwaysSnap.value\n  }\n\n  /**\n   * Applies snap-to-grid to a position\n   * @param position - Position object with x, y coordinates\n   * @returns The snapped position as a new object\n   */\n  function applySnapToPosition(position: { x: number; y: number }): {\n    x: number\n    y: number\n  } {\n    const size = gridSize.value\n    if (!size) return { ...position }\n\n    const posArray: [number, number] = [position.x, position.y]\n    if (snapPoint(posArray, size)) {\n      return { x: posArray[0], y: posArray[1] }\n    }\n    return { ...position }\n  }\n\n  /**\n   * Applies snap-to-grid to a size (width/height)\n   * @param size - Size object with width, height\n   * @returns The snapped size as a new object\n   */\n  function applySnapToSize(size: { width: number; height: number }): {\n    width: number\n    height: number\n  } {\n    const gridSizeValue = gridSize.value\n    if (!gridSizeValue) return { ...size }\n\n    const sizeArray: [number, number] = [size.width, size.height]\n    if (snapPoint(sizeArray, gridSizeValue)) {\n      return { width: sizeArray[0], height: sizeArray[1] }\n    }\n    return { ...size }\n  }\n\n  return {\n    gridSize,\n    alwaysSnap,\n    shouldSnap,\n    applySnapToPosition,\n    applySnapToSize\n  }\n}\n","import { tryOnScopeDispose, useEventListener } from '@vueuse/core'\nimport { shallowRef } from 'vue'\n\nimport { app } from '@/scripts/app'\n\n/**\n * Composable for synchronizing shift key state from Vue nodes to LiteGraph canvas.\n *\n * Enables snap-to-grid preview rendering in LiteGraph during Vue node drag/resize operations\n * by dispatching synthetic keyboard events to the canvas element.\n *\n * @returns Object containing trackShiftKey function for shift state synchronization lifecycle\n *\n * @example\n * ```ts\n * const { trackShiftKey } = useShiftKeySync()\n *\n * function startDrag(event: PointerEvent) {\n *   const stopTracking = trackShiftKey(event)\n *   // ... drag logic\n *   // Call stopTracking() on pointerup to cleanup listeners\n * }\n * ```\n */\nexport function useShiftKeySync() {\n  const shiftKeyState = shallowRef(false)\n  let canvasEl: HTMLCanvasElement | null = null\n\n  /**\n   * Synchronizes shift key state to LiteGraph canvas by dispatching synthetic keyboard events.\n   *\n   * Only dispatches events when shift state actually changes to minimize overhead.\n   * Canvas reference is lazily initialized on first sync.\n   *\n   * @param isShiftPressed - Current shift key state to synchronize\n   */\n  function syncShiftState(isShiftPressed: boolean) {\n    if (isShiftPressed === shiftKeyState.value) return\n\n    // Lazy-initialize canvas reference on first use\n    if (!canvasEl) {\n      canvasEl = app.canvas?.canvas ?? null\n      if (!canvasEl) return // Canvas not ready yet\n    }\n\n    shiftKeyState.value = isShiftPressed\n    canvasEl.dispatchEvent(\n      new KeyboardEvent(isShiftPressed ? 'keydown' : 'keyup', {\n        key: 'Shift',\n        shiftKey: isShiftPressed,\n        bubbles: true\n      })\n    )\n  }\n\n  /**\n   * Tracks shift key state during drag/resize operations and synchronizes to canvas.\n   *\n   * Attaches window-level keyboard event listeners for the duration of the operation.\n   * Listeners are automatically cleaned up when the returned function is called.\n   *\n   * @param initialEvent - Initial pointer event containing shift key state at drag/resize start\n   * @returns Cleanup function that removes event listeners - must be called when operation ends\n   *\n   * @example\n   * ```ts\n   * function startDrag(event: PointerEvent) {\n   *   const stopTracking = trackShiftKey(event)\n   *\n   *   const handlePointerUp = () => {\n   *     stopTracking() // Cleanup listeners\n   *   }\n   * }\n   * ```\n   */\n  function trackShiftKey(initialEvent: PointerEvent): () => void {\n    // Sync initial shift state\n    syncShiftState(initialEvent.shiftKey)\n\n    // Listen for shift key press/release during the operation\n    const handleKeyEvent = (e: KeyboardEvent) => {\n      if (e.key !== 'Shift') return\n      syncShiftState(e.shiftKey)\n    }\n\n    const stopKeydown = useEventListener(window, 'keydown', handleKeyEvent, {\n      passive: true\n    })\n    const stopKeyup = useEventListener(window, 'keyup', handleKeyEvent, {\n      passive: true\n    })\n\n    // Return cleanup function that stops both listeners\n    return () => {\n      stopKeydown()\n      stopKeyup()\n    }\n  }\n\n  // Cleanup on component unmount\n  tryOnScopeDispose(() => {\n    shiftKeyState.value = false\n    canvasEl = null\n  })\n\n  return { trackShiftKey }\n}\n","import { storeToRefs } from 'pinia'\nimport { toValue } from 'vue'\n\nimport type { LGraphGroup } from '@/lib/litegraph/src/LGraphGroup'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useLayoutMutations } from '@/renderer/core/layout/operations/layoutMutations'\nimport { layoutStore } from '@/renderer/core/layout/store/layoutStore'\nimport { LayoutSource } from '@/renderer/core/layout/types'\nimport type {\n  NodeBoundsUpdate,\n  NodeId,\n  Point\n} from '@/renderer/core/layout/types'\nimport { useNodeSnap } from '@/renderer/extensions/vueNodes/composables/useNodeSnap'\nimport { useShiftKeySync } from '@/renderer/extensions/vueNodes/composables/useShiftKeySync'\nimport { useTransformState } from '@/renderer/core/layout/transform/useTransformState'\nimport { isLGraphGroup } from '@/utils/litegraphUtil'\nimport { createSharedComposable } from '@vueuse/core'\n\nexport const useNodeDrag = createSharedComposable(useNodeDragIndividual)\n\nfunction useNodeDragIndividual() {\n  const mutations = useLayoutMutations()\n  const { selectedNodeIds, selectedItems } = storeToRefs(useCanvasStore())\n\n  // Get transform utilities from TransformPane if available\n  const transformState = useTransformState()\n\n  // Snap-to-grid functionality\n  const { shouldSnap, applySnapToPosition } = useNodeSnap()\n\n  // Shift key sync for LiteGraph canvas preview\n  const { trackShiftKey } = useShiftKeySync()\n\n  // Drag state\n  let dragStartPos: Point | null = null\n  let dragStartMouse: Point | null = null\n  let otherSelectedNodesStartPositions: Map<string, Point> | null = null\n  let rafId: number | null = null\n  let stopShiftSync: (() => void) | null = null\n\n  // For groups: track the last applied canvas delta to compute frame delta\n  let lastCanvasDelta: Point | null = null\n  let selectedGroups: LGraphGroup[] | null = null\n\n  function startDrag(event: PointerEvent, nodeId: NodeId) {\n    const layout = toValue(layoutStore.getNodeLayoutRef(nodeId))\n    if (!layout) return\n    const position = layout.position ?? { x: 0, y: 0 }\n\n    // Track shift key state and sync to canvas for snap preview\n    stopShiftSync = trackShiftKey(event)\n\n    dragStartPos = { ...position }\n    dragStartMouse = { x: event.clientX, y: event.clientY }\n\n    const selectedNodes = toValue(selectedNodeIds)\n\n    // capture the starting positions of all other selected nodes\n    // Only move other selected items if the dragged node is part of the selection\n    const isDraggedNodeInSelection = selectedNodes?.has(nodeId)\n\n    if (isDraggedNodeInSelection && selectedNodes.size > 1) {\n      otherSelectedNodesStartPositions = new Map()\n\n      for (const id of selectedNodes) {\n        // Skip the current node being dragged\n        if (id === nodeId) continue\n\n        const nodeLayout = layoutStore.getNodeLayoutRef(id).value\n        if (nodeLayout) {\n          otherSelectedNodesStartPositions.set(id, { ...nodeLayout.position })\n        }\n      }\n    } else {\n      otherSelectedNodesStartPositions = null\n    }\n\n    // Capture selected groups only if the dragged node is part of the selection\n    // This prevents groups from moving when dragging an unrelated node\n    if (isDraggedNodeInSelection) {\n      selectedGroups = toValue(selectedItems).filter(isLGraphGroup)\n      lastCanvasDelta = { x: 0, y: 0 }\n    } else {\n      selectedGroups = null\n      lastCanvasDelta = null\n    }\n\n    mutations.setSource(LayoutSource.Vue)\n  }\n\n  function handleDrag(event: PointerEvent, nodeId: NodeId) {\n    if (!dragStartPos || !dragStartMouse) {\n      return\n    }\n\n    // Throttle position updates using requestAnimationFrame for better performance\n    if (rafId !== null) return // Skip if frame already scheduled\n\n    const { target, pointerId } = event\n    if (target instanceof HTMLElement && !target.hasPointerCapture(pointerId)) {\n      // Delay capture to drag to allow for the Node cloning\n      target.setPointerCapture(pointerId)\n    }\n    rafId = requestAnimationFrame(() => {\n      rafId = null\n\n      if (!dragStartPos || !dragStartMouse) return\n\n      // Calculate mouse delta in screen coordinates\n      const mouseDelta = {\n        x: event.clientX - dragStartMouse.x,\n        y: event.clientY - dragStartMouse.y\n      }\n\n      // Convert to canvas coordinates\n      const canvasOrigin = transformState.screenToCanvas({ x: 0, y: 0 })\n      const canvasWithDelta = transformState.screenToCanvas(mouseDelta)\n      const canvasDelta = {\n        x: canvasWithDelta.x - canvasOrigin.x,\n        y: canvasWithDelta.y - canvasOrigin.y\n      }\n\n      // Calculate new position for the current node\n      const newPosition = {\n        x: dragStartPos.x + canvasDelta.x,\n        y: dragStartPos.y + canvasDelta.y\n      }\n\n      // Apply mutation through the layout system (Vue batches DOM updates automatically)\n      mutations.moveNode(nodeId, newPosition)\n\n      // If we're dragging multiple selected nodes, move them all together\n      if (\n        otherSelectedNodesStartPositions &&\n        otherSelectedNodesStartPositions.size > 0\n      ) {\n        for (const [\n          otherNodeId,\n          startPos\n        ] of otherSelectedNodesStartPositions) {\n          const newOtherPosition = {\n            x: startPos.x + canvasDelta.x,\n            y: startPos.y + canvasDelta.y\n          }\n          mutations.moveNode(otherNodeId, newOtherPosition)\n        }\n      }\n\n      // Move selected groups using frame delta (difference from last frame)\n      // This matches LiteGraph's behavior which uses delta-based movement\n      if (selectedGroups && selectedGroups.length > 0 && lastCanvasDelta) {\n        const frameDelta = {\n          x: canvasDelta.x - lastCanvasDelta.x,\n          y: canvasDelta.y - lastCanvasDelta.y\n        }\n\n        for (const group of selectedGroups) {\n          group.move(frameDelta.x, frameDelta.y, true)\n        }\n      }\n\n      lastCanvasDelta = canvasDelta\n    })\n  }\n\n  function endDrag(event: PointerEvent, nodeId: NodeId | undefined) {\n    // Apply snap to final position if snap was active (matches LiteGraph behavior)\n    if (shouldSnap(event) && nodeId) {\n      const boundsUpdates: NodeBoundsUpdate[] = []\n\n      // Snap main node\n      const currentLayout = toValue(layoutStore.getNodeLayoutRef(nodeId))\n      if (currentLayout) {\n        const currentPos = currentLayout.position\n        const snappedPos = applySnapToPosition({ ...currentPos })\n\n        // Only add update if position actually changed\n        if (snappedPos.x !== currentPos.x || snappedPos.y !== currentPos.y) {\n          boundsUpdates.push({\n            nodeId,\n            bounds: {\n              x: snappedPos.x,\n              y: snappedPos.y,\n              width: currentLayout.size.width,\n              height: currentLayout.size.height\n            }\n          })\n        }\n      }\n\n      // Also snap other selected nodes\n      // Capture all positions at the start to ensure consistent state\n      if (\n        otherSelectedNodesStartPositions &&\n        otherSelectedNodesStartPositions.size > 0\n      ) {\n        for (const otherNodeId of otherSelectedNodesStartPositions.keys()) {\n          const nodeLayout = layoutStore.getNodeLayoutRef(otherNodeId).value\n          if (nodeLayout) {\n            const currentPos = { ...nodeLayout.position }\n            const snappedPos = applySnapToPosition(currentPos)\n\n            // Only add update if position actually changed\n            if (\n              snappedPos.x !== currentPos.x ||\n              snappedPos.y !== currentPos.y\n            ) {\n              boundsUpdates.push({\n                nodeId: otherNodeId,\n                bounds: {\n                  x: snappedPos.x,\n                  y: snappedPos.y,\n                  width: nodeLayout.size.width,\n                  height: nodeLayout.size.height\n                }\n              })\n            }\n          }\n        }\n      }\n\n      // Apply all snap updates in a single batched transaction\n      if (boundsUpdates.length > 0) {\n        layoutStore.batchUpdateNodeBounds(boundsUpdates)\n      }\n    }\n\n    dragStartPos = null\n    dragStartMouse = null\n    otherSelectedNodesStartPositions = null\n    selectedGroups = null\n    lastCanvasDelta = null\n\n    // Stop tracking shift key state\n    stopShiftSync?.()\n    stopShiftSync = null\n\n    // Cancel any pending animation frame\n    if (rafId !== null) {\n      cancelAnimationFrame(rafId)\n      rafId = null\n    }\n  }\n\n  return {\n    startDrag,\n    handleDrag,\n    endDrag\n  }\n}\n","import { onScopeDispose, ref, toValue } from 'vue'\nimport type { MaybeRefOrGetter } from 'vue'\n\nimport { isMiddlePointerInput } from '@/base/pointerUtils'\nimport { useVueNodeLifecycle } from '@/composables/graph/useVueNodeLifecycle'\nimport { useCanvasInteractions } from '@/renderer/core/canvas/useCanvasInteractions'\nimport { layoutStore } from '@/renderer/core/layout/store/layoutStore'\nimport { useNodeEventHandlers } from '@/renderer/extensions/vueNodes/composables/useNodeEventHandlers'\nimport { isMultiSelectKey } from '@/renderer/extensions/vueNodes/utils/selectionUtils'\nimport { useNodeDrag } from '@/renderer/extensions/vueNodes/layout/useNodeDrag'\n\nexport function useNodePointerInteractions(\n  nodeIdRef: MaybeRefOrGetter<string>\n) {\n  const { startDrag, endDrag, handleDrag } = useNodeDrag()\n  // Use canvas interactions for proper wheel event handling and pointer event capture control\n  const { forwardEventToCanvas, shouldHandleNodePointerEvents } =\n    useCanvasInteractions()\n  const { handleNodeSelect, toggleNodeSelectionAfterPointerUp } =\n    useNodeEventHandlers()\n  const { nodeManager } = useVueNodeLifecycle()\n\n  const forwardMiddlePointerIfNeeded = (event: PointerEvent) => {\n    if (!isMiddlePointerInput(event)) return false\n    forwardEventToCanvas(event)\n    return true\n  }\n\n  let hasDraggingStarted = false\n\n  const startPosition = ref({ x: 0, y: 0 })\n\n  const DRAG_THRESHOLD = 3 // pixels\n\n  function onPointerdown(event: PointerEvent) {\n    if (forwardMiddlePointerIfNeeded(event)) return\n\n    // Only start drag on left-click (button 0)\n    if (event.button !== 0) return\n\n    // Don't handle pointer events when canvas is in panning mode - forward to canvas instead\n    if (!shouldHandleNodePointerEvents.value) {\n      forwardEventToCanvas(event)\n      return\n    }\n\n    const nodeId = toValue(nodeIdRef)\n    if (!nodeId) {\n      console.warn(\n        'LGraphNode: nodeData is null/undefined in handlePointerDown'\n      )\n      return\n    }\n\n    // IMPORTANT: Read from actual LGraphNode to get correct state\n    if (nodeManager.value?.getNode(nodeId)?.flags?.pinned) {\n      return\n    }\n\n    startPosition.value = { x: event.clientX, y: event.clientY }\n\n    safeDragStart(event, nodeId)\n  }\n\n  function onPointermove(event: PointerEvent) {\n    if (forwardMiddlePointerIfNeeded(event)) return\n\n    // Don't activate drag while resizing\n    if (layoutStore.isResizingVueNodes.value) return\n\n    const nodeId = toValue(nodeIdRef)\n\n    if (nodeManager.value?.getNode(nodeId)?.flags?.pinned) {\n      return\n    }\n\n    const multiSelect = isMultiSelectKey(event)\n\n    const lmbDown = event.buttons & 1\n    if (lmbDown && multiSelect && !layoutStore.isDraggingVueNodes.value) {\n      layoutStore.isDraggingVueNodes.value = true\n      handleNodeSelect(event, nodeId)\n      safeDragStart(event, nodeId)\n      return\n    }\n    // Check if we should start dragging (pointer moved beyond threshold)\n    if (lmbDown && !layoutStore.isDraggingVueNodes.value) {\n      const dx = event.clientX - startPosition.value.x\n      const dy = event.clientY - startPosition.value.y\n      const distance = Math.sqrt(dx * dx + dy * dy)\n\n      if (distance > DRAG_THRESHOLD) {\n        layoutStore.isDraggingVueNodes.value = true\n        handleNodeSelect(event, nodeId)\n      }\n    }\n\n    if (layoutStore.isDraggingVueNodes.value) {\n      handleDrag(event, nodeId)\n    }\n  }\n\n  function cleanupDragState() {\n    layoutStore.isDraggingVueNodes.value = false\n  }\n\n  function safeDragStart(event: PointerEvent, nodeId: string) {\n    try {\n      startDrag(event, nodeId)\n    } finally {\n      hasDraggingStarted = true\n    }\n  }\n\n  function safeDragEnd(event: PointerEvent) {\n    try {\n      const nodeId = toValue(nodeIdRef)\n      endDrag(event, nodeId)\n    } catch (error) {\n      console.error('Error during endDrag:', error)\n    } finally {\n      hasDraggingStarted = false\n      cleanupDragState()\n    }\n  }\n\n  function onPointerup(event: PointerEvent) {\n    if (forwardMiddlePointerIfNeeded(event)) return\n    // Don't handle pointer events when canvas is in panning mode - forward to canvas instead\n    const canHandlePointer = shouldHandleNodePointerEvents.value\n    if (!canHandlePointer) {\n      forwardEventToCanvas(event)\n      return\n    }\n    const wasDragging = layoutStore.isDraggingVueNodes.value\n\n    if (hasDraggingStarted || wasDragging) {\n      safeDragEnd(event)\n\n      if (wasDragging) {\n        return\n      }\n    }\n\n    // Skip selection handling for right-click (button 2) - context menu handles its own selection\n    if (event.button === 2) return\n\n    const multiSelect = isMultiSelectKey(event)\n\n    const nodeId = toValue(nodeIdRef)\n    if (nodeId) {\n      toggleNodeSelectionAfterPointerUp(nodeId, multiSelect)\n    }\n  }\n\n  function onPointercancel(event: PointerEvent) {\n    if (!layoutStore.isDraggingVueNodes.value) return\n    safeDragEnd(event)\n  }\n\n  /**\n   * Handles right-click during drag operations\n   * Cancels the current drag to prevent context menu from appearing while dragging\n   */\n  function onContextmenu(event: MouseEvent) {\n    if (!layoutStore.isDraggingVueNodes.value) return\n\n    event.preventDefault()\n    // Simply cleanup state without calling endDrag to avoid synthetic event creation\n    cleanupDragState()\n  }\n\n  // Cleanup on unmount to prevent resource leaks\n  onScopeDispose(() => {\n    cleanupDragState()\n  })\n\n  const pointerHandlers = {\n    onPointerdown,\n    onPointermove,\n    onPointerup,\n    onPointercancel,\n    onContextmenu\n  } as const\n\n  return {\n    pointerHandlers\n  }\n}\n","/**\n * Generic Vue Element Tracking System\n *\n * Automatically tracks DOM size and position changes for Vue-rendered elements\n * and syncs them to the layout store. Uses a single shared ResizeObserver for\n * performance, with elements identified by configurable data attributes.\n *\n * Supports different element types (nodes, slots, widgets, etc.) with\n * customizable data attributes and update handlers.\n */\nimport { getCurrentInstance, onMounted, onUnmounted, toValue } from 'vue'\nimport type { MaybeRefOrGetter } from 'vue'\n\nimport { useSharedCanvasPositionConversion } from '@/composables/element/useCanvasPositionConversion'\nimport { LiteGraph } from '@/lib/litegraph/src/litegraph'\nimport { layoutStore } from '@/renderer/core/layout/store/layoutStore'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport type { Bounds, NodeId } from '@/renderer/core/layout/types'\nimport { LayoutSource } from '@/renderer/core/layout/types'\n\nimport { syncNodeSlotLayoutsFromDOM } from './useSlotElementTracking'\n\n/**\n * Generic update item for element bounds tracking\n */\ninterface ElementBoundsUpdate {\n  /** Element identifier (could be nodeId, widgetId, slotId, etc.) */\n  id: string\n  /** Updated bounds */\n  bounds: Bounds\n}\n\n/**\n * Configuration for different types of tracked elements\n */\ninterface ElementTrackingConfig {\n  /** Data attribute name (e.g., 'nodeId') */\n  dataAttribute: string\n  /** Handler for processing bounds updates */\n  updateHandler: (updates: ElementBoundsUpdate[]) => void\n}\n\n/**\n * Registry of tracking configurations by element type\n */\nconst trackingConfigs: Map<string, ElementTrackingConfig> = new Map([\n  [\n    'node',\n    {\n      dataAttribute: 'nodeId',\n      updateHandler: (updates) => {\n        const nodeUpdates = updates.map(({ id, bounds }) => ({\n          nodeId: id as NodeId,\n          bounds\n        }))\n        layoutStore.batchUpdateNodeBounds(nodeUpdates)\n      }\n    }\n  ]\n])\n\n// Single ResizeObserver instance for all Vue elements\nconst resizeObserver = new ResizeObserver((entries) => {\n  if (useCanvasStore().linearMode) return\n  // Canvas is ready when this code runs; no defensive guards needed.\n  const conv = useSharedCanvasPositionConversion()\n  // Group updates by type, then flush via each config's handler\n  const updatesByType = new Map<string, ElementBoundsUpdate[]>()\n  // Track nodes whose slots should be resynced after node size changes\n  const nodesNeedingSlotResync = new Set<string>()\n\n  for (const entry of entries) {\n    if (!(entry.target instanceof HTMLElement)) continue\n    const element = entry.target\n\n    // Find which type this element belongs to\n    let elementType: string | undefined\n    let elementId: string | undefined\n\n    for (const [type, config] of trackingConfigs) {\n      const id = element.dataset[config.dataAttribute]\n      if (id) {\n        elementType = type\n        elementId = id\n        break\n      }\n    }\n\n    if (!elementType || !elementId) continue\n\n    // Use borderBoxSize when available; fall back to contentRect for older engines/tests\n    // Border box is the border included FULL wxh DOM value.\n    const borderBox = Array.isArray(entry.borderBoxSize)\n      ? entry.borderBoxSize[0]\n      : {\n          inlineSize: entry.contentRect.width,\n          blockSize: entry.contentRect.height\n        }\n    const width = borderBox.inlineSize\n    const height = borderBox.blockSize\n\n    // Screen-space rect\n    const rect = element.getBoundingClientRect()\n    const [cx, cy] = conv.clientPosToCanvasPos([rect.left, rect.top])\n    const topLeftCanvas = { x: cx, y: cy }\n    const bounds: Bounds = {\n      x: topLeftCanvas.x,\n      y: topLeftCanvas.y + LiteGraph.NODE_TITLE_HEIGHT,\n      width: Math.max(0, width),\n      height: Math.max(0, height)\n    }\n\n    let updates = updatesByType.get(elementType)\n    if (!updates) {\n      updates = []\n      updatesByType.set(elementType, updates)\n    }\n    updates.push({ id: elementId, bounds })\n\n    // If this entry is a node, mark it for slot layout resync\n    if (elementType === 'node' && elementId) {\n      nodesNeedingSlotResync.add(elementId)\n    }\n  }\n\n  layoutStore.setSource(LayoutSource.DOM)\n\n  // Flush per-type\n  for (const [type, updates] of updatesByType) {\n    const config = trackingConfigs.get(type)\n    if (config && updates.length) config.updateHandler(updates)\n  }\n\n  // After node bounds are updated, refresh slot cached offsets and layouts\n  if (nodesNeedingSlotResync.size > 0) {\n    for (const nodeId of nodesNeedingSlotResync) {\n      syncNodeSlotLayoutsFromDOM(nodeId)\n    }\n  }\n})\n\n/**\n * Tracks DOM element size/position changes for a Vue component and syncs to layout store\n *\n * Sets up automatic ResizeObserver tracking when the component mounts and cleans up\n * when unmounted. The tracked element is identified by a data attribute set on the\n * component's root DOM element.\n *\n * @param appIdentifier - Application-level identifier for this tracked element (not a DOM ID)\n *                       Example: node ID like 'node-123', widget ID like 'widget-456'\n * @param trackingType - Type of element being tracked, determines which tracking config to use\n *                      Example: 'node' for Vue nodes, 'widget' for UI widgets\n *\n * @example\n * ```ts\n * // Track a Vue node component with ID 'my-node-123'\n * useVueElementTracking('my-node-123', 'node')\n *\n * // Would set data-node-id=\"my-node-123\" on the component's root element\n * // and sync size changes to layoutStore.batchUpdateNodeBounds()\n * ```\n */\nexport function useVueElementTracking(\n  appIdentifierMaybe: MaybeRefOrGetter<string>,\n  trackingType: string\n) {\n  const appIdentifier = toValue(appIdentifierMaybe)\n  onMounted(() => {\n    const element = getCurrentInstance()?.proxy?.$el\n    if (!(element instanceof HTMLElement) || !appIdentifier) return\n\n    const config = trackingConfigs.get(trackingType)\n    if (!config) return\n\n    // Set the data attribute expected by the RO pipeline for this type\n    element.dataset[config.dataAttribute] = appIdentifier\n    resizeObserver.observe(element)\n  })\n\n  onUnmounted(() => {\n    const element = getCurrentInstance()?.proxy?.$el\n    if (!(element instanceof HTMLElement)) return\n\n    const config = trackingConfigs.get(trackingType)\n    if (!config) return\n\n    // Remove the data attribute and observer\n    delete element.dataset[config.dataAttribute]\n    resizeObserver.unobserve(element)\n  })\n}\n","import { storeToRefs } from 'pinia'\nimport { computed, toValue } from 'vue'\nimport type { MaybeRefOrGetter } from 'vue'\n\nimport { useExecutionStore } from '@/stores/executionStore'\n\n/**\n * Composable for managing execution state of Vue-based nodes\n *\n * Provides reactive access to execution state and progress for a specific node\n * by injecting execution data from the parent GraphCanvas provider.\n *\n * @param nodeLocatorIdMaybe - Locator ID (root or subgraph scoped) of the node to track\n * @returns Object containing reactive execution state and progress\n */\nexport const useNodeExecutionState = (\n  nodeLocatorIdMaybe: MaybeRefOrGetter<string | undefined>\n) => {\n  const locatorId = computed(() => toValue(nodeLocatorIdMaybe) ?? '')\n  const { nodeLocationProgressStates, isIdle } =\n    storeToRefs(useExecutionStore())\n\n  const progressState = computed(() => {\n    const id = locatorId.value\n    return id ? nodeLocationProgressStates.value[id] : undefined\n  })\n\n  const executing = computed(\n    () => !isIdle.value && progressState.value?.state === 'running'\n  )\n\n  const progress = computed(() => {\n    const state = progressState.value\n    return state && state.max > 0 ? state.value / state.max : undefined\n  })\n\n  const progressPercentage = computed(() => {\n    const prog = progress.value\n    return prog !== undefined ? Math.round(prog * 100) : undefined\n  })\n\n  const executionState = computed(() => {\n    const state = progressState.value\n    if (!state) return 'idle'\n    return state.state\n  })\n\n  return {\n    executing,\n    progress,\n    progressPercentage,\n    progressState,\n    executionState\n  }\n}\n","import { computed, onUnmounted, toValue } from 'vue'\nimport type { MaybeRefOrGetter } from 'vue'\n\nimport { useLayoutMutations } from '@/renderer/core/layout/operations/layoutMutations'\nimport { layoutStore } from '@/renderer/core/layout/store/layoutStore'\nimport { LayoutSource } from '@/renderer/core/layout/types'\nimport type { Point } from '@/renderer/core/layout/types'\n\n/**\n * Composable for individual Vue node components\n * Uses customRef for shared write access with Canvas renderer\n */\nexport function useNodeLayout(nodeIdMaybe: MaybeRefOrGetter<string>) {\n  const nodeId = toValue(nodeIdMaybe)\n  const mutations = useLayoutMutations()\n\n  // Get the customRef for this node (shared write access)\n  const layoutRef = layoutStore.getNodeLayoutRef(nodeId)\n\n  // Clean up refs and triggers when Vue component unmounts\n  onUnmounted(() => {\n    layoutStore.cleanupNodeRef(nodeId)\n  })\n\n  // Computed properties for easy access\n  const position = computed(() => {\n    const layout = layoutRef.value\n    const pos = layout?.position ?? { x: 0, y: 0 }\n    return pos\n  })\n  const size = computed(\n    () => layoutRef.value?.size ?? { width: 200, height: 100 }\n  )\n\n  const zIndex = computed(() => layoutRef.value?.zIndex ?? 0)\n\n  /**\n   * Update node position directly (without drag)\n   */\n  function moveNodeTo(position: Point) {\n    mutations.setSource(LayoutSource.Vue)\n    mutations.moveNode(nodeId, position)\n  }\n\n  return {\n    // Reactive state (via customRef)\n    position,\n    size,\n    zIndex,\n\n    // Mutations\n    moveNodeTo\n  }\n}\n","import { storeToRefs } from 'pinia'\nimport { computed, toValue } from 'vue'\nimport type { MaybeRefOrGetter, Ref } from 'vue'\n\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { useNodeOutputStore } from '@/stores/imagePreviewStore'\n\nexport const useNodePreviewState = (\n  nodeIdMaybe: MaybeRefOrGetter<string>,\n  options?: {\n    isCollapsed?: Ref<boolean>\n  }\n) => {\n  const nodeId = toValue(nodeIdMaybe)\n  const workflowStore = useWorkflowStore()\n  const { nodePreviewImages } = storeToRefs(useNodeOutputStore())\n\n  const locatorId = computed(() => workflowStore.nodeIdToNodeLocatorId(nodeId))\n\n  const previewUrls = computed(() => {\n    const key = locatorId.value\n    if (!key) return undefined\n    const urls = nodePreviewImages.value[key]\n    return urls?.length ? urls : undefined\n  })\n\n  const hasPreview = computed(() => !!previewUrls.value?.length)\n\n  const latestPreviewUrl = computed(() => {\n    const urls = previewUrls.value\n    return urls?.length ? urls.at(-1) : ''\n  })\n\n  const shouldShowPreviewImg = computed(() => {\n    if (!options?.isCollapsed) {\n      return hasPreview.value\n    }\n    return !options.isCollapsed.value && hasPreview.value\n  })\n\n  return {\n    locatorId,\n    previewUrls,\n    hasPreview,\n    latestPreviewUrl,\n    shouldShowPreviewImg\n  }\n}\n","import { useEventListener } from '@vueuse/core'\nimport { ref } from 'vue'\n\nimport type { Point, Size } from '@/renderer/core/layout/types'\nimport { layoutStore } from '@/renderer/core/layout/store/layoutStore'\nimport { useNodeSnap } from '@/renderer/extensions/vueNodes/composables/useNodeSnap'\nimport { useShiftKeySync } from '@/renderer/extensions/vueNodes/composables/useShiftKeySync'\nimport { useTransformState } from '@/renderer/core/layout/transform/useTransformState'\n\ninterface ResizeCallbackPayload {\n  size: Size\n}\n\n/**\n * Composable for node resizing functionality (bottom-right corner only)\n *\n * Provides resize handle interaction that integrates with the layout system.\n * Handles pointer capture, coordinate calculations, and size constraints.\n */\nexport function useNodeResize(\n  resizeCallback: (payload: ResizeCallbackPayload, element: HTMLElement) => void\n) {\n  const transformState = useTransformState()\n\n  const isResizing = ref(false)\n  const resizeStartPointer = ref<Point | null>(null)\n  const resizeStartSize = ref<Size | null>(null)\n\n  // Snap-to-grid functionality\n  const { shouldSnap, applySnapToSize } = useNodeSnap()\n\n  // Shift key sync for LiteGraph canvas preview\n  const { trackShiftKey } = useShiftKeySync()\n\n  const startResize = (event: PointerEvent) => {\n    event.preventDefault()\n    event.stopPropagation()\n\n    const target = event.currentTarget\n    if (!(target instanceof HTMLElement)) return\n\n    const nodeElement = target.closest('[data-node-id]')\n    if (!(nodeElement instanceof HTMLElement)) return\n\n    const rect = nodeElement.getBoundingClientRect()\n    const scale = transformState.camera.z\n\n    const startSize: Size = {\n      width: rect.width / scale,\n      height: rect.height / scale\n    }\n\n    // Track shift key state and sync to canvas for snap preview\n    const stopShiftSync = trackShiftKey(event)\n\n    // Capture pointer to ensure we get all move/up events\n    target.setPointerCapture(event.pointerId)\n\n    // Mark as resizing to prevent drag from activating\n    layoutStore.isResizingVueNodes.value = true\n    isResizing.value = true\n    resizeStartPointer.value = { x: event.clientX, y: event.clientY }\n    resizeStartSize.value = startSize\n\n    const handlePointerMove = (moveEvent: PointerEvent) => {\n      if (\n        !isResizing.value ||\n        !resizeStartPointer.value ||\n        !resizeStartSize.value\n      ) {\n        return\n      }\n\n      const scale = transformState.camera.z\n      const deltaX =\n        (moveEvent.clientX - resizeStartPointer.value.x) / (scale || 1)\n      const deltaY =\n        (moveEvent.clientY - resizeStartPointer.value.y) / (scale || 1)\n\n      let newSize: Size = {\n        width: resizeStartSize.value.width + deltaX,\n        height: resizeStartSize.value.height + deltaY\n      }\n\n      // Apply snap if shift is held\n      if (shouldSnap(moveEvent)) {\n        newSize = applySnapToSize(newSize)\n      }\n\n      const nodeElement = target.closest('[data-node-id]')\n      if (nodeElement instanceof HTMLElement) {\n        resizeCallback({ size: newSize }, nodeElement)\n      }\n    }\n\n    const handlePointerUp = (upEvent: PointerEvent) => {\n      if (isResizing.value) {\n        isResizing.value = false\n        layoutStore.isResizingVueNodes.value = false\n        resizeStartPointer.value = null\n        resizeStartSize.value = null\n\n        // Stop tracking shift key state\n        stopShiftSync()\n\n        target.releasePointerCapture(upEvent.pointerId)\n        stopMoveListen()\n        stopUpListen()\n      }\n    }\n\n    const stopMoveListen = useEventListener('pointermove', handlePointerMove)\n    const stopUpListen = useEventListener('pointerup', handlePointerUp)\n  }\n\n  return {\n    startResize,\n    isResizing\n  }\n}\n","<template>\n  <div v-if=\"imageUrl\" class=\"flex h-full min-h-16 w-full min-w-16 flex-col\">\n    <!-- Image Container -->\n    <div\n      class=\"relative h-88 w-full grow overflow-hidden rounded-[5px] bg-node-component-surface\"\n    >\n      <!-- Error State -->\n      <div\n        v-if=\"imageError\"\n        class=\"text-pure-white flex h-full w-full flex-col items-center justify-center text-center\"\n      >\n        <i-lucide:image-off class=\"mb-1 size-8 text-smoke-500\" />\n        <p class=\"text-xs text-smoke-400\">{{ $t('g.imageFailedToLoad') }}</p>\n      </div>\n\n      <!-- Main Image -->\n      <img\n        v-else\n        :src=\"imageUrl\"\n        :alt=\"$t('g.liveSamplingPreview')\"\n        class=\"pointer-events-none h-full w-full object-contain object-center\"\n        @load=\"handleImageLoad\"\n        @error=\"handleImageError\"\n      />\n    </div>\n\n    <!-- Image Dimensions -->\n    <div class=\"text-node-component-header-text mt-1 text-center text-xs\">\n      {{\n        imageError\n          ? $t('g.errorLoadingImage')\n          : actualDimensions || $t('g.calculatingDimensions')\n      }}\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, watch } from 'vue'\n\ninterface LivePreviewProps {\n  /** Image URL to display */\n  imageUrl: string | null\n}\n\nconst props = defineProps<LivePreviewProps>()\n\nconst actualDimensions = ref<string | null>(null)\nconst imageError = ref(false)\n\nwatch(\n  () => props.imageUrl,\n  () => {\n    // Reset states when URL changes\n    actualDimensions.value = null\n    imageError.value = false\n  }\n)\n\nconst handleImageLoad = (event: Event) => {\n  if (!event.target || !(event.target instanceof HTMLImageElement)) return\n  const img = event.target\n  imageError.value = false\n  if (img.naturalWidth && img.naturalHeight) {\n    actualDimensions.value = `${img.naturalWidth} x ${img.naturalHeight}`\n  }\n}\n\nconst handleImageError = () => {\n  imageError.value = true\n  actualDimensions.value = null\n}\n</script>\n","<template>\n  <div\n    v-if=\"imageUrls.length > 0\"\n    class=\"video-preview group relative flex size-full min-h-16 min-w-16 flex-col px-2\"\n    @keydown=\"handleKeyDown\"\n  >\n    <!-- Video Wrapper -->\n    <div\n      ref=\"videoWrapperEl\"\n      class=\"relative h-full w-full grow overflow-hidden rounded-[5px] bg-node-component-surface\"\n      tabindex=\"0\"\n      role=\"region\"\n      :aria-label=\"$t('g.videoPreview')\"\n      :aria-busy=\"showLoader\"\n      @mouseenter=\"handleMouseEnter\"\n      @mouseleave=\"handleMouseLeave\"\n      @focusin=\"handleFocusIn\"\n      @focusout=\"handleFocusOut\"\n    >\n      <!-- Error State -->\n      <div\n        v-if=\"videoError\"\n        role=\"alert\"\n        class=\"flex size-full flex-col items-center justify-center bg-muted-background text-center text-base-foreground py-8\"\n      >\n        <i\n          class=\"mb-2 icon-[lucide--video-off] h-12 w-12 text-base-foreground\"\n        />\n        <p class=\"text-sm text-base-foreground\">\n          {{ $t('g.videoFailedToLoad') }}\n        </p>\n        <p class=\"mt-1 text-xs text-base-foreground\">\n          {{ getVideoFilename(currentVideoUrl) }}\n        </p>\n      </div>\n\n      <!-- Loading State -->\n      <Skeleton\n        v-if=\"showLoader && !videoError\"\n        class=\"absolute inset-0 size-full\"\n        border-radius=\"5px\"\n        width=\"100%\"\n        height=\"100%\"\n      />\n\n      <!-- Main Video -->\n      <video\n        v-if=\"!videoError\"\n        :src=\"currentVideoUrl\"\n        :class=\"cn('block size-full object-contain', showLoader && 'invisible')\"\n        controls\n        loop\n        playsinline\n        @loadeddata=\"handleVideoLoad\"\n        @error=\"handleVideoError\"\n      />\n\n      <!-- Floating Action Buttons (appear on hover) -->\n      <div\n        v-if=\"isHovered || isFocused\"\n        class=\"actions absolute top-2 right-2 flex gap-2.5\"\n      >\n        <!-- Download Button -->\n        <button\n          :class=\"actionButtonClass\"\n          :title=\"$t('g.downloadVideo')\"\n          :aria-label=\"$t('g.downloadVideo')\"\n          @click=\"handleDownload\"\n        >\n          <i class=\"icon-[lucide--download] h-4 w-4\" />\n        </button>\n\n        <!-- Close Button -->\n        <button\n          :class=\"actionButtonClass\"\n          :title=\"$t('g.removeVideo')\"\n          :aria-label=\"$t('g.removeVideo')\"\n          @click=\"handleRemove\"\n        >\n          <i class=\"icon-[lucide--x] h-4 w-4\" />\n        </button>\n      </div>\n\n      <!-- Multiple Videos Navigation -->\n      <div\n        v-if=\"hasMultipleVideos\"\n        class=\"absolute right-2 bottom-2 left-2 flex justify-center gap-1\"\n      >\n        <button\n          v-for=\"(_, index) in imageUrls\"\n          :key=\"index\"\n          :class=\"getNavigationDotClass(index)\"\n          :aria-label=\"\n            $t('g.viewVideoOfTotal', {\n              index: index + 1,\n              total: imageUrls.length\n            })\n          \"\n          @click=\"setCurrentIndex(index)\"\n        />\n      </div>\n    </div>\n\n    <!-- Video Dimensions -->\n    <div class=\"mt-2 text-center text-xs text-muted-foreground\">\n      <span v-if=\"videoError\" class=\"text-red-400\">\n        {{ $t('g.errorLoadingVideo') }}\n      </span>\n      <span v-else-if=\"showLoader\" class=\"text-smoke-400\">\n        {{ $t('g.loading') }}...\n      </span>\n      <span v-else>\n        {{ actualDimensions || $t('g.calculatingDimensions') }}\n      </span>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useToast } from 'primevue'\nimport Skeleton from 'primevue/skeleton'\nimport { computed, ref, watch } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport { downloadFile } from '@/base/common/downloadUtil'\nimport { useNodeOutputStore } from '@/stores/imagePreviewStore'\nimport { cn } from '@/utils/tailwindUtil'\n\ninterface VideoPreviewProps {\n  /** Array of video URLs to display */\n  readonly imageUrls: readonly string[] // Named imageUrls for consistency with parent components\n  /** Optional node ID for context-aware actions */\n  readonly nodeId?: string\n}\n\nconst props = defineProps<VideoPreviewProps>()\n\nconst { t } = useI18n()\nconst nodeOutputStore = useNodeOutputStore()\n\nconst actionButtonClass =\n  'flex h-8 min-h-8 items-center justify-center gap-2.5 rounded-lg border-0 bg-button-surface px-2 py-2 text-button-surface-contrast shadow-sm transition-colors duration-200 hover:bg-button-hover-surface focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-button-surface-contrast focus-visible:ring-offset-2 focus-visible:ring-offset-transparent cursor-pointer'\n\n// Component state\nconst currentIndex = ref(0)\nconst isHovered = ref(false)\nconst isFocused = ref(false)\nconst actualDimensions = ref<string | null>(null)\nconst videoError = ref(false)\nconst showLoader = ref(false)\n\nconst videoWrapperEl = ref<HTMLDivElement>()\n\n// Computed values\nconst currentVideoUrl = computed(() => props.imageUrls[currentIndex.value])\nconst hasMultipleVideos = computed(() => props.imageUrls.length > 1)\n\n// Watch for URL changes and reset state\nwatch(\n  () => props.imageUrls,\n  (newUrls) => {\n    // Reset current index if it's out of bounds\n    if (currentIndex.value >= newUrls.length) {\n      currentIndex.value = 0\n    }\n\n    // Reset loading and error states when URLs change\n    actualDimensions.value = null\n    videoError.value = false\n    showLoader.value = newUrls.length > 0\n  },\n  { deep: true, immediate: true }\n)\n\n// Event handlers\nconst handleVideoLoad = (event: Event) => {\n  if (!event.target || !(event.target instanceof HTMLVideoElement)) return\n  const video = event.target\n  showLoader.value = false\n  videoError.value = false\n  if (video.videoWidth && video.videoHeight) {\n    actualDimensions.value = `${video.videoWidth} x ${video.videoHeight}`\n  }\n}\n\nconst handleVideoError = () => {\n  showLoader.value = false\n  videoError.value = true\n  actualDimensions.value = null\n}\n\nconst handleDownload = () => {\n  try {\n    downloadFile(currentVideoUrl.value)\n  } catch (error) {\n    useToast().add({\n      severity: 'error',\n      summary: 'Error',\n      detail: t('g.failedToDownloadVideo'),\n      life: 3000,\n      group: 'video-preview'\n    })\n  }\n}\n\nconst handleRemove = () => {\n  if (!props.nodeId) return\n  nodeOutputStore.removeNodeOutputs(props.nodeId)\n}\n\nconst setCurrentIndex = (index: number) => {\n  if (index >= 0 && index < props.imageUrls.length) {\n    currentIndex.value = index\n    actualDimensions.value = null\n    showLoader.value = true\n    videoError.value = false\n  }\n}\n\nconst handleMouseEnter = () => {\n  isHovered.value = true\n}\n\nconst handleMouseLeave = () => {\n  isHovered.value = false\n}\n\nconst handleFocusIn = () => {\n  isFocused.value = true\n}\n\nconst handleFocusOut = (event: FocusEvent) => {\n  if (!videoWrapperEl.value?.contains(event.relatedTarget as Node)) {\n    isFocused.value = false\n  }\n}\n\nconst getNavigationDotClass = (index: number) => {\n  return [\n    'w-2 h-2 rounded-full transition-all duration-200 border-0 cursor-pointer',\n    index === currentIndex.value ? 'bg-white' : 'bg-white/50 hover:bg-white/80'\n  ]\n}\n\nconst handleKeyDown = (event: KeyboardEvent) => {\n  if (props.imageUrls.length <= 1) return\n\n  switch (event.key) {\n    case 'ArrowLeft':\n      event.preventDefault()\n      setCurrentIndex(\n        currentIndex.value > 0\n          ? currentIndex.value - 1\n          : props.imageUrls.length - 1\n      )\n      break\n    case 'ArrowRight':\n      event.preventDefault()\n      setCurrentIndex(\n        currentIndex.value < props.imageUrls.length - 1\n          ? currentIndex.value + 1\n          : 0\n      )\n      break\n    case 'Home':\n      event.preventDefault()\n      setCurrentIndex(0)\n      break\n    case 'End':\n      event.preventDefault()\n      setCurrentIndex(props.imageUrls.length - 1)\n      break\n  }\n}\n\nconst getVideoFilename = (url: string): string => {\n  try {\n    return new URL(url).searchParams.get('filename') || 'Unknown file'\n  } catch {\n    return 'Invalid URL'\n  }\n}\n</script>\n","<template>\n  <div\n    v-if=\"imageUrls.length > 0\"\n    class=\"image-preview group relative flex size-full min-h-16 min-w-16 flex-col px-2 justify-center\"\n    @keydown=\"handleKeyDown\"\n  >\n    <!-- Image Wrapper -->\n    <div\n      ref=\"imageWrapperEl\"\n      class=\"h-full w-full overflow-hidden rounded-[5px] bg-muted-background relative\"\n      tabindex=\"0\"\n      role=\"img\"\n      :aria-label=\"$t('g.imagePreview')\"\n      :aria-busy=\"showLoader\"\n      @mouseenter=\"handleMouseEnter\"\n      @mouseleave=\"handleMouseLeave\"\n      @focusin=\"handleFocusIn\"\n      @focusout=\"handleFocusOut\"\n    >\n      <!-- Error State -->\n      <div\n        v-if=\"imageError\"\n        role=\"alert\"\n        class=\"flex size-full flex-col items-center justify-center bg-muted-background text-center text-base-foreground py-8\"\n      >\n        <i\n          class=\"mb-2 icon-[lucide--image-off] h-12 w-12 text-base-foreground\"\n        />\n        <p class=\"text-sm text-base-foreground\">\n          {{ $t('g.imageFailedToLoad') }}\n        </p>\n        <p class=\"mt-1 text-xs text-base-foreground\">\n          {{ getImageFilename(currentImageUrl) }}\n        </p>\n      </div>\n      <!-- Loading State -->\n      <div v-if=\"showLoader && !imageError\" class=\"size-full\">\n        <Skeleton border-radius=\"5px\" width=\"100%\" height=\"100%\" />\n      </div>\n      <!-- Main Image -->\n      <img\n        v-if=\"!imageError\"\n        ref=\"currentImageEl\"\n        :src=\"currentImageUrl\"\n        :alt=\"imageAltText\"\n        class=\"block size-full object-contain pointer-events-none\"\n        @load=\"handleImageLoad\"\n        @error=\"handleImageError\"\n      />\n\n      <!-- Floating Action Buttons (appear on hover and focus) -->\n      <div\n        v-if=\"isHovered || isFocused\"\n        class=\"actions absolute top-2 right-2 flex gap-2.5\"\n      >\n        <!-- Mask/Edit Button -->\n        <button\n          v-if=\"!hasMultipleImages\"\n          :class=\"actionButtonClass\"\n          :title=\"$t('g.editOrMaskImage')\"\n          :aria-label=\"$t('g.editOrMaskImage')\"\n          @click=\"handleEditMask\"\n        >\n          <i-comfy:mask class=\"h-4 w-4\" />\n        </button>\n\n        <!-- Download Button -->\n        <button\n          :class=\"actionButtonClass\"\n          :title=\"$t('g.downloadImage')\"\n          :aria-label=\"$t('g.downloadImage')\"\n          @click=\"handleDownload\"\n        >\n          <i class=\"icon-[lucide--download] h-4 w-4\" />\n        </button>\n\n        <!-- Close Button -->\n        <button\n          :class=\"actionButtonClass\"\n          :title=\"$t('g.removeImage')\"\n          :aria-label=\"$t('g.removeImage')\"\n          @click=\"handleRemove\"\n        >\n          <i class=\"icon-[lucide--x] h-4 w-4\" />\n        </button>\n      </div>\n    </div>\n\n    <!-- Image Dimensions -->\n    <div class=\"pt-2 text-center text-xs text-base-foreground\">\n      <span v-if=\"imageError\" class=\"text-red-400\">\n        {{ $t('g.errorLoadingImage') }}\n      </span>\n      <span v-else-if=\"showLoader\" class=\"text-base-foreground\">\n        {{ $t('g.loading') }}...\n      </span>\n      <span v-else>\n        {{ actualDimensions || $t('g.calculatingDimensions') }}\n      </span>\n    </div>\n    <!-- Multiple Images Navigation -->\n    <div\n      v-if=\"hasMultipleImages\"\n      class=\"flex flex-wrap justify-center gap-1 pt-4\"\n    >\n      <button\n        v-for=\"(_, index) in imageUrls\"\n        :key=\"index\"\n        :class=\"getNavigationDotClass(index)\"\n        :aria-current=\"index === currentIndex ? 'true' : undefined\"\n        :aria-label=\"\n          $t('g.viewImageOfTotal', {\n            index: index + 1,\n            total: imageUrls.length\n          })\n        \"\n        @click=\"setCurrentIndex(index)\"\n      />\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useTimeoutFn } from '@vueuse/core'\nimport { useToast } from 'primevue'\nimport Skeleton from 'primevue/skeleton'\nimport { computed, ref, watch } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport { downloadFile } from '@/base/common/downloadUtil'\nimport { app } from '@/scripts/app'\nimport { useCommandStore } from '@/stores/commandStore'\nimport { useNodeOutputStore } from '@/stores/imagePreviewStore'\n\ninterface ImagePreviewProps {\n  /** Array of image URLs to display */\n  readonly imageUrls: readonly string[]\n  /** Optional node ID for context-aware actions */\n  readonly nodeId?: string\n}\n\nconst props = defineProps<ImagePreviewProps>()\n\nconst { t } = useI18n()\nconst commandStore = useCommandStore()\nconst nodeOutputStore = useNodeOutputStore()\n\nconst actionButtonClass =\n  'flex h-8 min-h-8 items-center justify-center gap-2.5 rounded-lg border-0 bg-button-surface px-2 py-2 text-button-surface-contrast shadow-sm transition-colors duration-200 hover:bg-button-hover-surface focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-button-surface-contrast focus-visible:ring-offset-2 focus-visible:ring-offset-transparent cursor-pointer'\n\n// Component state\nconst currentIndex = ref(0)\nconst isHovered = ref(false)\nconst isFocused = ref(false)\nconst actualDimensions = ref<string | null>(null)\nconst imageError = ref(false)\nconst showLoader = ref(false)\n\nconst currentImageEl = ref<HTMLImageElement>()\nconst imageWrapperEl = ref<HTMLDivElement>()\n\nconst { start: startDelayedLoader, stop: stopDelayedLoader } = useTimeoutFn(\n  () => {\n    showLoader.value = true\n  },\n  250,\n  // Make sure it doesnt run on component mount\n  { immediate: false }\n)\n\n// Computed values\nconst currentImageUrl = computed(() => props.imageUrls[currentIndex.value])\nconst hasMultipleImages = computed(() => props.imageUrls.length > 1)\nconst imageAltText = computed(() => `Node output ${currentIndex.value + 1}`)\n\n// Watch for URL changes and reset state\nwatch(\n  () => props.imageUrls,\n  (newUrls) => {\n    // Reset current index if it's out of bounds\n    if (currentIndex.value >= newUrls.length) {\n      currentIndex.value = 0\n    }\n\n    // Reset loading and error states when URLs change\n    actualDimensions.value = null\n\n    imageError.value = false\n    if (newUrls.length > 0) startDelayedLoader()\n  },\n  { deep: true, immediate: true }\n)\n\n// Event handlers\nconst handleImageLoad = (event: Event) => {\n  if (!event.target || !(event.target instanceof HTMLImageElement)) return\n  const img = event.target\n  stopDelayedLoader()\n  showLoader.value = false\n  imageError.value = false\n  if (img.naturalWidth && img.naturalHeight) {\n    actualDimensions.value = `${img.naturalWidth} x ${img.naturalHeight}`\n  }\n}\n\nconst handleImageError = () => {\n  stopDelayedLoader()\n  showLoader.value = false\n  imageError.value = true\n  actualDimensions.value = null\n}\n\n// In vueNodes mode, we need to set them manually before opening the mask editor.\nconst setupNodeForMaskEditor = () => {\n  if (!props.nodeId || !currentImageEl.value) return\n  const node = app.rootGraph?.getNodeById(props.nodeId)\n  if (!node) return\n  node.imageIndex = currentIndex.value\n  node.imgs = [currentImageEl.value]\n  app.canvas?.select(node)\n}\n\nconst handleEditMask = () => {\n  setupNodeForMaskEditor()\n  void commandStore.execute('Comfy.MaskEditor.OpenMaskEditor')\n}\n\nconst handleDownload = () => {\n  try {\n    downloadFile(currentImageUrl.value)\n  } catch (error) {\n    useToast().add({\n      severity: 'error',\n      summary: 'Error',\n      detail: t('g.failedToDownloadImage'),\n      life: 3000,\n      group: 'image-preview'\n    })\n  }\n}\n\nconst handleRemove = () => {\n  if (!props.nodeId) return\n  nodeOutputStore.removeNodeOutputs(props.nodeId)\n}\n\nconst setCurrentIndex = (index: number) => {\n  if (currentIndex.value === index) return\n  if (index >= 0 && index < props.imageUrls.length) {\n    currentIndex.value = index\n    startDelayedLoader()\n    imageError.value = false\n  }\n}\n\nconst handleMouseEnter = () => {\n  isHovered.value = true\n}\n\nconst handleMouseLeave = () => {\n  isHovered.value = false\n}\n\nconst handleFocusIn = () => {\n  isFocused.value = true\n}\n\nconst handleFocusOut = (event: FocusEvent) => {\n  // Only unfocus if focus is leaving the wrapper entirely\n  if (!imageWrapperEl.value?.contains(event.relatedTarget as Node)) {\n    isFocused.value = false\n  }\n}\n\nconst getNavigationDotClass = (index: number) => {\n  return [\n    'w-2 h-2 rounded-full transition-all duration-200 border-0 cursor-pointer p-0',\n    index === currentIndex.value\n      ? 'bg-base-foreground'\n      : 'bg-base-foreground/50 hover:bg-base-foreground/80'\n  ]\n}\n\nconst handleKeyDown = (event: KeyboardEvent) => {\n  if (props.imageUrls.length <= 1) return\n\n  switch (event.key) {\n    case 'ArrowLeft':\n      event.preventDefault()\n      setCurrentIndex(\n        currentIndex.value > 0\n          ? currentIndex.value - 1\n          : props.imageUrls.length - 1\n      )\n      break\n    case 'ArrowRight':\n      event.preventDefault()\n      setCurrentIndex(\n        currentIndex.value < props.imageUrls.length - 1\n          ? currentIndex.value + 1\n          : 0\n      )\n      break\n    case 'Home':\n      event.preventDefault()\n      setCurrentIndex(0)\n      break\n    case 'End':\n      event.preventDefault()\n      setCurrentIndex(props.imageUrls.length - 1)\n      break\n  }\n}\n\nconst getImageFilename = (url: string): string => {\n  try {\n    return new URL(url).searchParams.get('filename') || 'Unknown file'\n  } catch {\n    return 'Invalid URL'\n  }\n}\n</script>\n","<template>\n  <div v-if=\"renderError\" class=\"node-error p-2 text-sm text-red-500\">\n    {{ st('nodeErrors.content', 'Node Content Error') }}\n  </div>\n  <div v-else class=\"lg-node-content flex grow flex-col\">\n    <!-- Default slot for custom content -->\n    <slot>\n      <VideoPreview\n        v-if=\"hasMedia && media?.type === 'video'\"\n        :image-urls=\"media.urls\"\n        :node-id=\"nodeId\"\n        class=\"mt-2\"\n      />\n      <ImagePreview\n        v-else-if=\"hasMedia && media?.type === 'image'\"\n        :image-urls=\"media.urls\"\n        :node-id=\"nodeId\"\n        class=\"mt-2\"\n      />\n    </slot>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, onErrorCaptured, ref } from 'vue'\n\nimport type { VueNodeData } from '@/composables/graph/useGraphNodeManager'\nimport { useErrorHandling } from '@/composables/useErrorHandling'\nimport { st } from '@/i18n'\n\nimport VideoPreview from '../VideoPreview.vue'\nimport ImagePreview from './ImagePreview.vue'\n\ninterface NodeContentProps {\n  nodeData?: VueNodeData\n  media?: {\n    type: 'image' | 'video'\n    urls: string[]\n  }\n}\n\nconst props = defineProps<NodeContentProps>()\n\nconst hasMedia = computed(() => props.media && props.media.urls.length > 0)\n\n// Get node ID from nodeData\nconst nodeId = computed(() => props.nodeData?.id?.toString())\n\n// Error boundary implementation\nconst renderError = ref<string | null>(null)\nconst { toastErrorHandler } = useErrorHandling()\n\nonErrorCaptured((error) => {\n  renderError.value = error.message\n  toastErrorHandler(error)\n  return false\n})\n</script>\n","<template>\n  <div v-if=\"renderError\" class=\"node-error p-2 text-sm text-red-500\">\n    {{ st('nodeErrors.render', 'Node Render Error') }}\n  </div>\n  <div\n    v-else\n    ref=\"nodeContainerRef\"\n    tabindex=\"0\"\n    :data-node-id=\"nodeData.id\"\n    :class=\"\n      cn(\n        'bg-component-node-background lg-node absolute text-sm',\n        'contain-style contain-layout min-w-[225px] min-h-(--node-height) w-(--node-width)',\n        shapeClass,\n        'touch-none flex flex-col',\n        'border-1 border-solid border-component-node-border',\n        // hover (only when node should handle events)\n        shouldHandleNodePointerEvents &&\n          'hover:ring-7 ring-node-component-ring',\n        'outline-transparent outline-2 focus-visible:outline-node-component-outline',\n        borderClass,\n        outlineClass,\n        cursorClass,\n        {\n          [`${beforeShapeClass} before:pointer-events-none before:absolute before:bg-bypass/60 before:inset-0`]:\n            bypassed,\n          [`${beforeShapeClass} before:pointer-events-none before:absolute before:inset-0`]:\n            muted,\n          'ring-4 ring-primary-500 bg-primary-500/10': isDraggingOver\n        },\n\n        shouldHandleNodePointerEvents\n          ? 'pointer-events-auto'\n          : 'pointer-events-none',\n        !isCollapsed && ' pb-1'\n      )\n    \"\n    :style=\"[\n      {\n        transform: `translate(${position.x ?? 0}px, ${(position.y ?? 0) - LiteGraph.NODE_TITLE_HEIGHT}px)`,\n        zIndex: zIndex,\n        opacity: nodeOpacity,\n        '--component-node-background': nodeBodyBackgroundColor\n      }\n    ]\"\n    v-bind=\"remainingPointerHandlers\"\n    @pointerdown=\"nodeOnPointerdown\"\n    @wheel=\"handleWheel\"\n    @contextmenu=\"handleContextMenu\"\n    @dragover.prevent=\"handleDragOver\"\n    @dragleave=\"handleDragLeave\"\n    @drop.stop.prevent=\"handleDrop\"\n  >\n    <div\n      v-if=\"displayHeader\"\n      class=\"flex flex-col justify-center items-center relative\"\n    >\n      <template v-if=\"isCollapsed\">\n        <SlotConnectionDot\n          v-if=\"hasInputs\"\n          multi\n          class=\"absolute left-0 -translate-x-1/2\"\n        />\n        <SlotConnectionDot\n          v-if=\"hasOutputs\"\n          multi\n          class=\"absolute right-0 translate-x-1/2\"\n        />\n        <NodeSlots :node-data=\"nodeData\" unified />\n      </template>\n      <NodeHeader\n        :node-data=\"nodeData\"\n        :collapsed=\"isCollapsed\"\n        @collapse=\"handleCollapse\"\n        @update:title=\"handleHeaderTitleUpdate\"\n        @enter-subgraph=\"handleEnterSubgraph\"\n      />\n    </div>\n\n    <div\n      v-if=\"isCollapsed && executing && progress !== undefined\"\n      :class=\"\n        cn(\n          'absolute inset-x-4 -bottom-[1px] translate-y-1/2 rounded-full',\n          progressClasses\n        )\n      \"\n      :style=\"{ width: `${Math.min(progress * 100, 100)}%` }\"\n    />\n\n    <template v-if=\"!isCollapsed\">\n      <div class=\"relative mb-1\">\n        <!-- Progress bar for executing state -->\n        <div\n          v-if=\"executing && progress !== undefined\"\n          :class=\"\n            cn(\n              'absolute inset-x-0 top-1/2 -translate-y-1/2',\n              !!(progress < 1) && 'rounded-r-full',\n              progressClasses\n            )\n          \"\n          :style=\"{ width: `${Math.min(progress * 100, 100)}%` }\"\n        />\n      </div>\n\n      <div\n        class=\"flex flex-1 flex-col gap-1 pb-2\"\n        :data-testid=\"`node-body-${nodeData.id}`\"\n      >\n        <NodeSlots :node-data=\"nodeData\" />\n\n        <NodeWidgets v-if=\"nodeData.widgets?.length\" :node-data=\"nodeData\" />\n\n        <div v-if=\"hasCustomContent\" class=\"min-h-0 flex-1 flex\">\n          <NodeContent :node-data=\"nodeData\" :media=\"nodeMedia\" />\n        </div>\n        <!-- Live mid-execution preview images -->\n        <div v-if=\"shouldShowPreviewImg\" class=\"min-h-0 flex-1 px-4\">\n          <LivePreview :image-url=\"latestPreviewUrl || null\" />\n        </div>\n      </div>\n    </template>\n\n    <!-- Resize handle (bottom-right only) -->\n    <div\n      v-if=\"!isCollapsed\"\n      role=\"button\"\n      :aria-label=\"t('g.resizeFromBottomRight')\"\n      :class=\"cn(baseResizeHandleClasses, 'right-0 bottom-0 cursor-se-resize')\"\n      @pointerdown.stop=\"handleResizePointerDown\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { storeToRefs } from 'pinia'\nimport { computed, nextTick, onErrorCaptured, onMounted, ref, watch } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport type { VueNodeData } from '@/composables/graph/useGraphNodeManager'\nimport { showNodeOptions } from '@/composables/graph/useMoreOptionsMenu'\nimport { useErrorHandling } from '@/composables/useErrorHandling'\nimport { st } from '@/i18n'\nimport {\n  LGraphCanvas,\n  LGraphEventMode,\n  LiteGraph,\n  RenderShape\n} from '@/lib/litegraph/src/litegraph'\nimport { TitleMode } from '@/lib/litegraph/src/types/globalEnums'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useCanvasInteractions } from '@/renderer/core/canvas/useCanvasInteractions'\nimport { layoutStore } from '@/renderer/core/layout/store/layoutStore'\nimport SlotConnectionDot from '@/renderer/extensions/vueNodes/components/SlotConnectionDot.vue'\nimport { useNodeEventHandlers } from '@/renderer/extensions/vueNodes/composables/useNodeEventHandlers'\nimport { useNodePointerInteractions } from '@/renderer/extensions/vueNodes/composables/useNodePointerInteractions'\nimport { useNodeZIndex } from '@/renderer/extensions/vueNodes/composables/useNodeZIndex'\nimport { useVueElementTracking } from '@/renderer/extensions/vueNodes/composables/useVueNodeResizeTracking'\nimport { useNodeExecutionState } from '@/renderer/extensions/vueNodes/execution/useNodeExecutionState'\nimport { useNodeDrag } from '@/renderer/extensions/vueNodes/layout/useNodeDrag'\nimport { useNodeLayout } from '@/renderer/extensions/vueNodes/layout/useNodeLayout'\nimport { useNodePreviewState } from '@/renderer/extensions/vueNodes/preview/useNodePreviewState'\nimport { nonWidgetedInputs } from '@/renderer/extensions/vueNodes/utils/nodeDataUtils'\nimport { applyLightThemeColor } from '@/renderer/extensions/vueNodes/utils/nodeStyleUtils'\nimport { app } from '@/scripts/app'\nimport { useExecutionStore } from '@/stores/executionStore'\nimport { useNodeOutputStore } from '@/stores/imagePreviewStore'\nimport { useColorPaletteStore } from '@/stores/workspace/colorPaletteStore'\nimport { isTransparent } from '@/utils/colorUtil'\nimport {\n  getLocatorIdFromNodeData,\n  getNodeByLocatorId\n} from '@/utils/graphTraversalUtil'\nimport { cn } from '@/utils/tailwindUtil'\n\nimport { useNodeResize } from '../interactions/resize/useNodeResize'\nimport LivePreview from './LivePreview.vue'\nimport NodeContent from './NodeContent.vue'\nimport NodeHeader from './NodeHeader.vue'\nimport NodeSlots from './NodeSlots.vue'\nimport NodeWidgets from './NodeWidgets.vue'\n\n// Extended props for main node component\ninterface LGraphNodeProps {\n  nodeData: VueNodeData\n  error?: string | null\n}\n\nconst { nodeData, error = null } = defineProps<LGraphNodeProps>()\n\nconst { t } = useI18n()\n\nconst { handleNodeCollapse, handleNodeTitleUpdate, handleNodeRightClick } =\n  useNodeEventHandlers()\nconst { bringNodeToFront } = useNodeZIndex()\n\nuseVueElementTracking(() => nodeData.id, 'node')\n\nconst { selectedNodeIds } = storeToRefs(useCanvasStore())\nconst isSelected = computed(() => {\n  return selectedNodeIds.value.has(nodeData.id)\n})\n\nconst nodeLocatorId = computed(() => getLocatorIdFromNodeData(nodeData))\nconst { executing, progress } = useNodeExecutionState(nodeLocatorId)\nconst executionStore = useExecutionStore()\nconst hasExecutionError = computed(\n  () => executionStore.lastExecutionErrorNodeId === nodeData.id\n)\n\nconst hasAnyError = computed((): boolean => {\n  return !!(\n    hasExecutionError.value ||\n    nodeData.hasErrors ||\n    error ||\n    (executionStore.lastNodeErrors?.[nodeData.id]?.errors.length ?? 0) > 0\n  )\n})\n\nconst displayHeader = computed(() => nodeData.titleMode !== TitleMode.NO_TITLE)\n\nconst isCollapsed = computed(() => nodeData.flags?.collapsed ?? false)\nconst bypassed = computed(\n  (): boolean => nodeData.mode === LGraphEventMode.BYPASS\n)\nconst muted = computed((): boolean => nodeData.mode === LGraphEventMode.NEVER)\n\nconst nodeBodyBackgroundColor = computed(() => {\n  const colorPaletteStore = useColorPaletteStore()\n\n  if (!nodeData.bgcolor) {\n    return ''\n  }\n\n  return applyLightThemeColor(\n    nodeData.bgcolor,\n    Boolean(colorPaletteStore.completedActivePalette.light_theme)\n  )\n})\n\nconst nodeOpacity = computed(() => {\n  const globalOpacity = useSettingStore().get('Comfy.Node.Opacity') ?? 1\n\n  // For muted/bypassed nodes, apply the 0.5 multiplier on top of global opacity\n  if (bypassed.value || muted.value) {\n    return globalOpacity * 0.5\n  }\n\n  return globalOpacity\n})\n\nconst hasInputs = computed(() => nonWidgetedInputs(nodeData).length > 0)\nconst hasOutputs = computed((): boolean => !!nodeData.outputs?.length)\n\n// Use canvas interactions for proper wheel event handling and pointer event capture control\nconst { handleWheel, shouldHandleNodePointerEvents } = useCanvasInteractions()\n\n// Error boundary implementation\nconst renderError = ref<string | null>(null)\nconst { toastErrorHandler } = useErrorHandling()\n\nonErrorCaptured((error) => {\n  renderError.value = error.message\n  toastErrorHandler(error)\n  return false // Prevent error propagation\n})\n\nconst { position, size, zIndex } = useNodeLayout(() => nodeData.id)\nconst { pointerHandlers } = useNodePointerInteractions(() => nodeData.id)\nconst { onPointerdown, ...remainingPointerHandlers } = pointerHandlers\nconst { startDrag } = useNodeDrag()\n\nasync function nodeOnPointerdown(event: PointerEvent) {\n  if (event.altKey && lgraphNode.value) {\n    const result = LGraphCanvas.cloneNodes([lgraphNode.value])\n    if (result?.created?.length) {\n      const [newNode] = result.created\n      startDrag(event, `${newNode.id}`)\n      layoutStore.isDraggingVueNodes.value = true\n      await nextTick()\n      bringNodeToFront(`${newNode.id}`)\n      return\n    }\n  }\n  onPointerdown(event)\n}\n\n// Handle right-click context menu\nconst handleContextMenu = (event: MouseEvent) => {\n  event.preventDefault()\n  event.stopPropagation()\n\n  // First handle the standard right-click behavior (selection)\n  handleNodeRightClick(event as PointerEvent, nodeData.id)\n\n  // Show the node options menu at the cursor position\n  showNodeOptions(event)\n}\n\nonMounted(() => {\n  initSizeStyles()\n})\n\n/**\n * Set initial DOM size from layout store, but respect intrinsic content minimum.\n * Important: nodes can mount in a collapsed state, and the collapse watcher won't\n * run initially. Match the collapsed runtime behavior by writing to the correct\n * CSS variables on mount.\n */\nfunction initSizeStyles() {\n  const el = nodeContainerRef.value\n  const { width, height } = size.value\n  if (!el) return\n\n  const suffix = isCollapsed.value ? '-x' : ''\n\n  el.style.setProperty(`--node-width${suffix}`, `${width}px`)\n  el.style.setProperty(`--node-height${suffix}`, `${height}px`)\n}\n\nconst baseResizeHandleClasses =\n  'absolute h-3 w-3 opacity-0 pointer-events-auto focus-visible:outline focus-visible:outline-2 focus-visible:outline-white/40'\n\nconst MIN_NODE_WIDTH = 225\n\nconst { startResize } = useNodeResize((result, element) => {\n  if (isCollapsed.value) return\n\n  // Clamp width to minimum to avoid conflicts with CSS min-width\n  const clampedWidth = Math.max(result.size.width, MIN_NODE_WIDTH)\n\n  // Apply size directly to DOM element - ResizeObserver will pick this up\n  element.style.setProperty('--node-width', `${clampedWidth}px`)\n  element.style.setProperty('--node-height', `${result.size.height}px`)\n})\n\nconst handleResizePointerDown = (event: PointerEvent) => {\n  if (event.button !== 0) return\n  if (!shouldHandleNodePointerEvents.value) return\n  if (nodeData.flags?.pinned) return\n  startResize(event)\n}\n\nwatch(isCollapsed, (collapsed) => {\n  const element = nodeContainerRef.value\n  if (!element) return\n  const [from, to] = collapsed ? ['', '-x'] : ['-x', '']\n  const currentWidth = element.style.getPropertyValue(`--node-width${from}`)\n  element.style.setProperty(`--node-width${to}`, currentWidth)\n  element.style.setProperty(`--node-width${from}`, '')\n\n  const currentHeight = element.style.getPropertyValue(`--node-height${from}`)\n  element.style.setProperty(`--node-height${to}`, currentHeight)\n  element.style.setProperty(`--node-height${from}`, '')\n})\n\n// Check if node has custom content (like image/video outputs)\nconst hasCustomContent = computed(() => {\n  // Show custom content if node has media outputs\n  return !!nodeMedia.value && nodeMedia.value.urls.length > 0\n})\n\n// Computed classes and conditions for better reusability\nconst progressClasses = 'h-2 bg-primary-500 transition-all duration-300'\n\nconst { latestPreviewUrl, shouldShowPreviewImg } = useNodePreviewState(\n  () => nodeData.id,\n  {\n    isCollapsed\n  }\n)\n\nconst borderClass = computed(() => {\n  if (hasAnyError.value) return 'border-node-stroke-error'\n  //FIXME need a better way to detecting transparency\n  if (\n    !displayHeader.value &&\n    nodeData.bgcolor &&\n    isTransparent(nodeData.bgcolor)\n  )\n    return 'border-0'\n  return ''\n})\n\nconst outlineClass = computed(() => {\n  return cn(\n    isSelected.value && 'outline-node-component-outline',\n    hasAnyError.value && 'outline-node-stroke-error',\n    executing.value && 'outline-node-stroke-executing'\n  )\n})\n\nconst cursorClass = computed(() => {\n  return cn(\n    nodeData.flags?.pinned\n      ? 'cursor-default'\n      : layoutStore.isDraggingVueNodes.value\n        ? 'cursor-grabbing'\n        : 'cursor-grab'\n  )\n})\n\nconst shapeClass = computed(() => {\n  switch (nodeData.shape) {\n    case RenderShape.BOX:\n      return 'rounded-none'\n    case RenderShape.CARD:\n      return 'rounded-tl-2xl rounded-br-2xl rounded-tr-none rounded-bl-none'\n    default:\n      return 'rounded-2xl'\n  }\n})\n\nconst beforeShapeClass = computed(() => {\n  switch (nodeData.shape) {\n    case RenderShape.BOX:\n      return 'before:rounded-none'\n    case RenderShape.CARD:\n      return 'before:rounded-tl-2xl before:rounded-br-2xl before:rounded-tr-none before:rounded-bl-none'\n    default:\n      return 'before:rounded-2xl'\n  }\n})\n\n// Event handlers\nconst handleCollapse = () => {\n  handleNodeCollapse(nodeData.id, !isCollapsed.value)\n}\n\nconst handleHeaderTitleUpdate = (newTitle: string) => {\n  handleNodeTitleUpdate(nodeData.id, newTitle)\n}\n\nconst handleEnterSubgraph = () => {\n  useTelemetry()?.trackUiButtonClicked({\n    button_id: 'graph_node_open_subgraph_clicked'\n  })\n  const graph = app.rootGraph\n  if (!graph) {\n    console.warn('LGraphNode: No graph available for subgraph navigation')\n    return\n  }\n\n  const locatorId = getLocatorIdFromNodeData(nodeData)\n\n  const litegraphNode = getNodeByLocatorId(graph, locatorId)\n\n  if (!litegraphNode?.isSubgraphNode() || !('subgraph' in litegraphNode)) {\n    console.warn('LGraphNode: Node is not a valid subgraph node', litegraphNode)\n    return\n  }\n\n  const canvas = app.canvas\n  if (!canvas || typeof canvas.openSubgraph !== 'function') {\n    console.warn('LGraphNode: Canvas or openSubgraph method not available')\n    return\n  }\n\n  canvas.openSubgraph(litegraphNode.subgraph, litegraphNode)\n}\n\nconst nodeOutputs = useNodeOutputStore()\n\nconst nodeOutputLocatorId = computed(() =>\n  nodeData.subgraphId ? `${nodeData.subgraphId}:${nodeData.id}` : nodeData.id\n)\n\nconst lgraphNode = computed(() => {\n  const locatorId = getLocatorIdFromNodeData(nodeData)\n  return getNodeByLocatorId(app.rootGraph, locatorId)\n})\n\nconst nodeMedia = computed(() => {\n  const newOutputs = nodeOutputs.nodeOutputs[nodeOutputLocatorId.value]\n  const node = lgraphNode.value\n\n  if (!node || !newOutputs?.images?.length) return undefined\n\n  const urls = nodeOutputs.getNodeImageUrls(node)\n  if (!urls?.length) return undefined\n\n  // Determine media type from previewMediaType or fallback to input slot types\n  // Note: Despite the field name \"images\", videos are also included in outputs\n  // TODO: fix the backend to return videos using the videos key instead of the images key\n  const hasVideoInput = node.inputs?.some((input) => input.type === 'VIDEO')\n  const type =\n    node.previewMediaType === 'video' ||\n    (!node.previewMediaType && hasVideoInput)\n      ? 'video'\n      : 'image'\n\n  return { type, urls } as const\n})\n\nconst nodeContainerRef = ref<HTMLDivElement>()\n\n// Drag and drop support\nconst isDraggingOver = ref(false)\n\nfunction handleDragOver(event: DragEvent) {\n  const node = lgraphNode.value\n  if (!node || !node.onDragOver) {\n    isDraggingOver.value = false\n    return\n  }\n\n  // Call the litegraph node's onDragOver callback to check if files are valid\n  const canDrop = node.onDragOver(event)\n  isDraggingOver.value = canDrop\n}\n\nfunction handleDragLeave() {\n  isDraggingOver.value = false\n}\n\nasync function handleDrop(event: DragEvent) {\n  isDraggingOver.value = false\n\n  const node = lgraphNode.value\n  if (!node || !node.onDragDrop) {\n    return\n  }\n\n  // Forward the drop event to the litegraph node's onDragDrop callback\n  await node.onDragDrop(event)\n}\n</script>\n","import type { useSettingStore } from '@/platform/settings/settingStore'\n\nlet pendingCallbacks: Array<() => Promise<void>> = []\nlet isNewUserDetermined = false\nlet isNewUserCached: boolean | null = null\n\nexport const newUserService = () => {\n  function checkIsNewUser(\n    settingStore: ReturnType<typeof useSettingStore>\n  ): boolean {\n    const isNewUserSettings =\n      Object.keys(settingStore.settingValues).length === 0 ||\n      !settingStore.get('Comfy.TutorialCompleted')\n    const hasNoWorkflow = !localStorage.getItem('workflow')\n    const hasNoPreviousWorkflow = !localStorage.getItem(\n      'Comfy.PreviousWorkflow'\n    )\n\n    return isNewUserSettings && hasNoWorkflow && hasNoPreviousWorkflow\n  }\n\n  async function registerInitCallback(callback: () => Promise<void>) {\n    if (isNewUserDetermined) {\n      if (isNewUserCached) {\n        try {\n          await callback()\n        } catch (error) {\n          console.error('New user initialization callback failed:', error)\n        }\n      }\n    } else {\n      pendingCallbacks.push(callback)\n    }\n  }\n\n  async function initializeIfNewUser(\n    settingStore: ReturnType<typeof useSettingStore>\n  ) {\n    if (isNewUserDetermined) return\n\n    isNewUserCached = checkIsNewUser(settingStore)\n    isNewUserDetermined = true\n\n    if (!isNewUserCached) {\n      pendingCallbacks = []\n      return\n    }\n\n    await settingStore.set(\n      'Comfy.InstalledVersion',\n      __COMFYUI_FRONTEND_VERSION__\n    )\n\n    for (const callback of pendingCallbacks) {\n      try {\n        await callback()\n      } catch (error) {\n        console.error('New user initialization callback failed:', error)\n      }\n    }\n\n    pendingCallbacks = []\n  }\n\n  function isNewUser(): boolean | null {\n    return isNewUserDetermined ? isNewUserCached : null\n  }\n\n  return {\n    registerInitCallback,\n    initializeIfNewUser,\n    isNewUser\n  }\n}\n","<template>\n  <div\n    v-if=\"isVisible\"\n    class=\"pointer-events-none absolute z-9999 border border-blue-400 bg-blue-500/20\"\n    :style=\"rectangleStyle\"\n  />\n</template>\n\n<script setup lang=\"ts\">\nimport { useRafFn } from '@vueuse/core'\nimport { computed, ref } from 'vue'\n\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\n\nconst canvasStore = useCanvasStore()\n\nconst selectionRect = ref<{\n  x: number\n  y: number\n  w: number\n  h: number\n} | null>(null)\n\nuseRafFn(() => {\n  const canvas = canvasStore.canvas\n  if (!canvas) {\n    selectionRect.value = null\n    return\n  }\n\n  const { pointer, dragging_rectangle } = canvas\n\n  if (dragging_rectangle && pointer.eDown && pointer.eMove) {\n    const x = pointer.eDown.safeOffsetX\n    const y = pointer.eDown.safeOffsetY\n    const w = pointer.eMove.safeOffsetX - x\n    const h = pointer.eMove.safeOffsetY - y\n\n    selectionRect.value = { x, y, w, h }\n  } else {\n    selectionRect.value = null\n  }\n})\n\nconst isVisible = computed(() => selectionRect.value !== null)\n\nconst rectangleStyle = computed(() => {\n  const rect = selectionRect.value\n  if (!rect) return {}\n\n  const left = rect.w >= 0 ? rect.x : rect.x + rect.w\n  const top = rect.h >= 0 ? rect.y : rect.y + rect.h\n  const width = Math.abs(rect.w)\n  const height = Math.abs(rect.h)\n\n  return {\n    left: `${left}px`,\n    top: `${top}px`,\n    width: `${width}px`,\n    height: `${height}px`\n  }\n})\n</script>\n","<template>\n  <!-- Load splitter overlay only after comfyApp is ready. -->\n  <!-- If load immediately, the top-level splitter stateKey won't be correctly\n  synced with the stateStorage (localStorage). -->\n  <LiteGraphCanvasSplitterOverlay v-if=\"comfyAppReady\">\n    <template v-if=\"showUI\" #workflow-tabs>\n      <div\n        v-if=\"workflowTabsPosition === 'Topbar'\"\n        class=\"workflow-tabs-container pointer-events-auto relative h-9.5 w-full\"\n      >\n        <!-- Native drag area for Electron -->\n        <div\n          v-if=\"isNativeWindow() && workflowTabsPosition !== 'Topbar'\"\n          class=\"app-drag fixed top-0 left-0 z-10 h-[var(--comfy-topbar-height)] w-full\"\n        />\n        <div\n          class=\"flex h-full items-center border-b border-interface-stroke bg-comfy-menu-bg shadow-interface\"\n        >\n          <WorkflowTabs />\n          <TopbarBadges />\n        </div>\n      </div>\n    </template>\n    <template v-if=\"showUI\" #side-toolbar>\n      <SideToolbar />\n    </template>\n    <template v-if=\"showUI\" #side-bar-panel>\n      <div\n        class=\"sidebar-content-container h-full w-full overflow-x-hidden overflow-y-auto\"\n      >\n        <ExtensionSlot v-if=\"activeSidebarTab\" :extension=\"activeSidebarTab\" />\n      </div>\n    </template>\n    <template v-if=\"showUI\" #topmenu>\n      <TopMenuSection />\n    </template>\n    <template v-if=\"showUI\" #bottom-panel>\n      <BottomPanel />\n    </template>\n    <template v-if=\"showUI\" #right-side-panel>\n      <NodePropertiesPanel />\n    </template>\n    <template #graph-canvas-panel>\n      <GraphCanvasMenu v-if=\"canvasMenuEnabled\" class=\"pointer-events-auto\" />\n      <MiniMap\n        v-if=\"comfyAppReady && minimapEnabled && betaMenuEnabled\"\n        class=\"pointer-events-auto\"\n      />\n    </template>\n  </LiteGraphCanvasSplitterOverlay>\n  <canvas\n    id=\"graph-canvas\"\n    ref=\"canvasRef\"\n    tabindex=\"1\"\n    class=\"absolute inset-0 size-full touch-none\"\n  />\n\n  <!-- TransformPane for Vue node rendering -->\n  <TransformPane\n    v-if=\"shouldRenderVueNodes && comfyApp.canvas && comfyAppReady\"\n    :canvas=\"comfyApp.canvas\"\n    @wheel.capture=\"canvasInteractions.forwardEventToCanvas\"\n  >\n    <!-- Vue nodes rendered based on graph nodes -->\n    <LGraphNode\n      v-for=\"nodeData in allNodes\"\n      :key=\"nodeData.id\"\n      :node-data=\"nodeData\"\n      :error=\"\n        executionStore.lastExecutionError?.node_id === nodeData.id\n          ? 'Execution error'\n          : null\n      \"\n      :zoom-level=\"canvasStore.canvas?.ds?.scale || 1\"\n      :data-node-id=\"nodeData.id\"\n    />\n  </TransformPane>\n\n  <!-- Selection rectangle overlay - rendered in DOM layer to appear above DOM widgets -->\n  <SelectionRectangle v-if=\"comfyAppReady\" />\n\n  <NodeTooltip v-if=\"tooltipEnabled\" />\n  <NodeSearchboxPopover ref=\"nodeSearchboxPopoverRef\" />\n\n  <!-- Initialize components after comfyApp is ready. useAbsolutePosition requires\n  canvasStore.canvas to be initialized. -->\n  <template v-if=\"comfyAppReady\">\n    <TitleEditor />\n    <SelectionToolbox v-if=\"selectionToolboxEnabled\" />\n    <!-- Render legacy DOM widgets only when Vue nodes are disabled -->\n    <DomWidgets v-if=\"!shouldRenderVueNodes\" />\n  </template>\n</template>\n\n<script setup lang=\"ts\">\nimport { useEventListener, whenever } from '@vueuse/core'\nimport {\n  computed,\n  nextTick,\n  onMounted,\n  onUnmounted,\n  ref,\n  shallowRef,\n  watch,\n  watchEffect\n} from 'vue'\n\nimport LiteGraphCanvasSplitterOverlay from '@/components/LiteGraphCanvasSplitterOverlay.vue'\nimport TopMenuSection from '@/components/TopMenuSection.vue'\nimport BottomPanel from '@/components/bottomPanel/BottomPanel.vue'\nimport ExtensionSlot from '@/components/common/ExtensionSlot.vue'\nimport DomWidgets from '@/components/graph/DomWidgets.vue'\nimport GraphCanvasMenu from '@/components/graph/GraphCanvasMenu.vue'\nimport NodeTooltip from '@/components/graph/NodeTooltip.vue'\nimport SelectionToolbox from '@/components/graph/SelectionToolbox.vue'\nimport TitleEditor from '@/components/graph/TitleEditor.vue'\nimport NodePropertiesPanel from '@/components/rightSidePanel/RightSidePanel.vue'\nimport NodeSearchboxPopover from '@/components/searchbox/NodeSearchBoxPopover.vue'\nimport SideToolbar from '@/components/sidebar/SideToolbar.vue'\nimport TopbarBadges from '@/components/topbar/TopbarBadges.vue'\nimport WorkflowTabs from '@/components/topbar/WorkflowTabs.vue'\nimport { useChainCallback } from '@/composables/functional/useChainCallback'\nimport type { VueNodeData } from '@/composables/graph/useGraphNodeManager'\nimport { useVueNodeLifecycle } from '@/composables/graph/useVueNodeLifecycle'\nimport { useNodeBadge } from '@/composables/node/useNodeBadge'\nimport { useCanvasDrop } from '@/composables/useCanvasDrop'\nimport { useContextMenuTranslation } from '@/composables/useContextMenuTranslation'\nimport { useCopy } from '@/composables/useCopy'\nimport { useGlobalLitegraph } from '@/composables/useGlobalLitegraph'\nimport { usePaste } from '@/composables/usePaste'\nimport { useVueFeatureFlags } from '@/composables/useVueFeatureFlags'\nimport { mergeCustomNodesI18n, t } from '@/i18n'\nimport { LiteGraph } from '@/lib/litegraph/src/litegraph'\nimport { useLitegraphSettings } from '@/platform/settings/composables/useLitegraphSettings'\nimport { CORE_SETTINGS } from '@/platform/settings/constants/coreSettings'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useToastStore } from '@/platform/updates/common/toastStore'\nimport { useWorkflowService } from '@/platform/workflow/core/services/workflowService'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { useWorkflowAutoSave } from '@/platform/workflow/persistence/composables/useWorkflowAutoSave'\nimport { useWorkflowPersistence } from '@/platform/workflow/persistence/composables/useWorkflowPersistence'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useCanvasInteractions } from '@/renderer/core/canvas/useCanvasInteractions'\nimport TransformPane from '@/renderer/core/layout/transform/TransformPane.vue'\nimport MiniMap from '@/renderer/extensions/minimap/MiniMap.vue'\nimport LGraphNode from '@/renderer/extensions/vueNodes/components/LGraphNode.vue'\nimport { UnauthorizedError, api } from '@/scripts/api'\nimport { app as comfyApp } from '@/scripts/app'\nimport { ChangeTracker } from '@/scripts/changeTracker'\nimport { IS_CONTROL_WIDGET, updateControlWidgetLabel } from '@/scripts/widgets'\nimport { useColorPaletteService } from '@/services/colorPaletteService'\nimport { newUserService } from '@/services/newUserService'\nimport { useCommandStore } from '@/stores/commandStore'\nimport { useExecutionStore } from '@/stores/executionStore'\nimport { useNodeDefStore } from '@/stores/nodeDefStore'\nimport { useColorPaletteStore } from '@/stores/workspace/colorPaletteStore'\nimport { useSearchBoxStore } from '@/stores/workspace/searchBoxStore'\nimport { useWorkspaceStore } from '@/stores/workspaceStore'\nimport { isNativeWindow } from '@/utils/envUtil'\nimport { forEachNode } from '@/utils/graphTraversalUtil'\n\nimport SelectionRectangle from './SelectionRectangle.vue'\n\nconst emit = defineEmits<{\n  ready: []\n}>()\nconst canvasRef = ref<HTMLCanvasElement | null>(null)\nconst nodeSearchboxPopoverRef = shallowRef<InstanceType<\n  typeof NodeSearchboxPopover\n> | null>(null)\nconst settingStore = useSettingStore()\nconst nodeDefStore = useNodeDefStore()\nconst workspaceStore = useWorkspaceStore()\nconst canvasStore = useCanvasStore()\nconst executionStore = useExecutionStore()\nconst toastStore = useToastStore()\nconst colorPaletteStore = useColorPaletteStore()\nconst colorPaletteService = useColorPaletteService()\nconst canvasInteractions = useCanvasInteractions()\n\nconst betaMenuEnabled = computed(\n  () => settingStore.get('Comfy.UseNewMenu') !== 'Disabled'\n)\nconst workflowTabsPosition = computed(() =>\n  settingStore.get('Comfy.Workflow.WorkflowTabsPosition')\n)\nconst canvasMenuEnabled = computed(() =>\n  settingStore.get('Comfy.Graph.CanvasMenu')\n)\nconst tooltipEnabled = computed(() => settingStore.get('Comfy.EnableTooltips'))\nconst selectionToolboxEnabled = computed(() =>\n  settingStore.get('Comfy.Canvas.SelectionToolbox')\n)\nconst activeSidebarTab = computed(() => {\n  return workspaceStore.sidebarTab.activeSidebarTab\n})\nconst showUI = computed(\n  () => !workspaceStore.focusMode && betaMenuEnabled.value\n)\n\nconst minimapEnabled = computed(() => settingStore.get('Comfy.Minimap.Visible'))\n\n// Feature flags\nconst { shouldRenderVueNodes } = useVueFeatureFlags()\n\n// Vue node system\nconst vueNodeLifecycle = useVueNodeLifecycle()\n\nconst handleVueNodeLifecycleReset = async () => {\n  if (shouldRenderVueNodes.value) {\n    vueNodeLifecycle.disposeNodeManagerAndSyncs()\n    await nextTick()\n    vueNodeLifecycle.initializeNodeManager()\n  }\n}\n\nwatch(() => canvasStore.currentGraph, handleVueNodeLifecycleReset)\n\nwatch(\n  () => canvasStore.isInSubgraph,\n  async (newValue, oldValue) => {\n    if (oldValue && !newValue) {\n      useWorkflowStore().updateActiveGraph()\n    }\n    await handleVueNodeLifecycleReset()\n  }\n)\n\nconst allNodes = computed((): VueNodeData[] =>\n  Array.from(vueNodeLifecycle.nodeManager.value?.vueNodeData?.values() ?? [])\n)\n\nwatchEffect(() => {\n  LiteGraph.nodeOpacity = settingStore.get('Comfy.Node.Opacity')\n})\nwatchEffect(() => {\n  LiteGraph.nodeLightness = colorPaletteStore.completedActivePalette.light_theme\n    ? 0.5\n    : undefined\n})\n\nwatchEffect(() => {\n  nodeDefStore.showDeprecated = settingStore.get('Comfy.Node.ShowDeprecated')\n})\n\nwatchEffect(() => {\n  nodeDefStore.showExperimental = settingStore.get(\n    'Comfy.Node.ShowExperimental'\n  )\n})\n\nwatchEffect(() => {\n  const spellcheckEnabled = settingStore.get('Comfy.TextareaWidget.Spellcheck')\n  const textareas = document.querySelectorAll<HTMLTextAreaElement>(\n    'textarea.comfy-multiline-input'\n  )\n\n  textareas.forEach((textarea: HTMLTextAreaElement) => {\n    textarea.spellcheck = spellcheckEnabled\n    // Force recheck to ensure visual update\n    textarea.focus()\n    textarea.blur()\n  })\n})\n\nwatch(\n  () => settingStore.get('Comfy.WidgetControlMode'),\n  () => {\n    if (!canvasStore.canvas) return\n\n    forEachNode(comfyApp.rootGraph, (n) => {\n      if (!n.widgets) return\n      for (const w of n.widgets) {\n        if (!w[IS_CONTROL_WIDGET]) continue\n        updateControlWidgetLabel(w)\n        if (!w.linkedWidgets) continue\n        for (const l of w.linkedWidgets) {\n          updateControlWidgetLabel(l)\n        }\n      }\n    })\n    canvasStore.canvas.setDirty(true)\n  }\n)\n\nwatch(\n  [() => canvasStore.canvas, () => settingStore.get('Comfy.ColorPalette')],\n  async ([canvas, currentPaletteId]) => {\n    if (!canvas) return\n\n    await colorPaletteService.loadColorPalette(currentPaletteId)\n  }\n)\n\nwatch(\n  () => settingStore.get('Comfy.Canvas.BackgroundImage'),\n  async () => {\n    if (!canvasStore.canvas) return\n    const currentPaletteId = colorPaletteStore.activePaletteId\n    if (!currentPaletteId) return\n\n    // Reload color palette to apply background image\n    await colorPaletteService.loadColorPalette(currentPaletteId)\n    // Mark background canvas as dirty\n    canvasStore.canvas.setDirty(false, true)\n  }\n)\nwatch(\n  () => colorPaletteStore.activePaletteId,\n  async (newValue) => {\n    await settingStore.set('Comfy.ColorPalette', newValue)\n  }\n)\n\n// Update the progress of executing nodes\nwatch(\n  () =>\n    [executionStore.nodeLocationProgressStates, canvasStore.canvas] as const,\n  ([nodeLocationProgressStates, canvas]) => {\n    if (!canvas?.graph) return\n    for (const node of canvas.graph.nodes) {\n      const nodeLocatorId = useWorkflowStore().nodeIdToNodeLocatorId(node.id)\n      const progressState = nodeLocationProgressStates[nodeLocatorId]\n      if (progressState && progressState.state === 'running') {\n        node.progress = progressState.value / progressState.max\n      } else {\n        node.progress = undefined\n      }\n    }\n\n    // Force canvas redraw to ensure progress updates are visible\n    canvas.setDirty(true, false)\n  },\n  { deep: true }\n)\n\n// Update node slot errors for LiteGraph nodes\n// (Vue nodes read from store directly)\nwatch(\n  () => executionStore.lastNodeErrors,\n  (lastNodeErrors) => {\n    if (!comfyApp.graph) return\n\n    forEachNode(comfyApp.rootGraph, (node) => {\n      // Clear existing errors\n      for (const slot of node.inputs) {\n        delete slot.hasErrors\n      }\n      for (const slot of node.outputs) {\n        delete slot.hasErrors\n      }\n\n      const nodeErrors = lastNodeErrors?.[node.id]\n      if (!nodeErrors) return\n\n      const validErrors = nodeErrors.errors.filter(\n        (error) => error.extra_info?.input_name !== undefined\n      )\n\n      validErrors.forEach((error) => {\n        const inputName = error.extra_info!.input_name!\n        const inputIndex = node.findInputSlot(inputName)\n        if (inputIndex !== -1) {\n          node.inputs[inputIndex].hasErrors = true\n        }\n      })\n    })\n\n    comfyApp.canvas.setDirty(true, true)\n  }\n)\n\nuseEventListener(\n  canvasRef,\n  'litegraph:no-items-selected',\n  () => {\n    toastStore.add({\n      severity: 'warn',\n      summary: t('toastMessages.nothingSelected'),\n      life: 2000\n    })\n  },\n  { passive: true }\n)\n\nconst loadCustomNodesI18n = async () => {\n  try {\n    const i18nData = await api.getCustomNodesI18n()\n    mergeCustomNodesI18n(i18nData)\n  } catch (error) {\n    console.error('Failed to load custom nodes i18n', error)\n  }\n}\n\nconst comfyAppReady = ref(false)\nconst workflowPersistence = useWorkflowPersistence()\nuseCanvasDrop(canvasRef)\nuseLitegraphSettings()\nuseNodeBadge()\n\nonMounted(async () => {\n  useGlobalLitegraph()\n  useContextMenuTranslation()\n  useCopy()\n  usePaste()\n  useWorkflowAutoSave()\n  useVueFeatureFlags()\n\n  comfyApp.vueAppReady = true\n\n  workspaceStore.spinner = true\n  // ChangeTracker needs to be initialized before setup, as it will overwrite\n  // some listeners of litegraph canvas.\n  ChangeTracker.init()\n  await loadCustomNodesI18n()\n  try {\n    await settingStore.loadSettingValues()\n  } catch (error) {\n    if (error instanceof UnauthorizedError) {\n      localStorage.removeItem('Comfy.userId')\n      localStorage.removeItem('Comfy.userName')\n      window.location.reload()\n    } else {\n      throw error\n    }\n  }\n  CORE_SETTINGS.forEach(settingStore.addSetting)\n\n  await newUserService().initializeIfNewUser(settingStore)\n\n  // @ts-expect-error fixme ts strict error\n  await comfyApp.setup(canvasRef.value)\n  canvasStore.canvas = comfyApp.canvas\n  canvasStore.canvas.render_canvas_border = false\n  workspaceStore.spinner = false\n  useSearchBoxStore().setPopoverRef(nodeSearchboxPopoverRef.value)\n\n  window.app = comfyApp\n  window.graph = comfyApp.graph\n\n  comfyAppReady.value = true\n\n  vueNodeLifecycle.setupEmptyGraphListener()\n\n  comfyApp.canvas.onSelectionChange = useChainCallback(\n    comfyApp.canvas.onSelectionChange,\n    () => canvasStore.updateSelectedItems()\n  )\n\n  // Load color palette\n  colorPaletteStore.customPalettes = settingStore.get(\n    'Comfy.CustomColorPalettes'\n  )\n\n  // Restore saved workflow and workflow tabs state\n  await workflowPersistence.initializeWorkflow()\n  workflowPersistence.restoreWorkflowTabsState()\n\n  // Load template from URL if present\n  await workflowPersistence.loadTemplateFromUrlIfPresent()\n\n  // Initialize release store to fetch releases from comfy-api (fire-and-forget)\n  const { useReleaseStore } =\n    await import('@/platform/updates/common/releaseStore')\n  const releaseStore = useReleaseStore()\n  void releaseStore.initialize()\n\n  // Start watching for locale change after the initial value is loaded.\n  watch(\n    () => settingStore.get('Comfy.Locale'),\n    async () => {\n      await useCommandStore().execute('Comfy.RefreshNodeDefinitions')\n      await useWorkflowService().reloadCurrentWorkflow()\n    }\n  )\n\n  whenever(\n    () => useCanvasStore().canvas,\n    (canvas) => {\n      useEventListener(canvas.canvas, 'litegraph:set-graph', () => {\n        useWorkflowStore().updateActiveGraph()\n      })\n    },\n    { immediate: true }\n  )\n\n  emit('ready')\n})\n\nonUnmounted(() => {\n  vueNodeLifecycle.cleanup()\n})\n</script>\n","<template>\n  <Toast group=\"reroute-migration\">\n    <template #message>\n      <div class=\"flex flex-auto flex-col items-start\">\n        <div class=\"my-4 text-lg font-medium\">\n          {{ t('toastMessages.migrateToLitegraphReroute') }}\n        </div>\n        <Button class=\"self-end\" size=\"sm\" @click=\"migrateToLitegraphReroute\">\n          {{ t('g.migrate') }}\n        </Button>\n      </div>\n    </template>\n  </Toast>\n</template>\n\n<script setup lang=\"ts\">\nimport { useToast } from 'primevue'\nimport Toast from 'primevue/toast'\nimport { useI18n } from 'vue-i18n'\n\nimport Button from '@/components/ui/button/Button.vue'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport type { WorkflowJSON04 } from '@/platform/workflow/validation/schemas/workflowSchema'\nimport { app } from '@/scripts/app'\nimport { migrateLegacyRerouteNodes } from '@/utils/migration/migrateReroute'\n\nconst { t } = useI18n()\nconst toast = useToast()\n\nconst workflowStore = useWorkflowStore()\nconst migrateToLitegraphReroute = async () => {\n  const workflowJSON = app.rootGraph.serialize() as unknown as WorkflowJSON04\n  const migratedWorkflowJSON = migrateLegacyRerouteNodes(workflowJSON)\n  await app.loadGraphData(\n    migratedWorkflowJSON,\n    false,\n    false,\n    workflowStore.activeWorkflow\n  )\n  toast.removeGroup('reroute-migration')\n}\n</script>\n","import { useTitle } from '@vueuse/core'\nimport { computed } from 'vue'\n\nimport { t } from '@/i18n'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { useExecutionStore } from '@/stores/executionStore'\nimport { useWorkspaceStore } from '@/stores/workspaceStore'\n\nconst DEFAULT_TITLE = 'ComfyUI'\nconst TITLE_SUFFIX = ' - ComfyUI'\n\nexport const useBrowserTabTitle = () => {\n  const executionStore = useExecutionStore()\n  const settingStore = useSettingStore()\n  const workflowStore = useWorkflowStore()\n  const workspaceStore = useWorkspaceStore()\n\n  const executionText = computed(() =>\n    executionStore.isIdle\n      ? ''\n      : `[${Math.round(executionStore.executionProgress * 100)}%]`\n  )\n\n  const newMenuEnabled = computed(\n    () => settingStore.get('Comfy.UseNewMenu') !== 'Disabled'\n  )\n\n  const isAutoSaveEnabled = computed(\n    () => settingStore.get('Comfy.Workflow.AutoSave') === 'after delay'\n  )\n\n  const isActiveWorkflowModified = computed(\n    () => !!workflowStore.activeWorkflow?.isModified\n  )\n  const isActiveWorkflowPersisted = computed(\n    () => !!workflowStore.activeWorkflow?.isPersisted\n  )\n\n  const shouldShowUnsavedIndicator = computed(() => {\n    if (workspaceStore.shiftDown) return false\n    if (isAutoSaveEnabled.value) return false\n    if (!isActiveWorkflowPersisted.value) return true\n    if (isActiveWorkflowModified.value) return true\n    return false\n  })\n\n  const isUnsavedText = computed(() =>\n    shouldShowUnsavedIndicator.value ? ' *' : ''\n  )\n  const workflowNameText = computed(() => {\n    const workflowName = workflowStore.activeWorkflow?.filename\n    return workflowName\n      ? isUnsavedText.value + workflowName + TITLE_SUFFIX\n      : DEFAULT_TITLE\n  })\n\n  const nodeExecutionTitle = computed(() => {\n    // Check if any nodes are in progress\n    const nodeProgressEntries = Object.entries(\n      executionStore.nodeProgressStates\n    )\n    const runningNodes = nodeProgressEntries.filter(\n      ([_, state]) => state.state === 'running'\n    )\n\n    if (runningNodes.length === 0) {\n      return ''\n    }\n\n    // If multiple nodes are running\n    if (runningNodes.length > 1) {\n      return `${executionText.value}[${runningNodes.length} ${t('g.nodesRunning', 'nodes running')}]`\n    }\n\n    // If only one node is running\n    const [nodeId, state] = runningNodes[0]\n    const progress = Math.round((state.value / state.max) * 100)\n    const nodeType =\n      executionStore.activePrompt?.workflow?.changeTracker?.activeState.nodes.find(\n        (n) => String(n.id) === nodeId\n      )?.type || 'Node'\n\n    return `${executionText.value}[${progress}%] ${nodeType}`\n  })\n\n  const workflowTitle = computed(\n    () =>\n      executionText.value +\n      (newMenuEnabled.value ? workflowNameText.value : DEFAULT_TITLE)\n  )\n\n  const title = computed(() => nodeExecutionTitle.value || workflowTitle.value)\n  useTitle(title)\n}\n","<template>\n  <div class=\"size-full bg-modal-panel-background pr-6 pb-8 pl-4\">\n    <slot></slot>\n  </div>\n</template>\n","<template>\n  <BaseModalLayout :content-title=\"$t('assetBrowser.checkpoints')\">\n    <template #leftPanel>\n      <LeftSidePanel v-model=\"selectedNavItem\" :nav-items=\"tempNavigation\">\n        <template #header-icon>\n          <i class=\"text-neutral icon-[lucide--puzzle]\" />\n        </template>\n        <template #header-title>\n          <span class=\"text-neutral text-base\">{{ $t('g.title') }}</span>\n        </template>\n      </LeftSidePanel>\n    </template>\n\n    <template #header>\n      <SearchBox v-model=\"searchQuery\" size=\"lg\" class=\"max-w-[384px]\" />\n    </template>\n\n    <template #header-right-area>\n      <div class=\"flex gap-2\">\n        <Button variant=\"primary\" @click=\"() => {}\">\n          <i class=\"icon-[lucide--upload]\" />\n          <span>{{ $t('g.upload') }}</span>\n        </Button>\n        <MoreButton>\n          <template #default=\"{ close }\">\n            <Button\n              variant=\"secondary\"\n              @click=\"\n                () => {\n                  close()\n                }\n              \"\n            >\n              <i class=\"icon-[lucide--download]\" />\n              <span>{{ $t('g.settings') }}</span>\n            </Button>\n            <Button\n              variant=\"primary\"\n              @click=\"\n                () => {\n                  close()\n                }\n              \"\n            >\n              <i class=\"icon-[lucide--scroll]\" />\n              <span>{{ $t('g.profile') }}</span>\n            </Button>\n          </template>\n        </MoreButton>\n      </div>\n    </template>\n\n    <template #contentFilter>\n      <div class=\"relative flex gap-2 px-6 pb-4\">\n        <MultiSelect\n          v-model=\"selectedFrameworks\"\n          v-model:search-query=\"searchText\"\n          class=\"w-[250px]\"\n          :label=\"$t('assetBrowser.selectFrameworks')\"\n          :options=\"frameworkOptions\"\n          :show-search-box=\"true\"\n          :show-selected-count=\"true\"\n          :show-clear-button=\"true\"\n        />\n        <MultiSelect\n          v-model=\"selectedProjects\"\n          :label=\"$t('assetBrowser.selectProjects')\"\n          :options=\"projectOptions\"\n        />\n        <SingleSelect\n          v-model=\"selectedSort\"\n          :label=\"$t('assetBrowser.sortingType')\"\n          :options=\"sortOptions\"\n          class=\"w-[135px]\"\n        >\n          <template #icon>\n            <i class=\"icon-[lucide--filter]\" />\n          </template>\n        </SingleSelect>\n      </div>\n    </template>\n\n    <template #content>\n      <!-- Card Examples -->\n      <div :style=\"gridStyle\">\n        <CardContainer v-for=\"i in 100\" :key=\"i\" size=\"regular\">\n          <template #top>\n            <CardTop ratio=\"landscape\">\n              <template #default>\n                <div class=\"h-full w-full bg-blue-500\"></div>\n              </template>\n              <template #top-right>\n                <Button\n                  size=\"icon\"\n                  class=\"!bg-white !text-neutral-900\"\n                  @click=\"() => {}\"\n                >\n                  <i class=\"icon-[lucide--info]\" />\n                </Button>\n              </template>\n              <template #bottom-right>\n                <SquareChip label=\"png\" />\n                <SquareChip label=\"1.2 MB\" />\n                <SquareChip label=\"LoRA\">\n                  <template #icon>\n                    <i class=\"icon-[lucide--folder]\" />\n                  </template>\n                </SquareChip>\n              </template>\n            </CardTop>\n          </template>\n          <template #bottom>\n            <CardBottom></CardBottom>\n          </template>\n        </CardContainer>\n      </div>\n    </template>\n\n    <template #rightPanel>\n      <RightSidePanel></RightSidePanel>\n    </template>\n  </BaseModalLayout>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, provide, ref } from 'vue'\n\nimport MoreButton from '@/components/button/MoreButton.vue'\nimport CardBottom from '@/components/card/CardBottom.vue'\nimport CardContainer from '@/components/card/CardContainer.vue'\nimport CardTop from '@/components/card/CardTop.vue'\nimport SquareChip from '@/components/chip/SquareChip.vue'\nimport SearchBox from '@/components/common/SearchBox.vue'\nimport MultiSelect from '@/components/input/MultiSelect.vue'\nimport SingleSelect from '@/components/input/SingleSelect.vue'\nimport Button from '@/components/ui/button/Button.vue'\nimport BaseModalLayout from '@/components/widget/layout/BaseModalLayout.vue'\nimport LeftSidePanel from '@/components/widget/panel/LeftSidePanel.vue'\nimport RightSidePanel from '@/components/widget/panel/RightSidePanel.vue'\nimport type { NavGroupData, NavItemData } from '@/types/navTypes'\nimport { OnCloseKey } from '@/types/widgetTypes'\nimport { createGridStyle } from '@/utils/gridUtil'\n\nconst frameworkOptions = ref([\n  { name: 'Vue', value: 'vue' },\n  { name: 'React', value: 'react' },\n  { name: 'Angular', value: 'angular' },\n  { name: 'Svelte', value: 'svelte' }\n])\n\nconst projectOptions = ref([\n  { name: 'Project A', value: 'proj-a' },\n  { name: 'Project B', value: 'proj-b' },\n  { name: 'Project C', value: 'proj-c' }\n])\n\nconst sortOptions = ref([\n  { name: 'Popular', value: 'popular' },\n  { name: 'Latest', value: 'latest' },\n  { name: 'A  Z', value: 'az' }\n])\n\nconst tempNavigation = ref<(NavItemData | NavGroupData)[]>([\n  { id: 'installed', label: 'Installed', icon: 'icon-[lucide--download]' },\n  {\n    title: 'TAGS',\n    items: [\n      { id: 'tag-sd15', label: 'SD 1.5', icon: 'icon-[lucide--tag]' },\n      { id: 'tag-sdxl', label: 'SDXL', icon: 'icon-[lucide--tag]' },\n      { id: 'tag-utility', label: 'Utility', icon: 'icon-[lucide--tag]' }\n    ]\n  },\n  {\n    title: 'CATEGORIES',\n    items: [\n      { id: 'cat-models', label: 'Models', icon: 'icon-[lucide--layers]' },\n      { id: 'cat-nodes', label: 'Nodes', icon: 'icon-[lucide--grid-3x3]' }\n    ]\n  }\n])\n\nconst { onClose } = defineProps<{\n  onClose: () => void\n}>()\n\nprovide(OnCloseKey, onClose)\n\nconst searchQuery = ref<string>('')\nconst searchText = ref<string>('')\nconst selectedFrameworks = ref([])\nconst selectedProjects = ref([])\nconst selectedSort = ref<string>('popular')\n\nconst selectedNavItem = ref<string | null>('installed')\n\nconst gridStyle = computed(() => createGridStyle())\n</script>\n","import SampleModelSelector from '@/components/widget/SampleModelSelector.vue'\nimport { useDialogService } from '@/services/dialogService'\nimport { useDialogStore } from '@/stores/dialogStore'\n\nconst DIALOG_KEY = 'global-model-selector'\n\nexport const useModelSelectorDialog = () => {\n  const dialogService = useDialogService()\n  const dialogStore = useDialogStore()\n\n  function hide() {\n    dialogStore.closeDialog({ key: DIALOG_KEY })\n  }\n\n  function show() {\n    dialogService.showLayoutDialog({\n      key: DIALOG_KEY,\n      component: SampleModelSelector,\n      props: {\n        onClose: hide\n      }\n    })\n  }\n\n  return {\n    show,\n    hide\n  }\n}\n","import { LiteGraph } from '@/lib/litegraph/src/litegraph'\nimport type { LGraphNode, Point } from '@/lib/litegraph/src/litegraph'\nimport { assetItemSchema } from '@/platform/assets/schemas/assetSchema'\nimport type { AssetItem } from '@/platform/assets/schemas/assetSchema'\nimport {\n  MISSING_TAG,\n  MODELS_TAG\n} from '@/platform/assets/services/assetService'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { app } from '@/scripts/app'\nimport { useLitegraphService } from '@/services/litegraphService'\nimport { useModelToNodeStore } from '@/stores/modelToNodeStore'\n\ninterface CreateNodeOptions {\n  position?: Point\n}\n\ntype NodeCreationErrorCode =\n  | 'INVALID_ASSET'\n  | 'NO_PROVIDER'\n  | 'NODE_CREATION_FAILED'\n  | 'MISSING_WIDGET'\n  | 'NO_GRAPH'\n\ninterface NodeCreationError {\n  code: NodeCreationErrorCode\n  message: string\n  assetId: string\n  details?: Record<string, unknown>\n}\n\ntype Result<T, E> = { success: true; value: T } | { success: false; error: E }\n\n/**\n * Creates a LiteGraph node from an asset item.\n *\n * **Boundary Function**: Bridges Vue reactive domain with LiteGraph canvas domain.\n *\n * @param asset - Asset item to create node from (Vue domain)\n * @param options - Optional position and configuration\n * @returns Result with LiteGraph node (Canvas domain) or error details\n *\n * @remarks\n * This function performs side effects on the canvas graph. Validation failures\n * return error results rather than throwing to allow graceful degradation in UI contexts.\n * Widget validation occurs before graph mutation to prevent orphaned nodes.\n */\nexport function createModelNodeFromAsset(\n  asset: AssetItem,\n  options?: CreateNodeOptions\n): Result<LGraphNode, NodeCreationError> {\n  const validatedAsset = assetItemSchema.safeParse(asset)\n\n  if (!validatedAsset.success) {\n    const errorMessage = validatedAsset.error.errors\n      .map((e) => `${e.path.join('.')}: ${e.message}`)\n      .join(', ')\n    console.error('Invalid asset item:', errorMessage)\n    return {\n      success: false,\n      error: {\n        code: 'INVALID_ASSET',\n        message: 'Asset schema validation failed',\n        assetId: asset.id,\n        details: { validationErrors: errorMessage }\n      }\n    }\n  }\n\n  const validAsset = validatedAsset.data\n\n  const userMetadata = validAsset.user_metadata\n  if (!userMetadata) {\n    console.error(`Asset ${validAsset.id} missing required user_metadata`)\n    return {\n      success: false,\n      error: {\n        code: 'INVALID_ASSET',\n        message: 'Asset missing required user_metadata',\n        assetId: validAsset.id\n      }\n    }\n  }\n\n  const filename = userMetadata.filename\n  if (typeof filename !== 'string' || filename.length === 0) {\n    console.error(\n      `Asset ${validAsset.id} has invalid user_metadata.filename (expected non-empty string, got ${typeof filename})`\n    )\n    return {\n      success: false,\n      error: {\n        code: 'INVALID_ASSET',\n        message: `Invalid filename (expected non-empty string, got ${typeof filename})`,\n        assetId: validAsset.id\n      }\n    }\n  }\n\n  if (validAsset.tags.length === 0) {\n    console.error(\n      `Asset ${validAsset.id} has no tags defined (expected at least one category tag)`\n    )\n    return {\n      success: false,\n      error: {\n        code: 'INVALID_ASSET',\n        message: 'Asset has no tags defined',\n        assetId: validAsset.id\n      }\n    }\n  }\n\n  const category = validAsset.tags.find(\n    (tag) => tag !== MODELS_TAG && tag !== MISSING_TAG\n  )\n  if (!category) {\n    console.error(\n      `Asset ${validAsset.id} has no valid category tag. Available tags: ${validAsset.tags.join(', ')} (expected tag other than '${MODELS_TAG}' or '${MISSING_TAG}')`\n    )\n    return {\n      success: false,\n      error: {\n        code: 'INVALID_ASSET',\n        message: 'Asset has no valid category tag',\n        assetId: validAsset.id,\n        details: { availableTags: validAsset.tags }\n      }\n    }\n  }\n\n  const modelToNodeStore = useModelToNodeStore()\n  const provider = modelToNodeStore.getNodeProvider(category)\n  if (!provider) {\n    console.error(`No node provider registered for category: ${category}`)\n    return {\n      success: false,\n      error: {\n        code: 'NO_PROVIDER',\n        message: `No node provider registered for category: ${category}`,\n        assetId: validAsset.id,\n        details: { category }\n      }\n    }\n  }\n\n  const litegraphService = useLitegraphService()\n  const pos = options?.position ?? litegraphService.getCanvasCenter()\n\n  const node = LiteGraph.createNode(\n    provider.nodeDef.name,\n    provider.nodeDef.display_name,\n    { pos }\n  )\n\n  if (!node) {\n    console.error(`Failed to create node for type: ${provider.nodeDef.name}`)\n    return {\n      success: false,\n      error: {\n        code: 'NODE_CREATION_FAILED',\n        message: `Failed to create node for type: ${provider.nodeDef.name}`,\n        assetId: validAsset.id,\n        details: { nodeType: provider.nodeDef.name }\n      }\n    }\n  }\n\n  const workflowStore = useWorkflowStore()\n  const targetGraph = workflowStore.isSubgraphActive\n    ? workflowStore.activeSubgraph\n    : app.canvas.graph\n\n  if (!targetGraph) {\n    console.error('No active graph available')\n    return {\n      success: false,\n      error: {\n        code: 'NO_GRAPH',\n        message: 'No active graph available',\n        assetId: validAsset.id\n      }\n    }\n  }\n\n  const widget = node.widgets?.find((w) => w.name === provider.key)\n  if (!widget) {\n    console.error(\n      `Widget ${provider.key} not found on node ${provider.nodeDef.name}`\n    )\n    return {\n      success: false,\n      error: {\n        code: 'MISSING_WIDGET',\n        message: `Widget ${provider.key} not found on node ${provider.nodeDef.name}`,\n        assetId: validAsset.id,\n        details: { widgetName: provider.key, nodeType: provider.nodeDef.name }\n      }\n    }\n  }\n\n  // Set widget value BEFORE adding to graph so the node is created with correct value\n  widget.value = filename\n\n  // Now add the node to the graph with the correct widget value already set\n  targetGraph.add(node)\n\n  return { success: true, value: node }\n}\n","import { isCloud } from '@/platform/distribution/types'\n\n/**\n * Zendesk ticket form field IDs.\n */\nconst ZENDESK_FIELDS = {\n  /** Distribution tag (cloud vs OSS) */\n  DISTRIBUTION: 'tf_42243568391700',\n  /** User email (anonymous requester) */\n  ANONYMOUS_EMAIL: 'tf_anonymous_requester_email',\n  /** User email (authenticated) */\n  EMAIL: 'tf_40029135130388',\n  /** User ID */\n  USER_ID: 'tf_42515251051412'\n} as const\n\nconst SUPPORT_BASE_URL = 'https://support.comfy.org/hc/en-us/requests/new'\n\n/**\n * Builds the support URL with optional user information for pre-filling.\n * Users without login information will still get a valid support URL without pre-fill.\n *\n * @param params - User information to pre-fill in the support form\n * @returns Complete Zendesk support URL with query parameters\n */\nexport function buildSupportUrl(params?: {\n  userEmail?: string | null\n  userId?: string | null\n}): string {\n  const searchParams = new URLSearchParams({\n    [ZENDESK_FIELDS.DISTRIBUTION]: isCloud ? 'ccloud' : 'oss'\n  })\n\n  if (params?.userEmail) {\n    searchParams.append(ZENDESK_FIELDS.ANONYMOUS_EMAIL, params.userEmail)\n    searchParams.append(ZENDESK_FIELDS.EMAIL, params.userEmail)\n  }\n  if (params?.userId) {\n    searchParams.append(ZENDESK_FIELDS.USER_ID, params.userId)\n  }\n\n  return `${SUPPORT_BASE_URL}?${searchParams.toString()}`\n}\n","import { useCurrentUser } from '@/composables/auth/useCurrentUser'\nimport { useFirebaseAuthActions } from '@/composables/auth/useFirebaseAuthActions'\nimport { useSelectedLiteGraphItems } from '@/composables/canvas/useSelectedLiteGraphItems'\nimport { useSubgraphOperations } from '@/composables/graph/useSubgraphOperations'\nimport { useExternalLink } from '@/composables/useExternalLink'\nimport { useModelSelectorDialog } from '@/composables/useModelSelectorDialog'\nimport {\n  DEFAULT_DARK_COLOR_PALETTE,\n  DEFAULT_LIGHT_COLOR_PALETTE\n} from '@/constants/coreColorPalettes'\nimport { tryToggleWidgetPromotion } from '@/core/graph/subgraph/proxyWidgetUtils'\nimport { t } from '@/i18n'\nimport {\n  LGraphEventMode,\n  LGraphGroup,\n  LGraphNode,\n  LiteGraph\n} from '@/lib/litegraph/src/litegraph'\nimport type { Point } from '@/lib/litegraph/src/litegraph'\nimport { useAssetBrowserDialog } from '@/platform/assets/composables/useAssetBrowserDialog'\nimport { createModelNodeFromAsset } from '@/platform/assets/utils/createModelNodeFromAsset'\nimport { useSubscription } from '@/platform/cloud/subscription/composables/useSubscription'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { buildSupportUrl } from '@/platform/support/config'\nimport { useTelemetry } from '@/platform/telemetry'\nimport type { ExecutionTriggerSource } from '@/platform/telemetry/types'\nimport { useToastStore } from '@/platform/updates/common/toastStore'\nimport { useWorkflowService } from '@/platform/workflow/core/services/workflowService'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport type { ComfyWorkflow } from '@/platform/workflow/management/stores/workflowStore'\nimport {\n  useCanvasStore,\n  useTitleEditorStore\n} from '@/renderer/core/canvas/canvasStore'\nimport { api } from '@/scripts/api'\nimport { app } from '@/scripts/app'\nimport { useDialogService } from '@/services/dialogService'\nimport { useLitegraphService } from '@/services/litegraphService'\nimport type { ComfyCommand } from '@/stores/commandStore'\nimport { useExecutionStore } from '@/stores/executionStore'\nimport { useHelpCenterStore } from '@/stores/helpCenterStore'\nimport {\n  useQueueSettingsStore,\n  useQueueStore,\n  useQueueUIStore\n} from '@/stores/queueStore'\nimport { useSubgraphNavigationStore } from '@/stores/subgraphNavigationStore'\nimport { useSubgraphStore } from '@/stores/subgraphStore'\nimport { useBottomPanelStore } from '@/stores/workspace/bottomPanelStore'\nimport { useColorPaletteStore } from '@/stores/workspace/colorPaletteStore'\nimport { useRightSidePanelStore } from '@/stores/workspace/rightSidePanelStore'\nimport { useSearchBoxStore } from '@/stores/workspace/searchBoxStore'\nimport { useWorkspaceStore } from '@/stores/workspaceStore'\nimport {\n  getAllNonIoNodesInSubgraph,\n  getExecutionIdsForSelectedNodes\n} from '@/utils/graphTraversalUtil'\nimport { filterOutputNodes } from '@/utils/nodeFilterUtil'\nimport {\n  ManagerUIState,\n  useManagerState\n} from '@/workbench/extensions/manager/composables/useManagerState'\nimport { ManagerTab } from '@/workbench/extensions/manager/types/comfyManagerTypes'\n\nimport { useWorkflowTemplateSelectorDialog } from './useWorkflowTemplateSelectorDialog'\n\nconst { isActiveSubscription, showSubscriptionDialog } = useSubscription()\n\nconst moveSelectedNodesVersionAdded = '1.22.2'\nexport function useCoreCommands(): ComfyCommand[] {\n  const workflowService = useWorkflowService()\n  const workflowStore = useWorkflowStore()\n  const dialogService = useDialogService()\n  const colorPaletteStore = useColorPaletteStore()\n  const firebaseAuthActions = useFirebaseAuthActions()\n  const toastStore = useToastStore()\n  const canvasStore = useCanvasStore()\n  const executionStore = useExecutionStore()\n  const telemetry = useTelemetry()\n  const { staticUrls, buildDocsUrl } = useExternalLink()\n  const settingStore = useSettingStore()\n\n  const bottomPanelStore = useBottomPanelStore()\n\n  const { getSelectedNodes, toggleSelectedNodesMode } =\n    useSelectedLiteGraphItems()\n  const getTracker = () => workflowStore.activeWorkflow?.changeTracker\n\n  function isQueuePanelV2Enabled() {\n    return settingStore.get('Comfy.Queue.QPOV2')\n  }\n\n  async function toggleQueuePanelV2() {\n    await settingStore.set('Comfy.Queue.QPOV2', !isQueuePanelV2Enabled())\n  }\n\n  const moveSelectedNodes = (\n    positionUpdater: (pos: Point, gridSize: number) => Point\n  ) => {\n    const selectedNodes = getSelectedNodes()\n    if (selectedNodes.length === 0) return\n\n    const gridSize = useSettingStore().get('Comfy.SnapToGrid.GridSize')\n    selectedNodes.forEach((node) => {\n      node.pos = positionUpdater(node.pos, gridSize)\n    })\n    app.canvas.state.selectionChanged = true\n    app.canvas.setDirty(true, true)\n  }\n\n  const commands = [\n    {\n      id: 'Comfy.NewBlankWorkflow',\n      icon: 'pi pi-plus',\n      label: 'New Blank Workflow',\n      menubarLabel: 'New',\n      category: 'essentials' as const,\n      function: async () => {\n        const previousWorkflowHadNodes = app.rootGraph._nodes.length > 0\n        await workflowService.loadBlankWorkflow()\n        telemetry?.trackWorkflowCreated({\n          workflow_type: 'blank',\n          previous_workflow_had_nodes: previousWorkflowHadNodes\n        })\n      }\n    },\n    {\n      id: 'Comfy.OpenWorkflow',\n      icon: 'pi pi-folder-open',\n      label: 'Open Workflow',\n      menubarLabel: 'Open',\n      category: 'essentials' as const,\n      function: () => {\n        app.ui.loadFile()\n      }\n    },\n    {\n      id: 'Comfy.LoadDefaultWorkflow',\n      icon: 'pi pi-code',\n      label: 'Load Default Workflow',\n      function: async () => {\n        const previousWorkflowHadNodes = app.rootGraph._nodes.length > 0\n        await workflowService.loadDefaultWorkflow()\n        telemetry?.trackWorkflowCreated({\n          workflow_type: 'default',\n          previous_workflow_had_nodes: previousWorkflowHadNodes\n        })\n      }\n    },\n    {\n      id: 'Comfy.SaveWorkflow',\n      icon: 'pi pi-save',\n      label: 'Save Workflow',\n      menubarLabel: 'Save',\n      category: 'essentials' as const,\n      function: async () => {\n        const workflow = useWorkflowStore().activeWorkflow as ComfyWorkflow\n        if (!workflow) return\n\n        await workflowService.saveWorkflow(workflow)\n      }\n    },\n    {\n      id: 'Comfy.PublishSubgraph',\n      icon: 'pi pi-save',\n      label: 'Publish Subgraph',\n      menubarLabel: 'Publish',\n      function: async () => {\n        await useSubgraphStore().publishSubgraph()\n      }\n    },\n    {\n      id: 'Comfy.SaveWorkflowAs',\n      icon: 'pi pi-save',\n      label: 'Save Workflow As',\n      menubarLabel: 'Save As',\n      category: 'essentials' as const,\n      function: async () => {\n        const workflow = useWorkflowStore().activeWorkflow as ComfyWorkflow\n        if (!workflow) return\n\n        await workflowService.saveWorkflowAs(workflow)\n      }\n    },\n    {\n      id: 'Comfy.ExportWorkflow',\n      icon: 'pi pi-download',\n      label: 'Export Workflow',\n      menubarLabel: 'Export',\n      category: 'essentials' as const,\n      function: async () => {\n        await workflowService.exportWorkflow('workflow', 'workflow')\n      }\n    },\n    {\n      id: 'Comfy.ExportWorkflowAPI',\n      icon: 'pi pi-download',\n      label: 'Export Workflow (API Format)',\n      menubarLabel: 'Export (API)',\n      function: async () => {\n        await workflowService.exportWorkflow('workflow_api', 'output')\n      }\n    },\n    {\n      id: 'Comfy.Undo',\n      icon: 'pi pi-undo',\n      label: 'Undo',\n      category: 'essentials' as const,\n      function: async () => {\n        await getTracker()?.undo?.()\n      }\n    },\n    {\n      id: 'Comfy.Redo',\n      icon: 'pi pi-refresh',\n      label: 'Redo',\n      category: 'essentials' as const,\n      function: async () => {\n        await getTracker()?.redo?.()\n      }\n    },\n    {\n      id: 'Comfy.ClearWorkflow',\n      icon: 'pi pi-trash',\n      label: 'Clear Workflow',\n      category: 'essentials' as const,\n      function: () => {\n        const settingStore = useSettingStore()\n        if (\n          !settingStore.get('Comfy.ConfirmClear') ||\n          confirm('Clear workflow?')\n        ) {\n          app.clean()\n          if (app.canvas.subgraph) {\n            // `clear` is not implemented on subgraphs and the parent class's\n            // (`LGraph`) `clear` breaks the subgraph structure. For subgraphs,\n            // just clear the nodes but preserve input/output nodes and structure\n            const subgraph = app.canvas.subgraph\n            const nonIoNodes = getAllNonIoNodesInSubgraph(subgraph)\n            nonIoNodes.forEach((node) => subgraph.remove(node))\n          }\n          api.dispatchCustomEvent('graphCleared')\n        }\n      }\n    },\n    {\n      id: 'Comfy.Canvas.ResetView',\n      icon: 'pi pi-expand',\n      label: 'Reset View',\n      function: () => {\n        useLitegraphService().resetView()\n      }\n    },\n    {\n      id: 'Comfy.OpenClipspace',\n      icon: 'pi pi-clipboard',\n      label: 'Clipspace',\n      function: () => {\n        app.openClipspace()\n      }\n    },\n    {\n      id: 'Comfy.RefreshNodeDefinitions',\n      icon: 'pi pi-refresh',\n      label: 'Refresh Node Definitions',\n      category: 'essentials' as const,\n      function: async () => {\n        await app.refreshComboInNodes()\n      }\n    },\n    {\n      id: 'Comfy.Interrupt',\n      icon: 'pi pi-stop',\n      label: 'Interrupt',\n      category: 'essentials' as const,\n      function: async () => {\n        await api.interrupt(executionStore.activePromptId)\n        toastStore.add({\n          severity: 'info',\n          summary: t('g.interrupted'),\n          detail: t('toastMessages.interrupted'),\n          life: 1000\n        })\n      }\n    },\n    {\n      id: 'Comfy.ClearPendingTasks',\n      icon: 'pi pi-stop',\n      label: 'Clear Pending Tasks',\n      category: 'essentials' as const,\n      function: async () => {\n        await useQueueStore().clear(['queue'])\n        toastStore.add({\n          severity: 'info',\n          summary: t('g.confirmed'),\n          detail: t('toastMessages.pendingTasksDeleted'),\n          life: 3000\n        })\n      }\n    },\n    {\n      id: 'Comfy.BrowseTemplates',\n      icon: 'pi pi-folder-open',\n      label: 'Browse Templates',\n      function: () => {\n        useWorkflowTemplateSelectorDialog().show()\n      }\n    },\n    {\n      id: 'Comfy.Canvas.ZoomIn',\n      icon: 'pi pi-plus',\n      label: 'Zoom In',\n      category: 'view-controls' as const,\n      function: () => {\n        const ds = app.canvas.ds\n        ds.changeScale(\n          ds.scale * 1.1,\n          ds.element ? [ds.element.width / 2, ds.element.height / 2] : undefined\n        )\n        app.canvas.setDirty(true, true)\n      }\n    },\n    {\n      id: 'Comfy.Canvas.ZoomOut',\n      icon: 'pi pi-minus',\n      label: 'Zoom Out',\n      category: 'view-controls' as const,\n      function: () => {\n        const ds = app.canvas.ds\n        ds.changeScale(\n          ds.scale / 1.1,\n          ds.element ? [ds.element.width / 2, ds.element.height / 2] : undefined\n        )\n        app.canvas.setDirty(true, true)\n      }\n    },\n    {\n      id: 'Experimental.ToggleVueNodes',\n      label: () =>\n        `Experimental: ${\n          useSettingStore().get('Comfy.VueNodes.Enabled') ? 'Disable' : 'Enable'\n        } Nodes 2.0`,\n      function: async () => {\n        const settingStore = useSettingStore()\n        const current = settingStore.get('Comfy.VueNodes.Enabled') ?? false\n        await settingStore.set('Comfy.VueNodes.Enabled', !current)\n      }\n    },\n    {\n      id: 'Comfy.Canvas.FitView',\n      icon: 'pi pi-expand',\n      label: 'Fit view to selected nodes',\n      menubarLabel: 'Zoom to fit',\n      category: 'view-controls' as const,\n      function: () => {\n        if (app.canvas.empty) {\n          toastStore.add({\n            severity: 'error',\n            summary: t('toastMessages.emptyCanvas'),\n            life: 3000\n          })\n          return\n        }\n        app.canvas.fitViewToSelectionAnimated()\n      }\n    },\n    {\n      id: 'Comfy.Canvas.ToggleLock',\n      icon: 'pi pi-lock',\n      label: 'Canvas Toggle Lock',\n      category: 'view-controls' as const,\n      function: () => {\n        app.canvas.state.readOnly = !app.canvas.state.readOnly\n      }\n    },\n    {\n      id: 'Comfy.Canvas.Lock',\n      icon: 'pi pi-lock',\n      label: 'Lock Canvas',\n      category: 'view-controls' as const,\n      function: () => {\n        app.canvas.state.readOnly = true\n      }\n    },\n    {\n      id: 'Comfy.Canvas.Unlock',\n      icon: 'pi pi-lock-open',\n      label: 'Unlock Canvas',\n      function: () => {\n        app.canvas.state.readOnly = false\n      }\n    },\n    {\n      id: 'Comfy.Canvas.ToggleLinkVisibility',\n      icon: 'pi pi-eye',\n      label: 'Canvas Toggle Link Visibility',\n      menubarLabel: 'Node Links',\n      versionAdded: '1.3.6',\n\n      function: (() => {\n        const settingStore = useSettingStore()\n        let lastLinksRenderMode = LiteGraph.SPLINE_LINK\n\n        return async () => {\n          const currentMode = settingStore.get('Comfy.LinkRenderMode')\n\n          if (currentMode === LiteGraph.HIDDEN_LINK) {\n            // If links are hidden, restore the last positive value or default to spline mode\n            await settingStore.set('Comfy.LinkRenderMode', lastLinksRenderMode)\n          } else {\n            // If links are visible, store the current mode and hide links\n            lastLinksRenderMode = currentMode\n            await settingStore.set(\n              'Comfy.LinkRenderMode',\n              LiteGraph.HIDDEN_LINK\n            )\n          }\n        }\n      })(),\n      active: () =>\n        useSettingStore().get('Comfy.LinkRenderMode') !== LiteGraph.HIDDEN_LINK\n    },\n    {\n      id: 'Comfy.Canvas.ToggleMinimap',\n      icon: 'pi pi-map',\n      label: 'Canvas Toggle Minimap',\n      menubarLabel: 'Minimap',\n      versionAdded: '1.24.1',\n      function: async () => {\n        const settingStore = useSettingStore()\n        await settingStore.set(\n          'Comfy.Minimap.Visible',\n          !settingStore.get('Comfy.Minimap.Visible')\n        )\n      },\n      active: () => useSettingStore().get('Comfy.Minimap.Visible')\n    },\n    {\n      id: 'Comfy.Queue.ToggleOverlay',\n      icon: 'pi pi-history',\n      label: () => t('queue.toggleJobHistory'),\n      menubarLabel: () => t('queue.jobHistory'),\n      versionAdded: '1.37.0',\n      category: 'view-controls' as const,\n      function: () => {\n        useQueueUIStore().toggleOverlay()\n      },\n      active: () => useQueueUIStore().isOverlayExpanded\n    },\n    {\n      id: 'Comfy.QueuePrompt',\n      icon: 'pi pi-play',\n      label: 'Queue Prompt',\n      versionAdded: '1.3.7',\n      category: 'essentials' as const,\n      function: async (metadata?: {\n        subscribe_to_run?: boolean\n        trigger_source?: ExecutionTriggerSource\n      }) => {\n        useTelemetry()?.trackRunButton(metadata)\n        if (!isActiveSubscription.value) {\n          showSubscriptionDialog()\n          return\n        }\n\n        const batchCount = useQueueSettingsStore().batchCount\n\n        useTelemetry()?.trackWorkflowExecution()\n\n        await app.queuePrompt(0, batchCount)\n      }\n    },\n    {\n      id: 'Comfy.QueuePromptFront',\n      icon: 'pi pi-play',\n      label: 'Queue Prompt (Front)',\n      versionAdded: '1.3.7',\n      category: 'essentials' as const,\n      function: async (metadata?: {\n        subscribe_to_run?: boolean\n        trigger_source?: ExecutionTriggerSource\n      }) => {\n        useTelemetry()?.trackRunButton(metadata)\n        if (!isActiveSubscription.value) {\n          showSubscriptionDialog()\n          return\n        }\n\n        const batchCount = useQueueSettingsStore().batchCount\n\n        useTelemetry()?.trackWorkflowExecution()\n\n        await app.queuePrompt(-1, batchCount)\n      }\n    },\n    {\n      id: 'Comfy.QueueSelectedOutputNodes',\n      icon: 'pi pi-play',\n      label: 'Queue Selected Output Nodes',\n      versionAdded: '1.19.6',\n      function: async (metadata?: {\n        subscribe_to_run?: boolean\n        trigger_source?: ExecutionTriggerSource\n      }) => {\n        useTelemetry()?.trackRunButton(metadata)\n        if (!isActiveSubscription.value) {\n          showSubscriptionDialog()\n          return\n        }\n\n        const batchCount = useQueueSettingsStore().batchCount\n        const selectedNodes = getSelectedNodes()\n        const selectedOutputNodes = filterOutputNodes(selectedNodes)\n\n        if (selectedOutputNodes.length === 0) {\n          toastStore.add({\n            severity: 'error',\n            summary: t('toastMessages.nothingToQueue'),\n            detail: t('toastMessages.pleaseSelectOutputNodes'),\n            life: 3000\n          })\n          return\n        }\n\n        // Get execution IDs for all selected output nodes and their descendants\n        const executionIds =\n          getExecutionIdsForSelectedNodes(selectedOutputNodes)\n\n        if (executionIds.length === 0) {\n          toastStore.add({\n            severity: 'error',\n            summary: t('toastMessages.failedToQueue'),\n            detail: t('toastMessages.failedExecutionPathResolution'),\n            life: 3000\n          })\n          return\n        }\n        useTelemetry()?.trackWorkflowExecution()\n        await app.queuePrompt(0, batchCount, executionIds)\n      }\n    },\n    {\n      id: 'Comfy.ShowSettingsDialog',\n      icon: 'pi pi-cog',\n      label: 'Show Settings Dialog',\n      versionAdded: '1.3.7',\n      category: 'view-controls' as const,\n      function: () => {\n        dialogService.showSettingsDialog()\n      }\n    },\n    {\n      id: 'Comfy.Graph.GroupSelectedNodes',\n      icon: 'pi pi-sitemap',\n      label: 'Group Selected Nodes',\n      versionAdded: '1.3.7',\n      category: 'essentials' as const,\n      function: () => {\n        const { canvas } = app\n        if (!canvas.selectedItems?.size) {\n          toastStore.add({\n            severity: 'error',\n            summary: t('toastMessages.nothingToGroup'),\n            detail: t('toastMessages.pleaseSelectNodesToGroup'),\n            life: 3000\n          })\n          return\n        }\n        const group = new LGraphGroup()\n        const padding = useSettingStore().get(\n          'Comfy.GroupSelectedNodes.Padding'\n        )\n        group.resizeTo(canvas.selectedItems, padding)\n        canvas.graph?.add(group)\n\n        group.recomputeInsideNodes()\n\n        useTitleEditorStore().titleEditorTarget = group\n      }\n    },\n    {\n      id: 'Workspace.NextOpenedWorkflow',\n      icon: 'pi pi-step-forward',\n      label: 'Next Opened Workflow',\n      versionAdded: '1.3.9',\n      function: async () => {\n        await workflowService.loadNextOpenedWorkflow()\n      }\n    },\n    {\n      id: 'Workspace.PreviousOpenedWorkflow',\n      icon: 'pi pi-step-backward',\n      label: 'Previous Opened Workflow',\n      versionAdded: '1.3.9',\n      function: async () => {\n        await workflowService.loadPreviousOpenedWorkflow()\n      }\n    },\n    {\n      id: 'Comfy.Canvas.ToggleSelectedNodes.Mute',\n      icon: 'pi pi-volume-off',\n      label: 'Mute/Unmute Selected Nodes',\n      versionAdded: '1.3.11',\n      category: 'essentials' as const,\n      function: () => {\n        toggleSelectedNodesMode(LGraphEventMode.NEVER)\n        app.canvas.setDirty(true, true)\n      }\n    },\n    {\n      id: 'Comfy.Canvas.ToggleSelectedNodes.Bypass',\n      icon: 'pi pi-shield',\n      label: 'Bypass/Unbypass Selected Nodes',\n      versionAdded: '1.3.11',\n      category: 'essentials' as const,\n      function: () => {\n        toggleSelectedNodesMode(LGraphEventMode.BYPASS)\n        app.canvas.setDirty(true, true)\n      }\n    },\n    {\n      id: 'Comfy.Canvas.ToggleSelectedNodes.Pin',\n      icon: 'pi pi-pin',\n      label: 'Pin/Unpin Selected Nodes',\n      versionAdded: '1.3.11',\n      category: 'essentials' as const,\n      function: () => {\n        getSelectedNodes().forEach((node) => {\n          node.pin(!node.pinned)\n        })\n        app.canvas.setDirty(true, true)\n      }\n    },\n    {\n      id: 'Comfy.Canvas.ToggleSelected.Pin',\n      icon: 'pi pi-pin',\n      label: 'Pin/Unpin Selected Items',\n      versionAdded: '1.3.33',\n      function: () => {\n        for (const item of app.canvas.selectedItems) {\n          if (item instanceof LGraphNode || item instanceof LGraphGroup) {\n            item.pin(!item.pinned)\n          }\n        }\n        app.canvas.setDirty(true, true)\n      }\n    },\n    {\n      id: 'Comfy.Canvas.Resize',\n      icon: 'pi pi-minus',\n      label: 'Resize Selected Nodes',\n      versionAdded: '',\n      function: () => {\n        getSelectedNodes().forEach((node) => {\n          const optimalSize = node.computeSize()\n          node.setSize([optimalSize[0], optimalSize[1]])\n        })\n        app.canvas.setDirty(true, true)\n      }\n    },\n    {\n      id: 'Comfy.Canvas.ToggleSelectedNodes.Collapse',\n      icon: 'pi pi-minus',\n      label: 'Collapse/Expand Selected Nodes',\n      versionAdded: '1.3.11',\n      function: () => {\n        getSelectedNodes().forEach((node) => {\n          node.collapse()\n        })\n        app.canvas.setDirty(true, true)\n      }\n    },\n    {\n      id: 'Comfy.ToggleTheme',\n      icon: 'pi pi-moon',\n      label: 'Toggle Theme (Dark/Light)',\n      versionAdded: '1.3.12',\n      function: (() => {\n        let previousDarkTheme: string = DEFAULT_DARK_COLOR_PALETTE.id\n        let previousLightTheme: string = DEFAULT_LIGHT_COLOR_PALETTE.id\n\n        return async () => {\n          const settingStore = useSettingStore()\n          const theme = colorPaletteStore.completedActivePalette\n          if (theme.light_theme) {\n            previousLightTheme = theme.id\n            await settingStore.set('Comfy.ColorPalette', previousDarkTheme)\n          } else {\n            previousDarkTheme = theme.id\n            await settingStore.set('Comfy.ColorPalette', previousLightTheme)\n          }\n        }\n      })()\n    },\n    {\n      id: 'Workspace.ToggleBottomPanel',\n      icon: 'pi pi-list',\n      label: 'Toggle Bottom Panel',\n      menubarLabel: 'Bottom Panel',\n      versionAdded: '1.3.22',\n      category: 'view-controls' as const,\n      function: () => {\n        bottomPanelStore.toggleBottomPanel()\n      },\n      active: () => bottomPanelStore.bottomPanelVisible\n    },\n    {\n      id: 'Workspace.ToggleFocusMode',\n      icon: 'pi pi-eye',\n      label: 'Toggle Focus Mode',\n      menubarLabel: 'Focus Mode',\n      versionAdded: '1.3.27',\n      category: 'view-controls' as const,\n      function: () => {\n        useWorkspaceStore().toggleFocusMode()\n      },\n      active: () => useWorkspaceStore().focusMode\n    },\n    {\n      id: 'Comfy.Graph.FitGroupToContents',\n      icon: 'pi pi-expand',\n      label: 'Fit Group To Contents',\n      versionAdded: '1.4.9',\n      function: () => {\n        for (const group of app.canvas.selectedItems) {\n          if (group instanceof LGraphGroup) {\n            group.recomputeInsideNodes()\n            const padding = useSettingStore().get(\n              'Comfy.GroupSelectedNodes.Padding'\n            )\n            group.resizeTo(group.children, padding)\n            app.canvas.setDirty(false, true)\n          }\n        }\n      }\n    },\n    {\n      id: 'Comfy.Help.OpenComfyUIIssues',\n      icon: 'pi pi-github',\n      label: 'Open ComfyUI Issues',\n      menubarLabel: 'ComfyUI Issues',\n      versionAdded: '1.5.5',\n      function: () => {\n        telemetry?.trackHelpResourceClicked({\n          resource_type: 'github',\n          is_external: true,\n          source: 'menu'\n        })\n        window.open(staticUrls.githubIssues, '_blank')\n      }\n    },\n    {\n      id: 'Comfy.Help.OpenComfyUIDocs',\n      icon: 'pi pi-info-circle',\n      label: 'Open ComfyUI Docs',\n      menubarLabel: 'ComfyUI Docs',\n      versionAdded: '1.5.5',\n      function: () => {\n        telemetry?.trackHelpResourceClicked({\n          resource_type: 'docs',\n          is_external: true,\n          source: 'menu'\n        })\n        window.open(buildDocsUrl('/', { includeLocale: true }), '_blank')\n      }\n    },\n    {\n      id: 'Comfy.Help.OpenComfyOrgDiscord',\n      icon: 'pi pi-discord',\n      label: 'Open Comfy-Org Discord',\n      menubarLabel: 'Comfy-Org Discord',\n      versionAdded: '1.5.5',\n      function: () => {\n        telemetry?.trackHelpResourceClicked({\n          resource_type: 'discord',\n          is_external: true,\n          source: 'menu'\n        })\n        window.open(staticUrls.discord, '_blank')\n      }\n    },\n    {\n      id: 'Workspace.SearchBox.Toggle',\n      icon: 'pi pi-search',\n      label: 'Toggle Search Box',\n      versionAdded: '1.5.7',\n      function: () => {\n        useSearchBoxStore().toggleVisible()\n      }\n    },\n    {\n      id: 'Comfy.Help.AboutComfyUI',\n      icon: 'pi pi-info-circle',\n      label: 'Open About ComfyUI',\n      menubarLabel: 'About ComfyUI',\n      versionAdded: '1.6.4',\n      function: () => {\n        dialogService.showSettingsDialog('about')\n      }\n    },\n    {\n      id: 'Comfy.DuplicateWorkflow',\n      icon: 'pi pi-clone',\n      label: 'Duplicate Current Workflow',\n      versionAdded: '1.6.15',\n      function: async () => {\n        await workflowService.duplicateWorkflow(workflowStore.activeWorkflow!)\n      }\n    },\n    {\n      id: 'Workspace.CloseWorkflow',\n      icon: 'pi pi-times',\n      label: 'Close Current Workflow',\n      versionAdded: '1.7.3',\n      function: async () => {\n        if (workflowStore.activeWorkflow)\n          await workflowService.closeWorkflow(workflowStore.activeWorkflow)\n      }\n    },\n    {\n      id: 'Comfy.ContactSupport',\n      icon: 'pi pi-question',\n      label: 'Contact Support',\n      versionAdded: '1.17.8',\n      function: () => {\n        const { userEmail, resolvedUserInfo } = useCurrentUser()\n        const supportUrl = buildSupportUrl({\n          userEmail: userEmail.value,\n          userId: resolvedUserInfo.value?.id\n        })\n        window.open(supportUrl, '_blank')\n      }\n    },\n    {\n      id: 'Comfy.Help.OpenComfyUIForum',\n      icon: 'pi pi-comments',\n      label: 'Open ComfyUI Forum',\n      menubarLabel: 'ComfyUI Forum',\n      versionAdded: '1.8.2',\n      function: () => {\n        telemetry?.trackHelpResourceClicked({\n          resource_type: 'help_feedback',\n          is_external: true,\n          source: 'menu'\n        })\n        window.open(staticUrls.forum, '_blank')\n      }\n    },\n    {\n      id: 'Comfy.Canvas.DeleteSelectedItems',\n      icon: 'pi pi-trash',\n      label: 'Delete Selected Items',\n      versionAdded: '1.10.5',\n      function: () => {\n        app.canvas.deleteSelected()\n        app.canvas.setDirty(true, true)\n      }\n    },\n    {\n      id: 'Comfy.Manager.CustomNodesManager.ShowCustomNodesMenu',\n      icon: 'pi pi-puzzle',\n      label: 'Custom Nodes Manager',\n      versionAdded: '1.12.10',\n      function: async () => {\n        await useManagerState().openManager({\n          showToastOnLegacyError: true\n        })\n      }\n    },\n    {\n      id: 'Comfy.Manager.ShowUpdateAvailablePacks',\n      icon: 'pi pi-sync',\n      label: 'Check for Custom Node Updates',\n      versionAdded: '1.17.0',\n      function: async () => {\n        const managerState = useManagerState()\n        const state = managerState.managerUIState.value\n\n        // For DISABLED state, show error toast instead of opening settings\n        if (state === ManagerUIState.DISABLED) {\n          toastStore.add({\n            severity: 'error',\n            summary: t('g.error'),\n            detail: t('manager.notAvailable'),\n            life: 3000\n          })\n          return\n        }\n\n        await managerState.openManager({\n          initialTab: ManagerTab.UpdateAvailable,\n          showToastOnLegacyError: false\n        })\n      }\n    },\n    {\n      id: 'Comfy.Manager.ShowMissingPacks',\n      icon: 'pi pi-exclamation-circle',\n      label: 'Install Missing Custom Nodes',\n      versionAdded: '1.17.0',\n      function: async () => {\n        await useManagerState().openManager({\n          initialTab: ManagerTab.Missing,\n          showToastOnLegacyError: false\n        })\n      }\n    },\n    {\n      id: 'Comfy.User.OpenSignInDialog',\n      icon: 'pi pi-user',\n      label: 'Open Sign In Dialog',\n      versionAdded: '1.17.6',\n      function: async () => {\n        await dialogService.showSignInDialog()\n      }\n    },\n    {\n      id: 'Comfy.User.SignOut',\n      icon: 'pi pi-sign-out',\n      label: 'Sign Out',\n      versionAdded: '1.18.1',\n      function: async () => {\n        await firebaseAuthActions.logout()\n      }\n    },\n    {\n      id: 'Comfy.Canvas.MoveSelectedNodes.Up',\n      icon: 'pi pi-arrow-up',\n      label: 'Move Selected Nodes Up',\n      versionAdded: moveSelectedNodesVersionAdded,\n      function: () => moveSelectedNodes(([x, y], gridSize) => [x, y - gridSize])\n    },\n    {\n      id: 'Comfy.Canvas.MoveSelectedNodes.Down',\n      icon: 'pi pi-arrow-down',\n      label: 'Move Selected Nodes Down',\n      versionAdded: moveSelectedNodesVersionAdded,\n      function: () => moveSelectedNodes(([x, y], gridSize) => [x, y + gridSize])\n    },\n    {\n      id: 'Comfy.Canvas.MoveSelectedNodes.Left',\n      icon: 'pi pi-arrow-left',\n      label: 'Move Selected Nodes Left',\n      versionAdded: moveSelectedNodesVersionAdded,\n      function: () => moveSelectedNodes(([x, y], gridSize) => [x - gridSize, y])\n    },\n    {\n      id: 'Comfy.Canvas.MoveSelectedNodes.Right',\n      icon: 'pi pi-arrow-right',\n      label: 'Move Selected Nodes Right',\n      versionAdded: moveSelectedNodesVersionAdded,\n      function: () => moveSelectedNodes(([x, y], gridSize) => [x + gridSize, y])\n    },\n    {\n      id: 'Comfy.Graph.ConvertToSubgraph',\n      icon: 'icon-[lucide--shrink]',\n      label: 'Convert Selection to Subgraph',\n      versionAdded: '1.20.1',\n      category: 'essentials' as const,\n      function: () => {\n        const canvas = canvasStore.getCanvas()\n        const graph = canvas.subgraph ?? canvas.graph\n        if (!graph) throw new TypeError('Canvas has no graph or subgraph set.')\n\n        const res = graph.convertToSubgraph(canvas.selectedItems)\n        if (!res) {\n          toastStore.add({\n            severity: 'error',\n            summary: t('toastMessages.cannotCreateSubgraph'),\n            detail: t('toastMessages.failedToConvertToSubgraph'),\n            life: 3000\n          })\n          return\n        }\n\n        const { node } = res\n        canvas.select(node)\n        canvasStore.updateSelectedItems()\n      }\n    },\n    {\n      id: 'Comfy.Graph.UnpackSubgraph',\n      icon: 'icon-[lucide--expand]',\n      label: 'Unpack the selected Subgraph',\n      versionAdded: '1.26.3',\n      function: () => {\n        const { unpackSubgraph } = useSubgraphOperations()\n        unpackSubgraph()\n      }\n    },\n    {\n      id: 'Comfy.Graph.EditSubgraphWidgets',\n      label: 'Edit Subgraph Widgets',\n      icon: 'icon-[lucide--settings-2]',\n      versionAdded: '1.28.5',\n      function: () => {\n        useRightSidePanelStore().openPanel('subgraph')\n      }\n    },\n    {\n      id: 'Comfy.Graph.ToggleWidgetPromotion',\n      icon: 'icon-[lucide--arrow-left-right]',\n      label: 'Toggle promotion of hovered widget',\n      versionAdded: '1.30.1',\n      function: tryToggleWidgetPromotion\n    },\n    {\n      id: 'Comfy.OpenManagerDialog',\n      icon: 'mdi mdi-puzzle-outline',\n      label: 'Manager',\n      function: async () => {\n        await useManagerState().openManager({\n          initialTab: ManagerTab.All,\n          showToastOnLegacyError: false\n        })\n      }\n    },\n    {\n      id: 'Comfy.ToggleHelpCenter',\n      icon: 'pi pi-question-circle',\n      label: 'Help Center',\n      function: () => {\n        useHelpCenterStore().toggle()\n      },\n      active: () => useHelpCenterStore().isVisible\n    },\n    {\n      id: 'Comfy.ToggleCanvasInfo',\n      icon: 'pi pi-info-circle',\n      label: 'Canvas Performance',\n      function: async () => {\n        const settingStore = useSettingStore()\n        const currentValue = settingStore.get('Comfy.Graph.CanvasInfo')\n        await settingStore.set('Comfy.Graph.CanvasInfo', !currentValue)\n      },\n      active: () => useSettingStore().get('Comfy.Graph.CanvasInfo')\n    },\n    {\n      id: 'Workspace.ToggleBottomPanel.Shortcuts',\n      icon: 'pi pi-key',\n      label: 'Show Keybindings Dialog',\n      versionAdded: '1.24.1',\n      category: 'view-controls' as const,\n      function: () => {\n        bottomPanelStore.togglePanel('shortcuts')\n      }\n    },\n    {\n      id: 'Comfy.Graph.ExitSubgraph',\n      icon: 'pi pi-arrow-up',\n      label: 'Exit Subgraph',\n      versionAdded: '1.20.1',\n      function: () => {\n        const canvas = useCanvasStore().getCanvas()\n        const navigationStore = useSubgraphNavigationStore()\n        if (!canvas.graph) return\n\n        canvas.setGraph(\n          navigationStore.navigationStack.at(-2) ?? canvas.graph.rootGraph\n        )\n      }\n    },\n    {\n      id: 'Comfy.Dev.ShowModelSelector',\n      icon: 'pi pi-box',\n      label: 'Show Model Selector (Dev)',\n      versionAdded: '1.26.2',\n      category: 'view-controls' as const,\n      function: () => {\n        const modelSelectorDialog = useModelSelectorDialog()\n        modelSelectorDialog.show()\n      }\n    },\n    {\n      id: 'Comfy.Manager.CustomNodesManager.ShowLegacyCustomNodesMenu',\n      icon: 'pi pi-bars',\n      label: 'Custom Nodes (Legacy)',\n      versionAdded: '1.16.4',\n      function: async () => {\n        await useManagerState().openManager({\n          legacyCommand: 'Comfy.Manager.CustomNodesManager.ToggleVisibility',\n          showToastOnLegacyError: true,\n          isLegacyOnly: true\n        })\n      }\n    },\n    {\n      id: 'Comfy.Manager.ShowLegacyManagerMenu',\n      icon: 'mdi mdi-puzzle',\n      label: 'Manager Menu (Legacy)',\n      versionAdded: '1.16.4',\n      function: async () => {\n        await useManagerState().openManager({\n          showToastOnLegacyError: true,\n          isLegacyOnly: true\n        })\n      }\n    },\n    {\n      id: 'Comfy.Memory.UnloadModels',\n      icon: 'mdi mdi-vacuum-outline',\n      label: 'Unload Models',\n      versionAdded: '1.16.4',\n      function: async () => {\n        if (!useSettingStore().get('Comfy.Memory.AllowManualUnload')) {\n          useToastStore().add({\n            severity: 'error',\n            summary: t('g.error'),\n            detail: t('g.commandProhibited', {\n              command: 'Comfy.Memory.UnloadModels'\n            }),\n            life: 3000\n          })\n          return\n        }\n        await api.freeMemory({ freeExecutionCache: false })\n      }\n    },\n    {\n      id: 'Comfy.Memory.UnloadModelsAndExecutionCache',\n      icon: 'mdi mdi-vacuum-outline',\n      label: 'Unload Models and Execution Cache',\n      versionAdded: '1.16.4',\n      function: async () => {\n        if (!useSettingStore().get('Comfy.Memory.AllowManualUnload')) {\n          useToastStore().add({\n            severity: 'error',\n            summary: t('g.error'),\n            detail: t('g.commandProhibited', {\n              command: 'Comfy.Memory.UnloadModelsAndExecutionCache'\n            }),\n            life: 3000\n          })\n          return\n        }\n        await api.freeMemory({ freeExecutionCache: true })\n      }\n    },\n    {\n      id: 'Comfy.BrowseModelAssets',\n      icon: 'pi pi-folder-open',\n      label: 'Experimental: Browse Model Assets',\n      versionAdded: '1.28.3',\n      function: async () => {\n        if (!useSettingStore().get('Comfy.Assets.UseAssetAPI')) {\n          const confirmed = await dialogService.confirm({\n            title: 'Enable Asset API',\n            message:\n              'The Asset API is currently disabled. Would you like to enable it?',\n            type: 'default'\n          })\n\n          if (!confirmed) return\n\n          const settingStore = useSettingStore()\n          await settingStore.set('Comfy.Assets.UseAssetAPI', true)\n          await workflowService.reloadCurrentWorkflow()\n        }\n        const assetBrowserDialog = useAssetBrowserDialog()\n        await assetBrowserDialog.browse({\n          assetType: 'models',\n          title: t('sideToolbar.modelLibrary'),\n          onAssetSelected: (asset) => {\n            const result = createModelNodeFromAsset(asset)\n            if (!result.success) {\n              toastStore.add({\n                severity: 'error',\n                summary: t('g.error'),\n                detail: t('assetBrowser.failedToCreateNode')\n              })\n              console.error('Node creation failed:', result.error)\n            }\n          }\n        })\n      }\n    },\n    {\n      id: 'Comfy.ToggleAssetAPI',\n      icon: 'pi pi-database',\n      label: () =>\n        `Experimental: ${\n          useSettingStore().get('Comfy.Assets.UseAssetAPI')\n            ? 'Disable'\n            : 'Enable'\n        } AssetAPI`,\n      function: async () => {\n        const settingStore = useSettingStore()\n        const current = settingStore.get('Comfy.Assets.UseAssetAPI') ?? false\n        await settingStore.set('Comfy.Assets.UseAssetAPI', !current)\n        await useWorkflowService().reloadCurrentWorkflow() // ensure changes take effect immediately\n      }\n    },\n    {\n      id: 'Comfy.ToggleQPOV2',\n      icon: 'pi pi-list',\n      label: 'Toggle Queue Panel V2',\n      function: toggleQueuePanelV2\n    },\n    {\n      id: 'Comfy.ToggleLinear',\n      icon: 'pi pi-database',\n      label: 'toggle linear mode',\n      function: () => (canvasStore.linearMode = !canvasStore.linearMode)\n    }\n  ]\n\n  return commands.map((command) => ({ ...command, source: 'System' }))\n}\n","import { useFavicon } from '@vueuse/core'\nimport { watch } from 'vue'\n\nimport { useExecutionStore } from '@/stores/executionStore'\n\nexport const useProgressFavicon = () => {\n  const defaultFavicon = '/assets/images/favicon_progress_16x16/frame_9.png'\n  const favicon = useFavicon(defaultFavicon)\n  const executionStore = useExecutionStore()\n  const totalFrames = 10\n\n  watch(\n    [() => executionStore.executionProgress, () => executionStore.isIdle],\n    ([progress, isIdle]) => {\n      if (isIdle) {\n        favicon.value = defaultFavicon\n      } else {\n        const frame = Math.min(\n          Math.max(0, Math.floor(progress * totalFrames)),\n          totalFrames - 1\n        )\n        favicon.value = `/assets/images/favicon_progress_16x16/frame_${frame}.png`\n      }\n    }\n  )\n}\n","export enum LatentPreviewMethod {\n  NoPreviews = 'none',\n  Auto = 'auto',\n  Latent2RGB = 'latent2rgb',\n  TAESD = 'taesd'\n}\n\nexport enum LogLevel {\n  DEBUG = 'DEBUG',\n  INFO = 'INFO',\n  WARNING = 'WARNING',\n  ERROR = 'ERROR',\n  CRITICAL = 'CRITICAL'\n}\n\nexport enum HashFunction {\n  MD5 = 'md5',\n  SHA1 = 'sha1',\n  SHA256 = 'sha256',\n  SHA512 = 'sha512'\n}\n\nexport enum CudaMalloc {\n  // Let server decide whether to use CUDA malloc based on the current environment\n  Auto = 'auto',\n  // Disable CUDA malloc\n  Disable = 'disable',\n  // Enable CUDA malloc\n  Enable = 'enable'\n}\n\nexport enum FloatingPointPrecision {\n  AUTO = 'auto',\n  FP64 = 'fp64',\n  FP32 = 'fp32',\n  FP16 = 'fp16',\n  BF16 = 'bf16',\n  FP8E4M3FN = 'fp8_e4m3fn',\n  FP8E5M2 = 'fp8_e5m2'\n}\n\nexport enum CrossAttentionMethod {\n  Auto = 'auto',\n  Split = 'split',\n  Quad = 'quad',\n  Pytorch = 'pytorch'\n}\n\nexport enum VramManagement {\n  Auto = 'auto',\n  GPUOnly = 'gpu-only',\n  HighVram = 'highvram',\n  NormalVram = 'normalvram',\n  LowVram = 'lowvram',\n  NoVram = 'novram',\n  CPU = 'cpu'\n}\n","import type { FormItem } from '@/platform/settings/types'\nimport {\n  CrossAttentionMethod,\n  CudaMalloc,\n  FloatingPointPrecision,\n  HashFunction,\n  LatentPreviewMethod,\n  LogLevel,\n  VramManagement\n} from '@/types/serverArgs'\n\nexport type ServerConfigValue = string | number | true | null | undefined\n\nexport interface ServerConfig<T> extends FormItem {\n  id: string\n  defaultValue: T\n  category?: string[]\n  // Override the default value getter with a custom function.\n  getValue?: (value: T) => Record<string, ServerConfigValue>\n}\n\nexport const SERVER_CONFIG_ITEMS: ServerConfig<any>[] = [\n  // Network settings\n  {\n    id: 'listen',\n    name: 'Host: The IP address to listen on',\n    category: ['Network'],\n    type: 'text',\n    defaultValue: '127.0.0.1'\n  },\n  {\n    id: 'port',\n    name: 'Port: The port to listen on',\n    category: ['Network'],\n    type: 'number',\n    // The default launch port for desktop app is 8000 instead of 8188.\n    defaultValue: 8000\n  },\n  {\n    id: 'tls-keyfile',\n    name: 'TLS Key File: Path to TLS key file for HTTPS',\n    category: ['Network'],\n    type: 'text',\n    defaultValue: ''\n  },\n  {\n    id: 'tls-certfile',\n    name: 'TLS Certificate File: Path to TLS certificate file for HTTPS',\n    category: ['Network'],\n    type: 'text',\n    defaultValue: ''\n  },\n  {\n    id: 'enable-cors-header',\n    name: 'Enable CORS header: Use \"*\" for all origins or specify domain',\n    category: ['Network'],\n    type: 'text',\n    defaultValue: ''\n  },\n  {\n    id: 'max-upload-size',\n    name: 'Maximum upload size (MB)',\n    category: ['Network'],\n    type: 'number',\n    defaultValue: 100\n  },\n\n  // CUDA settings\n  {\n    id: 'cuda-device',\n    name: 'CUDA device index to use',\n    category: ['CUDA'],\n    type: 'number',\n    defaultValue: null\n  },\n  {\n    id: 'cuda-malloc',\n    name: 'Use CUDA malloc for memory allocation',\n    category: ['CUDA'],\n    type: 'combo',\n    options: Object.values(CudaMalloc),\n    defaultValue: CudaMalloc.Auto,\n    getValue: (value: CudaMalloc) => {\n      switch (value) {\n        case CudaMalloc.Auto:\n          return {}\n        case CudaMalloc.Enable:\n          return {\n            ['cuda-malloc']: true\n          }\n        case CudaMalloc.Disable:\n          return {\n            ['disable-cuda-malloc']: true\n          }\n      }\n    }\n  },\n\n  // Precision settings\n  {\n    id: 'global-precision',\n    name: 'Global floating point precision',\n    category: ['Inference'],\n    type: 'combo',\n    options: [\n      FloatingPointPrecision.AUTO,\n      FloatingPointPrecision.FP32,\n      FloatingPointPrecision.FP16\n    ],\n    defaultValue: FloatingPointPrecision.AUTO,\n    tooltip: 'Global floating point precision',\n    getValue: (value: FloatingPointPrecision) => {\n      switch (value) {\n        case FloatingPointPrecision.AUTO:\n          return {}\n        case FloatingPointPrecision.FP32:\n          return {\n            ['force-fp32']: true\n          }\n        case FloatingPointPrecision.FP16:\n          return {\n            ['force-fp16']: true\n          }\n        default:\n          return {}\n      }\n    }\n  },\n\n  // UNET precision\n  {\n    id: 'unet-precision',\n    name: 'UNET precision',\n    category: ['Inference'],\n    type: 'combo',\n    options: [\n      FloatingPointPrecision.AUTO,\n      FloatingPointPrecision.FP64,\n      FloatingPointPrecision.FP32,\n      FloatingPointPrecision.FP16,\n      FloatingPointPrecision.BF16,\n      FloatingPointPrecision.FP8E4M3FN,\n      FloatingPointPrecision.FP8E5M2\n    ],\n    defaultValue: FloatingPointPrecision.AUTO,\n    tooltip: 'UNET precision',\n    getValue: (value: FloatingPointPrecision) => {\n      switch (value) {\n        case FloatingPointPrecision.AUTO:\n          return {}\n        default:\n          return {\n            [`${value.toLowerCase()}-unet`]: true\n          }\n      }\n    }\n  },\n\n  // VAE settings\n  {\n    id: 'vae-precision',\n    name: 'VAE precision',\n    category: ['Inference'],\n    type: 'combo',\n    options: [\n      FloatingPointPrecision.AUTO,\n      FloatingPointPrecision.FP16,\n      FloatingPointPrecision.FP32,\n      FloatingPointPrecision.BF16\n    ],\n    defaultValue: FloatingPointPrecision.AUTO,\n    tooltip: 'VAE precision',\n    getValue: (value: FloatingPointPrecision) => {\n      switch (value) {\n        case FloatingPointPrecision.AUTO:\n          return {}\n        default:\n          return {\n            [`${value.toLowerCase()}-vae`]: true\n          }\n      }\n    }\n  },\n  {\n    id: 'cpu-vae',\n    name: 'Run VAE on CPU',\n    category: ['Inference'],\n    type: 'boolean',\n    defaultValue: false\n  },\n\n  // Text Encoder settings\n  {\n    id: 'text-encoder-precision',\n    name: 'Text Encoder precision',\n    category: ['Inference'],\n    type: 'combo',\n    options: [\n      FloatingPointPrecision.AUTO,\n      FloatingPointPrecision.FP8E4M3FN,\n      FloatingPointPrecision.FP8E5M2,\n      FloatingPointPrecision.FP16,\n      FloatingPointPrecision.FP32\n    ],\n    defaultValue: FloatingPointPrecision.AUTO,\n    tooltip: 'Text Encoder precision',\n    getValue: (value: FloatingPointPrecision) => {\n      switch (value) {\n        case FloatingPointPrecision.AUTO:\n          return {}\n        default:\n          return {\n            [`${value.toLowerCase()}-text-enc`]: true\n          }\n      }\n    }\n  },\n\n  // Memory and performance settings\n  {\n    id: 'force-channels-last',\n    name: 'Force channels-last memory format',\n    category: ['Memory'],\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'directml',\n    name: 'DirectML device index',\n    category: ['Memory'],\n    type: 'number',\n    defaultValue: null\n  },\n  {\n    id: 'disable-ipex-optimize',\n    name: 'Disable IPEX optimization',\n    category: ['Memory'],\n    type: 'boolean',\n    defaultValue: false\n  },\n\n  // Preview settings\n  {\n    id: 'preview-method',\n    name: 'Method used for latent previews',\n    category: ['Preview'],\n    type: 'combo',\n    options: Object.values(LatentPreviewMethod),\n    defaultValue: LatentPreviewMethod.NoPreviews\n  },\n  {\n    id: 'preview-size',\n    name: 'Size of preview images',\n    category: ['Preview'],\n    type: 'slider',\n    defaultValue: 512,\n    attrs: {\n      min: 128,\n      max: 2048,\n      step: 128\n    }\n  },\n\n  // Cache settings\n  {\n    id: 'cache-classic',\n    name: 'Use classic cache system',\n    category: ['Cache'],\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'cache-lru',\n    name: 'Use LRU caching with a maximum of N node results cached.',\n    category: ['Cache'],\n    type: 'number',\n    defaultValue: null,\n    tooltip: 'May use more RAM/VRAM.'\n  },\n\n  // Attention settings\n  {\n    id: 'cross-attention-method',\n    name: 'Cross attention method',\n    category: ['Attention'],\n    type: 'combo',\n    options: Object.values(CrossAttentionMethod),\n    defaultValue: CrossAttentionMethod.Auto,\n    getValue: (value: CrossAttentionMethod) => {\n      switch (value) {\n        case CrossAttentionMethod.Auto:\n          return {}\n        default:\n          return {\n            [`use-${value.toLowerCase()}-cross-attention`]: true\n          }\n      }\n    }\n  },\n  {\n    id: 'disable-xformers',\n    name: 'Disable xFormers optimization',\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'force-upcast-attention',\n    name: 'Force attention upcast',\n    category: ['Attention'],\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'dont-upcast-attention',\n    name: 'Prevent attention upcast',\n    category: ['Attention'],\n    type: 'boolean',\n    defaultValue: false\n  },\n\n  // VRAM management\n  {\n    id: 'vram-management',\n    name: 'VRAM management mode',\n    category: ['Memory'],\n    type: 'combo',\n    options: Object.values(VramManagement),\n    defaultValue: VramManagement.Auto,\n    getValue: (value: VramManagement) => {\n      switch (value) {\n        case VramManagement.Auto:\n          return {}\n        default:\n          return {\n            [value]: true\n          }\n      }\n    }\n  },\n  {\n    id: 'reserve-vram',\n    name: 'Reserved VRAM (GB)',\n    category: ['Memory'],\n    type: 'number',\n    defaultValue: null,\n    tooltip:\n      'Set the amount of vram in GB you want to reserve for use by your OS/other software. By default some amount is reserved depending on your OS.'\n  },\n\n  // Misc settings\n  {\n    id: 'default-hashing-function',\n    name: 'Default hashing function for model files',\n    type: 'combo',\n    options: Object.values(HashFunction),\n    defaultValue: HashFunction.SHA256\n  },\n  {\n    id: 'disable-smart-memory',\n    name: 'Disable smart memory management',\n    tooltip:\n      'Force ComfyUI to aggressively offload to regular ram instead of keeping models in vram when it can.',\n    category: ['Memory'],\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'deterministic',\n    name: 'Make pytorch use slower deterministic algorithms when it can.',\n    type: 'boolean',\n    defaultValue: false,\n    tooltip: 'Note that this might not make images deterministic in all cases.'\n  },\n  {\n    id: 'fast',\n    name: 'Enable some untested and potentially quality deteriorating optimizations.',\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'dont-print-server',\n    name: \"Don't print server output to console.\",\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'disable-metadata',\n    name: 'Disable saving prompt metadata in files.',\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'enable-manager-legacy-ui',\n    name: 'Use legacy Manager UI',\n    tooltip: 'Uses the legacy ComfyUI-Manager UI instead of the new UI.',\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'disable-all-custom-nodes',\n    name: 'Disable loading all custom nodes.',\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'log-level',\n    name: 'Logging verbosity level',\n    type: 'combo',\n    options: Object.values(LogLevel),\n    defaultValue: LogLevel.INFO,\n    getValue: (value: LogLevel) => {\n      return {\n        verbose: value\n      }\n    }\n  },\n  // Directories\n  {\n    id: 'input-directory',\n    name: 'Input directory',\n    category: ['Directories'],\n    type: 'text',\n    defaultValue: ''\n  },\n  {\n    id: 'output-directory',\n    name: 'Output directory',\n    category: ['Directories'],\n    type: 'text',\n    defaultValue: ''\n  }\n]\n","<script setup lang=\"ts\">\nimport { cn } from '@/utils/tailwindUtil'\n\nconst { visible } = defineProps<{\n  visible: boolean\n}>()\n\nconst isExpanded = defineModel<boolean>('expanded', { default: false })\n\nfunction toggle() {\n  isExpanded.value = !isExpanded.value\n}\n</script>\n\n<template>\n  <Teleport to=\"body\">\n    <Transition\n      enter-active-class=\"transition-all duration-300 ease-out\"\n      enter-from-class=\"translate-y-full opacity-0\"\n      enter-to-class=\"translate-y-0 opacity-100\"\n      leave-active-class=\"transition-all duration-200 ease-in\"\n      leave-from-class=\"translate-y-0 opacity-100\"\n      leave-to-class=\"translate-y-full opacity-0\"\n    >\n      <div\n        v-if=\"visible\"\n        role=\"status\"\n        aria-live=\"polite\"\n        class=\"fixed inset-x-0 bottom-6 z-50 mx-auto w-4/5 max-w-3xl overflow-hidden rounded-lg border border-border-default bg-base-background shadow-lg\"\n      >\n        <div\n          :class=\"\n            cn(\n              'overflow-hidden transition-all duration-300',\n              isExpanded ? 'max-h-[400px]' : 'max-h-0'\n            )\n          \"\n        >\n          <slot :is-expanded />\n        </div>\n\n        <slot name=\"footer\" :is-expanded :toggle />\n      </div>\n    </Transition>\n  </Teleport>\n</template>\n","<script setup lang=\"ts\">\ntype Severity = 'default' | 'secondary' | 'warn' | 'danger' | 'contrast'\n\nconst { label, severity = 'default' } = defineProps<{\n  label: string\n  severity?: Severity\n}>()\n\nfunction badgeClasses(sev: Severity): string {\n  const baseClasses =\n    'inline-flex h-3.5 items-center justify-center rounded-full px-1 text-xxxs font-semibold uppercase'\n\n  switch (sev) {\n    case 'danger':\n      return `${baseClasses} bg-destructive-background text-white`\n    case 'contrast':\n      return `${baseClasses} bg-base-foreground text-base-background`\n    case 'warn':\n      return `${baseClasses} bg-warning-background text-base-background`\n    case 'secondary':\n      return `${baseClasses} bg-secondary-background text-base-foreground`\n    default:\n      return `${baseClasses} bg-primary-background text-base-foreground`\n  }\n}\n</script>\n\n<template>\n  <span :class=\"badgeClasses(severity)\">{{ label }}</span>\n</template>\n","<script setup lang=\"ts\">\nimport { computed } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport StatusBadge from '@/components/common/StatusBadge.vue'\nimport type { AssetDownload } from '@/stores/assetDownloadStore'\nimport { cn } from '@/utils/tailwindUtil'\n\nconst { job } = defineProps<{\n  job: AssetDownload\n}>()\n\nconst { t } = useI18n()\n\nconst progressPercent = computed(() => Math.round(job.progress * 100))\nconst isCompleted = computed(() => job.status === 'completed')\nconst isFailed = computed(() => job.status === 'failed')\nconst isRunning = computed(() => job.status === 'running')\nconst isPending = computed(() => job.status === 'created')\n</script>\n\n<template>\n  <div\n    :class=\"\n      cn(\n        'flex items-center justify-between rounded-lg bg-modal-card-background px-4 py-3',\n        isCompleted && 'opacity-50'\n      )\n    \"\n  >\n    <div class=\"flex flex-col\">\n      <span class=\"text-sm text-base-foreground\">{{ job.assetName }}</span>\n      <span v-if=\"isRunning\" class=\"text-xs text-muted-foreground\"> </span>\n    </div>\n\n    <div class=\"flex items-center gap-2\">\n      <template v-if=\"isFailed\">\n        <i\n          class=\"icon-[lucide--circle-alert] size-4 text-destructive-background\"\n        />\n        <StatusBadge :label=\"t('progressToast.failed')\" severity=\"danger\" />\n      </template>\n\n      <template v-else-if=\"isCompleted\">\n        <StatusBadge :label=\"t('progressToast.finished')\" severity=\"contrast\" />\n      </template>\n\n      <template v-else-if=\"isRunning\">\n        <i\n          class=\"icon-[lucide--loader-circle] size-4 animate-spin text-base-foreground\"\n        />\n        <span class=\"text-xs text-base-foreground\">\n          {{ progressPercent }}%\n        </span>\n      </template>\n\n      <template v-else-if=\"isPending\">\n        <span class=\"text-xs text-muted-foreground\">\n          {{ t('progressToast.pending') }}\n        </span>\n      </template>\n    </div>\n  </div>\n</template>\n","<script setup lang=\"ts\">\nimport { whenever } from '@vueuse/core'\nimport Popover from 'primevue/popover'\nimport { computed, ref } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport HoneyToast from '@/components/honeyToast/HoneyToast.vue'\nimport ProgressToastItem from '@/components/toast/ProgressToastItem.vue'\nimport Button from '@/components/ui/button/Button.vue'\nimport { useAssetDownloadStore } from '@/stores/assetDownloadStore'\nimport { cn } from '@/utils/tailwindUtil'\n\nconst { t } = useI18n()\nconst assetDownloadStore = useAssetDownloadStore()\n\nconst visible = computed(() => assetDownloadStore.hasDownloads)\n\nconst isExpanded = ref(false)\nconst activeFilter = ref<'all' | 'completed' | 'failed'>('all')\nconst filterPopoverRef = ref<InstanceType<typeof Popover> | null>(null)\n\nwhenever(\n  () => !isExpanded.value,\n  () => filterPopoverRef.value?.hide()\n)\n\nconst filterOptions = [\n  { value: 'all', label: 'all' },\n  { value: 'completed', label: 'completed' },\n  { value: 'failed', label: 'failed' }\n] as const\n\nfunction onFilterClick(event: Event) {\n  filterPopoverRef.value?.toggle(event)\n}\n\nfunction setFilter(filter: typeof activeFilter.value) {\n  activeFilter.value = filter\n  filterPopoverRef.value?.hide()\n}\n\nconst downloadJobs = computed(() => assetDownloadStore.downloadList)\nconst completedJobs = computed(() =>\n  assetDownloadStore.finishedDownloads.filter((d) => d.status === 'completed')\n)\nconst failedJobs = computed(() =>\n  assetDownloadStore.finishedDownloads.filter((d) => d.status === 'failed')\n)\n\nconst isInProgress = computed(() => assetDownloadStore.hasActiveDownloads)\nconst currentJobName = computed(() => {\n  const activeJob = downloadJobs.value.find((job) => job.status === 'running')\n  return activeJob?.assetName || t('progressToast.downloadingModel')\n})\n\nconst completedCount = computed(\n  () => completedJobs.value.length + failedJobs.value.length\n)\nconst totalCount = computed(() => downloadJobs.value.length)\n\nconst filteredJobs = computed(() => {\n  switch (activeFilter.value) {\n    case 'completed':\n      return completedJobs.value\n    case 'failed':\n      return failedJobs.value\n    default:\n      return downloadJobs.value\n  }\n})\n\nconst activeFilterLabel = computed(() => {\n  const option = filterOptions.find((f) => f.value === activeFilter.value)\n  return option\n    ? t(`progressToast.filter.${option.label}`)\n    : t('progressToast.filter.all')\n})\n\nfunction closeDialog() {\n  assetDownloadStore.clearFinishedDownloads()\n  isExpanded.value = false\n}\n</script>\n\n<template>\n  <HoneyToast v-model:expanded=\"isExpanded\" :visible>\n    <template #default>\n      <div\n        class=\"flex h-12 items-center justify-between border-b border-border-default px-4\"\n      >\n        <h3 class=\"text-sm font-bold text-base-foreground\">\n          {{ t('progressToast.importingModels') }}\n        </h3>\n        <div class=\"flex items-center gap-2\">\n          <Button\n            variant=\"secondary\"\n            size=\"md\"\n            class=\"gap-1.5 px-2\"\n            @click=\"onFilterClick\"\n          >\n            <i class=\"icon-[lucide--list-filter] size-4\" />\n            <span>{{ activeFilterLabel }}</span>\n            <i class=\"icon-[lucide--chevron-down] size-3\" />\n          </Button>\n          <Popover\n            ref=\"filterPopoverRef\"\n            append-to=\"body\"\n            :dismissable=\"true\"\n            :close-on-escape=\"true\"\n            unstyled\n            :pt=\"{\n              root: { class: 'absolute z-50' },\n              content: {\n                class:\n                  'bg-transparent border-none p-0 pt-2 rounded-lg shadow-lg'\n              }\n            }\"\n          >\n            <div\n              class=\"flex min-w-30 flex-col items-stretch rounded-lg border border-interface-stroke bg-interface-panel-surface px-2 py-3\"\n            >\n              <Button\n                v-for=\"option in filterOptions\"\n                :key=\"option.value\"\n                variant=\"textonly\"\n                size=\"sm\"\n                :class=\"\n                  cn(\n                    'w-full justify-start bg-transparent',\n                    activeFilter === option.value &&\n                      'bg-secondary-background-selected'\n                  )\n                \"\n                @click=\"setFilter(option.value)\"\n              >\n                {{ t(`progressToast.filter.${option.label}`) }}\n              </Button>\n            </div>\n          </Popover>\n        </div>\n      </div>\n\n      <div class=\"relative max-h-75 overflow-y-auto px-4 py-4\">\n        <div\n          v-if=\"filteredJobs.length > 3\"\n          class=\"absolute right-1 top-4 h-12 w-1 rounded-full bg-muted-foreground\"\n        />\n\n        <div class=\"flex flex-col gap-2\">\n          <ProgressToastItem\n            v-for=\"job in filteredJobs\"\n            :key=\"job.taskId\"\n            :job=\"job\"\n          />\n        </div>\n\n        <div\n          v-if=\"filteredJobs.length === 0\"\n          class=\"flex flex-col items-center justify-center py-6 text-center\"\n        >\n          <span class=\"text-sm text-muted-foreground\">\n            {{\n              t('progressToast.noImportsInQueue', {\n                filter: activeFilterLabel\n              })\n            }}\n          </span>\n        </div>\n      </div>\n    </template>\n\n    <template #footer=\"{ toggle }\">\n      <div\n        class=\"flex h-12 items-center justify-between border-t border-border-default px-4\"\n      >\n        <div class=\"flex items-center gap-2 text-sm\">\n          <template v-if=\"isInProgress\">\n            <i\n              class=\"icon-[lucide--loader-circle] size-4 animate-spin text-muted-foreground\"\n            />\n            <span class=\"font-bold text-base-foreground\">{{\n              currentJobName\n            }}</span>\n          </template>\n          <template v-else-if=\"failedJobs.length > 0\">\n            <i\n              class=\"icon-[lucide--circle-alert] size-4 text-destructive-background\"\n            />\n            <span class=\"font-bold text-base-foreground\">\n              {{\n                t('progressToast.downloadsFailed', {\n                  count: failedJobs.length\n                })\n              }}\n            </span>\n          </template>\n          <template v-else>\n            <i class=\"icon-[lucide--check-circle] size-4 text-jade-600\" />\n            <span class=\"font-bold text-base-foreground\">\n              {{ t('progressToast.allDownloadsCompleted') }}\n            </span>\n          </template>\n        </div>\n\n        <div class=\"flex items-center gap-2\">\n          <span v-if=\"isInProgress\" class=\"text-sm text-muted-foreground\">\n            {{\n              t('progressToast.progressCount', {\n                completed: completedCount,\n                total: totalCount\n              })\n            }}\n          </span>\n\n          <div class=\"flex items-center\">\n            <Button\n              variant=\"muted-textonly\"\n              size=\"icon\"\n              :aria-label=\"\n                isExpanded ? t('contextMenu.Collapse') : t('contextMenu.Expand')\n              \"\n              @click.stop=\"toggle\"\n            >\n              <i\n                :class=\"\n                  cn(\n                    'size-4',\n                    isExpanded\n                      ? 'icon-[lucide--chevron-down]'\n                      : 'icon-[lucide--chevron-up]'\n                  )\n                \"\n              />\n            </Button>\n\n            <Button\n              v-if=\"!isInProgress\"\n              variant=\"muted-textonly\"\n              size=\"icon\"\n              :aria-label=\"t('g.close')\"\n              @click.stop=\"closeDialog\"\n            >\n              <i class=\"icon-[lucide--x] size-4\" />\n            </Button>\n          </div>\n        </div>\n      </div>\n    </template>\n  </HoneyToast>\n</template>\n","import { until, useStorage } from '@vueuse/core'\nimport { defineStore } from 'pinia'\nimport { gt, valid } from 'semver'\nimport { computed } from 'vue'\n\nimport config from '@/config'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useSystemStatsStore } from '@/stores/systemStatsStore'\n\nconst DISMISSAL_DURATION_MS = 7 * 24 * 60 * 60 * 1000 // 7 days\n\nexport const useVersionCompatibilityStore = defineStore(\n  'versionCompatibility',\n  () => {\n    const systemStatsStore = useSystemStatsStore()\n    const settingStore = useSettingStore()\n\n    const frontendVersion = computed(() => config.app_version)\n    const backendVersion = computed(\n      () => systemStatsStore.systemStats?.system?.comfyui_version ?? ''\n    )\n    const requiredFrontendVersion = computed(\n      () =>\n        systemStatsStore.systemStats?.system?.required_frontend_version ?? ''\n    )\n\n    const isFrontendOutdated = computed(() => {\n      if (\n        !frontendVersion.value ||\n        !requiredFrontendVersion.value ||\n        !valid(frontendVersion.value) ||\n        !valid(requiredFrontendVersion.value)\n      ) {\n        return false\n      }\n      // Returns true if required version is greater than frontend version\n      return gt(requiredFrontendVersion.value, frontendVersion.value)\n    })\n\n    const isFrontendNewer = computed(() => {\n      // We don't warn about frontend being newer than backend\n      // Only warn when frontend is outdated (behind required version)\n      return false\n    })\n\n    const hasVersionMismatch = computed(() => {\n      return isFrontendOutdated.value\n    })\n\n    const versionKey = computed(() => {\n      if (\n        !frontendVersion.value ||\n        !backendVersion.value ||\n        !requiredFrontendVersion.value\n      ) {\n        return null\n      }\n      return `${frontendVersion.value}-${backendVersion.value}-${requiredFrontendVersion.value}`\n    })\n\n    // Use reactive storage for dismissals - creates a reactive ref that syncs with localStorage\n    // All version mismatch dismissals are stored in a single object for clean localStorage organization\n    const dismissalStorage = useStorage(\n      'comfy.versionMismatch.dismissals',\n      {} as Record<string, number>,\n      localStorage,\n      {\n        serializer: {\n          read: (value: string) => {\n            try {\n              return JSON.parse(value)\n            } catch {\n              return {}\n            }\n          },\n          write: (value: Record<string, number>) => JSON.stringify(value)\n        }\n      }\n    )\n\n    const isDismissed = computed(() => {\n      if (!versionKey.value) return false\n\n      const dismissedUntil = dismissalStorage.value[versionKey.value]\n      if (!dismissedUntil) return false\n\n      // Check if dismissal has expired\n      return Date.now() < dismissedUntil\n    })\n\n    const shouldShowWarning = computed(() => {\n      const warningsDisabled = settingStore.get(\n        'Comfy.VersionCompatibility.DisableWarnings'\n      )\n      return hasVersionMismatch.value && !isDismissed.value && !warningsDisabled\n    })\n\n    const warningMessage = computed(() => {\n      if (isFrontendOutdated.value) {\n        return {\n          type: 'outdated' as const,\n          frontendVersion: frontendVersion.value,\n          requiredVersion: requiredFrontendVersion.value\n        }\n      }\n      return null\n    })\n\n    async function checkVersionCompatibility() {\n      if (!systemStatsStore.systemStats) {\n        await until(systemStatsStore.isInitialized)\n      }\n    }\n\n    function dismissWarning() {\n      if (!versionKey.value) return\n\n      const dismissUntil = Date.now() + DISMISSAL_DURATION_MS\n      dismissalStorage.value = {\n        ...dismissalStorage.value,\n        [versionKey.value]: dismissUntil\n      }\n    }\n\n    async function initialize() {\n      await checkVersionCompatibility()\n    }\n\n    return {\n      frontendVersion,\n      backendVersion,\n      requiredFrontendVersion,\n      hasVersionMismatch,\n      shouldShowWarning,\n      warningMessage,\n      isFrontendOutdated,\n      isFrontendNewer,\n      checkVersionCompatibility,\n      dismissWarning,\n      initialize\n    }\n  }\n)\n","import { whenever } from '@vueuse/core'\nimport { computed, onMounted } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport { useToastStore } from './toastStore'\nimport { useVersionCompatibilityStore } from './versionCompatibilityStore'\n\ninterface UseFrontendVersionMismatchWarningOptions {\n  immediate?: boolean\n}\n\n/**\n * Composable for handling frontend version mismatch warnings.\n *\n * Displays toast notifications when the frontend version is incompatible with the backend,\n * either because the frontend is outdated or newer than the backend expects.\n * Automatically dismisses warnings when shown and persists dismissal state for 7 days.\n *\n * @param options - Configuration options\n * @param options.immediate - If true, automatically shows warning when version mismatch is detected\n * @returns Object with methods and computed properties for managing version warnings\n *\n * @example\n * ```ts\n * // Show warning immediately when mismatch detected\n * const { showWarning, shouldShowWarning } = useFrontendVersionMismatchWarning({ immediate: true })\n *\n * // Manual control\n * const { showWarning } = useFrontendVersionMismatchWarning()\n * showWarning() // Call when needed\n * ```\n */\nexport function useFrontendVersionMismatchWarning(\n  options: UseFrontendVersionMismatchWarningOptions = {}\n) {\n  const { immediate = false } = options\n  const { t } = useI18n()\n  const toastStore = useToastStore()\n  const versionCompatibilityStore = useVersionCompatibilityStore()\n\n  // Track if we've already shown the warning\n  let hasShownWarning = false\n\n  const showWarning = () => {\n    // Prevent showing the warning multiple times\n    if (hasShownWarning) return\n\n    const message = versionCompatibilityStore.warningMessage\n    if (!message) return\n\n    const detailMessage = t('g.frontendOutdated', {\n      frontendVersion: message.frontendVersion,\n      requiredVersion: message.requiredVersion\n    })\n\n    const fullMessage = t('g.versionMismatchWarningMessage', {\n      warning: t('g.versionMismatchWarning'),\n      detail: detailMessage\n    })\n\n    toastStore.addAlert(fullMessage)\n    hasShownWarning = true\n\n    // Automatically dismiss the warning so it won't show again for 7 days\n    versionCompatibilityStore.dismissWarning()\n  }\n\n  onMounted(() => {\n    // Only set up the watcher if immediate is true\n    if (immediate) {\n      whenever(\n        () => versionCompatibilityStore.shouldShowWarning,\n        () => {\n          showWarning()\n        },\n        {\n          immediate: true,\n          once: true\n        }\n      )\n    }\n  })\n\n  return {\n    showWarning,\n    shouldShowWarning: computed(\n      () => versionCompatibilityStore.shouldShowWarning\n    ),\n    dismissWarning: versionCompatibilityStore.dismissWarning,\n    hasVersionMismatch: computed(\n      () => versionCompatibilityStore.hasVersionMismatch\n    )\n  }\n}\n","import { api } from '@/scripts/api'\nimport { app } from '@/scripts/app'\nimport {\n  useQueuePendingTaskCountStore,\n  useQueueSettingsStore\n} from '@/stores/queueStore'\n\nexport function setupAutoQueueHandler() {\n  const queueCountStore = useQueuePendingTaskCountStore()\n  const queueSettingsStore = useQueueSettingsStore()\n\n  let graphHasChanged = false\n  let internalCount = 0 // Use an internal counter here so it is instantly updated when re-queuing\n  api.addEventListener('graphChanged', () => {\n    if (queueSettingsStore.mode === 'change') {\n      if (internalCount) {\n        graphHasChanged = true\n      } else {\n        graphHasChanged = false\n        // Queue the prompt in the background\n        void app.queuePrompt(0, queueSettingsStore.batchCount)\n        internalCount++\n      }\n    }\n  })\n\n  queueCountStore.$subscribe(\n    async () => {\n      internalCount = queueCountStore.count\n      if (!internalCount && !app.lastExecutionError) {\n        if (\n          queueSettingsStore.mode === 'instant' ||\n          (queueSettingsStore.mode === 'change' && graphHasChanged)\n        ) {\n          graphHasChanged = false\n          await app.queuePrompt(0, queueSettingsStore.batchCount)\n        }\n      }\n    },\n    { detached: true }\n  )\n}\n","<script setup lang=\"ts\">\nimport { storeToRefs } from 'pinia'\nimport Splitter from 'primevue/splitter'\nimport SplitterPanel from 'primevue/splitterpanel'\nimport { computed } from 'vue'\n\nimport ExtensionSlot from '@/components/common/ExtensionSlot.vue'\nimport CurrentUserButton from '@/components/topbar/CurrentUserButton.vue'\nimport LoginButton from '@/components/topbar/LoginButton.vue'\nimport TopbarBadges from '@/components/topbar/TopbarBadges.vue'\nimport WorkflowTabs from '@/components/topbar/WorkflowTabs.vue'\nimport Button from '@/components/ui/button/Button.vue'\nimport { useCurrentUser } from '@/composables/auth/useCurrentUser'\nimport {\n  isValidWidgetValue,\n  safeWidgetMapper\n} from '@/composables/graph/useGraphNodeManager'\nimport { useAssetsSidebarTab } from '@/composables/sidebarTabs/useAssetsSidebarTab'\nimport { t } from '@/i18n'\nimport type { LGraphNode } from '@/lib/litegraph/src/LGraphNode'\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useWorkflowService } from '@/platform/workflow/core/services/workflowService'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport NodeWidgets from '@/renderer/extensions/vueNodes/components/NodeWidgets.vue'\nimport WidgetInputNumberInput from '@/renderer/extensions/vueNodes/widgets/components/WidgetInputNumber.vue'\nimport { app } from '@/scripts/app'\nimport { useCommandStore } from '@/stores/commandStore'\nimport { useNodeOutputStore } from '@/stores/imagePreviewStore'\nimport { useQueueSettingsStore } from '@/stores/queueStore'\nimport { isElectron } from '@/utils/envUtil'\n\nconst nodeOutputStore = useNodeOutputStore()\nconst commandStore = useCommandStore()\nconst nodeDatas = computed(() => {\n  function nodeToNodeData(node: LGraphNode) {\n    const mapper = safeWidgetMapper(node, new Map())\n    const widgets =\n      node.widgets?.map((widget) => {\n        const safeWidget = mapper(widget)\n        safeWidget.callback = function (value) {\n          if (!isValidWidgetValue(value)) return\n          widget.value = value ?? undefined\n          return widget.callback?.(widget.value)\n        }\n        return safeWidget\n      }) ?? []\n    //Only widgets is actually used\n    return {\n      id: `${node.id}`,\n      title: node.title,\n      type: node.type,\n      mode: 0,\n      selected: false,\n      executing: false,\n      widgets\n    }\n  }\n  return app.rootGraph.nodes\n    .filter((node) => node.mode === 0 && node.widgets?.length)\n    .map(nodeToNodeData)\n})\nconst { isLoggedIn } = useCurrentUser()\nconst isDesktop = isElectron()\n\nconst batchCountWidget = {\n  options: { step2: 1, precision: 1, min: 1, max: 100 },\n  value: 1,\n  name: t('Number of generations'),\n  type: 'number'\n}\n\nconst { batchCount } = storeToRefs(useQueueSettingsStore())\n\n//TODO: refactor out of this file.\n//code length is small, but changes should propagate\nasync function runButtonClick(e: Event) {\n  const isShiftPressed = 'shiftKey' in e && e.shiftKey\n  const commandId = isShiftPressed\n    ? 'Comfy.QueuePromptFront'\n    : 'Comfy.QueuePrompt'\n\n  useTelemetry()?.trackUiButtonClicked({\n    button_id: 'queue_run_linear'\n  })\n  if (batchCount.value > 1) {\n    useTelemetry()?.trackUiButtonClicked({\n      button_id: 'queue_run_multiple_batches_submitted'\n    })\n  }\n  await commandStore.execute(commandId, {\n    metadata: {\n      subscribe_to_run: false,\n      trigger_source: 'button'\n    }\n  })\n}\nfunction openFeedback() {\n  //TODO: Does not link to a linear specific feedback section\n  window.open(\n    'https://support.comfy.org/hc/en-us/requests/new?ticket_form_id=40026345549204',\n    '_blank',\n    'noopener,noreferrer'\n  )\n}\n</script>\n<template>\n  <div class=\"absolute w-full h-full\">\n    <div class=\"workflow-tabs-container pointer-events-auto h-9.5 w-full\">\n      <div class=\"flex h-full items-center\">\n        <WorkflowTabs />\n        <TopbarBadges />\n      </div>\n    </div>\n    <Splitter\n      class=\"h-[calc(100%-38px)] w-full bg-comfy-menu-secondary-bg\"\n      :pt=\"{ gutter: { class: 'bg-transparent w-4 -mx-3' } }\"\n    >\n      <SplitterPanel :size=\"1\" class=\"min-w-min bg-comfy-menu-bg\">\n        <div\n          class=\"sidebar-content-container h-full w-full overflow-x-hidden overflow-y-auto border-r-1 border-node-component-border\"\n        >\n          <ExtensionSlot :extension=\"useAssetsSidebarTab()\" />\n        </div>\n      </SplitterPanel>\n      <SplitterPanel\n        :size=\"98\"\n        class=\"flex flex-row overflow-y-auto flex-wrap min-w-min gap-4 m-4\"\n      >\n        <img\n          v-for=\"previewUrl in nodeOutputStore.latestOutput\"\n          :key=\"previewUrl\"\n          class=\"pointer-events-none object-contain flex-1 max-h-full\"\n          :src=\"previewUrl\"\n        />\n        <img\n          v-if=\"nodeOutputStore.latestOutput.length === 0\"\n          class=\"pointer-events-none object-contain flex-1 max-h-full brightness-50 opacity-10\"\n          src=\"/assets/images/comfy-logo-mono.svg\"\n        />\n      </SplitterPanel>\n      <SplitterPanel :size=\"1\" class=\"flex flex-col gap-1 p-1 min-w-min\">\n        <div\n          class=\"actionbar-container flex h-12 items-center rounded-lg border border-[var(--interface-stroke)] p-2 gap-2 bg-comfy-menu-bg justify-end\"\n        >\n          <Button variant=\"secondary\" @click=\"openFeedback\">\n            {{ t('g.feedback') }}\n          </Button>\n          <Button\n            variant=\"secondary\"\n            class=\"min-w-max\"\n            @click=\"useCanvasStore().linearMode = false\"\n          >\n            {{ t('linearMode.openWorkflow') }}\n            <i class=\"icon-[comfy--workflow]\" />\n          </Button>\n          <Button\n            variant=\"inverted\"\n            @click=\"useWorkflowService().exportWorkflow('workflow', 'workflow')\"\n          >\n            {{ t('linearMode.share') }}\n          </Button>\n          <CurrentUserButton v-if=\"isLoggedIn\" />\n          <LoginButton v-else-if=\"isDesktop\" />\n        </div>\n        <div\n          class=\"rounded-lg border p-2 gap-2 h-full border-[var(--interface-stroke)] bg-comfy-menu-bg flex flex-col\"\n        >\n          <div\n            class=\"grow-1 flex justify-start flex-col overflow-y-auto contain-size *:max-h-100\"\n          >\n            <NodeWidgets\n              v-for=\"nodeData of nodeDatas\"\n              :key=\"nodeData.id\"\n              :node-data\n              class=\"border-b-1 border-node-component-border pt-1 pb-2 last:border-none\"\n            />\n          </div>\n          <div class=\"p-4 pb-0 border-t border-node-component-border\">\n            <WidgetInputNumberInput\n              v-model=\"batchCount\"\n              :widget=\"batchCountWidget\"\n              class=\"*:[.min-w-56]:basis-0\"\n            />\n            <Button class=\"w-full mt-4\" @click=\"runButtonClick\">\n              <i class=\"icon-[lucide--play]\" />\n              {{ t('menu.run') }}\n            </Button>\n          </div>\n        </div>\n      </SplitterPanel>\n    </Splitter>\n  </div>\n</template>\n","<script setup lang=\"ts\">\nimport { useEventListener, useScroll, whenever } from '@vueuse/core'\nimport Panel from 'primevue/panel'\nimport TabMenu from 'primevue/tabmenu'\nimport { computed, onBeforeUnmount, onMounted, ref } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport DotSpinner from '@/components/common/DotSpinner.vue'\nimport HoneyToast from '@/components/honeyToast/HoneyToast.vue'\nimport Button from '@/components/ui/button/Button.vue'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useWorkflowService } from '@/platform/workflow/core/services/workflowService'\nimport { api } from '@/scripts/api'\nimport { useCommandStore } from '@/stores/commandStore'\nimport { useConflictDetection } from '@/workbench/extensions/manager/composables/useConflictDetection'\nimport { useComfyManagerService } from '@/workbench/extensions/manager/services/comfyManagerService'\nimport { useComfyManagerStore } from '@/workbench/extensions/manager/stores/comfyManagerStore'\n\nconst { t } = useI18n()\nconst comfyManagerStore = useComfyManagerStore()\nconst settingStore = useSettingStore()\nconst { runFullConflictAnalysis } = useConflictDetection()\n\nconst isExpanded = ref(false)\nconst activeTabIndex = ref(0)\n\nconst tabs = computed(() => [\n  { label: t('manager.installationQueue') },\n  {\n    label: t('manager.failed', {\n      count: comfyManagerStore.failedTasksIds.length\n    })\n  }\n])\n\nconst focusedLogs = computed(() => {\n  if (activeTabIndex.value === 0) {\n    return comfyManagerStore.succeededTasksLogs\n  }\n  return comfyManagerStore.failedTasksLogs\n})\n\nconst visible = computed(() => comfyManagerStore.taskLogs.length > 0)\n\nconst isRestarting = ref(false)\nconst isRestartCompleted = ref(false)\n\nconst isInProgress = computed(\n  () => comfyManagerStore.isProcessingTasks || isRestarting.value\n)\n\nconst isTaskInProgress = (index: number) => {\n  const log = focusedLogs.value[index]\n  if (!log) return false\n\n  const taskQueue = comfyManagerStore.taskQueue\n  if (!taskQueue) return false\n\n  const allQueueTasks = [\n    ...(taskQueue.running_queue || []),\n    ...(taskQueue.pending_queue || [])\n  ]\n\n  return allQueueTasks.some((task) => task.ui_id === log.taskId)\n}\n\nconst completedTasksCount = computed(() => {\n  return (\n    comfyManagerStore.succeededTasksIds.length +\n    comfyManagerStore.failedTasksIds.length\n  )\n})\n\nconst totalTasksCount = computed(() => {\n  const completedTasks = Object.keys(comfyManagerStore.taskHistory).length\n  const taskQueue = comfyManagerStore.taskQueue\n  const queuedTasks = taskQueue\n    ? (taskQueue.running_queue?.length || 0) +\n      (taskQueue.pending_queue?.length || 0)\n    : 0\n  return completedTasks + queuedTasks\n})\n\nconst currentTaskName = computed(() => {\n  if (isRestarting.value) {\n    return t('manager.restartingBackend')\n  }\n  if (isRestartCompleted.value) {\n    return t('manager.extensionsSuccessfullyInstalled')\n  }\n  if (!comfyManagerStore.taskLogs.length)\n    return t('manager.installingDependencies')\n  const task = comfyManagerStore.taskLogs.at(-1)\n  return task?.taskName ?? t('manager.installingDependencies')\n})\n\nconst collapsedPanels = ref<Record<number, boolean>>({})\nfunction togglePanel(index: number) {\n  collapsedPanels.value[index] = !collapsedPanels.value[index]\n}\n\nconst sectionsContainerRef = ref<HTMLElement | null>(null)\nconst { y: scrollY } = useScroll(sectionsContainerRef, {\n  eventListenerOptions: { passive: true }\n})\n\nconst lastPanelRef = ref<HTMLElement | null>(null)\nconst isUserScrolling = ref(false)\nconst lastPanelLogs = computed(() => focusedLogs.value?.at(-1)?.logs)\n\nfunction isAtBottom(el: HTMLElement | null) {\n  if (!el) return false\n  const threshold = 20\n  return Math.abs(el.scrollHeight - el.scrollTop - el.clientHeight) < threshold\n}\n\nfunction scrollLastPanelToBottom() {\n  if (!lastPanelRef.value || isUserScrolling.value) return\n  lastPanelRef.value.scrollTop = lastPanelRef.value.scrollHeight\n}\n\nfunction scrollContentToBottom() {\n  scrollY.value = sectionsContainerRef.value?.scrollHeight ?? 0\n}\n\nfunction resetUserScrolling() {\n  isUserScrolling.value = false\n}\n\nfunction handleScroll(e: Event) {\n  const target = e.target as HTMLElement\n  if (target !== lastPanelRef.value) return\n  isUserScrolling.value = !isAtBottom(target)\n}\n\nfunction onLogsAdded() {\n  if (isUserScrolling.value) return\n  scrollLastPanelToBottom()\n}\n\nwhenever(lastPanelLogs, onLogsAdded, { flush: 'post', deep: true })\nwhenever(() => isExpanded.value, scrollContentToBottom)\nwhenever(() => !isExpanded.value, resetUserScrolling)\n\nfunction closeToast() {\n  comfyManagerStore.resetTaskState()\n  isExpanded.value = false\n}\n\nasync function handleRestart() {\n  const originalToastSetting = settingStore.get(\n    'Comfy.Toast.DisableReconnectingToast'\n  )\n\n  try {\n    await settingStore.set('Comfy.Toast.DisableReconnectingToast', true)\n\n    isRestarting.value = true\n\n    const onReconnect = async () => {\n      try {\n        comfyManagerStore.setStale()\n        await useCommandStore().execute('Comfy.RefreshNodeDefinitions')\n        await useWorkflowService().reloadCurrentWorkflow()\n        void runFullConflictAnalysis()\n      } finally {\n        await settingStore.set(\n          'Comfy.Toast.DisableReconnectingToast',\n          originalToastSetting\n        )\n        isRestarting.value = false\n        isRestartCompleted.value = true\n\n        setTimeout(() => {\n          closeToast()\n        }, 3000)\n      }\n    }\n\n    useEventListener(api, 'reconnected', onReconnect, { once: true })\n\n    await useComfyManagerService().rebootComfyUI()\n  } catch (error) {\n    await settingStore.set(\n      'Comfy.Toast.DisableReconnectingToast',\n      originalToastSetting\n    )\n    isRestarting.value = false\n    isRestartCompleted.value = false\n    closeToast()\n    throw error\n  }\n}\n\nonMounted(() => {\n  scrollContentToBottom()\n})\n\nonBeforeUnmount(() => {\n  isExpanded.value = false\n})\n</script>\n\n<template>\n  <HoneyToast v-model:expanded=\"isExpanded\" :visible>\n    <template #default>\n      <div v-if=\"isExpanded\" class=\"flex items-center px-4 py-2\">\n        <TabMenu\n          v-model:active-index=\"activeTabIndex\"\n          :model=\"tabs\"\n          class=\"w-full border-none\"\n          :pt=\"{\n            menu: { class: 'border-none' },\n            menuitem: { class: 'font-medium' },\n            action: { class: 'px-4 py-2' }\n          }\"\n        />\n      </div>\n\n      <div\n        ref=\"sectionsContainerRef\"\n        class=\"scroll-container max-h-[450px] overflow-y-auto px-6 py-4\"\n        :style=\"{\n          scrollbarWidth: 'thin',\n          scrollbarColor: 'rgba(156, 163, 175, 0.5) transparent'\n        }\"\n      >\n        <div v-for=\"(log, index) in focusedLogs\" :key=\"index\">\n          <Panel\n            :expanded=\"collapsedPanels[index] === true\"\n            toggleable\n            class=\"shadow-elevation-1 mt-2 rounded-lg\"\n          >\n            <template #header>\n              <div class=\"flex w-full items-center justify-between py-2\">\n                <div class=\"flex flex-col text-sm leading-normal font-medium\">\n                  <span>{{ log.taskName }}</span>\n                  <span class=\"text-muted\">\n                    {{\n                      isTaskInProgress(index)\n                        ? t('g.inProgress')\n                        : t('g.completed') + ' '\n                    }}\n                  </span>\n                </div>\n              </div>\n            </template>\n            <template #toggleicon>\n              <Button\n                variant=\"textonly\"\n                class=\"text-neutral-300\"\n                @click=\"togglePanel(index)\"\n              >\n                <i\n                  :class=\"\n                    collapsedPanels[index]\n                      ? 'pi pi-chevron-right'\n                      : 'pi pi-chevron-down'\n                  \"\n                />\n              </Button>\n            </template>\n            <div\n              :ref=\"\n                index === focusedLogs.length - 1\n                  ? (el) => (lastPanelRef = el as HTMLElement)\n                  : undefined\n              \"\n              class=\"h-64 overflow-y-auto rounded-lg bg-black\"\n              :class=\"{\n                'h-64': index !== focusedLogs.length - 1,\n                grow: index === focusedLogs.length - 1\n              }\"\n              @scroll=\"handleScroll\"\n            >\n              <div class=\"h-full\">\n                <div\n                  v-for=\"(logLine, logIndex) in log.logs\"\n                  :key=\"logIndex\"\n                  class=\"text-muted\"\n                >\n                  <pre class=\"break-words whitespace-pre-wrap\">{{\n                    logLine\n                  }}</pre>\n                </div>\n              </div>\n            </div>\n          </Panel>\n        </div>\n      </div>\n    </template>\n\n    <template #footer=\"{ toggle }\">\n      <div class=\"flex w-full items-center justify-between px-6 py-2 shadow-lg\">\n        <div class=\"flex items-center text-base leading-none\">\n          <div class=\"flex items-center\">\n            <template v-if=\"isInProgress\">\n              <DotSpinner duration=\"1s\" class=\"mr-2\" />\n              <span>{{ currentTaskName }}</span>\n            </template>\n            <template v-else-if=\"isRestartCompleted\">\n              <span class=\"mr-2\"></span>\n              <span>{{ currentTaskName }}</span>\n            </template>\n            <template v-else>\n              <span class=\"mr-2\"></span>\n              <span>{{ t('manager.restartToApplyChanges') }}</span>\n            </template>\n          </div>\n        </div>\n        <div class=\"flex items-center gap-4\">\n          <span v-if=\"isInProgress\" class=\"text-sm text-muted-foreground\">\n            {{ completedTasksCount }} {{ t('g.progressCountOf') }}\n            {{ totalTasksCount }}\n          </span>\n          <div class=\"flex items-center\">\n            <Button\n              v-if=\"!isInProgress && !isRestartCompleted\"\n              variant=\"secondary\"\n              class=\"mr-4 rounded-full border-2 border-base-foreground px-3 text-base-foreground hover:bg-secondary-background-hover\"\n              @click=\"handleRestart\"\n            >\n              {{ t('manager.applyChanges') }}\n            </Button>\n            <Button\n              v-else-if=\"!isRestartCompleted\"\n              variant=\"muted-textonly\"\n              size=\"sm\"\n              class=\"rounded-full font-bold\"\n              :aria-label=\"\n                t(isExpanded ? 'contextMenu.Collapse' : 'contextMenu.Expand')\n              \"\n              @click.stop=\"toggle\"\n            >\n              <i\n                :class=\"isExpanded ? 'pi pi-chevron-up' : 'pi pi-chevron-down'\"\n              />\n            </Button>\n            <Button\n              variant=\"muted-textonly\"\n              size=\"sm\"\n              class=\"rounded-full font-bold\"\n              :aria-label=\"t('g.close')\"\n              @click.stop=\"closeToast\"\n            >\n              <i class=\"pi pi-times\" />\n            </Button>\n          </div>\n        </div>\n      </div>\n    </template>\n  </HoneyToast>\n</template>\n","<template>\n  <div class=\"comfyui-body grid h-full w-full overflow-hidden\">\n    <div id=\"comfyui-body-top\" class=\"comfyui-body-top\" />\n    <div id=\"comfyui-body-bottom\" class=\"comfyui-body-bottom\" />\n    <div id=\"comfyui-body-left\" class=\"comfyui-body-left\" />\n    <div id=\"comfyui-body-right\" class=\"comfyui-body-right\" />\n    <div\n      v-show=\"!linearMode\"\n      id=\"graph-canvas-container\"\n      ref=\"graphCanvasContainerRef\"\n      class=\"graph-canvas-container\"\n    >\n      <GraphCanvas @ready=\"onGraphReady\" />\n    </div>\n    <LinearView v-if=\"linearMode\" />\n  </div>\n\n  <GlobalToast />\n  <RerouteMigrationToast />\n  <ModelImportProgressDialog />\n  <ManagerProgressToast />\n  <UnloadWindowConfirmDialog v-if=\"!isElectron()\" />\n  <MenuHamburger />\n</template>\n\n<script setup lang=\"ts\">\nimport { useEventListener } from '@vueuse/core'\nimport { storeToRefs } from 'pinia'\nimport type { ToastMessageOptions } from 'primevue/toast'\nimport { useToast } from 'primevue/usetoast'\nimport {\n  computed,\n  nextTick,\n  onBeforeUnmount,\n  onMounted,\n  ref,\n  watch,\n  watchEffect\n} from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport { runWhenGlobalIdle } from '@/base/common/async'\nimport MenuHamburger from '@/components/MenuHamburger.vue'\nimport UnloadWindowConfirmDialog from '@/components/dialog/UnloadWindowConfirmDialog.vue'\nimport GraphCanvas from '@/components/graph/GraphCanvas.vue'\nimport GlobalToast from '@/components/toast/GlobalToast.vue'\nimport RerouteMigrationToast from '@/components/toast/RerouteMigrationToast.vue'\nimport { useBrowserTabTitle } from '@/composables/useBrowserTabTitle'\nimport { useCoreCommands } from '@/composables/useCoreCommands'\nimport { useErrorHandling } from '@/composables/useErrorHandling'\nimport { useProgressFavicon } from '@/composables/useProgressFavicon'\nimport { SERVER_CONFIG_ITEMS } from '@/constants/serverConfig'\nimport { i18n, loadLocale } from '@/i18n'\nimport ModelImportProgressDialog from '@/platform/assets/components/ModelImportProgressDialog.vue'\nimport { isCloud } from '@/platform/distribution/types'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useFrontendVersionMismatchWarning } from '@/platform/updates/common/useFrontendVersionMismatchWarning'\nimport { useVersionCompatibilityStore } from '@/platform/updates/common/versionCompatibilityStore'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport type { StatusWsMessageStatus } from '@/schemas/apiSchema'\nimport { api } from '@/scripts/api'\nimport { app } from '@/scripts/app'\nimport { setupAutoQueueHandler } from '@/services/autoQueueService'\nimport { useKeybindingService } from '@/services/keybindingService'\nimport { useAssetsStore } from '@/stores/assetsStore'\nimport { useCommandStore } from '@/stores/commandStore'\nimport { useExecutionStore } from '@/stores/executionStore'\nimport { useFirebaseAuthStore } from '@/stores/firebaseAuthStore'\nimport { useMenuItemStore } from '@/stores/menuItemStore'\nimport { useModelStore } from '@/stores/modelStore'\nimport { useNodeDefStore, useNodeFrequencyStore } from '@/stores/nodeDefStore'\nimport {\n  useQueuePendingTaskCountStore,\n  useQueueStore\n} from '@/stores/queueStore'\nimport { useServerConfigStore } from '@/stores/serverConfigStore'\nimport { useBottomPanelStore } from '@/stores/workspace/bottomPanelStore'\nimport { useColorPaletteStore } from '@/stores/workspace/colorPaletteStore'\nimport { useSidebarTabStore } from '@/stores/workspace/sidebarTabStore'\nimport { useWorkspaceStore } from '@/stores/workspaceStore'\nimport { electronAPI, isElectron } from '@/utils/envUtil'\nimport LinearView from '@/views/LinearView.vue'\nimport ManagerProgressToast from '@/workbench/extensions/manager/components/ManagerProgressToast.vue'\n\nsetupAutoQueueHandler()\nuseProgressFavicon()\nuseBrowserTabTitle()\n\nconst { t } = useI18n()\nconst toast = useToast()\nconst settingStore = useSettingStore()\nconst executionStore = useExecutionStore()\nconst colorPaletteStore = useColorPaletteStore()\nconst queueStore = useQueueStore()\nconst assetsStore = useAssetsStore()\nconst versionCompatibilityStore = useVersionCompatibilityStore()\nconst graphCanvasContainerRef = ref<HTMLDivElement | null>(null)\nconst { linearMode } = storeToRefs(useCanvasStore())\n\nconst telemetry = useTelemetry()\nconst firebaseAuthStore = useFirebaseAuthStore()\nlet hasTrackedLogin = false\nlet visibilityListener: (() => void) | null = null\nlet tabCountInterval: number | null = null\nlet tabCountChannel: BroadcastChannel | null = null\n\nwatch(\n  () => colorPaletteStore.completedActivePalette,\n  (newTheme) => {\n    const DARK_THEME_CLASS = 'dark-theme'\n    if (newTheme.light_theme) {\n      document.body.classList.remove(DARK_THEME_CLASS)\n    } else {\n      document.body.classList.add(DARK_THEME_CLASS)\n    }\n\n    if (isElectron()) {\n      electronAPI().changeTheme({\n        color: 'rgba(0, 0, 0, 0)',\n        symbolColor: newTheme.colors.comfy_base['input-text']\n      })\n    }\n  },\n  { immediate: true }\n)\n\nif (isElectron()) {\n  watch(\n    () => queueStore.tasks,\n    (newTasks, oldTasks) => {\n      // Report tasks that previously running but are now completed (i.e. in history)\n      const oldRunningTaskIds = new Set(\n        oldTasks.filter((task) => task.isRunning).map((task) => task.promptId)\n      )\n      newTasks\n        .filter(\n          (task) => oldRunningTaskIds.has(task.promptId) && task.isHistory\n        )\n        .forEach((task) => {\n          electronAPI().Events.incrementUserProperty(\n            `execution:${task.displayStatus.toLowerCase()}`,\n            1\n          )\n          electronAPI().Events.trackEvent('execution', {\n            status: task.displayStatus.toLowerCase()\n          })\n        })\n    },\n    { deep: true }\n  )\n}\n\nwatchEffect(() => {\n  const fontSize = settingStore.get('Comfy.TextareaWidget.FontSize')\n  document.documentElement.style.setProperty(\n    '--comfy-textarea-font-size',\n    `${fontSize}px`\n  )\n})\n\nwatchEffect(() => {\n  const padding = settingStore.get('Comfy.TreeExplorer.ItemPadding')\n  document.documentElement.style.setProperty(\n    '--comfy-tree-explorer-item-padding',\n    `${padding}px`\n  )\n})\n\nwatchEffect(async () => {\n  const locale = settingStore.get('Comfy.Locale')\n  if (locale) {\n    // Load the locale dynamically if not already loaded\n    try {\n      await loadLocale(locale)\n      // Type assertion is safe here as loadLocale validates the locale exists\n      i18n.global.locale.value = locale as typeof i18n.global.locale.value\n    } catch (error) {\n      console.error(`Failed to switch to locale \"${locale}\":`, error)\n    }\n  }\n})\n\nconst useNewMenu = computed(() => {\n  return settingStore.get('Comfy.UseNewMenu')\n})\nwatchEffect(() => {\n  if (useNewMenu.value === 'Disabled') {\n    app.ui.menuContainer.style.setProperty('display', 'block')\n    app.ui.restoreMenuPosition()\n  } else {\n    app.ui.menuContainer.style.setProperty('display', 'none')\n  }\n})\n\nwatchEffect(() => {\n  queueStore.maxHistoryItems = settingStore.get('Comfy.Queue.MaxHistoryItems')\n})\n\nconst init = () => {\n  const coreCommands = useCoreCommands()\n  useCommandStore().registerCommands(coreCommands)\n  useMenuItemStore().registerCoreMenuCommands()\n  useKeybindingService().registerCoreKeybindings()\n  useSidebarTabStore().registerCoreSidebarTabs()\n  useBottomPanelStore().registerCoreBottomPanelTabs()\n  app.extensionManager = useWorkspaceStore()\n}\n\nconst queuePendingTaskCountStore = useQueuePendingTaskCountStore()\nconst sidebarTabStore = useSidebarTabStore()\n\nconst onStatus = async (e: CustomEvent<StatusWsMessageStatus>) => {\n  queuePendingTaskCountStore.update(e)\n  await queueStore.update()\n  // Only update assets if the assets sidebar is currently open\n  // When sidebar is closed, AssetsSidebarTab.vue will refresh on mount\n  if (sidebarTabStore.activeSidebarTabId === 'assets') {\n    await assetsStore.updateHistory()\n  }\n}\n\nconst onExecutionSuccess = async () => {\n  await queueStore.update()\n  // Only update assets if the assets sidebar is currently open\n  // When sidebar is closed, AssetsSidebarTab.vue will refresh on mount\n  if (sidebarTabStore.activeSidebarTabId === 'assets') {\n    await assetsStore.updateHistory()\n  }\n}\n\nconst reconnectingMessage: ToastMessageOptions = {\n  severity: 'error',\n  summary: t('g.reconnecting')\n}\n\nconst onReconnecting = () => {\n  if (!settingStore.get('Comfy.Toast.DisableReconnectingToast')) {\n    toast.remove(reconnectingMessage)\n    toast.add(reconnectingMessage)\n  }\n}\n\nconst onReconnected = () => {\n  if (!settingStore.get('Comfy.Toast.DisableReconnectingToast')) {\n    toast.remove(reconnectingMessage)\n    toast.add({\n      severity: 'success',\n      summary: t('g.reconnected'),\n      life: 2000\n    })\n  }\n}\n\nonMounted(() => {\n  api.addEventListener('status', onStatus)\n  api.addEventListener('execution_success', onExecutionSuccess)\n  api.addEventListener('reconnecting', onReconnecting)\n  api.addEventListener('reconnected', onReconnected)\n  executionStore.bindExecutionEvents()\n\n  try {\n    init()\n    // Relocate the legacy menu container to the graph canvas container so it is below other elements\n    graphCanvasContainerRef.value?.prepend(app.ui.menuContainer)\n  } catch (e) {\n    console.error('Failed to init ComfyUI frontend', e)\n  }\n})\n\nonBeforeUnmount(() => {\n  api.removeEventListener('status', onStatus)\n  api.removeEventListener('execution_success', onExecutionSuccess)\n  api.removeEventListener('reconnecting', onReconnecting)\n  api.removeEventListener('reconnected', onReconnected)\n  executionStore.unbindExecutionEvents()\n\n  // Clean up page visibility listener\n  if (visibilityListener) {\n    document.removeEventListener('visibilitychange', visibilityListener)\n    visibilityListener = null\n  }\n\n  // Clean up tab count tracking\n  if (tabCountInterval) {\n    window.clearInterval(tabCountInterval)\n    tabCountInterval = null\n  }\n  if (tabCountChannel) {\n    tabCountChannel.close()\n    tabCountChannel = null\n  }\n})\n\nuseEventListener(window, 'keydown', useKeybindingService().keybindHandler)\n\nconst { wrapWithErrorHandling, wrapWithErrorHandlingAsync } = useErrorHandling()\n\n// Initialize version mismatch warning in setup context\n// It will be triggered automatically when the store is ready\nuseFrontendVersionMismatchWarning({ immediate: true })\n\nvoid nextTick(() => {\n  versionCompatibilityStore.initialize().catch((error) => {\n    console.warn('Version compatibility check failed:', error)\n  })\n})\n\nconst onGraphReady = () => {\n  runWhenGlobalIdle(() => {\n    // Track user login when app is ready in graph view (cloud only)\n    if (isCloud && firebaseAuthStore.isAuthenticated && !hasTrackedLogin) {\n      telemetry?.trackUserLoggedIn()\n      hasTrackedLogin = true\n    }\n\n    // Set up page visibility tracking (cloud only)\n    if (isCloud && telemetry && !visibilityListener) {\n      visibilityListener = () => {\n        telemetry.trackPageVisibilityChanged({\n          visibility_state: document.visibilityState as 'visible' | 'hidden'\n        })\n      }\n      document.addEventListener('visibilitychange', visibilityListener)\n    }\n\n    // Set up tab count tracking (cloud only)\n    if (isCloud && telemetry && !tabCountInterval) {\n      tabCountChannel = new BroadcastChannel('comfyui-tab-count')\n      const activeTabs = new Map<string, number>()\n      const currentTabId = crypto.randomUUID()\n\n      // Listen for heartbeats from other tabs\n      tabCountChannel.onmessage = (event) => {\n        if (\n          event.data.type === 'heartbeat' &&\n          event.data.tabId !== currentTabId\n        ) {\n          activeTabs.set(event.data.tabId, Date.now())\n        }\n      }\n\n      // 5-minute heartbeat interval\n      tabCountInterval = window.setInterval(() => {\n        const now = Date.now()\n\n        // Clean up stale tabs (no heartbeat for 45 seconds)\n        activeTabs.forEach((lastHeartbeat, tabId) => {\n          if (now - lastHeartbeat > 45000) {\n            activeTabs.delete(tabId)\n          }\n        })\n\n        // Broadcast our heartbeat\n        tabCountChannel?.postMessage({ type: 'heartbeat', tabId: currentTabId })\n\n        // Track tab count (include current tab)\n        const tabCount = activeTabs.size + 1\n        telemetry.trackTabCount({ tab_count: tabCount })\n      }, 60000 * 5)\n\n      // Send initial heartbeat\n      tabCountChannel.postMessage({ type: 'heartbeat', tabId: currentTabId })\n    }\n\n    // Setting values now available after comfyApp.setup.\n    // Load keybindings.\n    wrapWithErrorHandling(useKeybindingService().registerUserKeybindings)()\n\n    // Load server config\n    wrapWithErrorHandling(useServerConfigStore().loadServerConfig)(\n      SERVER_CONFIG_ITEMS,\n      settingStore.get('Comfy.Server.ServerConfigValues')\n    )\n\n    // Load model folders\n    void wrapWithErrorHandlingAsync(useModelStore().loadModelFolders)()\n\n    // Non-blocking load of node frequencies\n    void wrapWithErrorHandlingAsync(\n      useNodeFrequencyStore().loadNodeFrequencies\n    )()\n\n    // Node defs now available after comfyApp.setup.\n    // Explicitly initialize nodeSearchService to avoid indexing delay when\n    // node search is triggered\n    useNodeDefStore().nodeSearchService.searchNode('')\n  }, 1000)\n}\n</script>\n\n<style scoped>\n.comfyui-body {\n  grid-template-columns: auto 1fr auto;\n  grid-template-rows: auto 1fr auto;\n}\n\n/**\n  +------------------+------------------+------------------+\n  |                                                        |\n  |  .comfyui-body-                                        |\n  |       top                                              |\n  | (spans all cols)                                       |\n  |                                                        |\n  +------------------+------------------+------------------+\n  |                  |                  |                  |\n  | .comfyui-body-   |   #graph-canvas  | .comfyui-body-   |\n  |      left        |                  |      right       |\n  |                  |                  |                  |\n  |                  |                  |                  |\n  +------------------+------------------+------------------+\n  |                                                        |\n  |  .comfyui-body-                                        |\n  |      bottom                                            |\n  | (spans all cols)                                       |\n  |                                                        |\n  +------------------+------------------+------------------+\n*/\n\n.comfyui-body-top {\n  order: -5;\n  /* Span across all columns */\n  grid-column: 1/-1;\n  /* Position at the first row */\n  grid-row: 1;\n  /* Top menu bar dropdown needs to be above of graph canvas splitter overlay which is z-index: 999 */\n  /* Top menu bar z-index needs to be higher than bottom menu bar z-index as by default\n  pysssss's image feed is located at body-bottom, and it can overlap with the queue button, which\n  is located in body-top. */\n  z-index: 1001;\n  display: flex;\n  flex-direction: column;\n}\n\n.comfyui-body-left {\n  order: -4;\n  /* Position in the first column */\n  grid-column: 1;\n  /* Position below the top element */\n  grid-row: 2;\n  z-index: 10;\n  display: flex;\n}\n\n.graph-canvas-container {\n  width: 100%;\n  height: 100%;\n  order: -3;\n  grid-column: 2;\n  grid-row: 2;\n  position: relative;\n  overflow: clip;\n}\n\n.comfyui-body-right {\n  order: -2;\n  z-index: 10;\n  grid-column: 3;\n  grid-row: 2;\n}\n\n.comfyui-body-bottom {\n  order: 4;\n  /* Span across all columns */\n  grid-column: 1/-1;\n  grid-row: 3;\n  /* Bottom menu bar dropdown needs to be above of graph canvas splitter overlay which is z-index: 999 */\n  z-index: 1000;\n  display: flex;\n  flex-direction: column;\n}\n</style>\n"],"file":"GraphView-DbCBzUdi.js"}