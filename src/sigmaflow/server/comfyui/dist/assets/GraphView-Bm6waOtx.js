const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/SubscriptionRequiredDialogContent-D0645h_k.js","assets/index-CDsYNOuu.js","assets/vendor-primevue-6nO4LMK3.js","assets/vendor-other-PcOcwbNM.js","assets/vendor-other-CfuFdT9V.css","assets/vendor-vue-Cz2Pyvdp.js","assets/vendor-xterm-CWYFmgbN.js","assets/vendor-xterm-xj0gfbX3.css","assets/vendor-three-Bbe9LX3q.js","assets/vendor-tiptap-BsEBJZ_K.js","assets/index-1IdkATGn.css","assets/UserAvatar.vue_vue_type_script_setup_true_lang-3M5d7u0m.js","assets/index-zChG2MBs.js","assets/LazyImage.vue_vue_type_script_setup_true_lang-CAMeQb1E.js","assets/keybindingService-PYkEpa5I.js","assets/serverConfigStore-BupvrirU.js","assets/WidgetInputNumber.vue_vue_type_script_setup_true_lang-CFL7vI9W.js","assets/widgetPropFilter-CygYoMQt.js","assets/WidgetLayoutField.vue_vue_type_script_setup_true_lang-NHTHyQDQ.js","assets/WidgetWithControl.vue_vue_type_script_setup_true_lang-RlQhJxE1.js","assets/WidgetInputNumber-DwTgzZ6Z.css","assets/SubscriptionRequiredDialogContent-BJ80blC4.css","assets/ComfyQueueButton-DzPj78_I.js","assets/ComfyQueueButton-Chw03MdC.css"])))=>i.map(i=>d[i]);
var zl=Object.defineProperty;var n=(e,o)=>zl(e,"name",{value:o,configurable:!0});import{bw as Je,r as L,E as h,d6 as ha,bx as q,en as ya,i as Bl,e8 as Xo,w as ae,c as T,d,l as de,z as F,e as c,v as Qe,k as E,s as Q,by as y,q as V,p as ve,T as Zo,j as U,u as R,F as ne,y as be,A as $e,cM as en,cN as ko,eo as Fl,ep as ba,m as Pt,D as Hn,I as Ce,G as he,L as Be,eq as _s,dF as In,eb as Mn,er as Ul,h as Ie,J as Zt,e9 as tn,bB as on,bg as it,dc as rt,ds as wa,n as Re,dG as ke,o as Ve,cO as Ts,es as Gl,d8 as Jt,d2 as Ae,e5 as jl,cB as qt,db as nn,et as Hl,dw as ka,a as Pn,eu as Ca,f as xa,ev as ql,cd as ut,x as Nt,cp as Sa,cx as Vt,df as _a,t as eo,cy as qn,d5 as _t,e6 as Kl,ew as no,dI as St,du as Ta,bl as Ql,dm as Jl,cF as $a,b as Na,bz as pn,ex as Yl,ey as ho,ez as Xl,bi as $s,eA as Zl,cw as ei,bj as Ia,da as Ma,d3 as sn,eB as ti,d4 as oi,dD as Pa,dx as ni,bn as si,g as Ns,bk as Da,dE as ai,d0 as li,dC as Aa,eC as ii,ek as ri,e0 as ui}from"./vendor-other-PcOcwbNM.js";import{d as Dt,u as pe,s as Fe,j as La,k as Ea}from"./vendor-vue-Cz2Pyvdp.js";import{b as ci,p as Ye,_ as Kn,u as Bt,a0 as Oa,a1 as Dn,a2 as $t,a3 as Qn,w as Yt,a4 as Va,e as di,a5 as pi,a as Jn,q as Is,P as fi,R as mi,S as gi,M as vi,a6 as hi,v as Ra,o as Wa,O as za,T as No,c as yi,y as Ba,g as bi,a7 as wi,a8 as ki,m as Ci,k as go,a9 as xi}from"./vendor-primevue-6nO4LMK3.js";import{s as we,n as We,a as Se,i as Fa,b as mt,c as le,_ as X,d as Ee,S as an,t as ce,u as vt,e as ue,f as Mt,g as Si,E as Yn,h as Ms,V as _i,j as Ti,k as Xn,l as Zn,m as es,o as $i,p as tt,q as ot,r as J,v as Ni,w as Le,x as so,y as Ho,z as ao,A as _e,B as Ze,C as Ii,D as ht,F as Xe,G as Ua,H as Ga,I as ts,J as ja,K as me,L as Mi,M as Tt,N as Ha,O as lo,P as Pi,Q as Di,R as ln,T as Ai,U as Li,W as Ei,X as Ft,Y as Oi,Z as Vi,$ as os,a0 as io,a1 as ro,a2 as qa,a3 as Ka,a4 as Ri,a5 as Wi,a6 as Qa,a7 as ns,a8 as Ge,a9 as zi,aa as ft,ab as An,ac as ss,ad as Xt,ae as Bi,af as yo,ag as Ja,ah as Fi,ai as to,aj as De,ak as Ya,al as Ui,am as ct,an as Gi,ao as ji,ap as uo,aq as ge,ar as Hi,as as qi,at as Rt,au as He,av as Ro,aw as Ki,ax as Ut,ay as oo,az as Qi,aA as as,aB as ls,aC as qo,aD as is,aE as gt,aF as Wt,aG as Ji,aH as It,aI as Oe,aJ as Xa,aK as rn,aL as Yi,aM as Xi,aN as Za,aO as Zi,aP as er,aQ as tr,aR as or,aS as un,aT as Co,aU as nr,aV as sr,aW as ar,aX as lr,aY as ir,aZ as fn,a_ as rr,a$ as ur,b0 as cr,b1 as dr,b2 as pr,b3 as fr,b4 as mr,b5 as gr,b6 as vr,b7 as rs,b8 as hr,b9 as Ps,ba as yr,bb as br,bc as wr,bd as kr,be as Cr,bf as xt,bg as el,bh as tl,bi as xr,bj as Sr,bk as bo,bl as ol,bm as us,bn as nl,bo as sl,bp as al,bq as _r,br as Tr,bs as $r,bt as ll,bu as Nr,bv as Ds,bw as Ir,bx as Mr,by as cs,bz as Pr,bA as pt,bB as il,bC as Dr,bD as Ar,bE as Kt,bF as Lr,bG as Er,bH as Or,bI as Vr,bJ as Rr,bK as Wr,bL as zr,bM as Br,bN as mn,bO as Io,bP as Fr,bQ as rl,bR as gn,bS as Ur,bT as Gr,bU as vn,bV as ul,bW as As,bX as jr,bY as Hr,bZ as $o,b_ as hn,b$ as qr,c0 as Kr,c1 as Qr,c2 as Jr,c3 as Ls,c4 as Es,c5 as Os,c6 as Yr,c7 as cl,c8 as Xr,c9 as Zr,ca as eu,cb as tu,cc as Vs,cd as ou,ce as Rs,cf as nu,cg as su,ch as Ws,ci as zs,cj as au,ck as lu,cl as wo,cm as iu,cn as ru,co as uu,cp as cu,cq as du,cr as pu,cs as dl,ct as fu,cu as mu,cv as gu,cw as vu,cx as hu,cy as yu}from"./index-CDsYNOuu.js";import{_ as pl}from"./UserAvatar.vue_vue_type_script_setup_true_lang-3M5d7u0m.js";import{W as bu}from"./index-zChG2MBs.js";import{_ as Ko,u as wu,a as ku,b as Cu,c as xo,d as xu}from"./LazyImage.vue_vue_type_script_setup_true_lang-CAMeQb1E.js";import{u as yn}from"./keybindingService-PYkEpa5I.js";import{u as Su}from"./serverConfigStore-BupvrirU.js";import{_ as _u}from"./WidgetInputNumber.vue_vue_type_script_setup_true_lang-CFL7vI9W.js";var fl=(e=>(e.Cloud="cloud",e.Local="local",e.Desktop="desktop",e.Mac="mac",e.Windows="windows",e))(fl||{});const Mo=n(e=>({all:"icon-[lucide--list]","getting-started":"icon-[lucide--graduation-cap]","generation-image":"icon-[lucide--image]",image:"icon-[lucide--image]","generation-video":"icon-[lucide--film]",video:"icon-[lucide--film]","generation-3d":"icon-[lucide--box]","3d":"icon-[lucide--box]","generation-audio":"icon-[lucide--volume-2]",audio:"icon-[lucide--volume-2]","generation-llm":"icon-[lucide--message-square-text]","api-nodes":"icon-[lucide--hand-coins]","closed-models":"icon-[lucide--hand-coins]",llm:"icon-[lucide--message-square-text]",llms:"icon-[lucide--message-square-text]","llm-api":"icon-[lucide--message-square-text]","small-models":"icon-[lucide--zap]",performance:"icon-[lucide--zap]","mac-compatible":"icon-[lucide--command]","runs-on-mac":"icon-[lucide--command]","lora-training":"icon-[lucide--dumbbell]",training:"icon-[lucide--dumbbell]",extensions:"icon-[lucide--puzzle]",tools:"icon-[lucide--wrench]",upscaling:"icon-[lucide--maximize-2]",controlnet:"icon-[lucide--sliders-horizontal]","area-composition":"icon-[lucide--layout-grid]"})[e.toLowerCase()]||"icon-[lucide--folder]","getCategoryIcon");function Bs(e,o){return`${e.toLowerCase().replace(/\s+/g,"-")}-${o.toLowerCase().replace(/\s+/g,"-")}`}n(Bs,"generateCategoryId");const ml=Dt("workflowTemplates",()=>{const e=Je({}),o=Je([]),t=Je([]),s=L(!1),a=L(new Set),l=n(_=>p.value.find(C=>C.name===_),"getTemplateByName"),i=L(new Map),r=n((_,C)=>({..._,localizedTitle:we(`templateWorkflows.template.${We(C)}.${We(_.name)}`,_.title??_.name),localizedDescription:we(`templateWorkflows.templateDescription.${We(C)}.${We(_.name)}`,_.description)}),"addLocalizedFieldsToTemplate"),u=n((_,C)=>_.map(x=>r(x,C)),"localizeTemplateList"),f=n(_=>({..._,localizedTitle:we(`templateWorkflows.category.${We(_.title)}`,_.title??_.moduleName),templates:u(_.templates,_.title)}),"localizeTemplateCategory"),m=n(()=>{const _=o.value.flatMap(x=>x.templates.map(N=>({...r(N,x.title),sourceModule:x.moduleName}))),C=Object.entries(e.value).flatMap(([x,N])=>N.map(M=>({name:M,mediaType:"image",mediaSubtype:"jpg",description:M,sourceModule:x})));return{moduleName:"all",title:"All",localizedTitle:we("templateWorkflows.category.All","All Templates"),templates:[..._,...C]}},"createAllCategory"),v=h(()=>{const _=[...o.value.map(f),...Object.entries(e.value).map(([x,N])=>({moduleName:x,title:x,localizedTitle:we(`templateWorkflows.category.${We(x)}`,x),templates:N.map(M=>({name:M,mediaType:"image",mediaSubtype:"jpg",description:M}))}))];return[{label:we("templateWorkflows.category.ComfyUI Examples","ComfyUI Examples"),modules:[m(),..._.filter(x=>x.moduleName==="default")]},...Object.keys(e.value).length>0?[{label:we("templateWorkflows.category.Custom Nodes","Custom Nodes"),modules:_.filter(x=>x.moduleName!=="default")}]:[]]}),p=h(()=>{const _=[];return o.value.forEach(x=>{x.templates.forEach(N=>{const M={...N,sourceModule:x.moduleName,category:x.title,categoryType:x.type,categoryGroup:x.category,isEssential:x.isEssential,isPartnerNode:N.openSource===!1,searchableText:[N.title||N.name,N.description||"",x.title,...N.tags||[],...N.models||[]].join(" ")};_.push(M)})}),Object.entries(e.value).forEach(([x,N])=>{N.forEach(M=>{const $={name:M,title:M,description:M,mediaType:"image",mediaSubtype:"jpg",sourceModule:x,category:"Extensions",categoryType:"extension",searchableText:`${M} ${x} extension`};_.push($)})}),_.filter(x=>!x.requiresCustomNodes?.length)}),w=h(()=>{const _={keys:[{name:"searchableText",weight:.4},{name:"title",weight:.3},{name:"name",weight:.2},{name:"tags",weight:.1}],threshold:.3,includeScore:!0};return new ha(p.value,_)}),k=n(_=>{if(_==="all")return p.value;if(_.startsWith("basics-"))return p.value.filter(x=>x.isEssential&&x.category?.toLowerCase().replace(/\s+/g,"-")===_.replace("basics-",""));if(_==="popular")return p.value;if(_==="partner-nodes")return p.value.filter(x=>x.isPartnerNode);if(_.startsWith("extension-")){const x=_.replace("extension-","");return p.value.filter(N=>N.sourceModule===x)}const C=i.value.get(_);return C?p.value.filter(x=>!(C.category&&x.category!==C.category||C.categoryGroup&&x.categoryGroup!==C.categoryGroup)):p.value},"filterTemplatesByCategory"),g=h(()=>{if(!s.value)return[];const _=[];i.value.clear(),_.push({id:"all",label:we("templateWorkflows.category.All","All Templates"),icon:Mo("all")}),_.push({id:"popular",label:we("templateWorkflows.category.Popular","Popular"),icon:"icon-[lucide--flame]"});const C=o.value.filter($=>$.isEssential&&$.templates.length>0);C.length>0&&C.forEach($=>{const I=$.icon,P=$.title??"Getting Started",z=Bs("basics",$.title);_.push({id:z,label:we(`templateWorkflows.category.${We(P)}`,P),icon:I||Mo($.type||"getting-started")})});const x=new Map;if(o.value.forEach($=>{if($.isEssential)return;const I=$.category,P=$.icon;if(I){x.has(I)||x.set(I,{title:I,items:[]});const z=x.get(I),j=Bs(I,$.title);i.value.set(j,{category:$.title,categoryGroup:I}),z.items.push({id:j,label:we(`templateWorkflows.category.${We($.title)}`,$.title),icon:P||Mo($.type||"default")})}}),x.forEach(($,I)=>{$.items.length>0&&_.push({title:we(`templateWorkflows.category.${We(I)}`,I.split(" ").map(P=>P.charAt(0).toUpperCase()+P.slice(1).toLowerCase()).join(" ")),items:$.items})}),p.value.filter($=>$.isPartnerNode).length>0&&_.push({id:"partner-nodes",label:we("templateWorkflows.category.Partner Nodes","Partner Nodes"),icon:"icon-[lucide--handshake]"}),p.value.filter($=>$.sourceModule!=="default").length>0){const I=Array.from(new Set(p.value.filter(P=>P.sourceModule!=="default").map(P=>P.sourceModule))).sort().map(P=>({id:`extension-${P}`,label:we(`templateWorkflows.category.${We(P)}`,P),icon:Mo("extensions")}));_.push({title:we("templateWorkflows.category.Extensions","Extensions"),items:I,collapsible:!0})}return _});async function b(){try{if(!s.value){e.value=await Se.getWorkflowTemplates();const _=Fa.global.locale.value,[C,x]=await Promise.all([Se.getCoreWorkflowTemplates(_),mt&&_!=="en"?Se.getCoreWorkflowTemplates("en"):Promise.resolve([])]);o.value=C,t.value=x;const N=o.value.flatMap($=>$.templates.map(I=>I.name)),M=Object.values(e.value).flat();a.value=new Set([...N,...M]),s.value=!0}}catch(_){console.error("Error fetching workflow templates:",_)}}n(b,"loadWorkflowTemplates");function S(_){if(t.value.length===0)return null;for(const C of t.value){const x=C.templates.find(N=>N.name===_);if(x)return{tags:x.tags,category:C.title,useCase:x.useCase,models:x.models,license:x.license}}return null}return n(S,"getEnglishMetadata"),{groupedTemplates:v,navGroupedTemplates:g,enhancedTemplates:p,templateFuse:w,filterTemplatesByCategory:k,isLoaded:s,loadWorkflowTemplates:b,knownTemplateNames:a,getTemplateByName:l,getEnglishMetadata:S}}),cn=Symbol(),Tu={class:"base-widget-layout rounded-2xl overflow-hidden relative"},$u={class:"flex h-full w-full"},Nu={class:"flex-1 flex bg-base-background"},Iu={class:"flex h-full w-full flex-col"},Mu={key:0,class:"w-full h-18 px-6 flex items-center justify-between gap-2"},Pu={class:"flex flex-1 shrink-0 gap-2"},Du={class:"flex min-h-0 flex-1 flex-col"},Au={key:0,class:"text-xxl m-0 px-6 pt-2 pb-6 capitalize"},Lu={class:"min-h-0 flex-1 px-6 pt-0 pb-10 overflow-y-auto scrollbar-custom"},Eu={key:0,class:"w-1/4 min-w-40 max-w-80"},Ou=q({__name:"BaseModalLayout",props:{contentTitle:{}},setup(e){const o={md:880},t={width:"w-1/3",minWidth:"min-w-40",maxWidth:"max-w-56"},s=ya(),a=Bl(cn,()=>{}),i=Xo(o).greater("md"),r=L(!0),u=L(!1),f=L(!1),m=h(()=>!!s.rightPanel);ae(i,k=>{k||(f.value=!1)});const v=h(()=>i.value?r.value:f.value),p=n(()=>{i.value?r.value=!r.value:f.value=!f.value},"toggleLeftPanel"),w=n(()=>{u.value=!u.value},"toggleRightPanel");return(k,g)=>(d(),T("div",Tu,[de(F(X,{size:"icon",class:Q(y(le)("absolute top-4 right-18 z-10","transition-opacity duration-200",{"opacity-0 pointer-events-none":u.value||!m.value})),onClick:w},{default:E(()=>g[0]||(g[0]=[c("i",{class:"icon-[lucide--panel-right] text-sm"},null,-1)])),_:1},8,["class"]),[[Qe,!u.value&&m.value]]),F(X,{size:"lg",class:"absolute top-4 right-6 z-10 transition-opacity duration-200 w-10",onClick:y(a)},{default:E(()=>g[1]||(g[1]=[c("i",{class:"pi pi-times"},null,-1)])),_:1},8,["onClick"]),c("div",$u,[F(Zo,{name:"slide-panel"},{default:E(()=>[k.$slots.leftPanel&&v.value?(d(),T("nav",{key:0,class:Q([t.width,t.minWidth,t.maxWidth])},[ve(k.$slots,"leftPanel",{},void 0,!0)],2)):V("",!0)]),_:3}),c("div",Nu,[c("div",Iu,[k.$slots.header?(d(),T("header",Mu,[c("div",Pu,[y(i)?V("",!0):(d(),U(X,{key:0,size:"icon",onClick:p},{default:E(()=>[c("i",{class:Q(y(le)(v.value?"icon-[lucide--panel-left]":"icon-[lucide--panel-left-close]"))},null,2)]),_:1})),ve(k.$slots,"header",{},void 0,!0)]),ve(k.$slots,"header-right-area",{},void 0,!0),c("div",{class:Q(y(le)("flex justify-end gap-2 w-0",m.value&&!u.value?"min-w-22":"min-w-10"))},[u.value&&m.value?(d(),U(X,{key:0,size:"icon",onClick:w},{default:E(()=>g[2]||(g[2]=[c("i",{class:"icon-[lucide--panel-right-close]"},null,-1)])),_:1})):V("",!0)],2)])):V("",!0),c("main",Du,[ve(k.$slots,"contentFilter",{},void 0,!0),k.$slots.leftPanel?V("",!0):(d(),T("h2",Au,R(k.contentTitle),1)),c("div",Lu,[ve(k.$slots,"content",{},void 0,!0)])])]),m.value&&u.value?(d(),T("aside",Eu,[ve(k.$slots,"rightPanel",{},void 0,!0)])):V("",!0)])])]))}}),ds=Ee(Ou,[["__scopeId","data-v-643fc509"]]),Vu=q({__name:"NavIcon",props:{icon:{}},setup(e){return(o,t)=>(d(),T("i",{class:Q([o.icon,"text-neutral text-sm shrink-0"])},null,2))}}),Ru={key:0,class:"pt-0.5"},Wu={key:1,class:"text-neutral icon-[lucide--folder] text-xs shrink-0"},zu={class:"flex items-center break-all"},Fs=q({__name:"NavItem",props:{icon:{},active:{type:Boolean},onClick:{type:Function}},setup(e){return(o,t)=>(d(),T("div",{class:Q(["flex cursor-pointer items-start gap-2 rounded-md px-4 py-3 text-sm transition-colors text-base-foreground",o.active?"bg-interface-menu-component-surface-selected":"hover:bg-interface-menu-component-surface-hovered"]),role:"button",onClick:t[0]||(t[0]=(...s)=>o.onClick&&o.onClick(...s))},[o.icon?(d(),T("div",Ru,[F(Vu,{icon:o.icon},null,8,["icon"])])):(d(),T("i",Wu)),c("span",zu,[ve(o.$slots,"default")])],2))}}),Bu={class:"text-xs font-bold text-text-secondary uppercase"},Fu=q({__name:"NavTitle",props:{title:{},modelValue:{type:Boolean,default:!1},collapsible:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:o}){const t=o,s=h({get:n(()=>e.modelValue,"get"),set:n(l=>t("update:modelValue",l),"set")}),a=n(()=>{s.value=!s.value},"toggleCollapse");return(l,i)=>(d(),T("div",{class:Q(y(le)("flex items-center justify-between m-0 px-3 py-0 pt-5",l.collapsible&&"cursor-pointer select-none")),onClick:i[0]||(i[0]=r=>l.collapsible&&a())},[c("h3",Bu,R(l.title),1),l.collapsible?(d(),T("i",{key:0,class:Q(y(le)("pi transition-transform duration-200 text-xs text-text-secondary ",s.value?"pi-chevron-right":"pi-chevron-down"))},null,2)):V("",!0)],2))}}),Uu={},Gu={class:"flex h-16 items-center justify-between px-6"},ju={class:"flex items-center gap-2 pl-1"},Hu={class:"text-neutral text-base font-bold"};function qu(e,o){return d(),T("header",Gu,[c("div",ju,[ve(e.$slots,"icon",{},()=>[o[0]||(o[0]=c("i",{class:"text-neutral icon-[lucide--puzzle] text-base"},null,-1))]),c("h2",Hu,[ve(e.$slots,"default")])])])}n(qu,"_sfc_render$2");const Ku=Ee(Uu,[["render",qu]]),Qu={class:"flex h-full w-full flex-col bg-modal-panel-background"},Ju={class:"flex scrollbar-hide flex-1 flex-col gap-1 overflow-y-auto px-3 py-4"},Yu={key:0,class:"flex flex-col gap-2"},Xu={key:1,class:"flex flex-col gap-2"},ps=q({__name:"LeftSidePanel",props:{navItems:{default:n(()=>[],"default")},modelValue:{}},emits:["update:modelValue"],setup(e,{emit:o}){const t=o,s=L({}),a=n(()=>{if(!e.navItems||e.navItems.length===0)return null;const i=e.navItems[0];return"items"in i&&i.items.length>0?i.items[0].id:"id"in i?i.id:null},"getFirstItemId"),l=h({get:n(()=>e.modelValue??a(),"get"),set:n(i=>t("update:modelValue",i),"set")});return(i,r)=>(d(),T("div",Qu,[F(Ku,null,{icon:E(()=>[ve(i.$slots,"header-icon")]),default:E(()=>[ve(i.$slots,"header-title")]),_:3}),c("nav",Ju,[(d(!0),T(ne,null,be(i.navItems,(u,f)=>(d(),T(ne,{key:f},["items"in u?(d(),T("div",Yu,[F(Fu,{modelValue:s.value[u.title],"onUpdate:modelValue":n(m=>s.value[u.title]=m,"onUpdate:modelValue"),title:u.title,collapsible:u.collapsible},null,8,["modelValue","onUpdate:modelValue","title","collapsible"]),!u.collapsible||!s.value[u.title]?(d(!0),T(ne,{key:0},be(u.items,m=>(d(),U(Fs,{key:m.id,icon:m.icon,active:l.value===m.id,onClick:n(v=>l.value=m.id,"onClick")},{default:E(()=>[$e(R(m.label),1)]),_:2},1032,["icon","active","onClick"]))),128)):V("",!0)])):(d(),T("div",Xu,[F(Fs,{icon:u.icon,active:l.value===u.id,onClick:n(m=>l.value=u.id,"onClick")},{default:E(()=>[$e(R(u.label),1)]),_:2},1032,["icon","active","onClick"])]))],64))),128))])]))}});function Zu(e){return h(()=>{const{minWidth:o,maxWidth:t}=e,s={};return o&&(s.minWidth=o),t&&(s.maxWidth=t),s})}n(Zu,"usePopoverSizing");const ec={class:"flex flex-col px-2 pt-2 pb-0"},tc={key:1,class:"mt-2 flex items-center justify-between"},oc={key:0,class:"px-1 text-sm text-base-foreground"},nc={class:"text-sm"},sc={key:0,class:"pointer-events-none absolute -top-2 -right-2 z-10 flex h-5 w-5 items-center justify-center rounded-full bg-primary-background text-xs font-semibold text-base-foreground"},ac={key:0,class:"text-bold icon-[lucide--check] text-xs text-base-foreground"},zt=q({inheritAttrs:!1,__name:"MultiSelect",props:en({label:{},showSearchBox:{type:Boolean,default:!1},showSelectedCount:{type:Boolean,default:!1},showClearButton:{type:Boolean,default:!1},searchPlaceholder:{default:"Search..."},listMaxHeight:{default:"28rem"},popoverMinWidth:{},popoverMaxWidth:{}},{modelValue:{required:!0},modelModifiers:{},searchQuery:{default:""},searchQueryModifiers:{}}),emits:["update:modelValue","update:searchQuery"],setup(e){const o=ko(e,"modelValue"),t=ko(e,"searchQuery"),{t:s}=pe(),a=h(()=>o.value.length),l=Zu({minWidth:e.popoverMinWidth,maxWidth:e.popoverMaxWidth}),i=Fl(),r=h(()=>i.options||[]),u={fuseOptions:{keys:["name","value"],threshold:.3,includeScore:!1},matchAllWhenSearchEmpty:!0},{results:f}=ba(t,r,u),m=h(()=>{if(!t.value||t.value.trim()==="")return r.value;const v=f.value.map(w=>w.item);return[...o.value.filter(w=>!v.some(k=>k.value===w.value)),...v]});return(v,p)=>(d(),U(y(ci),Pt({modelValue:o.value,"onUpdate:modelValue":p[2]||(p[2]=w=>o.value=w)},{...v.$attrs,options:m.value},{"option-label":"name",unstyled:"","max-selected-labels":0,pt:{root:n(({props:w})=>({class:y(le)("h-10 relative inline-flex cursor-pointer select-none","rounded-lg bg-secondary-background text-base-foreground","transition-all duration-200 ease-in-out","border-[2.5px] border-solid",a.value>0?"border-node-component-border":"border-transparent","focus-within:border-node-component-border",{"opacity-60 cursor-default":w.disabled})}),"root"),labelContainer:{class:"flex-1 flex items-center overflow-hidden whitespace-nowrap pl-4 py-2 "},label:{class:"p-0"},dropdown:{class:"flex shrink-0 cursor-pointer items-center justify-center px-3"},header:n(()=>({class:v.showSearchBox||v.showSelectedCount||v.showClearButton?"block":"hidden"}),"header"),overlay:{class:y(le)("mt-2 rounded-lg py-2 px-2","bg-base-background","text-base-foreground","border border-solid border-border-default")},listContainer:n(()=>({style:{maxHeight:`min(${v.listMaxHeight}, 50vh)`},class:"scrollbar-custom"}),"listContainer"),list:{class:"flex flex-col gap-0 p-0 m-0 list-none border-none text-sm"},option:n(({context:w})=>({class:y(le)("flex gap-2 items-center h-10 px-2 rounded-lg cursor-pointer","hover:bg-secondary-background-hover",w?.focused&&"bg-secondary-background-selected hover:bg-secondary-background-selected")}),"option"),pcHeaderCheckbox:{root:{class:"hidden"},style:{display:"none"}},pcOptionCheckbox:{root:{class:"hidden"},style:{display:"none"}}},"aria-label":v.label||y(s)("g.multiSelectDropdown"),role:"combobox","aria-expanded":!1,"aria-haspopup":"listbox",tabindex:0}),Hn({value:E(()=>[c("span",nc,R(v.label),1),a.value>0?(d(),T("span",sc,R(a.value),1)):V("",!0)]),dropdownicon:E(()=>[p[4]||(p[4]=c("i",{class:"icon-[lucide--chevron-down] text-muted-foreground"},null,-1))]),option:E(w=>[c("div",{role:"button",class:"flex items-center gap-2 cursor-pointer",style:he(y(l))},[c("div",{class:Q(["flex size-4 shrink-0 items-center justify-center rounded p-0.5 transition-all duration-200",w.selected?"bg-primary-background":"bg-secondary-background"])},[w.selected?(d(),T("i",ac)):V("",!0)],2),c("span",null,R(w.option.name),1)],4)]),_:2},[v.showSearchBox||v.showSelectedCount||v.showClearButton?{name:"header",fn:E(()=>[c("div",ec,[v.showSearchBox?(d(),U(an,{key:0,modelValue:t.value,"onUpdate:modelValue":p[0]||(p[0]=w=>t.value=w),class:Q(v.showSelectedCount||v.showClearButton?"mb-2":""),"show-order":!0,"show-border":!0,"place-holder":v.searchPlaceholder},null,8,["modelValue","class","place-holder"])):V("",!0),v.showSelectedCount||v.showClearButton?(d(),T("div",tc,[v.showSelectedCount?(d(),T("span",oc,R(a.value>0?v.$t("g.itemsSelected",{selectedCount:a.value}):v.$t("g.itemSelected",{selectedCount:a.value})),1)):V("",!0),v.showClearButton?(d(),U(X,{key:1,variant:"textonly",size:"md",onClick:p[1]||(p[1]=Ce(w=>o.value=[],["stop"]))},{default:E(()=>[$e(R(v.$t("g.clearAll")),1)]),_:1})):V("",!0)])):V("",!0),p[3]||(p[3]=c("div",{class:"my-4 h-px bg-border-default"},null,-1))])]),key:"0"}:void 0]),1040,["modelValue","pt","aria-label"]))}});function lc(e){const o=h(()=>{const a=Be(e).map(i=>{const r=i.name.split(".").pop();return r&&r!==i.name?r:null}).filter(i=>i!==null);return _s(a,(i,r)=>i===r).sort().map(i=>({name:`.${i}`,value:i}))}),t=h(()=>{const a=Be(e).map(i=>i.user_metadata?.base_model).filter(i=>i!==void 0&&typeof i=="string");return _s(a,(i,r)=>i===r).sort().map(i=>({name:i,value:i}))});return{availableFileFormats:o,availableBaseModels:t}}n(lc,"useAssetFilterOptions");const ic={class:"flex gap-4 items-center justify-between px-6 pt-2 pb-6","data-component-id":"asset-filter-bar"},rc={class:"flex gap-4 items-center","data-component-id":"asset-filter-bar-left"},uc={class:"flex items-center","data-component-id":"asset-filter-bar-right"},cc=q({__name:"AssetFilterBar",props:{assets:{default:n(()=>[],"default")},allAssets:{default:n(()=>[],"default")}},emits:["filterChange"],setup(e,{emit:o}){const s=[...[{name:ce("assetBrowser.sortRecent"),value:"recent"},{name:ce("assetBrowser.sortAZ"),value:"name-asc"},{name:ce("assetBrowser.sortZA"),value:"name-desc"}]],a=[{name:ce("assetBrowser.ownershipAll"),value:"all"},{name:ce("assetBrowser.ownershipMyModels"),value:"my-models"},{name:ce("assetBrowser.ownershipPublicModels"),value:"public-models"}],l=L([]),i=L([]),r=L("recent"),u=L("all"),{availableFileFormats:f,availableBaseModels:m}=lc(e.assets),v=h(()=>(e.allAssets.length?e.allAssets:e.assets).some(g=>g.is_immutable===!1)),p=o;function w(){p("filterChange",{fileFormats:l.value.map(k=>k.value),baseModels:i.value.map(k=>k.value),sortBy:r.value,ownership:u.value})}return n(w,"handleFilterChange"),(k,g)=>(d(),T("div",ic,[c("div",rc,[y(f).length>0?(d(),U(zt,{key:0,modelValue:l.value,"onUpdate:modelValue":[g[0]||(g[0]=b=>l.value=b),w],label:k.$t("assetBrowser.fileFormats"),options:y(f),class:"min-w-32","data-component-id":"asset-filter-file-formats"},null,8,["modelValue","label","options"])):V("",!0),y(m).length>0?(d(),U(zt,{key:1,modelValue:i.value,"onUpdate:modelValue":[g[1]||(g[1]=b=>i.value=b),w],label:k.$t("assetBrowser.baseModels"),options:y(m),class:"min-w-32","data-component-id":"asset-filter-base-models"},null,8,["modelValue","label","options"])):V("",!0),v.value?(d(),U(Ko,{key:2,modelValue:u.value,"onUpdate:modelValue":[g[2]||(g[2]=b=>u.value=b),w],label:k.$t("assetBrowser.ownership"),options:a,class:"min-w-42","data-component-id":"asset-filter-ownership"},null,8,["modelValue","label"])):V("",!0)]),c("div",uc,[F(Ko,{modelValue:r.value,"onUpdate:modelValue":[g[3]||(g[3]=b=>r.value=b),w],label:k.$t("assetBrowser.sortBy"),options:s,class:"min-w-32","data-component-id":"asset-filter-sort"},{icon:E(()=>g[4]||(g[4]=[c("i",{class:"icon-[lucide--arrow-up-down]"},null,-1)])),_:1},8,["modelValue","label"])])]))}}),dc={class:"relative inline-flex items-center"},pc={class:"flex min-w-40 flex-col gap-2 p-2"},gl=q({__name:"MoreButton",props:{isVertical:{type:Boolean,default:!1}},emits:["menuOpened","menuClosed"],setup(e,{expose:o}){const t=L(!1),s=L();function a(){s.value?.hide()}return n(a,"hide"),o({hide:a,isOpen:t}),(l,i)=>(d(),T("div",dc,[F(X,{size:"icon",variant:"secondary",onClick:s.value?.toggle},{default:E(()=>[c("i",{class:Q(y(le)(l.isVertical?"icon-[lucide--more-vertical]":"icon-[lucide--ellipsis]","text-sm"))},null,2)]),_:1},8,["onClick"]),F(y(Ye),{ref_key:"popover",ref:s,"append-to":"body","auto-z-index":"",dismissable:"","close-on-escape":"",unstyled:"","base-z-index":1e3,pt:{root:{class:y(le)("absolute z-50")},content:{class:y(le)("mt-1 rounded-lg","bg-secondary-background text-base-foreground","shadow-lg")}},onShow:i[0]||(i[0]=()=>{t.value=!0,l.$emit("menuOpened")}),onHide:i[1]||(i[1]=()=>{t.value=!1,l.$emit("menuClosed")})},{default:E(()=>[c("div",pc,[ve(l.$slots,"default",{close:a})])]),_:3},8,["pt"])]))}}),fc={class:"flex flex-col px-4 py-2 text-sm text-muted-foreground border-t border-border-default"},mc={key:0},gc=q({__name:"ConfirmBody",props:{promptText:{}},setup(e){const o=h(()=>Be(e.promptText));return(t,s)=>(d(),T("div",fc,[o.value?(d(),T("p",mc,R(o.value),1)):V("",!0)]))}}),vc={class:"w-full flex gap-2 justify-end px-2 pb-2"},hc=q({__name:"ConfirmFooter",props:{cancelText:{},confirmText:{},confirmClass:{},optionsDisabled:{}},emits:["cancel","confirm"],setup(e){const{t:o}=pe(),t=h(()=>e.confirmText||o("g.confirm")),s=h(()=>e.cancelText||o("g.cancel")),a=h(()=>Be(e.optionsDisabled));return(l,i)=>(d(),T("section",vc,[F(X,{disabled:a.value,variant:"textonly",autofocus:"",onClick:i[0]||(i[0]=r=>l.$emit("cancel"))},{default:E(()=>[$e(R(s.value),1)]),_:1},8,["disabled"]),F(X,{disabled:a.value,variant:"textonly",class:Q(l.confirmClass),onClick:i[1]||(i[1]=r=>l.$emit("confirm"))},{default:E(()=>[$e(R(t.value),1)]),_:1},8,["disabled","class"])]))}}),yc={class:"flex items-center gap-2 p-4 font-bold text-sm text-base-foreground font-inter"},bc={key:0,class:"flex-auto"},wc=q({__name:"ConfirmHeader",props:{title:{}},setup(e){return(o,t)=>(d(),T("div",yc,[o.title?(d(),T("span",bc,R(o.title),1)):V("",!0)]))}});function kc(e={}){const o=vt(),{headerProps:t,props:s,footerProps:a}=e;return o.showDialog({headerComponent:wc,component:gc,footerComponent:hc,headerProps:t,props:s,footerProps:a,dialogComponentProps:{pt:{header:"py-0! px-0!",content:"p-0!",footer:"p-0!"}}})}n(kc,"showConfirmDialog");const Cc={class:"absolute left-2 bottom-2 flex flex-wrap justify-start gap-1"},xc=q({__name:"AssetBadgeGroup",props:{badges:{}},setup(e){return(o,t)=>(d(),T("div",Cc,[(d(!0),T(ne,null,be(o.badges,s=>(d(),T("span",{key:s.label,class:Q(y(le)("px-2 py-1 rounded text-xs font-bold uppercase tracking-wider text-modal-card-tag-foreground bg-modal-card-tag-background break-all"))},R(s.label),3))),128))]))}}),Sc=["data-asset-id","aria-labelledby","aria-describedby","tabindex"],_c={class:"relative aspect-square w-full overflow-hidden rounded-xl"},Tc=["src","alt"],$c={class:"max-h-32 flex flex-col gap-2 justify-between flex-auto"},Nc=["id"],Ic=["id"],Mc={class:"flex gap-4 text-xs text-muted-foreground mt-auto"},Pc={key:0,class:"flex items-center gap-1"},Dc={key:1,class:"flex items-center gap-1"},Ac={key:2,class:"flex items-center gap-1"},Lc=q({__name:"AssetCard",props:{asset:{},interactive:{type:Boolean}},emits:["select"],setup(e){const{t:o}=pe(),t=ue(),{closeDialog:s}=vt(),{flags:a}=wu(),l=Mt(),i=In("dropdown-menu-button"),r=Mn(),u=Mn(),f=L(!1),m=L(),v=L(!1),p=h(()=>m.value??e.asset.name),w=h(()=>(a.assetDeletionEnabled||a.assetRenameEnabled)&&!(e.asset.is_immutable??!0)),k=h(()=>t.get("LiteGraph.Node.TooltipDelay")),{isLoading:g,error:b}=Ul({src:e.asset.preview_url??"",alt:e.asset.name});function S(){i.value?.hide();const x=Be(p),N=L(o("assetBrowser.deletion.body")),M=L(!1),$=kc({headerProps:{title:o("assetBrowser.deletion.header")},props:{promptText:N},footerProps:{confirmText:o("g.delete"),confirmClass:le("bg-danger-200 text-base-foreground hover:bg-danger-200/80 focus:bg-danger-200/80 focus:ring ring-base-foreground"),optionsDisabled:M,onCancel:n(()=>{s($)},"onCancel"),onConfirm:n(async()=>{M.value=!0;try{N.value=o("assetBrowser.deletion.inProgress",{assetName:x}),await Ms.deleteAsset(e.asset.id),N.value=o("assetBrowser.deletion.complete",{assetName:x}),await new Promise(I=>setTimeout(I,1e3)),v.value=!0}catch(I){console.error(I),N.value=o("assetBrowser.deletion.failed",{assetName:x}),await new Promise(P=>setTimeout(P,3e3))}finally{s($)}},"onConfirm")}})}n(S,"confirmDeletion");function _(){i.value?.hide(),f.value=!0}n(_,"startAssetRename");async function C(x){if(f.value=!1,x){m.value=x;try{const N=await Ms.updateAsset(e.asset.id,{name:x});m.value=N.name}catch(N){console.error(N),l.add({severity:"error",summary:o("assetBrowser.rename.failed"),life:1e4}),m.value=void 0}}}return n(C,"assetRename"),(x,N)=>{const M=Ie("tooltip");return v.value?V("",!0):(d(),T("div",{key:0,"data-component-id":"AssetCard","data-asset-id":x.asset.id,"aria-labelledby":y(r),"aria-describedby":y(u),tabindex:x.interactive?0:-1,class:Q(y(le)("rounded-2xl overflow-hidden transition-all duration-200 bg-modal-card-background p-2 gap-2 flex flex-col h-full",x.interactive&&"group appearance-none bg-transparent m-0 outline-none text-left hover:bg-secondary-background focus:bg-secondary-background border-none focus:outline-solid outline-base-foreground outline-4")),onKeydown:N[3]||(N[3]=Zt(Ce($=>x.interactive&&x.$emit("select",x.asset),["self"]),["enter"]))},[c("div",_c,[y(g)||y(b)?(d(),T("div",{key:0,class:"flex size-full cursor-pointer items-center justify-center bg-gradient-to-br from-smoke-400 via-smoke-800 to-charcoal-400",role:"button",onClick:N[0]||(N[0]=Ce($=>x.interactive&&x.$emit("select",x.asset),["self"]))})):(d(),T("img",{key:1,src:x.asset.preview_url,alt:p.value,class:"size-full object-cover cursor-pointer",role:"button",onClick:N[1]||(N[1]=Ce($=>x.interactive&&x.$emit("select",x.asset),["self"]))},null,8,Tc)),F(xc,{badges:x.asset.badges},null,8,["badges"]),w.value?(d(),U(Si,{key:2,class:Q(y(le)("absolute top-2 right-2 invisible group-hover:visible",y(i)?.isOpen&&"visible"))},{default:E(()=>[F(gl,{ref:"dropdown-menu-button",size:"sm"},{default:E(()=>[y(a).assetRenameEnabled?(d(),U(X,{key:0,variant:"secondary",size:"md",class:"justify-start",onClick:_},{default:E(()=>[N[4]||(N[4]=c("i",{class:"icon-[lucide--pencil]"},null,-1)),c("span",null,R(x.$t("g.rename")),1)]),_:1})):V("",!0),y(a).assetDeletionEnabled?(d(),U(X,{key:1,variant:"secondary",size:"md",class:"justify-start",onClick:S},{default:E(()=>[N[5]||(N[5]=c("i",{class:"icon-[lucide--trash-2]"},null,-1)),c("span",null,R(x.$t("g.delete")),1)]),_:1})):V("",!0)]),_:1},512)]),_:1},8,["class"])):V("",!0)]),c("div",$c,[de((d(),T("h3",{id:y(r),class:Q(y(le)("mb-2 m-0 text-base font-semibold line-clamp-2 wrap-anywhere","text-base-foreground"))},[F(Yn,{"model-value":p.value,"is-editing":f.value,"input-attrs":{"data-testid":"asset-name-input"},onEdit:C,onCancel:N[2]||(N[2]=$=>C())},null,8,["model-value","is-editing"])],10,Nc)),[[M,{value:p.value,showDelay:k.value},void 0,{top:!0}]]),de((d(),T("p",{id:y(u),class:Q(y(le)("m-0 text-sm leading-6 overflow-hidden [-webkit-box-orient:vertical] [-webkit-line-clamp:2] [display:-webkit-box] text-muted-foreground"))},[$e(R(x.asset.description),1)],10,Ic)),[[M,{value:x.asset.description,showDelay:k.value},void 0,{top:!0}]]),c("div",Mc,[x.asset.stats.stars?(d(),T("span",Pc,[N[6]||(N[6]=c("i",{class:"icon-[lucide--star] size-3"},null,-1)),$e(" "+R(x.asset.stats.stars),1)])):V("",!0),x.asset.stats.downloadCount?(d(),T("span",Dc,[N[7]||(N[7]=c("i",{class:"icon-[lucide--download] size-3"},null,-1)),$e(" "+R(x.asset.stats.downloadCount),1)])):V("",!0),x.asset.stats.formattedDate?(d(),T("span",Ac,[N[8]||(N[8]=c("i",{class:"icon-[lucide--clock] size-3"},null,-1)),$e(" "+R(x.asset.stats.formattedDate),1)])):V("",!0)])])],42,Sc))}}}),Ec=["aria-label","aria-setsize"],Oc={key:0,class:"flex h-full items-center justify-center py-20"},Vc={key:1,class:"flex h-full flex-col items-center justify-center py-16 text-muted-foreground"},Rc={class:"mb-2 text-lg font-medium"},Wc={class:"text-sm"},zc=q({__name:"AssetGrid",props:{assets:{},loading:{type:Boolean}},emits:["assetSelect"],setup(e){const o=h(()=>e.assets.map(s=>({...s,key:s.id}))),t={display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(15rem, 1fr))",gap:"1rem",padding:"0.5rem"};return(s,a)=>(d(),T("div",{"data-component-id":"AssetGrid",class:"h-full",role:"grid","aria-label":s.$t("assetBrowser.assetCollection"),"aria-rowcount":-1,"aria-colcount":-1,"aria-setsize":s.assets.length},[s.loading?(d(),T("div",Oc,a[1]||(a[1]=[c("i",{class:"icon-[lucide--loader] size-12 animate-spin text-muted-foreground"},null,-1)]))):s.assets.length===0?(d(),T("div",Vc,[a[2]||(a[2]=c("i",{class:"mb-4 icon-[lucide--search] size-10"},null,-1)),c("h3",Rc,R(s.$t("assetBrowser.noAssetsFound")),1),c("p",Wc,R(s.$t("assetBrowser.tryAdjustingFilters")),1)])):(d(),U(_i,{key:2,items:o.value,"grid-style":t,"default-item-height":320,"default-item-width":240},{item:E(({item:l})=>[F(Lc,{asset:l,interactive:!0,onSelect:a[0]||(a[0]=i=>s.$emit("assetSelect",i))},null,8,["asset"])]),_:1},8,["items"]))],8,Ec))}});function Bc(e){return typeof e.user_metadata?.description=="string"?e.user_metadata.description:null}n(Bc,"getAssetDescription");function vl(e){return typeof e.user_metadata?.base_model=="string"?e.user_metadata.base_model:null}n(vl,"getAssetBaseModel");function Fc(e){return o=>e==="all"||o.tags.includes(e)?!0:o.tags.some(t=>typeof t=="string"&&t.includes("/")?t.split("/")[0]===e:!1)}n(Fc,"filterByCategory");function Uc(e){return o=>{if(e.length===0)return!0;const t=new Set(e),s=o.name.split(".").pop()?.toLowerCase();return s?t.has(s):!1}}n(Uc,"filterByFileFormats");function Gc(e){return o=>{if(e.length===0)return!0;const t=new Set(e),s=vl(o);return s?t.has(s):!1}}n(Gc,"filterByBaseModels");function jc(e){return o=>e==="all"?!0:e==="my-models"?o.is_immutable===!1:e==="public-models"?o.is_immutable===!0:!0}n(jc,"filterByOwnership");function Hc(e=L([])){const o=h(()=>e.value??[]),t=L(""),s=L("all"),a=L({sortBy:"recent",fileFormats:[],baseModels:[],ownership:"all"});function l(k){const g=k.tags.find(x=>x!=="models"),b=Bc(k)||`${g||ce("assetBrowser.unknown")} model`,S=[];if(g){const x=g.includes("/")?g.substring(g.indexOf("/")+1):g;S.push({label:x,type:"type"})}const _=vl(k);_&&S.push({label:_,type:"base"});const C={formattedDate:Ti(new Date(k.created_at),{dateStyle:"short"}),downloadCount:void 0,stars:void 0};return{...k,description:b,badges:S,stats:C}}n(l,"transformAssetForDisplay");const i=h(()=>{const k=o.value.filter(b=>b.tags[0]==="models").map(b=>b.tags[1]).filter(b=>typeof b=="string"&&b.length>0).map(b=>b.split("/")[0]),g=Array.from(new Set(k)).sort().map(b=>({id:b,label:b.charAt(0).toUpperCase()+b.slice(1),icon:"icon-[lucide--package]"}));return[{id:"all",label:ce("assetBrowser.allModels"),icon:"icon-[lucide--folder]"},...g]}),r=h(()=>s.value==="all"?ce("assetBrowser.allModels"):i.value.find(g=>g.id===s.value)?.label||ce("assetBrowser.assets")),u=h(()=>o.value.filter(Fc(s.value))),f={fuseOptions:{keys:[{name:"name",weight:.4},{name:"tags",weight:.3}],threshold:.4,ignoreLocation:!0,includeScore:!0},matchAllWhenSearchEmpty:!0},{results:m}=ba(t,u,f),v=h(()=>m.value.map(k=>k.item)),p=h(()=>{const g=[...v.value.filter(Uc(a.value.fileFormats)).filter(Gc(a.value.baseModels)).filter(jc(a.value.ownership))];return g.sort((b,S)=>{switch(a.value.sortBy){case"name-desc":return S.name.localeCompare(b.name);case"recent":return new Date(S.created_at).getTime()-new Date(b.created_at).getTime();case"popular":return b.name.localeCompare(S.name);case"name-asc":default:return b.name.localeCompare(S.name)}}),g.map(l)});function w(k){a.value={...k}}return n(w,"updateFilters"),{searchQuery:t,selectedCategory:s,availableCategories:i,contentTitle:r,categoryFilteredAssets:u,filteredAssets:p,updateFilters:w}}n(Hc,"useAssetBrowser");const qc=new Set(["VAE","CLIP","GLIGEN"]);function Kc(e){return e?e==="diffusion_models"?"Diffusion":e.split("_").map(o=>{const t=o.toUpperCase();if(qc.has(t))return t;const s=o.toLowerCase();return s.charAt(0).toUpperCase()+s.slice(1)}).join(" "):"Models"}n(Kc,"formatCategoryLabel");const Qc={class:"capitalize"},Jc={class:"flex w-full items-center justify-between gap-2"},Yc={class:"hidden md:inline"},Us=q({__name:"AssetBrowserModal",props:{nodeType:{},assetType:{},onSelect:{type:Function},onClose:{type:Function},showLeftPanel:{type:Boolean},title:{}},emits:["asset-select","close"],setup(e,{emit:o}){const{t}=pe(),s=Xn(),a=Zn(),l=Xo(tn),i=e,r=o;on(cn,i.onClose??(()=>{}));const u=h(()=>i.nodeType?i.nodeType:i.assetType?`tag:${i.assetType}`:""),f=h(()=>s.modelAssetsByNodeType.get(u.value)??[]),m=h(()=>s.modelLoadingByNodeType.get(u.value)??!1),v=h(()=>m.value&&f.value.length===0);async function p(){return i.nodeType?await s.updateModelsForNodeType(i.nodeType):i.assetType?await s.updateModelsForTag(i.assetType):[]}n(p,"refreshAssets"),p();const{isUploadButtonEnabled:w,showUploadDialog:k}=ku(p),{searchQuery:g,selectedCategory:b,availableCategories:S,categoryFilteredAssets:_,filteredAssets:C,updateFilters:x}=Hc(f),N=h(()=>{const D=(f.value??[]).map(A=>A.tags?.find(B=>B!=="models")).find(A=>typeof A=="string"&&A.length>0);if(D)return D;if(i.nodeType){const A=a.getCategoryForNodeType(i.nodeType);if(A)return A}return i.assetType?i.assetType:"models"}),M=h(()=>b.value!=="all"?b.value:N.value),$=h(()=>{if(i.title)return i.title;const j=Kc(M.value);return t("assetBrowser.allCategory",{category:j})}),I=h(()=>i.showLeftPanel??!0);function P(){i.onClose?.(),r("close")}n(P,"handleClose");function z(j){r("asset-select",j),i.onSelect?.(j)}return n(z,"handleAssetSelectAndEmit"),(j,D)=>(d(),U(ds,{"data-component-id":"AssetBrowserModal",class:"size-full max-h-full max-w-full min-w-0","content-title":$.value,onClose:P},Hn({header:E(()=>[c("div",Jc,[F(an,{modelValue:y(g),"onUpdate:modelValue":D[1]||(D[1]=A=>it(g)?g.value=A:null),autofocus:!0,size:"lg",placeholder:j.$t("g.searchPlaceholder"),class:"max-w-96"},null,8,["modelValue","placeholder"]),y(w)?(d(),U(X,{key:0,variant:"primary",size:y(l).md?"lg":"icon","data-attr":"upload-model-button",onClick:y(k)},{default:E(()=>[D[3]||(D[3]=c("i",{class:"icon-[lucide--folder-input]"},null,-1)),c("span",Yc,R(j.$t("assetBrowser.uploadModel")),1)]),_:1},8,["size","onClick"])):V("",!0)])]),contentFilter:E(()=>[F(cc,{assets:y(_),"all-assets":f.value,onFilterChange:y(x)},null,8,["assets","all-assets","onFilterChange"])]),content:E(()=>[F(zc,{assets:y(C),loading:v.value,onAssetSelect:z},null,8,["assets","loading"])]),_:2},[I.value?{name:"leftPanel",fn:E(()=>[F(ps,{modelValue:y(b),"onUpdate:modelValue":D[0]||(D[0]=A=>it(b)?b.value=A:null),"data-component-id":"AssetBrowserModal-LeftSidePanel","nav-items":y(S)},{"header-icon":E(()=>D[2]||(D[2]=[c("div",{class:"icon-[lucide--folder] size-4"},null,-1)])),"header-title":E(()=>[c("span",Qc,R($.value),1)]),_:1},8,["modelValue","nav-items"])]),key:"0"}:void 0]),1032,["content-title"]))}}),Gs={headless:!0,modal:!0,closable:!0,pt:{root:{class:"rounded-2xl overflow-hidden asset-browser-dialog"},header:{class:"!p-0 hidden"},content:{class:"!p-0 !m-0 h-full w-full"}}},Xc=n(()=>{const e=vt(),o="global-asset-browser";async function t(a){const l=n(i=>{a.onAssetSelected?.(i),e.closeDialog({key:o})},"handleAssetSelected");e.showDialog({key:o,component:Us,props:{nodeType:a.nodeType,inputName:a.inputName,currentValue:a.currentValue,onSelect:l,onClose:n(()=>e.closeDialog({key:o}),"onClose")},dialogComponentProps:Gs})}n(t,"show");async function s(a){const l=n(i=>{a.onAssetSelected?.(i),e.closeDialog({key:o})},"handleAssetSelected");e.showDialog({key:o,component:Us,props:{showLeftPanel:!0,assetType:a.assetType,title:a.title,onSelect:l,onClose:n(()=>e.closeDialog({key:o}),"onClose")},dialogComponentProps:Gs})}return n(s,"browse"),{show:t,browse:s}},"useAssetBrowserDialog"),Zc={class:"flex max-w-xs min-w-40 flex-col gap-2 p-3"},ed={class:"text-sm font-inter"},td={key:1,class:"text-xs"},od={class:"flex max-w-xs min-w-40 flex-col gap-2 p-3"},nd={class:"text-sm font-inter"},sd={key:1,class:"text-xs"},js="cursor-pointer transition-opacity hover:opacity-80",ad=q({__name:"TopbarBadge",props:{badge:{},displayMode:{default:"full"},reverseOrder:{type:Boolean,default:!1},noPadding:{type:Boolean,default:!1},backgroundColor:{default:"var(--comfy-menu-bg)"}},setup(e){const o=e,t=L(),s=n(p=>{t.value?.toggle(p)},"togglePopover"),a=h(()=>o.badge.variant??"info"),l=h(()=>({backgroundColor:o.backgroundColor})),i=h(()=>{switch(a.value){case"error":return"bg-danger-100 text-white";case"warning":return"bg-gold-600 text-black";case"info":default:return"bg-white text-black"}}),r=h(()=>{switch(a.value){case"error":return"text-danger-100";case"warning":return"text-warning-background";case"info":default:return"text-text-primary"}}),u=h(()=>r.value),f=h(()=>{if(o.badge.icon)return o.badge.icon;switch(a.value){case"error":return"pi pi-exclamation-circle";case"warning":return"icon-[lucide--triangle-alert]";case"info":default:return}}),m=h(()=>{switch(a.value){case"error":return"bg-danger-100";case"warning":return"bg-gold-600";case"info":default:return"bg-slate-100"}}),v=h(()=>({root:{class:le("absolute z-50")},content:{class:le("mt-1 rounded-lg","bg-base-background","text-base-foreground","shadow-lg","border border-border-default")}}));return(p,w)=>{const k=Ie("tooltip");return p.displayMode==="icon-only"?(d(),T("div",{key:0,class:Q(["relative inline-flex h-full shrink-0 items-center justify-center px-2",js]),style:he(l.value),onClick:s},[f.value?(d(),T("i",{key:0,class:Q(["shrink-0 text-base",f.value,u.value])},null,2)):p.badge.label?(d(),T("div",{key:1,class:Q(["shrink-0 rounded-full px-1.5 py-0.5 text-xxxs font-semibold",i.value])},R(p.badge.label),3)):(d(),T("div",{key:2,class:Q(["size-2 shrink-0 rounded-full",m.value])},null,2)),F(y(Ye),{ref_key:"popover",ref:t,"append-to":"body","auto-z-index":!0,"base-z-index":1e3,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:v.value},{default:E(()=>[c("div",Zc,[p.badge.label?(d(),T("div",{key:0,class:Q(["w-fit rounded-full px-1.5 py-0.5 text-xxxs font-semibold",i.value])},R(p.badge.label),3)):V("",!0),c("div",ed,R(p.badge.text),1),p.badge.tooltip?(d(),T("div",td,R(p.badge.tooltip),1)):V("",!0)])]),_:1},8,["pt"])],4)):p.displayMode==="compact"?(d(),T("div",{key:1,class:"relative inline-flex h-full",style:he(l.value)},[c("div",{class:Q(["flex h-full shrink-0 items-center gap-2 whitespace-nowrap",[{"flex-row-reverse":p.reverseOrder},p.noPadding?"":"px-3",js]]),onClick:s},[f.value?(d(),T("i",{key:0,class:Q(["shrink-0 text-base",f.value,u.value])},null,2)):V("",!0),p.badge.label?(d(),T("div",{key:1,class:Q(["shrink-0 rounded-full px-1.5 py-0.5 text-xxxs font-semibold",i.value])},R(p.badge.label),3)):V("",!0)],2),F(y(Ye),{ref_key:"popover",ref:t,"append-to":"body","auto-z-index":!0,"base-z-index":1e3,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:v.value},{default:E(()=>[c("div",od,[p.badge.label?(d(),T("div",{key:0,class:Q(["w-fit rounded-full px-1.5 py-0.5 text-xxxs font-semibold",i.value])},R(p.badge.label),3)):V("",!0),c("div",nd,R(p.badge.text),1),p.badge.tooltip?(d(),T("div",sd,R(p.badge.tooltip),1)):V("",!0)])]),_:1},8,["pt"])],4)):de((d(),T("div",{key:2,class:Q(["flex h-full shrink-0 items-center gap-2 whitespace-nowrap",[{"flex-row-reverse":p.reverseOrder},p.noPadding?"":"px-3"]]),style:he(l.value)},[f.value?(d(),T("i",{key:0,class:Q(["shrink-0 text-base",f.value,u.value])},null,2)):V("",!0),p.badge.label?(d(),T("div",{key:1,class:Q(["shrink-0 rounded-full px-1.5 py-0.5 text-xxxs font-semibold",i.value])},R(p.badge.label),3)):V("",!0),c("div",{class:Q(["font-inter text-sm",r.value])},R(p.badge.text),3)],6)),[[k,p.badge.tooltip]])}}}),ld=3e3,id=300*1e3,rd=q({__name:"SubscribeButton",props:{label:{},size:{default:"lg"},variant:{default:"default"},fluid:{type:Boolean,default:!0}},emits:["subscribed"],setup(e,{emit:o}){const t=o,{subscribe:s,isActiveSubscription:a,fetchStatus:l,showSubscriptionDialog:i}=es(),r=$i(),u=L(!1),f=L(!1);let m=null;const v=L(!1),p=n(()=>{f.value=!0,u.value=!0;const g=Date.now(),b=n(async()=>{try{if(Date.now()-g>id){w();return}await l(),a.value&&(w(),r?.trackMonthlySubscriptionSucceeded(),t("subscribed"))}catch(S){console.error("[SubscribeButton] Error polling subscription status:",S)}},"poll");b(),m=window.setInterval(b,ld)},"startPollingSubscriptionStatus"),w=n(()=>{m&&(clearInterval(m),m=null),f.value=!1,u.value=!1},"stopPolling");ae([v,a],([g,b])=>{});const k=n(async()=>{u.value=!0;try{await s(),p()}catch(g){console.error("[SubscribeButton] Error initiating subscription:",g),u.value=!1}},"handleSubscribe");return rt(()=>{w(),v.value=!1}),(g,b)=>(d(),U(X,{size:g.size,loading:u.value,disabled:f.value,variant:"primary",style:he(g.variant==="gradient"?{background:"var(--color-subscription-button-gradient)",color:"var(--color-white)"}:void 0),class:Q(y(le)("font-bold",g.fluid&&"w-full")),onClick:k},{default:E(()=>[$e(R(g.label||g.$t("subscription.required.subscribe")),1)]),_:1},8,["size","loading","disabled","style","class"]))}}),Hs="subscription-required",ud=n(()=>{const e=tt(),o=vt();function t(){o.closeDialog({key:Hs})}n(t,"hide");function s(){e.showLayoutDialog({key:Hs,component:wa(()=>Kn(()=>import("./SubscriptionRequiredDialogContent-D0645h_k.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21]))),props:{onClose:t},dialogComponentProps:{style:"width: min(1328px, 95vw); max-height: 90vh;",pt:{root:{class:"rounded-2xl bg-transparent"},content:{class:"!p-0 rounded-2xl border border-border-default bg-base-background/60 backdrop-blur-md shadow-[0_25px_80px_rgba(5,6,12,0.45)]"}}}})}return n(s,"show"),{show:s,hide:t}},"useSubscriptionDialog"),cd=q({__name:"GlobalToast",setup(e){const o=Bt(),t=Mt(),s=ue();ae(()=>t.messagesToAdd,i=>{i.length!==0&&(i.forEach(r=>{o.add(r)}),t.messagesToAdd=[])},{deep:!0}),ae(()=>t.messagesToRemove,i=>{i.length!==0&&(i.forEach(r=>{o.remove(r)}),t.messagesToRemove=[])},{deep:!0}),ae(()=>t.removeAllRequested,i=>{i&&(o.removeAllGroups(),t.removeAllRequested=!1)});function a(){const i=document.getElementById("dynamic-toast-style")||l(),r=document.querySelector(".graph-canvas-container")?.getBoundingClientRect();r&&(i.textContent=`
    .p-toast.p-component.p-toast-top-right {
      top: ${r.top+100}px !important;
      right: ${window.innerWidth-(r.left+r.width)+20}px !important;
       z-index: 10000 !important;
    }
  `)}n(a,"updateToastPosition");function l(){const i=document.createElement("style");return i.id="dynamic-toast-style",document.head.appendChild(i),i}return n(l,"createStyleElement"),ae(()=>s.get("Comfy.UseNewMenu"),()=>Re(a),{immediate:!0}),ae(()=>s.get("Comfy.Sidebar.Location"),()=>Re(a),{immediate:!0}),(i,r)=>(d(),U(y(Oa)))}});let bn,hl;(function(){const e=globalThis;typeof e.requestIdleCallback!="function"||typeof e.cancelIdleCallback!="function"?bn=n((o,t,s)=>{setTimeout(()=>{if(a)return;const l=Date.now()+15;t(Object.freeze({didTimeout:!0,timeRemaining(){return Math.max(0,l-Date.now())}}))});let a=!1;return{dispose(){a||(a=!0)}}},"_runWhenIdle"):bn=n((o,t,s)=>{const a=o.requestIdleCallback(t,typeof s=="number"?{timeout:s}:void 0);let l=!1;return{dispose(){l||(l=!0,o.cancelIdleCallback(a))}}},"_runWhenIdle"),hl=n((o,t)=>bn(globalThis,o,t),"runWhenGlobalIdle")})();const dd={class:"fixed z-9999 flex flex-row no-drag top-0 right-0"},pd=q({__name:"MenuHamburger",setup(e){const o=ot(),t=ue(),s=n(()=>{o.focusMode=!1},"exitFocusMode");return ke(()=>{t.get("Comfy.UseNewMenu")==="Disabled"&&(o.focusMode?J.ui.menuContainer.style.display="none":J.ui.menuContainer.style.display="block")}),(a,l)=>{const i=Ie("tooltip");return de((d(),T("div",dd,[de((d(),U(X,{variant:"muted-textonly",size:"lg","aria-label":a.$t("menu.showMenu"),"aria-live":"assertive",onClick:s,onContextmenu:y(Ni)},{default:E(()=>l[0]||(l[0]=[c("i",{class:"pi pi-bars"},null,-1)])),_:1},8,["aria-label","onContextmenu"])),[[i,{value:a.$t("menu.showMenu"),showDelay:300}]]),l[1]||(l[1]=c("div",{class:"window-actions-spacer"},null,-1))],512)),[[Qe,y(o).focusMode]])}}}),fd=q({__name:"UnloadWindowConfirmDialog",setup(e){const o=ue(),t=Le(),s=n(a=>{if(o.get("Comfy.Window.UnloadConfirmation")&&t.modifiedWorkflows.length>0)return a.preventDefault(),!0},"handleBeforeUnload");return Ve(()=>{window.addEventListener("beforeunload",s)}),rt(()=>{window.removeEventListener("beforeunload",s)}),(a,l)=>(d(),T("div"))}}),md={class:"w-full h-full absolute top-0 left-0 z-999 pointer-events-none flex flex-col"},gd={class:"side-toolbar-container"},vd=q({__name:"LiteGraphCanvasSplitterOverlay",setup(e){const o=ot(),t=ue(),s=so(),a=Ho(),{t:l}=pe(),i=h(()=>t.get("Comfy.Sidebar.Location")),r=h(()=>t.get("Comfy.Sidebar.UnifiedWidth")),{focusMode:u}=Fe(o),{activeSidebarTabId:f,activeSidebarTab:m}=Fe(a),{bottomPanelVisible:v}=Fe(ao()),{isOpen:p}=Fe(s),w=h(()=>m.value!==null),k=h(()=>r.value?"unified-sidebar":f.value??"default-sidebar");function g({originalEvent:C}){C.preventDefault()}n(g,"onResizestart");const b=h(()=>`main-splitter${p.value?"-with-right-panel":""}-${i.value}`),S=h(()=>{if(i.value==="left")return{display:w.value?"flex":"none"}}),_=h(()=>{if(i.value==="right")return{display:w.value?"flex":"none"}});return(C,x)=>(d(),T("div",md,[ve(C.$slots,"workflow-tabs",{},void 0,!0),c("div",{class:Q(["pointer-events-none flex flex-1 overflow-hidden",{"flex-row":i.value==="left","flex-row-reverse":i.value==="right"}])},[c("div",gd,[ve(C.$slots,"side-toolbar",{},void 0,!0)]),(d(),U(y(Dn),{key:b.value,class:"bg-transparent pointer-events-none border-none flex-1 overflow-hidden","state-key":k.value,"state-storage":"local",onResizestart:g},{default:E(()=>[!y(u)&&(i.value==="left"||y(p))?(d(),U(y($t),{key:0,class:Q(i.value==="left"?y(le)("side-bar-panel bg-comfy-menu-bg pointer-events-auto",w.value&&"min-w-78"):"bg-comfy-menu-bg pointer-events-auto"),"min-size":i.value==="left"?10:15,size:20,style:he(S.value),role:i.value==="left"?"complementary":void 0,"aria-label":i.value==="left"?y(l)("sideToolbar.sidebar"):void 0},{default:E(()=>[i.value==="left"&&w.value?ve(C.$slots,"side-bar-panel",{key:0},void 0,!0):i.value==="right"?ve(C.$slots,"right-side-panel",{key:1},void 0,!0):V("",!0)]),_:3},8,["class","min-size","style","role","aria-label"])):V("",!0),F(y($t),{size:80,class:"flex flex-col"},{default:E(()=>[ve(C.$slots,"topmenu",{sidebarPanelVisible:w.value},void 0,!0),F(y(Dn),{class:"bg-transparent pointer-events-none border-none splitter-overlay-bottom mr-1 mb-1 ml-1 flex-1",layout:"vertical","pt:gutter":y(le)("rounded-tl-lg rounded-tr-lg ",!(y(v)&&!y(u))&&"hidden"),"state-key":"bottom-panel-splitter","state-storage":"local",onResizestart:g},{default:E(()=>[F(y($t),{class:"graph-canvas-panel relative"},{default:E(()=>[ve(C.$slots,"graph-canvas-panel",{},void 0,!0)]),_:3}),de(F(y($t),{class:"bottom-panel border border-(--p-panel-border-color) max-w-full overflow-x-auto bg-comfy-menu-bg pointer-events-auto rounded-lg"},{default:E(()=>[ve(C.$slots,"bottom-panel",{},void 0,!0)]),_:3},512),[[Qe,y(v)&&!y(u)]])]),_:3},8,["pt:gutter"])]),_:3}),!y(u)&&(i.value==="right"||y(p))?(d(),U(y($t),{key:1,class:Q(i.value==="right"?y(le)("side-bar-panel bg-comfy-menu-bg pointer-events-auto",w.value&&"min-w-78"):"bg-comfy-menu-bg pointer-events-auto"),"min-size":i.value==="right"?10:15,size:20,style:he(_.value),role:i.value==="right"?"complementary":void 0,"aria-label":i.value==="right"?y(l)("sideToolbar.sidebar"):void 0},{default:E(()=>[i.value==="left"?ve(C.$slots,"right-side-panel",{key:0},void 0,!0):i.value==="right"&&w.value?ve(C.$slots,"side-bar-panel",{key:1},void 0,!0):V("",!0)]),_:3},8,["class","min-size","style","role","aria-label"])):V("",!0)]),_:3},8,["state-key"]))],2)]))}}),hd=Ee(vd,[["__scopeId","data-v-78b7f6de"]]),et=n(e=>({value:e,showDelay:300,hideDelay:0,pt:{text:{class:"border-node-component-tooltip-border bg-node-component-tooltip-surface text-node-component-tooltip border rounded-md px-2 py-1 text-xs leading-none shadow-none"},arrow:{class:"border-t-node-component-tooltip-border"}}}),"buildTooltipConfig"),yd=wa(()=>Kn(()=>import("./ComfyQueueButton-DzPj78_I.js"),__vite__mapDeps([22,5,3,4,2,1,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,23]))),bd={class:"flex h-full items-center"},wd=q({__name:"ComfyActionbar",setup(e){const o=ue(),t=_e(),{t:s}=pe(),{isIdle:a}=Fe(Ze()),l=h(()=>o.get("Comfy.UseNewMenu")),i=h(()=>l.value!=="Disabled"),r=document.querySelector(".workflow-tabs-container"),u=L(null),f=L(null),m=Ts("Comfy.MenuPosition.Docked",!0),v=Ts("Comfy.MenuPosition.Floating",{x:0,y:0}),{x:p,y:w,style:k,isDragging:g}=Gl(u,{initialValue:{x:0,y:0},handle:f,containerElement:document.body,onMove:n(D=>{const A=r?.getBoundingClientRect().bottom??40;D.y<A&&(D.y=A)},"onMove")});Jt([p,w],([D,A])=>{v.value={x:D,y:A}},{debounce:300});const b=n(()=>{if(u.value){const D=window.innerWidth,A=window.innerHeight,B=u.value.offsetWidth,W=u.value.offsetHeight;if(B===0||W===0)return;if(v.value.x!==0||v.value.y!==0){p.value=qt(v.value.x,0,D-B),w.value=qt(v.value.y,0,A-W),C();return}p.value===0&&w.value===0&&(p.value=qt((D-B)/2,0,D-B),w.value=qt(A-W-10,0,A-W),C())}},"setInitialPosition");async function S(){await Re(),b()}n(S,"comfyRunButtonResolved"),ae(i,async D=>{D&&await Re(b)}),Ae(f,"mousedown",()=>{});const _=L({x:p.value,y:w.value,windowWidth:window.innerWidth,windowHeight:window.innerHeight}),C=n(()=>{_.value={x:p.value,y:w.value,windowWidth:window.innerWidth,windowHeight:window.innerHeight}},"captureLastDragState");ae(g,D=>{D||C()},{immediate:!0}),Ae(window,"resize",n(()=>{if(u.value){const D=window.innerWidth,A=window.innerHeight,B=u.value.offsetWidth,W=u.value.offsetHeight,G=_.value.x,H=_.value.windowWidth-(_.value.x+B),K=_.value.y,ee=_.value.windowHeight-(_.value.y+W),Y=[{edge:"left",distance:G},{edge:"right",distance:H},{edge:"top",distance:K},{edge:"bottom",distance:ee}].reduce((Ne,Ue)=>Ue.distance<Ne.distance?Ue:Ne),oe=_.value.y/_.value.windowHeight,se=_.value.x/_.value.windowWidth;Y.edge==="left"?(p.value=Y.distance,w.value=oe*A):Y.edge==="right"?(p.value=D-B-Y.distance,w.value=oe*A):Y.edge==="top"?(p.value=se*D,w.value=Y.distance):(p.value=se*D,w.value=A-W-Y.distance),p.value=qt(p.value,0,D-B),w.value=qt(w.value,0,A-W)}},"adjustMenuPosition"));const N=L(!1),M=n(()=>{g.value&&(N.value=!0)},"onMouseEnterDropZone"),$=n(()=>{g.value&&(N.value=!1)},"onMouseLeaveDropZone");ae(g,D=>{D?m.value&&(m.value=!1):(N.value&&(m.value=!0),N.value=!1)});const I=h(()=>et(s("menu.interrupt"))),P=n(async()=>{a.value||await t.execute("Comfy.Interrupt")},"cancelCurrentJob"),z=h(()=>le("w-[200px] border-dashed border-blue-500 opacity-80","m-1.5 flex items-center justify-center self-stretch","rounded-md before:w-50 before:-ml-50 before:h-full","pointer-events-auto",N.value&&"border-[3px] opacity-100 scale-105 shadow-[0_0_20px] shadow-blue-500")),j=h(()=>le("actionbar pointer-events-auto z-1300",g.value&&"select-none pointer-events-none",m.value?"p-0 static border-none bg-transparent":"fixed shadow-interface"));return(D,A)=>{const B=Ie("tooltip");return d(),T("div",bd,[y(g)&&!y(m)?(d(),T("div",{key:0,class:Q(z.value),onMouseenter:M,onMouseleave:$},R(y(s)("actionbar.dockToTop")),35)):V("",!0),F(y(Qn),{class:Q(["pointer-events-auto",j.value]),style:he(y(k)),pt:{header:{class:"hidden"},content:{class:y(m)?"p-0":"p-1"}}},{default:E(()=>[c("div",{ref_key:"panelRef",ref:u,class:"flex items-center select-none gap-2"},[c("span",{ref_key:"dragHandleRef",ref:f,class:Q(y(le)("drag-handle cursor-grab w-3 h-max",y(g)&&"cursor-grabbing"))},null,2),(d(),U(jl,{onResolve:S},{default:E(()=>[F(y(yd))]),_:1})),de((d(),U(X,{variant:"destructive",size:"icon",disabled:y(a),"aria-label":y(s)("menu.interrupt"),onClick:P},{default:E(()=>A[0]||(A[0]=[c("i",{class:"icon-[lucide--x] size-4"},null,-1)])),_:1},8,["disabled","aria-label"])),[[B,I.value,void 0,{bottom:!0}]])],512)]),_:1},8,["style","class","pt"])])}}}),kd=n((e,o)=>{const t=e?.type;return t?!o[t]:!1},"isNodeMissingDefinition"),Cd=n((e,o)=>{if(!e)return[];const t=y(o);return Ii(e,s=>kd(s,t))},"collectMissingNodes"),xd=n((e,o)=>Cd(e,o).length>0,"graphHasMissingNodes"),Sd={key:0,class:"icon-[lucide--triangle-alert] text-warning-background"},_d={class:"p-breadcrumb-item-label px-2"},Td={key:2,class:"pi pi-angle-down text-[10px]"},$d=q({__name:"SubgraphBreadcrumbItem",props:{item:{},isActive:{type:Boolean,default:!1}},setup(e){const o=e,t=ht(),s=h(()=>xd(J.rootGraph,t.nodeDefsByName)),{t:a}=pe(),l=L(),i=tt(),r=Le(),u=Xe(),f=L(!1),m=L(),v=L(),p=L(),w=n(async(x,N)=>{if(x&&x!==N){if(o.item.updateTitle?.(x),r.activeSubgraph)r.activeSubgraph.name=x;else if(r.activeWorkflow)try{await u.renameWorkflow(r.activeWorkflow,Ua.basePath+Ga(x))}catch($){console.error($),i.showErrorDialog($);return}const M=ts();M.restoreState(M.exportState())}},"rename"),k=o.item.key==="root",g=h(()=>s.value&&k?a("breadcrumbsMenu.missingNodesWarning"):o.item.label),b=h(()=>[{label:a("g.rename"),icon:"pi pi-pencil",command:_},{label:a("breadcrumbsMenu.duplicate"),icon:"pi pi-copy",command:n(async()=>{await u.duplicateWorkflow(r.activeWorkflow)},"command"),visible:k&&!o.item.isBlueprint},{separator:!0,visible:k},{label:a("menuLabels.Save"),icon:"pi pi-save",command:n(async()=>{await _e().execute("Comfy.SaveWorkflow")},"command"),visible:k},{label:a("menuLabels.Save As"),icon:"pi pi-save",command:n(async()=>{await _e().execute("Comfy.SaveWorkflowAs")},"command"),visible:k},{separator:!0},{label:a("breadcrumbsMenu.clearWorkflow"),icon:"pi pi-trash",command:n(async()=>{await _e().execute("Comfy.ClearWorkflow")},"command")},{separator:!0,visible:o.item.key==="root"&&o.item.isBlueprint},{label:a("subgraphStore.publish"),icon:"pi pi-copy",command:n(async()=>{await u.saveWorkflowAs(r.activeWorkflow)},"command"),visible:o.item.key==="root"&&o.item.isBlueprint},{separator:!0,visible:k},{label:o.item.isBlueprint?a("breadcrumbsMenu.deleteBlueprint"):a("breadcrumbsMenu.deleteWorkflow"),icon:"pi pi-times",command:n(async()=>{await u.deleteWorkflow(r.activeWorkflow)},"command"),visible:k}]),S=n(x=>{f.value||(x.detail===1?o.isActive?l.value?.toggle(x):o.item.command?.({item:o.item,originalEvent:x}):o.isActive&&x.detail===2&&(l.value?.hide(),x.stopPropagation(),x.preventDefault(),_()))},"handleClick"),_=n(()=>{f.value=!0,m.value=o.item.label,Re(()=>{v.value?.$el&&(v.value.$el.focus(),v.value.$el.select(),p.value&&(v.value.$el.style.width=`${Math.max(200,p.value.offsetWidth)}px`))})},"startRename"),C=n(async x=>{x&&await w(m.value,o.item.label),f.value=!1},"inputBlur");return(x,N)=>{const M=Ie("tooltip");return d(),T(ne,null,[de((d(),T("a",{ref_key:"wrapperRef",ref:p,draggable:"false",href:"#",class:Q(["p-breadcrumb-item-link h-12 cursor-pointer px-2",{"flex items-center gap-1":x.isActive,"p-breadcrumb-item-link-menu-visible":l.value?.overlayVisible,"p-breadcrumb-item-link-icon-visible":x.isActive,"active-breadcrumb-item":x.isActive}]),onClick:S},[s.value&&k?(d(),T("i",Sd)):V("",!0),c("span",_d,R(x.item.label),1),x.item.isBlueprint?(d(),U(y(Yt),{key:1,value:"Blueprint",severity:"primary"})):V("",!0),x.isActive?(d(),T("i",Td)):V("",!0)],2)),[[M,{value:g.value,showDelay:512},void 0,{bottom:!0}]]),x.isActive?(d(),U(y(Va),{key:0,ref_key:"menu",ref:l,model:b.value,popup:!0,pt:{root:{style:"background-color: var(--comfy-menu-bg)"},itemLink:{class:"py-2"}}},null,8,["model"])):V("",!0),f.value?(d(),U(y(di),{key:1,ref_key:"itemInputRef",ref:v,modelValue:m.value,"onUpdate:modelValue":N[0]||(N[0]=$=>m.value=$),class:"fixed z-10000 px-2 py-2 text-[.8rem]",onBlur:N[1]||(N[1]=$=>C(!1)),onClick:N[2]||(N[2]=Ce(()=>{},["stop"])),onKeydown:[N[3]||(N[3]=Zt($=>C(!0),["enter"])),N[4]||(N[4]=Zt($=>C(!1),["esc"]))]},null,8,["modelValue"])):V("",!0)],64)}}}),Nd=Ee($d,[["__scopeId","data-v-09d35179"]]),yl=n((e,o)=>{o={debounceTime:25,useMutationObserver:!0,useResizeObserver:!0,...o};const t=L(!1),s=[],a=L(!1),l=n(()=>{t.value=e.scrollWidth>e.clientWidth,o.onCheck?.(t.value)},"checkOverflowFn"),i=o.debounceTime?nn(l,o.debounceTime):l;return o.useMutationObserver&&s.push(Hl(e,i,{subtree:!0,childList:!0}).stop),o.useResizeObserver&&s.push(ka(e,i).stop),{isOverflowing:Pn(t),disposed:Pn(a),checkOverflow:i,dispose:n(()=>{a.value=!0,s.forEach(r=>r())},"dispose")}},"useOverflowObserver"),qs=28,Ks=8,wn=8,Qs=20,Id=q({__name:"SubgraphBreadcrumb",setup(e){const o=Le(),t=ts(),s=L(),a=h(()=>o.activeWorkflow?.filename),l=h(()=>ja().isSubgraphBlueprint(o.activeWorkflow)),i=L(!1),r=L(!1),u=h(()=>s.value?s.value.$el?.querySelector(".p-breadcrumb-list"):null),f=h(()=>{const p=t.navigationStack.map(w=>({label:w.name,command:n(()=>{const k=me().getCanvas();if(!k.graph)throw new TypeError("Canvas has no graph");k.setGraph(w)},"command"),updateTitle:n(k=>{const g=me().getCanvas().graph?.rootGraph;g&&Mi(g,w.id,b=>{b.title=k})},"updateTitle")}));return[m.value,...p]}),m=h(()=>({label:a.value,icon:"pi pi-home",key:"root",isBlueprint:l.value,command:n(()=>{const p=me().getCanvas();if(!p.graph)throw new TypeError("Canvas has no graph");p.setGraph(p.graph.rootGraph)},"command")}));let v;return ae(u,p=>{v?.dispose(),v=void 0,p&&(v=yl(p,{onCheck:n(w=>{if(r.value=w,i.value){if(!w){const k=[...p.querySelectorAll(".p-breadcrumb-item")];if(k.length<3)return;const g=k.filter(I=>I.querySelector(".p-breadcrumb-item-link-icon-visible")).length,b=p.querySelectorAll(".p-breadcrumb-separator"),_=b[b.length-1].offsetWidth,C=(qs+wn+wn)*k.length+g*Qs,x=(k.length-1)*_,N=(k.length-1)*(Ks*2),M=C+x+N,$=p.clientWidth;M<=$&&(i.value=!1)}}else w&&(i.value=!0)},"onCheck")}))}),Ca(()=>{v?.disposed.value||v?.checkOverflow()}),(p,w)=>(d(),T("div",{class:Q(["subgraph-breadcrumb w-auto drop-shadow-[var(--interface-panel-drop-shadow)]",{"subgraph-breadcrumb-collapse":i.value,"subgraph-breadcrumb-overflow":r.value}]),style:he({"--p-breadcrumb-gap":"0px","--p-breadcrumb-item-margin":`${Ks/2}px`,"--p-breadcrumb-item-min-width":`${qs}px`,"--p-breadcrumb-item-padding":`${wn}px`,"--p-breadcrumb-icon-width":`${Qs}px`})},[F(y(pi),{ref_key:"breadcrumbRef",ref:s,class:"w-fit rounded-lg p-0",model:f.value,pt:{item:{class:"pointer-events-auto"}},"aria-label":p.$t("g.graphNavigation")},{item:E(({item:k})=>[F(Nd,{item:k,"is-active":k===f.value.at(-1)},null,8,["item","is-active"])]),separator:E(()=>w[0]||(w[0]=[c("span",{style:{transform:"scale(1.5)"}}," / ",-1)])),_:1},8,["model","aria-label"])],6))}}),Md=Ee(Id,[["__scopeId","data-v-0e6867de"]]),Pd={class:"flex flex-col gap-3 p-2"},Dd={class:"flex flex-col gap-1"},Ad={class:"relative h-2 w-full overflow-hidden rounded-full border border-interface-stroke bg-interface-panel-surface"},Ld={class:"flex items-start justify-end gap-4 text-[12px] leading-none"},Ed={class:"flex items-center gap-1 text-text-primary opacity-90"},Od={class:"font-bold"},Vd={class:"flex items-center gap-1 text-text-secondary"},Rd={class:"inline-block max-w-[10rem] truncate"},Wd={class:"flex items-center gap-1"},zd={class:"flex items-center gap-4 text-[12px] text-text-primary"},Bd={class:"flex items-center gap-2"},Fd={class:"opacity-90"},Ud={class:"font-bold"},Gd={class:"ml-1"},jd={class:"flex items-center gap-2"},Hd={class:"opacity-90"},qd={class:"font-bold"},Kd={class:"ml-1"},Qd=q({__name:"QueueOverlayActive",props:{totalProgressStyle:{},currentNodeProgressStyle:{},totalPercentFormatted:{},currentNodePercentFormatted:{},currentNodeName:{},runningCount:{},queuedCount:{},bottomRowClass:{}},emits:["interruptAll","clearQueued","viewAllJobs"],setup(e){const{t:o}=pe(),t=h(()=>et(o("sideToolbar.queueProgressOverlay.cancelJobTooltip"))),s=h(()=>et(o("sideToolbar.queueProgressOverlay.clearQueueTooltip")));return(a,l)=>{const i=xa("i18n-t"),r=Ie("tooltip");return d(),T("div",Pd,[c("div",Dd,[c("div",Ad,[c("div",{class:"absolute inset-0 h-full rounded-full transition-[width]",style:he(a.totalProgressStyle)},null,4),c("div",{class:"absolute inset-0 h-full rounded-full transition-[width]",style:he(a.currentNodeProgressStyle)},null,4)]),c("div",Ld,[c("div",Ed,[F(i,{keypath:"sideToolbar.queueProgressOverlay.total"},{percent:E(()=>[c("span",Od,R(a.totalPercentFormatted),1)]),_:1})]),c("div",Vd,[c("span",null,R(y(o)("sideToolbar.queueProgressOverlay.currentNode")),1),c("span",Rd,R(a.currentNodeName),1),c("span",Wd,[c("span",null,R(a.currentNodePercentFormatted),1)])])])]),c("div",{class:Q(a.bottomRowClass)},[c("div",zd,[c("div",Bd,[c("span",Fd,[c("span",Ud,R(a.runningCount),1),c("span",Gd,R(y(o)("sideToolbar.queueProgressOverlay.running")),1)]),a.runningCount>0?de((d(),U(X,{key:0,variant:"destructive",size:"icon","aria-label":y(o)("sideToolbar.queueProgressOverlay.interruptAll"),onClick:l[0]||(l[0]=u=>a.$emit("interruptAll"))},{default:E(()=>l[3]||(l[3]=[c("i",{class:"icon-[lucide--x] block size-4 leading-none text-text-primary"},null,-1)])),_:1},8,["aria-label"])),[[r,t.value,void 0,{top:!0}]]):V("",!0)]),c("div",jd,[c("span",Hd,[c("span",qd,R(a.queuedCount),1),c("span",Kd,R(y(o)("sideToolbar.queueProgressOverlay.queuedSuffix")),1)]),a.queuedCount>0?de((d(),U(X,{key:0,variant:"destructive",size:"icon","aria-label":y(o)("sideToolbar.queueProgressOverlay.clearQueued"),onClick:l[1]||(l[1]=u=>a.$emit("clearQueued"))},{default:E(()=>l[4]||(l[4]=[c("i",{class:"icon-[lucide--list-x] block size-4 leading-none text-text-primary"},null,-1)])),_:1},8,["aria-label"])),[[r,s.value,void 0,{top:!0}]]):V("",!0)])]),F(X,{class:"min-w-30 flex-1 px-2 py-0",variant:"secondary",size:"md",onClick:l[2]||(l[2]=u=>a.$emit("viewAllJobs"))},{default:E(()=>[$e(R(y(o)("sideToolbar.queueProgressOverlay.viewAllJobs")),1)]),_:1})],2)])}}}),Jd={class:"inline-flex items-center gap-2"},Yd={key:0,class:"inline-flex items-center"},Xd={class:"inline-flex items-center gap-2"},Zd={key:0,class:"relative inline-flex h-6 items-center"},ep=["src","alt"],tp={class:"text-[14px] font-normal text-text-primary"},op={class:"font-bold"},np={class:"font-bold"},sp={class:"font-bold"},ap={class:"font-bold"},lp=q({__name:"CompletionSummaryBanner",props:{mode:{},completedCount:{},failedCount:{},thumbnailUrls:{default:n(()=>[],"default")},ariaLabel:{}},emits:["click"],setup(e,{emit:o}){const t=e,s=o;return(a,l)=>{const i=xa("i18n-t");return d(),U(X,{variant:"secondary",size:"lg",class:"group w-full justify-between gap-3 p-1 text-left font-normal hover:cursor-pointer focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-primary-background","aria-label":t.ariaLabel,onClick:l[0]||(l[0]=r=>s("click",r))},{default:E(()=>[c("span",Jd,[t.mode==="allFailed"?(d(),T("span",Yd,l[1]||(l[1]=[c("i",{class:"ml-1 icon-[lucide--circle-alert] block size-4 leading-none text-destructive-background"},null,-1)]))):V("",!0),c("span",Xd,[t.mode!=="allFailed"?(d(),T("span",Zd,[(d(!0),T(ne,null,be(t.thumbnailUrls,(r,u)=>(d(),T("span",{key:r+u,class:"inline-block h-6 w-6 overflow-hidden rounded-[6px] border-0 bg-secondary-background",style:he({marginLeft:u===0?"0":"-12px"})},[c("img",{src:r,alt:a.$t("sideToolbar.queueProgressOverlay.preview"),class:"h-full w-full object-cover"},null,8,ep)],4))),128))])):V("",!0),c("span",tp,[t.mode==="allSuccess"?(d(),U(i,{key:0,keypath:"sideToolbar.queueProgressOverlay.jobsCompleted",plural:t.completedCount},{count:E(()=>[c("span",op,R(t.completedCount),1)]),_:1},8,["plural"])):t.mode==="mixed"?(d(),T(ne,{key:1},[F(i,{keypath:"sideToolbar.queueProgressOverlay.jobsCompleted",plural:t.completedCount},{count:E(()=>[c("span",np,R(t.completedCount),1)]),_:1},8,["plural"]),l[2]||(l[2]=c("span",null,", ",-1)),F(i,{keypath:"sideToolbar.queueProgressOverlay.jobsFailed",plural:t.failedCount},{count:E(()=>[c("span",sp,R(t.failedCount),1)]),_:1},8,["plural"])],64)):(d(),U(i,{key:2,keypath:"sideToolbar.queueProgressOverlay.jobsFailed",plural:t.failedCount},{count:E(()=>[c("span",ap,R(t.failedCount),1)]),_:1},8,["plural"]))])])]),l[3]||(l[3]=c("span",{class:"flex items-center justify-center rounded p-1 text-text-secondary transition-colors duration-200 ease-in-out"},[c("i",{class:"icon-[lucide--chevron-down] block size-4 leading-none"})],-1))]),_:1},8,["aria-label"])}}}),ip={class:"pointer-events-auto"},rp=q({__name:"QueueOverlayEmpty",props:{summary:{}},emits:["summaryClick"],setup(e){const{t:o}=pe();return(t,s)=>(d(),T("div",ip,[F(lp,{mode:t.summary.mode,"completed-count":t.summary.completedCount,"failed-count":t.summary.failedCount,"thumbnail-urls":t.summary.thumbnailUrls,"aria-label":y(o)("sideToolbar.queueProgressOverlay.expandCollapsedQueue"),onClick:s[0]||(s[0]=a=>t.$emit("summaryClick"))},null,8,["mode","completed-count","failed-count","thumbnail-urls","aria-label"])]))}});function up(e,o){const t=Le(),s=Xe(),a=Tt(),{copyToClipboard:l}=Ha(),i=lo(),r=ht(),u=Pi(),f=n(async()=>{const I=e();if(!I)return;const P=I.taskRef?.workflow;if(!P)return;const z=`Job ${I.id}.json`,j=t.createTemporary(z,P);await s.openWorkflow(j)},"openJobWorkflow"),m=n(async()=>{const I=e();I&&await l(I.id)},"copyJobId"),v=n(async()=>{const I=e();I&&(I.state==="running"||I.state==="initialization"?await Se.interrupt(I.id):I.state==="pending"&&await Se.deleteItem("queue",I.id),await a.update())},"cancelJob"),p=n(async()=>{const I=e();if(!I)return;const j=I.taskRef?.status?.messages?.find(D=>D?.[0]==="execution_error")?.[1]?.exception_message;j&&await l(String(j))},"copyErrorMessage"),w=n(()=>{const I=e();if(!I)return;const z=I.taskRef?.status?.messages?.find(j=>j?.[0]==="execution_error")?.[1];z&&tt().showExecutionErrorDialog(z)},"reportError"),k=n(async()=>{const I=e();if(!I)return;const P=I.taskRef?.previewOutput;if(!P)return;let z=null,j=null;if(P.isImage?(z="LoadImage",j="image"):P.isVideo?(z="LoadVideo",j="file"):P.isAudio&&(z="LoadAudio",j="audio"),!z||!j)return;const D=r.nodeDefsByName[z];if(!D)return;const A=i.addNodeOnGraph(D,{pos:i.getCanvasCenter()});if(!A)return;const B=n(K=>K==="input"||K==="output"||K==="temp","isResultItemType"),W={filename:P.filename,subfolder:P.subfolder,type:B(P.type)?P.type:void 0},G=Di(W,{rootFolder:W.type}),H=A.widgets?.find(K=>K.name===j);H&&(H.value=G,H.callback?.(G)),A.graph?.setDirtyCanvas(!0,!0)},"addOutputLoaderNode"),g=n(()=>{const I=e();if(!I)return;const P=I.taskRef?.previewOutput;P&&ln(P.url)},"downloadPreviewAsset"),b=n(async()=>{const I=e();if(!I)return;const P=I.taskRef?.workflow;if(!P)return;const z=ue();let j=`Job ${I.id}.json`;if(z.get("Comfy.PromptFilename")){const B=await tt().prompt({title:ce("workflowService.exportWorkflow"),message:ce("workflowService.enterFilename")+":",defaultValue:j});if(!B)return;j=Ga(B)}const D=JSON.stringify(P,null,2),A=new Blob([D],{type:"application/json"});Ai(j,A)},"exportJobWorkflow"),S=n(async()=>{const I=e();if(!I)return;const P=I.taskRef,z=P?.previewOutput;if(!P||!z)return;const j=Li(P,z);await u.confirmDelete(j)&&await a.update()},"deleteJobAsset"),_=n(async()=>{const I=e()?.taskRef;I&&await a.delete(I)},"removeFailedJob"),C=h(()=>we("queue.jobMenu.openAsWorkflowNewTab","Open as workflow in new tab")),x=h(()=>we("queue.jobMenu.openWorkflowNewTab","Open workflow in new tab")),N=h(()=>we("queue.jobMenu.copyJobId","Copy job ID")),M=h(()=>we("queue.jobMenu.cancelJob","Cancel job"));return{jobMenuEntries:h(()=>{const I=e(),P=I?.state;if(!P)return[];const z=!!I?.taskRef?.previewOutput;return P==="completed"?[{key:"inspect-asset",label:we("queue.jobMenu.inspectAsset","Inspect asset"),icon:"icon-[lucide--zoom-in]",onClick:o?()=>{const j=e();j&&o(j)}:void 0},{key:"add-to-current",label:we("queue.jobMenu.addToCurrentWorkflow","Add to current workflow"),icon:"icon-[comfy--node]",onClick:k},{key:"download",label:we("queue.jobMenu.download","Download"),icon:"icon-[lucide--download]",onClick:g},{kind:"divider",key:"d1"},{key:"open-workflow",label:C.value,icon:"icon-[comfy--workflow]",onClick:f},{key:"export-workflow",label:we("queue.jobMenu.exportWorkflow","Export workflow"),icon:"icon-[comfy--file-output]",onClick:b},{kind:"divider",key:"d2"},{key:"copy-id",label:N.value,icon:"icon-[lucide--copy]",onClick:m},{kind:"divider",key:"d3"},...z?[{key:"delete",label:we("queue.jobMenu.deleteAsset","Delete asset"),icon:"icon-[lucide--trash-2]",onClick:S}]:[]]:P==="failed"?[{key:"open-workflow",label:x.value,icon:"icon-[comfy--workflow]",onClick:f},{kind:"divider",key:"d1"},{key:"copy-id",label:N.value,icon:"icon-[lucide--copy]",onClick:m},{key:"copy-error",label:we("queue.jobMenu.copyErrorMessage","Copy error message"),icon:"icon-[lucide--copy]",onClick:p},{key:"report-error",label:we("queue.jobMenu.reportError","Report error"),icon:"icon-[lucide--message-circle-warning]",onClick:w},{kind:"divider",key:"d2"},{key:"delete",label:we("queue.jobMenu.removeJob","Remove job"),icon:"icon-[lucide--circle-minus]",onClick:_}]:[{key:"open-workflow",label:C.value,icon:"icon-[comfy--workflow]",onClick:f},{kind:"divider",key:"d1"},{key:"copy-id",label:N.value,icon:"icon-[lucide--copy]",onClick:m},{kind:"divider",key:"d2"},{key:"cancel-job",label:M.value,icon:"icon-[lucide--x]",onClick:v}]}),openJobWorkflow:f,copyJobId:m,cancelJob:v}}n(up,"useJobMenu");const cp={class:"flex h-12 items-center justify-between gap-2 border-b border-interface-stroke px-2"},dp={class:"px-2 text-[14px] font-normal text-text-primary"},pp={key:0,class:"ml-4 inline-flex items-center gap-1 text-blue-100"},fp={class:"font-bold"},mp={class:"ml-1"},gp={key:0,class:"flex items-center gap-1"},vp={class:"flex flex-col items-stretch rounded-lg border border-interface-stroke bg-interface-panel-surface px-2 py-3 font-inter"},hp=q({__name:"QueueOverlayHeader",props:{headerTitle:{},showConcurrentIndicator:{type:Boolean},concurrentWorkflowCount:{}},emits:["clearHistory"],setup(e,{emit:o}){const t=o,{t:s}=pe(),a=L(null),l=h(()=>et(s("g.more"))),i=n(u=>{a.value?.toggle(u)},"onMoreClick"),r=n(()=>{a.value?.hide(),t("clearHistory")},"onClearHistoryFromMenu");return(u,f)=>{const m=Ie("tooltip");return d(),T("div",cp,[c("div",dp,[c("span",null,R(u.headerTitle),1),u.showConcurrentIndicator?(d(),T("span",pp,[f[0]||(f[0]=c("span",{class:"inline-block size-2 rounded-full bg-blue-100"},null,-1)),c("span",null,[c("span",fp,R(u.concurrentWorkflowCount),1),c("span",mp,R(y(s)("sideToolbar.queueProgressOverlay.running")),1)])])):V("",!0)]),y(mt)?V("",!0):(d(),T("div",gp,[de((d(),U(X,{variant:"textonly",size:"icon","aria-label":y(s)("sideToolbar.queueProgressOverlay.moreOptions"),onClick:i},{default:E(()=>f[1]||(f[1]=[c("i",{class:"icon-[lucide--more-horizontal] block size-4 leading-none text-text-secondary"},null,-1)])),_:1},8,["aria-label"])),[[m,l.value,void 0,{top:!0}]]),F(y(Ye),{ref_key:"morePopoverRef",ref:a,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:{root:{class:"absolute z-50"},content:{class:["bg-transparent border-none p-0 pt-2 rounded-lg shadow-lg font-inter"]}}},{default:E(()=>[c("div",vp,[F(X,{class:"w-full justify-start",variant:"textonly",size:"sm","aria-label":y(s)("sideToolbar.queueProgressOverlay.clearHistory"),onClick:r},{default:E(()=>[f[2]||(f[2]=c("i",{class:"icon-[lucide--file-x-2] size-4 text-muted"},null,-1)),c("span",null,R(y(s)("sideToolbar.queueProgressOverlay.clearHistory")),1)]),_:1},8,["aria-label"])])]),_:1},512)]))])}}}),yp={class:"flex min-w-[14rem] flex-col items-stretch rounded-lg border border-interface-stroke bg-interface-panel-surface px-2 py-3 font-inter"},bp={key:0,class:"px-2 py-1"},wp=q({__name:"JobContextMenu",props:{entries:{}},emits:["action"],setup(e,{expose:o,emit:t}){const s=t,a=L(null);function l(u){a.value&&a.value.toggle(u)}n(l,"open");function i(){a.value?.hide()}n(i,"hide");function r(u){s("action",u)}return n(r,"onEntry"),o({open:l,hide:i}),(u,f)=>(d(),U(y(Ye),{ref_key:"jobItemPopoverRef",ref:a,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:{root:{class:"absolute z-50"},content:{class:["bg-transparent border-none p-0 pt-2 rounded-lg shadow-lg font-inter"]}}},{default:E(()=>[c("div",yp,[(d(!0),T(ne,null,be(u.entries,m=>(d(),T(ne,{key:m.key},[m.kind==="divider"?(d(),T("div",bp,f[0]||(f[0]=[c("div",{class:"h-px bg-interface-stroke"},null,-1)]))):(d(),U(X,{key:1,class:"w-full justify-start bg-transparent",variant:"textonly",size:"sm","aria-label":m.label,onClick:n(v=>r(m),"onClick")},{default:E(()=>[m.icon?(d(),T("i",{key:0,class:Q([m.icon,"block size-4 shrink-0 leading-none text-text-secondary"])},null,2)):V("",!0),c("span",null,R(m.label),1)]),_:2},1032,["aria-label","onClick"]))],64))),128))])]),_:1},512))}}),So=n(e=>{const o=Math.round(e??0);return ql(o,0,100)},"clampPercentInt"),Qo=n((e,o)=>{const t=So(o);return new Intl.NumberFormat(e,{style:"percent",maximumFractionDigits:0}).format((t||0)/100)},"formatPercent0");function bl(){const{locale:e}=pe(),o=Ze(),t=h(()=>So(Math.round((o.executionProgress??0)*100))),s=h(()=>Qo(e.value,t.value)),a=h(()=>So(Math.round((o.executingNodeProgress??0)*100))),l=h(()=>Qo(e.value,a.value)),i=h(()=>({width:`${t.value}%`,background:"var(--color-interface-panel-job-progress-primary)"})),r=h(()=>({width:`${a.value}%`,background:"var(--color-interface-panel-job-progress-secondary)"}));return{totalPercent:t,totalPercentFormatted:s,currentNodePercent:a,currentNodePercentFormatted:l,totalProgressStyle:i,currentNodeProgressStyle:r}}n(bl,"useQueueProgress");const kp=n(e=>{const o=new Date(e),t=o.getFullYear(),s=String(o.getMonth()+1).padStart(2,"0"),a=String(o.getDate()).padStart(2,"0");return`${t}-${s}-${a}`},"dateKey"),Cp=n(e=>{const o=new Date(e),t=new Date;return o.getFullYear()===t.getFullYear()&&o.getMonth()===t.getMonth()&&o.getDate()===t.getDate()},"isToday"),xp=n(e=>{const o=new Date(e),t=new Date,s=new Date(t.getFullYear(),t.getMonth(),t.getDate()-1);return o.getFullYear()===s.getFullYear()&&o.getMonth()===s.getMonth()&&o.getDate()===s.getDate()},"isYesterday"),Sp=n((e,o)=>{const t=new Date(e);return new Intl.DateTimeFormat(o,{month:"short",day:"numeric"}).format(t)},"formatShortMonthDay"),Ln=n((e,o)=>{const t=new Date(e);return new Intl.DateTimeFormat(o,{hour:"numeric",minute:"2-digit",second:"2-digit"}).format(t)},"formatClockTime"),Ct=n(e=>{switch(e){case"pending":return"icon-[lucide--loader-circle]";case"initialization":return"icon-[lucide--server-crash]";case"running":return"icon-[lucide--zap]";case"completed":return"icon-[lucide--check-check]";case"failed":return"icon-[lucide--alert-circle]";default:return"icon-[lucide--circle]"}},"iconForJobState"),Js=n((e,o)=>{const t=o("g.job"),s=String(e.promptId??"").split("-")[0],a=e.queueIndex;return typeof a=="number"?`${t} #${a}`:s?`${t} ${s}`:t},"buildTitle"),kn=n((e,o,t)=>{const s=e.createTime;return s!==void 0?t(s,o):""},"buildQueuedTime"),_p=n((e,o,t)=>{if(o==="pending")return t.showAddedHint?{iconName:"icon-[lucide--check]",primary:t.t("queue.jobAddedToQueue"),secondary:kn(e,t.locale,t.formatClockTimeFn),showClear:!0}:{iconName:Ct(o),primary:t.t("queue.inQueue"),secondary:kn(e,t.locale,t.formatClockTimeFn),showClear:!0};if(o==="initialization")return{iconName:Ct(o),primary:t.t("queue.initializingAlmostReady"),secondary:kn(e,t.locale,t.formatClockTimeFn),showClear:!0};if(o==="running"){if(t.isActive){const s=Qo(t.locale,So(t.totalPercent)),a=Qo(t.locale,So(t.currentNodePercent)),l=t.t("sideToolbar.queueProgressOverlay.total",{percent:s}),i=t.currentNodeName?`${t.currentNodeName} ${t.t("sideToolbar.queueProgressOverlay.colonPercent",{percent:a})}`:"";return{iconName:Ct(o),primary:l,secondary:i,showClear:!0}}return{iconName:Ct(o),primary:t.t("g.running"),secondary:"",showClear:!0}}if(o==="completed"){const s=e.executionTimeInSeconds,a=e.previewOutput,l=a&&a.isImage?a.url:void 0,i=t.isCloud?t.t("queue.completedIn",{duration:Ei(e.executionTime??0)}):a?.filename&&a.filename.length?a.filename:Js(e,t.t);return{iconName:Ct(o),iconImageUrl:l,primary:i,secondary:s!==void 0?`${s.toFixed(2)}s`:"",showClear:!1}}return o==="failed"?{iconName:Ct(o),primary:t.t("g.failed"),secondary:t.t("g.failed"),showClear:!0}:{iconName:Ct(o),primary:Js(e,t.t),secondary:"",showClear:!0}},"buildJobDisplay"),fs=n((e,o)=>{if(o)return"initialization";switch(e.displayStatus){case"Running":return"running";case"Pending":return"pending";case"Completed":return"completed";case"Failed":case"Cancelled":return"failed"}return"failed"},"jobStateFromTask"),Ys=["All","Completed","Failed"],Xs=["mostRecent","totalGenerationTime"],Tp=3e3,Zs=new Map,ea=n(e=>{if(e==null)return null;const o=String(e);return o.length?o:null},"taskIdToKey"),$p=n((e,o,t)=>{const s=n(a=>{const l=t.format(a,"day");return l&&l[0].toLocaleUpperCase(o)+l.slice(1)},"formatRelativeDay");return Cp(e)?s(0):xp(e)?s(-1):Sp(e,o)},"dateLabelForTimestamp");function Np(){const{t:e,locale:o}=pe(),t=Tt(),s=Ze(),a=Le(),l=L(new Set),i=L(new Set),r=new Map,u=n(D=>{const A=r.get(D);A!==void 0&&(clearTimeout(A),r.delete(D))},"clearAddedHintTimeout"),f=n(D=>{u(D);const A=setTimeout(()=>{r.delete(D);const B=new Set(i.value);B.delete(D)&&(i.value=B)},Tp);r.set(D,A)},"scheduleAddedHintExpiry");ae(()=>t.pendingTasks.map(D=>ea(D.promptId)).filter(D=>!!D),D=>{const A=new Set(D),B=new Set(i.value),W=new Set(l.value);D.forEach(G=>{W.has(G)||(W.add(G),B.add(G),f(G))});for(const G of Array.from(W))A.has(G)||(W.delete(G),B.delete(G),u(G));i.value=B,l.value=W},{immediate:!0});const m=n((D,A)=>{if(A!=="pending")return!1;const B=ea(D.promptId);return B?i.value.has(B):!1},"shouldShowAddedHint");ut(()=>{r.forEach(D=>clearTimeout(D)),r.clear(),l.value=new Set,i.value=new Set});const{totalPercent:v,currentNodePercent:p}=bl(),w=h(()=>{const D=o.value;let A=Zs.get(D);return A||(A=new Intl.RelativeTimeFormat(D,{numeric:"auto"}),Zs.set(D,A)),A}),k=h(()=>e("queue.jobList.undated")||"Undated"),g=n(D=>s.isPromptInitializing(D),"isJobInitializing"),b=h(()=>{const D=s.executingNode;if(!D)return e("g.emDash");const A=(D.title??"").toString().trim();if(A)return A;const B=(D.type??"").toString().trim()||e("g.untitled"),W=`nodeDefs.${We(B)}.display_name`;return we(W,B)}),S=L("All"),_=L("all"),C=L("mostRecent"),x=h(()=>[...t.pendingTasks,...t.runningTasks,...t.historyTasks].sort((A,B)=>B.queueIndex-A.queueIndex)),N=h(()=>x.value.map(D=>({task:D,state:fs(D,g(D?.promptId))}))),M=h(()=>N.value.some(({state:D})=>D==="failed"));ae(()=>M.value,D=>{!D&&S.value==="Failed"&&(S.value="All")});const $=h(()=>{let D=N.value;if(S.value==="Completed"?D=D.filter(({state:A})=>A==="completed"):S.value==="Failed"&&(D=D.filter(({state:A})=>A==="failed")),_.value==="current"){const A=a.activeWorkflow?.activeState?.id;if(!A)return[];D=D.filter(({task:B})=>{const W=B.workflow?.id;return!!W&&W===A})}return D}),I=h(()=>$.value.map(({task:D})=>D)),P=h(()=>$.value.map(({task:D,state:A})=>{const B=String(D.promptId??"")===String(s.activePromptId??""),W=m(D,A),G=_p(D,A,{t:e,locale:o.value,formatClockTimeFn:Ln,isActive:B,totalPercent:B?v.value:void 0,currentNodePercent:B?p.value:void 0,currentNodeName:B?b.value:void 0,showAddedHint:W,isCloud:mt});return{id:String(D.promptId),title:G.primary,meta:G.secondary,state:A,iconName:G.iconName,iconImageUrl:G.iconImageUrl,showClear:G.showClear,taskRef:D,progressTotalPercent:A==="running"&&B?v.value:void 0,progressCurrentPercent:A==="running"&&B?p.value:void 0,runningNodeName:A==="running"&&B?b.value:void 0,executionTimeMs:D.executionTime,computeHours:D.executionTime!==void 0?D.executionTime/36e5:void 0}})),z=h(()=>{const D=new Map;return P.value.forEach(A=>D.set(A.id,A)),D}),j=h(()=>{const D=[],A=new Map,B=o.value;for(const{task:W,state:G}of $.value){let H;G==="completed"||G==="failed"?H=W.executionEndTimestamp:H=W.createTime;const K=H===void 0?"undated":kp(H);let ee=A.get(K);if(ee===void 0){const Y=H===void 0?k.value:$p(H,B,w.value);D.push({key:K,label:Y,items:[]}),ee=D.length-1,A.set(K,ee)}const ie=z.value.get(String(W.promptId));ie&&D[ee].items.push(ie)}if(C.value==="totalGenerationTime"){const W=n(H=>typeof H=="number"&&!Number.isNaN(H)?H:-1,"valueOrDefault"),G=n((H,K)=>W(K.executionTimeMs)-W(H.executionTimeMs),"sortByExecutionTimeDesc");D.forEach(H=>{H.items.sort(G)})}return D});return{selectedJobTab:S,selectedWorkflowFilter:_,selectedSortMode:C,hasFailedJobs:M,allTasksSorted:x,filteredTasks:I,jobItems:P,groupedJobItems:j,currentNodeName:b}}n(Np,"useJobList");const Ip={class:"flex items-center justify-between gap-2 px-3"},Mp={class:"min-w-0 flex-1 overflow-x-auto"},Pp={class:"inline-flex items-center gap-1 whitespace-nowrap"},Dp={class:"ml-2 flex shrink-0 items-center gap-2"},Ap={key:0,class:"pointer-events-none absolute -top-1 -right-1 inline-block size-2 rounded-full bg-base-foreground"},Lp={class:"flex min-w-[12rem] flex-col items-stretch rounded-lg border border-interface-stroke bg-interface-panel-surface px-2 py-3"},Ep={key:0,class:"icon-[lucide--check] size-4"},Op={key:0,class:"icon-[lucide--check] block size-4 leading-none text-text-secondary"},Vp={key:0,class:"pointer-events-none absolute -top-1 -right-1 inline-block size-2 rounded-full bg-base-foreground"},Rp={class:"flex min-w-[12rem] flex-col items-stretch rounded-lg border border-interface-stroke bg-interface-panel-surface px-2 py-3"},Wp={key:0,class:"icon-[lucide--check] size-4 text-text-secondary"},zp={key:0,class:"mx-2 mt-1 h-px"},Bp=q({__name:"JobFiltersBar",props:{selectedJobTab:{},selectedWorkflowFilter:{},selectedSortMode:{},hasFailedJobs:{type:Boolean}},emits:["update:selectedJobTab","update:selectedWorkflowFilter","update:selectedSortMode"],setup(e,{emit:o}){const t=e,s=o,{t:a}=pe(),l=L(null),i=L(null),r=h(()=>et(a("sideToolbar.queueProgressOverlay.filterBy"))),u=h(()=>et(a("sideToolbar.queueProgressOverlay.sortBy"))),f=h(()=>t.hasFailedJobs?Ys:Ys.filter(b=>b!=="Failed")),m=n(b=>{l.value&&l.value.toggle(b)},"onFilterClick"),v=n(b=>{l.value?.hide?.(),s("update:selectedWorkflowFilter",b)},"selectWorkflowFilter"),p=n(b=>{i.value&&i.value.toggle(b)},"onSortClick"),w=n(b=>{i.value?.hide?.(),s("update:selectedSortMode",b)},"selectSortMode"),k=n(b=>a(b==="All"?"g.all":b==="Completed"?"g.completed":"g.failed"),"tabLabel"),g=n(b=>b==="mostRecent"?a("queue.jobList.sortMostRecent"):b==="totalGenerationTime"?a("queue.jobList.sortTotalGenerationTime"):"","sortLabel");return(b,S)=>{const _=Ie("tooltip");return d(),T("div",Ip,[c("div",Mp,[c("div",Pp,[(d(!0),T(ne,null,be(f.value,C=>(d(),U(X,{key:C,variant:b.selectedJobTab===C?"secondary":"muted-textonly",size:"sm",class:"px-3",onClick:n(x=>b.$emit("update:selectedJobTab",C),"onClick")},{default:E(()=>[$e(R(k(C)),1)]),_:2},1032,["variant","onClick"]))),128))])]),c("div",Dp,[de((d(),U(X,{key:0,variant:"secondary",size:"icon","aria-label":y(a)("sideToolbar.queueProgressOverlay.filterJobs"),onClick:m},{default:E(()=>[S[2]||(S[2]=c("i",{class:"icon-[lucide--list-filter] size-4"},null,-1)),b.selectedWorkflowFilter!=="all"?(d(),T("span",Ap)):V("",!0)]),_:1},8,["aria-label"])),[[_,r.value,void 0,{top:!0}]]),(d(),U(y(Ye),{key:1,ref_key:"filterPopoverRef",ref:l,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:{root:{class:"absolute z-50"},content:{class:["bg-transparent border-none p-0 pt-2 rounded-lg shadow-lg font-inter"]}}},{default:E(()=>[c("div",Lp,[F(X,{class:"w-full justify-between",variant:"textonly",size:"sm",onClick:S[0]||(S[0]=C=>v("all"))},{default:E(()=>[c("span",null,R(y(a)("sideToolbar.queueProgressOverlay.filterAllWorkflows")),1),b.selectedWorkflowFilter==="all"?(d(),T("i",Ep)):V("",!0)]),_:1}),S[3]||(S[3]=c("div",{class:"mx-2 mt-1 h-px"},null,-1)),F(X,{class:"w-full justify-between",variant:"textonly",onClick:S[1]||(S[1]=C=>v("current"))},{default:E(()=>[c("span",null,R(y(a)("sideToolbar.queueProgressOverlay.filterCurrentWorkflow")),1),b.selectedWorkflowFilter==="current"?(d(),T("i",Op)):V("",!0)]),_:1})])]),_:1},512)),de((d(),U(X,{variant:"secondary",size:"icon","aria-label":y(a)("sideToolbar.queueProgressOverlay.sortJobs"),onClick:p},{default:E(()=>[S[4]||(S[4]=c("i",{class:"icon-[lucide--arrow-up-down] size-4"},null,-1)),b.selectedSortMode!=="mostRecent"?(d(),T("span",Vp)):V("",!0)]),_:1},8,["aria-label"])),[[_,u.value,void 0,{top:!0}]]),F(y(Ye),{ref_key:"sortPopoverRef",ref:i,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:{root:{class:"absolute z-50"},content:{class:["bg-transparent border-none p-0 pt-2 rounded-lg shadow-lg font-inter"]}}},{default:E(()=>[c("div",Rp,[(d(!0),T(ne,null,be(y(Xs),(C,x)=>(d(),T(ne,{key:C},[F(X,{class:"w-full justify-between",variant:"textonly",size:"sm",onClick:n(N=>w(C),"onClick")},{default:E(()=>[c("span",null,R(g(C)),1),b.selectedSortMode===C?(d(),T("i",Wp)):V("",!0)]),_:2},1032,["onClick"]),x<y(Xs).length-1?(d(),T("div",zp)):V("",!0)],64))),128))])]),_:1},512)])])}}}),ta=n(e=>{const t=e?.status?.messages;if(!Array.isArray(t)||!t.length)return null;const s=t.find(i=>Array.isArray(i)&&i[0]==="execution_error");if(!s)return null;const a=s[1],l=String(a?.exception_message??"");return{detail:a,message:l}},"extractExecutionError"),Fp=n(({taskForJob:e,copyToClipboard:o,dialog:t})=>{const s=h(()=>ta(e.value)?.message??"");return{errorMessageValue:s,copyErrorMessage:n(()=>{s.value&&o(s.value)},"copyErrorMessage"),reportJobError:n(()=>{const i=ta(e.value);if(i?.detail){t.showExecutionErrorDialog(i.detail);return}s.value&&t.showErrorDialog(new Error(s.value),{reportType:"queueJobError"})},"reportJobError")}},"useJobErrorReporting"),En=n(e=>{const o=Math.max(0,Math.floor(e/1e3)),t=Math.floor(o/60),s=o%60;return`${t}m ${s}s`},"formatElapsedTime"),Up=n(e=>e.historyTasks.map(o=>Number(o.executionTimeInSeconds)).filter(o=>typeof o=="number"&&!Number.isNaN(o)),"pickRecentDurations"),Gp=n(({queueStore:e,executionStore:o,taskForJob:t,jobState:s,firstSeenTs:a,jobsAhead:l,nowTs:i})=>{const r=h(()=>o.runningWorkflowCount),u=h(()=>s.value==="pending"&&!!a.value&&(r.value??0)>1),f=h(()=>Up(e).slice(-20)),m=h(()=>{const k=f.value;if(!k.length)return null;const g=k.slice().sort(($,I)=>$-I),b=g.reduce(($,I)=>$+I,0)/g.length,S=g[Math.min(g.length-1,Math.floor(g.length*.75))],_=e.runningTasks,C=i.value,x=_.map($=>$.executionStartTimestamp).filter($=>typeof $=="number").map($=>{const I=Math.max(0,Math.floor((C-$)/1e3));return{lo:Math.max(0,Math.round(b-I)),hi:Math.max(0,Math.round(S-I))}});if(!x.length)return null;const N=x.reduce(($,I)=>Math.min($,I.lo),1/0),M=x.reduce(($,I)=>Math.min($,I.hi),1/0);return[N,M]}),v=h(()=>{const k=f.value;if(!k.length)return null;const g=l.value;if(g==null)return null;const b=k.slice().sort((N,M)=>N-M),S=b.reduce((N,M)=>N+M,0)/b.length,_=b[Math.min(b.length-1,Math.floor(b.length*.75))];if(g<=0)return m.value??[0,0];const C=Math.max(1,r.value||1),x=Math.ceil(g/C);return[Math.round(S*x),Math.round(_*x)]}),p=h(()=>{const k=f.value;if(!k.length)return null;const g=k.slice().sort((I,P)=>I-P),b=g.reduce((I,P)=>I+P,0)/g.length,S=g[Math.min(g.length-1,Math.floor(g.length*.75))],_=t.value,x=(s.value==="running"?_?.executionStartTimestamp:void 0)??a.value,N=x?Math.max(0,Math.floor((i.value-x)/1e3)):0,M=Math.max(0,Math.round(b-N)),$=Math.max(0,Math.round(S-N));return[M,$]}),w=h(()=>{const k=t.value,b=(s.value==="running"?k?.executionStartTimestamp:void 0)??a.value;return b?En(i.value-b):""});return{runningWorkflowCount:r,showParallelQueuedStats:u,estimateRangeSeconds:v,estimateRemainingRangeSeconds:p,timeElapsedValue:w}},"useQueueEstimates"),jp={class:"w-[300px] min-w-[260px] rounded-lg border border-interface-stroke bg-interface-panel-surface shadow-md"},Hp={class:"flex items-center border-b border-interface-stroke p-4"},qp={class:"text-[0.875rem] leading-normal font-normal text-text-primary"},Kp={class:"flex flex-col gap-6 px-4 pt-4 pb-4"},Qp={class:"grid grid-cols-2 items-center gap-x-2 gap-y-2"},Jp={class:"flex items-center text-[0.75rem] leading-normal font-normal text-text-primary"},Yp={class:"flex min-w-0 items-center text-[0.75rem] leading-normal font-normal text-text-secondary"},Xp={class:"block min-w-0 truncate"},Zp={key:0,class:"grid grid-cols-2 items-center gap-x-2 gap-y-2"},ef={class:"flex items-center text-[0.75rem] leading-normal font-normal text-text-primary"},tf={class:"flex min-w-0 items-center text-[0.75rem] leading-normal font-normal text-text-secondary"},of={class:"block min-w-0 truncate"},nf={key:1,class:"grid grid-cols-2 gap-x-2"},sf={class:"flex items-center text-[0.75rem] leading-normal font-normal text-text-primary"},af={class:"flex items-center justify-between gap-4"},lf={class:"col-span-2 mt-2 rounded bg-interface-panel-hover-surface px-4 py-2 text-[0.75rem] leading-normal text-text-secondary"},rf=q({__name:"JobDetailsPopover",props:{jobId:{},workflowId:{}},setup(e){const o=e,t=h(()=>u("g.copy")),s=Le(),a=Tt(),l=Ze(),i=tt(),{locale:r,t:u}=pe(),f=h(()=>{const K=o.workflowId;if(!K)return"";const ee=s.activeWorkflow?.activeState?.id;return ee&&ee===K?s.activeWorkflow?.filename??K:K}),m=h(()=>o.jobId),{copyToClipboard:v}=Ha(),p=n(()=>{v(m.value)},"copyJobId"),w=h(()=>{const K=o.jobId,ee=n(ie=>ie.find(Y=>String(Y.promptId??"")===String(K)),"findIn");return ee(a.pendingTasks)||ee(a.runningTasks)||ee(a.historyTasks)||null}),k=h(()=>{const K=w.value;if(!K)return null;const ee=l.isPromptInitializing(String(K?.promptId));return fs(K,ee)}),g=h(()=>w.value?.createTime),b=h(()=>g.value!==void 0?Ln(g.value,r.value):""),S=h(()=>{const K=w.value;return K?Number(K.queueIndex):null}),_=h(()=>{const K=S.value;return K==null?null:a.pendingTasks.filter(ie=>Number(ie.queueIndex)<K).length}),C=h(()=>{if(_.value==null)return"";const K=_.value;return u("queue.jobDetails.queuePositionValue",{count:K},K)}),x=L(Date.now());let N=null;Ve(()=>{N=window.setInterval(()=>{x.value=Date.now()},1e3)}),ut(()=>{N!=null&&(clearInterval(N),N=null)});const{showParallelQueuedStats:M,estimateRangeSeconds:$,estimateRemainingRangeSeconds:I,timeElapsedValue:P}=Gp({queueStore:a,executionStore:l,taskForJob:w,jobState:k,firstSeenTs:g,jobsAhead:_,nowTs:x}),z=n((K,ee)=>{if(ee<=60){const oe=Math.max(1,Math.round(ee)),se=Math.max(1,Math.min(oe,Math.round(K)));return se===oe?u("queue.jobDetails.eta.seconds",{count:oe},oe):u("queue.jobDetails.eta.secondsRange",{lo:se,hi:oe})}if(K>=60&&ee<90)return u("queue.jobDetails.eta.minutes",{count:1},1);const ie=Math.max(1,Math.floor(K/60)),Y=Math.max(ie,Math.ceil(ee/60));return ie===Y?u("queue.jobDetails.eta.minutes",{count:ie},ie):u("queue.jobDetails.eta.minutesRange",{lo:ie,hi:Y})},"formatEta"),j=h(()=>{const K=$.value;if(!K)return"";const[ee,ie]=K;return z(ee,ie)}),D=h(()=>{const K=I.value;if(!K)return"";const[ee,ie]=K;return z(ee,ie)}),A=h(()=>[{label:u("queue.jobDetails.workflow"),value:f.value},{label:u("queue.jobDetails.jobId"),value:m.value,canCopy:!0}]),B=h(()=>{if(k.value==="pending"){if(!g.value)return[];const K=[{label:u("queue.jobDetails.queuedAt"),value:b.value}];return M.value&&K.push({label:u("queue.jobDetails.queuePosition"),value:C.value},{label:u("queue.jobDetails.timeElapsed"),value:P.value},{label:u("queue.jobDetails.estimatedStartIn"),value:j.value}),K}if(k.value==="running")return g.value?[{label:u("queue.jobDetails.queuedAt"),value:b.value},{label:u("queue.jobDetails.timeElapsed"),value:P.value},{label:u("queue.jobDetails.estimatedFinishIn"),value:D.value}]:[];if(k.value==="completed"){const K=w.value,ee=K?.executionEndTimestamp,ie=K?.executionTime,Y=ee?Ln(ee,r.value):"",oe=ie!==void 0?En(ie):"";return ie!==void 0&&(ie/36e5).toFixed(3)+"",[{label:u("queue.jobDetails.generatedOn"),value:Y},{label:u("queue.jobDetails.totalGenerationTime"),value:oe}]}if(k.value==="failed"){const ee=w.value?.executionTime,ie=ee!==void 0?En(ee):"";return ee!==void 0&&(ee/36e5).toFixed(3)+"",[{label:u("queue.jobDetails.queuedAt"),value:b.value},{label:u("queue.jobDetails.failedAfter"),value:ie}]}return[]}),{errorMessageValue:W,copyErrorMessage:G,reportJobError:H}=Fp({taskForJob:w,copyToClipboard:v,dialog:i});return(K,ee)=>(d(),T("div",jp,[c("div",Hp,[c("span",qp,R(y(u)("queue.jobDetails.header")),1)]),c("div",Kp,[c("div",Qp,[(d(!0),T(ne,null,be(A.value,ie=>(d(),T(ne,{key:ie.label},[c("div",Jp,R(ie.label),1),c("div",Yp,[c("span",Xp,R(ie.value),1),ie.canCopy?(d(),U(X,{key:0,size:"icon",variant:"muted-textonly","aria-label":t.value,onClick:Ce(p,["stop"])},{default:E(()=>ee[0]||(ee[0]=[c("i",{class:"icon-[lucide--copy] size-4"},null,-1)])),_:1},8,["aria-label"])):V("",!0)])],64))),128))]),B.value.length?(d(),T("div",Zp,[(d(!0),T(ne,null,be(B.value,ie=>(d(),T(ne,{key:ie.label},[c("div",ef,R(ie.label),1),c("div",tf,[c("span",of,R(ie.value),1)])],64))),128))])):V("",!0),k.value==="failed"?(d(),T("div",nf,[c("div",sf,R(y(u)("queue.jobDetails.errorMessage")),1),c("div",af,[F(X,{class:"justify-start px-0",variant:"muted-textonly",size:"sm","icon-position":"right",onClick:Ce(y(G),["stop"])},{default:E(()=>[c("span",null,R(t.value),1),ee[1]||(ee[1]=c("i",{class:"icon-[lucide--copy] block size-3.5 leading-none"},null,-1))]),_:1},8,["onClick"]),F(X,{class:"justify-start px-0",variant:"muted-textonly",size:"sm","icon-position":"right",onClick:Ce(y(H),["stop"])},{default:E(()=>[c("span",null,R(y(u)("queue.jobDetails.report")),1),ee[2]||(ee[2]=c("i",{class:"icon-[lucide--message-circle-warning] block size-3.5 leading-none"},null,-1))]),_:1},8,["onClick"])]),c("div",lf,R(y(W)),1)])):V("",!0)])]))}}),uf={class:"w-[300px] min-w-[260px] rounded-lg shadow-md"},cf={class:"p-3"},df={class:"relative aspect-square w-full overflow-hidden rounded-lg"},pf=["src","alt"],ff={key:0,class:"absolute bottom-2 left-2 rounded px-2 py-0.5 text-xs text-text-primary",style:{background:"rgba(217, 217, 217, 0.40)",backdropFilter:"blur(2px)"}},mf={class:"mt-2 text-center"},gf=["title"],vf={key:0,class:"mt-1 text-[0.75rem] leading-normal text-text-secondary"},hf=q({inheritAttrs:!1,__name:"QueueAssetPreview",props:{imageUrl:{},name:{},timeLabel:{}},emits:["image-click"],setup(e){const o=L(null),t=L(null),s=L(null),a=n(()=>{const l=o.value;l&&(t.value=l.naturalWidth||null,s.value=l.naturalHeight||null)},"onImgLoad");return(l,i)=>(d(),T("div",uf,[c("div",cf,[c("div",df,[c("img",{ref_key:"imgRef",ref:o,src:l.imageUrl,alt:l.name,class:"h-full w-full cursor-pointer object-contain",onClick:i[0]||(i[0]=r=>l.$emit("image-click")),onLoad:a},null,40,pf),l.timeLabel?(d(),T("div",ff,R(l.timeLabel),1)):V("",!0)]),c("div",mf,[c("div",{class:"truncate text-[0.875rem] leading-normal font-semibold text-text-primary",title:l.name},R(l.name),9,gf),t.value&&s.value?(d(),T("div",vf,R(t.value)+"x"+R(s.value),1)):V("",!0)])])]))}}),yf={key:0,class:"absolute inset-0"},bf={class:"relative z-1 flex items-center gap-1"},wf={class:"relative inline-flex items-center justify-center"},kf={class:"inline-flex h-6 w-6 items-center justify-center overflow-hidden rounded-[6px]"},Cf=["src"],xf={class:"relative z-1 min-w-0 flex-1"},Sf=["title"],_f={class:"relative z-1 flex items-center gap-2 text-text-secondary"},Tf={key:"actions",class:"inline-flex items-center gap-2 pr-1"},$f={key:"secondary",class:"pr-2"},Nf=q({__name:"QueueJobItem",props:{jobId:{},workflowId:{default:void 0},state:{},title:{},rightText:{default:""},iconName:{default:void 0},iconImageUrl:{default:void 0},showClear:{type:Boolean,default:void 0},showMenu:{type:Boolean,default:void 0},progressTotalPercent:{default:void 0},progressCurrentPercent:{default:void 0},activeDetailsId:{default:null}},emits:["cancel","delete","menu","view","details-enter","details-leave"],setup(e,{emit:o}){const t=e,s=o,{t:a}=pe(),l=h(()=>et(a("g.cancel"))),i=h(()=>et(a("g.delete"))),r=h(()=>et(a("g.more"))),u=L(null),f=h(()=>t.activeDetailsId===t.jobId),m=n(()=>{k.value||s("details-enter",t.jobId)},"onRowEnter"),v=n(()=>s("details-leave",t.jobId),"onRowLeave"),p=n(()=>s("details-enter",t.jobId),"onPopoverEnter"),w=n(()=>s("details-leave",t.jobId),"onPopoverLeave"),k=L(!1),g=L(null),b=L(null),S=n(()=>{g.value!==null&&(clearTimeout(g.value),g.value=null)},"clearPreviewHideTimer"),_=n(()=>{b.value!==null&&(clearTimeout(b.value),b.value=null)},"clearPreviewShowTimer"),C=h(()=>t.state==="completed"&&!!t.iconImageUrl),x=n(()=>{C.value&&(S(),_(),b.value=window.setTimeout(()=>{k.value=!0,b.value=null},200))},"scheduleShowPreview"),N=n(()=>{S(),_(),g.value=window.setTimeout(()=>{k.value=!1,g.value=null},150)},"scheduleHidePreview"),M=n(()=>x(),"onIconEnter"),$=n(()=>N(),"onIconLeave"),I=n(()=>x(),"onPreviewEnter"),P=n(()=>N(),"onPreviewLeave"),z=L(null),j=n(()=>{const Y=u.value;if(!Y)return;const oe=Y.getBoundingClientRect(),se=8;z.value={top:oe.top,right:window.innerWidth-oe.left+se}},"updatePopoverPosition"),D=h(()=>f.value||k.value&&C.value);ae(D,Y=>{Y?Re(j):z.value=null},{immediate:!1});const A=L(!1),B=h(()=>t.iconName?t.iconName:Ct(t.state)),W=h(()=>t.state==="pending"&&B.value===Ct("pending")&&!t.iconImageUrl),G=h(()=>t.showClear!==void 0?t.showClear:t.state!=="completed"),H=n(()=>s("details-leave",t.jobId),"emitDetailsLeave"),K=n(()=>{H(),s("cancel")},"onCancelClick"),ee=n(()=>{H(),s("delete")},"onDeleteClick"),ie=n(Y=>{(t.showMenu===void 0||t.showMenu)&&s("menu",Y)},"onContextMenu");return(Y,oe)=>{const se=Ie("tooltip");return d(),T("div",{ref_key:"rowRef",ref:u,class:"relative",onMouseenter:m,onMouseleave:v,onContextmenu:Ce(ie,["stop","prevent"])},[(d(),U(Nt,{to:"body"},[!k.value&&f.value&&z.value?(d(),T("div",{key:0,class:"fixed z-50",style:he({top:`${z.value.top}px`,right:`${z.value.right}px`}),onMouseenter:p,onMouseleave:w},[F(rf,{"job-id":t.jobId,"workflow-id":t.workflowId},null,8,["job-id","workflow-id"])],36)):V("",!0)])),(d(),U(Nt,{to:"body"},[k.value&&C.value&&z.value?(d(),T("div",{key:0,class:"fixed z-50",style:he({top:`${z.value.top}px`,right:`${z.value.right}px`}),onMouseenter:I,onMouseleave:P},[F(hf,{"image-url":Y.iconImageUrl,name:t.title,"time-label":Y.rightText||void 0,onImageClick:oe[0]||(oe[0]=Ne=>s("view"))},null,8,["image-url","name","time-label"])],36)):V("",!0)])),c("div",{class:"relative flex items-center justify-between gap-2 overflow-hidden rounded-lg border border-secondary-background bg-secondary-background p-1 text-[12px] text-text-primary transition-colors duration-150 ease-in-out hover:border-secondary-background-hover hover:bg-secondary-background-hover",onMouseenter:oe[3]||(oe[3]=Ne=>A.value=!0),onMouseleave:oe[4]||(oe[4]=Ne=>A.value=!1)},[t.state==="running"&&(t.progressTotalPercent!==void 0||t.progressCurrentPercent!==void 0)?(d(),T("div",yf,[t.progressTotalPercent!==void 0?(d(),T("div",{key:0,class:"pointer-events-none absolute inset-y-0 left-0 h-full bg-interface-panel-job-progress-primary transition-[width]",style:he({width:`${t.progressTotalPercent}%`})},null,4)):V("",!0),t.progressCurrentPercent!==void 0?(d(),T("div",{key:1,class:"pointer-events-none absolute inset-y-0 left-0 h-full bg-interface-panel-job-progress-secondary transition-[width]",style:he({width:`${t.progressCurrentPercent}%`})},null,4)):V("",!0)])):V("",!0),c("div",bf,[c("div",wf,[c("div",{class:"absolute left-1/2 top-1/2 size-10 -translate-x-1/2 -translate-y-1/2",onMouseenter:Ce(M,["stop"]),onMouseleave:Ce($,["stop"])},null,32),c("div",kf,[Y.iconImageUrl?(d(),T("img",{key:0,src:Y.iconImageUrl,class:"h-full w-full object-cover"},null,8,Cf)):(d(),T("i",{key:1,class:Q(y(le)(B.value,"size-4",W.value&&"animate-spin"))},null,2))])])]),c("div",xf,[c("div",{class:"truncate opacity-90",title:t.title},[ve(Y.$slots,"primary",{},()=>[$e(R(t.title),1)])],8,Sf)]),c("div",_f,[F(Zo,{mode:"out-in","enter-active-class":"transition-opacity transition-transform duration-150 ease-out","leave-active-class":"transition-opacity transition-transform duration-150 ease-in","enter-from-class":"opacity-0 translate-y-0.5","enter-to-class":"opacity-100 translate-y-0","leave-from-class":"opacity-100 translate-y-0","leave-to-class":"opacity-0 translate-y-0.5"},{default:E(()=>[A.value?(d(),T("div",Tf,[t.state==="failed"&&G.value?de((d(),U(X,{key:0,variant:"destructive",size:"icon","aria-label":y(a)("g.delete"),onClick:Ce(ee,["stop"])},{default:E(()=>oe[5]||(oe[5]=[c("i",{class:"icon-[lucide--trash-2] size-4"},null,-1)])),_:1},8,["aria-label"])),[[se,i.value,void 0,{top:!0}]]):t.state!=="completed"&&t.state!=="running"&&G.value?de((d(),U(X,{key:1,variant:"destructive",size:"icon","aria-label":y(a)("g.cancel"),onClick:Ce(K,["stop"])},{default:E(()=>oe[6]||(oe[6]=[c("i",{class:"icon-[lucide--x] size-4"},null,-1)])),_:1},8,["aria-label"])),[[se,l.value,void 0,{top:!0}]]):t.state==="completed"?(d(),U(X,{key:2,variant:"textonly",size:"sm",onClick:oe[1]||(oe[1]=Ce(Ne=>s("view"),["stop"]))},{default:E(()=>[$e(R(y(a)("menuLabels.View")),1)]),_:1})):V("",!0),t.showMenu===void 0||t.showMenu?de((d(),U(X,{key:3,variant:"textonly",size:"icon-sm","aria-label":y(a)("g.more"),onClick:oe[2]||(oe[2]=Ce(Ne=>s("menu",Ne),["stop"]))},{default:E(()=>oe[7]||(oe[7]=[c("i",{class:"icon-[lucide--more-horizontal] size-4"},null,-1)])),_:1},8,["aria-label"])),[[se,r.value,void 0,{top:!0}]]):V("",!0)])):t.state!=="running"?(d(),T("div",$f,[ve(Y.$slots,"secondary",{},()=>[$e(R(t.rightText),1)])])):V("",!0)]),_:3}),t.state==="running"&&G.value?de((d(),U(X,{key:0,variant:"destructive",size:"icon","aria-label":y(a)("g.cancel"),onClick:Ce(K,["stop"])},{default:E(()=>oe[8]||(oe[8]=[c("i",{class:"icon-[lucide--x] size-4"},null,-1)])),_:1},8,["aria-label"])),[[se,l.value,void 0,{top:!0}]]):V("",!0)])],32)],544)}}}),If={class:"flex flex-col gap-4 px-3 pb-4"},Mf={class:"text-[12px] leading-none text-text-secondary"},Pf=q({__name:"JobGroupsList",props:{displayedJobGroups:{}},emits:["cancelItem","deleteItem","menu","viewItem"],setup(e,{emit:o}){const t=e,s=o,a=n(k=>{s("cancelItem",k)},"emitCancelItem"),l=n(k=>{s("deleteItem",k)},"emitDeleteItem"),i=L(null),r=L(null),u=L(null),f=n(()=>{r.value!==null&&(clearTimeout(r.value),r.value=null)},"clearHideTimer"),m=n(()=>{u.value!==null&&(clearTimeout(u.value),u.value=null)},"clearShowTimer"),v=n(k=>{f(),m(),u.value=window.setTimeout(()=>{i.value=k,u.value=null},200)},"onDetailsEnter"),p=n(k=>{f(),m(),r.value=window.setTimeout(()=>{i.value===k&&(i.value=null),r.value=null},150)},"onDetailsLeave"),w=n(()=>{f(),m(),i.value=null},"resetActiveDetails");return ae(()=>t.displayedJobGroups,k=>{const g=i.value;if(!g)return;k.some(S=>S.items.some(_=>_.id===g))||w()}),rt(w),(k,g)=>(d(),T("div",If,[(d(!0),T(ne,null,be(k.displayedJobGroups,b=>(d(),T("div",{key:b.key,class:"flex flex-col gap-2"},[c("div",Mf,R(b.label),1),(d(!0),T(ne,null,be(b.items,S=>(d(),U(Nf,{key:S.id,"job-id":S.id,"workflow-id":S.taskRef?.workflow?.id,state:S.state,title:S.title,"right-text":S.meta,"icon-name":S.iconName,"icon-image-url":S.iconImageUrl,"show-clear":S.showClear,"show-menu":!0,"progress-total-percent":S.progressTotalPercent,"progress-current-percent":S.progressCurrentPercent,"running-node-name":S.runningNodeName,"active-details-id":i.value,onCancel:n(_=>a(S),"onCancel"),onDelete:n(_=>l(S),"onDelete"),onMenu:n(_=>k.$emit("menu",S,_),"onMenu"),onView:n(_=>k.$emit("viewItem",S),"onView"),onDetailsEnter:v,onDetailsLeave:p},null,8,["job-id","workflow-id","state","title","right-text","icon-name","icon-image-url","show-clear","progress-total-percent","progress-current-percent","running-node-name","active-details-id","onCancel","onDelete","onMenu","onView"]))),128))]))),128))]))}}),Df={class:"flex w-full flex-col gap-4"},Af={class:"flex items-center justify-between px-3"},Lf={class:"ml-4 inline-flex items-center"},Ef={class:"inline-flex h-6 items-center text-[12px] leading-none text-text-primary opacity-90"},Of={class:"font-bold"},Vf={class:"ml-1"},Rf={class:"flex-1 min-h-0 overflow-y-auto"},Wf=q({__name:"QueueOverlayExpanded",props:{headerTitle:{},showConcurrentIndicator:{type:Boolean},concurrentWorkflowCount:{},queuedCount:{},selectedJobTab:{},selectedWorkflowFilter:{},selectedSortMode:{},displayedJobGroups:{},hasFailedJobs:{type:Boolean}},emits:["showAssets","clearHistory","clearQueued","update:selectedJobTab","update:selectedWorkflowFilter","update:selectedSortMode","cancelItem","deleteItem","viewItem"],setup(e,{emit:o}){const t=o,{t:s}=pe(),a=L(null),l=L(null),{jobMenuEntries:i}=up(()=>a.value,v=>t("viewItem",v)),r=n(v=>{t("cancelItem",v)},"onCancelItemEvent"),u=n(v=>{t("deleteItem",v)},"onDeleteItemEvent"),f=n((v,p)=>{a.value=v,l.value?.open(p)},"onMenuItem"),m=n(async v=>{v.kind!=="divider"&&(v.onClick&&await v.onClick(),l.value?.hide())},"onJobMenuAction");return(v,p)=>(d(),T("div",Df,[F(hp,{"header-title":v.headerTitle,"show-concurrent-indicator":v.showConcurrentIndicator,"concurrent-workflow-count":v.concurrentWorkflowCount,onClearHistory:p[0]||(p[0]=w=>v.$emit("clearHistory"))},null,8,["header-title","show-concurrent-indicator","concurrent-workflow-count"]),c("div",Af,[F(X,{class:"grow gap-1 justify-center",variant:"secondary",size:"sm",onClick:p[1]||(p[1]=w=>v.$emit("showAssets"))},{default:E(()=>[p[7]||(p[7]=c("i",{class:"icon-[comfy--image-ai-edit] size-4"},null,-1)),c("span",null,R(y(s)("sideToolbar.queueProgressOverlay.showAssets")),1)]),_:1}),c("div",Lf,[c("div",Ef,[c("span",Of,R(v.queuedCount),1),c("span",Vf,R(y(s)("sideToolbar.queueProgressOverlay.queuedSuffix")),1)]),v.queuedCount>0?(d(),U(X,{key:0,class:"ml-2",variant:"destructive",size:"icon","aria-label":y(s)("sideToolbar.queueProgressOverlay.clearQueued"),onClick:p[2]||(p[2]=w=>v.$emit("clearQueued"))},{default:E(()=>p[8]||(p[8]=[c("i",{class:"icon-[lucide--list-x] size-4"},null,-1)])),_:1},8,["aria-label"])):V("",!0)])]),F(Bp,{"selected-job-tab":v.selectedJobTab,"selected-workflow-filter":v.selectedWorkflowFilter,"selected-sort-mode":v.selectedSortMode,"has-failed-jobs":v.hasFailedJobs,"onUpdate:selectedJobTab":p[3]||(p[3]=w=>v.$emit("update:selectedJobTab",w)),"onUpdate:selectedWorkflowFilter":p[4]||(p[4]=w=>v.$emit("update:selectedWorkflowFilter",w)),"onUpdate:selectedSortMode":p[5]||(p[5]=w=>v.$emit("update:selectedSortMode",w))},null,8,["selected-job-tab","selected-workflow-filter","selected-sort-mode","has-failed-jobs"]),c("div",Rf,[F(Pf,{"displayed-job-groups":v.displayedJobGroups,onCancelItem:r,onDeleteItem:u,onViewItem:p[6]||(p[6]=w=>v.$emit("viewItem",w)),onMenu:f},null,8,["displayed-job-groups"])]),F(wp,{ref_key:"jobContextMenuRef",ref:l,entries:y(i),onAction:m},null,8,["entries"])]))}}),zf={class:"w-[360px] rounded-2xl border border-interface-stroke bg-interface-panel-surface text-text-primary shadow-interface font-inter"},Bf={class:"flex items-center justify-between border-b border-interface-stroke px-4 py-4"},Ff={class:"m-0 text-[14px] font-normal leading-none"},Uf={class:"flex flex-col gap-4 px-4 py-4 text-[14px] text-text-secondary"},Gf={class:"m-0"},jf={class:"m-0"},Hf={class:"flex items-center justify-end px-4 py-4"},qf={class:"flex items-center gap-4 leading-none"},Kf=q({__name:"QueueClearHistoryDialog",setup(e){const o=vt(),t=Tt(),{t:s}=pe(),{wrapWithErrorHandlingAsync:a}=Ft(),l=L(!1),i=a(async()=>{await t.clear(["history"]),o.closeDialog()},void 0,()=>{l.value=!1}),r=n(async()=>{l.value||(l.value=!0,await i())},"onConfirm"),u=n(()=>{o.closeDialog()},"onCancel");return(f,m)=>(d(),T("section",zf,[c("header",Bf,[c("p",Ff,R(y(s)("sideToolbar.queueProgressOverlay.clearHistoryDialogTitle")),1),F(X,{size:"icon",variant:"muted-textonly","aria-label":y(s)("g.close"),onClick:u},{default:E(()=>m[0]||(m[0]=[c("i",{class:"icon-[lucide--x] block size-4 leading-none"},null,-1)])),_:1},8,["aria-label"])]),c("div",Uf,[c("p",Gf,R(y(s)("sideToolbar.queueProgressOverlay.clearHistoryDialogDescription")),1),c("p",jf,R(y(s)("sideToolbar.queueProgressOverlay.clearHistoryDialogAssetsNote")),1)]),c("footer",Hf,[c("div",qf,[F(X,{variant:"muted-textonly",size:"lg",onClick:u},{default:E(()=>[$e(R(y(s)("g.cancel")),1)]),_:1}),F(X,{variant:"secondary",size:"lg",disabled:l.value,onClick:r},{default:E(()=>[$e(R(y(s)("g.clear")),1)]),_:1},8,["disabled"])])])]))}}),Qf=n(()=>{const e=Tt(),o=Ze(),t=h(()=>e.runningTasks.length>0||!o.isIdle),s=L(null),a=L(null),l=L(null),i=n(()=>{l.value!==null&&(clearTimeout(l.value),l.value=null)},"clearDismissTimer"),r=n(()=>{i(),l.value=window.setTimeout(()=>{a.value=null,l.value=null},6e3)},"startDismissTimer"),u=n(()=>{a.value=null,i()},"clearSummary");return ae(t,(m,v)=>{if(!v&&m&&(s.value=Date.now()),v&&!m){const p=s.value??0,w=e.historyTasks.filter(_=>{const C=_.executionEndTimestamp;return typeof C=="number"&&C>=p});if(!w.length){a.value=null,i();return}let k=0,g=0;const b=[];for(const _ of w){const C=fs(_,!1);if(C==="completed"){k++;const x=_.previewOutput;x?.isImage&&b.push(x.urlWithTimestamp)}else C==="failed"&&g++}if(k===0&&g===0){a.value=null,i();return}let S="mixed";g===0?S="allSuccess":k===0&&(S="allFailed"),a.value={mode:S,completedCount:k,failedCount:g,thumbnailUrls:b.slice(0,3)},r()}},{immediate:!0}),{summary:h(()=>a.value),clearSummary:u}},"useCompletionSummary");function Jf(e){const o=L(-1),t=Je([]);return{galleryActiveIndex:o,galleryItems:t,onViewItem:n(a=>{const l=e().flatMap(u=>{const f=u.previewOutput;return f&&f.supportsPreview?[f]:[]});if(!l.length)return;t.value=l;const i=a.taskRef?.previewOutput?.url,r=i?l.findIndex(u=>u.url===i):0;o.value=r>=0?r:0},"onViewItem")}}n(Jf,"useResultGallery");const Yf={class:Q(["flex","justify-end","w-full","pointer-events-none"])},Xf=q({__name:"QueueProgressOverlay",props:{expanded:{type:Boolean},menuHovered:{type:Boolean,default:!1}},emits:["update:expanded"],setup(e,{emit:o}){const t=e,s=o,{t:a}=pe(),l=Tt(),i=_e(),r=Ze(),u=Ho(),f=vt(),m=Xn(),v=Oi(),{wrapWithErrorHandlingAsync:p}=Ft(),{totalPercentFormatted:w,currentNodePercentFormatted:k,totalProgressStyle:g,currentNodeProgressStyle:b}=bl(),S=L(!1),_=h(()=>S.value||t.menuHovered),C=L(!1),x=h({get:n(()=>t.expanded===void 0?C.value:t.expanded,"get"),set:n(Me=>{t.expanded===void 0&&(C.value=Me),s("update:expanded",Me)},"set")}),{summary:N,clearSummary:M}=Qf(),$=h(()=>N.value!==null),I=h(()=>l.runningTasks.length),P=h(()=>l.pendingTasks.length),z=h(()=>!r.isIdle),j=h(()=>I.value>0||z.value),D=h(()=>I.value+P.value),A=h(()=>x.value?"expanded":j.value?"active":$.value?"empty":"hidden"),B=h(()=>A.value==="expanded"||A.value==="empty"||A.value==="active"&&_.value),W=h(()=>A.value!=="hidden"),G=h(()=>B.value?"border-interface-stroke bg-interface-panel-surface shadow-interface":"border-transparent bg-transparent shadow-none"),H=h(()=>`flex items-center justify-end gap-4 transition-opacity duration-200 ease-in-out ${A.value==="active"&&_.value?"opacity-100 pointer-events-auto":"opacity-0 pointer-events-none"}`),K=h(()=>j.value?`${D.value} ${a("sideToolbar.queueProgressOverlay.activeJobsSuffix")}`:a("sideToolbar.queueProgressOverlay.jobQueue")),ee=h(()=>r.runningWorkflowCount),ie=h(()=>ee.value>1),{selectedJobTab:Y,selectedWorkflowFilter:oe,selectedSortMode:se,hasFailedJobs:Ne,filteredTasks:Ue,groupedJobItems:qe,currentNodeName:nt}=Np(),Ke=h(()=>qe.value),je=p(async Me=>{const te=Me.taskRef?.promptId;te&&(Me.state==="running"||Me.state==="initialization"?(await Se.interrupt(te),await l.update()):Me.state==="pending"&&(await Se.deleteItem("queue",te),await l.update()))}),yt=p(async Me=>{Me.taskRef&&await l.delete(Me.taskRef)}),{galleryActiveIndex:bt,galleryItems:po,onViewItem:jt}=Jf(()=>Ue.value),At=n(Me=>{x.value=Me},"setExpanded"),dt=n(()=>{At(!0)},"openExpandedFromEmpty"),Lt=n(()=>{At(!0)},"viewAllJobs"),wt=n(()=>{dt(),M()},"onSummaryClick"),st=n(()=>{u.activeSidebarTabId="assets"},"openAssetsSidebar"),fo=n(async Me=>{const te=Me.taskRef,Z=te?.promptId,kt=te?.previewOutput;if(!Z||!kt)return;const re=String(Z);if(st(),await Re(),await m.updateHistory(),!m.historyAssets.find(Wl=>Wl.id===re))throw new Error("Asset not found in media assets panel");v.setSelection([re])},"focusAssetInSidebar"),mo=p(async Me=>{jt(Me),await fo(Me)}),Ht=p(async()=>{await i.execute("Comfy.ClearPendingTasks")}),fe=p(async()=>{const te=l.runningTasks.map(Z=>Z.promptId).filter(Z=>typeof Z=="string"&&Z.length>0);te.length&&await Promise.all(te.map(Z=>Se.interrupt(Z)))}),xe=n(()=>{f.showDialog({key:"queue-clear-history",component:Kf,dialogComponentProps:{headless:!0,closable:!1,closeOnEscape:!0,dismissableMask:!0,pt:{root:{class:"max-w-[360px] w-auto bg-transparent border-none shadow-none"},content:{class:"!p-0 bg-transparent"}}}})},"showClearHistoryDialog"),Te=n(()=>{xe()},"onClearHistoryFromMenu");return(Me,te)=>(d(),T(ne,null,[de(c("div",Yf,[c("div",{class:Q(["pointer-events-auto flex w-[350px] min-w-[310px] max-h-[60vh] flex-col overflow-hidden rounded-lg border font-inter transition-colors duration-200 ease-in-out",G.value]),onMouseenter:te[3]||(te[3]=Z=>S.value=!0),onMouseleave:te[4]||(te[4]=Z=>S.value=!1)},[x.value?(d(),U(Wf,{key:0,"selected-job-tab":y(Y),"onUpdate:selectedJobTab":te[0]||(te[0]=Z=>it(Y)?Y.value=Z:null),"selected-workflow-filter":y(oe),"onUpdate:selectedWorkflowFilter":te[1]||(te[1]=Z=>it(oe)?oe.value=Z:null),"selected-sort-mode":y(se),"onUpdate:selectedSortMode":te[2]||(te[2]=Z=>it(se)?se.value=Z:null),class:"flex-1 min-h-0","header-title":K.value,"show-concurrent-indicator":ie.value,"concurrent-workflow-count":ee.value,"queued-count":P.value,"displayed-job-groups":Ke.value,"has-failed-jobs":y(Ne),onShowAssets:st,onClearHistory:Te,onClearQueued:y(Ht),onCancelItem:y(je),onDeleteItem:y(yt),onViewItem:y(mo)},null,8,["selected-job-tab","selected-workflow-filter","selected-sort-mode","header-title","show-concurrent-indicator","concurrent-workflow-count","queued-count","displayed-job-groups","has-failed-jobs","onClearQueued","onCancelItem","onDeleteItem","onViewItem"])):j.value?(d(),U(Qd,{key:1,"total-progress-style":y(g),"current-node-progress-style":y(b),"total-percent-formatted":y(w),"current-node-percent-formatted":y(k),"current-node-name":y(nt),"running-count":I.value,"queued-count":P.value,"bottom-row-class":H.value,onInterruptAll:y(fe),onClearQueued:y(Ht),onViewAllJobs:Lt},null,8,["total-progress-style","current-node-progress-style","total-percent-formatted","current-node-percent-formatted","current-node-name","running-count","queued-count","bottom-row-class","onInterruptAll","onClearQueued"])):y(N)?(d(),U(rp,{key:2,summary:y(N),onSummaryClick:wt},null,8,["summary"])):V("",!0)],34)],512),[[Qe,W.value]]),F(Vi,{"active-index":y(bt),"onUpdate:activeIndex":te[5]||(te[5]=Z=>it(bt)?bt.value=Z:null),"all-gallery-items":y(po)},null,8,["active-index","all-gallery-items"])],64))}}),Zf=Dt("actionBarButton",()=>{const e=os();return{buttons:h(()=>e.extensions.flatMap(t=>t.actionBarButtons??[]))}}),em={class:"flex h-full shrink-0 items-center gap-1"},tm={key:0},om=q({__name:"ActionBarButtons",setup(e){const o=Zf(),s=Xo(tn).smaller("sm");return(a,l)=>{const i=Ie("tooltip");return d(),T("div",em,[(d(!0),T(ne,null,be(y(o).buttons,(r,u)=>de((d(),U(X,{key:u,"aria-label":r.tooltip||r.label,class:Q([r.class,"h-7 rounded-full"]),variant:"muted-textonly",size:"sm",onClick:r.onClick},{default:E(()=>[c("i",{class:Q(r.icon)},null,2),!y(s)&&r.label?(d(),T("span",tm,R(r.label),1)):V("",!0)]),_:2},1032,["aria-label","class","onClick"])),[[i,r.tooltip,void 0,{bottom:!0}]])),128))])}}}),nm={class:"current-user-popover w-80 -m-3 p-2 rounded-lg border border-border-default bg-base-background shadow-[1px_1px_8px_0_rgba(0,0,0,0.4)]"},sm={class:"flex flex-col items-center px-0 py-3 mb-4"},am={class:"my-0 mb-1 truncate text-base font-bold text-base-foreground"},lm={key:0,class:"my-0 truncate text-sm text-muted"},im={key:1,class:"my-0 text-xs text-foreground bg-secondary-background-hover rounded-full uppercase px-2 py-0.5 font-bold mt-2"},rm={key:0,class:"flex items-center gap-2 px-4 py-2"},um={key:1,class:"text-base font-semibold text-base-foreground"},cm={class:"icon-[lucide--circle-help] cursor-help text-base text-muted-foreground mr-auto"},dm={key:1,class:"flex justify-center px-4"},pm={class:"text-sm text-base-foreground flex-1"},fm={class:"text-sm text-base-foreground flex-1"},mm={key:0,class:"text-xs font-bold text-base-background bg-base-foreground px-1.5 py-0.5 rounded-full"},gm={class:"text-sm text-base-foreground flex-1"},vm={class:"text-sm text-base-foreground flex-1"},hm={class:"text-sm text-base-foreground flex-1"},ym=q({__name:"CurrentUserPopover",emits:["close"],setup(e,{emit:o}){const t=o,{buildDocsUrl:s,docsPaths:a}=io(),{userDisplayName:l,userEmail:i,userPhotoUrl:r,handleSignOut:u}=ro(),f=qa(),m=Ka(),v=tt(),{isActiveSubscription:p,subscriptionTierName:w,subscriptionTier:k,fetchStatus:g}=es(),b=ud(),{locale:S}=pe(),_=h(()=>{const j=m.balance?.effective_balance_micros??m.balance?.amount_micros??0;return Ri({cents:j,locale:S.value,numberOptions:{minimumFractionDigits:0,maximumFractionDigits:2}})}),C=h(()=>{const j=k.value;return j==="FOUNDERS_EDITION"||j==="STANDARD"||j==="CREATOR"}),x=n(()=>{v.showSettingsDialog("user"),t("close")},"handleOpenUserSettings"),N=n(()=>{b.show(),t("close")},"handleOpenPlansAndPricing"),M=n(()=>{v.showSettingsDialog("credits"),t("close")},"handleOpenPlanAndCreditsSettings"),$=n(()=>{v.showTopUpCreditsDialog(),t("close")},"handleTopUp"),I=n(()=>{window.open(s(a.partnerNodesPricing,{includeLocale:!0}),"_blank"),t("close")},"handleOpenPartnerNodesInfo"),P=n(async()=>{await u(),t("close")},"handleLogout"),z=n(async()=>{await g()},"handleSubscribed");return Ve(()=>{f.fetchBalance()}),(j,D)=>{const A=Ie("tooltip");return d(),T("div",nm,[c("div",sm,[F(pl,{class:"mb-1","photo-url":y(r),"pt:icon:class":{"text-2xl!":!y(r)},size:"large"},null,8,["photo-url","pt:icon:class"]),c("h3",am,R(y(l)||j.$t("g.user")),1),y(i)?(d(),T("p",lm,R(y(i)),1)):V("",!0),y(w)?(d(),T("span",im,R(y(w)),1)):V("",!0)]),y(p)?(d(),T("div",rm,[D[0]||(D[0]=c("i",{class:"icon-[lucide--component] text-amber-400 text-sm"},null,-1)),y(m).isFetchingBalance?(d(),U(y(Jn),{key:0,width:"4rem",height:"1.25rem",class:"w-full"})):(d(),T("span",um,R(_.value),1)),de(c("i",cm,null,512),[[A,{value:j.$t("credits.unified.tooltip"),showDelay:300}]]),F(X,{variant:"secondary",size:"sm",class:"text-base-foreground","data-testid":"add-credits-button",onClick:$},{default:E(()=>[$e(R(j.$t("subscription.addCredits")),1)]),_:1})])):(d(),T("div",dm,[F(rd,{fluid:!1,label:j.$t("subscription.subscribeToComfyCloud"),size:"sm",variant:"gradient",onSubscribed:z},null,8,["label"])])),F(y(Is),{class:"my-2 mx-0"}),y(p)?(d(),T("div",{key:2,class:"flex items-center gap-2 px-4 py-2 cursor-pointer hover:bg-secondary-background-hover","data-testid":"partner-nodes-menu-item",onClick:I},[D[1]||(D[1]=c("i",{class:"icon-[lucide--tag] text-muted-foreground text-sm"},null,-1)),c("span",pm,R(j.$t("subscription.partnerNodesCredits")),1)])):V("",!0),c("div",{class:"flex items-center gap-2 px-4 py-2 cursor-pointer hover:bg-secondary-background-hover","data-testid":"plans-pricing-menu-item",onClick:N},[D[2]||(D[2]=c("i",{class:"icon-[lucide--receipt-text] text-muted-foreground text-sm"},null,-1)),c("span",fm,R(j.$t("subscription.plansAndPricing")),1),C.value?(d(),T("span",mm,R(j.$t("subscription.upgrade")),1)):V("",!0)]),y(p)?(d(),T("div",{key:3,class:"flex items-center gap-2 px-4 py-2 cursor-pointer hover:bg-secondary-background-hover","data-testid":"manage-plan-menu-item",onClick:M},[D[3]||(D[3]=c("i",{class:"icon-[lucide--file-text] text-muted-foreground text-sm"},null,-1)),c("span",gm,R(j.$t("subscription.managePlan")),1)])):V("",!0),c("div",{class:"flex items-center gap-2 px-4 py-2 cursor-pointer hover:bg-secondary-background-hover","data-testid":"user-settings-menu-item",onClick:x},[D[4]||(D[4]=c("i",{class:"icon-[lucide--settings-2] text-muted-foreground text-sm"},null,-1)),c("span",vm,R(j.$t("userSettings.accountSettings")),1)]),F(y(Is),{class:"my-2 mx-0"}),c("div",{class:"flex items-center gap-2 px-4 py-2 cursor-pointer hover:bg-secondary-background-hover","data-testid":"logout-menu-item",onClick:P},[D[5]||(D[5]=c("i",{class:"icon-[lucide--log-out] text-muted-foreground text-sm"},null,-1)),c("span",hm,R(j.$t("auth.signOut.signOut")),1)])])}}}),bm={class:"flex items-center gap-1 rounded-full hover:bg-interface-button-hover-surface"},wl=q({__name:"CurrentUserButton",setup(e){const{isLoggedIn:o,userPhotoUrl:t}=ro(),s=L(null),a=h(()=>t.value??void 0),l=n(()=>{s.value?.hide()},"closePopover");return(i,r)=>(d(),T("div",null,[y(o)?(d(),U(X,{key:0,class:"p-1 hover:bg-transparent",variant:"muted-textonly","aria-label":i.$t("g.currentUser"),onClick:r[0]||(r[0]=u=>s.value?.toggle(u))},{default:E(()=>[c("div",bm,[F(pl,{"photo-url":a.value},null,8,["photo-url"]),r[1]||(r[1]=c("i",{class:"icon-[lucide--chevron-down] size-3 px-1"},null,-1))])]),_:1},8,["aria-label"])):V("",!0),F(y(Ye),{ref_key:"popover",ref:s,"show-arrow":!1,pt:{root:{class:"rounded-lg"}}},{default:E(()=>[F(ym,{onClose:l})]),_:1},512)]))}}),wm={class:"mb-1"},km=["href"],kl=q({__name:"LoginButton",setup(e){const{isLoggedIn:o,handleSignIn:t}=ro(),{buildDocsUrl:s}=io(),a=s("/tutorials/api-nodes/overview#api-nodes",{includeLocale:!0}),l=L(null);let i=null,r=null;const u=n(v=>{i&&(clearTimeout(i),i=null),r&&(clearTimeout(r),r=null),r=setTimeout(()=>{l.value&&l.value.show(v,v.target)},200)},"showPopover"),f=n(()=>{i&&(clearTimeout(i),i=null)},"cancelHidePopover"),m=n(()=>{r&&(clearTimeout(r),r=null),i=setTimeout(()=>{l.value&&l.value.hide()},150)},"hidePopover");return(v,p)=>(d(),T(ne,null,[y(o)?V("",!0):(d(),U(X,{key:0,variant:"secondary",size:"icon",class:"rounded-full bg-secondary-background text-base-foreground hover:bg-secondary-background-hover","aria-label":y(ce)("g.login"),onClick:p[0]||(p[0]=w=>y(t)()),onMouseenter:u,onMouseleave:m},{default:E(()=>p[1]||(p[1]=[c("i",{class:"icon-[lucide--user] size-4"},null,-1)])),_:1},8,["aria-label"])),F(y(Ye),{ref_key:"popoverRef",ref:l,class:"p-2",onMouseout:m,onMouseover:f},{default:E(()=>[c("div",null,[c("div",wm,R(y(ce)("auth.loginButton.tooltipHelp")),1),c("a",{href:y(a),target:"_blank",class:"text-neutral-500 hover:text-primary"},R(y(ce)("auth.loginButton.tooltipLearnMore")),9,km)])]),_:1},512)],64))}}),oa=Sa.create({baseURL:Qa(),headers:{"Content-Type":"application/json"}}),Cm=n(()=>{const e=L(!1),o=L(null);ae(()=>Qa(),l=>{oa.defaults.baseURL=l});const t=n((l,i,r)=>{if(!Sa.isAxiosError(l))return l instanceof Error?`${i}: ${l.message}`:`${i}: Unknown error occurred`;const u=l;if(u.response){const{status:f,data:m}=u.response;if(r&&r[f])return r[f];switch(f){case 400:return`Bad request: ${m?.message||"Invalid input"}`;case 401:return"Unauthorized: Authentication required";case 403:return`Forbidden: ${m?.message||"Access denied"}`;case 404:return`Not found: ${m?.message||"Resource not found"}`;case 500:return`Server error: ${m?.message||"Internal server error"}`;default:return`${i}: ${m?.message||u.message}`}}return`${i}: ${u.message}`},"handleApiError"),s=n(async(l,i,r)=>{e.value=!0,o.value=null;try{return(await l()).data}catch(u){return Wi(u)||(o.value=t(u,i,r)),null}finally{e.value=!1}},"executeApiRequest");return{isLoading:e,error:o,getReleases:n(async(l,i)=>{const r="/releases";return await s(()=>oa.get(r,{params:l,signal:i}),"Failed to get releases",{400:"Invalid project or version parameter"})},"getReleases")}},"useReleaseService"),co=Dt("release",()=>{const e=L([]),o=L(!1),t=L(null),s=Cm(),a=ns(),l=ue(),i=h(()=>a?.systemStats?.system?.comfyui_version??""),r=h(()=>l.get("Comfy.Locale")),u=h(()=>l.get("Comfy.Release.Version")),f=h(()=>l.get("Comfy.Release.Status")),m=h(()=>l.get("Comfy.Release.Timestamp")),v=h(()=>l.get("Comfy.Notification.ShowVersionUpdates")),p=h(()=>e.value[0]??null),w=h(()=>e.value.slice(0,3)),k=4320*60*1e3,g=n((j,D)=>Vt.valid(j)&&Vt.valid(D)?Vt.compare(j,D):j===D?0:1,"compareVersions"),b=h(()=>!!p.value&&g(p.value.version,i.value||"0.0.0")>0),S=h(()=>!!p.value&&g(p.value.version,i.value||"0.0.0")===0),_=h(()=>{const j=p.value?.attention;return j==="medium"||j==="high"}),C=h(()=>!(!Ge()||mt||!v.value||!b.value||!_.value||u.value===p.value?.version&&["skipped","changelog seen"].includes(f.value))),x=h(()=>{if(!Ge()||mt||!v.value||!b.value)return!1;const{version:j}=p.value;return u.value===j&&f.value==="changelog seen"?!1:_.value?!0:!(u.value===j&&f.value==="skipped"&&m.value&&Date.now()-m.value>=k)}),N=h(()=>!(!Ge()&&!mt||!v.value||!p.value||!!Vt.valid(i.value)&&!S.value||u.value===p.value.version&&f.value==="what's new seen"));async function M(j){j!==p.value?.version||f.value==="changelog seen"||(await l.set("Comfy.Release.Version",j),await l.set("Comfy.Release.Status","skipped"),await l.set("Comfy.Release.Timestamp",Date.now()))}n(M,"handleSkipRelease");async function $(j){j===p.value?.version&&(await l.set("Comfy.Release.Version",j),await l.set("Comfy.Release.Status","changelog seen"),await l.set("Comfy.Release.Timestamp",Date.now()))}n($,"handleShowChangelog");async function I(j){j===p.value?.version&&(await l.set("Comfy.Release.Version",j),await l.set("Comfy.Release.Status","what's new seen"),await l.set("Comfy.Release.Timestamp",Date.now()))}n(I,"handleWhatsNewSeen");async function P(){if(!o.value&&v.value&&!a.systemStats?.system?.argv?.includes("--disable-api-nodes")){o.value=!0,t.value=null;try{a.systemStats||await _a(a.isInitialized);const j=await s.getReleases({project:mt?"cloud":"comfyui",current_version:i.value,form_factor:a.getFormFactor(),locale:zi(r.value)});j!==null?e.value=j:s.error.value&&(t.value=s.error.value)}catch(j){t.value=j instanceof Error?j.message:"Unknown error occurred"}finally{o.value=!1}}}n(P,"fetchReleases");async function z(){await P()}return n(z,"initialize"),{releases:e,isLoading:o,error:t,recentRelease:p,recentReleases:w,shouldShowToast:C,shouldShowRedDot:x,shouldShowPopup:N,shouldShowUpdateButton:b,handleSkipRelease:M,handleShowChangelog:$,handleWhatsNewSeen:I,fetchReleases:P,initialize:z}}),xm=Object.freeze(Object.defineProperty({__proto__:null,useReleaseStore:co},Symbol.toStringTag,{value:"Module"})),Sm={class:"min-w-0 flex-1"},_m={class:"mx-1 flex flex-col items-end gap-1"},Tm={class:"flex items-center gap-2"},$m={key:0,class:"pointer-events-auto flex h-12 shrink-0 items-center rounded-lg border border-interface-stroke bg-comfy-menu-bg px-2 shadow-interface"},Nm={key:0,class:"absolute top-0.5 right-1 size-2 rounded-full bg-red-500"},Im={class:"actionbar-container pointer-events-auto flex gap-2 h-12 items-center rounded-lg border border-interface-stroke bg-comfy-menu-bg px-2 shadow-interface"},Mm={key:0,class:"absolute -top-1 -right-1 min-w-[16px] rounded-full bg-primary-background py-0.25 text-[10px] font-medium leading-[14px] text-base-foreground"},Pm=q({__name:"TopMenuSection",setup(e){const o=ot(),t=so(),s=ft(),{isLoggedIn:a}=ro(),l=Ge(),{t:i}=pe(),{toastErrorHandler:r}=Ft(),u=_e(),f=Tt(),m=An(),{isOverlayExpanded:v}=Fe(m),p=co(),{shouldShowRedDot:w}=Fe(p),{shouldShowRedDot:k}=ss(),g=L(!1),b=h(()=>f.pendingTasks.length),S=h(()=>et(i("sideToolbar.queueProgressOverlay.viewJobHistory"))),_=h(()=>et(i("menu.customNodesManager"))),C=h(()=>w.value||k.value),{isOpen:x}=Fe(t),N=h(()=>et(i("rightSidePanel.togglePanel"))),M=L();Ve(()=>{M.value&&(J.menu.element.style.width="fit-content",M.value.appendChild(J.menu.element))});const $=n(()=>{u.execute("Comfy.Queue.ToggleOverlay")},"toggleQueueOverlay"),I=n(async()=>{try{await s.openManager({initialTab:Xt.All,showToastOnLegacyError:!1})}catch(P){try{r(P)}catch(z){console.error(P),console.error(z)}}},"openCustomNodeManager");return(P,z)=>{const j=Ie("tooltip");return y(o).focusMode?V("",!0):(d(),T("div",{key:0,class:"ml-1 flex gap-x-0.5 pt-1",onMouseenter:z[1]||(z[1]=D=>g.value=!0),onMouseleave:z[2]||(z[2]=D=>g.value=!1)},[c("div",Sm,[F(Md)]),c("div",_m,[c("div",Tm,[y(s).shouldShowManagerButtons.value?(d(),T("div",$m,[de((d(),U(X,{variant:"secondary",size:"icon","aria-label":y(i)("menu.customNodesManager"),class:"relative",onClick:I},{default:E(()=>[z[3]||(z[3]=c("i",{class:"icon-[lucide--puzzle] size-4"},null,-1)),C.value?(d(),T("span",Nm)):V("",!0)]),_:1},8,["aria-label"])),[[j,_.value,void 0,{bottom:!0}]])])):V("",!0),c("div",Im,[F(om),c("div",{ref_key:"legacyCommandsContainerRef",ref:M,class:"[&:not(:has(*>*:not(:empty)))]:hidden"},null,512),F(wd),de((d(),U(X,{type:"destructive",size:"icon","aria-pressed":y(v),"aria-label":y(i)("sideToolbar.queueProgressOverlay.expandCollapsedQueue"),onClick:$},{default:E(()=>[z[4]||(z[4]=c("i",{class:"icon-[lucide--history] size-4"},null,-1)),b.value>0?(d(),T("span",Mm,R(b.value),1)):V("",!0)]),_:1},8,["aria-pressed","aria-label"])),[[j,S.value,void 0,{bottom:!0}]]),y(a)?(d(),U(wl,{key:0,class:"shrink-0"})):y(l)?(d(),U(kl,{key:1})):V("",!0),y(x)?V("",!0):de((d(),U(X,{key:2,type:"secondary",size:"icon","aria-label":y(i)("rightSidePanel.togglePanel"),onClick:y(t).togglePanel},{default:E(()=>z[5]||(z[5]=[c("i",{class:"icon-[lucide--panel-right] size-4"},null,-1)])),_:1},8,["aria-label","onClick"])),[[j,N.value,void 0,{bottom:!0}]])])]),F(Xf,{expanded:y(v),"onUpdate:expanded":z[0]||(z[0]=D=>it(v)?v.value=D:null),"menu-hovered":g.value},null,8,["expanded","menu-hovered"])])],32))}}}),ms=q({__name:"ExtensionSlot",props:{extension:{}},setup(e){const o=e,t=n((s,a)=>{s.render(a)},"mountCustomExtension");return rt(()=>{o.extension.type==="custom"&&o.extension.destroy&&o.extension.destroy()}),(s,a)=>s.extension.type==="vue"?(d(),U(eo(s.extension.component),{key:0})):(d(),T("div",{key:1,ref:n(l=>{l&&t(o.extension,l)},"ref")},null,512))}}),Dm={class:"flex h-full flex-col"},Am={class:"flex w-full justify-between"},Lm={class:"tabs-container font-inter"},Em={class:"font-normal"},Om={class:"flex items-center gap-2"},Vm={class:"h-0 grow"},Rm=q({__name:"BottomPanel",setup(e){const o=ao(),t=tt(),{t:s}=pe(),a=h(()=>{const f=o.activeBottomPanelTabId;return f==="shortcuts-essentials"||f==="shortcuts-view-controls"}),l=n(f=>f!=="shortcuts-essentials"&&f!=="shortcuts-view-controls","shouldCapitalizeTab"),i=n(f=>{const m=f.titleKey?s(f.titleKey):f.title||"";return l(f.id)?m.toUpperCase():m},"getTabDisplayTitle"),r=n(async()=>{t.showSettingsDialog("keybinding")},"openKeybindingSettings"),u=n(()=>{o.activePanel=null},"closeBottomPanel");return(f,m)=>(d(),T("div",Dm,[(d(),U(y(fi),{key:f.$i18n.locale,value:y(o).activeBottomPanelTabId,"onUpdate:value":m[0]||(m[0]=v=>y(o).activeBottomPanelTabId=v),style:{"--p-tabs-tablist-background":"var(--comfy-menu-bg)"}},{default:E(()=>[F(y(mi),{"pt:tab-list":"border-none h-full flex items-center py-2 border-b-1 border-solid",class:"bg-transparent"},{default:E(()=>[c("div",Am,[c("div",Lm,[(d(!0),T(ne,null,be(y(o).bottomPanelTabs,v=>(d(),U(y(gi),{key:v.id,value:v.id,class:Q(["m-1 mx-2 border-none font-inter",{"tab-list-single-item":y(o).bottomPanelTabs.length===1}]),"pt:root":n(p=>({class:{"p-3 rounded-lg":!0,"pointer-events-none":y(o).bottomPanelTabs.length===1},style:{color:"var(--fg-color)",backgroundColor:!p.context.active||y(o).bottomPanelTabs.length===1?"":"var(--bg-color)"}}),"pt:root")},{default:E(()=>[c("span",Em,R(i(v)),1)]),_:2},1032,["value","class","pt:root"]))),128))]),c("div",Om,[a.value?(d(),U(X,{key:0,variant:"muted-textonly",size:"sm",onClick:r},{default:E(()=>[m[1]||(m[1]=c("i",{class:"pi pi-cog"},null,-1)),$e(" "+R(f.$t("shortcuts.manageShortcuts")),1)]),_:1})):V("",!0),F(X,{class:"justify-self-end",variant:"muted-textonly",size:"sm","aria-label":y(s)("g.close"),onClick:u},{default:E(()=>m[2]||(m[2]=[c("i",{class:"pi pi-times"},null,-1)])),_:1},8,["aria-label"])])])]),_:1})]),_:1},8,["value"])),c("div",Vm,[y(o).bottomPanelVisible&&y(o).activeBottomPanelTab?(d(),U(ms,{key:0,extension:y(o).activeBottomPanelTab},null,8,["extension"])):V("",!0)])]))}}),Wm=Ee(Rm,[["__scopeId","data-v-9d1ea2c9"]]);function Cl(e={}){const{useTransform:o=!1}=e,s=me().getCanvas(),{canvasPosToClientPos:a,update:l}=Bi(s.canvas,s),i=ue();ae([()=>i.get("Comfy.Sidebar.Location"),()=>i.get("Comfy.Sidebar.Size"),()=>i.get("Comfy.UseNewMenu")],()=>l(),{flush:"post"});const r=L({}),u=n(m=>{const{pos:v,size:p,scale:w=s.ds.scale}=m,[k,g]=a(v),[b,S]=p;return o?{position:"fixed",transformOrigin:"0 0",transform:`scale(${w})`,left:`${k}px`,top:`${g}px`,width:`${b}px`,height:`${S}px`}:{position:"fixed",left:`${k}px`,top:`${g}px`,width:`${b*w}px`,height:`${S*w}px`}},"computeStyle");return{style:r,updatePosition:n(m=>{r.value=u(m)},"updatePosition")}}n(Cl,"useAbsolutePosition");function zm(e,o){const t=Math.max(e.x,o.x),s=Math.max(e.y,o.y),a=Math.min(e.x+e.width,o.x+o.width),l=Math.min(e.y+e.height,o.y+o.height);return t>=a||s>=l?null:[t,s,a-t,l-s]}n(zm,"intersect");const Bm=n((e={})=>{const o=L({}),{margin:t=4}=e,s=n((l,i,r,u)=>{if(!r&&u){const{scale:f,offset:m}=u,v=zm({x:l.left-i.left,y:l.top-i.top,width:l.width,height:l.height},{x:(u.x+m[0]-t)*f,y:(u.y+m[1]-t)*f,width:(u.width+2*t)*f,height:(u.height+2*t)*f});if(!v)return"";const p=(v[0]-l.left+i.left)/f+"px",w=(v[1]-l.top+i.top)/f+"px",k=v[2]/f+"px",g=v[3]/f+"px";return`polygon(0% 0%, 0% 100%, ${p} 100%, ${p} ${w}, calc(${p} + ${k}) ${w}, calc(${p} + ${k}) calc(${w} + ${g}), ${p} calc(${w} + ${g}), ${p} 100%, 100% 100%, 100% 0%)`}return""},"calculateClipPath");return{style:o,updateClipPath:n((l,i,r,u)=>{const f=l.getBoundingClientRect(),m=i.getBoundingClientRect(),v=s(f,m,r,u);o.value={clipPath:v||"none",willChange:"clip-path"}},"updateClipPath")}},"useDomClipping"),Fm=["title"],Um=q({__name:"DomWidget",props:{widgetState:{}},emits:["update:widgetValue"],setup(e,{emit:o}){const t=e.widgetState.widget,s=o,a=L(),l=L({}),{style:i,updatePosition:r}=Cl({useTransform:!0}),{style:u,updateClipPath:f}=Bm(),m=me(),v=ue(),p=h(()=>v.get("Comfy.DOMClippingEnabled")),w=n(()=>{const C=m.canvas;if(!C||!a.value)return;const x=Object.values(C.selected_nodes??{})[0];if(!x){f(a.value,C.canvas,!1,void 0);return}const N=x===e.widgetState.widget.node,M=x?.renderArea,$=C.ds.offset,I=C.ds.scale,P=M?{x:M[0],y:M[1],width:M[2],height:M[3],scale:I,offset:[$[0],$[1]]}:void 0;f(a.value,C.canvas,N,P)},"updateDomClipping"),{left:k,top:g}=qn(m.getCanvas().canvas);ae([()=>e.widgetState,k,g],([C,x,N])=>{r(C),p.value&&w(),l.value={...i.value,...p.value?u.value:{},zIndex:C.zIndex,pointerEvents:C.readonly||t.computedDisabled?"none":"auto",opacity:t.computedDisabled?.5:1}},{deep:!0}),ae(()=>e.widgetState.visible,(C,x)=>{!C&&x&&t.options.onHide?.(t)}),Ae(document,"mousedown",C=>{!yo(t)||!e.widgetState.visible||!t.element.blur||t.element.contains(C.target)||t.element.blur()}),Ve(()=>{yo(t)&&Ae(t.element,t.options.selectOn??["focus","click"],()=>{const C=m.canvas;C?.selectNode(e.widgetState.widget.node),C?.bringToFront(e.widgetState.widget.node)})});const S=t.node.constructor.nodeData?.inputs?.[t.name]?.tooltip,_=n(()=>{e.widgetState.visible&&yo(t)&&a.value&&(a.value.contains(t.element)||a.value.appendChild(t.element))},"mountElementIfVisible");return Ve(()=>{Re(()=>{_()}).catch(C=>{console.error("Error mounting DOM widget element:",C)})}),ae(()=>e.widgetState.visible,()=>{_()}),(C,x)=>de((d(),T("div",{ref_key:"widgetElement",ref:a,class:"dom-widget",title:y(S),style:he(l.value)},[y(Ja)(y(t))?(d(),U(eo(y(t).component),Pt({key:0,"model-value":y(t).value,widget:y(t)},y(t).props,{"onUpdate:modelValue":x[0]||(x[0]=N=>s("update:widgetValue",N))}),null,16,["model-value","widget"])):V("",!0)],12,Fm)),[[Qe,C.widgetState.visible]])}}),Gm=Ee(Um,[["__scopeId","data-v-781496d2"]]),jm={class:"isolate"},Hm=q({__name:"DomWidgets",setup(e){const o=Fi(),t=h(()=>[...o.widgetStates.values()]),s=n(()=>{const l=a.canvas;if(!l)return;const i=l.low_quality,r=l.graph;for(const u of t.value){const f=u.widget;if(!f.isVisible()||!u.active){u.visible=!1;continue}const m=f.node,v=r?.nodes.includes(m);if(u.visible=!!v&&l.isNodeVisible(m)&&!(f.options.hideOnZoom&&i),u.visible&&m){const p=f.margin;u.pos=[m.pos[0]+p,m.pos[1]+p+f.y],u.size=[(f.width??m.width)-p*2,(f.computedHeight??50)-p*2],u.zIndex=l.graph?.nodes.indexOf(m)??-1,u.readonly=l.read_only}}},"updateWidgets"),a=me();return _t(()=>a.canvas,l=>l.onDrawForeground=to(l.onDrawForeground,s),{immediate:!0}),(l,i)=>(d(),T("div",jm,[(d(!0),T(ne,null,be(t.value,r=>(d(),U(Gm,{key:r.widget.id,"widget-state":r,"onUpdate:widgetValue":n(u=>r.widget.value=u,"onUpdate:widgetValue")},null,8,["widget-state","onUpdate:widgetValue"]))),128))]))}});function qm(){const e=L(!1),o=n(()=>{e.value=!0},"showModal"),t=n(()=>{e.value=!1},"hideModal"),s=n(()=>{e.value=!e.value},"toggleModal"),a=h(()=>e.value);return{isModalVisible:e,showModal:o,hideModal:t,toggleModal:s,hasActivePopup:a}}n(qm,"useZoomControls");function Km(e,o){const t=new Map,s=L(""),a=L(0),l=L({bounds:!1,nodes:!1,connections:!1,viewport:!1}),i=De.getVersion(),r=new Map,u=Kl(()=>{o()},500),f=n(()=>{const g=e.value;if(!g||r.has(g.id))return;const b={onNodeAdded:g.onNodeAdded,onNodeRemoved:g.onNodeRemoved,onConnectionChange:g.onConnectionChange,onTrigger:g.onTrigger};r.set(g.id,b),g.onNodeAdded=function(S){b.onNodeAdded?.call(this,S),u()},g.onNodeRemoved=function(S){b.onNodeRemoved?.call(this,S),t.delete(S.id),u()},g.onConnectionChange=function(S){b.onConnectionChange?.call(this,S),u()},g.onTrigger=function(S){b.onTrigger?.call(this,S),S.type==="node:property:changed"&&(S.property==="mode"||S.property==="bgcolor"||S.property==="color")&&(t.delete(String(S.nodeId)),u())}},"setupEventListeners"),m=n(g=>{const b=g||e.value;if(!b)return;const S=r.get(b.id);if(!S){console.error("Attempted to cleanup event listeners for graph that was never set up");return}b.onNodeAdded=S.onNodeAdded,b.onNodeRemoved=S.onNodeRemoved,b.onConnectionChange=S.onConnectionChange,b.onTrigger=S.onTrigger,r.delete(b.id)},"cleanupEventListeners");return{updateFlags:l,setupEventListeners:f,cleanupEventListeners:m,checkForChanges:n(()=>{const g=e.value;if(!g)return!1;let b=!1,S=!1,_=!1;const C=Ya.create(g),x=C.getNodeCount();x!==a.value&&(b=!0,a.value=x);const N=C.getNodes();for(const I of N){const P=I.id,z=`${I.x},${I.y},${I.width},${I.height}`;t.get(P)!==z&&(S=!0,t.set(P,z))}const M=new Set(N.map(I=>I.id));for(const[I]of t)M.has(I)||(t.delete(I),b=!0);const $=JSON.stringify(g.links||{});return $!==s.value&&(_=!0,s.value=$),(b||S)&&(l.value.bounds=!0,l.value.nodes=!0),_&&(l.value.connections=!0),b||S||_},"checkForChangesInternal"),init:n(()=>{f(),Se.addEventListener("graphChanged",u),ae(i,()=>{u()})},"init"),destroy:n(()=>{m(),Se.removeEventListener("graphChanged",u),t.clear()},"destroy"),clearCache:n(()=>{t.clear(),s.value="",a.value=0},"clearCache")}}n(Km,"useMinimapGraph");function Qm(e,o,t,s,a,l,i){const r=L(!1),u=L({left:0,top:0,width:s,height:a}),f=n(()=>{if(!e.value)return;const b=e.value.getBoundingClientRect();u.value={left:b.left,top:b.top,width:b.width,height:b.height}},"updateContainerRect"),m=n(b=>{r.value=!0,f();const S=b.currentTarget;S instanceof HTMLElement&&S.setPointerCapture(b.pointerId),v(b)},"handlePointerDown"),v=n(b=>{if(!r.value||!i.value)return;const S=b.clientX-u.value.left,_=b.clientY-u.value.top,C=(s-o.value.width*t.value)/2,x=(a-o.value.height*t.value)/2,N=(S-C)/t.value+o.value.minX,M=(_-x)/t.value+o.value.minY;l(N,M)},"handlePointerMove"),p=n(b=>{if(r.value=!1,!b)return;const S=b.currentTarget;S instanceof HTMLElement&&S.hasPointerCapture(b.pointerId)&&S.releasePointerCapture(b.pointerId)},"releasePointer");return{isDragging:r,containerRect:u,updateContainerRect:f,handlePointerDown:m,handlePointerMove:v,handlePointerUp:p,handlePointerCancel:p,handleWheel:n(b=>{b.preventDefault();const S=i.value;if(!S)return;u.value.left===0&&u.value.top===0&&e.value&&f();const _=S.ds,C=b.deltaY>0?.9:1.1,x=_.scale*C;if(x<.1||x>10)return;const $=b.clientX-u.value.left,I=b.clientY-u.value.top,P=(s-o.value.width*t.value)/2,z=(a-o.value.height*t.value)/2,j=($-P)/t.value+o.value.minX,D=(I-z)/t.value+o.value.minY;_.scale=x,l(j,D)},"handleWheel")}}n(Qm,"useMinimapInteraction");function Jm(e,o,t,s,a,l,i,r){const u=L(!0),f=L(!0),m=n(()=>{const w=o.value;if(!e.value||!w)return;const k=e.value.getContext("2d");if(!k)return;if(!w._nodes||w._nodes.length===0){k.clearRect(0,0,i,r);return}(u.value||a.value.nodes||a.value.connections)&&(Ui(e.value,w,{bounds:t.value,scale:s.value,settings:{nodeColors:l.nodeColors.value,showLinks:l.showLinks.value,showGroups:l.showGroups.value,renderBypass:l.renderBypass.value,renderError:l.renderError.value},width:i,height:r}),u.value=!1,a.value.nodes=!1,a.value.connections=!1)},"renderMinimap");return{needsFullRedraw:u,needsBoundsUpdate:f,renderMinimap:m,updateMinimap:n((w,k)=>{(f.value||a.value.bounds)&&(w(),f.value=!1,a.value.bounds=!1,u.value=!0,a.value.viewport=!0),(u.value||a.value.nodes||a.value.connections)&&m(),a.value.viewport&&(k(),a.value.viewport=!1)},"updateMinimap"),forceFullRedraw:n(()=>{u.value=!0,a.value.bounds=!0,a.value.nodes=!0,a.value.connections=!0,a.value.viewport=!0},"forceFullRedraw")}}n(Jm,"useMinimapRenderer");function Ym(){const e=ue(),o=ct(),t=h(()=>e.get("Comfy.Minimap.NodeColors")),s=h(()=>e.get("Comfy.Minimap.ShowLinks")),a=h(()=>e.get("Comfy.Minimap.ShowGroups")),l=h(()=>e.get("Comfy.Minimap.RenderBypassState")),i=h(()=>e.get("Comfy.Minimap.RenderErrorState")),r=253,u=200,f=h(()=>o.completedActivePalette.light_theme),m=h(()=>({width:`${r}px`,height:`${u}px`,border:"1px solid var(--interface-stroke)",borderRadius:"8px"})),v=h(()=>({width:"210px",height:`${u}px`,border:"1px solid var(--interface-stroke)",borderRadius:"8px"}));return{nodeColors:t,showLinks:s,showGroups:a,renderBypass:l,renderError:i,containerStyles:m,panelStyles:v,isLightTheme:f}}n(Ym,"useMinimapSettings");function Xm(e,o,t,s){const a=L({minX:0,minY:0,maxX:0,maxY:0,width:0,height:0}),l=L(1),i=L({x:0,y:0,width:0,height:0}),r=L({width:0,height:0}),u=n(()=>{const b=e.value;if(!b)return;const S=b.canvas,_=window.devicePixelRatio||1;r.value={width:S.clientWidth||S.width/_,height:S.clientHeight||S.height/_}},"updateCanvasDimensions"),f=n(()=>{const b=Ya.create(o.value);if(!b.hasData())return{minX:0,minY:0,maxX:100,maxY:100,width:100,height:100};const S=b.getBounds();return Gi(S)},"calculateGraphBounds"),m=n(()=>ji(a.value,t,s),"calculateScale"),v=n(()=>{const b=e.value;if(!b)return;(r.value.width===0||r.value.height===0)&&u();const S=b.ds,_=r.value.width/S.scale,C=r.value.height/S.scale,x=-S.offset[0],N=-S.offset[1],M=(t-a.value.width*l.value)/2,$=(s-a.value.height*l.value)/2;i.value={x:(x-a.value.minX)*l.value+M,y:(N-a.value.minY)*l.value+$,width:_*l.value,height:C*l.value}},"updateViewport"),p=n(()=>{a.value=f(),l.value=m()},"updateBounds"),w=n((b,S)=>{const _=e.value;if(!_)return;(r.value.width===0||r.value.height===0)&&u();const C=_.ds,x=r.value.width/C.scale,N=r.value.height/C.scale;C.offset[0]=-(b-x/2),C.offset[1]=-(S-N/2),_.setDirty(!0,!0)},"centerViewOn"),{resume:k,pause:g}=no(v);return{bounds:h(()=>a.value),scale:h(()=>l.value),viewportTransform:h(()=>i.value),canvasDimensions:h(()=>r.value),updateCanvasDimensions:u,updateViewport:v,updateBounds:p,centerViewOn:w,startViewportSync:k,stopViewportSync:g}}n(Xm,"useMinimapViewport");function gs({canvasRefMaybe:e,containerRefMaybe:o}={}){const t=me(),s=Le(),a=ue(),l=L(null),i=e??Je(null),r=o??Je(null),u=L(!0),f=L(!1),m=250,v=200,p=h(()=>t.canvas),w=h(()=>s.activeSubgraph||p.value?.graph),k=Ym(),{nodeColors:g,showLinks:b,showGroups:S,renderBypass:_,renderError:C,containerStyles:x,panelStyles:N}=k,M=n(async(K,ee)=>{await a.set(K,ee),z.forceFullRedraw(),z.updateMinimap($.updateBounds,$.updateViewport)},"updateOption"),$=Xm(p,w,m,v),I=Qm(r,$.bounds,$.scale,m,v,$.centerViewOn,p),P=Km(w,()=>{z.forceFullRedraw(),z.updateMinimap($.updateBounds,$.updateViewport)}),z=Jm(i,w,$.bounds,$.scale,P.updateFlags,k,m,v),{pause:j,resume:D}=no(async()=>{u.value&&await P.checkForChanges()&&z.updateMinimap($.updateBounds,$.updateViewport)},{immediate:!1}),A=n(async()=>{f.value||(u.value=a.get("Comfy.Minimap.Visible"),p.value&&w.value&&(P.init(),r.value&&I.updateContainerRect(),$.updateCanvasDimensions(),window.addEventListener("resize",I.updateContainerRect),window.addEventListener("scroll",I.updateContainerRect),window.addEventListener("resize",$.updateCanvasDimensions),z.forceFullRedraw(),z.updateMinimap($.updateBounds,$.updateViewport),$.updateViewport(),u.value&&(D(),$.startViewportSync()),f.value=!0))},"init"),B=n(()=>{j(),$.stopViewportSync(),P.destroy(),window.removeEventListener("resize",I.updateContainerRect),window.removeEventListener("scroll",I.updateContainerRect),window.removeEventListener("resize",$.updateCanvasDimensions),f.value=!1},"destroy");ae(p,async(K,ee)=>{ee&&(P.cleanupEventListeners(),j(),$.stopViewportSync(),P.destroy(),window.removeEventListener("resize",I.updateContainerRect),window.removeEventListener("scroll",I.updateContainerRect),window.removeEventListener("resize",$.updateCanvasDimensions)),K&&!f.value&&await A()},{immediate:!0,flush:"post"}),ae(w,(K,ee)=>{K&&K!==ee&&(P.cleanupEventListeners(ee||void 0),P.setupEventListeners(),z.forceFullRedraw(),z.updateMinimap($.updateBounds,$.updateViewport))}),ae(u,async K=>{K?(r.value&&I.updateContainerRect(),$.updateCanvasDimensions(),z.forceFullRedraw(),await Re(),await Re(),z.updateMinimap($.updateBounds,$.updateViewport),$.updateViewport(),D(),$.startViewportSync()):(j(),$.stopViewportSync())});const W=n(async()=>{u.value=!u.value,await a.set("Comfy.Minimap.Visible",u.value)},"toggle"),G=n(K=>{l.value=K},"setMinimapRef"),H=h(()=>{const K=$.viewportTransform.value;return{transform:`translate(${K.x}px, ${K.y}px)`,width:`${K.width}px`,height:`${K.height}px`,border:`2px solid ${k.isLightTheme.value?"#E0E0E0":"#FFF"}`,backgroundColor:"rgba(255, 255, 255, 0.2)",willChange:"transform",backfaceVisibility:"hidden",perspective:"1000px",pointerEvents:"none"}});return{visible:h(()=>u.value),initialized:h(()=>f.value),containerStyles:x,viewportStyles:H,panelStyles:N,width:m,height:v,nodeColors:g,showLinks:b,showGroups:S,renderBypass:_,renderError:C,init:A,destroy:B,toggle:W,renderMinimap:z.renderMinimap,handlePointerDown:I.handlePointerDown,handlePointerMove:I.handlePointerMove,handlePointerUp:I.handlePointerUp,handlePointerCancel:I.handlePointerCancel,handleWheel:I.handleWheel,setMinimapRef:G,updateOption:M}}n(gs,"useMinimap");const Zm={class:"flex items-center gap-1 pr-0.5"},eg={class:"rounded-lg bg-interface-panel-selected-surface p-2 group-hover:bg-interface-button-hover-surface"},tg={class:"flex flex-col gap-1"},og={class:"flex items-center gap-2"},ng={class:"text-[9px] text-text-primary"},sg={class:"flex items-center gap-2"},ag={class:"text-[9px] text-text-primary"},lg=q({__name:"CanvasModeSelector",props:{buttonStyles:{}},setup(e){const o=L(),t=L(),s=_e(),a=me(),l=h(()=>a.canvas?.read_only??!1),i=h(()=>l.value?"icon-[lucide--hand]":"icon-[lucide--mouse-pointer-2]"),r=h(()=>s.formatKeySequence(s.getCommand("Comfy.Canvas.Unlock")).toUpperCase()),u=h(()=>s.formatKeySequence(s.getCommand("Comfy.Canvas.Lock")).toUpperCase()),f=n(p=>{const w=o.value?.$el||o.value;t.value?.toggle(p,w)},"toggle"),m=n(p=>{p==="select"&&l.value?s.execute("Comfy.Canvas.Unlock"):p==="hand"&&!l.value&&s.execute("Comfy.Canvas.Lock"),t.value?.hide()},"setMode"),v=h(()=>({root:{class:"absolute z-50 -translate-y-2"},content:{class:["mb-2 text-text-primary","shadow-lg border border-interface-stroke","bg-nav-background","rounded-lg","p-2 px-3","min-w-39","select-none"]}}));return(p,w)=>(d(),T(ne,null,[F(X,{ref_key:"buttonRef",ref:o,variant:"secondary",class:"group h-8 rounded-none! bg-comfy-menu-bg p-0 transition-none! hover:rounded-lg! hover:bg-interface-button-hover-surface!",style:he(p.buttonStyles),onClick:f},{default:E(()=>[c("div",Zm,[c("div",eg,[c("i",{class:Q([i.value,"block h-4 w-4"])},null,2)]),w[2]||(w[2]=c("i",{class:"icon-[lucide--chevron-down] block h-4 w-4 pr-1.5"},null,-1))])]),_:1},8,["style"]),F(y(Ye),{ref_key:"popover",ref:t,"auto-z-index":!0,"base-z-index":1e3,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:v.value},{default:E(()=>[c("div",tg,[c("div",{class:"flex cursor-pointer items-center justify-between px-3 py-2 text-sm hover:bg-node-component-surface-hovered",onClick:w[0]||(w[0]=k=>m("select"))},[c("div",og,[w[3]||(w[3]=c("i",{class:"icon-[lucide--mouse-pointer-2] h-4 w-4"},null,-1)),c("span",null,R(p.$t("graphCanvasMenu.select")),1)]),c("span",ng,R(r.value),1)]),c("div",{class:"flex cursor-pointer items-center justify-between rounded px-3 py-2 text-sm hover:bg-node-component-surface-hovered",onClick:w[1]||(w[1]=k=>m("hand"))},[c("div",sg,[w[4]||(w[4]=c("i",{class:"icon-[lucide--hand] h-4 w-4"},null,-1)),c("span",null,R(p.$t("graphCanvasMenu.hand")),1)]),c("span",ag,R(u.value),1)])])]),_:1},8,["pt"])],64))}}),ig={key:0,class:"absolute right-0 bottom-[62px] z-1300 flex w-[250px] justify-center border-0! bg-inherit!"},rg={class:"flex flex-col gap-1"},ug={class:"font-medium"},cg={class:"text-[9px] text-text-primary"},dg={class:"font-medium"},pg={class:"text-[9px] text-text-primary"},fg={class:"font-medium"},mg={class:"text-[9px] text-text-primary"},gg=q({__name:"ZoomControlsModal",props:{visible:{type:Boolean}},setup(e){const o=gs(),t=_e(),s=me(),{formatKeySequence:a}=_e(),l=e,i=L(null),r=n(b=>{const S=b.value;isNaN(S)||S<1||S>1e3||s.setAppZoomFromPercentage(S)},"applyZoom"),u=n(b=>{t.execute(b)},"executeCommand"),f=n(b=>{if(i.value)return;const S=n(()=>t.execute(b),"cmd");S(),i.value=window.setInterval(S,100)},"startRepeat"),m=n(()=>{i.value&&(clearInterval(i.value),i.value=null)},"stopRepeat"),v=h(()=>({...o.containerStyles.value,height:void 0,width:void 0})),p=h(()=>a(t.getCommand("Comfy.Canvas.ZoomIn"))),w=h(()=>a(t.getCommand("Comfy.Canvas.ZoomOut"))),k=h(()=>a(t.getCommand("Comfy.Canvas.FitView"))),g=L(null);return ae(()=>l.visible,async b=>{b&&(await Re(),g.value?.querySelector("input")?.focus())}),(b,S)=>b.visible?(d(),T("div",ig,[c("div",{class:"w-4/5 rounded-lg border border-interface-stroke bg-interface-panel-surface p-2 text-text-primary shadow-lg select-none",style:he(v.value),onClick:S[3]||(S[3]=Ce(()=>{},["stop"]))},[c("div",rg,[c("div",{class:"flex cursor-pointer items-center justify-between rounded px-3 py-2 text-sm hover:bg-node-component-surface-hovered",onMousedown:S[0]||(S[0]=_=>f("Comfy.Canvas.ZoomIn")),onMouseup:m,onMouseleave:m},[c("span",ug,R(b.$t("graphCanvasMenu.zoomIn")),1),c("span",cg,R(p.value),1)],32),c("div",{class:"flex cursor-pointer items-center justify-between rounded px-3 py-2 text-sm hover:bg-node-component-surface-hovered",onMousedown:S[1]||(S[1]=_=>f("Comfy.Canvas.ZoomOut")),onMouseup:m,onMouseleave:m},[c("span",dg,R(b.$t("graphCanvasMenu.zoomOut")),1),c("span",pg,R(w.value),1)],32),c("div",{class:"flex cursor-pointer items-center justify-between rounded px-3 py-2 text-sm hover:bg-node-component-surface-hovered",onClick:S[2]||(S[2]=_=>u("Comfy.Canvas.FitView"))},[c("span",fg,R(b.$t("zoomControls.zoomToFit")),1),c("span",mg,R(k.value),1)]),c("div",{ref_key:"zoomInputContainer",ref:g,class:"zoomInputContainer flex items-center gap-1 rounded bg-input-surface p-2"},[F(y(vi),{"default-value":y(s).appScalePercentage,min:1,max:1e3,"show-buttons":!1,"use-grouping":!1,unstyled:!0,"input-class":"bg-transparent border-none outline-hidden text-sm shadow-none my-0 w-full",fluid:"",onInput:r,onKeyup:Zt(r,["enter"])},null,8,["default-value"]),S[4]||(S[4]=c("span",{class:"flex-shrink-0 text-sm text-text-primary"},"%",-1))],512)])],4)])):V("",!0)}}),vg={class:"inline-flex items-center gap-1 px-2 text-xs"},hg=q({__name:"GraphCanvasMenu",setup(e){const{t:o}=pe(),t=_e(),{formatKeySequence:s}=_e(),a=me(),l=ue(),i=uo(),r=gs(),{isModalVisible:u,toggleModal:f,hideModal:m,hasActivePopup:v}=qm(),p=h(()=>{const P=["borderRadius"],z=["borderRadius"],j={border:"none"},D=r.containerStyles.value,A={...Object.fromEntries(Object.entries(D).filter(([W])=>z.includes(W))),...j},B=Object.entries(D).filter(([W])=>P.includes(W)).reduce((W,[G,H])=>({...W,[G]:H}),{});return{buttonStyles:A,buttonGroupStyles:B}}),w=h(()=>l.get("Comfy.LinkRenderMode")===ge.HIDDEN_LINK),k=h(()=>s(t.getCommand("Comfy.Canvas.FitView")).toUpperCase()),g=h(()=>s(t.getCommand("Comfy.Canvas.ToggleMinimap")).toUpperCase()),b=h(()=>["bg-comfy-menu-bg",u.value?"not-active:bg-interface-panel-selected-surface!":"","hover:bg-interface-button-hover-surface!","p-0","h-8","w-15"]),S=h(()=>({"bg-comfy-menu-bg":!0,"hover:bg-interface-button-hover-surface!":!0,"not-active:bg-interface-panel-selected-surface!":l.get("Comfy.Minimap.Visible"),"p-0":!0,"w-8":!0,"h-8":!0})),_=h(()=>{const P=o("graphCanvasMenu.fitView"),z=k.value;return z?`${P} (${z})`:P}),C=h(()=>{const P=l.get("Comfy.Minimap.Visible")?o("zoomControls.hideMinimap"):o("zoomControls.showMinimap"),z=g.value;return z?`${P} (${z})`:P}),x=h(()=>w.value?o("graphCanvasMenu.showLinks"):o("graphCanvasMenu.hideLinks")),N=h(()=>w.value?o("graphCanvasMenu.showLinks"):o("graphCanvasMenu.hideLinks")),M=h(()=>["bg-comfy-menu-bg",w.value?"not-active:bg-interface-panel-selected-surface!":"","hover:bg-interface-button-hover-surface!","p-0","w-8","h-8"]);Ve(()=>{a.initScaleSync()});const $=n(()=>{t.execute("Comfy.Canvas.ToggleMinimap")},"onMinimapToggleClick"),I=n(()=>{t.execute("Comfy.Canvas.ToggleLinkVisibility")},"onLinkVisibilityToggleClick");return rt(()=>{a.cleanupScaleSync()}),(P,z)=>{const j=Ie("tooltip");return d(),T("div",null,[F(gg,{visible:y(u),onClose:y(m)},null,8,["visible","onClose"]),y(v)?(d(),T("div",{key:0,class:"fixed inset-0 z-1200",onClick:z[0]||(z[0]=(...D)=>y(m)&&y(m)(...D))})):V("",!0),F(y(hi),{class:"absolute right-0 bottom-0 z-1200 flex-row gap-1 border-[1px] border-interface-stroke bg-comfy-menu-bg p-2",style:he({...p.value.buttonGroupStyles}),onWheel:y(i).handleWheel},{default:E(()=>[F(lg,{"button-styles":p.value.buttonStyles},null,8,["button-styles"]),z[6]||(z[6]=c("div",{class:"h-[27px] w-[1px] self-center bg-node-divider"},null,-1)),de((d(),U(X,{variant:"secondary","aria-label":_.value,style:he(p.value.buttonStyles),class:"h-8 w-8 bg-comfy-menu-bg p-0 hover:bg-interface-button-hover-surface!",onClick:z[1]||(z[1]=()=>y(t).execute("Comfy.Canvas.FitView"))},{default:E(()=>z[2]||(z[2]=[c("i",{class:"icon-[lucide--focus] h-4 w-4"},null,-1)])),_:1},8,["aria-label","style"])),[[j,_.value,void 0,{top:!0}]]),de((d(),U(X,{variant:"secondary",class:Q(b.value),"aria-label":y(o)("zoomControls.label"),"data-testid":"zoom-controls-button",style:he(p.value.buttonStyles),onClick:y(f)},{default:E(()=>[c("span",vg,[c("span",null,R(y(a).appScalePercentage)+"%",1),z[3]||(z[3]=c("i",{class:"icon-[lucide--chevron-down] h-4 w-4"},null,-1))])]),_:1},8,["class","aria-label","style","onClick"])),[[j,y(o)("zoomControls.label"),void 0,{top:!0}]]),z[7]||(z[7]=c("div",{class:"h-[27px] w-[1px] self-center bg-node-divider"},null,-1)),de((d(),U(X,{variant:"secondary","aria-label":C.value,"data-testid":"toggle-minimap-button",style:he(p.value.buttonStyles),class:Q(S.value),onClick:$},{default:E(()=>z[4]||(z[4]=[c("i",{class:"icon-[lucide--map] h-4 w-4"},null,-1)])),_:1},8,["aria-label","style","class"])),[[j,C.value,void 0,{top:!0}]]),de((d(),U(X,{variant:"secondary",class:Q(M.value),"aria-label":N.value,"data-testid":"toggle-link-visibility-button",style:he(p.value.buttonStyles),onClick:I},{default:E(()=>z[5]||(z[5]=[c("i",{class:"icon-[lucide--route-off] h-4 w-4"},null,-1)])),_:1},8,["class","aria-label","style"])),[[j,{value:x.value,pt:{root:{style:"z-index: 2; transform: translateY(-20px);"}}},void 0,{top:!0}]])]),_:1},8,["style","onWheel"])])}}}),yg=q({__name:"NodeTooltip",setup(e){let o;const t=ht(),s=ue(),a=L(),l=L(""),i=L(),r=L();function u(){return l.value=""}n(u,"hideTooltip");async function f(p){if(!p)return;i.value=J.canvas.mouse[0]+"px",r.value=J.canvas.mouse[1]+"px",l.value=p,await Re();const w=a.value?.getBoundingClientRect();w&&(w.right>window.innerWidth&&(i.value=J.canvas.mouse[0]-w.width+"px"),w.top<0&&(r.value=J.canvas.mouse[1]+w.height+"px"))}n(f,"showTooltip");function m(){const{canvas:p}=J,w=p?.node_over;if(!w)return;const k=w.constructor,g=t.nodeDefsByName[w.type??""];if(k.title_mode!==ge.NO_TITLE&&p.graph_mouse[1]<w.pos[1])return f(g?.description);if(w.flags?.collapsed)return;const b=Hi(w,p.graph_mouse[0],p.graph_mouse[1],[0,0]);if(b!==-1){const C=w.inputs[b].name,x=we(`nodeDefs.${We(w.type??"")}.inputs.${We(C)}.tooltip`,g?.inputs[C]?.tooltip??"");return f(x)}const S=qi(w,p.graph_mouse[0],p.graph_mouse[1],[0,0]);if(S!==-1){const C=we(`nodeDefs.${We(w.type??"")}.outputs.${S}.tooltip`,g?.outputs[S]?.tooltip??"");return f(C)}const _=J.canvas.getWidgetAtCursor();if(_&&!yo(_)){const C=we(`nodeDefs.${We(w.type??"")}.inputs.${We(_.name)}.tooltip`,g?.inputs[_.name]?.tooltip??"");return f(_.tooltip??C)}}return n(m,"onIdle"),Ae(window,"mousemove",n(p=>{u(),clearTimeout(o),p.target.nodeName==="CANVAS"&&(o=window.setTimeout(m,s.get("LiteGraph.Node.TooltipDelay")))},"onMouseMove")),Ae(window,"click",u),(p,w)=>l.value?(d(),T("div",{key:0,ref_key:"tooltipRef",ref:a,class:"node-tooltip",style:he({left:i.value,top:r.value})},R(l.value),5)):V("",!0)}}),bg=Ee(yg,[["__scopeId","data-v-96b1458a"]]),wg=q({__name:"BypassButton",setup(e){const o=_e(),t=n(async()=>{await o.execute("Comfy.Canvas.ToggleSelectedNodes.Bypass")},"toggleBypass");return(s,a)=>{const l=Ie("tooltip");return de((d(),U(X,{variant:"muted-textonly","aria-label":s.$t("commands.Comfy_Canvas_ToggleSelectedNodes_Bypass.label"),"data-testid":"bypass-button",class:"hover:bg-secondary-background",onClick:t},{default:E(()=>a[0]||(a[0]=[c("i",{class:"icon-[lucide--redo-dot] size-4"},null,-1)])),_:1},8,["aria-label"])),[[l,{value:s.$t("commands.Comfy_Canvas_ToggleSelectedNodes_Bypass.label"),showDelay:1e3},void 0,{top:!0}]])}}}),kg={class:"relative"},Cg={class:"flex items-center gap-1 px-0"},xg={key:0,class:"color-picker-container absolute -top-10 left-1/2"},Sg=["data-testid"],_g=q({__name:"ColorPickerButton",setup(e){const{t:o}=pe(),t=me(),s=ct(),a=Le(),l=h(()=>s.completedActivePalette.light_theme),i=n(b=>Rt(b,{lightness:.5}),"toLightThemeColor"),r=L(!1),u={name:"noColor",localizedName:o("color.noColor"),value:{dark:ge.NODE_DEFAULT_BGCOLOR,light:i(ge.NODE_DEFAULT_BGCOLOR)}},f=[u,...Object.entries(He.node_colors).map(([b,S])=>({name:b,localizedName:o(`color.${b}`),value:{dark:S.bgcolor,light:i(S.bgcolor)}}))],m=L(null),v=n(b=>{const S=b?.name??u.name,_=S===u.name?null:He.node_colors[S];for(const C of t.selectedItems)Ro(C)&&C.setColorOption(_);t.canvas?.setDirty(!0,!0),p.value=_,r.value=!1,a.activeWorkflow?.changeTracker.checkState()},"applyColor"),p=L(null),w=h(()=>p.value?l.value?i(p.value?.bgcolor):p.value?.bgcolor:null),k=h(()=>p.value?.bgcolor?f.find(S=>S.value.dark===p.value?.bgcolor||S.value.light===p.value?.bgcolor)?.localizedName??u.localizedName:null),g=n(b=>{r.value=!1,m.value=null,p.value=Ki(b)},"updateColorSelectionFromNode");return ae(()=>t.selectedItems,b=>{g(b)},{immediate:!0}),(b,S)=>{const _=Ie("tooltip");return d(),T("div",kg,[de((d(),U(X,{"data-testid":"color-picker-button",variant:"muted-textonly","aria-label":y(o)("g.color"),onClick:S[0]||(S[0]=()=>r.value=!r.value)},{default:E(()=>[c("div",Cg,[c("i",{class:"pi pi-circle-fill",style:he({color:w.value??""})},null,4),S[1]||(S[1]=c("i",{class:"icon-[lucide--chevron-down]"},null,-1))])]),_:1},8,["aria-label"])),[[_,{value:k.value??y(o)("color.noColor"),showDelay:1e3},void 0,{top:!0}]]),r.value?(d(),T("div",xg,[F(y(Ra),{"model-value":m.value,options:f,"option-label":"name","data-key":"value","onUpdate:modelValue":v},{option:E(({option:C})=>[de(c("i",{class:"pi pi-circle-fill",style:he({color:l.value?C.value.light:C.value.dark}),"data-testid":C.name},null,12,Sg),[[_,C.localizedName,void 0,{top:!0}]])]),_:1},8,["model-value"])])):V("",!0)])}}}),Tg=Ee(_g,[["__scopeId","data-v-2197e0a1"]]),$g=q({__name:"ConfigureSubgraph",setup(e){const o=so(),t=n(()=>{o.openPanel("subgraph")},"handleClick");return(s,a)=>{const l=Ie("tooltip");return de((d(),U(X,{variant:"muted-textonly","aria-label":s.$t("commands.Comfy_Graph_EditSubgraphWidgets.label"),onClick:t},{default:E(()=>a[0]||(a[0]=[c("i",{class:"icon-[lucide--settings-2]"},null,-1)])),_:1},8,["aria-label"])),[[l,{value:s.$t("commands.Comfy_Graph_EditSubgraphWidgets.label"),showDelay:1e3},void 0,{top:!0}]])}}}),Ng=q({__name:"ConvertToSubgraphButton",setup(e){const o=_e(),{isSingleSubgraph:t,hasAnySelection:s}=Ut(),a=t,l=h(()=>s.value&&!t.value);return(i,r)=>{const u=Ie("tooltip");return y(a)?de((d(),U(X,{key:0,variant:"muted-textonly","aria-label":i.$t("commands.Comfy_Graph_UnpackSubgraph.label"),"data-testid":"convert-to-subgraph-button",onClick:r[0]||(r[0]=()=>y(o).execute("Comfy.Graph.UnpackSubgraph"))},{default:E(()=>r[2]||(r[2]=[c("i",{class:"icon-[lucide--expand] size-4"},null,-1)])),_:1},8,["aria-label"])),[[u,{value:i.$t("commands.Comfy_Graph_UnpackSubgraph.label"),showDelay:1e3},void 0,{top:!0}]]):l.value?de((d(),U(X,{key:1,variant:"muted-textonly",size:"icon","aria-label":i.$t("commands.Comfy_Graph_ConvertToSubgraph.label"),"data-testid":"convert-to-subgraph-button",onClick:r[1]||(r[1]=()=>y(o).execute("Comfy.Graph.ConvertToSubgraph"))},{default:E(()=>r[3]||(r[3]=[c("i",{class:"icon-[lucide--shrink] size-4"},null,-1)])),_:1},8,["aria-label"])),[[u,{value:i.$t("commands.Comfy_Graph_ConvertToSubgraph.label"),showDelay:1e3},void 0,{top:!0}]]):V("",!0)}}}),Ig=q({__name:"DeleteButton",setup(e){const o=_e(),{selectedItems:t}=Ut(),s=h(()=>t.value.some(a=>a.removable!==!1));return(a,l)=>{const i=Ie("tooltip");return de((d(),U(X,{variant:"muted-textonly","aria-label":a.$t("commands.Comfy_Canvas_DeleteSelectedItems.label"),"data-testid":"delete-button",onClick:l[0]||(l[0]=()=>y(o).execute("Comfy.Canvas.DeleteSelectedItems"))},{default:E(()=>l[1]||(l[1]=[c("i",{class:"icon-[lucide--trash-2]"},null,-1)])),_:1},8,["aria-label"])),[[Qe,s.value],[i,{value:a.$t("commands.Comfy_Canvas_DeleteSelectedItems.label"),showDelay:1e3},void 0,{top:!0}]])}}}),Mg=q({__name:"ExecuteButton",setup(e){const{t:o}=pe(),t=_e(),s=me(),{selectedNodes:a}=Ut(),l=s.getCanvas(),i=L(!1),r=h(()=>a.value.filter(oo).filter(Qi));function u(){if(this.selected&&this.constructor.nodeData?.output_node&&i.value)return{color:"orange",lineWidth:2,padding:10}}n(u,"outputNodeStokeStyle");const f=n(()=>{i.value=!0;for(const p of r.value)p.strokeStyles.outputNode=u;l.setDirty(!0)},"handleMouseEnter"),m=n(()=>{i.value=!1,l.setDirty(!0)},"handleMouseLeave"),v=n(async()=>{await t.execute("Comfy.QueueSelectedOutputNodes")},"handleClick");return(p,w)=>{const k=Ie("tooltip");return de((d(),U(X,{variant:"primary","aria-label":y(o)("selectionToolbox.executeButton.tooltip"),onMouseenter:w[0]||(w[0]=()=>f()),onMouseleave:w[1]||(w[1]=()=>m()),onClick:v},{default:E(()=>w[2]||(w[2]=[c("i",{class:"icon-[lucide--play]"},null,-1)])),_:1},8,["aria-label"])),[[k,{value:y(o)("selectionToolbox.executeButton.tooltip"),showDelay:1e3},void 0,{top:!0}]])}}}),Pg=q({__name:"ExtensionCommandButton",props:{command:{}},setup(e){const o=_e();return(t,s)=>{const a=Ie("tooltip");return de((d(),U(X,{variant:"muted-textonly","aria-label":y(we)(`commands.${y(We)(t.command.id)}.label`,""),onClick:s[0]||(s[0]=()=>y(o).execute(t.command.id))},{default:E(()=>[c("i",{class:Q([typeof t.command.icon=="function"?t.command.icon():t.command.icon])},null,2)]),_:1},8,["aria-label"])),[[a,{value:y(we)(`commands.${y(We)(t.command.id)}.label`,"")||void 0,showDelay:1e3},void 0,{top:!0}]])}}}),Dg=q({__name:"InfoButton",setup(e){const o=so(),t=n(()=>{o.openPanel("info")},"onInfoClick");return(s,a)=>{const l=Ie("tooltip");return de((d(),U(X,{"data-testid":"info-button",variant:"muted-textonly","aria-label":s.$t("g.info"),onClick:t},{default:E(()=>a[0]||(a[0]=[c("i",{class:"icon-[lucide--info]"},null,-1)])),_:1},8,["aria-label"])),[[l,{value:s.$t("g.info"),showDelay:1e3},void 0,{top:!0}]])}}}),Ag=q({__name:"Load3DViewerButton",setup(e){const o=_e(),t=n(()=>{o.execute("Comfy.3DViewer.Open3DViewer")},"open3DViewer");return(s,a)=>{const l=Ie("tooltip");return de((d(),U(X,{variant:"muted-textonly","aria-label":s.$t("commands.Comfy_3DViewer_Open3DViewer.label"),onClick:t},{default:E(()=>a[0]||(a[0]=[c("i",{class:"icon-[lucide--pencil]"},null,-1)])),_:1},8,["aria-label"])),[[l,{value:s.$t("commands.Comfy_3DViewer_Open3DViewer.label"),showDelay:1e3},void 0,{top:!0}]])}}}),Lg=q({__name:"MaskEditorButton",setup(e){const o=_e(),{isSingleImageNode:t}=Ut(),s=n(()=>{o.execute("Comfy.MaskEditor.OpenMaskEditor")},"openMaskEditor");return(a,l)=>{const i=Ie("tooltip");return de((d(),U(X,{variant:"muted-textonly","aria-label":a.$t("commands.Comfy_MaskEditor_OpenMaskEditor.label"),onClick:s},{default:E(()=>l[0]||(l[0]=[c("i",{class:"icon-[comfy--mask]"},null,-1)])),_:1},8,["aria-label"])),[[Qe,y(t)],[i,{value:a.$t("commands.Comfy_MaskEditor_OpenMaskEditor.label"),showDelay:1e3},void 0,{top:!0}]])}}}),Eg=n(e=>e!=null&&typeof e=="object"&&"refresh"in e&&typeof e.refresh=="function","isRefreshableWidget"),Og=n(()=>{const e=me(),o=L([]);ke(()=>{o.value=e.selectedItems.filter(oo)});const t=h(()=>o.value.flatMap(l=>{if(!l.widgets)return[];const i=[];for(const r of l.widgets)Eg(r)&&i.push(r);return i})),s=h(()=>t.value.length>0);async function a(){s.value&&await Promise.all(t.value.map(l=>l.refresh()))}return n(a,"refreshSelected"),{isRefreshable:s,refreshSelected:a}},"useRefreshableSelection"),Vg=q({__name:"RefreshSelectionButton",setup(e){const{t:o}=pe(),{isRefreshable:t,refreshSelected:s}=Og();return(a,l)=>{const i=Ie("tooltip");return de((d(),U(X,{variant:"muted-textonly","aria-label":y(o)("g.refreshNode"),"data-testid":"refresh-button",onClick:y(s)},{default:E(()=>l[0]||(l[0]=[c("i",{class:"icon-[lucide--refresh-cw]"},null,-1)])),_:1},8,["aria-label","onClick"])),[[Qe,y(t)],[i,y(o)("g.refreshNode"),void 0,{top:!0}]])}}}),Rg=q({__name:"SaveToSubgraphLibrary",setup(e){const o=_e(),t=me(),s=h(()=>t.selectedItems?.length===1&&t.selectedItems[0]instanceof as);return(a,l)=>{const i=Ie("tooltip");return de((d(),U(X,{variant:"muted-textonly","aria-label":a.$t("commands.Comfy_PublishSubgraph.label"),onClick:l[0]||(l[0]=()=>y(o).execute("Comfy.PublishSubgraph"))},{default:E(()=>l[1]||(l[1]=[c("i",{class:"icon-[lucide--book-open]"},null,-1)])),_:1},8,["aria-label"])),[[Qe,s.value],[i,{value:a.$t("commands.Comfy_PublishSubgraph.label"),showDelay:1e3},void 0,{top:!0}]])}}}),vo=L(!1),Wg=L(0),zg=L(0),at=L(!1);let Ot=!1,lt=null;function Wo(e){const o=e.canvas;if(!o)return null;const t=Array.from(o.selectedItems);if(t.length!==1)return null;const s=t[0];return oo(s)?`N:${s.id}`:is(s)?`G:${s.id}`:null}n(Wo,"buildSelectionSignature");function Bg(e){return lt?Wo(e)===lt:!1}n(Bg,"currentSelectionMatchesSignature");function Fg(e){const o=me(),t=o.getCanvas(),{getSelectableItems:s}=ls(),{shouldRenderVueNodes:a}=qo(),l=L({x:0,y:0}),i=L(!1),{left:r,top:u}=qn(t.canvas),f=h(()=>{const S=o.canvas?.state?.draggingItems??!1,_=a.value&&De.isDraggingVueNodes.value;return S||_}),m=n(()=>{const S=s();if(!S.size){i.value=!1;return}if(f.value){i.value=!1;return}i.value=!0;const _=[];for(const x of S)if(x.id!=null)if(a.value&&typeof x.id=="string"){const N=De.getNodeLayoutRef(x.id).value;N&&_.push([N.bounds.x,N.bounds.y,N.bounds.width,N.bounds.height])}else(x instanceof gt||x instanceof Wt)&&_.push([x.pos[0],x.pos[1]-ge.NODE_TITLE_HEIGHT,x.size[0],x.size[1]+ge.NODE_TITLE_HEIGHT]);const C=Ji(_);C&&(l.value={x:C.x+C.width/2,y:C.y-10},v())},"updateSelectionBounds"),v=n(()=>{if(!i.value)return;const{scale:S,offset:_}=t.ds,C=(l.value.x+_[0])*S+r.value,x=(l.value.y+_[1])*S+u.value;e.value&&(e.value.style.setProperty("--tb-x",`${C}px`),e.value.style.setProperty("--tb-y",`${x}px`))},"updateTransform"),{resume:p,pause:w}=no(v);ke(()=>{i.value?p():w()}),ae(()=>o.getCanvas().state.selectionChanged,S=>{S&&((at.value||lt)&&(at.value=!1,Ot=!1,vo.value?lt=Wo(o):lt=null),m(),o.getCanvas().state.selectionChanged=!1)},{immediate:!0}),ae(()=>vo.value,S=>{S?lt=Wo(o):o.canvas?.state?.draggingItems||(lt=null,at.value&&(at.value=!1))});const k=n(S=>{if(S){g();return}b()},"handleDragStateChange"),g=n(()=>{if(i.value=!1,!vo.value){at.value=!1,Ot=!1;return}if(Wo(o)!==lt&&(lt=null),vo.value=!1,Ot=!0,at.value=!!lt,at.value){Wg.value++;return}Ot=!1},"handleDragStart"),b=n(()=>{requestAnimationFrame(()=>{m();const S=Bg(o),_=Ot&&i.value&&at.value&&S;at.value=_&&at.value,Ot=!1,_&&zg.value++})},"handleDragEnd");return ae(f,k),ut(()=>{Ug()}),{visible:i}}n(Fg,"useSelectionToolboxPosition");function Ug(){vo.value=!1,at.value=!1,Ot=!1,lt=null}n(Ug,"resetMoreOptionsState");const Gg=new Set(["Properties","Colors","Shapes","Title","Mode","Properties Panel","Copy (Clipspace)"]),jg=new Set(["Rename","Copy","Duplicate","Clone","Run Branch","Pin","Unpin","Bypass","Remove Bypass","Mute","Convert to Subgraph","Frame selection","Minimize Node","Expand","Collapse","Node Info","Resize","Title","Properties Panel","Adjust Size","Color","Colors","Shape","Shapes","Mode","Open Image","Copy Image","Save Image","Open in Mask Editor","Edit Subgraph Widgets","Unpack Subgraph","Copy (Clipspace)","Paste (Clipspace)","Align Selected To","Distribute Nodes","Delete","Remove","Show Advanced","Hide Advanced"]);function na(e){return e.toLowerCase().replace(/^un/,"").trim()}n(na,"normalizeLabel");function Hg(e,o){const t=na(e),s={color:["color","colors"],shape:["shape","shapes"],pin:["pin","unpin"],delete:["remove","delete"],duplicate:["clone","duplicate"]};return o.some(a=>{if(!a.label)return!1;const l=na(a.label);if(l===t)return!0;for(const i of Object.values(s))if(i.includes(t)&&i.includes(l))return!0;return!1})}n(Hg,"isDuplicateItem");function qg(e){return jg.has(e)}n(qg,"isCoreMenuItem");function Kg(e){const o=new Map,t=[];for(const l of e){if(l.type==="divider"||l.type==="category"){t.push(l);continue}if(!l.label){t.push(l);continue}o.has(l.label)||o.set(l.label,[]),o.get(l.label).push(l)}const s=[],a=new Set;for(const l of e){if(l.type==="divider"||l.type==="category"||!l.label){if(t.includes(l)){s.push(l);const u=t.indexOf(l);t.splice(u,1)}continue}if(a.has(l.label))continue;a.add(l.label);const i=o.get(l.label);if(i.length===1){s.push(i[0]);continue}const r=i.find(u=>u.source==="vue");r?s.push(r):s.push(i[0])}return s}n(Kg,"removeDuplicateMenuOptions");const Qg=["Rename","Copy","Duplicate","Run Branch","Pin","Unpin","Bypass","Remove Bypass","Mute","Convert to Subgraph","Frame selection","Minimize Node","Expand","Collapse","Resize","Clone","Node Info","Color","Open in Mask Editor","Open Image","Copy Image","Save Image","Copy (Clipspace)","Paste (Clipspace)","Convert to Group Node (Deprecated)"];function Cn(e){const o=Qg.indexOf(e);return o===-1?999:o}n(Cn,"getMenuItemOrder");function On(e){const o=Kg(e),t=new Map,s=[];let a;for(const m of o){if(m.type==="divider"||m.type==="category")continue;if((m.label==="Delete"||m.label==="Remove")&&!m.hasSubmenu){a=m;continue}m.label&&qg(m.label)?t.set(m.label,m):s.push(m)}const l=[],i=Array.from(t.keys());i.sort((m,v)=>Cn(m)-Cn(v));const r=n(m=>m<=2?1:m<=8?2:m<=15?3:m<=17?4:5,"getSectionNumber");let u=0;for(const m of i){const v=t.get(m),p=Cn(m),w=r(p);u>0&&w!==u&&l.push({type:"divider"}),l.push(v),u=w}const f=[];return f.push(...l),s.length>0&&(f.push({type:"divider"}),f.push({label:"Extensions",type:"category",disabled:!0}),f.push(...s)),a&&(f.push({type:"divider"}),f.push(a)),f}n(On,"buildStructuredMenu");function Jg(e,o,t=!0){const s=[];for(const a of e){if(a===null){s.push({type:"divider"});continue}if(!a.content||Gg.has(a.content)||Hg(a.content,s))continue;const l={label:a.content,source:"litegraph"};if(a.disabled&&(l.disabled=!0),a.has_submenu){if(a.submenu?.options)l.hasSubmenu=!0,l.submenu=xl(a.submenu.options);else if(a.callback&&!a.disabled){l.hasSubmenu=!0;const i=Yg(a,o);i?l.submenu=i:console.warn("[ContextMenuConverter] Failed to capture submenu for:",a.content)}}else a.callback&&!a.disabled&&(l.action=()=>{try{a.callback?.call(a,a.value,{},void 0,void 0,a)}catch(i){console.error("Error executing context menu callback:",i)}});s.push(l)}return t?On(s):s}n(Jg,"convertContextMenuToOptions");function Yg(e,o){let t,s;const a=ge.ContextMenu;try{ge.ContextMenu=function(l,i){return t=l,s=i,{close:n(()=>{},"close"),root:document.createElement("div")}};try{const l=new MouseEvent("click",{bubbles:!0,cancelable:!0,clientX:0,clientY:0}),i={close:n(()=>{},"close"),root:document.createElement("div")};e.callback?.call(e,e.value,{},l,i,o)}catch(l){console.warn("[ContextMenuConverter] Error executing callback for:",e.content,l)}}finally{ge.ContextMenu=a}if(t)return xl(t,s);console.warn("[ContextMenuConverter] No items captured for:",e.content)}n(Yg,"captureDynamicSubmenu");function xl(e,o){const t=[];for(const s of e){if(s===null)continue;if(typeof s=="string"){const i={label:s,action:n(()=>{try{o?.callback&&o.callback.call(null,s,o,void 0,void 0,o.extra)}catch(r){console.error("Error executing string item callback:",r)}},"action")};t.push(i);continue}if(!s.content)continue;const l={label:Xg(s.content),action:n(()=>{try{s.callback?.call(s,s.value,{},void 0,void 0,s)}catch(i){console.error("Error executing submenu callback:",i)}},"action")};s.disabled&&(l.disabled=!0),t.push(l)}return t}n(xl,"convertSubmenuToOptions");function Xg(e){return St.sanitize(e,{ALLOWED_TAGS:[]}).trim()||e.replace(/<[^>]*>/g,"").trim()||e}n(Xg,"stripHtmlTags");function vs(){const e=me(),o=Le();return{refreshCanvas:n(()=>{e.canvas?.emitBeforeChange(),e.canvas?.setDirty(!0,!0),e.canvas?.graph?.afterChange(),e.canvas?.emitAfterChange(),o.activeWorkflow?.changeTracker?.checkState()},"refreshCanvas")}}n(vs,"useCanvasRefresh");function hs(){const{t:e}=pe(),o=me(),t=ct(),s=vs(),a=h(()=>t.completedActivePalette.light_theme),l=n(w=>Rt(w,{lightness:.5}),"toLightThemeColor"),i={name:"noColor",localizedName:e("color.noColor"),value:{dark:ge.NODE_DEFAULT_BGCOLOR,light:l(ge.NODE_DEFAULT_BGCOLOR)}},r=[i,...Object.entries(He.node_colors).map(([w,k])=>({name:w,localizedName:e(`color.${w}`),value:{dark:k.bgcolor,light:l(k.bgcolor)}}))],u=[{name:"default",localizedName:e("shape.default"),value:It.ROUND},{name:"box",localizedName:e("shape.box"),value:It.BOX},{name:"card",localizedName:e("shape.CARD"),value:It.CARD}];return{colorOptions:r,shapeOptions:u,applyColor:n(w=>{const k=w?.name??i.name,g=k===i.name?null:He.node_colors[k];for(const b of o.selectedItems)Ro(b)&&b.setColorOption(g);s.refreshCanvas()},"applyColor"),applyShape:n(w=>{const k=Array.from(o.selectedItems).filter(g=>g instanceof gt);k.length!==0&&(k.forEach(g=>{g.shape=w.value}),s.refreshCanvas())},"applyShape"),getCurrentColor:n(()=>{const w=Array.from(o.selectedItems);if(w.length===0)return null;const k=w.find(S=>Ro(S));if(!k||!Ro(k))return null;const b=k.getColorOption()?.bgcolor??null;return r.find(S=>S.value.dark===b||S.value.light===b)??i},"getCurrentColor"),getCurrentShape:n(()=>{const w=Array.from(o.selectedItems).filter(b=>b instanceof gt);if(w.length===0)return null;const g=w[0].shape??It.ROUND;return u.find(b=>b.value===g)??u[0]},"getCurrentShape"),isLightTheme:a}}n(hs,"useNodeCustomization");function Zg(){const{t:e}=pe(),o=me(),t=Le(),s=ue(),a=vs(),{shapeOptions:l,colorOptions:i,isLightTheme:r}=hs();return{getFitGroupToNodesOption:n(p=>({label:"Fit Group To Nodes",icon:"icon-[lucide--move-diagonal-2]",action:n(()=>{try{p.recomputeInsideNodes()}catch(k){console.warn("Failed to recompute group nodes:",k);return}const w=s.get("Comfy.GroupSelectedNodes.Padding");p.resizeTo(p.children,w),p.graph?.change(),o.canvas?.setDirty(!0,!0),t.activeWorkflow?.changeTracker?.checkState()},"action")}),"getFitGroupToNodesOption"),getGroupShapeOptions:n((p,w)=>({label:e("contextMenu.Shape"),icon:"icon-[lucide--box]",hasSubmenu:!0,submenu:l.map(k=>({label:k.localizedName,action:n(()=>{(p.nodes||[]).forEach(b=>b.shape=k.value),a.refreshCanvas(),w()},"action")}))}),"getGroupShapeOptions"),getGroupColorOptions:n((p,w)=>({label:e("contextMenu.Color"),icon:"icon-[lucide--palette]",hasSubmenu:!0,submenu:i.map(k=>({label:k.localizedName,color:r.value?k.value.light:k.value.dark,action:n(()=>{p.color=r.value?k.value.light:k.value.dark,a.refreshCanvas(),w()},"action")}))}),"getGroupColorOptions"),getGroupModeOptions:n((p,w)=>{const k=[];try{p.recomputeInsideNodes()}catch(_){return console.warn("Failed to recompute group nodes for mode options:",_),k}const g=p.nodes||[];if(!g.length)return k;let b=!0;for(let _=1;_<g.length;_++)if(g[_].mode!==g[0].mode){b=!1;break}const S=n((_,C)=>({label:e(`selectionToolbox.${_}`),icon:C===Oe.BYPASS?"icon-[lucide--ban]":C===Oe.NEVER?"icon-[lucide--zap-off]":"icon-[lucide--play]",action:n(()=>{g.forEach(x=>{x.mode=C}),o.canvas?.setDirty(!0,!0),p.graph?.change(),t.activeWorkflow?.changeTracker?.checkState(),w()},"action")}),"createModeAction");if(b)switch(g[0].mode){case Oe.ALWAYS:k.push(S("Set Group Nodes to Never",Oe.NEVER)),k.push(S("Bypass Group Nodes",Oe.BYPASS));break;case Oe.NEVER:k.push(S("Set Group Nodes to Always",Oe.ALWAYS)),k.push(S("Bypass Group Nodes",Oe.BYPASS));break;case Oe.BYPASS:k.push(S("Set Group Nodes to Always",Oe.ALWAYS)),k.push(S("Set Group Nodes to Never",Oe.NEVER));break;default:k.push(S("Set Group Nodes to Always",Oe.ALWAYS)),k.push(S("Set Group Nodes to Never",Oe.NEVER)),k.push(S("Bypass Group Nodes",Oe.BYPASS));break}else k.push(S("Set Group Nodes to Always",Oe.ALWAYS)),k.push(S("Set Group Nodes to Never",Oe.NEVER)),k.push(S("Bypass Group Nodes",Oe.BYPASS));return k},"getGroupModeOptions")}}n(Zg,"useGroupMenuOptions");function ev(){const{t:e}=pe(),o=n(()=>{_e().execute("Comfy.MaskEditor.OpenMaskEditor")},"openMaskEditor"),t=n(i=>{if(!i?.imgs?.length)return;const r=i.imgs[i.imageIndex??0];if(!r)return;const u=new URL(r.src);u.searchParams.delete("preview"),window.open(u.toString(),"_blank")},"openImage"),s=n(async i=>{if(!i?.imgs?.length)return;const r=i.imgs[i.imageIndex??0];if(!r)return;const u=document.createElement("canvas"),f=u.getContext("2d");if(f){u.width=r.naturalWidth,u.height=r.naturalHeight,f.drawImage(r,0,0);try{const m=await new Promise(v=>{u.toBlob(v,"image/png")});if(!m){console.warn("Failed to create image blob");return}if(!navigator.clipboard?.write){console.warn("Clipboard API not available");return}await navigator.clipboard.write([new ClipboardItem({"image/png":m})])}catch(m){console.error("Failed to copy image to clipboard:",m)}}},"copyImage"),a=n(i=>{if(!i?.imgs?.length)return;const r=i.imgs[i.imageIndex??0];if(r)try{const u=new URL(r.src);u.searchParams.delete("preview"),ln(u.toString())}catch(u){console.error("Failed to save image:",u)}},"saveImage");return{getImageMenuOptions:n(i=>i?.imgs?.length?[{label:e("contextMenu.Open in Mask Editor"),action:n(()=>o(),"action")},{label:e("contextMenu.Open Image"),icon:"icon-[lucide--external-link]",action:n(()=>t(i),"action")},{label:e("contextMenu.Copy Image"),icon:"icon-[lucide--copy]",action:n(()=>s(i),"action")},{label:e("contextMenu.Save Image"),icon:"icon-[lucide--download]",action:n(()=>a(i),"action")}]:[],"getImageMenuOptions")}}n(ev,"useImageMenuOptions");function tv(){const{getSelectedNodes:e,toggleSelectedNodesMode:o}=ls(),t=_e(),s=Le();return{adjustNodeSize:n(()=>{e().forEach(m=>{const v=m.computeSize();m.setSize([v[0],v[1]])}),J.canvas.setDirty(!0,!0),s.activeWorkflow?.changeTracker?.checkState()},"adjustNodeSize"),toggleNodeCollapse:n(()=>{e().forEach(m=>{m.collapse()}),J.canvas.setDirty(!0,!0),s.activeWorkflow?.changeTracker?.checkState()},"toggleNodeCollapse"),toggleNodePin:n(()=>{e().forEach(m=>{m.pin(!m.pinned)}),J.canvas.setDirty(!0,!0),s.activeWorkflow?.changeTracker?.checkState()},"toggleNodePin"),toggleNodeBypass:n(()=>{o(Oe.BYPASS),J.canvas.setDirty(!0,!0)},"toggleNodeBypass"),runBranch:n(async()=>{const f=e();Xa(f).length!==0&&await t.execute("Comfy.QueueSelectedOutputNodes")},"runBranch")}}n(tv,"useSelectedNodeActions");function ov(){const{t:e}=pe(),{shapeOptions:o,applyShape:t,applyColor:s,colorOptions:a,isLightTheme:l}=hs(),{adjustNodeSize:i,toggleNodeCollapse:r,toggleNodePin:u,toggleNodeBypass:f,runBranch:m}=tv(),v=h(()=>o.map(C=>({label:C.localizedName,action:n(()=>t(C),"action")}))),p=h(()=>a.map(C=>({label:C.localizedName,color:l.value?C.value.light:C.value.dark,action:n(()=>s(C.name==="noColor"?null:C),"action")})));return{getNodeInfoOption:n(C=>({label:e("contextMenu.Node Info"),icon:"icon-[lucide--info]",action:C}),"getNodeInfoOption"),getAdjustSizeOption:n(()=>({label:e("contextMenu.Adjust Size"),icon:"icon-[lucide--move-diagonal-2]",action:i}),"getAdjustSizeOption"),getNodeVisualOptions:n((C,x)=>[{label:C.collapsed?e("contextMenu.Expand Node"):e("contextMenu.Minimize Node"),icon:C.collapsed?"icon-[lucide--maximize-2]":"icon-[lucide--minimize-2]",action:n(()=>{r(),x()},"action")},{label:e("contextMenu.Shape"),icon:"icon-[lucide--box]",hasSubmenu:!0,submenu:v.value,action:n(()=>{},"action")},{label:e("contextMenu.Color"),icon:"icon-[lucide--palette]",hasSubmenu:!0,submenu:p.value,isColorPicker:!0,action:n(()=>{},"action")}],"getNodeVisualOptions"),getPinOption:n((C,x)=>({label:C.pinned?e("contextMenu.Unpin"):e("contextMenu.Pin"),icon:C.pinned?"icon-[lucide--pin-off]":"icon-[lucide--pin]",action:n(()=>{u(),x()},"action")}),"getPinOption"),getBypassOption:n((C,x)=>({label:C.bypassed?e("contextMenu.Remove Bypass"):e("contextMenu.Bypass"),icon:"icon-[lucide--redo-dot]",shortcut:"Ctrl+B",action:n(()=>{f(),x()},"action")}),"getBypassOption"),getRunBranchOption:n(()=>({label:e("contextMenu.Run Branch"),icon:"icon-[lucide--play]",action:m}),"getRunBranchOption"),colorSubmenu:p}}n(ov,"useNodeMenuOptions");function Sl(){const e=ue(),o=rn(),{hasMultipleSelection:t}=Ut(),s=h(()=>t.value);return{frameNodes:n(()=>{const{canvas:l}=J;if(!l.selectedItems?.size)return;const i=new Wt,r=e.get("Comfy.GroupSelectedNodes.Padding");i.resizeTo(l.selectedItems,r),l.graph?.add(i),o.titleEditorTarget=i},"frameNodes"),canFrame:s}}n(Sl,"useFrameNodes");function nv(){const{t:e}=pe(),o=me(),t=vs(),s=[{name:"top",localizedName:e("contextMenu.Top"),value:"top",icon:"icon-[lucide--align-start-vertical]"},{name:"bottom",localizedName:e("contextMenu.Bottom"),value:"bottom",icon:"icon-[lucide--align-end-vertical]"},{name:"left",localizedName:e("contextMenu.Left"),value:"left",icon:"icon-[lucide--align-start-horizontal]"},{name:"right",localizedName:e("contextMenu.Right"),value:"right",icon:"icon-[lucide--align-end-horizontal]"}],a=[{name:"horizontal",localizedName:e("contextMenu.Horizontal"),value:!0,icon:"icon-[lucide--align-center-horizontal]"},{name:"vertical",localizedName:e("contextMenu.Vertical"),value:!1,icon:"icon-[lucide--align-center-vertical]"}];return{alignOptions:s,distributeOptions:a,applyAlign:n(r=>{const u=Array.from(o.selectedItems).filter(m=>oo(m));if(u.length===0)return;const f=Xi(u,r.value);o.canvas?.repositionNodesVueMode(f),t.refreshCanvas()},"applyAlign"),applyDistribute:n(r=>{const u=Array.from(o.selectedItems).filter(m=>oo(m));if(u.length<2)return;const f=Yi(u,r.value);o.canvas?.repositionNodesVueMode(f),t.refreshCanvas()},"applyDistribute")}}n(nv,"useNodeArrangement");function sv(){const e=me(),o=Mt(),t=tt(),s=rn(),a=Le();return{copySelection:n(()=>{const m=J.canvas;if(!m.selectedItems||m.selectedItems.size===0){o.add({severity:"warn",summary:ce("g.nothingToCopy"),detail:ce("g.selectItemsToCopy"),life:3e3});return}m.copyToClipboard(),o.add({severity:"success",summary:ce("g.copied"),detail:ce("g.itemsCopiedToClipboard"),life:2e3})},"copySelection"),pasteSelection:n(()=>{J.canvas.pasteFromClipboard({connectInputs:!1}),a.activeWorkflow?.changeTracker?.checkState()},"pasteSelection"),duplicateSelection:n(()=>{const m=J.canvas;if(!m.selectedItems||m.selectedItems.size===0){o.add({severity:"warn",summary:ce("g.nothingToDuplicate"),detail:ce("g.selectItemsToDuplicate"),life:3e3});return}m.copyToClipboard(),m.selectedItems.clear(),e.updateSelectedItems(),m.pasteFromClipboard({connectInputs:!1}),a.activeWorkflow?.changeTracker?.checkState()},"duplicateSelection"),deleteSelection:n(()=>{const m=J.canvas;if(!m.selectedItems||m.selectedItems.size===0){o.add({severity:"warn",summary:ce("g.nothingToDelete"),detail:ce("g.selectItemsToDelete"),life:3e3});return}m.deleteSelected(),m.setDirty(!0,!0),a.activeWorkflow?.changeTracker?.checkState()},"deleteSelection"),renameSelection:n(async()=>{const m=Array.from(e.selectedItems);if(m.length===1){const v=m[0];if(v instanceof gt){s.titleEditorTarget=v;return}const p="title"in v?v.title:"",w=await t.prompt({title:ce("g.rename"),message:ce("g.enterNewName"),defaultValue:p});if(w&&w!==p&&"title"in v){const k=v;k.title=w,J.canvas.setDirty(!0,!0),a.activeWorkflow?.changeTracker?.checkState()}return}if(m.length>1){const v=await t.prompt({title:ce("g.batchRename"),message:ce("g.enterBaseName"),defaultValue:"Item"});v&&(m.forEach((p,w)=>{if("title"in p){const k=p;k.title=`${v} ${w+1}`}}),J.canvas.setDirty(!0,!0),a.activeWorkflow?.changeTracker?.checkState());return}o.add({severity:"warn",summary:ce("g.nothingToRename"),detail:ce("g.selectItemsToRename"),life:3e3})},"renameSelection")}}n(sv,"useSelectionOperations");function av(){const{t:e}=pe(),{copySelection:o,duplicateSelection:t,deleteSelection:s,renameSelection:a}=sv(),{alignOptions:l,distributeOptions:i,applyAlign:r,applyDistribute:u}=nv(),{convertToSubgraph:f,unpackSubgraph:m,addSubgraphToLibrary:v}=Za(),{frameNodes:p}=Sl(),w=h(()=>l.map(x=>({label:x.localizedName,icon:x.icon,action:n(()=>r(x),"action")}))),k=h(()=>i.map(x=>({label:x.localizedName,icon:x.icon,action:n(()=>u(x),"action")})));return{getBasicSelectionOptions:n(()=>[{label:e("contextMenu.Rename"),action:a},{label:e("contextMenu.Copy"),shortcut:"Ctrl+C",action:o},{label:e("contextMenu.Duplicate"),shortcut:"Ctrl+D",action:t}],"getBasicSelectionOptions"),getSubgraphOptions:n(({hasSubgraphs:x,hasMultipleSelection:N})=>{const M={label:e("contextMenu.Convert to Subgraph"),icon:"icon-[lucide--shrink]",action:f,badge:Vn.NEW},$=[];return(!x||N)&&$.push(M),x&&$.push({label:e("contextMenu.Add Subgraph to Library"),icon:"icon-[lucide--folder-plus]",action:v},{label:e("contextMenu.Unpack Subgraph"),icon:"icon-[lucide--expand]",action:m}),$},"getSubgraphOptions"),getMultipleNodesOptions:n(()=>{const x=n(()=>{_e().execute("Comfy.GroupNode.ConvertSelectedNodesToGroupNode")},"convertToGroupNodes");return[{label:e("contextMenu.Convert to Group Node"),icon:"icon-[lucide--group]",action:x,badge:Vn.DEPRECATED},{label:e("g.frameNodes"),icon:"icon-[lucide--frame]",action:p}]},"getMultipleNodesOptions"),getDeleteOption:n(()=>({label:e("contextMenu.Delete"),icon:"icon-[lucide--trash-2]",shortcut:"Delete",action:s}),"getDeleteOption"),getAlignmentOptions:n(()=>[{label:e("contextMenu.Align Selected To"),icon:"icon-[lucide--align-start-horizontal]",hasSubmenu:!0,submenu:w.value,action:n(()=>{},"action")},{label:e("contextMenu.Distribute Nodes"),icon:"icon-[lucide--align-center-horizontal]",hasSubmenu:!0,submenu:k.value,action:n(()=>{},"action")}],"getAlignmentOptions"),alignSubmenu:w,distributeSubmenu:k}}n(av,"useSelectionMenuOptions");var Vn=(e=>(e.NEW="new",e.DEPRECATED="deprecated",e))(Vn||{});let _o=null;function lv(e){_o?.toggle&&_o.toggle(e)}n(lv,"toggleNodeOptions");function iv(e){_o?.show&&_o.show(e)}n(iv,"showNodeOptions");function Rn(e){_o=e}n(Rn,"registerNodeOptionsInstance");function rv(e){return e.map(o=>o.type==="divider"||o.type==="category"?o:{...o,source:"vue"})}n(rv,"markAsVueOptions");function uv(){const{selectedItems:e,selectedNodes:o,nodeDef:t,showNodeHelp:s,hasSubgraphs:a,hasImageNode:l,hasOutputNodesSelected:i,hasMultipleSelection:r,computeSelectionFlags:u}=Ut(),f=me(),{getImageMenuOptions:m}=ev(),{getNodeInfoOption:v,getNodeVisualOptions:p,getPinOption:w,getBypassOption:k,getRunBranchOption:g}=ov(),{getFitGroupToNodesOption:b,getGroupColorOptions:S,getGroupModeOptions:_}=Zg(),{getBasicSelectionOptions:C,getSubgraphOptions:x,getMultipleNodesOptions:N}=av(),M=a,$=r,I=L(0),P=n(()=>{I.value++},"bump"),z=h(()=>{I.value;const D=u(),A=e.value.filter(is),B=A.length===1&&o.value.length===0?A[0]:null,W=M.value,G=[];if(o.value.length===1&&!B&&f.canvas)try{const Y=o.value[0],oe=f.canvas.getNodeMenuOptions(Y);G.push(...Jg(oe,Y,!1))}catch(Y){console.error("Error getting LiteGraph menu items:",Y)}const H=[],K=C();if(H.push(...K),H.push({type:"divider"}),i.value){const Y=g();H.push(Y)}if(!B){const Y=w(D,P),oe=k(D,P);H.push(Y),H.push(oe)}if(B){const Y=_(B,P);H.push(...Y)}if(H.push({type:"divider"}),H.push(...x({hasSubgraphs:W,hasMultipleSelection:$.value})),$.value&&H.push(...N()),B)H.push(b(B));else{const Y=p(D,P);Y.length>0&&H.push(Y[0])}if(H.push({type:"divider"}),t.value&&H.push(v(s)),B)H.push(S(B,P));else{const Y=p(D,P);Y.length>1&&H.push(Y[1]),Y.length>2&&H.push(Y[2])}H.push({type:"divider"}),l.value&&o.value.length>0&&(H.push(...m(o.value[0])),H.push({type:"divider"}));const ee=rv(H);if(G.length>0){const Y=[...G,...ee];return On(Y)}return On(ee)}),j=h(()=>z.value.filter(D=>D.hasSubmenu&&D.submenu));return{menuOptions:z,menuOptionsWithSubmenu:j,bump:P,hasSubgraphs:M,registerNodeOptionsInstance:Rn}}n(uv,"useMoreOptionsMenu");const cv=["title","onClick"],dv={key:0,class:"icon-[lucide--check] size-4 flex-shrink-0"},pv={key:1,class:"w-4 flex-shrink-0"},fv=q({__name:"ColorPickerMenu",props:{option:{}},emits:["submenu-click"],setup(e,{expose:o,emit:t}){const s=e,a=t,{getCurrentShape:l}=hs(),i=L();o({toggle:n((v,p)=>{i.value?.toggle(v,p)},"toggle")});const u=n(v=>{v.disabled||(a("submenu-click",v),i.value?.hide())},"handleSubmenuClick"),f=n(v=>{if(v.color)return!1;const p=l();return p?p.localizedName===v.label:!1},"isShapeSelected"),m=h(()=>s.option.submenu&&s.option.submenu.length>0&&s.option.submenu.every(v=>v.color&&!v.icon));return(v,p)=>(d(),U(y(Ye),{ref_key:"popoverRef",ref:i,"auto-z-index":!0,"base-z-index":1100,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:{root:{class:"absolute z-60"},content:{class:["text-base-foreground rounded-lg","shadow-lg border border-base-background","bg-interface-panel-surface"]}}},{default:E(()=>[c("div",{class:Q(m.value?"flex flex-col gap-1 p-2":"flex flex-col p-2 min-w-40")},[(d(!0),T(ne,null,be(v.option.submenu,w=>(d(),T("div",{key:w.label,class:Q(y(le)("hover:bg-secondary-background-hover rounded cursor-pointer",m.value?"w-7 h-7 flex items-center justify-center":"flex items-center gap-2 px-3 py-1.5 text-sm",w.disabled?"cursor-not-allowed pointer-events-none text-node-icon-disabled":"hover:bg-secondary-background-hover")),title:w.label,onClick:n(k=>u(w),"onClick")},[w.color?(d(),T("div",{key:0,class:"size-5 rounded-full border border-border-default",style:he({backgroundColor:w.color})},null,4)):w.color?V("",!0):(d(),T(ne,{key:1},[f(w)?(d(),T("i",dv)):(d(),T("div",pv)),c("span",null,R(w.label),1)],64))],10,cv))),128))],2)]),_:1},512))}}),mv=["onClick"],gv={class:"flex-1"},vv={key:1,class:"flex h-3.5 min-w-3.5 items-center justify-center rounded bg-interface-menu-keybind-surface-default px-1 py-0 text-xs"},hv={key:2,class:"icon-[lucide--chevron-right] size-4 opacity-60"},yv=q({__name:"NodeContextMenu",setup(e,{expose:o}){const t=L(),s=L(),a=L(!1),{menuOptions:l,bump:i}=uv(),r=me(),u=L({x:0,y:0}),f=r.getCanvas(),{left:m,top:v}=qn(f.canvas);let p=0,w=0,k=0;const g=n(()=>{if(!a.value)return;const B=t.value?.container;if(!B)return;const{scale:W,offset:G}=f.ds;if(W===p&&G[0]===w&&G[1]===k)return;p=W,w=G[0],k=G[1];const H=(u.value.x+G[0])*W+m.value,K=(u.value.y+G[1])*W+v.value;B.style.left=`${H}px`,B.style.top=`${K}px`},"updateMenuPosition"),{resume:b,pause:S}=no(g,{immediate:!1});ke(()=>{a.value?b():S()}),Ae(window,"touchstart",A=>{if(!a.value||!t.value)return;const B=A.target,W=t.value,G=W.container||W.$el;G&&!G.contains(B)&&$()},{passive:!0});const _=h(()=>l.value.find(A=>A.isColorPicker));function C(A){return!!A.isColorPicker}n(C,"isColorOption");function x(A){if(A.type==="divider")return{separator:!0};const B=C(A),W={label:A.label,icon:A.icon,disabled:A.disabled,shortcut:A.shortcut,isColorSubmenu:B,originalOption:A};return A.hasSubmenu&&A.submenu&&!B&&(W.items=A.submenu.map(G=>({label:G.label,icon:G.icon,disabled:G.disabled,command:n(()=>{G.action(),$()},"command")}))),!A.hasSubmenu&&A.action&&(W.command=()=>{A.action?.(),$()}),W}n(x,"convertToMenuItem");const N=h(()=>l.value.map(x));function M(A){i();const B=A.clientX-m.value,W=A.clientY-v.value,{scale:G,offset:H}=f.ds;u.value={x:B/G-H[0],y:W/G-H[1]},a.value=!0,t.value?.show(A)}n(M,"show");function $(){t.value?.hide()}n($,"hide");function I(A){a.value?$():M(A)}n(I,"toggle"),o({toggle:I,hide:$,isOpen:a,show:M});function P(A){A.stopPropagation(),A.preventDefault();const B=Array.from(A.currentTarget.children).find(W=>W.classList.contains("icon-[lucide--chevron-right]"));s.value?.toggle(A,B)}n(P,"showColorPopover");function z(A){A.action(),$()}n(z,"handleColorSelect");function j(){a.value=!0}n(j,"onMenuShow");function D(){a.value=!1}return n(D,"onMenuHide"),Ve(()=>{Rn({toggle:I,show:M,hide:$,isOpen:a})}),ut(()=>{Rn(null)}),(A,B)=>(d(),T(ne,null,[F(y(Wa),{ref_key:"contextMenu",ref:t,model:N.value,class:"max-h-[80vh] md:max-h-none overflow-y-auto md:overflow-y-visible",onShow:j,onHide:D},{item:E(({item:W,props:G,hasSubmenu:H})=>[c("a",Pt(G.action,{class:"flex items-center gap-2 px-3 py-1.5",onClick:n(K=>W.isColorSubmenu?P(K):void 0,"onClick")}),[W.icon?(d(),T("i",{key:0,class:Q([W.icon,"size-4"])},null,2)):V("",!0),c("span",gv,R(W.label),1),W.shortcut?(d(),T("span",vv,R(W.shortcut),1)):V("",!0),H||W.isColorSubmenu?(d(),T("i",hv)):V("",!0)],16,mv)]),_:1},8,["model"]),_.value?(d(),U(fv,{ref_key:"colorPickerMenu",ref:s,key:"color-picker-menu",option:_.value,onSubmenuClick:z},null,8,["option"])):V("",!0)],64))}}),bv=q({__name:"FrameNodes",setup(e){const{frameNodes:o}=Sl();return(t,s)=>{const a=Ie("tooltip");return de((d(),U(X,{variant:"muted-textonly","aria-label":t.$t("g.frameNodes"),onClick:y(o)},{default:E(()=>s[0]||(s[0]=[c("i",{class:"icon-[lucide--frame]"},null,-1)])),_:1},8,["aria-label","onClick"])),[[a,{value:t.$t("g.frameNodes"),showDelay:1e3},void 0,{top:!0}]])}}}),wv=q({__name:"NodeOptionsButton",setup(e){const o=n(t=>{lv(t)},"handleClick");return(t,s)=>{const a=Ie("tooltip");return de((d(),U(X,{"data-testid":"more-options-button",variant:"muted-textonly","aria-label":t.$t("g.moreOptions"),onClick:o},{default:E(()=>s[0]||(s[0]=[c("i",{class:"icon-[lucide--more-vertical]"},null,-1)])),_:1},8,["aria-label"])),[[a,{value:t.$t("g.moreOptions"),showDelay:1e3},void 0,{top:!0}]])}}}),kv={},Cv={class:"h-6 w-px self-center bg-border-default"};function xv(e,o){return d(),T("div",Cv)}n(xv,"_sfc_render$1");const sa=Ee(kv,[["render",xv]]),Sv=q({__name:"SelectionToolbox",setup(e){const o=_e(),t=me(),s=Zi(),a=uo(),l=L(),{visible:i}=Fg(l),r=h(()=>{const A=new Set(t.selectedItems.map(B=>s.invokeExtensions("getSelectionToolboxCommands",B).flat()).flat());return Array.from(A).map(B=>o.getCommand(B)).filter(B=>B!==void 0)}),{hasAnySelection:u,hasMultipleSelection:f,isSingleNode:m,isSingleSubgraph:v,isSingleImageNode:p,hasAny3DNodeSelected:w,hasOutputNodesSelected:k,nodeDef:g}=Ut(),b=h(()=>!!g.value),S=h(()=>u.value),_=h(()=>u.value),C=h(()=>f.value),x=h(()=>v.value),N=h(()=>m.value||v.value||f.value),M=h(()=>w.value),$=h(()=>p.value),I=h(()=>u.value),P=h(()=>u.value),z=h(()=>k.value),j=h(()=>S.value||_.value||C.value||x.value),D=h(()=>N.value);return(A,B)=>(d(),T(ne,null,[c("div",{ref_key:"toolboxRef",ref:l,style:{transform:"translate(var(--tb-x), var(--tb-y))"},class:"pointer-events-none fixed top-0 left-0 z-40"},[F(Zo,{name:"slide-up"},{default:E(()=>[y(i)?(d(),U(y(Qn),{key:0,class:"selection-toolbox pointer-events-auto rounded-lg border border-interface-stroke bg-interface-panel-surface",pt:{header:"hidden",content:"p-2 h-12 flex flex-row gap-1"},onWheel:y(a).forwardEventToCanvas},{default:E(()=>[I.value?(d(),U(Ig,{key:0})):V("",!0),b.value&&j.value?(d(),U(sa,{key:1})):V("",!0),b.value?(d(),U(Dg,{key:2})):V("",!0),S.value?(d(),U(Tg,{key:3})):V("",!0),C.value?(d(),U(bv,{key:4})):V("",!0),_.value?(d(),U(Ng,{key:5})):V("",!0),x.value?(d(),U($g,{key:6})):V("",!0),x.value?(d(),U(Rg,{key:7})):V("",!0),$.value?(d(),U(Lg,{key:8})):V("",!0),j.value&&D.value?(d(),U(sa,{key:9})):V("",!0),N.value?(d(),U(wg,{key:10})):V("",!0),P.value?(d(),U(Vg,{key:11})):V("",!0),M.value?(d(),U(Ag,{key:12})):V("",!0),(d(!0),T(ne,null,be(r.value,W=>(d(),U(Pg,{key:W.id,command:W},null,8,["command"]))),128)),z.value?(d(),U(Mg,{key:13})):V("",!0),F(wv)]),_:1},8,["onWheel"])):V("",!0)]),_:1})],512),F(yv)],64))}}),_v=Ee(Sv,[["__scopeId","data-v-c6489a20"]]),Tv=q({__name:"TitleEditor",setup(e){const o=ue(),t=L(!1),s=L(""),{style:a,updatePosition:l}=Cl(),i=L({}),r=h(()=>({...a.value,...i.value})),u=rn(),f=me(),m=L(!0),v=n(w=>{if(u.titleEditorTarget&&w?.trim()){const k=w.trim();u.titleEditorTarget.title=k;const g=u.titleEditorTarget;g instanceof gt&&g.isSubgraphNode?.()&&(g.subgraph.name=k),J.canvas.setDirty(!0,!0)}t.value=!1,u.titleEditorTarget=null,f.canvas.allow_dragcanvas=m.value},"onEdit");return ae(()=>u.titleEditorTarget,w=>{if(w===null)return;s.value=w.title,t.value=!0;const k=f.canvas;m.value=k.allow_dragcanvas,k.allow_dragcanvas=!1;const g=k.ds.scale;if(w instanceof Wt){const b=w;l({pos:b.pos,size:[b.size[0],b.titleHeight]}),i.value={fontSize:`${b.font_size*g}px`}}else if(w instanceof gt){const b=w,[S,_]=b.getBounding();l({pos:[S,_],size:[b.width,ge.NODE_TITLE_HEIGHT]}),i.value={fontSize:`${12*g}px`}}}),Ae(document,"litegraph:canvas",n(w=>{if(w.detail.subType==="group-double-click"){if(!o.get("Comfy.Group.DoubleClickTitleToEdit"))return;const k=w.detail.group,[g,b]=k.pos;w.detail.originalEvent.canvasY-b<=k.titleHeight&&(u.titleEditorTarget=k)}else if(w.detail.subType==="node-double-click"){if(!o.get("Comfy.Node.DoubleClickTitleToEdit"))return;const k=w.detail.node,[g,b]=k.pos;w.detail.originalEvent.canvasY-b<=0&&(u.titleEditorTarget=k)}},"canvasEventHandler")),(w,k)=>t.value?(d(),T("div",{key:0,class:"group-title-editor node-title-editor",style:he(r.value)},[F(Yn,{"is-editing":t.value,"model-value":s.value,onEdit:v},null,8,["is-editing","model-value"])],4)):V("",!0)}}),$v=Ee(Tv,[["__scopeId","data-v-aceb018c"]]),Nv={key:0,class:"p-3"},Iv=q({__name:"TabInfo",props:{nodes:{}},setup(e){const o=h(()=>e.nodes[0]),t=ht(),s=er(),a=h(()=>t.fromLGraphNode(o.value));return _t(a,l=>{s.openHelp(l)},{immediate:!0}),(l,i)=>a.value?(d(),T("div",Nv,[F(tr,{node:a.value},null,8,["node"])])):V("",!0)}}),Mv=["placeholder"],_l=q({__name:"SidePanelSearch",props:en({searcher:{type:Function,default:n(async()=>{},"default")},updateKey:{}},{modelValue:{default:""},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const o=ko(e,"modelValue"),t=L(!1),s=Ta(o,100,{maxWait:100});ae(o,l=>{t.value=l!==s.value});const a=Ql(()=>Be(e.updateKey));return ae([s,a],(l,i,r)=>{let u=!1,f;r(()=>{u=!0,f?.()}),e.searcher(s.value,m=>f=m).catch(m=>{console.error("[SidePanelSearch] searcher failed",m)}).finally(()=>{u||(t.value=!1)})},{immediate:!0}),(l,i)=>(d(),T("label",{class:Q(y(le)("mt-1 py-1.5 bg-secondary-background rounded-lg transition-all duration-150","flex-1 flex gap-2 px-2 items-center","text-base-foreground border-0","focus-within:ring focus-within:ring-component-node-widget-background-highlighted/80"))},[c("i",{class:Q(y(le)("size-4 text-muted-foreground",t.value?"icon-[lucide--loader-circle] animate-spin":"icon-[lucide--search]"))},null,2),de(c("input",{"onUpdate:modelValue":i[0]||(i[0]=r=>o.value=r),type:"text",class:"bg-transparent border-0 outline-0 ring-0 h-5",placeholder:l.$t("g.searchPlaceholder")},null,8,Mv),[[Jl,o.value]])],2))}}),Pv=["fixed","increment","decrement","randomize"];function Dv(e){return Pv.includes(e)}n(Dv,"isControlOption");function aa(e){return Dv(e)?e:"randomize"}n(aa,"normalizeControlOption");function Av(e){e.vueTrack||$a((o,t)=>(e.callback=to(e.callback,t),e.vueTrack=o,{get(){},set(){}}))}n(Av,"widgetWithVueTrack");function Tl(e){return Av(e),e.vueTrack(),e.value}n(Tl,"useReactiveWidgetValue");function Lv(e){const o=e.linkedWidgets?.find(t=>t.name=="control_after_generate");if(o)return{value:aa(o.value),update:n(t=>o.value=aa(t),"update")}}n(Lv,"getControlWidget");function Ev(e,o){return!e.isSubgraphNode()||!or(o)?void 0:e.subgraph.getNodeById(o._overlay.nodeId)?.type}n(Ev,"getNodeType");const Ov=n(e=>{if(!(e==null||e===void 0)){if(typeof e=="string"||typeof e=="number"||typeof e=="boolean")return e;if(typeof e=="object")return Array.isArray(e)&&e.length>0&&e.every(o=>o instanceof File),e;console.warn(`Invalid widget value type: ${typeof e}`,e)}},"normalizeWidgetValue");function $l(e,o){const t=ht();return function(s){try{const a=t.getInputSpecForWidget(e,s.name),l=o.get(s.name),i=s.promoted?"ring ring-component-node-widget-promoted":s.advanced?"ring ring-component-node-widget-advanced":void 0,r=n(u=>{const f=Ov(u);s.value=f??void 0,s.callback?.(f,J.canvas,e),e.widgets?.forEach(m=>m.triggerDraw?.())},"callback");return{name:s.name,type:s.type,value:Tl(s),borderStyle:i,callback:r,controlWidget:Lv(s),hasLayoutSize:typeof s.computeLayoutSize=="function",isDOMWidget:yo(s)||Ja(s),label:s.label,nodeType:Ev(e,s),options:s.options,spec:a,slotMetadata:l}}catch{return{name:s.name||"unknown",type:s.type||"text",value:void 0}}}}n($l,"safeWidgetMapper");function Vv(e){return e==null||typeof e=="string"||typeof e=="number"||typeof e=="boolean"||typeof e=="object"}n(Vv,"isValidWidgetValue");function Rv(e){const{createNode:o,deleteNode:t,setSource:s}=un(),a=Na(new Map),l=new Map,i=n(g=>{const b=l.get(g),S=a.get(g);if(!b||!S)return;const _=new Map;b.inputs?.forEach((x,N)=>{x?.widget?.name&&_.set(x.widget.name,{index:N,linked:x.link!=null})});const C=S.widgets?.map(x=>{const N=_.get(x.name);return N?{...x,slotMetadata:N}:x});a.set(g,{...S,widgets:C,inputs:b.inputs?[...b.inputs]:void 0,outputs:b.outputs?[...b.outputs]:void 0})},"refreshNodeSlots");function r(g){const b=g.graph&&"id"in g.graph&&g.graph!==g.graph.rootGraph?String(g.graph.id):null,S=new Map,_=pn(g.widgets??[]);Object.defineProperty(g,"widgets",{get(){return _},set(I){_.splice(0,_.length,...I)}});const C=pn(g.inputs??[]);Object.defineProperty(g,"inputs",{get(){return C},set(I){C.splice(0,C.length,...I)}});const x=Yl(()=>(g.inputs?.forEach((I,P)=>{I?.widget?.name&&S.set(I.widget.name,{index:P,linked:I.link!=null})}),g.widgets?.map($l(g,S))??[])),N=g.type||g.constructor?.comfyClass||g.constructor?.title||g.constructor?.name||"Unknown",M=g.constructor?.nodeData?.api_node??!1,$=pn(g.badges??[]);return Object.defineProperty(g,"badges",{get(){return $},set(I){$.splice(0,$.length,...I??[])}}),{id:String(g.id),title:typeof g.title=="string"?g.title:"",type:N,mode:g.mode||0,titleMode:g.title_mode,selected:g.selected||!1,executing:!1,subgraphId:b,apiNode:M,badges:$,hasErrors:!!g.has_errors,widgets:x,inputs:C,outputs:g.outputs?[...g.outputs]:void 0,flags:g.flags?{...g.flags}:void 0,color:g.color||void 0,bgcolor:g.bgcolor||void 0,shape:g.shape}}n(r,"extractVueNodeData");const u=n(g=>l.get(g),"getNode"),f=n(()=>{if(!e?._nodes)return;const g=new Set(e._nodes.map(b=>String(b.id)));for(const b of Array.from(a.keys()))g.has(b)||(l.delete(b),a.delete(b));e._nodes.forEach(b=>{const S=String(b.id);l.set(S,b),a.set(S,r(b))})},"syncWithGraph"),m=n((g,b)=>{const S=String(g.id);l.set(S,g),a.set(S,r(g));const _=n(()=>{const C={x:g.pos[0],y:g.pos[1]},x={width:g.size[0],height:g.size[1]};s(Co.Canvas),o(S,{position:C,size:x,zIndex:g.order||0,visible:!0})},"initializeVueNodeLayout");window.app?.configuringGraph?g.onAfterGraphConfigured=to(g.onAfterGraphConfigured,()=>{a.set(S,r(g)),_()}):_(),b&&b(g)},"handleNodeAdded"),v=n((g,b)=>{const S=String(g.id);s(Co.Canvas),t(S),l.delete(S),a.delete(S),b&&b(g)},"handleNodeRemoved"),p=n((g,b,S)=>()=>{e.onNodeAdded=g||void 0,e.onNodeRemoved=b||void 0,e.onTrigger=S||void 0,l.clear(),a.clear()},"createCleanupFunction"),k=n(()=>{const g=e.onNodeAdded,b=e.onNodeRemoved,S=e.onTrigger;e.onNodeAdded=C=>{m(C,g)},e.onNodeRemoved=C=>{v(C,b)};const _={"node:property:changed":n(C=>{const x=String(C.nodeId),N=a.get(x);if(N)switch(C.property){case"title":a.set(x,{...N,title:String(C.newValue)});break;case"flags.collapsed":a.set(x,{...N,flags:{...N.flags,collapsed:!!C.newValue}});break;case"flags.pinned":a.set(x,{...N,flags:{...N.flags,pinned:!!C.newValue}});break;case"mode":a.set(x,{...N,mode:typeof C.newValue=="number"?C.newValue:0});break;case"color":a.set(x,{...N,color:typeof C.newValue=="string"?C.newValue:void 0});break;case"bgcolor":a.set(x,{...N,bgcolor:typeof C.newValue=="string"?C.newValue:void 0});break;case"shape":a.set(x,{...N,shape:typeof C.newValue=="number"?C.newValue:void 0})}},"node:property:changed"),"node:slot-errors:changed":n(C=>{i(String(C.nodeId))},"node:slot-errors:changed"),"node:slot-links:changed":n(C=>{C.slotType===nr.INPUT&&i(String(C.nodeId))},"node:slot-links:changed")};return e.onTrigger=C=>{switch(C.type){case"node:property:changed":_["node:property:changed"](C);break;case"node:slot-errors:changed":_["node:slot-errors:changed"](C);break;case"node:slot-links:changed":_["node:slot-links:changed"](C);break}S?.(C)},f(),p(g||void 0,b||void 0,S||void 0)},"setupEventListeners")();return e._nodes&&e._nodes.length>0&&e._nodes.forEach(g=>{e.onNodeAdded&&e.onNodeAdded(g)}),{vueNodeData:a,getNode:u,cleanup:k}}n(Rv,"useGraphNodeManager");const Wv={class:"flex flex-col bg-interface-panel-surface"},zv={class:"sticky top-0 z-10 flex items-center justify-between backdrop-blur-xl bg-inherit"},Bv=["disabled"],Fv={class:"text-sm font-semibold line-clamp-2"},Uv={key:0,class:"pb-4"},Gv=q({__name:"PropertiesAccordionItem",props:en({isEmpty:{type:Boolean}},{collapse:{type:Boolean,default:!1},collapseModifiers:{}}),emits:["update:collapse"],setup(e){const o=ko(e,"collapse");return(t,s)=>{const a=Ie("tooltip");return d(),T("div",Wv,[c("div",zv,[de((d(),T("button",{type:"button",class:Q(y(le)("group min-h-12 bg-transparent border-0 outline-0 ring-0 w-full text-left flex items-center justify-between pl-4 pr-3",!t.isEmpty&&"cursor-pointer")),disabled:t.isEmpty,onClick:s[0]||(s[0]=l=>o.value=!o.value)},[c("span",Fv,[ve(t.$slots,"label")]),t.isEmpty?V("",!0):(d(),T("i",{key:0,class:Q(y(le)("text-muted-foreground group-hover:text-base-foreground group-focus:text-base-foreground icon-[lucide--chevron-up] size-4 transition-all",o.value&&"-rotate-180"))},null,2))],10,Bv)),[[a,t.isEmpty?{value:t.$t("rightSidePanel.inputsNoneTooltip"),showDelay:1e3}:void 0]])]),!o.value&&!t.isEmpty?(d(),T("div",Uv,[ve(t.$slots,"default")])):V("",!0)])}}}),jv={key:0,class:"space-y-4 rounded-lg bg-interface-surface px-4"},Hv={class:"min-h-8"},qv={key:0,class:"text-sm leading-8 p-0 m-0 line-clamp-1"},Kv=q({__name:"SectionWidgets",props:{label:{},widgets:{}},setup(e){on("hideLayoutField",!0);const o=me(),{t}=pe();function s(r){return ar(r.type,r.name)||lr}n(s,"getWidgetComponent");function a(r,u){r.value=u,r.callback?.(u),o.canvas?.setDirty(!0,!0)}n(a,"onWidgetValueChange");const l=h(()=>e.widgets.length===0),i=h(()=>e.label??(l.value?t("rightSidePanel.inputsNone"):t("rightSidePanel.inputs")));return(r,u)=>(d(),U(Gv,{"is-empty":l.value},{label:E(()=>[ve(r.$slots,"label",{},()=>[$e(R(i.value),1)])]),default:E(()=>[l.value?V("",!0):(d(),T("div",jv,[(d(!0),T(ne,null,be(r.widgets,({widget:f,node:m},v)=>(d(),T("div",{key:`widget-${v}-${f.name}`,class:"widget-item gap-1.5 col-span-full grid grid-cols-subgrid"},[c("div",Hv,[f.name?(d(),T("p",qv,R(f.label||f.name),1)):V("",!0)]),(d(),U(eo(s(f)),{widget:f,"model-value":y(Tl)(f),"node-id":String(m.id),"node-type":m.type,class:Q(y(le)("col-span-1",y(sr)(f.type)&&"min-h-36")),"onUpdate:modelValue":n(p=>a(f,p),"onUpdate:modelValue")},null,8,["widget","model-value","node-id","node-type","class","onUpdate:modelValue"]))]))),128))]))]),_:3},8,["is-empty"]))}}),Qv={class:"px-4 pb-4 flex gap-2 border-b border-interface-stroke"},Jv=q({__name:"TabParameters",props:{nodes:{}},setup(e){const o=h(()=>e.nodes.map(a=>{const{widgets:l=[]}=a;return{widgets:l.filter(r=>!(r.options?.canvasOnly||r.options?.hidden)).map(r=>({node:a,widget:r})),node:a}})),t=Je([]);async function s(a){if(a.trim()===""){t.value=o.value;return}const l=a.trim().toLowerCase().split(" ");t.value=o.value.map(i=>({...i,widgets:i.widgets.filter(({widget:r})=>{const u=r.label?.toLowerCase(),f=r.name.toLowerCase(),m=r.type.toLowerCase(),v=r.value?.toString().toLowerCase();return l.every(p=>f.includes(p)||u?.includes(p)||m?.includes(p)||v?.includes(p))})})).filter(i=>i.widgets.length>0)}return n(s,"searcher"),(a,l)=>(d(),T(ne,null,[c("div",Qv,[F(_l,{searcher:s,"update-key":o.value},null,8,["update-key"])]),(d(!0),T(ne,null,be(t.value,i=>(d(),U(Kv,{key:i.node.id,label:o.value.length>1?i.node.title:void 0,widgets:i.widgets,"default-collapse":o.value.length>1&&o.value===t.value,class:"border-b border-interface-stroke"},null,8,["label","widgets","default-collapse"]))),128))],64))}}),Yv=["disabled","onClick"],Xv=q({__name:"FormSelectButton",props:{modelValue:{},options:{},optionLabel:{default:"label"},optionValue:{default:"value"},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:o}){const t=e,s=o,a=n((u,f)=>{if(typeof u!="object")return u;const m=t.optionValue;return u[m]??u.value??u.name??u.label??f},"getOptionValue"),l=n(u=>{if(typeof u=="object"&&u!==null){const f=t.optionLabel;return u[f]??u.label??u.name??u.value??String(u)}return String(u)},"getOptionLabel"),i=n(u=>{const f=a(t.options[u],u);return String(f)===String(t.modelValue??"")},"isSelected"),r=n(u=>{if(t.disabled)return;const f=a(t.options[u],u);s("update:modelValue",f)},"handleSelect");return(u,f)=>(d(),T("div",{class:Q(y(le)(y(bu),"p-1 inline-flex justify-center items-center gap-1"))},[(d(!0),T(ne,null,be(u.options,(m,v)=>(d(),T("button",{key:a(m,v),class:Q(y(le)("flex-1 h-6 px-5 py-[5px] rounded flex justify-center items-center gap-1 transition-all duration-150 ease-in-out truncate min-w-[4ch]","bg-transparent border-none","text-center text-xs font-normal",{"bg-interface-menu-component-surface-selected":i(v)&&!u.disabled,"hover:bg-interface-menu-component-surface-selected/50":!i(v)&&!u.disabled,"opacity-50 cursor-not-allowed":u.disabled,"cursor-pointer":!u.disabled},i(v)&&!u.disabled?"text-text-primary":"text-text-secondary")),disabled:u.disabled,onClick:n(p=>r(v),"onClick")},R(l(m)),11,Yv))),128))],2))}}),Zv={class:"space-y-4 p-3 text-sm text-muted-foreground"},eh={class:"flex flex-col gap-2"},th={class:"flex flex-col gap-2"},oh={class:"bg-secondary-background border-none rounded-lg p-1 grid grid-cols-5 gap-1 justify-items-center"},nh=["onClick"],sh=["data-testid"],ah={class:"flex items-center justify-between"},lh=q({__name:"TabSettings",props:{nodes:{}},setup(e){const o=e,t=Je([]);ke(()=>{o.nodes?t.value=o.nodes:t.value=[]});const{t:s}=pe(),a=me(),l=ct(),i=h(()=>l.completedActivePalette.light_theme),r=h({get(){let k=null;const g=t.value;return g.length===0?null:(g.length>1?(k=g[0].mode,g.every(b=>b.mode===k)||(k=null)):k=g[0].mode,k)},set(k){t.value.forEach(g=>{g.mode=k}),ho(t),a.canvas?.setDirty(!0,!0)}}),u=h({get(){return t.value.some(k=>k.pinned)},set(k){t.value.forEach(g=>g.pin(k)),ho(t),a.canvas?.setDirty(!0,!0)}});function f(k){return{dark:Rt(k,{lightness:.3}),light:Rt(k,{lightness:.4}),ringDark:Rt(k,{lightness:.5}),ringLight:Rt(k,{lightness:.1})}}n(f,"getColorValue");const m={name:"noColor",localizedName:n(()=>s("color.noColor"),"localizedName"),value:f(ge.NODE_DEFAULT_BGCOLOR)},v=Object.entries(He.node_colors),p=[m,...v.map(([k,g])=>({name:k,localizedName:n(()=>s(`color.${k}`),"localizedName"),value:f(g.bgcolor)}))],w=h({get(){if(t.value.length===0)return null;const k=t.value.map(b=>b.getColorOption());let g=k[0];return k.every(b=>b===g)||(g=!1),g===!1?null:g==null||!g.bgcolor&&!g.color?m.name:v.find(([b,S])=>S.bgcolor===g.bgcolor&&S.color===g.color)?.[0]??null},set(k){if(k===null)return;const g=k===m.name?null:He.node_colors[k];for(const b of t.value)b.setColorOption(g);ho(t),a.canvas?.setDirty(!0,!0)}});return(k,g)=>{const b=Ie("tooltip");return d(),T("div",Zv,[c("div",eh,[c("span",null,R(y(s)("rightSidePanel.nodeState")),1),F(Xv,{modelValue:r.value,"onUpdate:modelValue":g[0]||(g[0]=S=>r.value=S),class:"w-full",options:[{label:y(s)("rightSidePanel.normal"),value:y(Oe).ALWAYS},{label:y(s)("rightSidePanel.bypass"),value:y(Oe).BYPASS},{label:y(s)("rightSidePanel.mute"),value:y(Oe).NEVER}]},null,8,["modelValue","options"])]),c("div",th,[c("span",null,R(y(s)("rightSidePanel.color")),1),c("div",oh,[(d(),T(ne,null,be(p,S=>c("button",{key:S.name,class:Q(y(le)("size-8 rounded-lg bg-transparent border-0 outline-0 ring-0 text-left flex justify-center items-center cursor-pointer",S.name===w.value?"bg-interface-menu-component-surface-selected":"hover:bg-interface-menu-component-surface-selected")),onClick:n(_=>w.value=S.name,"onClick")},[de(c("div",{class:Q(y(le)("size-4 rounded-full ring-2 ring-gray-500/10")),style:he({backgroundColor:i.value?S.value.light:S.value.dark,"--tw-ring-color":S.name===w.value?i.value?S.value.ringLight:S.value.ringDark:void 0}),"data-testid":S.name},null,14,sh),[[b,S.localizedName(),void 0,{top:!0}]])],10,nh)),64))])]),c("div",ah,[c("span",null,R(y(s)("rightSidePanel.pinned")),1),F(y(za),{modelValue:u.value,"onUpdate:modelValue":g[1]||(g[1]=S=>u.value=S)},null,8,["modelValue"])])])}}}),ih={class:"pointer-events-none flex-1"},rh={class:"text-xs text-text-secondary line-clamp-1"},uh={class:"text-sm line-clamp-1 leading-8"},ch={key:0,class:"size-4 pointer-events-none icon-[lucide--grip-vertical]"},la=q({__name:"SubgraphNodeWidget",props:{nodeTitle:{},widgetName:{},isDraggable:{type:Boolean},isPhysical:{type:Boolean},class:{type:[Array,Object,String,Number,null,Boolean]}},emits:["toggleVisibility"],setup(e){const o=e;function t(){return o.isPhysical?"icon-[lucide--link]":o.isDraggable?"icon-[lucide--eye]":"icon-[lucide--eye-off]"}return n(t,"getIcon"),(s,a)=>(d(),T("div",{class:Q(y(le)("flex py-1 px-2 break-all rounded items-center gap-1","bg-node-component-surface",o.isDraggable&&"draggable-item drag-handle cursor-grab [&.is-draggable]:cursor-grabbing hover:ring-1 ring-accent-background",o.class))},[c("div",ih,[c("div",rh,R(s.nodeTitle),1),c("div",uh,R(s.widgetName),1)]),F(X,{variant:"muted-textonly",size:"sm",disabled:s.isPhysical,onClick:a[0]||(a[0]=Ce(l=>s.$emit("toggleVisibility"),["stop"]))},{default:E(()=>[c("i",{class:Q(t())},null,2)]),_:1},8,["disabled"]),s.isDraggable?(d(),T("div",ch)):V("",!0)],2))}}),dh={key:0,class:"subgraph-edit-section flex h-full flex-col"},ph={class:"p-4 flex gap-2"},fh={class:"flex-1"},mh={key:0,class:"flex flex-col border-t border-interface-stroke"},gh={class:"sticky top-0 z-10 flex items-center justify-between backdrop-blur-xl min-h-12 px-4"},vh={class:"text-sm font-semibold uppercase line-clamp-1"},hh={key:1,class:"flex flex-col border-t border-interface-stroke"},yh={class:"sticky top-0 z-10 flex items-center justify-between backdrop-blur-xl min-h-12 px-4"},bh={class:"text-sm font-semibold uppercase line-clamp-1"},wh={class:"pb-2 px-2 space-y-0.5 mt-0.5"},kh={key:2,class:"flex justify-center border-t border-interface-stroke py-4"},Ch=q({__name:"SubgraphEditor",setup(e){const o=me(),t=L(void 0),s=L(),a=L(""),l=$a((M,$)=>({get(){M();const I=r.value;return I?ir(I.properties.proxyWidgets):[]},set(I){$();const P=r.value;if(I){if(!P){console.error("Attempted to toggle widgets with no node selected");return}P.properties.proxyWidgets=I}}}));async function i(M){a.value=M}n(i,"searcher");const r=h(()=>{const M=o.selectedItems[0];if(M instanceof as)return M}),u=h({get(){if(!r.value)return[];const M=r.value;function $([I,P]){if(I==="-1"){const D=M.widgets.find(A=>A.name===P);return D?[[{id:-1,title:"(Linked)",type:""},D]]:[]}const z=M.subgraph._nodes_by_id[I];if(!z?.widgets)return[];const j=z.widgets.find(D=>D.name===P);return j?[[z,j]]:[]}return n($,"mapWidgets"),l.value.flatMap($)},set(M){if(!r.value){console.error("Attempted to toggle widgets with no node selected");return}l.value=M.map(fn)}}),f=h(()=>{const M=r.value;if(!M)return[];const{updatePreviews:$}=lo(),I=M.subgraph.nodes;for(const P of I)P.updateComputedDisabled(),$(P);return I.flatMap(g).filter(([P,z])=>!z.computedDisabled)}),m=h(()=>{if(!r.value)return[];const $=l.value;return f.value.filter(I=>!$.some(rr(I)))}),v=h(()=>{const M=a.value.toLowerCase();return M?m.value.filter(([$,I])=>$.title.toLowerCase().includes(M)||I.name.toLowerCase().includes(M)):m.value}),p=h(()=>r.value?v.value.filter(ur):[]),w=h(()=>{const M=a.value.toLowerCase();return M?u.value.filter(([$,I])=>$.title.toLowerCase().includes(M)||I.name.toLowerCase().includes(M)):u.value});function k(M){return`${M[0].id}: ${M[1].name}`}n(k,"toKey");function g(M){return M.widgets?M.widgets.map($=>[M,$]):[]}n(g,"nodeWidgets");function b([M,$]){const I=r.value;if(!I)return[];dr(M,$,[I]),ho(l)}n(b,"demote");function S([M,$]){const I=r.value;if(!I)return[];pr(M,$,[I]),ho(l)}n(S,"promote");function _(){if(!r.value)return;const $=l.value,I=v.value.map(fn);$.push(...I),l.value=$}n(_,"showAll");function C(){r.value&&(l.value=l.value.filter($=>!w.value.some(fr($))||$[0]==="-1"))}n(C,"hideAll");function x(){if(!r.value)return;const $=l.value,I=p.value.map(fn);$.push(...I),l.value=$}n(x,"showRecommended");function N(){t.value?.dispose(),!(a.value||!s.value?.children?.length)&&(t.value=new mr(s.value,".draggable-item"),t.value.applyNewItemsOrder=function(){const M=[];let $=-1;this.getAllItems().forEach((j,D)=>{if(j===this.draggableItem){$=D;return}if(!this.isItemToggled(j)){M[D]=j;return}const A=this.isItemAbove(j)?D+1:D-1;M[A]=j});for(let j=0;j<this.getAllItems().length;j++)typeof M[j]>"u"&&(M[j]=this.draggableItem);const I=M.indexOf(this.draggableItem),P=u.value,[z]=P.splice($,1);P.splice(I,0,z),u.value=P})}return n(N,"setDraggableState"),Jt(w,()=>{N()},{debounce:100}),Ve(()=>{N(),r.value&&cr(r.value)}),rt(()=>{t.value?.dispose()}),(M,$)=>r.value?(d(),T("div",dh,[c("div",ph,[F(_l,{searcher:i})]),c("div",fh,[w.value.length?(d(),T("div",mh,[c("div",gh,[c("div",vh,R(M.$t("subgraphStore.shown")),1),c("a",{class:"cursor-pointer text-right text-xs font-normal text-text-secondary hover:text-azure-600 whitespace-nowrap",onClick:Ce(C,["stop"])},R(M.$t("subgraphStore.hideAll")),1)]),c("div",{ref_key:"draggableItems",ref:s,class:"pb-2 px-2 space-y-0.5 mt-0.5"},[(d(!0),T(ne,null,be(w.value,([I,P])=>(d(),U(la,{key:k([I,P]),class:"bg-interface-panel-surface","node-title":I.title,"widget-name":P.name,"is-shown":!0,"is-draggable":!a.value,"is-physical":I.id===-1,onToggleVisibility:n(z=>b([I,P]),"onToggleVisibility")},null,8,["node-title","widget-name","is-draggable","is-physical","onToggleVisibility"]))),128))],512)])):V("",!0),v.value.length?(d(),T("div",hh,[c("div",yh,[c("div",bh,R(M.$t("subgraphStore.hidden")),1),c("a",{class:"cursor-pointer text-right text-xs font-normal text-text-secondary hover:text-azure-600 whitespace-nowrap",onClick:Ce(_,["stop"])},R(M.$t("subgraphStore.showAll")),1)]),c("div",wh,[(d(!0),T(ne,null,be(v.value,([I,P])=>(d(),U(la,{key:k([I,P]),class:"bg-interface-panel-surface","node-title":I.title,"widget-name":P.name,onToggleVisibility:n(z=>S([I,P]),"onToggleVisibility")},null,8,["node-title","widget-name","onToggleVisibility"]))),128))])])):V("",!0),p.value.length?(d(),T("div",kh,[F(X,{size:"sm",class:"rounded border-none px-3 py-0.5",onClick:Ce(x,["stop"])},{default:E(()=>[$e(R(M.$t("subgraphStore.showRecommended")),1)]),_:1})])):V("",!0)])])):V("",!0)}}),xh={"data-testid":"properties-panel",class:"flex size-full flex-col bg-interface-panel-surface"},Sh={class:"pt-1"},_h={class:"flex items-center justify-between pl-4 pr-3"},Th={class:"my-3.5 text-sm font-semibold line-clamp-2"},$h={class:"flex gap-2"},Nh={key:0,class:"px-4 pb-2 pt-1"},Ih={class:"scrollbar-thin flex-1 overflow-y-auto"},Mh={key:0,class:"flex size-full p-4 items-start justify-start text-sm text-muted-foreground"},Ph=q({__name:"RightSidePanel",setup(e){const o=me(),t=so(),s=ue(),{t:a}=pe(),{selectedItems:l}=Fe(o),{activeTab:i,isEditingSubgraph:r}=Fe(t),u=h(()=>s.get("Comfy.Sidebar.Location")),f=h(()=>u.value==="right"?"icon-[lucide--panel-left]":"icon-[lucide--panel-right]"),m=h(()=>l.value.length>0),v=h(()=>l.value.filter(oo)),p=h(()=>k.value instanceof as),w=h(()=>v.value.length===1),k=h(()=>w.value?v.value[0]:null),g=h(()=>l.value.length),b=h(()=>w.value&&k.value?k.value.title||k.value.type||"Node":a("rightSidePanel.title",{count:g.value}));function S(){t.closePanel()}n(S,"closePanel");const _=h(()=>{const M=[{label:n(()=>a("rightSidePanel.parameters"),"label"),value:"parameters"},{label:n(()=>a("g.settings"),"label"),value:"settings"}];return(!m.value||w.value&&!p.value)&&M.push({label:n(()=>a("rightSidePanel.info"),"label"),value:"info"}),M});ke(()=>{!_.value.some(M=>M.value===i.value)&&!(i.value==="subgraph"&&p.value)&&t.openPanel(_.value[0].value)});const C=L(!1);function x(M){C.value=!1;const $=M.trim();if(!$)return;const I=Be(k);I&&$!==I.title&&(I.title=$,o.canvas?.setDirty(!0,!1))}n(x,"handleTitleEdit");function N(){C.value=!1}return n(N,"handleTitleCancel"),(M,$)=>(d(),T("div",xh,[c("section",Sh,[c("div",_h,[c("h3",Th,[w.value?(d(),U(Yn,{key:0,"model-value":b.value,"is-editing":C.value,"input-attrs":{"data-testid":"node-title-input"},onEdit:x,onCancel:N,onDblclick:$[0]||($[0]=I=>C.value=!0)},null,8,["model-value","is-editing"])):(d(),T(ne,{key:1},[$e(R(b.value),1)],64))]),c("div",$h,[p.value?(d(),U(X,{key:0,variant:"secondary",size:"icon",class:Q(y(le)(y(r)&&"bg-secondary-background-selected")),onClick:$[1]||($[1]=I=>y(t).openPanel(y(r)?"parameters":"subgraph"))},{default:E(()=>$[3]||($[3]=[c("i",{class:"icon-[lucide--settings-2]"},null,-1)])),_:1},8,["class"])):V("",!0),F(X,{variant:"secondary",size:"icon","aria-pressed":y(t).isOpen,"aria-label":y(a)("rightSidePanel.togglePanel"),onClick:S},{default:E(()=>[c("i",{class:Q(y(le)(f.value,"size-4"))},null,2)]),_:1},8,["aria-pressed","aria-label"])])]),m.value?(d(),T("nav",Nh,[F(gr,{"model-value":y(i),"onUpdate:modelValue":$[2]||($[2]=I=>{y(t).openPanel(I)})},{default:E(()=>[(d(!0),T(ne,null,be(_.value,I=>(d(),U(vr,{key:I.value,class:"text-sm py-1 px-2 font-inter",value:I.value},{default:E(()=>[$e(R(I.label()),1)]),_:2},1032,["value"]))),128))]),_:1},8,["model-value"])])):V("",!0)]),c("div",Ih,[m.value?p.value&&y(r)?(d(),U(Ch,{key:1,node:k.value},null,8,["node"])):(d(),T(ne,{key:2},[y(i)==="parameters"?(d(),U(Jv,{key:0,nodes:v.value},null,8,["nodes"])):y(i)==="info"?(d(),U(Iv,{key:1,nodes:v.value},null,8,["nodes"])):y(i)==="settings"?(d(),U(lh,{key:2,nodes:v.value},null,8,["nodes"])):V("",!0)],64)):(d(),T("div",Mh,R(M.$t("rightSidePanel.noSelection")),1))])]))}}),ys=Dt("searchBox",()=>{const e=ue(),{x:o,y:t}=Xl(),s=h(()=>e.get("Comfy.NodeSearchBoxImpl")==="default"),a=Je(null);function l(u){a.value=u}n(l,"setPopoverRef");const i=L(!1);function r(){if(s.value){i.value=!i.value;return}a.value&&a.value.showSearchBox(new MouseEvent("click",{clientX:o.value,clientY:t.value,layerY:t.value}))}return n(r,"toggleVisible"),{newSearchBoxEnabled:s,setPopoverRef:l,toggleVisible:r,visible:i}}),Dh={name:"AutoCompletePlus",extends:No,emits:["focused-option-changed"],data(){return{isComposing:!1}},mounted(){typeof No.mounted=="function"&&No.mounted.call(this);const e=this.$el.querySelector("input");e&&(e.addEventListener("compositionstart",()=>{this.isComposing=!0}),e.addEventListener("compositionend",()=>{this.isComposing=!1})),this.$watch(()=>this.focusedOptionIndex,(o,t)=>{this.$emit("focused-option-changed",o)})},methods:{onKeyDown(e){if(e.key==="Enter"&&this.isComposing){e.preventDefault(),e.stopPropagation();return}No.methods.onKeyDown.call(this,e)}}},Ah={class:"option-container flex w-full cursor-pointer items-center justify-between overflow-hidden px-2 py-0"},Lh={class:"option-display-name flex flex-col font-semibold"},Eh={key:0},Oh=["innerHTML"],Vh=["innerHTML"],Rh={key:0,class:"option-category truncate text-sm font-light text-muted"},Wh={class:"option-badges"},zh=q({__name:"NodeSearchItem",props:{nodeDef:{},currentQuery:{}},setup(e){const o=ue(),t=h(()=>o.get("Comfy.NodeSearchBoxImpl.ShowCategory")),s=h(()=>o.get("Comfy.NodeSearchBoxImpl.ShowIdName")),a=h(()=>o.get("Comfy.NodeSearchBoxImpl.ShowNodeFrequency")),l=rs(),i=h(()=>l.getNodeFrequency(f.nodeDef)),r=hr(),u=h(()=>r.isBookmarked(f.nodeDef)),f=e;return(m,v)=>(d(),T("div",Ah,[c("div",Lh,[c("div",null,[u.value?(d(),T("span",Eh,v[0]||(v[0]=[c("i",{class:"pi pi-bookmark-fill mr-1 text-sm"},null,-1)]))):V("",!0),c("span",{innerHTML:y(Ps)(m.nodeDef.display_name,m.currentQuery)},null,8,Oh),v[1]||(v[1]=c("span",null,"",-1)),s.value?(d(),U(y(Yt),{key:1,severity:"secondary"},{default:E(()=>[c("span",{innerHTML:y(Ps)(m.nodeDef.name,m.currentQuery)},null,8,Vh)]),_:1})):V("",!0)]),t.value?(d(),T("div",Rh,R(m.nodeDef.category.replaceAll("/"," > ")),1)):V("",!0)]),c("div",Wh,[m.nodeDef.experimental?(d(),U(y(Yt),{key:0,value:m.$t("g.experimental"),severity:"primary"},null,8,["value"])):V("",!0),m.nodeDef.deprecated?(d(),U(y(Yt),{key:1,value:m.$t("g.deprecated"),severity:"danger"},null,8,["value"])):V("",!0),a.value&&i.value>0?(d(),U(y(Yt),{key:2,value:y(yr)(i.value,{roundToInt:!0}),severity:"secondary"},null,8,["value"])):V("",!0),m.nodeDef.nodeSource.type!==y(br).Unknown?(d(),U(y(yi),{key:3,class:"text-sm font-light"},{default:E(()=>[$e(R(m.nodeDef.nodeSource.displayText),1)]),_:1})):V("",!0)])]))}}),Bh=Ee(zh,[["__scopeId","data-v-acda36a0"]]),Fh={class:"comfy-vue-node-search-container flex w-full min-w-96 items-center justify-center"},Uh={class:"_dialog-body"},Gh=q({__name:"NodeSearchBox",props:{filters:{},searchLimit:{default:64}},emits:["addFilter","removeFilter","addNode"],setup(e,{emit:o}){const t=ue(),{t:s}=pe(),a=h(()=>t.get("Comfy.NodeSearchBoxImpl.NodePreview")),l=L(),i=L(!1),r=`comfy-vue-node-search-box-input-${Math.random()}`,u=L([]),f=L(null),m=L(""),v=h(()=>e.filters.length===0?s("g.searchNodes")+"...":""),p=ht(),w=rs(),k=nn($=>{$.trim()},500),g=n($=>{const I=$===""&&e.filters.length===0;m.value=$,u.value=I?w.topNodeDefs:[...p.nodeSearchService.searchNode($,e.filters,{limit:e.searchLimit})],k($)},"search"),b=o,S=n($=>{b("addNode",$)},"onAddNode");let _=null;const C=n(async()=>{_??=document.getElementById(r),_&&(_.blur(),await Re(()=>_?.focus()))},"reFocusInput");Ve(()=>{_??=document.getElementById(r),_&&_.focus(),l.value.hide=()=>g(""),g(""),l.value.show()});const x=n($=>{i.value=!1,b("addFilter",$)},"onAddFilter"),N=n(async($,I)=>{$.stopPropagation(),$.preventDefault(),b("removeFilter",I),await C()},"onRemoveFilter"),M=n($=>{if($===-1){f.value=null;return}const I=u.value[$];f.value=I},"setHoverSuggestion");return($,I)=>(d(),T("div",Fh,[a.value&&f.value?(d(),T("div",{key:0,class:"comfy-vue-node-preview-container absolute top-[50px] left-[-375px] z-50 cursor-pointer",onMousedown:I[0]||(I[0]=Ce(P=>S(f.value),["stop"]))},[(d(),U(wr,{key:f.value?.name||"","node-def":f.value},null,8,["node-def"]))],32)):V("",!0),F(X,{variant:"secondary","aria-label":$.$t("g.addNodeFilterCondition"),class:"filter-button z-10",onClick:I[1]||(I[1]=P=>i.value=!0)},{default:E(()=>I[6]||(I[6]=[c("i",{class:"pi pi-filter"},null,-1)])),_:1},8,["aria-label"]),F(y(Ba),{visible:i.value,"onUpdate:visible":I[2]||(I[2]=P=>i.value=P),class:"min-w-96","dismissable-mask":"",modal:"",onHide:C},{header:E(()=>[c("h3",null,R($.$t("g.addNodeFilterCondition")),1)]),default:E(()=>[c("div",Uh,[F(kr,{onAddFilter:x})])]),_:1},8,["visible"]),F(Dh,{ref_key:"autoCompletePlus",ref:l,"model-value":$.filters,class:"comfy-vue-node-search-box z-10 grow","scroll-height":"40vh",placeholder:v.value,"input-id":r,"append-to":"self",suggestions:u.value,delay:100,loading:!y(w).isLoaded,"complete-on-focus":"","auto-option-focus":"","force-selection":"",multiple:"","option-label":"display_name",onComplete:I[3]||(I[3]=P=>g(P.query)),onOptionSelect:I[4]||(I[4]=P=>S(P.value)),onFocusedOptionChanged:I[5]||(I[5]=P=>M(P))},{option:E(({option:P})=>[F(Bh,{"node-def":P,"current-query":m.value},null,8,["node-def","current-query"])]),chip:E(({value:P})=>[P.filterDef&&P.value?(d(),U(Cr,{key:`${P.filterDef.id}-${P.value}`,text:P.value,badge:P.filterDef.invokeSequence.toUpperCase(),"badge-class":P.filterDef.invokeSequence+"-badge",onRemove:n(z=>N(z,P),"onRemove")},null,8,["text","badge","badge-class","onRemove"])):V("",!0)]),_:1},8,["model-value","placeholder","suggestions","loading"])]))}}),jh=q({__name:"NodeSearchBoxPopover",setup(e,{expose:o}){let t=null,s=null,a=!1;const l=ue(),i=ys(),r=lo(),{visible:u,newSearchBoxEnabled:f}=Fe(i),m=L(!0);function v(){return t?[t.canvasX,t.canvasY]:r.getCanvasCenter()}n(v,"getNewNodeLocation");const p=L([]);function w(W){p.value.push(W)}n(w,"addFilter");function k(W){p.value=p.value.filter(G=>$s(G)!==$s(W))}n(k,"removeFilter");function g(){p.value=[]}n(g,"clearFilters");function b(){u.value=!1}n(b,"closeDialog");const S=me();function _(W){const G=r.addNodeOnGraph(W,{pos:v()});a&&t?S.getCanvas().linkConnector.connectToNode(G,t):t||console.warn("The trigger event was undefined when addNode was called."),a=!1,Le().activeWorkflow?.changeTracker?.checkState(),window.requestAnimationFrame(b)}n(_,"addNode");function C(W){f.value?W?.pointerType==="touch"?setTimeout(()=>{M(W)},128):M(W):S.getCanvas().showSearchBox(W)}n(C,"showSearchBox");function x(){return S.getCanvas().linkConnector.renderLinks.at(0)}n(x,"getFirstLink");const N=ht();function M(W){const G=x();if(G){const H=G.toType==="input"?N.nodeSearchService.inputTypeFilter:N.nodeSearchService.outputTypeFilter,K=G.fromSlot.type?.toString()??"";w({filterDef:H,value:K})}u.value=!0,t=W,m.value=!1,setTimeout(()=>{m.value=!0},300)}n(M,"showNewSearchBox");function $(W){const G=x();if(!G)return;const{node:H,fromSlot:K,toType:ee}=G,ie={e:W,allow_searchbox:!0,showSearchBox:n(()=>{nt(),C(W)},"showSearchBox")},Y=G.fromReroute?.id,oe=ee==="input"?{nodeFrom:H,slotFrom:K,afterRerouteId:Y}:{nodeTo:H,slotTo:K,afterRerouteId:Y},se=S.getCanvas(),Ne=se.showConnectionMenu({...oe,...ie});if(!Ne){console.warn("No menu was returned from showConnectionMenu");return}t=W,s=new AbortController;const{signal:Ue}=s,qe={once:!0,signal:Ue};Ae(se.canvas,"connect-new-default-node",Ke=>{if(!(Ke instanceof CustomEvent))throw new Error("Invalid event");const je=Ke.detail?.node;if(!(je instanceof gt))throw new Error("Invalid node");a=!1,Ke.preventDefault(),se.linkConnector.connectToNode(je,W)},qe);const nt=Ae(Ne.controller.signal,"abort",B,qe)}n($,"showContextMenu"),ke(()=>{const{canvas:W}=S;W&&(ge.release_link_on_empty_shows_menu=!1,W.allow_searchbox=!1,Ae(W.linkConnector.events,"dropped-on-canvas",A))});function I(W){if(W.detail.subType==="empty-double-click")C(W.detail.originalEvent);else if(W.detail.subType==="group-double-click"){const G=W.detail.group,[H,K]=G.pos;W.detail.originalEvent.canvasY-K>G.titleHeight&&C(W.detail.originalEvent)}}n(I,"canvasEventHandler");const P=h(()=>l.get("Comfy.LinkRelease.Action")),z=h(()=>l.get("Comfy.LinkRelease.ActionShift"));function j(W){return W.preventDefault()}n(j,"preventDefault");function D(W){W.preventDefault();const G=S.getCanvas();G.linkConnector.state.snapLinksPos=[W.detail.canvasX,W.detail.canvasY],Ae(G.linkConnector.events,"reset",j,{once:!0})}n(D,"cancelNextReset");function A(W){switch(a=!0,W.detail.shiftKey?z.value:P.value){case xt.SEARCH_BOX:D(W),C(W.detail);break;case xt.CONTEXT_MENU:D(W),$(W.detail);break;case xt.NO_ACTION:}}n(A,"handleDroppedOnCanvas");function B(){s?.abort(),s=null,t=null;const W=S.getCanvas();W.linkConnector.events.removeEventListener("reset",j),a&&W.linkConnector.disconnectLinks(),W.linkConnector.reset(),W.setDirty(!0,!0)}return n(B,"reset"),ae(u,()=>{u.value||B()}),Ae(document,"litegraph:canvas",I),o({showSearchBox:C}),(W,G)=>(d(),T("div",null,[F(y(Ba),{visible:y(u),"onUpdate:visible":G[0]||(G[0]=H=>it(u)?u.value=H:null),modal:"","dismissable-mask":m.value,pt:{root:{class:"invisible-dialog-root",role:"search"},mask:{class:"node-search-box-dialog-mask"},transition:{enterFromClass:"opacity-0 scale-75",enterActiveClass:"transition-all duration-100 ease-out",leaveActiveClass:"transition-all duration-100 ease-in",leaveToClass:"opacity-0 scale-75"}},onHide:g},{container:E(()=>[F(Gh,{filters:p.value,onAddFilter:w,onRemoveFilter:k,onAddNode:_},null,8,["filters"])]),_:1},8,["visible","dismissable-mask"])]))}}),Hh=["width","height"],qh=q({__name:"ComfyLogo",props:{size:{default:16},color:{default:"currentColor"},class:{},mode:{default:"outline"}},setup(e){const o=h(()=>e.class||""),t=h(()=>({stroke:e.mode==="outline"?e.color:void 0,strokeWidth:e.mode==="outline"?1:void 0,fill:e.mode==="fill"?e.color:"none"}));return(s,a)=>(d(),T("svg",{class:Q(o.value),width:s.size,height:s.size,viewBox:"0 0 18 18",xmlns:"http://www.w3.org/2000/svg"},[c("path",Pt({d:"M14.8193 0.600586C15.1248 0.600586 15.3296 0.70893 15.459 0.881836C15.5914 1.05888 15.6471 1.33774 15.5527 1.66895L14.8037 4.30176C14.7063 4.64386 14.4729 4.97024 14.1641 5.21191C13.8544 5.45415 13.496 5.58984 13.1699 5.58984H13.1689L9.5791 5.59668H7.90625C7.52654 5.59668 7.19496 5.84986 7.09082 6.21289L5.69434 11.0889C5.63007 11.3133 5.66134 11.5534 5.77734 11.7529L5.83203 11.8359C5.99177 12.0491 6.24252 12.1758 6.50977 12.1758H6.51074L8.88281 12.1709H11.4971C11.7643 12.171 11.9541 12.254 12.084 12.3906L12.1357 12.4521C12.2685 12.6295 12.3249 12.9089 12.2305 13.2402L11.4805 15.8721C11.383 16.2144 11.1498 16.5415 10.8408 16.7832C10.5314 17.0252 10.1736 17.161 9.84766 17.1611H9.84668L6.25684 17.168H3.64258C3.33762 17.1679 3.13349 17.0588 3.00391 16.8857C2.87135 16.7087 2.81482 16.43 2.90918 16.0986L3.39551 14.3887C3.46841 14.1327 3.41794 13.8576 3.25879 13.6445V13.6436C3.09901 13.4303 2.84745 13.3037 2.58008 13.3037H1.18066C0.875088 13.3037 0.670398 13.1953 0.541016 13.0225C0.408483 12.8451 0.351891 12.5655 0.446289 12.2344L2.11914 6.38965L2.30371 5.74707V5.74609C2.40139 5.40341 2.63456 5.07671 2.94336 4.83496C3.25302 4.59258 3.61143 4.45705 3.9375 4.45703H5.6123C5.94484 4.45703 6.24083 4.26316 6.37891 3.9707L6.42773 3.83984L6.98145 1.89551C7.07894 1.55317 7.31212 1.22614 7.62109 0.984375C7.93074 0.742127 8.2892 0.606445 8.61523 0.606445H8.61621L12.1982 0.600586H14.8193Z"},t.value),null,16)],10,Hh))}}),zo=q({__name:"CardBottom",props:{fullHeight:{type:Boolean,default:!0}},setup(e){const o=h(()=>le("flex-1 w-full",e.fullHeight&&"h-full"));return(t,s)=>(d(),T("div",{class:Q(o.value)},[ve(t.$slots,"default")],2))}}),Kh="flex flex-col overflow-hidden",Bo=q({__name:"CardContainer",props:{size:{default:"regular"},variant:{default:"default"},rounded:{default:"md"},customAspectRatio:{},hasBorder:{type:Boolean,default:!0},hasBackground:{type:Boolean,default:!0},hasShadow:{type:Boolean,default:!0},hasCursor:{type:Boolean,default:!0},class:{default:""}},setup(e){const o={none:"rounded-none",md:"rounded",lg:"rounded-lg",xl:"rounded-xl"},t=h(()=>{const s={default:le(e.hasBackground&&"bg-modal-card-background",e.hasBorder&&"border border-border-default",e.hasShadow&&"shadow-sm",e.hasCursor&&"cursor-pointer"),ghost:le(e.hasCursor&&"cursor-pointer","p-2 transition-colors duration-200"),outline:le(e.hasBorder&&"border-2 border-border-subtle",e.hasCursor&&"cursor-pointer","hover:border-border-subtle/50 transition-colors")},a=e.customAspectRatio?`aspect-[${e.customAspectRatio}]`:{mini:"aspect-100/120",compact:"aspect-240/311",regular:"aspect-256/308",portrait:"aspect-256/325",tall:"aspect-256/353"}[e.size];return le(Kh,o[e.rounded],s[e.variant],a,e.class)});return(s,a)=>(d(),T("div",{class:Q(t.value)},[ve(s.$slots,"top"),ve(s.$slots,"bottom")],2))}}),Fo=q({__name:"CardTop",props:{ratio:{default:"square"},topLeftClass:{},topRightClass:{},centerLeftClass:{},centerRightClass:{},bottomLeftClass:{},bottomRightClass:{}},setup(e){const o=ya(),t=h(()=>`relative p-0 overflow-hidden ${{square:"aspect-square",landscape:"aspect-48/27"}[e.ratio]}`),s={"top-left":"absolute top-2 left-2 flex flex-wrap justify-start gap-2","top-right":"absolute top-2 right-2 flex flex-wrap justify-end gap-2","center-left":"absolute top-1/2 left-2 flex -translate-y-1/2 flex-wrap justify-start gap-2","center-right":"absolute top-1/2 right-2 flex -translate-y-1/2 flex-wrap justify-end gap-2","bottom-left":"absolute bottom-2 left-2 flex flex-wrap justify-start gap-2","bottom-right":"absolute right-2 bottom-2 flex flex-wrap justify-end gap-2"},a=h(()=>({"top-left":le(s["top-left"],e.topLeftClass),"top-right":le(s["top-right"],e.topRightClass),"center-left":le(s["center-left"],e.centerLeftClass),"center-right":le(s["center-right"],e.centerRightClass),"bottom-left":le(s["bottom-left"],e.bottomLeftClass),"bottom-right":le(s["bottom-right"],e.bottomRightClass)}));return(l,i)=>(d(),T("div",{class:Q(t.value)},[ve(l.$slots,"default",{class:"absolute top-0 left-0 h-full w-full"}),y(o)["top-left"]?(d(),T("div",{key:0,class:Q(a.value["top-left"])},[ve(l.$slots,"top-left")],2)):V("",!0),y(o)["top-right"]?(d(),T("div",{key:1,class:Q(a.value["top-right"])},[ve(l.$slots,"top-right")],2)):V("",!0),y(o)["center-left"]?(d(),T("div",{key:2,class:Q(a.value["center-left"])},[ve(l.$slots,"center-left")],2)):V("",!0),y(o)["center-right"]?(d(),T("div",{key:3,class:Q(a.value["center-right"])},[ve(l.$slots,"center-right")],2)):V("",!0),y(o)["bottom-left"]?(d(),T("div",{key:4,class:Q(a.value["bottom-left"])},[ve(l.$slots,"bottom-left")],2)):V("",!0),y(o)["bottom-right"]?(d(),T("div",{key:5,class:Q(a.value["bottom-right"])},[ve(l.$slots,"bottom-right")],2)):V("",!0)],2))}}),Qh="inline-flex shrink-0 items-center justify-center gap-1 rounded px-2 py-1 text-xs font-bold",Uo=q({__name:"SquareChip",props:{label:{},variant:{default:"dark"}},setup(e){const o={dark:"bg-zinc-500/40 text-white/90",light:le("backdrop-blur-[2px] bg-base-background/50 text-base-foreground"),gray:le("backdrop-blur-[2px] bg-modal-card-tag-background text-base-foreground")},t=h(()=>le(Qh,o[e.variant]));return(s,a)=>(d(),T("div",{class:Q(t.value)},[ve(s.$slots,"icon"),c("span",null,R(s.label),1)],2))}}),Jh={class:"relative aspect-square w-full overflow-hidden rounded-t-lg select-none"},Yh={key:1,class:"flex h-full w-full items-center justify-center"},Xh=q({__name:"BaseThumbnail",props:{hoverZoom:{default:4},isHovered:{type:Boolean}},setup(e){const o=L(!1),t=L(null);return Ve(()=>{Array.from(t.value?.getElementsByTagName("img")??[]).forEach(a=>{Ae(a,"error",()=>{o.value=!0})})}),(s,a)=>(d(),T("div",Jh,[o.value?(d(),T("div",Yh,a[0]||(a[0]=[c("img",{src:Cu,draggable:"false",class:"h-full w-full transform-gpu object-cover transition-transform duration-300 ease-out"},null,-1)]))):(d(),T("div",{key:0,ref_key:"contentRef",ref:t,class:"h-full w-full transform-gpu transition-transform duration-1000 ease-out",style:he(s.isHovered?{transform:`scale(${1+s.hoverZoom/100})`}:void 0)},[ve(s.$slots,"default",{},void 0,!0)],4))]))}}),dn=Ee(Xh,[["__scopeId","data-v-c216f2c0"]]),Zh={class:"flex h-full w-full items-center justify-center p-4",style:{backgroundImage:"url(/assets/images/default-template.png)",backgroundRepeat:"round"}},ey=["src"],ty=q({__name:"AudioThumbnail",props:{src:{}},setup(e){return(o,t)=>(d(),U(dn,null,{default:E(()=>[c("div",Zh,[c("audio",{controls:"",class:"relative w-full",src:o.src,onClick:t[0]||(t[0]=Ce(()=>{},["stop"]))},null,8,ey)])]),_:1}))}}),oy=50,ny=q({__name:"CompareSliderThumbnail",props:{baseImageSrc:{},overlayImageSrc:{},alt:{},isHovered:{type:Boolean},isVideo:{type:Boolean}},setup(e){const o=e.isVideo||e.baseImageSrc?.toLowerCase().endsWith(".webp")||e.overlayImageSrc?.toLowerCase().endsWith(".webp")||!1,t=L(oy),s=L(null),{elementX:a,elementWidth:l,isOutside:i}=Zl(s);return ae([()=>e.isHovered,a,l,i],([r,u,f,m])=>{r&&(m||(t.value=u/f*100))}),(r,u)=>(d(),U(dn,{"is-hovered":r.isHovered},{default:E(()=>[F(xo,{src:r.baseImageSrc,alt:r.alt,"image-class":y(o)?"w-full h-full object-cover":"max-w-full max-h-64 object-contain"},null,8,["src","alt","image-class"]),c("div",{ref_key:"containerRef",ref:s,class:"absolute inset-0"},[F(xo,{src:r.overlayImageSrc,alt:r.alt,"image-class":y(o)?"w-full h-full object-cover":"max-w-full max-h-64 object-contain","image-style":{clipPath:`inset(0 ${100-t.value}% 0 0)`}},null,8,["src","alt","image-class","image-style"]),c("div",{class:"pointer-events-none absolute inset-y-0 z-10 w-0.5 bg-white/30 backdrop-blur-sm",style:he({left:`${t.value}%`})},null,4)],512)]),_:1},8,["is-hovered"]))}}),sy=q({__name:"DefaultThumbnail",props:{src:{},alt:{},hoverZoom:{},isHovered:{type:Boolean},isVideo:{type:Boolean}},setup(e){const o=e.isVideo??(e.src?.toLowerCase().endsWith(".webp")||!1);return(t,s)=>(d(),U(dn,{"hover-zoom":t.hoverZoom,"is-hovered":t.isHovered},{default:E(()=>[F(xo,{src:t.src,alt:t.alt,"image-class":["transform-gpu transition-transform duration-300 ease-out",y(o)?"w-full h-full object-cover":"max-w-full max-h-64 object-contain"],"image-style":t.isHovered?{transform:`scale(${1+t.hoverZoom/100})`}:void 0},null,8,["src","alt","image-class","image-style"])]),_:1},8,["hover-zoom","is-hovered"]))}}),ay={class:"relative h-full w-full"},ly={class:"absolute inset-0"},iy={class:"absolute inset-0 z-10"},ry=q({__name:"HoverDissolveThumbnail",props:{baseImageSrc:{},overlayImageSrc:{},alt:{},isHovered:{type:Boolean},isVideo:{type:Boolean}},setup(e){const o=e.isVideo||e.baseImageSrc?.toLowerCase().endsWith(".webp")||e.overlayImageSrc?.toLowerCase().endsWith(".webp")||!1,t=h(()=>o?"size-full object-cover":"size-full object-contain"),s=h(()=>{const a="size-full transition-opacity duration-300",l=o?"object-cover":"object-contain",i=e.isHovered?"opacity-100":"opacity-0";return`${a} ${l} ${i}`});return(a,l)=>(d(),U(dn,{"is-hovered":a.isHovered},{default:E(()=>[c("div",ay,[c("div",ly,[F(xo,{src:a.baseImageSrc,alt:a.alt,"image-class":t.value},null,8,["src","alt","image-class"])]),c("div",iy,[F(xo,{src:a.overlayImageSrc,alt:a.alt,"image-class":s.value},null,8,["src","alt","image-class"])])])]),_:1},8,["is-hovered"]))}});function uy(e,o={}){const{itemsPerPage:t=12,initialPage:s=1}=o,a=L(s),l=L(!1),i=Je(new Set([])),r=h(()=>{const w="value"in e?e.value:e;return Array.isArray(w)?w:[]}),u=h(()=>{const w=r.value;if(w.length===0)return[];const k=Array.from(i.value).sort((S,_)=>S-_),b=Math.max(...k,0)*t;return w.slice(0,b)}),f=h(()=>{const w=r.value;if(w.length===0)return!1;const k=Array.from(i.value);return Math.max(...k,0)*t<w.length}),m=h(()=>{const w=r.value;return w.length===0?0:Math.ceil(w.length/t)}),v=n(async()=>{if(l.value||!f.value)return;l.value=!0;const w=Array.from(i.value),k=Math.max(...w,0)+1,g=new Set(i.value);g.add(k),i.value=g,a.value=k,l.value=!1},"loadNextPage");return ae(()=>r.value.length,w=>{w>0&&i.value.size===0&&(i.value=new Set([1]))},{immediate:!0}),{paginatedItems:u,isLoading:l,hasMoreItems:f,currentPage:a,totalPages:m,loadNextPage:v,reset:n(()=>{a.value=s,i.value=new Set([]),l.value=!1,r.value.length>0&&(i.value=new Set([1]))},"reset")}}n(uy,"useLazyPagination");const cy=Dt("templateRanking",()=>{const e=L(),o=n(l=>l/(e.value??l),"normalizeUsageScore"),t=n(l=>{if(!l)return .5;const i=new Date(l);if(isNaN(i.getTime()))return .5;const r=(Date.now()-i.getTime())/(1e3*60*60*24);return Math.max(.1,1/(1+r/90))},"computeFreshness");return{largestUsageScore:e,computeFreshness:t,computeDefaultScore:n((l,i,r=0)=>{const u=(i??5)/10,f=t(l);return o(r)*.5+u*.3+f*.2},"computeDefaultScore"),computePopularScore:n((l,i=0)=>{const r=t(l);return o(i)*.9+r*.1},"computePopularScore")}});function dy(e){const o=ue(),t=cy(),s=L(""),a=L(o.get("Comfy.Templates.SelectedModels")),l=L(o.get("Comfy.Templates.SelectedUseCases")),i=L(o.get("Comfy.Templates.SelectedRunsOn")),r=L(o.get("Comfy.Templates.SortBy")),u=h(()=>{const A="value"in e?e.value:e;return Array.isArray(A)?A:[]}),f={keys:[{name:"name",weight:.3},{name:"title",weight:.3},{name:"description",weight:.1},{name:"tags",weight:.2},{name:"models",weight:.3}],threshold:.33,includeScore:!0,includeMatches:!0},m=h(()=>new ha(u.value,f)),v=h(()=>{const A=new Set;return u.value.forEach(B=>{Array.isArray(B.models)&&B.models.forEach(W=>A.add(W))}),Array.from(A).sort()}),p=h(()=>{const A=new Set;return u.value.forEach(B=>{B.tags&&Array.isArray(B.tags)&&B.tags.forEach(W=>A.add(W))}),Array.from(A).sort()}),w=h(()=>["ComfyUI","External or Remote API"]),k=Ta(s,50),g=h(()=>k.value.trim()?m.value.search(k.value).map(B=>B.item):u.value),b=h(()=>a.value.length===0?g.value:g.value.filter(A=>!A.models||!Array.isArray(A.models)?!1:a.value.some(B=>A.models?.includes(B)))),S=h(()=>l.value.length===0?b.value:b.value.filter(A=>!A.tags||!Array.isArray(A.tags)?!1:l.value.some(B=>A.tags?.includes(B)))),_=h(()=>i.value.length===0?S.value:S.value.filter(A=>{const B=A.openSource===!1,W=A.openSource!==!1;return i.value.some(G=>G==="External or Remote API"?B:G==="ComfyUI"?W:!1)})),C=n(A=>typeof A.vram=="number"&&Number.isFinite(A.vram)&&A.vram>0?A.vram:Number.POSITIVE_INFINITY,"getVramMetric");ae(_,A=>{t.largestUsageScore=Math.max(...A.map(B=>B.usage||0))},{immediate:!0});const x=h(()=>{const A=[..._.value];switch(r.value){case"recommended":return A.sort((B,W)=>{const G=t.computeDefaultScore(B.date,B.searchRank,B.usage);return t.computeDefaultScore(W.date,W.searchRank,W.usage)-G});case"popular":return A.sort((B,W)=>{const G=t.computePopularScore(B.date,B.usage);return t.computePopularScore(W.date,W.usage)-G});case"alphabetical":return A.sort((B,W)=>{const G=B.title||B.name||"",H=W.title||W.name||"";return G.localeCompare(H)});case"newest":return A.sort((B,W)=>{const G=new Date(B.date||"1970-01-01");return new Date(W.date||"1970-01-01").getTime()-G.getTime()});case"vram-low-to-high":return A.sort((B,W)=>{const G=C(B),H=C(W);if(G===H){const K=B.title||B.name||"",ee=W.title||W.name||"";return K.localeCompare(ee)}return G===Number.POSITIVE_INFINITY?1:H===Number.POSITIVE_INFINITY?-1:G-H});case"model-size-low-to-high":return A.sort((B,W)=>{const G=typeof B.size=="number"?B.size:Number.POSITIVE_INFINITY,H=typeof W.size=="number"?W.size:Number.POSITIVE_INFINITY;return G===H?0:G-H});case"default":default:return A}}),N=h(()=>x.value),M=n(()=>{s.value="",a.value=[],l.value=[],i.value=[],r.value="default"},"resetFilters"),$=n(A=>{a.value=a.value.filter(B=>B!==A)},"removeModelFilter"),I=n(A=>{l.value=l.value.filter(B=>B!==A)},"removeUseCaseFilter"),P=n(A=>{i.value=i.value.filter(B=>B!==A)},"removeRunsOnFilter"),z=h(()=>N.value.length),j=h(()=>u.value.length),D=nn(()=>{},500);return ae([s,a,l,i,r],()=>{(s.value.trim()!==""||a.value.length>0||l.value.length>0||i.value.length>0||r.value!=="default")&&D()},{deep:!0}),Jt(a,A=>{o.set("Comfy.Templates.SelectedModels",A)},{debounce:500,deep:!0}),Jt(l,A=>{o.set("Comfy.Templates.SelectedUseCases",A)},{debounce:500,deep:!0}),Jt(i,A=>{o.set("Comfy.Templates.SelectedRunsOn",A)},{debounce:500,deep:!0}),Jt(r,A=>{o.set("Comfy.Templates.SortBy",A)},{debounce:500}),{searchQuery:s,selectedModels:a,selectedUseCases:l,selectedRunsOn:i,sortBy:r,filteredTemplates:N,availableModels:v,availableUseCases:p,availableRunsOn:w,filteredCount:z,totalCount:j,resetFilters:M,removeModelFilter:$,removeUseCaseFilter:I,removeRunsOnFilter:P}}n(dy,"useTemplateFiltering");function Nl(){const{t:e}=pe(),o=ml(),t=vt(),s=L(null),a=L(null),l=h(()=>o.isLoaded),i=h(()=>o.groupedTemplates),r=n(async()=>(o.isLoaded||await o.loadWorkflowTemplates(),o.isLoaded),"loadTemplates"),u=n(()=>{if(i.value.length>0){const g=i.value[0].modules[0];f(g)}},"selectFirstTemplateCategory"),f=n(g=>(s.value=g,g!==null),"selectTemplateCategory"),m=n((g,b,S="1")=>{const _=b==="default"?Se.fileURL(`/templates/${g.name}`):Se.apiURL(`/workflow_templates/${b}/${g.name}`),C=b==="default"&&S?`-${S}`:"";return`${_}${C}.${g.mediaSubtype}`},"getTemplateThumbnailUrl"),v=n((g,b)=>{const S=g.title??g.name??`${b} Template`;return b==="default"?g.localizedTitle??S:S},"getTemplateTitle"),p=n(g=>(g.localizedDescription||g.description)?.replace(/[-_]/g," ").trim()??"","getTemplateDescription"),w=n(async(g,b)=>{if(!l.value)return!1;a.value=g;let S;try{if(b==="all"){const N=i.value.find(I=>I.label===e("templateWorkflows.category.ComfyUI Examples","ComfyUI Examples"))?.modules.find(I=>I.moduleName==="all")?.templates.find(I=>I.name===g);if(!N||!N.sourceModule)return!1;const M=N.sourceModule;S=await k(g,M);const $=M==="default"?e(`templateWorkflows.template.${g}`,g):g;return t.closeDialog(),await J.loadGraphData(S,!0,!0,$,{openSource:"template"}),!0}S=await k(g,b);const _=b==="default"?e(`templateWorkflows.template.${g}`,g):g;return t.closeDialog(),await J.loadGraphData(S,!0,!0,_,{openSource:"template"}),!0}catch(_){return console.error("Error loading workflow template:",_),!1}finally{a.value=null}},"loadWorkflowTemplate"),k=n(async(g,b)=>b==="default"?fetch(Se.fileURL(`/templates/${g}.json`)).then(S=>S.json()):fetch(Se.apiURL(`/workflow_templates/${b}/${g}.json`)).then(S=>S.json()),"fetchTemplateJson");return{selectedTemplate:s,loadingTemplateId:a,isTemplatesLoaded:l,allTemplateGroups:i,loadTemplates:r,selectFirstTemplateCategory:u,selectTemplateCategory:f,getTemplateThumbnailUrl:m,getTemplateTitle:v,getTemplateDescription:p,loadWorkflowTemplate:w}}n(Nl,"useTemplateWorkflows");function Il(e={}){const{minWidth:o="15rem",maxWidth:t="1fr",padding:s="0",gap:a="1rem",columns:l}=e;return l!==void 0&&l<1&&console.warn("createGridStyle: columns must be >= 1, defaulting to 1"),{display:"grid",gridTemplateColumns:l?`repeat(${Math.max(1,l??1)}, 1fr)`:`repeat(auto-fill, minmax(${o}, ${t}))`,padding:s,gap:a}}n(Il,"createGridStyle");const py={class:"text-neutral text-base"},fy={class:"flex gap-2"},my={class:"relative flex flex-wrap justify-between gap-2 px-6 pb-4"},gy={class:"flex flex-wrap gap-2"},vy={key:0,class:"text-neutral px-6 pt-4 pb-2 text-2xl font-semibold"},hy={key:0,class:"flex h-64 flex-col items-center justify-center text-neutral-500"},yy={class:"mb-2 text-lg"},by={class:"text-sm"},wy={key:1},ky={key:0,class:"inline-block h-8 w-48 animate-pulse rounded bg-dialog-surface"},Cy={class:"relative h-full w-full overflow-hidden rounded-lg"},xy={class:"flex flex-col gap-2 pt-3"},Sy=["title"],_y={class:"flex justify-between gap-2"},Ty={class:"flex-1"},$y=["title"],Ny={key:0,class:"flex flex-col-reverse justify-center"},Iy={key:0,class:"text-sm text-muted"},My={key:3,class:"mt-6 px-6 text-sm text-muted"},Py=q({__name:"WorkflowTemplateSelectorDialog",props:{onClose:{type:Function}},setup(e){const{t:o}=pe(),t=L(0),s=L(!1);Ve(()=>{t.value=Date.now()});const a=ns(),l=h(()=>[fl.Local]),i=n(()=>{e.onClose()},"onClose");on(cn,i);const r=ml(),{loadTemplates:u,loadWorkflowTemplate:f,getTemplateThumbnailUrl:m,getTemplateTitle:v,getTemplateDescription:p}=Nl(),w=n(te=>te.sourceModule||"default","getEffectiveSourceModule"),k=n(te=>{const Z=w(te);return m(te,Z,Z==="default"?"1":"")},"getBaseThumbnailSrc"),g=n(te=>{const Z=w(te);return m(te,Z,Z==="default"?"2":"")},"getOverlayThumbnailSrc"),b=n(te=>{te.tutorialUrl&&window.open(te.tutorialUrl,"_blank")},"openTutorial"),S=h(()=>Te.value?[{id:"skeleton-all",label:"All Templates",icon:"icon-[lucide--layout-grid]"},{id:"skeleton-basics",label:"Basics",icon:"icon-[lucide--graduation-cap]"},{title:"Generation Type",items:[{id:"skeleton-1",label:"...",icon:"icon-[lucide--loader-2]"},{id:"skeleton-2",label:"...",icon:"icon-[lucide--loader-2]"}]},{title:"Closed Source Models",items:[{id:"skeleton-3",label:"...",icon:"icon-[lucide--loader-2]"}]}]:r.navGroupedTemplates),_=h(()=>Il()),C=h(()=>r.enhancedTemplates),x=L("all"),N=h(()=>x.value?r.filterTemplatesByCategory(x.value):C.value),{searchQuery:M,selectedModels:$,selectedUseCases:I,selectedRunsOn:P,sortBy:z,filteredTemplates:j,availableModels:D,availableUseCases:A,availableRunsOn:B,filteredCount:W,totalCount:G,resetFilters:H}=dy(N),K=n(te=>{const Z=x.value==="popular",kt=z.value==="popular";te==="nav"?Z&&!kt?z.value="popular":!Z&&kt&&(z.value="default"):te==="sort"&&Z&&!kt&&(x.value="all")},"coordinateNavAndSort");ae(x,()=>K("nav")),ae(z,()=>K("sort"));const ee=h({get(){return $.value.map(te=>({name:te,value:te}))},set(te){$.value=te.map(Z=>Z.value)}}),ie=h({get(){return I.value.map(te=>({name:te,value:te}))},set(te){I.value=te.map(Z=>Z.value)}}),Y=h({get(){return P.value.map(te=>({name:te,value:te}))},set(te){P.value=te.map(Z=>Z.value)}}),oe=L(null),se=L(null),Ne=L([]),Ue=L(0),qe=L(""),nt=h(()=>D.value.map(te=>({name:te,value:te}))),Ke=h(()=>A.value.map(te=>({name:te,value:te}))),je=h(()=>B.value.map(te=>({name:te,value:te}))),yt=h(()=>ee.value.length===0?o("templateWorkflows.modelFilter","Model Filter"):ee.value.length===1?ee.value[0].name:o("templateWorkflows.modelsSelected",{count:ee.value.length})),bt=h(()=>ie.value.length===0?o("templateWorkflows.useCaseFilter","Use Case"):ie.value.length===1?ie.value[0].name:o("templateWorkflows.useCasesSelected",{count:ie.value.length})),po=h(()=>Y.value.length===0?o("templateWorkflows.runsOnFilter","Runs On"):Y.value.length===1?Y.value[0].name:o("templateWorkflows.runsOnSelected",{count:Y.value.length})),jt=h(()=>[{name:o("templateWorkflows.sort.default","Default"),value:"default"},{name:o("templateWorkflows.sort.recommended","Recommended"),value:"recommended"},{name:o("templateWorkflows.sort.popular","Popular"),value:"popular"},{name:o("templateWorkflows.sort.newest","Newest"),value:"newest"},{name:o("templateWorkflows.sort.vramLowToHigh","VRAM Usage (Low to High)"),value:"vram-low-to-high"},{name:o("templateWorkflows.sort.modelSizeLowToHigh","Model Size (Low to High)"),value:"model-size-low-to-high"},{name:o("templateWorkflows.sort.alphabetical","Alphabetical (A-Z)"),value:"alphabetical"}]),At=L(null),dt=h(()=>!M.value.trim()),{paginatedItems:Lt,isLoading:wt,hasMoreItems:st,loadNextPage:fo,reset:mo}=uy(j,{itemsPerPage:24}),Ht=h(()=>dt.value?Lt.value:j.value);xu(At,()=>{dt.value&&st.value&&!wt.value&&fo()}),ae([M,x,z,$,I,P],()=>{mo(),oe.value=null,Ue.value++});const fe=n(async te=>{oe.value=te.name;try{await f(te.name,w(te)),s.value=!0,i()}finally{oe.value=null}},"onLoadWorkflow"),xe=h(()=>{const te=S.value.find(Z=>"id"in Z?Z.id===x.value:Z.items?.some(kt=>kt.id===x.value));return te?"id"in te?te.label:te.items?.find(Z=>Z.id===x.value)?.label||o("templateWorkflows.allTemplates","All Templates"):o("templateWorkflows.allTemplates","All Templates")}),{isLoading:Te}=ei(async()=>(await Promise.all([u(),r.loadWorkflowTemplates()]),!0),!1,{immediate:!0}),Me=n(te=>(te.includeOnDistributions?.length??0)>0?l.value.some(Z=>te.includeOnDistributions?.includes(Z)):!0,"isTemplateVisibleOnDistribution");return rt(()=>{Ne.value=[]}),(te,Z)=>{const kt=Ie("tooltip");return d(),U(ds,{"content-title":te.$t("templateWorkflows.title","Workflow Templates"),class:"workflow-template-selector-dialog"},{leftPanel:E(()=>[F(ps,{modelValue:x.value,"onUpdate:modelValue":Z[0]||(Z[0]=re=>x.value=re),"nav-items":S.value},{"header-icon":E(()=>Z[8]||(Z[8]=[c("i",{class:"icon-[comfy--template]"},null,-1)])),"header-title":E(()=>[c("span",py,R(te.$t("sideToolbar.templates","Templates")),1)]),_:1},8,["modelValue","nav-items"])]),header:E(()=>[F(an,{modelValue:y(M),"onUpdate:modelValue":Z[1]||(Z[1]=re=>it(M)?M.value=re:null),size:"lg",class:"max-w-[384px]"},null,8,["modelValue"])]),"header-right-area":E(()=>[c("div",fy,[y(W)!==y(G)?(d(),U(X,{key:0,variant:"secondary",size:"lg",onClick:y(H)},{default:E(()=>[Z[9]||(Z[9]=c("i",{class:"icon-[lucide--filter-x]"},null,-1)),c("span",null,R(te.$t("templateWorkflows.resetFilters","Clear Filters")),1)]),_:1},8,["onClick"])):V("",!0)])]),contentFilter:E(()=>[c("div",my,[c("div",gy,[F(zt,{modelValue:ee.value,"onUpdate:modelValue":Z[2]||(Z[2]=re=>ee.value=re),"search-query":qe.value,"onUpdate:searchQuery":Z[3]||(Z[3]=re=>qe.value=re),class:"w-[250px]",label:yt.value,options:nt.value,"show-search-box":!0,"show-selected-count":!0,"show-clear-button":!0},{icon:E(()=>Z[10]||(Z[10]=[c("i",{class:"icon-[lucide--cpu]"},null,-1)])),_:1},8,["modelValue","search-query","label","options"]),F(zt,{modelValue:ie.value,"onUpdate:modelValue":Z[4]||(Z[4]=re=>ie.value=re),label:bt.value,options:Ke.value,"show-search-box":!0,"show-selected-count":!0,"show-clear-button":!0},{icon:E(()=>Z[11]||(Z[11]=[c("i",{class:"icon-[lucide--target]"},null,-1)])),_:1},8,["modelValue","label","options"]),F(zt,{modelValue:Y.value,"onUpdate:modelValue":Z[5]||(Z[5]=re=>Y.value=re),label:po.value,options:je.value,"show-search-box":!0,"show-selected-count":!0,"show-clear-button":!0},{icon:E(()=>Z[12]||(Z[12]=[c("i",{class:"icon-[lucide--server]"},null,-1)])),_:1},8,["modelValue","label","options"])]),c("div",null,[F(Ko,{modelValue:y(z),"onUpdate:modelValue":Z[6]||(Z[6]=re=>it(z)?z.value=re:null),label:te.$t("templateWorkflows.sorting","Sort by"),options:jt.value,class:"w-62.5"},{icon:E(()=>Z[13]||(Z[13]=[c("i",{class:"icon-[lucide--arrow-up-down] text-muted-foreground"},null,-1)])),_:1},8,["modelValue","label","options"])])]),y(Te)?V("",!0):(d(),T("div",vy,[c("span",null,R(xe.value),1)]))]),content:E(()=>[!y(Te)&&y(j).length===0?(d(),T("div",hy,[Z[14]||(Z[14]=c("i",{class:"mb-4 icon-[lucide--search] h-12 w-12 opacity-50"},null,-1)),c("p",yy,R(te.$t("templateWorkflows.noResults","No templates found")),1),c("p",by,R(te.$t("templateWorkflows.noResultsHint","Try adjusting your search or filters")),1)])):(d(),T("div",wy,[y(Te)?(d(),T("span",ky)):V("",!0),(d(),T("div",{key:Ue.value,style:he(_.value),"data-testid":"template-workflows-content"},[(d(!0),T(ne,null,be(y(Te)?12:0,re=>(d(),U(Bo,{key:`initial-skeleton-${re}`,size:"compact",variant:"ghost",rounded:"lg",class:"hover:bg-base-background"},{top:E(()=>[F(Fo,{ratio:"landscape"},{default:E(()=>Z[15]||(Z[15]=[c("div",{class:"h-full w-full animate-pulse bg-dialog-surface"},null,-1)])),_:1})]),bottom:E(()=>[F(zo,null,{default:E(()=>Z[16]||(Z[16]=[c("div",{class:"px-4 py-3"},[c("div",{class:"mb-2 h-6 animate-pulse rounded bg-dialog-surface"}),c("div",{class:"h-4 animate-pulse rounded bg-dialog-surface"})],-1)])),_:1})]),_:2},1024))),128)),(d(!0),T(ne,null,be(y(Te)?[]:Ht.value,re=>de((d(),U(Bo,{key:re.name,ref_for:!0,ref_key:"cardRefs",ref:Ne,size:"compact",variant:"ghost",rounded:"lg","data-testid":`template-workflow-${re.name}`,class:"hover:bg-base-background",onMouseenter:n(Et=>se.value=re.name,"onMouseenter"),onMouseleave:Z[7]||(Z[7]=Et=>se.value=null),onClick:n(Et=>fe(re),"onClick")},{top:E(()=>[F(Fo,{ratio:"square"},{default:E(()=>[c("div",Cy,[re.mediaType==="audio"?(d(),U(ty,{key:0,src:k(re)},null,8,["src"])):re.thumbnailVariant==="compareSlider"?(d(),U(ny,{key:1,"base-image-src":k(re),"overlay-image-src":g(re),alt:y(v)(re,w(re)),"is-hovered":se.value===re.name,"is-video":re.mediaType==="video"||re.mediaSubtype==="webp"},null,8,["base-image-src","overlay-image-src","alt","is-hovered","is-video"])):re.thumbnailVariant==="hoverDissolve"?(d(),U(ry,{key:2,"base-image-src":k(re),"overlay-image-src":g(re),alt:y(v)(re,w(re)),"is-hovered":se.value===re.name,"is-video":re.mediaType==="video"||re.mediaSubtype==="webp"},null,8,["base-image-src","overlay-image-src","alt","is-hovered","is-video"])):(d(),U(sy,{key:3,src:k(re),alt:y(v)(re,w(re)),"is-hovered":se.value===re.name,"is-video":re.mediaType==="video"||re.mediaSubtype==="webp","hover-zoom":re.thumbnailVariant==="zoomHover"?16:5},null,8,["src","alt","is-hovered","is-video","hover-zoom"])),oe.value===re.name?(d(),U(y(bi),{key:4,class:"absolute inset-0 z-10 m-auto h-12 w-12"})):V("",!0)])]),"bottom-right":E(()=>[re.tags&&re.tags.length>0?(d(!0),T(ne,{key:0},be(re.tags,Et=>(d(),U(Uo,{key:Et,label:Et},null,8,["label"]))),128)):V("",!0)]),_:2},1024)]),bottom:E(()=>[F(zo,null,{default:E(()=>[c("div",xy,[c("h3",{class:"m-0 line-clamp-1 text-sm",title:y(v)(re,w(re))},R(y(v)(re,w(re))),9,Sy),c("div",_y,[c("div",Ty,[c("p",{class:"m-0 line-clamp-2 text-sm text-muted",title:y(p)(re)},R(y(p)(re)),9,$y)]),re.tutorialUrl?(d(),T("div",Ny,[se.value===re.name?de((d(),U(X,Pt({key:0,ref_for:!0},te.$attrs,{variant:"inverted",size:"icon",onClick:Ce(Et=>b(re),["stop"])}),{default:E(()=>Z[17]||(Z[17]=[c("i",{class:"icon-[lucide--info] size-4"},null,-1)])),_:2},1040,["onClick"])),[[kt,te.$t("g.seeTutorial"),void 0,{bottom:!0}]]):V("",!0)])):V("",!0)])])]),_:2},1024)]),_:2},1032,["data-testid","onMouseenter","onClick"])),[[Qe,Me(re)]])),128)),(d(!0),T(ne,null,be(y(wt)?6:0,re=>(d(),U(Bo,{key:`skeleton-${re}`,size:"compact",variant:"ghost",rounded:"lg",class:"hover:bg-base-background"},{top:E(()=>[F(Fo,{ratio:"square"},{default:E(()=>Z[18]||(Z[18]=[c("div",{class:"h-full w-full animate-pulse bg-dialog-surface"},null,-1)])),_:1})]),bottom:E(()=>[F(zo,null,{default:E(()=>Z[19]||(Z[19]=[c("div",{class:"px-4 py-3"},[c("div",{class:"mb-2 h-6 animate-pulse rounded bg-dialog-surface"}),c("div",{class:"h-4 animate-pulse rounded bg-dialog-surface"})],-1)])),_:1})]),_:2},1024))),128))],4))])),!y(Te)&&y(st)?(d(),T("div",{key:2,ref_key:"loadTrigger",ref:At,class:"mt-4 flex h-4 w-full items-center justify-center"},[y(wt)?(d(),T("div",Iy,R(te.$t("templateWorkflows.loadingMore","Loading more...")),1)):V("",!0)],512)):V("",!0),y(Te)?V("",!0):(d(),T("div",My,R(te.$t("templateWorkflows.resultsCount",{count:y(W),total:y(G)})),1))]),_:1},8,["content-title"])}}}),ia="global-workflow-template-selector",bs=n(()=>{const e=tt(),o=vt();function t(){o.closeDialog({key:ia})}n(t,"hide");function s(a="command"){e.showLayoutDialog({key:ia,component:Py,props:{onClose:t},dialogComponentProps:{pt:{content:{class:"!px-0 overflow-hidden h-full !py-0"},root:{style:"width: 90vw; height: 85vh; max-width: 1400px; display: flex;"}}}})}return n(s,"show"),{show:s,hide:t}},"useWorkflowTemplateSelectorDialog"),Wn=n((e,o,t=30)=>{const s=e instanceof HTMLElement?e:e.target;let a=0;const l=setInterval(()=>{o(a++)},t),i=n(()=>{clearInterval(l),r(),u()},"dispose"),r=Ae(document,"mouseup",i),u=Ae(s,"mouseup",i);return{dispose:i}},"whileMouseDown"),Dy={class:"flex h-8 w-8 items-center justify-center rounded-lg bg-black"},Ay=["href","onMousedown","onClick"],Ly={class:"p-menubar-item-label text-nowrap"},Ey={key:3,class:"keybinding-tag ml-auto rounded border border-surface p-1 text-xs text-nowrap text-muted"},Oy={key:4,class:"pi pi-angle-right ml-auto"},Vy={class:"p-menubar-item-label text-nowrap"},Ry=q({__name:"ComfyMenuButton",setup(e){const{t:o}=pe(),t=_e(),s=el(),a=ct(),l=tl(),i=vt(),r=ft(),u=ue(),f=L(null),m=h({get:n(()=>u.get("Comfy.VueNodes.Enabled")??!1,"get"),set:n(async P=>{await u.set("Comfy.VueNodes.Enabled",P)},"set")});function v(P){f.value?.toggle(P)}n(v,"onLogoMenuClick");const p=n(P=>{const z=typeof P.label=="function"?P.label():P.label,j=z?o(`menuLabels.${We(z)}`,z):void 0;return{...P,label:j,items:P.items?.map(p)}},"translateMenuItem"),w=n(P=>{i.showDialog({key:"global-settings",headerComponent:Sr,component:xr,props:{defaultPanel:P}})},"showSettings"),k=n(async()=>{await r.openManager({initialTab:Xt.All,showToastOnLegacyError:!1})},"showManageExtensions"),g=h(()=>a.palettes.map(P=>({key:`theme-${P.id}`,label:P.name,parentPath:"theme",comfyCommand:{active:n(()=>a.activePaletteId===P.id,"active")},command:n(async()=>{await l.loadColorPalette(P.id)},"command")}))),b=h(()=>[{separator:!0},{key:"theme",label:o("menu.theme"),items:g.value},{key:"nodes-2.0-toggle",label:"Nodes 2.0"},{separator:!0},{key:"browse-templates",label:o("menuLabels.Browse Templates"),icon:"icon-[comfy--template]",command:n(()=>bs().show("menu"),"command")},{key:"settings",label:o("g.settings"),icon:"mdi mdi-cog-outline",command:n(()=>{w()},"command")},{key:"manage-extensions",label:o("menu.manageExtensions"),icon:"mdi mdi-puzzle-outline",command:k}]),S=h(()=>{const P=s.menuItems.map(p);let z=P.findIndex(D=>D.key==="Help"),j;if(z!==-1){P[z].icon="mdi mdi-help-circle-outline";const D=z!==P.length-1;j=P.splice(z,1,...D?[{separator:!0}]:[])[0]}return z=P.length,P.splice(z,0,...b.value,...j?[{separator:!0},j]:[]),P}),_=n(()=>{Re(()=>{f.value&&(f.value.dirty=!0)})},"onMenuShow"),C=n(P=>P.comfyCommand?.id==="Comfy.Canvas.ZoomIn"||P.comfyCommand?.id==="Comfy.Canvas.ZoomOut","isZoomCommand"),x=n((P,z)=>{P.comfyCommand&&Wn(z,async()=>{await t.execute(P.comfyCommand.id)},50)},"handleZoomMouseDown"),N=n((P,z)=>{if(C(P)||P.comfyCommand?.active)return z.preventDefault(),z.stopPropagation(),P.comfyCommand?.active&&P.command?.({item:P,originalEvent:z}),!1},"handleItemClick"),M=n(P=>P.parentPath&&(P.parentPath==="theme"||s.menuItemHasActiveStateChildren[P.parentPath]),"hasActiveStateSiblings"),$=n(()=>!1,"handleNodes2ToggleClick"),I=n(async P=>{await u.set("Comfy.VueNodes.Enabled",P)},"onNodes2ToggleChange");return(P,z)=>{const j=Ie("tooltip");return d(),T(ne,null,[de((d(),T("div",{class:Q(["comfy-menu-button-wrapper flex shrink-0 cursor-pointer flex-col items-center justify-center p-2 transition-colors",{"comfy-menu-button-active":f.value?.visible}]),onClick:z[0]||(z[0]=D=>v(D))},[c("div",Dy,[F(qh,{alt:"ComfyUI Logo",class:"comfyui-logo h-[18px] w-[18px] text-white",mode:"fill"})])],2)),[[j,{value:y(o)("sideToolbar.labels.menu"),showDelay:300,hideDelay:300}]]),F(y(wi),{ref_key:"menuRef",ref:f,model:S.value,popup:!0,class:"comfy-command-menu",onShow:_},{item:E(({item:D,props:A})=>[D.key!=="nodes-2.0-toggle"?(d(),T("a",Pt({key:0,class:"p-menubar-item-link px-4 py-2"},A.action,{href:D.url,target:"_blank",class:typeof D.class=="function"?D.class():D.class,onMousedown:n(B=>C(D)?x(D,B):void 0,"onMousedown"),onClick:n(B=>N(D,B),"onClick")}),[M(D)?(d(),T("i",{key:0,class:Q(["p-menubar-item-icon pi pi-check text-sm",{invisible:!D.comfyCommand?.active?.()}])},null,2)):D.icon&&D.comfyCommand?.id!=="Comfy.NewBlankWorkflow"?(d(),T("span",{key:1,class:Q(["p-menubar-item-icon text-sm",D.icon])},null,2)):V("",!0),c("span",Ly,R(D.label),1),D.comfyCommand?.id==="Comfy.NewBlankWorkflow"?(d(),T("i",{key:2,class:Q(["ml-auto",D.icon])},null,2)):V("",!0),D?.comfyCommand?.keybinding?(d(),T("span",Ey,R(D.comfyCommand.keybinding.combo.toString()),1)):V("",!0),D.items?(d(),T("i",Oy)):V("",!0)],16,Ay)):(d(),T("div",{key:1,class:"flex items-center justify-between px-4 py-2",onClick:Ce($,["stop"])},[c("span",Vy,R(D.label),1),F(y(Yt),{severity:"info",class:"ml-2 text-xs"},{default:E(()=>[$e(R(P.$t("g.beta")),1)]),_:1}),F(y(za),{modelValue:m.value,"onUpdate:modelValue":[z[1]||(z[1]=B=>m.value=B),I],class:"ml-4","aria-label":D.label,pt:{root:{style:{width:"38px",height:"20px"}},handle:{style:{width:"16px",height:"16px"}}},onClick:z[2]||(z[2]=Ce(()=>{},["stop"]))},null,8,["modelValue","aria-label"])]))]),_:1},8,["model"])],64)}}}),Wy=Ee(Ry,[["__scopeId","data-v-7f8c3b49"]]),zy={class:"side-bar-button-content"},By={key:0,class:"side-bar-button-label"},Fy=q({__name:"SidebarIcon",props:{icon:{default:""},selected:{type:Boolean,default:!1},tooltip:{default:""},tooltipSuffix:{default:""},iconBadge:{type:[String,Function],default:""},label:{default:""},isSmall:{type:Boolean,default:!1}},emits:["click"],setup(e,{emit:o}){const{t}=pe(),s=o,a=h(()=>typeof e.iconBadge=="function"?e.iconBadge()??"":e.iconBadge),l=h(()=>!!a.value),i=h(()=>t(e.tooltip)+e.tooltipSuffix);return(r,u)=>{const f=Ie("tooltip");return de((d(),U(X,{class:Q(y(le)("side-bar-button cursor-pointer border-none",r.selected&&"side-bar-button-selected")),variant:"muted-textonly","aria-label":i.value,onClick:u[0]||(u[0]=m=>s("click",m))},{default:E(()=>[c("div",zy,[ve(r.$slots,"icon",{},()=>[l.value?(d(),U(y(ki),{key:0,value:a.value},{default:E(()=>[typeof r.icon=="string"?(d(),T("i",{key:0,class:Q(r.icon+" side-bar-button-icon")},null,2)):(d(),U(eo(r.icon),{key:1,class:"side-bar-button-icon"}))]),_:1},8,["value"])):typeof r.icon=="string"?(d(),T("i",{key:1,class:Q(r.icon+" side-bar-button-icon")},null,2)):typeof r.icon=="object"?(d(),U(eo(r.icon),{key:2,class:"side-bar-button-icon"})):V("",!0)],!0),r.label&&!r.isSmall?(d(),T("span",By,R(y(t)(r.label)),1)):V("",!0)])]),_:3},8,["class","aria-label"])),[[f,{value:i.value,showDelay:300,hideDelay:300}]])}}}),Gt=Ee(Fy,[["__scopeId","data-v-bbb98ec9"]]),Uy=q({__name:"SidebarBottomPanelToggleButton",setup(e){const o=ao(),t=n(()=>{o.toggleBottomPanel()},"toggleConsole");return(s,a)=>(d(),U(Gt,{icon:"icon-[ph--terminal-bold]",label:s.$t("sideToolbar.labels.console"),tooltip:s.$t("menu.toggleBottomPanel"),selected:y(o).activePanel=="terminal",onClick:t},null,8,["label","tooltip","selected"]))}}),Gy=q({__name:"SidebarSettingsButton",setup(e){const{t:o}=pe(),{getCommand:t,formatKeySequence:s}=_e(),a=t("Comfy.ShowSettingsDialog"),l=h(()=>`${o("g.settings")} (${s(a)})`),i=n(()=>{a.function()},"showSettingsDialog");return(r,u)=>(d(),U(Gt,{icon:"icon-[lucide--settings]",label:r.$t("g.settings"),tooltip:l.value,onClick:i},null,8,["label","tooltip"]))}}),jy=q({__name:"SidebarShortcutsToggleButton",setup(e){const{t:o}=pe(),t=ao(),s=_e(),a=s.getCommand("Workspace.ToggleBottomPanel.Shortcuts"),{formatKeySequence:l}=s,i=h(()=>t.activePanel==="shortcuts"),r=h(()=>`${o("shortcuts.keyboardShortcuts")} (${l(a)})`),u=n(()=>{t.togglePanel("shortcuts")},"toggleShortcutsPanel");return(f,m)=>(d(),U(Gt,{icon:"icon-[lucide--keyboard]",label:f.$t("shortcuts.shortcuts"),tooltip:r.value,selected:i.value,onClick:u},null,8,["label","tooltip","selected"]))}}),Hy=["width","height"],qy={"clip-path":"url(#clip0_1099_16244)"},Ky=["stroke"],Qy=q({__name:"PuzzleIcon",props:{size:{default:16},color:{default:"currentColor"},class:{}},setup(e){const o=h(()=>e.class||"");return(t,s)=>(d(),T("svg",{xmlns:"http://www.w3.org/2000/svg",width:t.size,height:t.size,viewBox:"0 0 16 16",fill:"none",class:Q(o.value)},[c("g",qy,[c("path",{d:"M4.99992 3.00016C4.99992 2.07969 5.74611 1.3335 6.66658 1.3335C7.58706 1.3335 8.33325 2.07969 8.33325 3.00016V4.00016H8.99992C9.9318 4.00016 10.3977 4.00016 10.7653 4.1524C11.2553 4.35539 11.6447 4.74474 11.8477 5.2348C11.9999 5.60234 11.9999 6.06828 11.9999 7.00016H12.9999C13.9204 7.00016 14.6666 7.74635 14.6666 8.66683C14.6666 9.5873 13.9204 10.3335 12.9999 10.3335H11.9999V11.4668C11.9999 12.5869 11.9999 13.147 11.7819 13.5748C11.5902 13.9511 11.2842 14.2571 10.9079 14.4488C10.4801 14.6668 9.92002 14.6668 8.79992 14.6668H8.33325V13.5002C8.33325 12.6717 7.66168 12.0002 6.83325 12.0002C6.00482 12.0002 5.33325 12.6717 5.33325 13.5002V14.6668H4.53325C3.41315 14.6668 2.85309 14.6668 2.42527 14.4488C2.04895 14.2571 1.74299 13.9511 1.55124 13.5748C1.33325 13.147 1.33325 12.5869 1.33325 11.4668V10.3335H2.33325C3.25373 10.3335 3.99992 9.5873 3.99992 8.66683C3.99992 7.74635 3.25373 7.00016 2.33325 7.00016H1.33325C1.33325 6.06828 1.33325 5.60234 1.48549 5.2348C1.68848 4.74474 2.07783 4.35539 2.56789 4.1524C2.93543 4.00016 3.40137 4.00016 4.33325 4.00016H4.99992V3.00016Z",stroke:t.color,"stroke-width":"1.2","stroke-linecap":"round","stroke-linejoin":"round"},null,8,Ky)]),s[0]||(s[0]=c("defs",null,[c("clipPath",{id:"clip0_1099_16244"},[c("rect",{width:"16",height:"16",fill:"white"})])],-1))],10,Hy))}}),Jy=["aria-label"],Yy={class:"w-full"},Xy={class:"flex w-full flex-col gap-2",role:"menubar"},Zy=["onClick","onMouseenter","onMouseleave"],eb={class:"help-menu-icon-container"},tb={class:"help-menu-icon"},ob={key:0,class:"menu-red-dot"},nb={class:"menu-label"},sb={key:0,class:"icon-[lucide--external-link] text-primary w-4 h-4 ml-auto"},ab={key:1,class:"pi pi-chevron-right ml-auto"},lb={key:0,class:"submenu-divider"},ib=["onClick"],rb={class:"menu-label"},ub={key:0,class:"w-full","data-testid":"whats-new-section"},cb={class:"section-description flex items-center gap-2.5 self-stretch px-8 pt-2 pb-2"},db=["aria-label"],pb=["onClick","onKeydown"],fb={class:"release-content"},mb={class:"release-title"},gb=["datetime"],vb={class:"normal-state"},hb={class:"hover-state"},yb={key:1,class:"help-menu-item",role:"status","aria-live":"polite"},bb={key:2,class:"help-menu-item",role:"status"},wb=q({__name:"HelpCenterMenuContent",emits:["close"],setup(e,{emit:o}){const t={MINUTE:6e4,HOUR:36e5,DAY:864e5,WEEK:6048e5,MONTH:2592e6,YEAR:31536e6},s={DELAY_MS:100,OFFSET_PX:8,Z_INDEX:10001},{t:a}=pe(),l=Bt(),{staticUrls:i,buildDocsUrl:r}=io(),u=co(),f=_e(),m=ue(),v=L(Date.now()),p=o,w=L(!1),k=L(null),g=L({});let b=null;const S=h(()=>u.releases.length>0),_=h(()=>m.get("Comfy.Notification.ShowVersionUpdates")),{shouldShowRedDot:C}=ss(),{isNewManagerUI:x}=ft(),N=h(()=>[{key:"desktop-guide",type:"item",label:a("helpCenter.desktopUserGuide"),visible:Ge(),action:n(()=>{P(r("/installation/desktop",{includeLocale:!0,platform:!0})),p("close")},"action")},{key:"dev-tools",type:"item",label:a("helpCenter.openDevTools"),visible:Ge(),action:n(()=>{H(),p("close")},"action")},{key:"divider-1",type:"divider",visible:Ge()},{key:"reinstall",type:"item",label:a("helpCenter.reinstall"),visible:Ge(),action:n(()=>{K(),p("close")},"action")}].filter(oe=>oe.visible!==!1)),M=h(()=>!!N.value.length),$=h(()=>I.value.find(Y=>Y.key==="more")),I=h(()=>{const Y=[{key:"feedback",type:"item",icon:"icon-[lucide--clipboard-pen]",label:a("helpCenter.feedback"),action:n(()=>{f.execute("Comfy.ContactSupport"),p("close")},"action")},{key:"help",type:"item",icon:"icon-[lucide--message-circle-question]",label:a("helpCenter.help"),action:n(()=>{f.execute("Comfy.ContactSupport"),p("close")},"action")},{key:"docs",type:"item",icon:"icon-[lucide--book-open]",label:a("helpCenter.docs"),showExternalIcon:!0,action:n(()=>{P(r("/",{includeLocale:!0})),p("close")},"action")},{key:"discord",type:"item",icon:"pi pi-discord",label:"Discord",showExternalIcon:!0,action:n(()=>{P(i.discord),p("close")},"action")},{key:"github",type:"item",icon:"icon-[lucide--github]",label:a("helpCenter.github"),showExternalIcon:!0,action:n(()=>{P(i.github),p("close")},"action")}];return Y.push({key:"manager",type:"item",icon:Qy,label:a("helpCenter.managerExtension"),showRedDot:C.value,action:n(async()=>{await ft().openManager({initialTab:Xt.All,showToastOnLegacyError:!1}),p("close")},"action")}),!Ge()&&!mt&&x.value&&Y.push({key:"update-comfyui",type:"item",icon:"icon-[lucide--download]",label:a("helpCenter.updateComfyUI"),action:n(()=>{ee(),p("close")},"action")}),Y.push({key:"more",type:"item",icon:"",label:a("helpCenter.more"),visible:M.value,action:n(()=>{},"action"),items:N.value}),Y}),P=n(Y=>{window.open(Y,"_blank","noopener,noreferrer")},"openExternalLink"),z=n(()=>{b&&(clearTimeout(b),b=null)},"clearHoverTimeout"),j=n(Y=>{const oe=Y.getBoundingClientRect(),se=210,Ue=($.value?.items?.filter(bt=>bt.visible!==!1).length||0)*48+16,qe=k.value?.offsetHeight||Ue,nt=window.innerWidth,Ke=window.innerHeight;let je=oe.top,yt=oe.right+s.OFFSET_PX;return yt+se>nt&&(yt=oe.left-se-s.OFFSET_PX),je+qe>Ke&&(je=Math.max(s.OFFSET_PX,oe.bottom-qe)),je<s.OFFSET_PX&&(je=s.OFFSET_PX),je-=8,{position:"fixed",top:`${je}px`,left:`${yt}px`,zIndex:s.Z_INDEX}},"calculateSubmenuPosition"),D=n(Y=>{if(!Y)return"date";const oe=new Date(Y),Ne=Math.abs(new Date().getTime()-oe.getTime()),Ue=[{unit:t.YEAR,key:"yearsAgo"},{unit:t.MONTH,key:"monthsAgo"},{unit:t.WEEK,key:"weeksAgo"},{unit:t.DAY,key:"daysAgo"},{unit:t.HOUR,key:"hoursAgo"},{unit:t.MINUTE,key:"minutesAgo"}];for(const{unit:qe,key:nt}of Ue){const Ke=Math.floor(Ne/qe);if(Ke>0)return a(`g.relativeTime.${nt}`,{count:Ke})}return a("g.relativeTime.now")},"formatReleaseDate"),A=n(async(Y,oe)=>{if(Y!=="more"||!$.value?.items||!$.value.items.some(Ue=>Ue.visible!==!1))return;z();const Ne=oe.currentTarget;g.value=j(Ne),w.value=!0,await Re(),k.value&&(g.value=j(Ne))},"onMenuItemHover"),B=n(Y=>{Y==="more"&&(b=window.setTimeout(()=>{w.value=!1},s.DELAY_MS))},"onMenuItemLeave"),W=n(()=>{z()},"onSubmenuHover"),G=n(()=>{w.value=!1},"onSubmenuLeave"),H=n(()=>{Ge()&&bo().openDevTools()},"openDevTools"),K=n(()=>{Ge()&&bo().reinstall()},"onReinstall"),ee=n(async()=>{const{updateComfyUI:Y,rebootComfyUI:oe,error:se}=ol();l.add({severity:"info",summary:a("helpCenter.updateComfyUIStarted"),detail:a("helpCenter.updateComfyUIStartedDetail"),life:3e3});try{if(await Y({is_stable:!0})===null||se.value){l.add({severity:"error",summary:a("g.error"),detail:se.value||a("helpCenter.updateComfyUIFailed"),life:5e3});return}l.add({severity:"success",summary:a("helpCenter.updateComfyUISuccess"),detail:a("helpCenter.updateComfyUISuccessDetail"),life:3e3}),await oe()}catch(Ne){l.add({severity:"error",summary:a("g.error"),detail:Ne instanceof Error?Ne.message:a("g.unknownError"),life:5e3})}},"onUpdateComfyUI"),ie=n(Y=>{u.handleShowChangelog(Y.version);const oe=us(Y.version),se=`${r("/changelog",{includeLocale:!0})}#${oe}`;P(se),p("close")},"onReleaseClick");return Ve(async()=>{S.value||await u.fetchReleases()}),rt(()=>{Math.round((Date.now()-v.value)/1e3)}),(Y,oe)=>(d(),T("div",{class:"help-center-menu flex flex-col items-start gap-1",role:"menu","aria-label":Y.$t("help.helpCenterMenu")},[c("div",Yy,[c("nav",Xy,[(d(!0),T(ne,null,be(I.value,se=>de((d(),T("button",{key:se.key,type:"button",class:Q(["help-menu-item",{"more-item":se.key==="more"}]),role:"menuitem",onClick:se.action,onMouseenter:n(Ne=>A(se.key,Ne),"onMouseenter"),onMouseleave:n(Ne=>B(se.key),"onMouseleave")},[c("div",eb,[c("div",tb,[typeof se.icon=="object"?(d(),U(eo(se.icon),{key:0,size:16})):(d(),T("i",{key:1,class:Q(se.icon)},null,2))]),se.showRedDot?(d(),T("div",ob)):V("",!0)]),c("span",nb,R(se.label),1),se.showExternalIcon?(d(),T("i",sb)):V("",!0),se.key==="more"?(d(),T("i",ab)):V("",!0)],42,Zy)),[[Qe,se.visible!==!1]])),128))]),oe[0]||(oe[0]=c("div",{class:"flex h-4 flex-col items-center justify-between self-stretch p-2"},[c("div",{class:"w-full border-b border-interface-menu-stroke"})],-1))]),(d(),U(Nt,{to:"body"},[w.value?(d(),T("div",{key:0,ref_key:"submenuRef",ref:k,class:"more-submenu",style:he(g.value),onMouseenter:W,onMouseleave:G},[(d(!0),T(ne,null,be($.value?.items,se=>(d(),T(ne,{key:se.key},[se.type==="divider"?de((d(),T("div",lb,null,512)),[[Qe,se.visible!==!1]]):de((d(),T("button",{key:1,type:"button",class:"help-menu-item submenu-item",role:"menuitem",onClick:se.action},[c("span",rb,R(se.label),1)],8,ib)),[[Qe,se.visible!==!1]])],64))),128))],36)):V("",!0)])),_.value?(d(),T("section",ub,[c("h3",cb,R(Y.$t("helpCenter.whatsNew")),1),S.value?(d(),T("div",{key:0,role:"group","aria-label":Y.$t("help.recentReleases")},[(d(!0),T(ne,null,be(y(u).recentReleases,se=>(d(),T("article",{key:se.id||se.version,class:"release-menu-item flex h-12 min-h-6 cursor-pointer items-center gap-2 self-stretch rounded p-2 transition-colors hover:bg-interface-menu-component-surface-hovered",role:"button",tabindex:"0",onClick:n(Ne=>ie(se),"onClick"),onKeydown:[Zt(Ne=>ie(se),["enter"]),Zt(Ce(Ne=>ie(se),["prevent"]),["space"])]},[oe[1]||(oe[1]=c("i",{class:"help-menu-icon icon-[lucide--package]","aria-hidden":"true"},null,-1)),c("div",fb,[c("span",mb,R(Y.$t("g.releaseTitle",{package:"Comfy",version:se.version})),1),c("time",{class:"release-date",datetime:se.published_at},[c("span",vb,R(D(se.published_at)),1),c("span",hb,R(Y.$t("helpCenter.clickToLearnMore")),1)],8,gb)])],40,pb))),128))],8,db)):y(u).isLoading?(d(),T("div",yb,[oe[2]||(oe[2]=c("i",{class:"pi pi-spin pi-spinner help-menu-icon","aria-hidden":"true"},null,-1)),c("span",null,R(Y.$t("helpCenter.loadingReleases")),1)])):(d(),T("div",bb,[oe[3]||(oe[3]=c("i",{class:"pi pi-info-circle help-menu-icon","aria-hidden":"true"},null,-1)),c("span",null,R(Y.$t("helpCenter.noRecentReleases")),1)]))])):V("",!0)],8,Jy))}}),kb=Ee(wb,[["__scopeId","data-v-8ecd06e2"]]),Cb={key:0,class:"release-toast-popup"},xb={class:"w-96 max-h-96 bg-base-background border border-border-default rounded-lg shadow-[1px_1px_8px_0_rgba(0,0,0,0.4)] flex flex-col"},Sb={class:"p-4 flex flex-col gap-4 flex-1 min-h-0"},_b={class:"flex items-center gap-4"},Tb={class:"flex flex-col gap-1"},$b={class:"text-sm font-normal text-base-foreground leading-[1.429]"},Nb={class:"text-sm font-normal text-muted-foreground leading-[1.21]"},Ib=["innerHTML"],Mb={class:"flex justify-between items-center px-4 pb-4"},Pb=["href"],Db={class:"flex items-center gap-4"},Ab=q({__name:"ReleaseNotificationToast",setup(e,{expose:o}){const{buildDocsUrl:t}=io(),{toastErrorHandler:s}=Ft(),a=co(),{t:l}=pe(),i=L(!1),r=h(()=>a.recentRelease),u=h(()=>a.shouldShowToast&&!i.value),f=h(()=>{const _=t("/changelog",{includeLocale:!0});if(r.value?.version){const C=us(r.value.version);return`${_}#${C}`}return _}),m=h(()=>{if(!r.value?.content)return St.sanitize(`<p>${l("releaseToast.description")}</p>`);try{const x=r.value.content.replace(/^# .+$/m,"").replace(/!\[.*?\]\(.*?\)/g,""),N=x.trim();return!N||N.replace(/\s+/g,"")===""?St.sanitize(`<p>${l("releaseToast.description")}</p>`):nl(x)}catch(_){console.error("Error parsing markdown:",_);const C=r.value.content.replace(/\n/g,"<br>");return C.trim()?St.sanitize(C):St.sanitize(`<p>${l("releaseToast.description")}</p>`)}});let v=null;const p=n(()=>{v&&clearTimeout(v),v=setTimeout(()=>{k()},8e3)},"startAutoHide"),w=n(()=>{v&&(clearTimeout(v),v=null)},"clearAutoHide"),k=n(()=>{i.value=!0,w()},"dismissToast"),g=n(()=>{r.value&&a.handleSkipRelease(r.value.version),k()},"handleSkip"),b=n(()=>{r.value&&a.handleShowChangelog(r.value.version),k()},"handleLearnMore"),S=n(async()=>{if(Ge()){try{await _e().execute("Comfy-Desktop.CheckForUpdates"),k()}catch(_){s(_)}return}window.open(t("/installation/update_comfyui",{includeLocale:!0}),"_blank"),k()},"handleUpdate");return ae(u,_=>{_?p():w()}),Ve(async()=>{a.releases.length||await a.fetchReleases()}),o({handleSkip:g,handleLearnMore:b,handleUpdate:S}),(_,C)=>u.value?(d(),T("div",Cb,[c("div",xb,[c("div",Sb,[c("div",_b,[C[0]||(C[0]=c("div",{class:"p-3 bg-primary-background-hover rounded-lg flex items-center justify-center shrink-0"},[c("i",{class:"icon-[lucide--rocket] w-4 h-4 text-white"})],-1)),c("div",Tb,[c("div",$b,R(_.$t("releaseToast.newVersionAvailable")),1),c("div",Nb,R(r.value?.version),1)])]),c("div",{class:"pl-14 text-sm font-normal text-muted-foreground leading-[1.21] overflow-y-auto flex-1 min-h-0",innerHTML:m.value},null,8,Ib)]),c("div",Mb,[c("a",{class:"flex items-center gap-2 text-sm font-normal py-1 text-muted-foreground hover:text-base-foreground",href:f.value,target:"_blank",rel:"noopener noreferrer",onClick:b},[C[1]||(C[1]=c("i",{class:"icon-[lucide--external-link] w-4 h-4"},null,-1)),$e(" "+R(_.$t("releaseToast.whatsNew")),1)],8,Pb),c("div",Db,[c("button",{class:"h-6 px-0 bg-transparent border-none text-sm font-normal text-muted-foreground hover:text-base-foreground cursor-pointer",onClick:g},R(_.$t("releaseToast.skip")),1),c("button",{class:"h-10 px-4 bg-secondary-background hover:bg-secondary-background-hover rounded-lg border-none text-sm font-normal text-base-foreground cursor-pointer",onClick:S},R(_.$t("releaseToast.update")),1)])])])])):V("",!0)}}),Lb=Ee(Ab,[["__scopeId","data-v-ba02c61a"]]),Eb={key:0,class:"whats-new-popup-container left-4"},Ob={class:"modal-body flex flex-col gap-4 px-0 pt-0 pb-2 flex-1"},Vb=["innerHTML"],Rb={class:"modal-footer flex justify-between items-center gap-4 px-4 pb-4"},Wb=["href"],zb={class:"footer-actions flex items-center gap-4"},Bb=q({__name:"WhatsNewPopup",emits:["whats-new-dismissed"],setup(e,{expose:o,emit:t}){const{buildDocsUrl:s}=io(),a=co(),{t:l}=pe(),i=t,r=L(!1),u=h(()=>a.recentRelease),f=h(()=>a.shouldShowPopup&&!r.value),m=h(()=>{const g=s("/changelog",{includeLocale:!0});if(u.value?.version){const b=us(u.value.version);return`${g}#${b}`}return g}),v=h(()=>{if(!u.value?.content)return St.sanitize(`<p>${l("whatsNewPopup.noReleaseNotes")}</p>`);try{const g=u.value.content,b=g.trim();if(!b||b.replace(/\s+/g,"")==="")return St.sanitize(`<p>${l("whatsNewPopup.noReleaseNotes")}</p>`);const S=g.match(/!\[.*?\]\(.*?\)/),_=S?S[0]:"",C=g.replace(/!\[.*?\]\(.*?\)/,"").trim(),x=[_,C].filter(Boolean).join(`

`);return nl(x)}catch(g){console.error("Error parsing markdown:",g);const b=u.value.content.replace(/\n/g,"<br>");return b.trim()?St.sanitize(b):St.sanitize(`<p>${l("whatsNewPopup.noReleaseNotes")}</p>`)}}),p=n(()=>{r.value=!1},"show"),w=n(()=>{r.value=!0,i("whats-new-dismissed")},"hide"),k=n(async()=>{u.value&&await a.handleWhatsNewSeen(u.value.version),w()},"closePopup");return Ve(async()=>{a.releases.length||await a.fetchReleases()}),o({show:p,hide:w,closePopup:k}),(g,b)=>f.value?(d(),T("div",Eb,[c("div",{class:"whats-new-popup",onClick:b[0]||(b[0]=Ce(()=>{},["stop"]))},[F(X,{class:"close-button absolute top-2 right-2 z-10 w-8 h-8 p-2 rounded-lg opacity-50","aria-label":g.$t("g.close"),size:"icon-sm",variant:"muted-textonly",onClick:k},{default:E(()=>b[1]||(b[1]=[c("i",{class:"icon-[lucide--x]"},null,-1)])),_:1},8,["aria-label"]),c("div",Ob,[c("div",{class:"content-text max-h-96 overflow-y-auto",innerHTML:v.value},null,8,Vb)]),c("div",Rb,[c("a",{class:"learn-more-link flex items-center gap-2 text-sm font-normal py-1",href:m.value,target:"_blank",rel:"noopener noreferrer",onClick:k},[b[2]||(b[2]=c("i",{class:"icon-[lucide--external-link]"},null,-1)),$e(" "+R(g.$t("whatsNewPopup.learnMore")),1)],8,Wb),c("div",zb,[F(X,{class:"h-8",size:"sm",variant:"muted-textonly",onClick:k},{default:E(()=>[$e(R(g.$t("whatsNewPopup.later")),1)]),_:1})])])])])):V("",!0)}}),Fb=Ee(Bb,[["__scopeId","data-v-98a9f324"]]),zn=Dt("helpCenter",()=>{const e=L(!1);return{isVisible:e,toggle:n(()=>{e.value=!e.value},"toggle"),show:n(()=>{e.value=!0},"show"),hide:n(()=>{e.value=!1},"hide")}}),Ub=q({__name:"SidebarHelpCenterIcon",props:{isSmall:{type:Boolean}},setup(e){const o=ue(),t=co(),s=zn(),{isVisible:a}=Fe(s),{shouldShowRedDot:l}=Fe(t),i=sl(),{showNodeConflictDialog:r}=tt(),{shouldShowRedDot:u,markConflictsAsSeen:f}=ss(),m=e,{isSmall:v}=Ia(m),p=h(()=>l.value||u.value),w=h(()=>o.get("Comfy.Sidebar.Location")),k=n(()=>{s.toggle()},"toggleHelpCenter"),g=n(()=>{s.hide()},"closeHelpCenter"),b=n(async()=>{try{await i.shouldShowConflictModalAfterUpdate()&&S()}catch(_){console.error("[HelpCenter] Error checking conflict modal:",_)}},"handleWhatsNewDismissed"),S=n(()=>{r({showAfterWhatsNew:!0,dialogComponentProps:{onClose:n(()=>{f()},"onClose")}})},"showConflictModal");return Ve(async()=>{await t.initialize()}),(_,C)=>(d(),T("div",null,[F(Gt,{icon:"pi pi-question-circle",class:"comfy-help-center-btn",label:_.$t("menu.help"),tooltip:_.$t("sideToolbar.helpCenter"),"icon-badge":p.value?"":"","is-small":y(v),onClick:k},null,8,["label","tooltip","icon-badge","is-small"]),(d(),U(Nt,{to:"#graph-canvas-container"},[y(a)?(d(),T("div",{key:0,class:Q(["help-center-popup",{"sidebar-left":w.value==="left","sidebar-right":w.value==="right","small-sidebar":y(v)}])},[F(kb,{onClose:g})],2)):V("",!0)])),(d(),U(Nt,{to:"#graph-canvas-container"},[F(Lb,{class:Q({"sidebar-left":w.value==="left","sidebar-right":w.value==="right","small-sidebar":y(v)})},null,8,["class"])])),(d(),U(Nt,{to:"#graph-canvas-container"},[F(Fb,{class:Q({"sidebar-left":w.value==="left","sidebar-right":w.value==="right","small-sidebar":y(v)}),onWhatsNewDismissed:b},null,8,["class"])])),(d(),U(Nt,{to:"body"},[y(a)?(d(),T("div",{key:0,class:"help-center-backdrop",onClick:g})):V("",!0)]))]))}}),Gb=Ee(Ub,[["__scopeId","data-v-91ae5559"]]),jb=q({__name:"SidebarLogoutIcon",setup(e){const{t:o}=pe(),t=al(),s=h(()=>`${o("sideToolbar.logout")} (${t.currentUser?.username})`),a=n(async()=>{await t.logout(),window.location.reload()},"logout");return(l,i)=>(d(),U(Gt,{icon:"pi pi-sign-out",tooltip:s.value,label:l.$t("sideToolbar.logout"),onClick:a},null,8,["tooltip","label"]))}}),Hb=q({__name:"SidebarTemplatesButton",setup(e){const o=ue(),t=h(()=>o.get("Comfy.Sidebar.Size")==="small"),s=n(()=>{bs().show("sidebar")},"openTemplates");return(a,l)=>(d(),U(Gt,{icon:"icon-[comfy--template]",tooltip:a.$t("sideToolbar.templates"),label:a.$t("sideToolbar.labels.templates"),"is-small":t.value,class:"templates-tab-button",onClick:s},null,8,["tooltip","label","is-small"]))}}),qb=20,Kb=50,Qb=q({__name:"SideToolbar",setup(e){const o=ot(),t=ue(),s=al(),a=_e(),l=me(),i=L(),r=L(),u=L(),f=h(()=>t.get("Comfy.Sidebar.Size")==="small"),m=h(()=>t.get("Comfy.Sidebar.Location")),v=h(()=>t.get("Comfy.Sidebar.Style")),p=h(()=>k.value||_.value||v.value==="connected"),w=h(()=>o.getSidebarTabs()),k=h(()=>o.sidebarTab.activeSidebarTab),g=n(async N=>{N.id,N.id,N.id,N.id,await a.commands.find(M=>M.id===`Workspace.ToggleSidebarTab.${N.id}`)?.function?.()},"onTabClick"),b=_r(),S=n(N=>{const M=b.getKeybindingByCommandId(`Workspace.ToggleSidebarTab.${N.id}`);return M?` (${M.combo.toString()})`:""},"getTabTooltipSuffix"),_=L(!1),C=h(()=>le("sidebar-item-group flex flex-col items-center overflow-hidden flex-shrink-0"+(p.value?"":" rounded-lg shadow-interface"))),x=nn(()=>{if(!i.value||!r.value||!u.value)return;const N=i.value.clientHeight,M=r.value.scrollHeight,$=u.value.scrollHeight,I=M+$;_.value?_.value=N<I+Kb:_.value=N<I+qb},16);return Ve(()=>{if(!i.value)return;const N=ka(i.value,x);x(),rt(()=>{N.stop()}),ae([f,m],async()=>{l.canvas&&(m.value==="left"?(await Re(),l.canvas.fpsInfoLocation=[i.value?.getBoundingClientRect()?.right,null]):l.canvas.fpsInfoLocation=null,l.canvas.setDirty(!1,!0))},{immediate:!0})}),(N,M)=>(d(),T("nav",{ref_key:"sideToolbarRef",ref:i,class:Q(["side-tool-bar-container flex h-full flex-col items-center bg-transparent [.floating-sidebar]:-mr-2 pointer-events-auto",{"small-sidebar":f.value,"connected-sidebar":p.value,"floating-sidebar":!p.value,"overflowing-sidebar":_.value,"border-r border-[var(--interface-stroke)] shadow-interface":p.value}])},[c("div",{class:Q(_.value?"side-tool-bar-container overflow-y-auto":"flex flex-col h-full")},[c("div",{ref_key:"topToolbarRef",ref:r,class:Q(C.value)},[F(Wy),(d(!0),T(ne,null,be(w.value,$=>(d(),U(Gt,{key:$.id,icon:$.icon,"icon-badge":$.iconBadge,tooltip:$.tooltip,"tooltip-suffix":S($),label:$.label||$.title,"is-small":f.value,selected:$.id===k.value?.id,class:Q($.id+"-tab-button"),onClick:n(I=>g($),"onClick")},null,8,["icon","icon-badge","tooltip","tooltip-suffix","label","is-small","selected","class","onClick"]))),128)),F(Hb)],2),c("div",{ref_key:"bottomToolbarRef",ref:u,class:Q(["mt-auto",C.value])},[y(s).isMultiUserServer?(d(),U(jb,{key:0,"is-small":f.value},null,8,["is-small"])):V("",!0),F(Gb,{"is-small":f.value},null,8,["is-small"]),F(Uy,{"is-small":f.value},null,8,["is-small"]),F(jy,{"is-small":f.value},null,8,["is-small"]),F(Gy,{"is-small":f.value},null,8,["is-small"])],2)],2)],2))}}),Jb=Ee(Qb,[["__scopeId","data-v-2a2f0be8"]]),Yb=Dt("topbarBadge",()=>{const e=os();return{badges:h(()=>e.extensions.flatMap(t=>t.topbarBadges??[]))}}),Xb={class:"flex h-full shrink-0 items-center"},Ml=q({__name:"TopbarBadges",props:{reverseOrder:{type:Boolean,default:!1},noPadding:{type:Boolean,default:!1}},setup(e){const o=Xo(tn),t=o.greaterOrEqual("xl"),s=o.greaterOrEqual("lg"),a=h(()=>t.value?"full":s.value?"compact":"icon-only"),l=Yb();return(i,r)=>(d(),T("div",Xb,[(d(!0),T(ne,null,be(y(l).badges,u=>(d(),U(ad,{key:u.text,badge:u,"display-mode":a.value,"reverse-order":i.reverseOrder,"no-padding":i.noPadding},null,8,["badge","display-mode","reverse-order","no-padding"]))),128))]))}}),Zb={class:"workflow-preview-content"},ew={key:0,class:"workflow-preview-thumbnail relative"},tw=["src"],ow={class:"workflow-preview-footer"},nw={class:"workflow-preview-name"},sw=250,aw=q({__name:"WorkflowTabPopover",props:{workflowFilename:{},thumbnailUrl:{},isActiveTab:{type:Boolean}},setup(e,{expose:o}){const t=e,{thumbnailUrl:s,isActiveTab:a}=Ia(t),l=L(null),i=L(null);let r=null,u=null;const f=Mn(),m=n(k=>{r&&(clearTimeout(r),r=null),u&&(clearTimeout(u),u=null),u=setTimeout(async()=>{if(l.value&&i.value){l.value.show(k,i.value),await Re();const g=document.querySelector(`.workflow-popover-fade[data-popover-id="${f}"]`);if(g){const b=i.value.getBoundingClientRect().left,S=g.getBoundingClientRect().width,_=S/2;let C=b-_,x=0;if(C<0)x=C-8,C=8;else if(C+S>window.innerWidth){const N=window.innerWidth-S-16;x=C-N,C=N}x+_<0&&(x=-_+24),g.style.left=`${C}px`,g.style.setProperty("--shift",`${x}px`)}}},200)},"showPopover"),v=n(()=>{},"cancelHidePopover"),p=n(()=>{u&&(clearTimeout(u),u=null),r=setTimeout(()=>{l.value&&l.value.hide()},100)},"hidePopover");return o({showPopover:m,hidePopover:p,togglePopover:n(k=>{l.value&&l.value.toggle(k)},"togglePopover")}),(k,g)=>(d(),T(ne,null,[c("div",{ref_key:"positionRef",ref:i,class:"absolute bottom-0 left-1/2 -translate-x-1/2"},null,512),F(y(Ye),{ref_key:"popoverRef",ref:l,"append-to":"body",pt:{root:{class:"workflow-popover-fade fit-content","data-popover-id":y(f)}},onMouseenter:v,onMouseleave:p},{default:E(()=>[c("div",Zb,[y(s)&&!y(a)?(d(),T("div",ew,[c("img",{src:y(s),class:"block h-[200px] rounded-lg object-cover p-2",style:he({width:`${sw}px`})},null,12,tw)])):V("",!0),c("div",ow,[c("span",nw,R(k.workflowFilename),1)])])]),_:1},8,["pt"])],64))}}),lw=Ee(aw,[["__scopeId","data-v-4c13cb50"]]),iw={class:"workflow-label inline-block max-w-[150px] truncate text-sm"},rw={class:"relative"},uw={key:0,class:"absolute top-1/2 left-1/2 z-10 w-4 -translate-1/2 bg-(--comfy-menu-bg) text-2xl font-bold group-hover:hidden"},cw=q({__name:"WorkflowTab",props:{workflowOption:{}},setup(e){const o=e,{t}=pe(),s=ot(),a=Le(),l=ue(),i=L(null),r=L(null),u=Tr(),f=h(()=>l.get("Comfy.Workflow.AutoSave")),m=h(()=>l.get("Comfy.Workflow.AutoSaveDelay")),v=h(()=>s.shiftDown?!1:o.workflowOption.workflow.isPersisted?o.workflowOption.workflow.isModified?f.value==="off"||f.value==="after delay"&&m.value>3e3:!1:!0),p=h(()=>a.activeWorkflow?.key===o.workflowOption.workflow.key),w=h(()=>u.getThumbnail(o.workflowOption.workflow.key)),k=n(x=>{r.value?.showPopover(x)},"handleMouseEnter"),g=n(()=>{r.value?.hidePopover()},"handleMouseLeave"),b=n(x=>{r.value?.togglePopover(x)},"handleClick"),S=n(async x=>{for(const N of x)if(!await Xe().closeWorkflow(N.workflow,{warnIfUnsaved:!s.shiftDown,hint:t("sideToolbar.workflowTab.dirtyCloseHint")}))break},"closeWorkflows"),_=n(async x=>{await S([x])},"onCloseWorkflow"),C=n(()=>i.value,"tabGetter");return $r(C,{getInitialData:n(()=>({workflowKey:o.workflowOption.workflow.key}),"getInitialData")}),ll(C,{getData:n(()=>({workflowKey:o.workflowOption.workflow.key}),"getData"),onDrop:n(x=>{const N=a.openWorkflows.findIndex($=>$.key===x.source.data.workflowKey),M=a.openWorkflows.findIndex($=>$.key===x.location.current.dropTargets[0]?.data.workflowKey);N!==M&&a.reorderWorkflows(N,M)},"onDrop")}),ut(()=>{r.value?.hidePopover()}),(x,N)=>(d(),T(ne,null,[c("div",Pt({ref_key:"workflowTabRef",ref:i,class:"workflow-tab group flex gap-2 p-2"},x.$attrs,{onMouseenter:k,onMouseleave:g,onClick:b}),[c("span",iw,R(x.workflowOption.workflow.filename),1),c("div",rw,[v.value?(d(),T("span",uw,"")):V("",!0),F(X,{class:"close-button invisible w-auto p-0",variant:"muted-textonly",size:"icon-sm","aria-label":y(t)("g.close"),onClick:N[0]||(N[0]=Ce(M=>_(x.workflowOption),["stop"]))},{default:E(()=>N[1]||(N[1]=[c("i",{class:"pi pi-times"},null,-1)])),_:1},8,["aria-label"])])],16),F(lw,{ref_key:"popoverRef",ref:r,"workflow-filename":x.workflowOption.workflow.filename,"thumbnail-url":w.value,"is-active-tab":p.value},null,8,["workflow-filename","thumbnail-url","is-active-tab"])],64))}}),dw=q({__name:"WorkflowOverflowMenu",props:{workflows:{},activeWorkflow:{}},setup(e){const o=e,t=L(null),s=Xe(),a=h(()=>o.workflows.map(l=>({label:l.filename,icon:o.activeWorkflow?.key===l.key?"pi pi-check":void 0,command:n(()=>{s.openWorkflow(l)},"command")})));return(l,i)=>{const r=Ie("tooltip");return d(),T("div",null,[de((d(),U(X,{class:"rounded-none h-full w-auto aspect-square",variant:"muted-textonly",size:"icon","aria-label":l.$t("g.moreWorkflows"),onClick:i[0]||(i[0]=u=>t.value?.toggle(u))},{default:E(()=>i[1]||(i[1]=[c("i",{class:"pi pi-ellipsis-h"},null,-1)])),_:1},8,["aria-label"])),[[r,{value:l.$t("g.moreWorkflows"),showDelay:300}]]),F(y(Va),{ref_key:"menu",ref:t,model:a.value,popup:!0,class:"max-h-[40vh] overflow-auto"},null,8,["model"])])}}}),pw={key:3,class:"window-actions-spacer app-drag shrink-0"},fw=q({__name:"WorkflowTabs",props:{class:{}},setup(e){const o=e,{t}=pe(),s=ot(),a=Le(),l=Nr(),i=Xe(),r=L(),u=L(),f=L(null),m=L(!1),v=L(!1),p=L(!1),w=Ge(),k=n(B=>({value:B.path,workflow:B}),"workflowToOption"),g=h(()=>a.openWorkflows.map(k)),b=h(()=>a.activeWorkflow?k(a.activeWorkflow):null),S=n(async B=>{B&&b.value?.value!==B.value&&await i.openWorkflow(B.workflow)},"onWorkflowChange"),_=n(async B=>{for(const W of B)if(!await i.closeWorkflow(W.workflow,{warnIfUnsaved:!s.shiftDown}))break},"closeWorkflows"),C=n(async B=>{await _([B])},"onCloseWorkflow"),x=n((B,W)=>{r.value=W,u.value.show(B)},"showContextMenu"),N=h(()=>{const B=r.value;if(!B)return[];const W=g.value.findIndex(G=>G.workflow===B.workflow);return[{label:t("tabMenu.duplicateTab"),command:n(async()=>{await i.duplicateWorkflow(B.workflow)},"command")},{separator:!0},{label:t("tabMenu.closeTab"),command:n(()=>C(B),"command")},{label:t("tabMenu.closeTabsToLeft"),command:n(()=>_(g.value.slice(0,W)),"command"),disabled:W<=0},{label:t("tabMenu.closeTabsToRight"),command:n(()=>_(g.value.slice(W+1)),"command"),disabled:W===g.value.length-1},{label:t("tabMenu.closeOtherTabs"),command:n(()=>_([...g.value.slice(W+1),...g.value.slice(0,W)]),"command"),disabled:g.value.length<=1},{label:l.isBookmarked(B.workflow.path)?t("tabMenu.removeFromBookmarks"):t("tabMenu.addToBookmarks"),command:n(()=>l.toggleBookmarked(B.workflow.path),"command"),disabled:B.workflow.isTemporary}]}),M=_e(),$=n(B=>{const W=B.currentTarget,G=B.deltaX||B.deltaY;W.scroll({left:W.scrollLeft+G})},"handleWheel"),I=h(()=>f.value?.querySelector(".p-scrollpanel-content")??null),P=n(B=>{const W=I.value;W&&W.scrollBy({left:B*20})},"scroll"),z=n(async(B={})=>{if(!b.value)return;B.waitForDom!==!1&&await Re();const W=f.value;if(!W)return;const G=W.querySelector(".p-togglebutton-checked");G&&G.scrollIntoView({block:"nearest",inline:"nearest"})},"ensureActiveTabVisible");ae(()=>a.activeWorkflow,()=>{z()},{immediate:!0});let j=null,D=null,A=null;return ae(I,(B,W,G)=>{if(D?.(),A?.(),j?.dispose(),!B)return;const H=Ma(B);D=ae([()=>H.arrivedState.left,()=>H.arrivedState.right],([K,ee])=>{v.value=!K,p.value=!ee},{immediate:!0}),j=yl(B),A=ae(j.isOverflowing,K=>{m.value=K,K&&Re(()=>{H.measure(),z({waitForDom:!1})})},{immediate:!0}),G(()=>{D?.(),A?.(),j?.dispose()})},{immediate:!0}),Ca(()=>{j?.disposed.value||j?.checkOverflow()}),(B,W)=>{const G=Ie("tooltip");return d(),T("div",{ref_key:"containerRef",ref:f,class:Q(["workflow-tabs-container flex h-full max-w-full flex-auto flex-row overflow-hidden",{"workflow-tabs-container-desktop":y(w)}])},[m.value?(d(),U(X,{key:0,variant:"muted-textonly",size:"icon",class:"overflow-arrow overflow-arrow-left h-full w-auto aspect-square","aria-label":B.$t("g.scrollLeft"),disabled:!v.value,onMousedown:W[0]||(W[0]=H=>y(Wn)(H,()=>P(-1)))},{default:E(()=>W[3]||(W[3]=[c("i",{class:"icon-[lucide--chevron-left] size-full"},null,-1)])),_:1},8,["aria-label","disabled"])):V("",!0),F(y(Ci),{class:"no-drag overflow-hidden","pt:content":{class:"p-0 w-full flex",onwheel:$},"pt:bar-x":"h-1"},{default:E(()=>[F(y(Ra),{class:Q(["workflow-tabs bg-transparent",o.class]),"model-value":b.value,options:g.value,"option-label":"label","data-key":"value","onUpdate:modelValue":S},{option:E(({option:H})=>[F(cw,{"workflow-option":H,onContextmenu:n(K=>x(K,H),"onContextmenu"),onMouseup:Ce(K=>C(H),["middle"])},null,8,["workflow-option","onContextmenu","onMouseup"])]),_:1},8,["class","model-value","options"])]),_:1},8,["pt:content"]),m.value?(d(),U(X,{key:1,variant:"muted-textonly",size:"icon",class:"overflow-arrow overflow-arrow-right h-full w-auto aspect-square","aria-label":B.$t("g.scrollRight"),disabled:!p.value,onMousedown:W[1]||(W[1]=H=>y(Wn)(H,()=>P(1)))},{default:E(()=>W[4]||(W[4]=[c("i",{class:"icon-[lucide--chevron-right] size-full"},null,-1)])),_:1},8,["aria-label","disabled"])):V("",!0),m.value?(d(),U(dw,{key:2,workflows:y(a).openWorkflows,"active-workflow":y(a).activeWorkflow},null,8,["workflows","active-workflow"])):V("",!0),de((d(),U(X,{class:"new-blank-workflow-button no-drag shrink-0 rounded-none h-full w-auto aspect-square",variant:"muted-textonly",size:"icon","aria-label":B.$t("sideToolbar.newBlankWorkflow"),onClick:W[2]||(W[2]=()=>y(M).execute("Comfy.NewBlankWorkflow"))},{default:E(()=>W[5]||(W[5]=[c("i",{class:"pi pi-plus"},null,-1)])),_:1},8,["aria-label"])),[[G,{value:B.$t("sideToolbar.newBlankWorkflow"),showDelay:300}]]),F(y(Wa),{ref_key:"menu",ref:u,model:N.value},null,8,["model"]),y(w)?(d(),T("div",pw)):V("",!0)],2)}}}),Pl=Ee(fw,[["__scopeId","data-v-3fb85a76"]]);function mw(){const e=L();function o(s){s?.graph&&(t(),e.value=De.onChange(a=>{for(const l of a.nodeIds){const i=De.getNodeLayoutRef(l).value;if(!i)continue;const r=s.graph?.getNodeById(parseInt(l));r&&((r.pos[0]!==i.position.x||r.pos[1]!==i.position.y)&&(r.pos[0]=i.position.x,r.pos[1]=i.position.y),(r.size[0]!==i.size.width||r.size[1]!==i.size.height)&&r.setSize([i.size.width,i.size.height]))}s.setDirty(!0,!0)}))}n(o,"startSync");function t(){e.value?.(),e.value=void 0}return n(t,"stopSync"),ut(t),{startSync:o,stopSync:t}}n(mw,"useLayoutSync");function gw(){const e=me(),o=un(),{shouldRenderVueNodes:t}=qo(),s=Je(null),{startSync:a}=mw(),l=n(()=>{const f=J.canvas?.graph;if(!f||s.value)return;const m=Rv(f);s.value=m;const v=f._nodes.map(p=>({id:p.id.toString(),pos:[p.pos[0],p.pos[1]],size:[p.size[0],Ir(p.size[1])]}));De.initializeFromLiteGraph(v);for(const p of f.reroutes.values()){const[w,k]=p.pos,g=p.parentId??void 0,b=Array.from(p.linkIds);o.createReroute(p.id,{x:w,y:k},g,b)}for(const p of f._links.values())o.createLink(p.id,p.origin_id,p.origin_slot,p.target_id,p.target_slot);a(e.canvas)},"initializeNodeManager"),i=n(()=>{if(s.value){try{s.value.cleanup()}catch{}s.value=null}},"disposeNodeManagerAndSyncs");return ae(()=>t.value&&!!J.canvas?.graph,f=>{f&&(l(),Ds(J.canvas?.graph?.extra.workflowRendererVersion))},{immediate:!0}),_t(()=>!t.value,()=>{Ds(J.canvas?.graph?.extra.workflowRendererVersion),i(),J.canvas?.setDirty(!0,!0)}),ae(()=>t.value,(f,m)=>{f!==m&&De.clearAllSlotLayouts()},{immediate:!0,flush:"sync"}),{nodeManager:s,initializeNodeManager:l,disposeNodeManagerAndSyncs:i,setupEmptyGraphListener:n(()=>{const f=J.canvas?.graph;if(!t.value||s.value||f?._nodes.length!==0)return;const m=f.onNodeAdded;f.onNodeAdded=function(v){f.onNodeAdded=m,t.value&&!s.value&&l(),m&&m.call(this,v)}},"setupEmptyGraphListener"),cleanup:n(()=>{s.value&&(s.value.cleanup(),s.value=null)},"cleanup")}}n(gw,"useVueNodeLifecycleIndividual");const ws=sn(gw),vw={minimumFractionDigits:0,maximumFractionDigits:0},Jo=n(e=>Mr({usd:e,numberOptions:vw}),"formatCreditsValue"),ks=n(e=>e?"~":"","makePrefix"),Cs=n(e=>e??"/Run","makeSuffix"),xs=n(e=>e?` ${e}`:"","appendNote"),O=n((e,{suffix:o,note:t,approximate:s}={})=>`${ks(s)}${Jo(e)} credits${Cs(o)}${xs(t)}`,"formatCreditsLabel"),ye=n((e,o,{suffix:t,note:s,approximate:a}={})=>{const l=Jo(e),i=Jo(o),r=l===i?l:`${l}-${i}`;return`${ks(a)}${r} credits${Cs(t)}${xs(s)}`},"formatCreditsRangeLabel"),ze=n((e,{suffix:o,note:t,approximate:s,separator:a}={})=>{const i=e.map(r=>Jo(r)).join(a??"/");return`${ks(s)}${i} credits${Cs(o)}${xs(t)}`},"formatCreditsListLabel");function hw(e,o,t=""){try{return e(o)}catch{return t}}n(hw,"safePricingExecution");const xn=n(e=>{const o=e.widgets?.find(l=>l.name==="duration");if(!o)return O(.0715,{suffix:"/second"});const t=Number(o.value),a=.0715*(isNaN(t)?5:t);return O(a)},"calculateRunwayDurationPrice"),Po=n(e=>o=>{const t=o.widgets?.find(l=>l.name==="duration");if(!t)return O(e,{suffix:"/second"});const s=parseFloat(String(t.value));if(!Number.isFinite(s))return O(e,{suffix:"/second"});const a=e*s;return O(a)},"makeOmniProDurationCalculator"),yw=n(e=>{const o=e.widgets?.find(s=>s.name==="mode");if(!o)return ze([.07,.112],{suffix:"/second",note:"(std/pro)"});const t=String(o.value).toLowerCase();return t==="pro"?O(.112,{suffix:"/second"}):t==="std"?O(.07,{suffix:"/second"}):ze([.07,.112],{suffix:"/second",note:"(std/pro)"})},"klingMotionControlPricingCalculator"),Sn=n(e=>{const o=e.widgets?.find(r=>r.name==="duration_seconds"),t=e.widgets?.find(r=>r.name==="quality"),s=e.widgets?.find(r=>r.name==="motion_mode");if(!o||!t)return ye(.45,1.2,{note:"(varies with duration, quality & motion mode)"});const a=String(o.value),l=String(t.value),i=String(s?.value);if(a.includes("5")){if(l.includes("1080p")||l.includes("720p")&&i?.includes("fast"))return O(1.2);if(l.includes("720p")&&i?.includes("normal"))return O(.6);if(l.includes("540p")&&i?.includes("fast"))return O(.9);if(l.includes("540p")&&i?.includes("normal"))return O(.45);if(l.includes("360p")&&i?.includes("fast"))return O(.9);if(l.includes("360p")&&i?.includes("normal"))return O(.45)}else if(a.includes("8")){if(l.includes("540p")&&i?.includes("normal"))return O(.9);if(l.includes("540p")&&i?.includes("fast"))return O(1.2);if(l.includes("360p")&&i?.includes("normal"))return O(.9);if(l.includes("360p")&&i?.includes("fast")||l.includes("1080p")&&i?.includes("normal")||l.includes("1080p")&&i?.includes("fast")||l.includes("720p")&&i?.includes("normal")||l.includes("720p")&&i?.includes("fast"))return O(1.2)}return O(.9)},"pixversePricingCalculator"),Do=n(e=>{const o=e.widgets?.find(b=>b.name==="model"),t=e.widgets?.find(b=>b.name==="duration"),s=e.widgets?.find(b=>b.name==="resolution");if(!o||!t||!s)return"Token-based";const a=String(o.value).toLowerCase(),l=String(s.value).toLowerCase(),i=parseFloat(String(t.value)),r={"seedance-1-0-pro":{"480p":[.23,.24],"720p":[.51,.56],"1080p":[1.18,1.22]},"seedance-1-0-pro-fast":{"480p":[.09,.1],"720p":[.21,.23],"1080p":[.47,.49]},"seedance-1-0-lite":{"480p":[.17,.18],"720p":[.37,.41],"1080p":[.85,.88]}},u=a.includes("seedance-1-0-pro-fast")?"seedance-1-0-pro-fast":a.includes("seedance-1-0-pro")?"seedance-1-0-pro":a.includes("seedance-1-0-lite")?"seedance-1-0-lite":"",f=l.includes("1080")?"1080p":l.includes("720")?"720p":l.includes("480")?"480p":"",m=u&&f?r[u]?.[f]:void 0;if(!m)return"Token-based";const[v,p]=m,w=i/10,k=v*w,g=p*w;return k===g?O(k):ye(k,g)},"byteDanceVideoPricingCalculator"),ra=n(e=>{const o=e.widgets?.find(p=>p.name==="model"),t=e.widgets?.find(p=>p.name==="duration"),s=e.widgets?.find(p=>p.name==="resolution"),a=ye(.04,.24,{suffix:"/second"});if(!o||!t||!s)return a;const l=String(o.value).toLowerCase(),i=String(s.value).toLowerCase(),r=parseFloat(String(t.value)),f={"ltx-2 (pro)":{"1920x1080":.06,"2560x1440":.12,"3840x2160":.24},"ltx-2 (fast)":{"1920x1080":.04,"2560x1440":.08,"3840x2160":.16}}[l];if(!f)return a;const m=f[i];if(!m)return a;const v=m*r;return O(v)},"ltxvPricingCalculator"),ua=n(e=>{const o=e.widgets?.find(l=>l.name==="duration"),t=e.widgets?.find(l=>l.name==="generate_audio");if(!o||!t)return ye(.35,1.4,{note:"(varies with duration & audio)"});const s=String(o.value),a=String(t.value).toLowerCase()==="true";return s==="5"?O(a?.7:.35):s==="10"?O(a?1.4:.7):ye(.35,1.4,{note:"(varies with duration & audio)"})},"klingVideoWithAudioPricingCalculator"),To={BASIC:new Set(["720x1280","1280x720"]),PRO:new Set(["1024x1792","1792x1024"])},bw=new Set([...To.BASIC,...To.PRO]);function ww(e,o,t){const s=e?.toLowerCase()??"",a=t?.toLowerCase()??"";if(!o||Number.isNaN(o))return"Set duration (4s / 8s / 12s)";if(!a)return"Set size (720x1280, 1280x720, 1024x1792, 1792x1024)";if(!bw.has(a))return"Invalid size. Must be 720x1280, 1280x720, 1024x1792, or 1792x1024.";if(!s.includes("sora-2-pro")){if(s.includes("sora-2")&&!To.BASIC.has(a))return"sora-2 supports only 720x1280 or 1280x720";if(!s.includes("sora-2"))return"Unsupported model"}}n(ww,"validateSora2Selection");function kw(e,o){const t=e?.toLowerCase()??"",s=o?.toLowerCase()??"";return t.includes("sora-2-pro")?To.PRO.has(s)?.5:.3:t.includes("sora-2")?.1:To.PRO.has(s)?.5:.1}n(kw,"perSecForSora2");function Cw(e,o){return O(Number((e*o).toFixed(2)))}n(Cw,"formatRunPrice");const xw=n(e=>{const o=n(r=>String(e.widgets?.find(u=>u.name===r)?.value??""),"getWidgetValue"),t=o("model"),s=o("size"),a=Number(e.widgets?.find(r=>["duration","duration_s"].includes(r.name))?.value);if(!t||!s||!a)return"Set model, duration & size";const l=ww(t,a,s);if(l)return l;const i=kw(t,s);return Cw(i,a)},"sora2PricingCalculator"),_n=n((e,o)=>{const t=n(C=>e.widgets?.find(x=>x.name===C),"getWidget"),s=n((C,x)=>{const N=t(C);return!N||N.value===void 0||N.value===null?x:String(N.value)},"getString"),a=n((C,x)=>{const N=t(C);if(!N||N.value===void 0||N.value===null)return x;const M=N.value;if(typeof M=="number")return M!==0;const $=String(M).toLowerCase();return $==="true"?!0:$==="false"?!1:x},"getBool"),l=s("model_version","").toLowerCase();if(l==="")return ye(.1,.65,{note:"(varies with quad, style, texture & quality)"});const r=s("style","None").toLowerCase()!=="none",u=a("texture",!1),f=a("pbr",!1),m=a("quad",!1),v=s("texture_quality","standard").toLowerCase(),p=s("geometry_quality","standard").toLowerCase(),w=v==="detailed",k=p==="detailed",g=u||f;let b;l.includes("v1.4")||g?o==="text"?b=20:b=30:o==="text"?b=10:b=20;let S=b;r&&(S+=5),m&&(S+=5),w&&(S+=10),k&&(S+=20);const _=S*.01;return O(_)},"calculateTripo3DGenerationPrice"),ca={FluxProCannyNode:{displayPrice:O(.05)},FluxProDepthNode:{displayPrice:O(.05)},FluxProExpandNode:{displayPrice:O(.05)},FluxProFillNode:{displayPrice:O(.05)},FluxProUltraImageNode:{displayPrice:O(.06)},FluxProKontextProNode:{displayPrice:O(.04)},FluxProKontextMaxNode:{displayPrice:O(.08)},Flux2ProImageNode:{displayPrice:n(e=>{const o=e.widgets?.find(m=>m.name==="width"),t=e.widgets?.find(m=>m.name==="height"),s=Number(o?.value),a=Number(t?.value);if(!Number.isFinite(s)||!Number.isFinite(a)||s<=0||a<=0)return ye(.03,.15);const l=e.inputs?.find(m=>m.name==="images"),i=typeof l?.link<"u"&&l.link!=null,r=1024*1024,u=Math.max(1,Math.floor((s*a+r-1)/r)),f=.03+.015*Math.max(u-1,0);if(i){const m=f+.015,v=f+.12;return ye(m,v,{approximate:!0})}return O(f)},"displayPrice")},Flux2MaxImageNode:{displayPrice:n(e=>{const o=e.widgets?.find(m=>m.name==="width"),t=e.widgets?.find(m=>m.name==="height"),s=Number(o?.value),a=Number(t?.value);if(!Number.isFinite(s)||!Number.isFinite(a)||s<=0||a<=0)return ye(.07,.35);const l=e.inputs?.find(m=>m.name==="images"),i=typeof l?.link<"u"&&l.link!=null,r=1024*1024,u=Math.max(1,Math.floor((s*a+r-1)/r)),f=.07+.03*Math.max(u-1,0);if(i){const m=f+.03,v=f+.24;return ye(m,v)}return O(f)},"displayPrice")},OpenAIVideoSora2:{displayPrice:xw},IdeogramV1:{displayPrice:n(e=>{const o=e.widgets?.find(r=>r.name==="num_images"),t=e.widgets?.find(r=>r.name==="turbo");if(!o)return ye(.03,.09,{suffix:" x num_images/Run"});const s=Number(o.value)||1,l=String(t?.value).toLowerCase()==="true"?.0286:.0858,i=Number((l*s).toFixed(2));return O(i)},"displayPrice")},IdeogramV2:{displayPrice:n(e=>{const o=e.widgets?.find(r=>r.name==="num_images"),t=e.widgets?.find(r=>r.name==="turbo");if(!o)return ye(.07,.11,{suffix:" x num_images/Run"});const s=Number(o.value)||1,l=String(t?.value).toLowerCase()==="true"?.0715:.1144,i=Number((l*s).toFixed(2));return O(i)},"displayPrice")},IdeogramV3:{displayPrice:n(e=>{const o=e.widgets?.find(f=>f.name==="rendering_speed"),t=e.widgets?.find(f=>f.name==="num_images"),s=e.inputs?.find(f=>f.name==="character_image"),a=typeof s?.link<"u"&&s.link!=null;if(!o)return ye(.04,.11,{suffix:" x num_images/Run",note:"(varies with rendering speed & num_images)"});const l=Number(t?.value)||1;let i=.0858;const r=String(o.value);r.toLowerCase().includes("quality")?a?i=.286:i=.1287:r.toLowerCase().includes("default")?a?i=.2145:i=.0858:r.toLowerCase().includes("turbo")&&(a?i=.143:i=.0429);const u=Number((i*l).toFixed(2));return O(u)},"displayPrice")},KlingCameraControlI2VNode:{displayPrice:O(.49)},KlingCameraControlT2VNode:{displayPrice:O(.14)},KlingDualCharacterVideoEffectNode:{displayPrice:n(e=>{const o=e.widgets?.find(r=>r.name==="mode"),t=e.widgets?.find(r=>r.name==="model_name"),s=e.widgets?.find(r=>r.name==="duration");if(!o||!t||!s)return ye(.14,2.8,{note:"(varies with model, mode & duration)"});const a=String(o.value),l=String(s.value),i=String(t.value);return i.includes("v1-6")||i.includes("v1-5")?a.includes("pro")?l.includes("10")?O(.98):O(.49):l.includes("10")?O(.56):O(.28):i.includes("v1")?a.includes("pro")?l.includes("10")?O(.98):O(.49):l.includes("10")?O(.28):O(.14):O(.14)},"displayPrice")},KlingImage2VideoNode:{displayPrice:n(e=>{const o=e.widgets?.find(r=>r.name==="mode"),t=e.widgets?.find(r=>r.name==="model_name"),s=e.widgets?.find(r=>r.name==="duration");if(!o){if(!t)return ye(.14,2.8,{note:"(varies with model, mode & duration)"});const r=String(t.value);return r.includes("v2-1-master")||r.includes("v2-master")?O(1.4):r.includes("v1-6")||r.includes("v1-5")?O(.28):O(.14)}const a=String(o.value),l=String(s.value),i=String(t.value);return i.includes("v2-5-turbo")?l.includes("10")?O(.7):O(.35):i.includes("v2-1-master")||i.includes("v2-master")?l.includes("10")?O(2.8):O(1.4):i.includes("v2-1")||i.includes("v1-6")||i.includes("v1-5")?a.includes("pro")?l.includes("10")?O(.98):O(.49):l.includes("10")?O(.56):O(.28):i.includes("v1")?a.includes("pro")?l.includes("10")?O(.98):O(.49):l.includes("10")?O(.28):O(.14):O(.14)},"displayPrice")},KlingImageGenerationNode:{displayPrice:n(e=>{const t=e.inputs?.find(f=>f.name==="image")?.link?"image to image":"text to image",s=e.widgets?.find(f=>f.name==="model_name"),a=e.widgets?.find(f=>f.name==="n");if(!s)return ye(.0035,.028,{suffix:" x n/Run",note:"(varies with modality & model)"});const l=String(s.value),i=Number(a?.value)||1;let r=.014;t.includes("text to image")?l.includes("kling-v1-5")||l.includes("kling-v2")?r=.014:l.includes("kling-v1")&&(r=.0035):t.includes("image to image")&&(l.includes("kling-v1-5")?r=.028:l.includes("kling-v1")&&(r=.0035));const u=r*i;return O(u)},"displayPrice")},KlingLipSyncAudioToVideoNode:{displayPrice:O(.1,{approximate:!0})},KlingLipSyncTextToVideoNode:{displayPrice:O(.1,{approximate:!0})},KlingSingleImageVideoEffectNode:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="effect_scene");if(!o)return ye(.28,.49,{note:"(varies with effect scene)"});const t=String(o.value);return t.includes("fuzzyfuzzy")||t.includes("squish")?O(.28):t.includes("dizzydizzy")||t.includes("bloombloom")?O(.49):(t.includes("expansion"),O(.28))},"displayPrice")},KlingStartEndFrameNode:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="mode");if(!o)return ye(.14,2.8,{note:"(varies with model, mode & duration)"});const t=String(o.value);return t.includes("v2-5-turbo")?t.includes("10")?O(.7):O(.35):t.includes("v2-1")?t.includes("10s")?O(.98):O(.49):t.includes("v2-master")?t.includes("10s")?O(2.8):O(1.4):t.includes("v1-6")?t.includes("pro")?t.includes("10s")?O(.98):O(.49):t.includes("10s")?O(.56):O(.28):t.includes("v1")?t.includes("pro")?t.includes("10s")?O(.98):O(.49):t.includes("10s")?O(.28):O(.14):O(.14)},"displayPrice")},KlingTextToVideoNode:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="mode");if(!o)return ye(.14,2.8,{note:"(varies with model, mode & duration)"});const t=String(o.value);return t.includes("v2-5-turbo")?t.includes("10")?O(.7):O(.35):t.includes("v2-1-master")||t.includes("v2-master")?t.includes("10s")?O(2.8):O(1.4):t.includes("v1-6")?t.includes("pro")?t.includes("10s")?O(.98):O(.49):t.includes("10s")?O(.56):O(.28):t.includes("v1")?t.includes("pro")?t.includes("10s")?O(.98):O(.49):t.includes("10s")?O(.28):O(.14):O(.14)},"displayPrice")},KlingVideoExtendNode:{displayPrice:O(.28)},KlingVirtualTryOnNode:{displayPrice:O(.07)},KlingOmniProTextToVideoNode:{displayPrice:Po(.112)},KlingOmniProFirstLastFrameNode:{displayPrice:Po(.112)},KlingOmniProImageToVideoNode:{displayPrice:Po(.112)},KlingOmniProVideoToVideoNode:{displayPrice:Po(.168)},KlingMotionControl:{displayPrice:yw},KlingOmniProEditVideoNode:{displayPrice:O(.168,{suffix:"/second"})},KlingOmniProImageNode:{displayPrice:O(.028)},KlingTextToVideoWithAudio:{displayPrice:ua},KlingImageToVideoWithAudio:{displayPrice:ua},LumaImageToVideoNode:{displayPrice:n(e=>{const o=e.widgets?.find(r=>r.name==="model"),t=e.widgets?.find(r=>r.name==="resolution"),s=e.widgets?.find(r=>r.name==="duration");if(!o||!t||!s)return ye(.2,16.4,{note:"(varies with model, resolution & duration)"});const a=String(o.value),l=String(t.value).toLowerCase(),i=String(s.value);if(a.includes("ray-flash-2")){if(i.includes("5s")){if(l.includes("4k"))return O(3.13);if(l.includes("1080p"))return O(.79);if(l.includes("720p"))return O(.34);if(l.includes("540p"))return O(.2)}else if(i.includes("9s")){if(l.includes("4k"))return O(5.65);if(l.includes("1080p"))return O(1.42);if(l.includes("720p"))return O(.61);if(l.includes("540p"))return O(.36)}}else if(a.includes("ray-2")){if(i.includes("5s")){if(l.includes("4k"))return O(9.11);if(l.includes("1080p"))return O(2.27);if(l.includes("720p"))return O(1.02);if(l.includes("540p"))return O(.57)}else if(i.includes("9s")){if(l.includes("4k"))return O(16.4);if(l.includes("1080p"))return O(4.1);if(l.includes("720p"))return O(1.83);if(l.includes("540p"))return O(1.03)}}else if(a.includes("ray-1-6"))return O(.5);return O(.79)},"displayPrice")},LumaVideoNode:{displayPrice:n(e=>{const o=e.widgets?.find(r=>r.name==="model"),t=e.widgets?.find(r=>r.name==="resolution"),s=e.widgets?.find(r=>r.name==="duration");if(!o||!t||!s)return ye(.2,16.4,{note:"(varies with model, resolution & duration)"});const a=String(o.value),l=String(t.value).toLowerCase(),i=String(s.value);if(a.includes("ray-flash-2")){if(i.includes("5s")){if(l.includes("4k"))return O(3.13);if(l.includes("1080p"))return O(.79);if(l.includes("720p"))return O(.34);if(l.includes("540p"))return O(.2)}else if(i.includes("9s")){if(l.includes("4k"))return O(5.65);if(l.includes("1080p"))return O(1.42);if(l.includes("720p"))return O(.61);if(l.includes("540p"))return O(.36)}}else if(a.includes("ray-2")){if(i.includes("5s")){if(l.includes("4k"))return O(9.11);if(l.includes("1080p"))return O(2.27);if(l.includes("720p"))return O(1.02);if(l.includes("540p"))return O(.57)}else if(i.includes("9s")){if(l.includes("4k"))return O(16.4);if(l.includes("1080p"))return O(4.1);if(l.includes("720p"))return O(1.83);if(l.includes("540p"))return O(1.03)}}else if(a.includes("ray-1-6"))return O(.5);return O(.79)},"displayPrice")},MinimaxImageToVideoNode:{displayPrice:O(.43)},MinimaxTextToVideoNode:{displayPrice:O(.43)},MinimaxHailuoVideoNode:{displayPrice:n(e=>{const o=e.widgets?.find(l=>l.name==="resolution"),t=e.widgets?.find(l=>l.name==="duration");if(!o||!t)return ye(.28,.56,{note:"(varies with resolution & duration)"});const s=String(o.value),a=String(t.value);if(s.includes("768P")){if(a.includes("6"))return O(.28);if(a.includes("10"))return O(.56)}else if(s.includes("1080P")&&a.includes("6"))return O(.49);return O(.43)},"displayPrice")},OpenAIDalle2:{displayPrice:n(e=>{const o=e.widgets?.find(r=>r.name==="size"),t=e.widgets?.find(r=>r.name==="n");if(!o)return ye(.016,.02,{suffix:" x n/Run",note:"(varies with size & n)"});const s=String(o.value),a=Number(t?.value)||1;let l=.02;s.includes("1024x1024")?l=.02:s.includes("512x512")?l=.018:s.includes("256x256")&&(l=.016);const i=Number((l*a).toFixed(3));return O(i)},"displayPrice")},OpenAIDalle3:{displayPrice:n(e=>{const o=e.widgets?.find(l=>l.name==="size"),t=e.widgets?.find(l=>l.name==="quality");if(!o||!t)return ye(.04,.12,{note:"(varies with size & quality)"});const s=String(o.value),a=String(t.value);return s.includes("1024x1024")?a.includes("hd")?O(.08):O(.04):s.includes("1792x1024")||s.includes("1024x1792")?a.includes("hd")?O(.12):O(.08):O(.04)},"displayPrice")},OpenAIGPTImage1:{displayPrice:n(e=>{const o=e.widgets?.find(i=>i.name==="quality"),t=e.widgets?.find(i=>i.name==="n");if(!o)return ye(.011,.3,{suffix:" x n/Run",note:"(varies with quality & n)"});const s=String(o.value),a=Number(t?.value)||1;let l=[.046,.07];return s.includes("high")?l=[.167,.3]:s.includes("medium")?l=[.046,.07]:s.includes("low")&&(l=[.011,.02]),a===1?ye(l[0],l[1]):ye(l[0],l[1],{suffix:` x ${a}/Run`})},"displayPrice")},PixverseImageToVideoNode:{displayPrice:Sn},PixverseTextToVideoNode:{displayPrice:Sn},PixverseTransitionVideoNode:{displayPrice:Sn},RecraftCreativeUpscaleNode:{displayPrice:O(.25)},RecraftCrispUpscaleNode:{displayPrice:O(.004)},RecraftGenerateColorFromImageNode:{displayPrice:n(e=>{const o=e.widgets?.find(a=>a.name==="n");if(!o)return O(.04,{suffix:" x n/Run"});const t=Number(o.value)||1,s=Number((.04*t).toFixed(2));return O(s)},"displayPrice")},RecraftGenerateImageNode:{displayPrice:n(e=>{const o=e.widgets?.find(a=>a.name==="n");if(!o)return O(.04,{suffix:" x n/Run"});const t=Number(o.value)||1,s=Number((.04*t).toFixed(2));return O(s)},"displayPrice")},RecraftGenerateVectorImageNode:{displayPrice:n(e=>{const o=e.widgets?.find(a=>a.name==="n");if(!o)return O(.08,{suffix:" x n/Run"});const t=Number(o.value)||1,s=Number((.08*t).toFixed(2));return O(s)},"displayPrice")},RecraftImageInpaintingNode:{displayPrice:n(e=>{const o=e.widgets?.find(a=>a.name==="n");if(!o)return O(.04,{suffix:" x n/Run"});const t=Number(o.value)||1,s=Number((.04*t).toFixed(2));return O(s)},"displayPrice")},RecraftImageToImageNode:{displayPrice:n(e=>{const o=e.widgets?.find(a=>a.name==="n");if(!o)return O(.04,{suffix:" x n/Run"});const t=Number(o.value)||1,s=Number((.04*t).toFixed(2));return O(s)},"displayPrice")},RecraftRemoveBackgroundNode:{displayPrice:O(.01)},RecraftReplaceBackgroundNode:{displayPrice:O(.04)},RecraftTextToImageNode:{displayPrice:n(e=>{const o=e.widgets?.find(a=>a.name==="n");if(!o)return O(.04,{suffix:" x n/Run"});const t=Number(o.value)||1,s=Number((.04*t).toFixed(2));return O(s)},"displayPrice")},RecraftTextToVectorNode:{displayPrice:n(e=>{const o=e.widgets?.find(a=>a.name==="n");if(!o)return O(.08,{suffix:" x n/Run"});const t=Number(o.value)||1,s=Number((.08*t).toFixed(2));return O(s)},"displayPrice")},RecraftVectorizeImageNode:{displayPrice:n(e=>{const o=e.widgets?.find(a=>a.name==="n");if(!o)return O(.01,{suffix:" x n/Run"});const t=Number(o.value)||1,s=Number((.01*t).toFixed(2));return O(s)},"displayPrice")},StabilityStableImageSD_3_5Node:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="model");if(!o)return ye(.035,.065,{note:"(varies with model)"});const t=String(o.value).toLowerCase();return t.includes("large")?O(.065):(t.includes("medium"),O(.035))},"displayPrice")},StabilityStableImageUltraNode:{displayPrice:O(.08)},StabilityUpscaleConservativeNode:{displayPrice:O(.25)},StabilityUpscaleCreativeNode:{displayPrice:O(.25)},StabilityUpscaleFastNode:{displayPrice:O(.01)},StabilityTextToAudio:{displayPrice:O(.2)},StabilityAudioToAudio:{displayPrice:O(.2)},StabilityAudioInpaint:{displayPrice:O(.2)},VeoVideoGenerationNode:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="duration_seconds");if(!o)return ye(2.5,5,{note:"(varies with duration)"});const t=.5*Number(o.value);return O(t)},"displayPrice")},Veo3VideoGenerationNode:{displayPrice:n(e=>{const o=e.widgets?.find(l=>l.name==="model"),t=e.widgets?.find(l=>l.name==="generate_audio");if(!o||!t)return ye(.8,3.2,{note:"(varies with model & audio generation)"});const s=String(o.value),a=String(t.value).toLowerCase()==="true";return s.includes("veo-3.0-fast-generate-001")||s.includes("veo-3.1-fast-generate")?O(a?1.2:.8):s.includes("veo-3.0-generate-001")||s.includes("veo-3.1-generate")?O(a?3.2:1.6):ye(.8,3.2)},"displayPrice")},Veo3FirstLastFrameNode:{displayPrice:n(e=>{const o=e.widgets?.find(f=>f.name==="model"),t=e.widgets?.find(f=>f.name==="generate_audio"),s=e.widgets?.find(f=>f.name==="duration");if(!o||!t||!s)return ye(.4,3.2,{note:"(varies with model & audio generation)"});const a=String(o.value),l=String(t.value).toLowerCase()==="true",i=parseFloat(String(s.value));let r=null;if(a.includes("veo-3.1-fast-generate")?r=l?.15:.1:a.includes("veo-3.1-generate")&&(r=l?.4:.2),r===null)return ye(.4,3.2);const u=r*i;return O(u)},"displayPrice")},LumaImageNode:{displayPrice:n(e=>{const o=e.widgets?.find(a=>a.name==="model"),t=e.widgets?.find(a=>a.name==="aspect_ratio");if(!o||!t)return ye(.0064,.026,{note:"(varies with model & aspect ratio)"});const s=String(o.value);return s.includes("photon-flash-1")?O(.0027):s.includes("photon-1")?O(.0104):O(.0246)},"displayPrice")},LumaImageModifyNode:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="model");if(!o)return ye(.0027,.0104,{note:"(varies with model)"});const t=String(o.value);return t.includes("photon-flash-1")?O(.0027):t.includes("photon-1")?O(.0104):O(.0246)},"displayPrice")},MoonvalleyTxt2VideoNode:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="length");if(!o)return O(1.5);const t=String(o.value);return O(t==="5s"?1.5:t==="10s"?3:1.5)},"displayPrice")},MoonvalleyImg2VideoNode:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="length");if(!o)return O(1.5);const t=String(o.value);return O(t==="5s"?1.5:t==="10s"?3:1.5)},"displayPrice")},MoonvalleyVideo2VideoNode:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="length");if(!o)return O(2.25);const t=String(o.value);return O(t==="5s"?2.25:t==="10s"?4:2.25)},"displayPrice")},RunwayTextToImageNode:{displayPrice:O(.11)},RunwayImageToVideoNodeGen3a:{displayPrice:xn},RunwayImageToVideoNodeGen4:{displayPrice:xn},RunwayFirstLastFrameNode:{displayPrice:xn},Rodin3D_Regular:{displayPrice:O(.4)},Rodin3D_Detail:{displayPrice:O(.4)},Rodin3D_Smooth:{displayPrice:O(.4)},Rodin3D_Sketch:{displayPrice:O(.4)},TripoTextToModelNode:{displayPrice:n(e=>_n(e,"text"),"displayPrice")},TripoImageToModelNode:{displayPrice:n(e=>_n(e,"image"),"displayPrice")},TripoMultiviewToModelNode:{displayPrice:n(e=>_n(e,"multiview"),"displayPrice")},TripoTextureNode:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="texture_quality");return o?String(o.value).includes("detailed")?O(.2):O(.1):ye(.1,.2,{note:"(varies with quality)"})},"displayPrice")},TripoRigNode:{displayPrice:"$0.25/Run"},TripoConversionNode:{displayPrice:n(e=>{const o=n(k=>e.widgets?.find(g=>g.name===k)?.value,"getWidgetValue"),t=n((k,g)=>{const b=o(k);if(b==null||b==="")return g;if(typeof b=="number")return Number.isFinite(b)?b:g;const S=Number(b);return Number.isFinite(S)?S:g},"getNumber"),s=n((k,g)=>{const b=o(k);if(b==null)return g;if(typeof b=="number")return b!==0;const S=String(b).toLowerCase();return S==="true"?!0:S==="false"?!1:g},"getBool");let a=!1;return s("quad",!1)&&(a=!0),s("force_symmetry",!1)&&(a=!0),s("flatten_bottom",!1)&&(a=!0),s("pivot_to_center_bottom",!1)&&(a=!0),s("with_animation",!1)&&(a=!0),s("pack_uv",!1)&&(a=!0),s("bake",!1)&&(a=!0),s("export_vertex_colors",!1)&&(a=!0),s("animate_in_place",!1)&&(a=!0),t("face_limit",-1)!==-1&&(a=!0),t("texture_size",4096)!==4096&&(a=!0),t("flatten_bottom_threshold",0)!==0&&(a=!0),t("scale_factor",1)!==1&&(a=!0),String(o("texture_format")??"JPEG").toUpperCase()!=="JPEG"&&(a=!0),String(o("part_names")??"").trim().length>0&&(a=!0),String(o("fbx_preset")??"blender").toLowerCase()!=="blender"&&(a=!0),String(o("export_orientation")??"default").toLowerCase()!=="default"&&(a=!0),O((a?10:5)*.01)},"displayPrice")},TripoRetargetNode:{displayPrice:O(.1)},TripoRefineNode:{displayPrice:O(.3)},GeminiNode:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="model");if(!o)return"Token-based";const t=String(o.value);return t.includes("gemini-2.5-flash-preview-04-17")?ze([3e-4,.0025],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):t.includes("gemini-2.5-flash")?ze([3e-4,.0025],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):t.includes("gemini-2.5-pro-preview-05-06")?ze([.00125,.01],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):t.includes("gemini-2.5-pro")?ze([.00125,.01],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):t.includes("gemini-3-pro-preview")?ze([.002,.012],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):"Token-based"},"displayPrice")},GeminiImageNode:{displayPrice:O(.039,{suffix:"/Image (1K)",approximate:!0})},GeminiImage2Node:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="resolution");if(!o)return"Token-based";const t=String(o.value);return t.includes("1K")?O(.134,{suffix:"/Image",approximate:!0}):t.includes("2K")?O(.134,{suffix:"/Image",approximate:!0}):t.includes("4K")?O(.24,{suffix:"/Image",approximate:!0}):"Token-based"},"displayPrice")},LLMNode:{displayPrice:"$0.00005/$0.0004 per 1K tokens"},OpenAIChatNode:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="model");if(!o)return"Token-based";const t=String(o.value);return t.includes("o4-mini")?ze([.0011,.0044],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):t.includes("o1-pro")?ze([.15,.6],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):t.includes("o1")?ze([.015,.06],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):t.includes("o3-mini")?ze([.0011,.0044],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):t.includes("o3")?ze([.01,.04],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):t.includes("gpt-4o")?ze([.0025,.01],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):t.includes("gpt-4.1-nano")?ze([1e-4,4e-4],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):t.includes("gpt-4.1-mini")?ze([4e-4,.0016],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):t.includes("gpt-4.1")?ze([.002,.008],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):t.includes("gpt-5-nano")?ze([5e-5,4e-4],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):t.includes("gpt-5-mini")?ze([25e-5,.002],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):t.includes("gpt-5")?ze([.00125,.01],{suffix:" per 1K tokens",approximate:!0,separator:"-"}):"Token-based"},"displayPrice")},ViduTextToVideoNode:{displayPrice:O(.4)},ViduImageToVideoNode:{displayPrice:O(.4)},ViduReferenceVideoNode:{displayPrice:O(.4)},ViduStartEndToVideoNode:{displayPrice:O(.4)},ByteDanceImageNode:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="model");return o&&String(o.value).includes("seedream-3-0-t2i")?O(.03):"Token-based"},"displayPrice")},ByteDanceImageEditNode:{displayPrice:n(e=>{const o=e.widgets?.find(s=>s.name==="model");return o&&String(o.value).includes("seededit-3-0-i2i")?O(.03):"Token-based"},"displayPrice")},ByteDanceSeedreamNode:{displayPrice:n(e=>{const o=e.widgets?.find(a=>a.name==="model"),t=String(o?.value??"").toLowerCase();let s=.03;return t.includes("seedream-4-5-251128")?s=.04:t.includes("seedream-4-0-250828")&&(s=.03),O(s,{suffix:" x images/Run",approximate:!0})},"displayPrice")},ByteDanceTextToVideoNode:{displayPrice:Do},ByteDanceImageToVideoNode:{displayPrice:Do},ByteDanceFirstLastFrameNode:{displayPrice:Do},ByteDanceImageReferenceNode:{displayPrice:Do},WanTextToVideoApi:{displayPrice:n(e=>{const o=e.widgets?.find(f=>f.name==="duration"),t=e.widgets?.find(f=>f.name==="size");if(!o||!t)return ye(.05,.15,{suffix:"/second"});const s=parseFloat(String(o.value)),a=String(t.value).toLowerCase(),l=a.includes("1080")?"1080p":a.includes("720")?"720p":a.includes("480")?"480p":a.match(/^\s*(\d{3,4}p)/)?.[1]??"",r={"480p":.05,"720p":.1,"1080p":.15}[l];if(isNaN(s)||!r)return ye(.05,.15,{suffix:"/second"});const u=Number((r*s).toFixed(2));return O(u)},"displayPrice")},WanImageToVideoApi:{displayPrice:n(e=>{const o=e.widgets?.find(u=>u.name==="duration"),t=e.widgets?.find(u=>u.name==="resolution");if(!o||!t)return ye(.05,.15,{suffix:"/second"});const s=parseFloat(String(o.value)),a=String(t.value).trim().toLowerCase(),i={"480p":.05,"720p":.1,"1080p":.15}[a];if(isNaN(s)||!i)return ye(.05,.15,{suffix:"/second"});const r=Number((i*s).toFixed(2));return O(r)},"displayPrice")},WanTextToImageApi:{displayPrice:O(.03)},WanImageToImageApi:{displayPrice:O(.03)},LtxvApiTextToVideo:{displayPrice:ra},LtxvApiImageToVideo:{displayPrice:ra},WanReferenceVideoApi:{displayPrice:n(e=>{const o=e.widgets?.find(v=>v.name==="duration"),t=e.widgets?.find(v=>v.name==="size");if(!o||!t)return ye(.7,1.5,{note:"(varies with size & duration)"});const s=parseFloat(String(o.value)),l=String(t.value).toLowerCase().includes("1080p")?.15:.1,i=2*l,r=5*l,u=s*l,f=i+u,m=r+u;return ye(f,m)},"displayPrice")}},Sw=n(()=>({getNodeDisplayPrice:n(s=>{if(!s.constructor?.nodeData?.api_node)return"";const a=s.constructor.nodeData.name,l=ca[a];return l?typeof l.displayPrice=="function"?hw(l.displayPrice,s,""):l.displayPrice:""},"getNodeDisplayPrice"),getNodePricingConfig:n(s=>ca[s.constructor.nodeData?.name??""],"getNodePricingConfig"),getRelevantWidgetNames:n(s=>({KlingTextToVideoNode:["mode","model_name","duration"],KlingImage2VideoNode:["mode","model_name","duration"],KlingImageGenerationNode:["modality","model_name","n"],KlingDualCharacterVideoEffectNode:["mode","model_name","duration"],KlingSingleImageVideoEffectNode:["effect_scene"],KlingStartEndFrameNode:["mode","model_name","duration"],KlingTextToVideoWithAudio:["duration","generate_audio"],KlingImageToVideoWithAudio:["duration","generate_audio"],KlingOmniProTextToVideoNode:["duration"],KlingOmniProFirstLastFrameNode:["duration"],KlingOmniProImageToVideoNode:["duration"],KlingOmniProVideoToVideoNode:["duration"],KlingMotionControl:["mode"],MinimaxHailuoVideoNode:["resolution","duration"],OpenAIDalle3:["size","quality"],OpenAIDalle2:["size","n"],OpenAIVideoSora2:["model","size","duration"],OpenAIGPTImage1:["quality","n"],IdeogramV1:["num_images","turbo"],IdeogramV2:["num_images","turbo"],IdeogramV3:["rendering_speed","num_images","character_image"],FluxProKontextProNode:[],FluxProKontextMaxNode:[],Flux2ProImageNode:["width","height","images"],Flux2MaxImageNode:["width","height","images"],VeoVideoGenerationNode:["duration_seconds"],Veo3VideoGenerationNode:["model","generate_audio"],Veo3FirstLastFrameNode:["model","generate_audio","duration"],LumaVideoNode:["model","resolution","duration"],LumaImageToVideoNode:["model","resolution","duration"],LumaImageNode:["model","aspect_ratio"],LumaImageModifyNode:["model","aspect_ratio"],PixverseTextToVideoNode:["duration_seconds","quality","motion_mode"],PixverseTransitionVideoNode:["duration_seconds","motion_mode","quality"],PixverseImageToVideoNode:["duration_seconds","quality","motion_mode"],StabilityStableImageSD_3_5Node:["model"],RecraftTextToImageNode:["n"],RecraftImageToImageNode:["n"],RecraftImageInpaintingNode:["n"],RecraftTextToVectorNode:["n"],RecraftVectorizeImageNode:["n"],RecraftGenerateColorFromImageNode:["n"],RecraftGenerateImageNode:["n"],RecraftGenerateVectorImageNode:["n"],MoonvalleyTxt2VideoNode:["length"],MoonvalleyImg2VideoNode:["length"],MoonvalleyVideo2VideoNode:["length"],RunwayImageToVideoNodeGen3a:["duration"],RunwayImageToVideoNodeGen4:["duration"],RunwayFirstLastFrameNode:["duration"],TripoTextToModelNode:["model_version","quad","style","texture","pbr","texture_quality","geometry_quality"],TripoImageToModelNode:["model_version","quad","style","texture","pbr","texture_quality","geometry_quality"],TripoMultiviewToModelNode:["model_version","quad","texture","pbr","texture_quality","geometry_quality"],TripoConversionNode:["quad","face_limit","texture_size","texture_format","force_symmetry","flatten_bottom","flatten_bottom_threshold","pivot_to_center_bottom","scale_factor","with_animation","pack_uv","bake","part_names","fbx_preset","export_vertex_colors","export_orientation","animate_in_place"],TripoTextureNode:["texture_quality"],GeminiNode:["model"],GeminiImage2Node:["resolution"],OpenAIChatNode:["model"],ByteDanceImageNode:["model"],ByteDanceImageEditNode:["model"],ByteDanceSeedreamNode:["model","sequential_image_generation","max_images"],ByteDanceTextToVideoNode:["model","duration","resolution"],ByteDanceImageToVideoNode:["model","duration","resolution"],ByteDanceFirstLastFrameNode:["model","duration","resolution"],ByteDanceImageReferenceNode:["model","duration","resolution"],WanTextToVideoApi:["duration","size"],WanImageToVideoApi:["duration","resolution"],WanReferenceVideoApi:["duration","size"],LtxvApiTextToVideo:["model","duration","resolution"],LtxvApiImageToVideo:["model","duration","resolution"]})[s]||[],"getRelevantWidgetNames")}),"useNodePricing"),Bn=new Image;Bn.src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24'%3E%3Cpath fill='none' stroke='oklch(83.01%25 0.163 83.16)' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M15.536 11.293a1 1 0 0 0 0 1.414l2.376 2.377a1 1 0 0 0 1.414 0l2.377-2.377a1 1 0 0 0 0-1.414l-2.377-2.377a1 1 0 0 0-1.414 0zm-13.239 0a1 1 0 0 0 0 1.414l2.377 2.377a1 1 0 0 0 1.414 0l2.377-2.377a1 1 0 0 0 0-1.414L6.088 8.916a1 1 0 0 0-1.414 0zm6.619 6.619a1 1 0 0 0 0 1.415l2.377 2.376a1 1 0 0 0 1.414 0l2.377-2.376a1 1 0 0 0 0-1.415l-2.377-2.376a1 1 0 0 0-1.414 0zm0-13.238a1 1 0 0 0 0 1.414l2.377 2.376a1 1 0 0 0 1.414 0l2.377-2.376a1 1 0 0 0 0-1.414l-2.377-2.377a1 1 0 0 0-1.414 0z'/%3E%3C/svg%3E";const _w=n(()=>{function e(l){if(!l.isSubgraphNode())return;l.badges=l.badges.filter(r=>!t(r));const i=o(l.subgraph);i.length>1?l.badges.push(a("Partner Nodes x "+i.length)):l.badges.push(...i)}n(e,"updateSubgraphCredits");function o(l,i=new Set){if(i.has(l.id))return[];i.add(l.id);const r=[];for(const u of l.nodes)r.push(...u.isSubgraphNode()?o(u.subgraph,i):u.badges.filter(f=>t(f)));return r}n(o,"collectCreditsBadges");function t(l){return(typeof l=="function"?l():l).icon?.image===Bn}n(t,"isCreditsBadge");const s=ct();function a(l){const i=s.completedActivePalette.light_theme;return new cs({text:l,iconOptions:{image:Bn,size:8},fgColor:s.completedActivePalette.colors.litegraph_base.BADGE_FG_COLOR,bgColor:i?Rt("#8D6932",{lightness:.5}):"#8D6932"})}return n(a,"getCreditsBadge"),{getCreditsBadge:a,updateSubgraphCredits:e}},"usePriceBadge"),Tw=n((e,o={})=>{const{widgetNames:t,triggerCanvasRedraw:s=!1}=o,a=L({});if(e.widgets){const l=t?e.widgets.filter(r=>t.includes(r.name)):e.widgets,i={};if(l.forEach(r=>{i[r.name]=r.value}),a.value=i,l.forEach(r=>{r.callback=to(r.callback,()=>{a.value={...a.value,[r.name]:r.value},s&&e.graph?.setDirtyCanvas(!0,!0)})}),t&&t.length>l.length){const r=t.map(u=>l.some(f=>f.name==u)?-1:e.inputs.findIndex(f=>f.name==u)).filter(u=>u>=0);e.onConnectionsChange=to(e.onConnectionsChange,(u,f,m)=>{r.includes(f)&&(a.value={...a.value,[r[f]]:m},s&&e.graph?.setDirtyCanvas(!0,!0))})}}return l=>ti(a,l)},"useComputedWithWidgetWatch"),$w=n(()=>{const e=ue(),o=os(),t=ct(),s=_w(),a=h(()=>e.get("Comfy.NodeBadge.NodeSourceBadgeMode")),l=h(()=>e.get("Comfy.NodeBadge.NodeIdBadgeMode")),i=h(()=>e.get("Comfy.NodeBadge.NodeLifeCycleBadgeMode")),r=h(()=>e.get("Comfy.NodeBadge.ShowApiPricing"));ae([a,l,i,r],()=>{J.canvas?.setDirty(!0,!0)});const u=ht();function f(m,v){return!(v===pt.None||m?.isCoreNode&&v===pt.HideBuiltIn)}n(f,"badgeTextVisible"),Ve(()=>{const m=Sw();o.registerExtension({name:"Comfy.NodeBadge",nodeCreated(v){v.badgePosition=Pr.TopRight;const p=h(()=>{const w=u.fromLGraphNode(v);return new cs({text:oi.truncate([f(w,l.value)?`#${v.id}`:"",f(w,i.value)?w?.nodeLifeCycleBadgeText??"":"",f(w,a.value)?w?.nodeSource?.badgeText??"":""].filter(k=>k.length>0).join(" "),{length:31}),fgColor:t.completedActivePalette.colors.litegraph_base.BADGE_FG_COLOR,bgColor:t.completedActivePalette.colors.litegraph_base.BADGE_BG_COLOR})});if(v.badges.push(()=>p.value),v.constructor.nodeData?.api_node&&r.value){const k=typeof m.getNodePricingConfig(v)?.displayPrice=="function";let g;const b=n(()=>{const S=m.getNodeDisplayPrice(v);return s.getCreditsBadge(S)},"createBadge");if(k){const S=m.getRelevantWidgetNames(v.constructor.nodeData?.name);g=Tw(v,{widgetNames:S,triggerCanvasRedraw:!0})(b)}else g=h(b);v.badges.push(()=>g.value)}},init(){J.canvas.canvas.addEventListener("litegraph:set-graph",()=>{for(const v of J.canvas.graph?.nodes??[])s.updateSubgraphCredits(v)}),J.canvas.canvas.addEventListener("subgraph-converted",v=>s.updateSubgraphCredits(v.detail.subgraphNode))},afterConfigureGraph(){for(const v of J.canvas.graph?.nodes??[])s.updateSubgraphCredits(v)}})})},"useNodeBadge"),Nw=n(e=>{const o=Zn(),t=lo(),s=Xe();ll(()=>e.value,{getDropEffect:n(a=>a.source.data.type==="tree-explorer-node"?"copy":"move","getDropEffect"),onDrop:n(async a=>{const l=a.location.current.input,i=a.source.data;if(i.type==="tree-explorer-node"){const r=i.data,f=il().clientPosToCanvasPos([l.clientX,l.clientY]);if(r.data instanceof Dr){const m=r.data,v=[...f];v[1]+=ge.NODE_TITLE_HEIGHT,t.addNodeOnGraph(m,{pos:v})}else if(r.data instanceof Ar){const m=r.data,v=f,p=J.canvas.graph?.getNodeOnPos(v[0],v[1]);let w=null,k=null;if(p){const g=o.getAllNodeProviders(m.directory);for(const b of g)b.nodeDef.name===p.comfyClass&&(k=p,w=b)}if(!k){const g=o.getNodeProvider(m.directory);g&&(k=t.addNodeOnGraph(g.nodeDef,{pos:v}),w=g)}if(k){const g=k.widgets?.find(b=>b.name===w?.key);g&&(g.value=m.file_name)}}else if(r.data instanceof Ua){const m=r.data;await s.insertWorkflow(m,{position:f})}}},"onDrop")})},"useCanvasDrop"),Iw=n(()=>{Kt.install(He.prototype,"getCanvasMenuOptions");const{getCanvasMenuOptions:e}=He.prototype,o=n(function(...r){const u=e.apply(this,r),f=J.collectCanvasMenuItems(this);for(const v of f)u.push(v);const m=Kt.extractLegacyItems("getCanvasMenuOptions",this,...r);for(const v of m)u.push(v);for(const v of u)v?.content&&(v.content=we(`contextMenu.${v.content}`,v.content));return u},"getCanvasCenterMenuOptions");He.prototype.getCanvasMenuOptions=o,Kt.registerWrapper("getCanvasMenuOptions",o,e,He.prototype),Kt.install(He.prototype,"getNodeMenuOptions");const t=He.prototype.getNodeMenuOptions,s=n(function(...r){const u=t.apply(this,r),f=r[0],m=J.collectNodeMenuItems(f);for(const p of m)u.push(p);const v=Kt.extractLegacyItems("getNodeMenuOptions",this,...r);for(const p of v)u.push(p);return u},"getNodeMenuOptionsWithExtensions");He.prototype.getNodeMenuOptions=s,Kt.registerWrapper("getNodeMenuOptions",s,t,He.prototype);function a(r,u){if(!r)return;const f=/Convert (.*) to input/,m=/Convert (.*) to widget/,v=we("contextMenu.Convert ","Convert "),p=we("contextMenu. to input"," to input"),w=we("contextMenu. to widget"," to widget");for(const k of r){if(typeof k=="string"||(a(k?.submenu?.options,u),!k?.content))continue;Lr(`contextMenu.${k.content}`)&&(k.content=we(`contextMenu.${k.content}`,k.content));const g=u.extra||u.parentMenu?.options?.extra,b=k.content?.match(f);if(b){let _=b[1];g?.inputs?.find(C=>{if(C.name!=_)return!1;_=C.label?C.label:C.name}),g?.widgets?.find(C=>{if(C.name!=_)return!1;_=C.label?C.label:C.name}),k.content=v+_+p;continue}const S=k.content?.match(m);if(S){let _=S[1];g?.inputs?.find(C=>{if(C.name!=_)return!1;_=C.label?C.label:C.name}),g?.widgets?.find(C=>{if(C.name!=_)return!1;_=C.label?C.label:C.name}),k.content=v+_+w;continue}}}n(a,"translateMenus");const l=ge.ContextMenu;function i(r,u){return u.title&&(u.title=we(`nodeDefs.${We(u.title)}.display_name`,u.title)),a(r,u),new l(r,u)}n(i,"ContextMenu"),ge.ContextMenu=i,ge.ContextMenu.prototype=l.prototype},"useContextMenuTranslation");function Mw(){const e=window.getSelection();return e!==null&&e.toString().trim().length>0}n(Mw,"hasTextSelection");function Dl(e){return e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement&&!["button","checkbox","file","hidden","image","radio","range","reset","search","submit"].includes(e.type)||me().linearMode||Mw()}n(Dl,"shouldIgnoreCopyPaste");const Pw=['<meta charset="utf-8"><div><span data-metadata="','"></span></div><span style="white-space:pre-wrap;">Text</span>'],Dw=n(()=>{const e=me();Ae(document,"copy",o=>{if(Dl(o.target))return;const t=e.canvas;if(t?.selectedItems){const s=t.copyToClipboard(),a=btoa(String.fromCharCode(...Array.from(new TextEncoder().encode(s))));return o.clipboardData?.setData("text/html",Pw.join(a)),o.preventDefault(),o.stopImmediatePropagation(),!1}})},"useCopy"),Aw=n(()=>{window.LiteGraph=ge,window.LGraph=Er,window.LLink=Or,window.LGraphNode=gt,window.LGraphGroup=Wt,window.DragAndScale=Vr,window.LGraphCanvas=He,window.ContextMenu=Rr,window.LGraphBadge=cs},"useGlobalLitegraph");function Lw(e){const t=e.getData("text/html").match(/data-metadata="([A-Za-z0-9+/=]+)"/)?.[1];if(!t)return!1;try{const s=atob(t),a=Uint8Array.from(s,i=>i.charCodeAt(0)),l=new TextDecoder().decode(a);return me().getCanvas()._deserializeItems(JSON.parse(l),{}),!0}catch(s){console.error(s)}return!1}n(Lw,"pasteClipboardItems");const Ew=n(()=>{const e=ot(),o=me(),t=n((s,a,l)=>{if(!a)return;const i=Array.from(s).filter(u=>u.type.startsWith(l)),r=i[0]?.getAsFile();r&&(a.pasteFile?.(r),a.pasteFiles?.(Array.from(i).map(u=>u.getAsFile()).filter(u=>u!==null)))},"pasteItemsOnNode");Ae(document,"paste",async s=>{if(Dl(s.target)||e.shiftDown)return;const{canvas:a}=o;if(!a)return;const{graph:l}=a;let i=s.clipboardData;if(!i)throw new Error("No clipboard data on clipboard event");const{items:r}=i,u=a.current_node,f=u?.is_selected,m=f&&Wr(u),v=f&&zr(u),p=f&&Br(u);let w=m?u:null,k=p?u:null;const g=v?u:null;for(const S of r)if(S.type.startsWith("image/")){if(!w){const _=ge.createNode("LoadImage");_&&(_.pos=[a.graph_mouse[0],a.graph_mouse[1]],w=l?.add(_)??null),l?.change()}t(r,w,"image");return}else if(S.type.startsWith("video/")){if(g){t(r,g,"video");return}}else if(S.type.startsWith("audio/")){if(!k){const _=ge.createNode("LoadAudio");_&&(_.pos=[a.graph_mouse[0],a.graph_mouse[1]],k=l?.add(_)??null),l?.change()}t(r,k,"audio");return}if(Lw(i))return;i=i.getData("text/plain");let b=null;try{i=i.slice(i.indexOf("{")),b=JSON.parse(i)}catch{try{i=i.slice(i.indexOf(`workflow
`)),i=i.slice(i.indexOf("{")),b=JSON.parse(i)}catch{b=null}}if(b&&b.version&&b.nodes&&b.extra)await J.loadGraphData(b);else{if(s.target instanceof HTMLTextAreaElement&&s.target.type==="textarea"||s.target instanceof HTMLInputElement&&s.target.type==="text")return;a.pasteFromClipboard()}})},"usePaste"),Ow=n(()=>{const e=ue(),o=me();ke(()=>{const t=e.get("Comfy.Graph.CanvasInfo");o.canvas&&(o.canvas.show_info=t,o.canvas.draw(!1,!0))}),ke(()=>{const t=e.get("Comfy.Graph.ZoomSpeed");o.canvas&&(o.canvas.zoom_speed=t)}),ke(()=>{ge.snaps_for_comfy=e.get("Comfy.Node.AutoSnapLinkToSlot")}),ke(()=>{ge.snap_highlights_node=e.get("Comfy.Node.SnapHighlightsNode")}),ke(()=>{gt.keepAllLinksOnBypass=e.get("Comfy.Node.BypassAllLinksOnDelete")}),ke(()=>{ge.middle_click_slot_add_default_node=e.get("Comfy.Node.MiddleClickRerouteNode")}),ke(()=>{const t=e.get("Comfy.LinkRenderMode");o.canvas&&(o.canvas.links_render_mode=t,o.canvas.setDirty(!1,!0))}),ke(()=>{const t=e.get("LiteGraph.Canvas.MinFontSizeForLOD");o.canvas&&(o.canvas.min_font_size_for_lod=t,o.canvas.setDirty(!0,!0))}),ke(()=>{const t=e.get("Comfy.Graph.LinkMarkers"),{canvas:s}=o;s&&(s.linkMarkerShape=t,s.setDirty(!1,!0))}),ke(()=>{const t=e.get("LiteGraph.Canvas.MaximumFps"),{canvas:s}=o;s&&(s.maximumFps=t)}),ke(()=>{const t=e.get("Comfy.Graph.CtrlShiftZoom"),{canvas:s}=o;s&&(s.dragZoomEnabled=t)}),ke(()=>{const t=e.get("Comfy.Graph.LiveSelection"),{canvas:s}=o;s&&(s.liveSelection=t)}),ke(()=>{mn.doubleClickTime=e.get("Comfy.Pointer.DoubleClickTime")}),ke(()=>{mn.bufferTime=e.get("Comfy.Pointer.ClickBufferTime")}),ke(()=>{mn.maxClickDrift=e.get("Comfy.Pointer.ClickDrift")}),ke(()=>{ge.CANVAS_GRID_SIZE=e.get("Comfy.SnapToGrid.GridSize")}),ke(()=>{ge.alwaysSnapToGrid=e.get("pysssss.SnapToGrid")}),ke(()=>{ge.context_menu_scaling=e.get("LiteGraph.ContextMenu.Scaling")}),ke(()=>{ge.Reroute.maxSplineOffset=e.get("LiteGraph.Reroute.SplineOffset")}),ke(()=>{const t=e.get("Comfy.Canvas.NavigationMode");ge.canvasNavigationMode=t,ge.macTrackpadGestures=t==="standard"}),ke(()=>{const t=e.get("Comfy.Canvas.LeftMouseClickBehavior");ge.leftMouseClickBehavior=t}),ke(()=>{const t=e.get("Comfy.Canvas.MouseWheelScroll");ge.mouseWheelScroll=t}),ke(()=>{ge.saveViewportWithGraph=e.get("Comfy.EnableWorkflowViewRestore")})},"useLitegraphSettings"),Vw=[{id:"Comfy.Memory.AllowManualUnload",name:"Allow manual unload of models and execution cache via user command",type:"hidden",defaultValue:!0,versionAdded:"1.18.0"},{id:"Comfy.Validation.Workflows",name:"Validate workflows",type:"boolean",defaultValue:!1},{id:"Comfy.NodeSearchBoxImpl",category:["Comfy","Node Search Box","Implementation"],experimental:!0,name:"Node search box implementation",type:"combo",options:["default","litegraph (legacy)"],defaultValue:"default"},{id:"Comfy.LinkRelease.Action",category:["LiteGraph","LinkRelease","Action"],name:"Action on link release (No modifier)",type:"combo",options:Object.values(xt),defaultValue:xt.CONTEXT_MENU,defaultsByInstallVersion:{"1.24.1":xt.SEARCH_BOX}},{id:"Comfy.LinkRelease.ActionShift",category:["LiteGraph","LinkRelease","ActionShift"],name:"Action on link release (Shift)",type:"combo",options:Object.values(xt),defaultValue:xt.SEARCH_BOX,defaultsByInstallVersion:{"1.24.1":xt.CONTEXT_MENU}},{id:"Comfy.NodeSearchBoxImpl.NodePreview",category:["Comfy","Node Search Box","NodePreview"],name:"Node preview",tooltip:"Only applies to the default implementation",type:"boolean",defaultValue:!0},{id:"Comfy.NodeSearchBoxImpl.ShowCategory",category:["Comfy","Node Search Box","ShowCategory"],name:"Show node category in search results",tooltip:"Only applies to the default implementation",type:"boolean",defaultValue:!0},{id:"Comfy.NodeSearchBoxImpl.ShowIdName",category:["Comfy","Node Search Box","ShowIdName"],name:"Show node id name in search results",tooltip:"Only applies to the default implementation",type:"boolean",defaultValue:!1},{id:"Comfy.NodeSearchBoxImpl.ShowNodeFrequency",category:["Comfy","Node Search Box","ShowNodeFrequency"],name:"Show node frequency in search results",tooltip:"Only applies to the default implementation",type:"boolean",defaultValue:!1},{id:"Comfy.Sidebar.Location",category:["Appearance","Sidebar","Location"],name:"Sidebar location",type:"combo",options:["left","right"],defaultValue:"left"},{id:"Comfy.Sidebar.Size",category:["Appearance","Sidebar","Size"],name:"Sidebar size",type:"combo",options:["normal","small"],defaultValue:n(()=>window.innerWidth<1536?"small":"normal","defaultValue")},{id:"Comfy.Sidebar.UnifiedWidth",category:["Appearance","Sidebar","UnifiedWidth"],name:"Unified sidebar width",type:"boolean",defaultValue:!0,versionAdded:"1.18.1"},{id:"Comfy.Sidebar.Style",category:["Appearance","Sidebar","Style"],name:"Sidebar style",type:"combo",options:["floating","connected"],defaultValue:"connected"},{id:"Comfy.TextareaWidget.FontSize",category:["Appearance","Node Widget","TextareaWidget","FontSize"],name:"Textarea widget font size",type:"slider",defaultValue:10,attrs:{min:8,max:24}},{id:"Comfy.TextareaWidget.Spellcheck",category:["Comfy","Node Widget","TextareaWidget","Spellcheck"],name:"Textarea widget spellcheck",type:"boolean",defaultValue:!1},{id:"Comfy.Workflow.SortNodeIdOnSave",name:"Sort node IDs when saving workflow",type:"boolean",defaultValue:!1},{id:"Comfy.Canvas.NavigationMode",category:["LiteGraph","Canvas Navigation","NavigationMode"],name:"Navigation Mode",defaultValue:"legacy",type:"combo",sortOrder:100,options:[{value:"standard",text:"Standard (New)"},{value:"legacy",text:"Drag Navigation"},{value:"custom",text:"Custom"}],versionAdded:"1.25.0",defaultsByInstallVersion:{"1.25.0":"legacy"},onChange:n(async(e,o)=>{if(!o)return;const t=ue();e==="standard"?(await t.set("Comfy.Canvas.LeftMouseClickBehavior","select"),await t.set("Comfy.Canvas.MouseWheelScroll","panning")):e==="legacy"&&(await t.set("Comfy.Canvas.LeftMouseClickBehavior","panning"),await t.set("Comfy.Canvas.MouseWheelScroll","zoom"))},"onChange")},{id:"Comfy.Canvas.LeftMouseClickBehavior",category:["LiteGraph","Canvas Navigation","LeftMouseClickBehavior"],name:"Left Mouse Click Behavior",defaultValue:"panning",type:"radio",sortOrder:50,options:[{value:"panning",text:"Panning"},{value:"select",text:"Select"}],versionAdded:"1.27.4",onChange:n(async e=>{const o=ue(),t=o.get("Comfy.Canvas.NavigationMode");if(t!=="custom"){if(e==="select"&&t==="standard"||e==="panning"&&t==="legacy")return;await o.set("Comfy.Canvas.NavigationMode","custom")}},"onChange")},{id:"Comfy.Canvas.MouseWheelScroll",category:["LiteGraph","Canvas Navigation","MouseWheelScroll"],name:"Mouse Wheel Scroll",defaultValue:"zoom",type:"radio",options:[{value:"panning",text:"Panning"},{value:"zoom",text:"Zoom in/out"}],versionAdded:"1.27.4",onChange:n(async e=>{const o=ue(),t=o.get("Comfy.Canvas.NavigationMode");if(t!=="custom"){if(e==="panning"&&t==="standard"||e==="zoom"&&t==="legacy")return;await o.set("Comfy.Canvas.NavigationMode","custom")}},"onChange")},{id:"Comfy.Graph.CanvasInfo",category:["LiteGraph","Canvas","CanvasInfo"],name:"Show canvas info on bottom left corner (fps, etc.)",type:"boolean",defaultValue:!0},{id:"Comfy.Node.ShowDeprecated",name:"Show deprecated nodes in search",tooltip:"Deprecated nodes are hidden by default in the UI, but remain functional in existing workflows that use them.",type:"boolean",defaultValue:!1},{id:"Comfy.Node.ShowExperimental",name:"Show experimental nodes in search",tooltip:"Experimental nodes are marked as such in the UI and may be subject to significant changes or removal in future versions. Use with caution in production workflows",type:"boolean",defaultValue:!0},{id:"Comfy.Node.Opacity",category:["Appearance","Node","Opacity"],name:"Node opacity",type:"slider",defaultValue:1,attrs:{min:.01,max:1,step:.01}},{id:"Comfy.Workflow.ShowMissingNodesWarning",name:"Show missing nodes warning",type:"boolean",defaultValue:!0},{id:"Comfy.Workflow.ShowMissingModelsWarning",name:"Show missing models warning",type:"boolean",defaultValue:!0,experimental:!0},{id:"Comfy.Workflow.WarnBlueprintOverwrite",name:"Require confirmation to overwrite an existing subgraph blueprint",type:"boolean",defaultValue:!0},{id:"Comfy.Graph.ZoomSpeed",category:["LiteGraph","Canvas","ZoomSpeed"],name:"Canvas zoom speed",type:"slider",defaultValue:1.1,attrs:{min:1.01,max:2.5,step:.01}},{id:"Comfy.NodeLibrary.Bookmarks",name:"Node library bookmarks with display name (deprecated)",type:"hidden",defaultValue:[],deprecated:!0},{id:"Comfy.NodeLibrary.Bookmarks.V2",name:"Node library bookmarks v2 with unique name",type:"hidden",defaultValue:[]},{id:"Comfy.NodeLibrary.BookmarksCustomization",name:"Node library bookmarks customization",type:"hidden",defaultValue:{}},{id:"Comfy.GroupSelectedNodes.Padding",category:["LiteGraph","Group","Padding"],name:"Group selected nodes padding",type:"slider",defaultValue:10,attrs:{min:0,max:100}},{id:"Comfy.Node.DoubleClickTitleToEdit",category:["LiteGraph","Node","DoubleClickTitleToEdit"],name:"Double click node title to edit",type:"boolean",defaultValue:!0},{id:"Comfy.Node.AllowImageSizeDraw",category:["LiteGraph","Node Widget","AllowImageSizeDraw"],name:"Show width  height below the image preview",type:"boolean",defaultValue:!0},{id:"Comfy.Group.DoubleClickTitleToEdit",category:["LiteGraph","Group","DoubleClickTitleToEdit"],name:"Double click group title to edit",type:"boolean",defaultValue:!0},{id:"Comfy.Window.UnloadConfirmation",name:"Show confirmation when closing window",type:"boolean",defaultValue:!0,versionModified:"1.7.12"},{id:"Comfy.TreeExplorer.ItemPadding",category:["Appearance","Tree Explorer","ItemPadding"],name:"Tree explorer item padding",type:"slider",defaultValue:2,attrs:{min:0,max:8,step:1}},{id:"Comfy.ModelLibrary.AutoLoadAll",name:"Automatically load all model folders",tooltip:"If true, all folders will load as soon as you open the model library (this may cause delays while it loads). If false, root level model folders will only load once you click on them.",type:"boolean",defaultValue:!1},{id:"Comfy.ModelLibrary.NameFormat",name:"What name to display in the model library tree view",tooltip:'Select "filename" to render a simplified view of the raw filename (without directory or ".safetensors" extension) in the model list. Select "title" to display the configurable model metadata title.',type:"combo",options:["filename","title"],defaultValue:"title"},{id:"Comfy.Locale",name:"Language",type:"combo",options:[{value:"en",text:"English"},{value:"zh",text:""},{value:"zh-TW",text:""},{value:"ru",text:""},{value:"ja",text:""},{value:"ko",text:""},{value:"fr",text:"Franais"},{value:"es",text:"Espaol"},{value:"ar",text:""},{value:"tr",text:"Trke"},{value:"pt-BR",text:"Portugus (BR)"}],defaultValue:n(()=>navigator.language.split("-")[0]||"en","defaultValue")},{id:"Comfy.NodeBadge.NodeSourceBadgeMode",category:["LiteGraph","Node","NodeSourceBadgeMode"],name:"Node source badge mode",type:"combo",options:Object.values(pt),defaultValue:pt.HideBuiltIn},{id:"Comfy.NodeBadge.NodeIdBadgeMode",category:["LiteGraph","Node","NodeIdBadgeMode"],name:"Node ID badge mode",type:"combo",options:[pt.None,pt.ShowAll],defaultValue:pt.None},{id:"Comfy.NodeBadge.NodeLifeCycleBadgeMode",category:["LiteGraph","Node","NodeLifeCycleBadgeMode"],name:"Node life cycle badge mode",type:"combo",options:[pt.None,pt.ShowAll],defaultValue:pt.ShowAll},{id:"Comfy.NodeBadge.ShowApiPricing",category:["Comfy","API Nodes"],name:"Show API node pricing badge",type:"boolean",defaultValue:!0,versionAdded:"1.20.3"},{id:"Comfy.Notification.ShowVersionUpdates",category:["Comfy","Notification Preferences"],name:"Show version updates",tooltip:"Show updates for new models, and major new features.",type:"boolean",defaultValue:!0},{id:"Comfy.ConfirmClear",category:["Comfy","Workflow","ConfirmClear"],name:"Require confirmation when clearing workflow",type:"boolean",defaultValue:!0},{id:"Comfy.PromptFilename",category:["Comfy","Workflow","PromptFilename"],name:"Prompt for filename when saving workflow",type:"boolean",defaultValue:!0},{id:"Comfy.PreviewFormat",category:["LiteGraph","Node Widget","PreviewFormat"],name:"Preview image format",tooltip:"When displaying a preview in the image widget, convert it to a lightweight image, e.g. webp, jpeg, webp;50, etc.",type:"text",defaultValue:""},{id:"Comfy.DisableSliders",category:["LiteGraph","Node Widget","DisableSliders"],name:"Disable node widget sliders",type:"boolean",defaultValue:!1},{id:"Comfy.DisableFloatRounding",category:["LiteGraph","Node Widget","DisableFloatRounding"],name:"Disable default float widget rounding.",tooltip:"(requires page reload) Cannot disable round when round is set by the node in the backend.",type:"boolean",defaultValue:!1},{id:"Comfy.FloatRoundingPrecision",category:["LiteGraph","Node Widget","FloatRoundingPrecision"],name:"Float widget rounding decimal places [0 = auto].",tooltip:"(requires page reload)",type:"slider",attrs:{min:0,max:6,step:1},defaultValue:0},{id:"LiteGraph.Node.TooltipDelay",name:"Tooltip Delay",type:"number",attrs:{min:100,max:3e3,step:50},defaultValue:500,versionAdded:"1.9.0"},{id:"Comfy.EnableTooltips",category:["LiteGraph","Node","EnableTooltips"],name:"Enable Tooltips",type:"boolean",defaultValue:!0},{id:"Comfy.DevMode",name:"Enable dev mode options (API save, etc.)",type:"boolean",defaultValue:!1,onChange:n(e=>{const o=document.getElementById("comfy-dev-save-api-button");o&&(o.style.display=e?"flex":"none")},"onChange")},{id:"Comfy.UseNewMenu",category:["Comfy","Menu","UseNewMenu"],defaultValue:"Top",name:"Use new menu",type:"combo",options:["Disabled","Top"],tooltip:"Enable the redesigned top menu bar.",migrateDeprecatedValue:n(e=>e==="Floating"||e==="Bottom"?"Top":e,"migrateDeprecatedValue")},{id:"Comfy.Workflow.WorkflowTabsPosition",name:"Opened workflows position",type:"combo",options:["Sidebar","Topbar"],defaultValue:"Topbar",migrateDeprecatedValue:n(e=>e==="Topbar (2nd-row)"?"Topbar":e,"migrateDeprecatedValue")},{id:"Comfy.Graph.CanvasMenu",category:["LiteGraph","Canvas","CanvasMenu"],name:"Show graph canvas menu",type:"boolean",defaultValue:!0},{id:"Comfy.QueueButton.BatchCountLimit",name:"Batch count limit",tooltip:"The maximum number of tasks added to the queue at one button click",type:"number",defaultValue:100,versionAdded:"1.3.5"},{id:"Comfy.Keybinding.UnsetBindings",name:"Keybindings unset by the user",type:"hidden",defaultValue:[],versionAdded:"1.3.7",versionModified:"1.7.3",migrateDeprecatedValue:n(e=>e.map(o=>(o.targetSelector==="#graph-canvas"&&(o.targetElementId="graph-canvas-container"),o)),"migrateDeprecatedValue")},{id:"Comfy.Keybinding.NewBindings",name:"Keybindings set by the user",type:"hidden",defaultValue:[],versionAdded:"1.3.7"},{id:"Comfy.Extension.Disabled",name:"Disabled extension names",type:"hidden",defaultValue:[],versionAdded:"1.3.11"},{id:"Comfy.LinkRenderMode",category:["LiteGraph","Graph","LinkRenderMode"],name:"Link Render Mode",defaultValue:2,type:"combo",options:[{value:ge.STRAIGHT_LINK,text:"Straight"},{value:ge.LINEAR_LINK,text:"Linear"},{value:ge.SPLINE_LINK,text:"Spline"},{value:ge.HIDDEN_LINK,text:"Hidden"}]},{id:"Comfy.Node.AutoSnapLinkToSlot",category:["LiteGraph","Node","AutoSnapLinkToSlot"],name:"Auto snap link to node slot",tooltip:"When dragging a link over a node, the link automatically snap to a viable input slot on the node",type:"boolean",defaultValue:!0,versionAdded:"1.3.29"},{id:"Comfy.Node.SnapHighlightsNode",category:["LiteGraph","Node","SnapHighlightsNode"],name:"Snap highlights node",tooltip:"When dragging a link over a node with viable input slot, highlight the node",type:"boolean",defaultValue:!0,versionAdded:"1.3.29"},{id:"Comfy.Node.BypassAllLinksOnDelete",category:["LiteGraph","Node","BypassAllLinksOnDelete"],name:"Keep all links when deleting nodes",tooltip:"When deleting a node, attempt to reconnect all of its input and output links (bypassing the deleted node)",type:"boolean",defaultValue:!0,versionAdded:"1.3.40"},{id:"Comfy.Node.MiddleClickRerouteNode",category:["LiteGraph","Node","MiddleClickRerouteNode"],name:"Middle-click creates a new Reroute node",type:"boolean",defaultValue:!0,versionAdded:"1.3.42"},{id:"Comfy.Graph.LinkMarkers",category:["LiteGraph","Link","LinkMarkers"],name:"Link midpoint markers",defaultValue:Io.Circle,type:"combo",options:[{value:Io.None,text:"None"},{value:Io.Circle,text:"Circle"},{value:Io.Arrow,text:"Arrow"}],versionAdded:"1.3.42"},{id:"Comfy.DOMClippingEnabled",category:["LiteGraph","Node","DOMClippingEnabled"],name:"Enable DOM element clipping (enabling may reduce performance)",type:"boolean",defaultValue:!0},{id:"Comfy.Graph.CtrlShiftZoom",category:["LiteGraph","Canvas","CtrlShiftZoom"],name:"Enable fast-zoom shortcut (Ctrl + Shift + Drag)",type:"boolean",defaultValue:!0,versionAdded:"1.4.0"},{id:"Comfy.Graph.LiveSelection",category:["LiteGraph","Canvas","LiveSelection"],name:"Live selection",tooltip:"When enabled, nodes are selected/deselected in real-time as you drag the selection rectangle, similar to other design tools.",type:"boolean",defaultValue:!1,versionAdded:"1.36.1"},{id:"Comfy.Pointer.ClickDrift",category:["LiteGraph","Pointer","ClickDrift"],name:"Pointer click drift (maximum distance)",tooltip:`If the pointer moves more than this distance while holding a button down, it is considered dragging (rather than clicking).

Helps prevent objects from being unintentionally nudged if the pointer is moved whilst clicking.`,experimental:!0,type:"slider",attrs:{min:0,max:20,step:1},defaultValue:6,versionAdded:"1.4.3"},{id:"Comfy.Pointer.ClickBufferTime",category:["LiteGraph","Pointer","ClickBufferTime"],name:"Pointer click drift delay",tooltip:`After pressing a pointer button down, this is the maximum time (in milliseconds) that pointer movement can be ignored for.

Helps prevent objects from being unintentionally nudged if the pointer is moved whilst clicking.`,experimental:!0,type:"slider",attrs:{min:0,max:1e3,step:25},defaultValue:150,versionAdded:"1.4.3"},{id:"Comfy.Pointer.DoubleClickTime",category:["LiteGraph","Pointer","DoubleClickTime"],name:"Double click interval (maximum)",tooltip:"The maximum time in milliseconds between the two clicks of a double-click.  Increasing this value may assist if double-clicks are sometimes not registered.",type:"slider",attrs:{min:100,max:1e3,step:50},defaultValue:300,versionAdded:"1.4.3"},{id:"Comfy.SnapToGrid.GridSize",category:["LiteGraph","Canvas","GridSize"],name:"Snap to grid size",type:"slider",attrs:{min:1,max:500},tooltip:"When dragging and resizing nodes while holding shift they will be aligned to the grid, this controls the size of that grid.",defaultValue:ge.CANVAS_GRID_SIZE},{id:"pysssss.SnapToGrid",category:["LiteGraph","Canvas","AlwaysSnapToGrid"],name:"Always snap to grid",type:"boolean",defaultValue:!1,versionAdded:"1.3.13"},{id:"Comfy.Server.ServerConfigValues",name:"Server config values for frontend display",tooltip:"Server config values used for frontend display only",type:"hidden",defaultValue:{},versionAdded:"1.4.8"},{id:"Comfy.Server.LaunchArgs",name:"Server launch arguments",tooltip:"These are the actual arguments that are passed to the server when it is launched.",type:"hidden",defaultValue:{},versionAdded:"1.4.8"},{id:"Comfy.Queue.MaxHistoryItems",name:"Queue history size",tooltip:"The maximum number of tasks that show in the queue history.",type:"slider",attrs:{min:2,max:256,step:2},defaultValue:64,versionAdded:"1.4.12"},{id:"Comfy.Execution.PreviewMethod",category:["Comfy","Execution","PreviewMethod"],name:"Live preview method",tooltip:'Live preview method during image generation. "default" uses the server CLI setting.',type:"combo",options:["default","none","auto","latent2rgb","taesd"],defaultValue:"default",versionAdded:"1.36.0"},{id:"LiteGraph.Canvas.MaximumFps",name:"Maximum FPS",tooltip:"The maximum frames per second that the canvas is allowed to render. Caps GPU usage at the cost of smoothness. If 0, the screen refresh rate is used. Default: 0",type:"slider",attrs:{min:0,max:120},defaultValue:0,versionAdded:"1.5.1"},{id:"Comfy.EnableWorkflowViewRestore",category:["Comfy","Workflow","EnableWorkflowViewRestore"],name:"Save and restore canvas position and zoom level in workflows",type:"boolean",defaultValue:!0,versionModified:"1.5.4"},{id:"Comfy.Workflow.ConfirmDelete",name:"Show confirmation when deleting workflows",type:"boolean",defaultValue:!0,versionAdded:"1.5.6"},{id:"Comfy.ColorPalette",name:"The active color palette id",type:"hidden",defaultValue:"dark",versionModified:"1.6.7",migrateDeprecatedValue(e){return e.startsWith("custom_")?e.replace("custom_",""):e}},{id:"Comfy.CustomColorPalettes",name:"Custom color palettes",type:"hidden",defaultValue:{},versionModified:"1.6.7"},{id:"Comfy.WidgetControlMode",category:["Comfy","Node Widget","WidgetControlMode"],name:"Widget control mode",tooltip:"Controls when widget values are updated (randomize/increment/decrement), either before the prompt is queued or after.",type:"combo",defaultValue:"after",options:["before","after"],versionModified:"1.6.10"},{id:"Comfy.TutorialCompleted",name:"Tutorial completed",type:"hidden",defaultValue:!1,versionAdded:"1.8.7"},{id:"Comfy.InstalledVersion",name:"The frontend version that was running when the user first installed ComfyUI",type:"hidden",defaultValue:null,versionAdded:"1.24.0"},{id:"LiteGraph.ContextMenu.Scaling",name:"Scale node combo widget menus (lists) when zoomed in",defaultValue:!1,type:"boolean",versionAdded:"1.8.8"},{id:"LiteGraph.Canvas.LowQualityRenderingZoomThreshold",type:"hidden",deprecated:!0,name:"Low quality rendering zoom threshold (deprecated)",tooltip:"Zoom level threshold for performance mode. Lower values (0.1) = quality at all zoom levels. Higher values (1.0) = performance mode even when zoomed in. Performance mode simplifies rendering by hiding text labels, shadows, and details.",attrs:{min:.1,max:1,step:.01},defaultValue:.6,versionAdded:"1.9.1",versionModified:"1.26.7"},{id:"LiteGraph.Canvas.MinFontSizeForLOD",name:"Zoom Node Level of Detail - font size threshold",tooltip:"Controls when the nodes switch to low quality LOD rendering. Uses font size in pixels to determine when to switch. Set to 0 to disable. Values 1-24 set the minimum font size threshold for LOD - higher values (24px) = switch nodes to simplified rendering sooner when zooming out, lower values (1px) = maintain full node quality longer.",type:"slider",attrs:{min:0,max:24,step:1},defaultValue:8,versionAdded:"1.26.7",hideInVueNodes:!0},{id:"Comfy.Canvas.SelectionToolbox",category:["LiteGraph","Canvas","SelectionToolbox"],name:"Show selection toolbox",type:"boolean",defaultValue:!0,versionAdded:"1.10.5"},{id:"LiteGraph.Reroute.SplineOffset",name:"Reroute spline offset",tooltip:"The bezier control point offset from the reroute centre point",type:"slider",defaultValue:20,attrs:{min:0,max:400},versionAdded:"1.15.7"},{id:"Comfy.Toast.DisableReconnectingToast",name:"Disable toasts when reconnecting or reconnected",type:"hidden",defaultValue:!1,versionAdded:"1.15.12"},{id:"Comfy.Minimap.Visible",name:"Display minimap on canvas",type:"hidden",defaultValue:window.innerWidth>=tn.lg,versionAdded:"1.25.0"},{id:"Comfy.Minimap.NodeColors",name:"Display node with its original color on minimap",type:"hidden",defaultValue:!1,versionAdded:"1.26.0"},{id:"Comfy.Minimap.ShowLinks",name:"Display links on minimap",type:"hidden",defaultValue:!0,versionAdded:"1.26.0"},{id:"Comfy.Minimap.ShowGroups",name:"Display node groups on minimap",type:"hidden",defaultValue:!0,versionAdded:"1.26.0"},{id:"Comfy.Minimap.RenderBypassState",name:"Render bypass state on minimap",type:"hidden",defaultValue:!0,versionAdded:"1.26.0"},{id:"Comfy.Minimap.RenderErrorState",name:"Render error state on minimap",type:"hidden",defaultValue:!0,versionAdded:"1.26.0"},{id:"Comfy.Workflow.AutoSaveDelay",name:"Auto Save Delay (ms)",defaultValue:1e3,type:"number",tooltip:'Only applies if Auto Save is set to "after delay".',versionAdded:"1.16.0"},{id:"Comfy.Workflow.AutoSave",name:"Auto Save",type:"combo",options:["off","after delay"],defaultValue:"off",versionAdded:"1.16.0"},{id:"Comfy.Workflow.Persist",name:"Persist workflow state and restore on page (re)load",type:"boolean",defaultValue:!0,versionAdded:"1.16.1"},{id:"LiteGraph.Node.DefaultPadding",name:"Always shrink new nodes",tooltip:"Resize nodes to the smallest possible size when created. When disabled, a newly added node will be widened slightly to show widget values.",type:"boolean",defaultValue:!1,versionAdded:"1.18.0"},{id:"Comfy.Canvas.BackgroundImage",category:["Appearance","Canvas","Background"],name:"Canvas background image",type:"backgroundImage",tooltip:'Image URL for the canvas background. You can right-click an image in the outputs panel and select "Set as Background" to use it, or upload your own image using the upload button.',defaultValue:"",versionAdded:"1.20.4",versionModified:"1.20.5"},{id:"Comfy.Release.Version",name:"Last seen release version",type:"hidden",defaultValue:""},{id:"Comfy.Release.Status",name:"Release status",type:"hidden",defaultValue:"skipped"},{id:"Comfy.Release.Timestamp",name:"Release seen timestamp",type:"hidden",defaultValue:0},{id:"Comfy.Templates.SelectedModels",name:"Template library - Selected model filters",type:"hidden",defaultValue:[]},{id:"Comfy.Templates.SelectedUseCases",name:"Template library - Selected use case filters",type:"hidden",defaultValue:[]},{id:"Comfy.Templates.SelectedRunsOn",name:"Template library - Selected runs on filters",type:"hidden",defaultValue:[]},{id:"Comfy.Templates.SortBy",name:"Template library - Sort preference",type:"hidden",defaultValue:"default"},{id:"Comfy.VueNodes.Enabled",category:["Comfy","Nodes 2.0","VueNodesEnabled"],name:"Modern Node Design (Nodes 2.0)",type:"boolean",tooltip:"Modern: DOM-based rendering with enhanced interactivity, native browser features, and updated visual design. Classic: Traditional canvas rendering.",defaultValue:!1,sortOrder:100,experimental:!0,versionAdded:"1.27.1"},{id:"Comfy.VueNodes.AutoScaleLayout",category:["Comfy","Nodes 2.0","AutoScaleLayout"],name:"Auto-scale layout (Nodes 2.0)",tooltip:"Automatically scale node positions when switching to Nodes 2.0 rendering to prevent overlap",type:"boolean",sortOrder:50,experimental:!0,defaultValue:!0,versionAdded:"1.30.3"},{id:"Comfy.Assets.UseAssetAPI",name:"Use Asset API for model library",type:"hidden",tooltip:"Use new Asset API for model browsing",defaultValue:!1,experimental:!0},{id:"Comfy.VersionCompatibility.DisableWarnings",name:"Disable version compatibility warnings",type:"hidden",defaultValue:!1,versionAdded:"1.34.1"},{id:"Comfy.Queue.QPOV2",name:"Queue Panel V2",type:"hidden",tooltip:"Enable the new Assets Panel design with list/grid view toggle",defaultValue:!1,experimental:!0}];function Rw(){const e=Le(),o=ue(),t=Xe(),s=h(()=>o.get("Comfy.Workflow.AutoSave")),a=h(()=>o.get("Comfy.Workflow.AutoSaveDelay"));let l=null,i=!1,r=!1;const u=n(()=>{if(l&&(clearTimeout(l),l=null),s.value==="after delay"){if(i){r=!0;return}const m=a.value;l=setTimeout(async()=>{const v=e.activeWorkflow;if(v?.isModified&&v.isPersisted)try{i=!0,await t.saveWorkflow(v)}catch(p){console.error("Auto save failed:",p)}finally{i=!1,r&&(r=!1,u())}},m)}},"scheduleAutoSave");ae(s,m=>{l&&(clearTimeout(l),l=null),m==="after delay"&&e.activeWorkflow?.isModified&&u()},{immediate:!0});const f=n(()=>{u()},"onGraphChanged");Se.addEventListener("graphChanged",f),ut(()=>{l&&(clearTimeout(l),l=null),Se.removeEventListener("graphChanged",f)})}n(Rw,"useWorkflowAutoSave");function Ww(){const e=La(),o=Ea(),{t}=pe(),s=Bt(),a=Nl(),l=me(),i=rl.TEMPLATE,r=["linear"],u=n(p=>/^[a-zA-Z0-9_.-]+$/.test(p),"isValidParameter"),f=n(p=>r.includes(p),"isSupportedMode"),m=n(()=>{const p={...e.query};delete p.template,delete p.source,delete p.mode,o.replace({query:p})},"cleanupUrlParams");return{loadTemplateFromUrl:n(async()=>{const p=e.query.template;if(!p||typeof p!="string")return;if(!u(p)){console.warn(`[useTemplateUrlLoader] Invalid template parameter format: ${p}`);return}const w=e.query.source||"default";if(!u(w)){console.warn(`[useTemplateUrlLoader] Invalid source parameter format: ${w}`);return}const k=e.query.mode;if(k&&(typeof k!="string"||!u(k))){console.warn(`[useTemplateUrlLoader] Invalid mode parameter format: ${k}`);return}k&&!f(k)&&console.warn(`[useTemplateUrlLoader] Unsupported mode parameter: ${k}. Supported modes: ${r.join(", ")}`);try{await a.loadTemplates(),await a.loadWorkflowTemplate(p,w)?k==="linear"&&(l.linearMode=!0):s.add({severity:"error",summary:t("g.error"),detail:t("templateWorkflows.error.templateNotFound",{templateName:p}),life:3e3})}catch(g){console.error("[useTemplateUrlLoader] Failed to load template from URL:",g),s.add({severity:"error",summary:t("g.error"),detail:t("g.errorLoadingTemplate"),life:3e3})}finally{m(),Fr(i)}},"loadTemplateFromUrl")}}n(Ww,"useTemplateUrlLoader");function zw(){const e=Le(),o=ue(),t=La(),s=Ea(),a=Ww(),l=rl.TEMPLATE,i=n(async()=>{Ur(l);const x=Gr(l,t.query);return x&&await s.replace({query:x}),x??t.query},"ensureTemplateQueryFromIntent"),r=h(()=>o.get("Comfy.Workflow.Persist")),u=n(()=>{if(!r.value)return;const x=JSON.stringify(J.rootGraph.serialize());try{localStorage.setItem("workflow",x),Se.clientId&&sessionStorage.setItem(`workflow:${Se.clientId}`,x)}catch(N){const M=Object.keys(sessionStorage).filter($=>$.startsWith("workflow:")||$==="workflow");throw console.error("QuotaExceededError details:",{workflowSizeKB:Math.round(x.length/1024),totalStorageItems:Object.keys(sessionStorage).length,ourWorkflowKeys:M.length,ourWorkflowSizes:M.map($=>({key:$,sizeKB:Math.round(sessionStorage[$].length/1024)})),error:N instanceof Error?N.message:String(N)}),N}},"persistCurrentWorkflow"),f=n(async(x,N)=>{if(!x)return!1;const M=JSON.parse(x);return await J.loadGraphData(M,!0,!0,N),!0},"loadWorkflowFromStorage"),m=n(async()=>{const x=gn("Comfy.PreviousWorkflow"),N=Se.initialClientId??Se.clientId;if(N){const $=sessionStorage.getItem(`workflow:${N}`);if(await f($,x))return!0}const M=localStorage.getItem("workflow");return await f(M,x)},"loadPreviousWorkflowFromStorage"),v=n(async()=>{o.get("Comfy.TutorialCompleted")?await J.loadGraphData():(await o.set("Comfy.TutorialCompleted",!0),await Xe().loadBlankWorkflow(),await _e().execute("Comfy.BrowseTemplates"))},"loadDefaultWorkflow"),p=n(async()=>{if(r.value)try{await m()||await v()}catch(x){console.error("Error loading previous workflow",x),await v()}},"initializeWorkflow"),w=n(async()=>{const x=await i();x.template&&typeof x.template=="string"&&await a.loadTemplateFromUrl()},"loadTemplateFromUrlIfPresent");ae(()=>e.activeWorkflow?.key,x=>{x&&(vn("Comfy.PreviousWorkflow",x),u())}),Se.addEventListener("graphChanged",u),Pa(()=>{Se.removeEventListener("graphChanged",u)});const k=h(()=>e.openWorkflows),g=h(()=>e.activeWorkflow),b=h(()=>{if(!k.value||!g.value)return{paths:[],activeIndex:-1};const x=k.value.filter(M=>M?.isPersisted).map(M=>M.path),N=k.value.findIndex(M=>M.path===g.value?.path);return{paths:x,activeIndex:N}}),S=JSON.parse(gn("Comfy.OpenWorkflowsPaths")||"[]"),_=JSON.parse(gn("Comfy.ActiveWorkflowIndex")||"-1");return ae(b,({paths:x,activeIndex:N})=>{r.value&&(vn("Comfy.OpenWorkflowsPaths",JSON.stringify(x)),vn("Comfy.ActiveWorkflowIndex",JSON.stringify(N)))}),{initializeWorkflow:p,loadTemplateFromUrlIfPresent:w,restoreWorkflowTabsState:n(()=>{if(!r.value)return;S?.length>0&&_>=0&&e.openWorkflowsInBackground({left:S.slice(0,_),right:S.slice(_)})},"restoreWorkflowTabsState")}}n(zw,"useWorkflowPersistence");function Bw(e,o={}){const{settleDelay:t=256,passive:s=!0}=o,a=L(!1),l=n(()=>{a.value=!0},"markTransformActive"),i=ni(()=>{a.value=!1},t);return Ae(e,"wheel",n(()=>{l(),i()},"handleWheel"),{capture:!0,passive:s}),{isTransforming:a}}n(Bw,"useTransformSettling");function Fw(){const e=Na({x:0,y:0,z:1}),o=h(()=>({transform:`scale(${e.z}) translate(${e.x}px, ${e.y}px)`,transformOrigin:"0 0"}));function t(p){!p||!p.ds||(e.x=p.ds.offset[0],e.y=p.ds.offset[1],e.z=p.ds.scale||1)}n(t,"syncWithCanvas");function s(p){return{x:(p.x+e.x)*e.z,y:(p.y+e.y)*e.z}}n(s,"canvasToScreen");const a=n(p=>({x:p.x/e.z-e.x,y:p.y/e.z-e.y}),"screenToCanvas");function l(p,w){const k=s({x:p[0],y:p[1]}),g=w[0]*e.z,b=w[1]*e.z;return new DOMRect(k.x,k.y,g,b)}n(l,"getNodeScreenBounds");function i(p){return e.z<.1?Math.min(p*5,2):e.z>3?Math.max(p*.5,.05):p}n(i,"calculateAdjustedMargin");function r(p){return Math.max(p[0],p[1])*e.z<4}n(r,"isNodeTooSmall");function u(p,w){const k=p.width*w,g=p.height*w;return{left:-k,right:p.width+k,top:-g,bottom:p.height+g}}n(u,"getExpandedViewportBounds");function f(p,w,k){const g=p.x+w[0]*e.z,b=p.y+w[1]*e.z;return!(g<k.left||p.x>k.right||b<k.top||p.y>k.bottom)}n(f,"testViewportIntersection");function m(p,w,k,g=.2){if(r(w))return!1;const b=s({x:p[0],y:p[1]}),S=i(g),_=u(k,S);return f(b,w,_)}n(m,"isNodeInViewport");function v(p,w=.2){const k=p.width*w,g=p.height*w,b=a({x:-k,y:-g}),S=a({x:p.width+k,y:p.height+g});return{x:b.x,y:b.y,width:S.x-b.x,height:S.y-b.y}}return n(v,"getViewportBounds"),{camera:Pn(e),transformStyle:o,syncWithCanvas:t,canvasToScreen:s,screenToCanvas:a,getNodeScreenBounds:l,isNodeInViewport:m,getViewportBounds:v}}n(Fw,"useTransformStateIndividual");const Ss=sn(Fw),Uw=q({__name:"TransformPane",props:{canvas:{}},setup(e){const o=e,{transformStyle:t,syncWithCanvas:s}=Ss(),a=h(()=>o.canvas?.canvas),{isTransforming:l}=Bw(a,{settleDelay:16});return no(()=>{o.canvas&&s(o.canvas)},{immediate:!0}),(i,r)=>(d(),T("div",{"data-testid":"transform-pane",class:Q(y(le)("absolute inset-0 w-full h-full pointer-events-none",y(l)?"transform-pane--interacting":"will-change-auto")),style:he(y(t))},[ve(i.$slots,"default",{},void 0,!0)],6))}}),Gw=Ee(Uw,[["__scopeId","data-v-4d46eee6"]]),jw={class:"flex items-center gap-2"},Hw={for:"node-colors"},qw={class:"flex items-center gap-2"},Kw={for:"show-links"},Qw={class:"flex items-center gap-2"},Jw={for:"show-groups"},Yw={class:"flex items-center gap-2"},Xw={for:"render-bypass"},Zw={class:"flex items-center gap-2"},e0={for:"render-error"},t0=q({__name:"MiniMapPanel",props:{panelStyles:{},nodeColors:{type:Boolean},showLinks:{type:Boolean},showGroups:{type:Boolean},renderBypass:{type:Boolean},renderError:{type:Boolean}},emits:["updateOption"],setup(e){return(o,t)=>(d(),T("div",{class:"minimap-panel mr-2 flex flex-col gap-2 bg-comfy-menu-bg p-3 text-sm shadow-interface",style:he(o.panelStyles)},[c("div",jw,[F(y(go),{"input-id":"node-colors",name:"node-colors","model-value":o.nodeColors,binary:"","onUpdate:modelValue":t[0]||(t[0]=s=>o.$emit("updateOption","Comfy.Minimap.NodeColors",s))},null,8,["model-value"]),t[5]||(t[5]=c("i",{class:"icon-[lucide--palette]"},null,-1)),c("label",Hw,R(o.$t("minimap.nodeColors")),1)]),c("div",qw,[F(y(go),{"input-id":"show-links",name:"show-links","model-value":o.showLinks,binary:"","onUpdate:modelValue":t[1]||(t[1]=s=>o.$emit("updateOption","Comfy.Minimap.ShowLinks",s))},null,8,["model-value"]),t[6]||(t[6]=c("i",{class:"icon-[lucide--route]"},null,-1)),c("label",Kw,R(o.$t("minimap.showLinks")),1)]),c("div",Qw,[F(y(go),{"input-id":"show-groups",name:"show-groups","model-value":o.showGroups,binary:"","onUpdate:modelValue":t[2]||(t[2]=s=>o.$emit("updateOption","Comfy.Minimap.ShowGroups",s))},null,8,["model-value"]),t[7]||(t[7]=c("i",{class:"icon-[lucide--frame]"},null,-1)),c("label",Jw,R(o.$t("minimap.showGroups")),1)]),c("div",Yw,[F(y(go),{"input-id":"render-bypass",name:"render-bypass","model-value":o.renderBypass,binary:"","onUpdate:modelValue":t[3]||(t[3]=s=>o.$emit("updateOption","Comfy.Minimap.RenderBypassState",s))},null,8,["model-value"]),t[8]||(t[8]=c("i",{class:"icon-[lucide--circle-slash-2]"},null,-1)),c("label",Xw,R(o.$t("minimap.renderBypassState")),1)]),c("div",Zw,[F(y(go),{"input-id":"render-error",name:"render-error","model-value":o.renderError,binary:"","onUpdate:modelValue":t[4]||(t[4]=s=>o.$emit("updateOption","Comfy.Minimap.RenderErrorState",s))},null,8,["model-value"]),t[9]||(t[9]=c("i",{class:"icon-[lucide--message-circle-warning]"},null,-1)),c("label",e0,R(o.$t("minimap.renderErrorState")),1)])],4))}}),o0=["width","height"],n0=q({__name:"MiniMap",setup(e){const o=_e(),t=L(),s=In("containerRef"),a=In("canvasRef"),{initialized:l,visible:i,containerStyles:r,viewportStyles:u,width:f,height:m,panelStyles:v,nodeColors:p,showLinks:w,showGroups:k,renderBypass:g,renderError:b,updateOption:S,destroy:_,handlePointerDown:C,handlePointerMove:x,handlePointerUp:N,handlePointerCancel:M,handleWheel:$,setMinimapRef:I}=gs({containerRefMaybe:s,canvasRefMaybe:a}),P=L(!1),z=n(()=>{P.value=!P.value},"toggleOptionsPanel");return Ve(()=>{t.value&&I(t.value)}),ut(()=>{_()}),(j,D)=>y(i)&&y(l)?(d(),T("div",{key:0,ref_key:"minimapRef",ref:t,class:"minimap-main-container absolute right-0 bottom-[54px] z-1000 flex"},[P.value?(d(),U(t0,{key:0,"panel-styles":y(v),"node-colors":y(p),"show-links":y(w),"show-groups":y(k),"render-bypass":y(g),"render-error":y(b),onUpdateOption:y(S)},null,8,["panel-styles","node-colors","show-links","show-groups","render-bypass","render-error","onUpdateOption"])):V("",!0),c("div",{ref_key:"containerRef",ref:s,class:"litegraph-minimap relative border border-interface-stroke bg-comfy-menu-bg shadow-interface",style:he(y(r))},[F(X,{class:"absolute top-0 left-0 z-10",size:"icon",variant:"muted-textonly","aria-label":j.$t("g.settings"),onClick:Ce(z,["stop"])},{default:E(()=>D[7]||(D[7]=[c("i",{class:"icon-[lucide--settings-2]"},null,-1)])),_:1},8,["aria-label"]),F(X,{class:"absolute top-0 right-0 z-10",size:"icon",variant:"muted-textonly","aria-label":j.$t("g.close"),"data-testid":"close-minmap-button",onClick:D[0]||(D[0]=Ce(()=>y(o).execute("Comfy.Canvas.ToggleMinimap"),["stop"]))},{default:E(()=>D[8]||(D[8]=[c("i",{class:"icon-[lucide--x]"},null,-1)])),_:1},8,["aria-label"]),c("hr",{class:"absolute top-6 h-px border-0 bg-node-component-border",style:he({width:y(r).width})},null,4),c("canvas",{ref_key:"canvasRef",ref:a,width:y(f),height:y(m),class:"minimap-canvas"},null,8,o0),c("div",{class:"minimap-viewport",style:he(y(u))},null,4),c("div",{class:"absolute inset-0 touch-none",onPointerdown:D[1]||(D[1]=(...A)=>y(C)&&y(C)(...A)),onPointermove:D[2]||(D[2]=(...A)=>y(x)&&y(x)(...A)),onPointerup:D[3]||(D[3]=(...A)=>y(N)&&y(N)(...A)),onPointerleave:D[4]||(D[4]=(...A)=>y(N)&&y(N)(...A)),onPointercancel:D[5]||(D[5]=(...A)=>y(M)&&y(M)(...A)),onWheel:D[6]||(D[6]=(...A)=>y($)&&y($)(...A))},null,32)],4)],512)):V("",!0)}}),s0=Ee(n0,[["__scopeId","data-v-66f11255"]]);function Fn(e){return e.ctrlKey||e.metaKey||e.shiftKey}n(Fn,"isMultiSelectKey");function a0(){const e=me(),{nodeManager:o}=ws(),{bringNodeToFront:t}=ul(),{shouldHandleNodePointerEvents:s}=uo();function a(f,m){if(!s.value||!e.canvas||!o.value)return;const v=o.value.getNode(m);if(!v)return;const p=Fn(f),w=e.selectedItems.length,k=!p&&v.selected&&w>1;p?v.selected||e.canvas.select(v):k||(e.canvas.deselectAll(),e.canvas.select(v)),v.flags?.pinned||t(m),e.updateSelectedItems()}n(a,"handleNodeSelect");function l(f,m){if(!s.value||!o.value)return;const v=o.value.getNode(f);if(!v)return;(v.flags?.collapsed??!1)!==m&&v.collapse()}n(l,"handleNodeCollapse");function i(f,m){if(!s.value||!o.value)return;const v=o.value.getNode(f);v&&(v.title=m)}n(i,"handleNodeTitleUpdate");function r(f,m){if(!s.value||!e.canvas||!o.value)return;const v=o.value.getNode(m);v&&(f.preventDefault(),v.selected||a(f,m))}n(r,"handleNodeRightClick");function u(f,m){if(!s.value||!e.canvas||!o.value)return;const v=o.value.getNode(f);if(v){if(!m){e.canvas.deselectAll(),e.canvas.select(v),e.updateSelectedItems(),v.flags?.pinned||t(f);return}v.selected?e.canvas.deselect(v):(e.canvas.select(v),v.flags?.pinned||t(f)),e.updateSelectedItems()}}return n(u,"toggleNodeSelectionAfterPointerUp"),{handleNodeSelect:a,handleNodeCollapse:l,handleNodeTitleUpdate:i,handleNodeRightClick:r,toggleNodeSelectionAfterPointerUp:u}}n(a0,"useNodeEventHandlersIndividual");const Al=sn(a0);function Ll(){const e=ue(),o=h(()=>e.get("Comfy.SnapToGrid.GridSize")),t=h(()=>e.get("pysssss.SnapToGrid"));function s(i){return i.shiftKey||t.value}n(s,"shouldSnap");function a(i){const r=o.value;if(!r)return{...i};const u=[i.x,i.y];return As(u,r)?{x:u[0],y:u[1]}:{...i}}n(a,"applySnapToPosition");function l(i){const r=o.value;if(!r)return{...i};const u=[i.width,i.height];return As(u,r)?{width:u[0],height:u[1]}:{...i}}return n(l,"applySnapToSize"),{gridSize:o,alwaysSnap:t,shouldSnap:s,applySnapToPosition:a,applySnapToSize:l}}n(Ll,"useNodeSnap");function El(){const e=Je(!1);let o=null;function t(a){a!==e.value&&(!o&&(o=J.canvas?.canvas??null,!o)||(e.value=a,o.dispatchEvent(new KeyboardEvent(a?"keydown":"keyup",{key:"Shift",shiftKey:a,bubbles:!0}))))}n(t,"syncShiftState");function s(a){t(a.shiftKey);const l=n(u=>{u.key==="Shift"&&t(u.shiftKey)},"handleKeyEvent"),i=Ae(window,"keydown",l,{passive:!0}),r=Ae(window,"keyup",l,{passive:!0});return()=>{i(),r()}}return n(s,"trackShiftKey"),Pa(()=>{e.value=!1,o=null}),{trackShiftKey:s}}n(El,"useShiftKeySync");const Ol=sn(l0);function l0(){const e=un(),{selectedNodeIds:o,selectedItems:t}=Fe(me()),s=Ss(),{shouldSnap:a,applySnapToPosition:l}=Ll(),{trackShiftKey:i}=El();let r=null,u=null,f=null,m=null,v=null,p=null,w=null;function k(S,_){const C=Be(De.getNodeLayoutRef(_));if(!C)return;const x=C.position??{x:0,y:0};v=i(S),r={...x},u={x:S.clientX,y:S.clientY};const N=Be(o),M=N?.has(_);if(M&&N.size>1){f=new Map;for(const $ of N){if($===_)continue;const I=De.getNodeLayoutRef($).value;I&&f.set($,{...I.position})}}else f=null;M?(w=Be(t).filter(is),p={x:0,y:0}):(w=null,p=null),e.setSource(Co.Vue)}n(k,"startDrag");function g(S,_){if(!r||!u||m!==null)return;const{target:C,pointerId:x}=S;C instanceof HTMLElement&&!C.hasPointerCapture(x)&&C.setPointerCapture(x),m=requestAnimationFrame(()=>{if(m=null,!r||!u)return;const N={x:S.clientX-u.x,y:S.clientY-u.y},M=s.screenToCanvas({x:0,y:0}),$=s.screenToCanvas(N),I={x:$.x-M.x,y:$.y-M.y},P={x:r.x+I.x,y:r.y+I.y};if(e.moveNode(_,P),f&&f.size>0)for(const[z,j]of f){const D={x:j.x+I.x,y:j.y+I.y};e.moveNode(z,D)}if(w&&w.length>0&&p){const z={x:I.x-p.x,y:I.y-p.y};for(const j of w)j.move(z.x,z.y,!0)}p=I})}n(g,"handleDrag");function b(S,_){if(a(S)&&_){const C=[],x=Be(De.getNodeLayoutRef(_));if(x){const N=x.position,M=l({...N});(M.x!==N.x||M.y!==N.y)&&C.push({nodeId:_,bounds:{x:M.x,y:M.y,width:x.size.width,height:x.size.height}})}if(f&&f.size>0)for(const N of f.keys()){const M=De.getNodeLayoutRef(N).value;if(M){const $={...M.position},I=l($);(I.x!==$.x||I.y!==$.y)&&C.push({nodeId:N,bounds:{x:I.x,y:I.y,width:M.size.width,height:M.size.height}})}}C.length>0&&De.batchUpdateNodeBounds(C)}r=null,u=null,f=null,w=null,p=null,v?.(),v=null,m!==null&&(cancelAnimationFrame(m),m=null)}return n(b,"endDrag"),{startDrag:k,handleDrag:g,endDrag:b}}n(l0,"useNodeDragIndividual");function i0(e){const{startDrag:o,endDrag:t,handleDrag:s}=Ol(),{forwardEventToCanvas:a,shouldHandleNodePointerEvents:l}=uo(),{handleNodeSelect:i,toggleNodeSelectionAfterPointerUp:r}=Al(),{nodeManager:u}=ws(),f=n(M=>jr(M)?(a(M),!0):!1,"forwardMiddlePointerIfNeeded");let m=!1;const v=L({x:0,y:0}),p=3;function w(M){if(f(M)||M.button!==0)return;if(!l.value){a(M);return}const $=Be(e);if(!$){console.warn("LGraphNode: nodeData is null/undefined in handlePointerDown");return}u.value?.getNode($)?.flags?.pinned||(v.value={x:M.clientX,y:M.clientY},b(M,$))}n(w,"onPointerdown");function k(M){if(f(M)||De.isResizingVueNodes.value)return;const $=Be(e);if(u.value?.getNode($)?.flags?.pinned)return;const I=Fn(M),P=M.buttons&1;if(P&&I&&!De.isDraggingVueNodes.value){De.isDraggingVueNodes.value=!0,i(M,$),b(M,$);return}if(P&&!De.isDraggingVueNodes.value){const z=M.clientX-v.value.x,j=M.clientY-v.value.y;Math.sqrt(z*z+j*j)>p&&(De.isDraggingVueNodes.value=!0,i(M,$))}De.isDraggingVueNodes.value&&s(M,$)}n(k,"onPointermove");function g(){De.isDraggingVueNodes.value=!1}n(g,"cleanupDragState");function b(M,$){try{o(M,$)}finally{m=!0}}n(b,"safeDragStart");function S(M){try{const $=Be(e);t(M,$)}catch($){console.error("Error during endDrag:",$)}finally{m=!1,g()}}n(S,"safeDragEnd");function _(M){if(f(M))return;if(!l.value){a(M);return}const I=De.isDraggingVueNodes.value;if((m||I)&&(S(M),I)||M.button===2)return;const P=Fn(M),z=Be(e);z&&r(z,P)}n(_,"onPointerup");function C(M){De.isDraggingVueNodes.value&&S(M)}n(C,"onPointercancel");function x(M){De.isDraggingVueNodes.value&&(M.preventDefault(),g())}return n(x,"onContextmenu"),si(()=>{g()}),{pointerHandlers:{onPointerdown:w,onPointermove:k,onPointerup:_,onPointercancel:C,onContextmenu:x}}}n(i0,"useNodePointerInteractions");const Yo=new Map([["node",{dataAttribute:"nodeId",updateHandler:n(e=>{const o=e.map(({id:t,bounds:s})=>({nodeId:t,bounds:s}));De.batchUpdateNodeBounds(o)},"updateHandler")}]]),da=new ResizeObserver(e=>{if(me().linearMode)return;const o=il(),t=new Map,s=new Set;for(const a of e){if(!(a.target instanceof HTMLElement))continue;const l=a.target;let i,r;for(const[S,_]of Yo){const C=l.dataset[_.dataAttribute];if(C){i=S,r=C;break}}if(!i||!r)continue;const u=Array.isArray(a.borderBoxSize)?a.borderBoxSize[0]:{inlineSize:a.contentRect.width,blockSize:a.contentRect.height},f=u.inlineSize,m=u.blockSize,v=l.getBoundingClientRect(),[p,w]=o.clientPosToCanvasPos([v.left,v.top]),k={x:p,y:w},g={x:k.x,y:k.y+ge.NODE_TITLE_HEIGHT,width:Math.max(0,f),height:Math.max(0,m)};let b=t.get(i);b||(b=[],t.set(i,b)),b.push({id:r,bounds:g}),i==="node"&&r&&s.add(r)}De.setSource(Co.DOM);for(const[a,l]of t){const i=Yo.get(a);i&&l.length&&i.updateHandler(l)}if(s.size>0)for(const a of s)Hr(a)});function r0(e,o){const t=Be(e);Ve(()=>{const s=Ns()?.proxy?.$el;if(!(s instanceof HTMLElement)||!t)return;const a=Yo.get(o);a&&(s.dataset[a.dataAttribute]=t,da.observe(s))}),ut(()=>{const s=Ns()?.proxy?.$el;if(!(s instanceof HTMLElement))return;const a=Yo.get(o);a&&(delete s.dataset[a.dataAttribute],da.unobserve(s))})}n(r0,"useVueElementTracking");const u0=n(e=>{const o=h(()=>Be(e)??""),{nodeLocationProgressStates:t,isIdle:s}=Fe(Ze()),a=h(()=>{const f=o.value;return f?t.value[f]:void 0}),l=h(()=>!s.value&&a.value?.state==="running"),i=h(()=>{const f=a.value;return f&&f.max>0?f.value/f.max:void 0}),r=h(()=>{const f=i.value;return f!==void 0?Math.round(f*100):void 0}),u=h(()=>{const f=a.value;return f?f.state:"idle"});return{executing:l,progress:i,progressPercentage:r,progressState:a,executionState:u}},"useNodeExecutionState");function c0(e){const o=Be(e),t=un(),s=De.getNodeLayoutRef(o);ut(()=>{De.cleanupNodeRef(o)});const a=h(()=>s.value?.position??{x:0,y:0}),l=h(()=>s.value?.size??{width:200,height:100}),i=h(()=>s.value?.zIndex??0);function r(u){t.setSource(Co.Vue),t.moveNode(o,u)}return n(r,"moveNodeTo"),{position:a,size:l,zIndex:i,moveNodeTo:r}}n(c0,"useNodeLayout");const d0=n((e,o)=>{const t=Be(e),s=Le(),{nodePreviewImages:a}=Fe($o()),l=h(()=>s.nodeIdToNodeLocatorId(t)),i=h(()=>{const m=l.value;if(!m)return;const v=a.value[m];return v?.length?v:void 0}),r=h(()=>!!i.value?.length),u=h(()=>{const m=i.value;return m?.length?m.at(-1):""}),f=h(()=>o?.isCollapsed?!o.isCollapsed.value&&r.value:r.value);return{locatorId:l,previewUrls:i,hasPreview:r,latestPreviewUrl:u,shouldShowPreviewImg:f}},"useNodePreviewState");function p0(e){const o=Ss(),t=L(!1),s=L(null),a=L(null),{shouldSnap:l,applySnapToSize:i}=Ll(),{trackShiftKey:r}=El();return{startResize:n(f=>{f.preventDefault(),f.stopPropagation();const m=f.currentTarget;if(!(m instanceof HTMLElement))return;const v=m.closest("[data-node-id]");if(!(v instanceof HTMLElement))return;const p=v.getBoundingClientRect(),w=o.camera.z,k={width:p.width/w,height:p.height/w},g=r(f);m.setPointerCapture(f.pointerId),De.isResizingVueNodes.value=!0,t.value=!0,s.value={x:f.clientX,y:f.clientY},a.value=k;const b=n(x=>{if(!t.value||!s.value||!a.value)return;const N=o.camera.z,M=(x.clientX-s.value.x)/(N||1),$=(x.clientY-s.value.y)/(N||1);let I={width:a.value.width+M,height:a.value.height+$};l(x)&&(I=i(I));const P=m.closest("[data-node-id]");P instanceof HTMLElement&&e({size:I},P)},"handlePointerMove"),S=n(x=>{t.value&&(t.value=!1,De.isResizingVueNodes.value=!1,s.value=null,a.value=null,g(),m.releasePointerCapture(x.pointerId),_(),C())},"handlePointerUp"),_=Ae("pointermove",b),C=Ae("pointerup",S)},"startResize"),isResizing:t}}n(p0,"useNodeResize");const f0={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function m0(e,o){return d(),T("svg",f0,[...o[0]||(o[0]=[c("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[c("path",{d:"m2 2l20 20M10.41 10.41a2 2 0 1 1-2.83-2.83m5.92 5.92L6 21m12-9l3 3"}),c("path",{d:"M3.59 3.59A2 2 0 0 0 3 5v14a2 2 0 0 0 2 2h14c.55 0 1.052-.22 1.41-.59M21 15V5a2 2 0 0 0-2-2H9"})],-1)])])}n(m0,"render$1");const g0=Da({name:"lucide-image-off",render:m0}),v0={key:0,class:"flex h-full min-h-16 w-full min-w-16 flex-col"},h0={class:"relative h-88 w-full grow overflow-hidden rounded-[5px] bg-node-component-surface"},y0={key:0,class:"text-pure-white flex h-full w-full flex-col items-center justify-center text-center"},b0={class:"text-xs text-smoke-400"},w0=["src","alt"],k0={class:"text-node-component-header-text mt-1 text-center text-xs"},C0=q({__name:"LivePreview",props:{imageUrl:{}},setup(e){const o=e,t=L(null),s=L(!1);ae(()=>o.imageUrl,()=>{t.value=null,s.value=!1});const a=n(i=>{if(!i.target||!(i.target instanceof HTMLImageElement))return;const r=i.target;s.value=!1,r.naturalWidth&&r.naturalHeight&&(t.value=`${r.naturalWidth} x ${r.naturalHeight}`)},"handleImageLoad"),l=n(()=>{s.value=!0,t.value=null},"handleImageError");return(i,r)=>{const u=g0;return i.imageUrl?(d(),T("div",v0,[c("div",h0,[s.value?(d(),T("div",y0,[F(u,{class:"mb-1 size-8 text-smoke-500"}),c("p",b0,R(i.$t("g.imageFailedToLoad")),1)])):(d(),T("img",{key:1,src:i.imageUrl,alt:i.$t("g.liveSamplingPreview"),class:"pointer-events-none h-full w-full object-contain object-center",onLoad:a,onError:l},null,40,w0))]),c("div",k0,R(s.value?i.$t("g.errorLoadingImage"):t.value||i.$t("g.calculatingDimensions")),1)])):V("",!0)}}}),x0=["aria-label","aria-busy"],S0={key:0,role:"alert",class:"flex size-full flex-col items-center justify-center bg-muted-background text-center text-base-foreground py-8"},_0={class:"text-sm text-base-foreground"},T0={class:"mt-1 text-xs text-base-foreground"},$0=["src"],N0={key:3,class:"actions absolute top-2 right-2 flex gap-2.5"},I0=["title","aria-label"],M0=["title","aria-label"],P0={key:4,class:"absolute right-2 bottom-2 left-2 flex justify-center gap-1"},D0=["aria-label","onClick"],A0={class:"mt-2 text-center text-xs text-muted-foreground"},L0={key:0,class:"text-red-400"},E0={key:1,class:"text-smoke-400"},O0={key:2},pa="flex h-8 min-h-8 items-center justify-center gap-2.5 rounded-lg border-0 bg-button-surface px-2 py-2 text-button-surface-contrast shadow-sm transition-colors duration-200 hover:bg-button-hover-surface focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-button-surface-contrast focus-visible:ring-offset-2 focus-visible:ring-offset-transparent cursor-pointer",V0=q({__name:"VideoPreview",props:{imageUrls:{},nodeId:{}},setup(e){const o=e,{t}=pe(),s=$o(),a=L(0),l=L(!1),i=L(!1),r=L(null),u=L(!1),f=L(!1),m=L(),v=h(()=>o.imageUrls[a.value]),p=h(()=>o.imageUrls.length>1);ae(()=>o.imageUrls,P=>{a.value>=P.length&&(a.value=0),r.value=null,u.value=!1,f.value=P.length>0},{deep:!0,immediate:!0});const w=n(P=>{if(!P.target||!(P.target instanceof HTMLVideoElement))return;const z=P.target;f.value=!1,u.value=!1,z.videoWidth&&z.videoHeight&&(r.value=`${z.videoWidth} x ${z.videoHeight}`)},"handleVideoLoad"),k=n(()=>{f.value=!1,u.value=!0,r.value=null},"handleVideoError"),g=n(()=>{try{ln(v.value)}catch{Bt().add({severity:"error",summary:"Error",detail:t("g.failedToDownloadVideo"),life:3e3,group:"video-preview"})}},"handleDownload"),b=n(()=>{o.nodeId&&s.removeNodeOutputs(o.nodeId)},"handleRemove"),S=n(P=>{P>=0&&P<o.imageUrls.length&&(a.value=P,r.value=null,f.value=!0,u.value=!1)},"setCurrentIndex"),_=n(()=>{l.value=!0},"handleMouseEnter"),C=n(()=>{l.value=!1},"handleMouseLeave"),x=n(()=>{i.value=!0},"handleFocusIn"),N=n(P=>{m.value?.contains(P.relatedTarget)||(i.value=!1)},"handleFocusOut"),M=n(P=>["w-2 h-2 rounded-full transition-all duration-200 border-0 cursor-pointer",P===a.value?"bg-white":"bg-white/50 hover:bg-white/80"],"getNavigationDotClass"),$=n(P=>{if(!(o.imageUrls.length<=1))switch(P.key){case"ArrowLeft":P.preventDefault(),S(a.value>0?a.value-1:o.imageUrls.length-1);break;case"ArrowRight":P.preventDefault(),S(a.value<o.imageUrls.length-1?a.value+1:0);break;case"Home":P.preventDefault(),S(0);break;case"End":P.preventDefault(),S(o.imageUrls.length-1);break}},"handleKeyDown"),I=n(P=>{try{return new URL(P).searchParams.get("filename")||"Unknown file"}catch{return"Invalid URL"}},"getVideoFilename");return(P,z)=>P.imageUrls.length>0?(d(),T("div",{key:0,class:"video-preview group relative flex size-full min-h-16 min-w-16 flex-col px-2",onKeydown:$},[c("div",{ref_key:"videoWrapperEl",ref:m,class:"relative h-full w-full grow overflow-hidden rounded-[5px] bg-node-component-surface",tabindex:"0",role:"region","aria-label":P.$t("g.videoPreview"),"aria-busy":f.value,onMouseenter:_,onMouseleave:C,onFocusin:x,onFocusout:N},[u.value?(d(),T("div",S0,[z[0]||(z[0]=c("i",{class:"mb-2 icon-[lucide--video-off] h-12 w-12 text-base-foreground"},null,-1)),c("p",_0,R(P.$t("g.videoFailedToLoad")),1),c("p",T0,R(I(v.value)),1)])):V("",!0),f.value&&!u.value?(d(),U(y(Jn),{key:1,class:"absolute inset-0 size-full","border-radius":"5px",width:"100%",height:"100%"})):V("",!0),u.value?V("",!0):(d(),T("video",{key:2,src:v.value,class:Q(y(le)("block size-full object-contain",f.value&&"invisible")),controls:"",loop:"",playsinline:"",onLoadeddata:w,onError:k},null,42,$0)),l.value||i.value?(d(),T("div",N0,[c("button",{class:Q(pa),title:P.$t("g.downloadVideo"),"aria-label":P.$t("g.downloadVideo"),onClick:g},z[1]||(z[1]=[c("i",{class:"icon-[lucide--download] h-4 w-4"},null,-1)]),8,I0),c("button",{class:Q(pa),title:P.$t("g.removeVideo"),"aria-label":P.$t("g.removeVideo"),onClick:b},z[2]||(z[2]=[c("i",{class:"icon-[lucide--x] h-4 w-4"},null,-1)]),8,M0)])):V("",!0),p.value?(d(),T("div",P0,[(d(!0),T(ne,null,be(P.imageUrls,(j,D)=>(d(),T("button",{key:D,class:Q(M(D)),"aria-label":P.$t("g.viewVideoOfTotal",{index:D+1,total:P.imageUrls.length}),onClick:n(A=>S(D),"onClick")},null,10,D0))),128))])):V("",!0)],40,x0),c("div",A0,[u.value?(d(),T("span",L0,R(P.$t("g.errorLoadingVideo")),1)):f.value?(d(),T("span",E0,R(P.$t("g.loading"))+"... ",1)):(d(),T("span",O0,R(r.value||P.$t("g.calculatingDimensions")),1))])],32)):V("",!0)}}),R0={width:"1.2em",height:"1.2em",xmlns:"http://www.w3.org/2000/svg",class:"",viewBox:"0 0 16 16",fill:"none"},W0=["clip-path"],z0=["id"];function B0(e,o){return d(),T("svg",R0,[c("g",{"clip-path":"url(#"+e.idMap.clip0_704_2695+")"},[...o[0]||(o[0]=[ai('<path d="M6.05048 2C5.52055 7.29512 9.23033 10.4722 14 9.94267" stroke="currentColor" stroke-width="1.3"></path><path d="M6.5 5.5L10 2" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"></path><path d="M8 8L12.5 3.5" stroke="currentColor" stroke-width="1.3" stroke-linecap="square"></path><path d="M10.5 9.5L14 6" stroke="currentColor" stroke-width="1.3" stroke-linecap="round"></path><path d="M7.99992 14.6667C11.6818 14.6667 14.6666 11.6819 14.6666 8.00004C14.6666 4.31814 11.6818 1.33337 7.99992 1.33337C4.31802 1.33337 1.33325 4.31814 1.33325 8.00004C1.33325 11.6819 4.31802 14.6667 7.99992 14.6667Z" stroke="currentColor" stroke-width="1.3" stroke-linecap="round" stroke-linejoin="round"></path>',5)])],8,W0),c("defs",null,[c("clipPath",{id:e.idMap.clip0_704_2695},[...o[1]||(o[1]=[c("rect",{width:"16",height:"16",fill:"white"},null,-1)])],8,z0)])])}n(B0,"render");const F0=Da({name:"comfy-mask",render:B0,setup(){return{idMap:{clip0_704_2695:"uicons-"+n(()=>Math.random().toString(36).substr(2,10),"__randId")()}}}}),U0=["aria-label","aria-busy"],G0={key:0,role:"alert",class:"flex size-full flex-col items-center justify-center bg-muted-background text-center text-base-foreground py-8"},j0={class:"text-sm text-base-foreground"},H0={class:"mt-1 text-xs text-base-foreground"},q0={key:1,class:"size-full"},K0=["src","alt"],Q0={key:3,class:"actions absolute top-2 right-2 flex gap-2.5"},J0=["title","aria-label"],Y0=["title","aria-label"],X0=["title","aria-label"],Z0={class:"pt-2 text-center text-xs text-base-foreground"},e1={key:0,class:"text-red-400"},t1={key:1,class:"text-base-foreground"},o1={key:2},n1={key:0,class:"flex flex-wrap justify-center gap-1 pt-4"},s1=["aria-current","aria-label","onClick"],Tn="flex h-8 min-h-8 items-center justify-center gap-2.5 rounded-lg border-0 bg-button-surface px-2 py-2 text-button-surface-contrast shadow-sm transition-colors duration-200 hover:bg-button-hover-surface focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-button-surface-contrast focus-visible:ring-offset-2 focus-visible:ring-offset-transparent cursor-pointer",a1=q({__name:"ImagePreview",props:{imageUrls:{},nodeId:{}},setup(e){const o=e,{t}=pe(),s=_e(),a=$o(),l=L(0),i=L(!1),r=L(!1),u=L(null),f=L(!1),m=L(!1),v=L(),p=L(),{start:w,stop:k}=li(()=>{m.value=!0},250,{immediate:!1}),g=h(()=>o.imageUrls[l.value]),b=h(()=>o.imageUrls.length>1),S=h(()=>`Node output ${l.value+1}`);ae(()=>o.imageUrls,G=>{l.value>=G.length&&(l.value=0),u.value=null,f.value=!1,G.length>0&&w()},{deep:!0,immediate:!0});const _=n(G=>{if(!G.target||!(G.target instanceof HTMLImageElement))return;const H=G.target;k(),m.value=!1,f.value=!1,H.naturalWidth&&H.naturalHeight&&(u.value=`${H.naturalWidth} x ${H.naturalHeight}`)},"handleImageLoad"),C=n(()=>{k(),m.value=!1,f.value=!0,u.value=null},"handleImageError"),x=n(()=>{if(!o.nodeId||!v.value)return;const G=J.rootGraph?.getNodeById(o.nodeId);G&&(G.imageIndex=l.value,G.imgs=[v.value],J.canvas?.select(G))},"setupNodeForMaskEditor"),N=n(()=>{x(),s.execute("Comfy.MaskEditor.OpenMaskEditor")},"handleEditMask"),M=n(()=>{try{ln(g.value)}catch{Bt().add({severity:"error",summary:"Error",detail:t("g.failedToDownloadImage"),life:3e3,group:"image-preview"})}},"handleDownload"),$=n(()=>{o.nodeId&&a.removeNodeOutputs(o.nodeId)},"handleRemove"),I=n(G=>{l.value!==G&&G>=0&&G<o.imageUrls.length&&(l.value=G,w(),f.value=!1)},"setCurrentIndex"),P=n(()=>{i.value=!0},"handleMouseEnter"),z=n(()=>{i.value=!1},"handleMouseLeave"),j=n(()=>{r.value=!0},"handleFocusIn"),D=n(G=>{p.value?.contains(G.relatedTarget)||(r.value=!1)},"handleFocusOut"),A=n(G=>["w-2 h-2 rounded-full transition-all duration-200 border-0 cursor-pointer p-0",G===l.value?"bg-base-foreground":"bg-base-foreground/50 hover:bg-base-foreground/80"],"getNavigationDotClass"),B=n(G=>{if(!(o.imageUrls.length<=1))switch(G.key){case"ArrowLeft":G.preventDefault(),I(l.value>0?l.value-1:o.imageUrls.length-1);break;case"ArrowRight":G.preventDefault(),I(l.value<o.imageUrls.length-1?l.value+1:0);break;case"Home":G.preventDefault(),I(0);break;case"End":G.preventDefault(),I(o.imageUrls.length-1);break}},"handleKeyDown"),W=n(G=>{try{return new URL(G).searchParams.get("filename")||"Unknown file"}catch{return"Invalid URL"}},"getImageFilename");return(G,H)=>{const K=F0;return G.imageUrls.length>0?(d(),T("div",{key:0,class:"image-preview group relative flex size-full min-h-16 min-w-16 flex-col px-2 justify-center",onKeydown:B},[c("div",{ref_key:"imageWrapperEl",ref:p,class:"h-full w-full overflow-hidden rounded-[5px] bg-muted-background relative",tabindex:"0",role:"img","aria-label":G.$t("g.imagePreview"),"aria-busy":m.value,onMouseenter:P,onMouseleave:z,onFocusin:j,onFocusout:D},[f.value?(d(),T("div",G0,[H[0]||(H[0]=c("i",{class:"mb-2 icon-[lucide--image-off] h-12 w-12 text-base-foreground"},null,-1)),c("p",j0,R(G.$t("g.imageFailedToLoad")),1),c("p",H0,R(W(g.value)),1)])):V("",!0),m.value&&!f.value?(d(),T("div",q0,[F(y(Jn),{"border-radius":"5px",width:"100%",height:"100%"})])):V("",!0),f.value?V("",!0):(d(),T("img",{key:2,ref_key:"currentImageEl",ref:v,src:g.value,alt:S.value,class:"block size-full object-contain pointer-events-none",onLoad:_,onError:C},null,40,K0)),i.value||r.value?(d(),T("div",Q0,[b.value?V("",!0):(d(),T("button",{key:0,class:Q(Tn),title:G.$t("g.editOrMaskImage"),"aria-label":G.$t("g.editOrMaskImage"),onClick:N},[F(K,{class:"h-4 w-4"})],8,J0)),c("button",{class:Q(Tn),title:G.$t("g.downloadImage"),"aria-label":G.$t("g.downloadImage"),onClick:M},H[1]||(H[1]=[c("i",{class:"icon-[lucide--download] h-4 w-4"},null,-1)]),8,Y0),c("button",{class:Q(Tn),title:G.$t("g.removeImage"),"aria-label":G.$t("g.removeImage"),onClick:$},H[2]||(H[2]=[c("i",{class:"icon-[lucide--x] h-4 w-4"},null,-1)]),8,X0)])):V("",!0)],40,U0),c("div",Z0,[f.value?(d(),T("span",e1,R(G.$t("g.errorLoadingImage")),1)):m.value?(d(),T("span",t1,R(G.$t("g.loading"))+"... ",1)):(d(),T("span",o1,R(u.value||G.$t("g.calculatingDimensions")),1))]),b.value?(d(),T("div",n1,[(d(!0),T(ne,null,be(G.imageUrls,(ee,ie)=>(d(),T("button",{key:ie,class:Q(A(ie)),"aria-current":ie===l.value?"true":void 0,"aria-label":G.$t("g.viewImageOfTotal",{index:ie+1,total:G.imageUrls.length}),onClick:n(Y=>I(ie),"onClick")},null,10,s1))),128))])):V("",!0)],32)):V("",!0)}}}),l1={key:0,class:"node-error p-2 text-sm text-red-500"},i1={key:1,class:"lg-node-content flex grow flex-col"},r1=q({__name:"NodeContent",props:{nodeData:{},media:{}},setup(e){const o=e,t=h(()=>o.media&&o.media.urls.length>0),s=h(()=>o.nodeData?.id?.toString()),a=L(null),{toastErrorHandler:l}=Ft();return Aa(i=>(a.value=i.message,l(i),!1)),(i,r)=>a.value?(d(),T("div",l1,R(y(we)("nodeErrors.content","Node Content Error")),1)):(d(),T("div",i1,[ve(i.$slots,"default",{},()=>[t.value&&i.media?.type==="video"?(d(),U(V0,{key:0,"image-urls":i.media.urls,"node-id":s.value,class:"mt-2"},null,8,["image-urls","node-id"])):t.value&&i.media?.type==="image"?(d(),U(a1,{key:1,"image-urls":i.media.urls,"node-id":s.value,class:"mt-2"},null,8,["image-urls","node-id"])):V("",!0)])]))}}),u1={key:0,class:"node-error p-2 text-sm text-red-500"},c1=["data-node-id"],d1={key:0,class:"flex flex-col justify-center items-center relative"},p1={class:"relative mb-1"},f1=["data-testid"],m1={key:1,class:"min-h-0 flex-1 flex"},g1={key:2,class:"min-h-0 flex-1 px-4"},v1=["aria-label"],h1="absolute h-3 w-3 opacity-0 pointer-events-auto focus-visible:outline focus-visible:outline-2 focus-visible:outline-white/40",y1=225,fa="h-2 bg-primary-500 transition-all duration-300",b1=q({__name:"LGraphNode",props:{nodeData:{},error:{default:null}},setup(e){const{t:o}=pe(),{handleNodeCollapse:t,handleNodeTitleUpdate:s,handleNodeRightClick:a}=Al(),{bringNodeToFront:l}=ul();r0(()=>e.nodeData.id,"node");const{selectedNodeIds:i}=Fe(me()),r=h(()=>i.value.has(e.nodeData.id)),u=h(()=>hn(e.nodeData)),{executing:f,progress:m}=u0(u),v=Ze(),p=h(()=>v.lastExecutionErrorNodeId===e.nodeData.id),w=h(()=>!!(p.value||e.nodeData.hasErrors||e.error||(v.lastNodeErrors?.[e.nodeData.id]?.errors.length??0)>0)),k=h(()=>e.nodeData.titleMode!==qr.NO_TITLE),g=h(()=>e.nodeData.flags?.collapsed??!1),b=h(()=>e.nodeData.mode===Oe.BYPASS),S=h(()=>e.nodeData.mode===Oe.NEVER),_=h(()=>{const fe=ct();return e.nodeData.bgcolor?Kr(e.nodeData.bgcolor,!!fe.completedActivePalette.light_theme):""}),C=h(()=>{const fe=ue().get("Comfy.Node.Opacity")??1;return b.value||S.value?fe*.5:fe}),x=h(()=>Qr(e.nodeData).length>0),N=h(()=>!!e.nodeData.outputs?.length),{handleWheel:M,shouldHandleNodePointerEvents:$}=uo(),I=L(null),{toastErrorHandler:P}=Ft();Aa(fe=>(I.value=fe.message,P(fe),!1));const{position:z,size:j,zIndex:D}=c0(()=>e.nodeData.id),{pointerHandlers:A}=i0(()=>e.nodeData.id),{onPointerdown:B,...W}=A,{startDrag:G}=Ol();async function H(fe){if(fe.altKey&&dt.value){const xe=He.cloneNodes([dt.value]);if(xe?.created?.length){const[Te]=xe.created;G(fe,`${Te.id}`),De.isDraggingVueNodes.value=!0,await Re(),l(`${Te.id}`);return}}B(fe)}n(H,"nodeOnPointerdown");const K=n(fe=>{fe.preventDefault(),fe.stopPropagation(),a(fe,e.nodeData.id),iv(fe)},"handleContextMenu");Ve(()=>{ee()});function ee(){const fe=wt.value,{width:xe,height:Te}=j.value;if(!fe)return;const Me=g.value?"-x":"";fe.style.setProperty(`--node-width${Me}`,`${xe}px`),fe.style.setProperty(`--node-height${Me}`,`${Te}px`)}n(ee,"initSizeStyles");const{startResize:ie}=p0((fe,xe)=>{if(g.value)return;const Te=Math.max(fe.size.width,y1);xe.style.setProperty("--node-width",`${Te}px`),xe.style.setProperty("--node-height",`${fe.size.height}px`)}),Y=n(fe=>{fe.button===0&&$.value&&(e.nodeData.flags?.pinned||ie(fe))},"handleResizePointerDown");ae(g,fe=>{const xe=wt.value;if(!xe)return;const[Te,Me]=fe?["","-x"]:["-x",""],te=xe.style.getPropertyValue(`--node-width${Te}`);xe.style.setProperty(`--node-width${Me}`,te),xe.style.setProperty(`--node-width${Te}`,"");const Z=xe.style.getPropertyValue(`--node-height${Te}`);xe.style.setProperty(`--node-height${Me}`,Z),xe.style.setProperty(`--node-height${Te}`,"")});const oe=h(()=>!!Lt.value&&Lt.value.urls.length>0),{latestPreviewUrl:se,shouldShowPreviewImg:Ne}=d0(()=>e.nodeData.id,{isCollapsed:g}),Ue=h(()=>w.value?"border-node-stroke-error":!k.value&&e.nodeData.bgcolor&&Jr(e.nodeData.bgcolor)?"border-0":""),qe=h(()=>le(r.value&&"outline-node-component-outline",w.value&&"outline-node-stroke-error",f.value&&"outline-node-stroke-executing")),nt=h(()=>le(e.nodeData.flags?.pinned?"cursor-default":De.isDraggingVueNodes.value?"cursor-grabbing":"cursor-grab")),Ke=h(()=>{switch(e.nodeData.shape){case It.BOX:return"rounded-none";case It.CARD:return"rounded-tl-2xl rounded-br-2xl rounded-tr-none rounded-bl-none";default:return"rounded-2xl"}}),je=h(()=>{switch(e.nodeData.shape){case It.BOX:return"before:rounded-none";case It.CARD:return"before:rounded-tl-2xl before:rounded-br-2xl before:rounded-tr-none before:rounded-bl-none";default:return"before:rounded-2xl"}}),yt=n(()=>{t(e.nodeData.id,!g.value)},"handleCollapse"),bt=n(fe=>{s(e.nodeData.id,fe)},"handleHeaderTitleUpdate"),po=n(()=>{const fe=J.rootGraph;if(!fe){console.warn("LGraphNode: No graph available for subgraph navigation");return}const xe=hn(e.nodeData),Te=Ls(fe,xe);if(!Te?.isSubgraphNode()||!("subgraph"in Te)){console.warn("LGraphNode: Node is not a valid subgraph node",Te);return}const Me=J.canvas;if(!Me||typeof Me.openSubgraph!="function"){console.warn("LGraphNode: Canvas or openSubgraph method not available");return}Me.openSubgraph(Te.subgraph,Te)},"handleEnterSubgraph"),jt=$o(),At=h(()=>e.nodeData.subgraphId?`${e.nodeData.subgraphId}:${e.nodeData.id}`:e.nodeData.id),dt=h(()=>{const fe=hn(e.nodeData);return Ls(J.rootGraph,fe)}),Lt=h(()=>{const fe=jt.nodeOutputs[At.value],xe=dt.value;if(!xe||!fe?.images?.length)return;const Te=jt.getNodeImageUrls(xe);if(!Te?.length)return;const Me=xe.inputs?.some(Z=>Z.type==="VIDEO");return{type:xe.previewMediaType==="video"||!xe.previewMediaType&&Me?"video":"image",urls:Te}}),wt=L(),st=L(!1);function fo(fe){const xe=dt.value;if(!xe||!xe.onDragOver){st.value=!1;return}const Te=xe.onDragOver(fe);st.value=Te}n(fo,"handleDragOver");function mo(){st.value=!1}n(mo,"handleDragLeave");async function Ht(fe){st.value=!1;const xe=dt.value;!xe||!xe.onDragDrop||await xe.onDragDrop(fe)}return n(Ht,"handleDrop"),(fe,xe)=>I.value?(d(),T("div",u1,R(y(we)("nodeErrors.render","Node Render Error")),1)):(d(),T("div",Pt({key:1,ref_key:"nodeContainerRef",ref:wt,tabindex:"0","data-node-id":fe.nodeData.id,class:y(le)("bg-component-node-background lg-node absolute text-sm","contain-style contain-layout min-w-[225px] min-h-(--node-height) w-(--node-width)",Ke.value,"touch-none flex flex-col","border-1 border-solid border-component-node-border",y($)&&"hover:ring-7 ring-node-component-ring","outline-transparent outline-2 focus-visible:outline-node-component-outline",Ue.value,qe.value,nt.value,{[`${je.value} before:pointer-events-none before:absolute before:bg-bypass/60 before:inset-0`]:b.value,[`${je.value} before:pointer-events-none before:absolute before:inset-0`]:S.value,"ring-4 ring-primary-500 bg-primary-500/10":st.value},y($)?"pointer-events-auto":"pointer-events-none",!g.value&&" pb-1"),style:[{transform:`translate(${y(z).x??0}px, ${(y(z).y??0)-y(ge).NODE_TITLE_HEIGHT}px)`,zIndex:y(D),opacity:C.value,"--component-node-background":_.value}]},W,{onPointerdown:H,onWheel:xe[0]||(xe[0]=(...Te)=>y(M)&&y(M)(...Te)),onContextmenu:K,onDragover:Ce(fo,["prevent"]),onDragleave:mo,onDrop:Ce(Ht,["stop","prevent"])}),[k.value?(d(),T("div",d1,[g.value?(d(),T(ne,{key:0},[x.value?(d(),U(Es,{key:0,multi:"",class:"absolute left-0 -translate-x-1/2"})):V("",!0),N.value?(d(),U(Es,{key:1,multi:"",class:"absolute right-0 translate-x-1/2"})):V("",!0),F(Os,{"node-data":fe.nodeData,unified:""},null,8,["node-data"])],64)):V("",!0),F(Yr,{"node-data":fe.nodeData,collapsed:g.value,onCollapse:yt,"onUpdate:title":bt,onEnterSubgraph:po},null,8,["node-data","collapsed"])])):V("",!0),g.value&&y(f)&&y(m)!==void 0?(d(),T("div",{key:1,class:Q(y(le)("absolute inset-x-4 -bottom-[1px] translate-y-1/2 rounded-full",fa)),style:he({width:`${Math.min(y(m)*100,100)}%`})},null,6)):V("",!0),g.value?V("",!0):(d(),T(ne,{key:2},[c("div",p1,[y(f)&&y(m)!==void 0?(d(),T("div",{key:0,class:Q(y(le)("absolute inset-x-0 top-1/2 -translate-y-1/2",y(m)<1&&"rounded-r-full",fa)),style:he({width:`${Math.min(y(m)*100,100)}%`})},null,6)):V("",!0)]),c("div",{class:"flex flex-1 flex-col gap-1 pb-2","data-testid":`node-body-${fe.nodeData.id}`},[F(Os,{"node-data":fe.nodeData},null,8,["node-data"]),fe.nodeData.widgets?.length?(d(),U(cl,{key:0,"node-data":fe.nodeData},null,8,["node-data"])):V("",!0),oe.value?(d(),T("div",m1,[F(r1,{"node-data":fe.nodeData,media:Lt.value},null,8,["node-data","media"])])):V("",!0),y(Ne)?(d(),T("div",g1,[F(C0,{"image-url":y(se)||null},null,8,["image-url"])])):V("",!0)],8,f1)],64)),g.value?V("",!0):(d(),T("div",{key:3,role:"button","aria-label":y(o)("g.resizeFromBottomRight"),class:Q(y(le)(h1,"right-0 bottom-0 cursor-se-resize")),onPointerdown:Ce(Y,["stop"])},null,42,v1))],16,c1))}});let Ao=[],Lo=!1,Eo=null;const w1=n(()=>{function e(a){const l=Object.keys(a.settingValues).length===0||!a.get("Comfy.TutorialCompleted"),i=!localStorage.getItem("workflow"),r=!localStorage.getItem("Comfy.PreviousWorkflow");return l&&i&&r}n(e,"checkIsNewUser");async function o(a){if(Lo){if(Eo)try{await a()}catch(l){console.error("New user initialization callback failed:",l)}}else Ao.push(a)}n(o,"registerInitCallback");async function t(a){if(!Lo){if(Eo=e(a),Lo=!0,!Eo){Ao=[];return}await a.set("Comfy.InstalledVersion","1.37.6");for(const l of Ao)try{await l()}catch(i){console.error("New user initialization callback failed:",i)}Ao=[]}}n(t,"initializeIfNewUser");function s(){return Lo?Eo:null}return n(s,"isNewUser"),{registerInitCallback:o,initializeIfNewUser:t,isNewUser:s}},"newUserService"),k1=q({__name:"SelectionRectangle",setup(e){const o=me(),t=L(null);no(()=>{const l=o.canvas;if(!l){t.value=null;return}const{pointer:i,dragging_rectangle:r}=l;if(r&&i.eDown&&i.eMove){const u=i.eDown.safeOffsetX,f=i.eDown.safeOffsetY,m=i.eMove.safeOffsetX-u,v=i.eMove.safeOffsetY-f;t.value={x:u,y:f,w:m,h:v}}else t.value=null});const s=h(()=>t.value!==null),a=h(()=>{const l=t.value;if(!l)return{};const i=l.w>=0?l.x:l.x+l.w,r=l.h>=0?l.y:l.y+l.h,u=Math.abs(l.w),f=Math.abs(l.h);return{left:`${i}px`,top:`${r}px`,width:`${u}px`,height:`${f}px`}});return(l,i)=>s.value?(d(),T("div",{key:0,class:"pointer-events-none absolute z-9999 border border-blue-400 bg-blue-500/20",style:he(a.value)},null,4)):V("",!0)}}),C1={key:0,class:"workflow-tabs-container pointer-events-auto relative h-9.5 w-full"},x1={key:0,class:"app-drag fixed top-0 left-0 z-10 h-[var(--comfy-topbar-height)] w-full"},S1={class:"flex h-full items-center border-b border-interface-stroke bg-comfy-menu-bg shadow-interface"},_1={class:"sidebar-content-container h-full w-full overflow-x-hidden overflow-y-auto"},T1=q({__name:"GraphCanvas",emits:["ready"],setup(e,{emit:o}){const t=o,s=L(null),a=Je(null),l=ue(),i=ht(),r=ot(),u=me(),f=Ze(),m=Mt(),v=ct(),p=tl(),w=uo(),k=h(()=>l.get("Comfy.UseNewMenu")!=="Disabled"),g=h(()=>l.get("Comfy.Workflow.WorkflowTabsPosition")),b=h(()=>l.get("Comfy.Graph.CanvasMenu")),S=h(()=>l.get("Comfy.EnableTooltips")),_=h(()=>l.get("Comfy.Canvas.SelectionToolbox")),C=h(()=>r.sidebarTab.activeSidebarTab),x=h(()=>!r.focusMode&&k.value),N=h(()=>l.get("Comfy.Minimap.Visible")),{shouldRenderVueNodes:M}=qo(),$=ws(),I=n(async()=>{M.value&&($.disposeNodeManagerAndSyncs(),await Re(),$.initializeNodeManager())},"handleVueNodeLifecycleReset");ae(()=>u.currentGraph,I),ae(()=>u.isInSubgraph,async(A,B)=>{B&&!A&&Le().updateActiveGraph(),await I()});const P=h(()=>Array.from($.nodeManager.value?.vueNodeData?.values()??[]));ke(()=>{ge.nodeOpacity=l.get("Comfy.Node.Opacity")}),ke(()=>{ge.nodeLightness=v.completedActivePalette.light_theme?.5:void 0}),ke(()=>{i.showDeprecated=l.get("Comfy.Node.ShowDeprecated")}),ke(()=>{i.showExperimental=l.get("Comfy.Node.ShowExperimental")}),ke(()=>{const A=l.get("Comfy.TextareaWidget.Spellcheck");document.querySelectorAll("textarea.comfy-multiline-input").forEach(W=>{W.spellcheck=A,W.focus(),W.blur()})}),ae(()=>l.get("Comfy.WidgetControlMode"),()=>{u.canvas&&(Vs(J.rootGraph,A=>{if(A.widgets){for(const B of A.widgets)if(B[ou]&&(Rs(B),!!B.linkedWidgets))for(const W of B.linkedWidgets)Rs(W)}}),u.canvas.setDirty(!0))}),ae([()=>u.canvas,()=>l.get("Comfy.ColorPalette")],async([A,B])=>{A&&await p.loadColorPalette(B)}),ae(()=>l.get("Comfy.Canvas.BackgroundImage"),async()=>{if(!u.canvas)return;const A=v.activePaletteId;A&&(await p.loadColorPalette(A),u.canvas.setDirty(!1,!0))}),ae(()=>v.activePaletteId,async A=>{await l.set("Comfy.ColorPalette",A)}),ae(()=>[f.nodeLocationProgressStates,u.canvas],([A,B])=>{if(B?.graph){for(const W of B.graph.nodes){const G=Le().nodeIdToNodeLocatorId(W.id),H=A[G];H&&H.state==="running"?W.progress=H.value/H.max:W.progress=void 0}B.setDirty(!0,!1)}},{deep:!0}),ae(()=>f.lastNodeErrors,A=>{J.graph&&(Vs(J.rootGraph,B=>{for(const H of B.inputs)delete H.hasErrors;for(const H of B.outputs)delete H.hasErrors;const W=A?.[B.id];if(!W)return;W.errors.filter(H=>H.extra_info?.input_name!==void 0).forEach(H=>{const K=H.extra_info.input_name,ee=B.findInputSlot(K);ee!==-1&&(B.inputs[ee].hasErrors=!0)})}),J.canvas.setDirty(!0,!0))}),Ae(s,"litegraph:no-items-selected",()=>{m.add({severity:"warn",summary:ce("toastMessages.nothingSelected"),life:2e3})},{passive:!0});const z=n(async()=>{try{const A=await Se.getCustomNodesI18n();tu(A)}catch(A){console.error("Failed to load custom nodes i18n",A)}},"loadCustomNodesI18n"),j=L(!1),D=zw();return Nw(s),Ow(),$w(),Ve(async()=>{Aw(),Iw(),Dw(),Ew(),Rw(),qo(),J.vueAppReady=!0,r.spinner=!0,Xr.init(),await z();try{await l.loadSettingValues()}catch(W){if(W instanceof Zr)localStorage.removeItem("Comfy.userId"),localStorage.removeItem("Comfy.userName"),window.location.reload();else throw W}Vw.forEach(l.addSetting),await w1().initializeIfNewUser(l),await J.setup(s.value),u.canvas=J.canvas,u.canvas.render_canvas_border=!1,r.spinner=!1,ys().setPopoverRef(a.value),window.app=J,window.graph=J.graph,j.value=!0,$.setupEmptyGraphListener(),J.canvas.onSelectionChange=to(J.canvas.onSelectionChange,()=>u.updateSelectedItems()),v.customPalettes=l.get("Comfy.CustomColorPalettes"),await D.initializeWorkflow(),D.restoreWorkflowTabsState(),await D.loadTemplateFromUrlIfPresent();const{useReleaseStore:A}=await Kn(async()=>{const{useReleaseStore:W}=await Promise.resolve().then(()=>xm);return{useReleaseStore:W}},void 0);A().initialize(),ae(()=>l.get("Comfy.Locale"),async()=>{await _e().execute("Comfy.RefreshNodeDefinitions"),await Xe().reloadCurrentWorkflow()}),_t(()=>me().canvas,W=>{Ae(W.canvas,"litegraph:set-graph",()=>{Le().updateActiveGraph()})},{immediate:!0}),t("ready")}),ut(()=>{$.cleanup()}),(A,B)=>(d(),T(ne,null,[j.value?(d(),U(hd,{key:0},Hn({"graph-canvas-panel":E(()=>[b.value?(d(),U(hg,{key:0,class:"pointer-events-auto"})):V("",!0),j.value&&N.value&&k.value?(d(),U(s0,{key:1,class:"pointer-events-auto"})):V("",!0)]),_:2},[x.value?{name:"workflow-tabs",fn:E(()=>[g.value==="Topbar"?(d(),T("div",C1,[y(eu)()&&g.value!=="Topbar"?(d(),T("div",x1)):V("",!0),c("div",S1,[F(Pl),F(Ml)])])):V("",!0)]),key:"0"}:void 0,x.value?{name:"side-toolbar",fn:E(()=>[F(Jb)]),key:"1"}:void 0,x.value?{name:"side-bar-panel",fn:E(()=>[c("div",_1,[C.value?(d(),U(ms,{key:0,extension:C.value},null,8,["extension"])):V("",!0)])]),key:"2"}:void 0,x.value?{name:"topmenu",fn:E(()=>[F(Pm)]),key:"3"}:void 0,x.value?{name:"bottom-panel",fn:E(()=>[F(Wm)]),key:"4"}:void 0,x.value?{name:"right-side-panel",fn:E(()=>[F(Ph)]),key:"5"}:void 0]),1024)):V("",!0),c("canvas",{id:"graph-canvas",ref_key:"canvasRef",ref:s,tabindex:"1",class:"absolute inset-0 size-full touch-none"},null,512),y(M)&&y(J).canvas&&j.value?(d(),U(Gw,{key:1,canvas:y(J).canvas,onWheelCapture:y(w).forwardEventToCanvas},{default:E(()=>[(d(!0),T(ne,null,be(P.value,W=>(d(),U(b1,{key:W.id,"node-data":W,error:y(f).lastExecutionError?.node_id===W.id?"Execution error":null,"zoom-level":y(u).canvas?.ds?.scale||1,"data-node-id":W.id},null,8,["node-data","error","zoom-level","data-node-id"]))),128))]),_:1},8,["canvas","onWheelCapture"])):V("",!0),j.value?(d(),U(k1,{key:2})):V("",!0),S.value?(d(),U(bg,{key:3})):V("",!0),F(jh,{ref_key:"nodeSearchboxPopoverRef",ref:a},null,512),j.value?(d(),T(ne,{key:4},[F($v),_.value?(d(),U(_v,{key:0})):V("",!0),y(M)?V("",!0):(d(),U(Hm,{key:1}))],64)):V("",!0)],64))}}),$1={class:"flex flex-auto flex-col items-start"},N1={class:"my-4 text-lg font-medium"},I1=q({__name:"RerouteMigrationToast",setup(e){const{t:o}=pe(),t=Bt(),s=Le(),a=n(async()=>{const l=J.rootGraph.serialize(),i=nu(l);await J.loadGraphData(i,!1,!1,s.activeWorkflow),t.removeGroup("reroute-migration")},"migrateToLitegraphReroute");return(l,i)=>(d(),U(y(Oa),{group:"reroute-migration"},{message:E(()=>[c("div",$1,[c("div",N1,R(y(o)("toastMessages.migrateToLitegraphReroute")),1),F(X,{class:"self-end",size:"sm",onClick:a},{default:E(()=>[$e(R(y(o)("g.migrate")),1)]),_:1})])]),_:1}))}}),ma="ComfyUI",M1=" - ComfyUI",P1=n(()=>{const e=Ze(),o=ue(),t=Le(),s=ot(),a=h(()=>e.isIdle?"":`[${Math.round(e.executionProgress*100)}%]`),l=h(()=>o.get("Comfy.UseNewMenu")!=="Disabled"),i=h(()=>o.get("Comfy.Workflow.AutoSave")==="after delay"),r=h(()=>!!t.activeWorkflow?.isModified),u=h(()=>!!t.activeWorkflow?.isPersisted),f=h(()=>s.shiftDown||i.value?!1:!!(!u.value||r.value)),m=h(()=>f.value?" *":""),v=h(()=>{const g=t.activeWorkflow?.filename;return g?m.value+g+M1:ma}),p=h(()=>{const b=Object.entries(e.nodeProgressStates).filter(([N,M])=>M.state==="running");if(b.length===0)return"";if(b.length>1)return`${a.value}[${b.length} ${ce("g.nodesRunning","nodes running")}]`;const[S,_]=b[0],C=Math.round(_.value/_.max*100),x=e.activePrompt?.workflow?.changeTracker?.activeState.nodes.find(N=>String(N.id)===S)?.type||"Node";return`${a.value}[${C}%] ${x}`}),w=h(()=>a.value+(l.value?v.value:ma)),k=h(()=>p.value||w.value);ii(k)},"useBrowserTabTitle"),D1={},A1={class:"size-full bg-modal-panel-background pr-6 pb-8 pl-4"};function L1(e,o){return d(),T("div",A1,[ve(e.$slots,"default")])}n(L1,"_sfc_render");const E1=Ee(D1,[["render",L1]]),O1={class:"text-neutral text-base"},V1={class:"flex gap-2"},R1={class:"relative flex gap-2 px-6 pb-4"},W1=q({__name:"SampleModelSelector",props:{onClose:{type:Function}},setup(e){const o=L([{name:"Vue",value:"vue"},{name:"React",value:"react"},{name:"Angular",value:"angular"},{name:"Svelte",value:"svelte"}]),t=L([{name:"Project A",value:"proj-a"},{name:"Project B",value:"proj-b"},{name:"Project C",value:"proj-c"}]),s=L([{name:"Popular",value:"popular"},{name:"Latest",value:"latest"},{name:"A  Z",value:"az"}]),a=L([{id:"installed",label:"Installed",icon:"icon-[lucide--download]"},{title:"TAGS",items:[{id:"tag-sd15",label:"SD 1.5",icon:"icon-[lucide--tag]"},{id:"tag-sdxl",label:"SDXL",icon:"icon-[lucide--tag]"},{id:"tag-utility",label:"Utility",icon:"icon-[lucide--tag]"}]},{title:"CATEGORIES",items:[{id:"cat-models",label:"Models",icon:"icon-[lucide--layers]"},{id:"cat-nodes",label:"Nodes",icon:"icon-[lucide--grid-3x3]"}]}]);on(cn,e.onClose);const l=L(""),i=L(""),r=L([]),u=L([]),f=L("popular"),m=L("installed"),v=h(()=>Il());return(p,w)=>(d(),U(ds,{"content-title":p.$t("assetBrowser.checkpoints")},{leftPanel:E(()=>[F(ps,{modelValue:m.value,"onUpdate:modelValue":w[0]||(w[0]=k=>m.value=k),"nav-items":a.value},{"header-icon":E(()=>w[6]||(w[6]=[c("i",{class:"text-neutral icon-[lucide--puzzle]"},null,-1)])),"header-title":E(()=>[c("span",O1,R(p.$t("g.title")),1)]),_:1},8,["modelValue","nav-items"])]),header:E(()=>[F(an,{modelValue:l.value,"onUpdate:modelValue":w[1]||(w[1]=k=>l.value=k),size:"lg",class:"max-w-[384px]"},null,8,["modelValue"])]),"header-right-area":E(()=>[c("div",V1,[F(X,{variant:"primary",onClick:n(()=>{},"onClick")},{default:E(()=>[w[7]||(w[7]=c("i",{class:"icon-[lucide--upload]"},null,-1)),c("span",null,R(p.$t("g.upload")),1)]),_:1}),F(gl,null,{default:E(({close:k})=>[F(X,{variant:"secondary",onClick:n(()=>{k()},"onClick")},{default:E(()=>[w[8]||(w[8]=c("i",{class:"icon-[lucide--download]"},null,-1)),c("span",null,R(p.$t("g.settings")),1)]),_:2},1032,["onClick"]),F(X,{variant:"primary",onClick:n(()=>{k()},"onClick")},{default:E(()=>[w[9]||(w[9]=c("i",{class:"icon-[lucide--scroll]"},null,-1)),c("span",null,R(p.$t("g.profile")),1)]),_:2},1032,["onClick"])]),_:1})])]),contentFilter:E(()=>[c("div",R1,[F(zt,{modelValue:r.value,"onUpdate:modelValue":w[2]||(w[2]=k=>r.value=k),"search-query":i.value,"onUpdate:searchQuery":w[3]||(w[3]=k=>i.value=k),class:"w-[250px]",label:p.$t("assetBrowser.selectFrameworks"),options:o.value,"show-search-box":!0,"show-selected-count":!0,"show-clear-button":!0},null,8,["modelValue","search-query","label","options"]),F(zt,{modelValue:u.value,"onUpdate:modelValue":w[4]||(w[4]=k=>u.value=k),label:p.$t("assetBrowser.selectProjects"),options:t.value},null,8,["modelValue","label","options"]),F(Ko,{modelValue:f.value,"onUpdate:modelValue":w[5]||(w[5]=k=>f.value=k),label:p.$t("assetBrowser.sortingType"),options:s.value,class:"w-[135px]"},{icon:E(()=>w[10]||(w[10]=[c("i",{class:"icon-[lucide--filter]"},null,-1)])),_:1},8,["modelValue","label","options"])])]),content:E(()=>[c("div",{style:he(v.value)},[(d(),T(ne,null,be(100,k=>F(Bo,{key:k,size:"regular"},{top:E(()=>[F(Fo,{ratio:"landscape"},{default:E(()=>w[11]||(w[11]=[c("div",{class:"h-full w-full bg-blue-500"},null,-1)])),"top-right":E(()=>[F(X,{size:"icon",class:"!bg-white !text-neutral-900",onClick:n(()=>{},"onClick")},{default:E(()=>w[12]||(w[12]=[c("i",{class:"icon-[lucide--info]"},null,-1)])),_:1})]),"bottom-right":E(()=>[F(Uo,{label:"png"}),F(Uo,{label:"1.2 MB"}),F(Uo,{label:"LoRA"},{icon:E(()=>w[13]||(w[13]=[c("i",{class:"icon-[lucide--folder]"},null,-1)])),_:1})]),_:1})]),bottom:E(()=>[F(zo)]),_:2},1024)),64))],4)]),rightPanel:E(()=>[F(E1)]),_:1},8,["content-title"]))}}),ga="global-model-selector",z1=n(()=>{const e=tt(),o=vt();function t(){o.closeDialog({key:ga})}n(t,"hide");function s(){e.showLayoutDialog({key:ga,component:W1,props:{onClose:t}})}return n(s,"show"),{show:s,hide:t}},"useModelSelectorDialog");function B1(e,o){const t=su.safeParse(e);if(!t.success){const g=t.error.errors.map(b=>`${b.path.join(".")}: ${b.message}`).join(", ");return console.error("Invalid asset item:",g),{success:!1,error:{code:"INVALID_ASSET",message:"Asset schema validation failed",assetId:e.id,details:{validationErrors:g}}}}const s=t.data,a=s.user_metadata;if(!a)return console.error(`Asset ${s.id} missing required user_metadata`),{success:!1,error:{code:"INVALID_ASSET",message:"Asset missing required user_metadata",assetId:s.id}};const l=a.filename;if(typeof l!="string"||l.length===0)return console.error(`Asset ${s.id} has invalid user_metadata.filename (expected non-empty string, got ${typeof l})`),{success:!1,error:{code:"INVALID_ASSET",message:`Invalid filename (expected non-empty string, got ${typeof l})`,assetId:s.id}};if(s.tags.length===0)return console.error(`Asset ${s.id} has no tags defined (expected at least one category tag)`),{success:!1,error:{code:"INVALID_ASSET",message:"Asset has no tags defined",assetId:s.id}};const i=s.tags.find(g=>g!==Ws&&g!==zs);if(!i)return console.error(`Asset ${s.id} has no valid category tag. Available tags: ${s.tags.join(", ")} (expected tag other than '${Ws}' or '${zs}')`),{success:!1,error:{code:"INVALID_ASSET",message:"Asset has no valid category tag",assetId:s.id,details:{availableTags:s.tags}}};const u=Zn().getNodeProvider(i);if(!u)return console.error(`No node provider registered for category: ${i}`),{success:!1,error:{code:"NO_PROVIDER",message:`No node provider registered for category: ${i}`,assetId:s.id,details:{category:i}}};const m=lo().getCanvasCenter(),v=ge.createNode(u.nodeDef.name,u.nodeDef.display_name,{pos:m});if(!v)return console.error(`Failed to create node for type: ${u.nodeDef.name}`),{success:!1,error:{code:"NODE_CREATION_FAILED",message:`Failed to create node for type: ${u.nodeDef.name}`,assetId:s.id,details:{nodeType:u.nodeDef.name}}};const p=Le(),w=p.isSubgraphActive?p.activeSubgraph:J.canvas.graph;if(!w)return console.error("No active graph available"),{success:!1,error:{code:"NO_GRAPH",message:"No active graph available",assetId:s.id}};const k=v.widgets?.find(g=>g.name===u.key);return k?(k.value=l,w.add(v),{success:!0,value:v}):(console.error(`Widget ${u.key} not found on node ${u.nodeDef.name}`),{success:!1,error:{code:"MISSING_WIDGET",message:`Widget ${u.key} not found on node ${u.nodeDef.name}`,assetId:s.id,details:{widgetName:u.key,nodeType:u.nodeDef.name}}})}n(B1,"createModelNodeFromAsset");const Oo={DISTRIBUTION:"tf_42243568391700",ANONYMOUS_EMAIL:"tf_anonymous_requester_email",EMAIL:"tf_40029135130388",USER_ID:"tf_42515251051412"},F1="https://support.comfy.org/hc/en-us/requests/new";function U1(e){const o=new URLSearchParams({[Oo.DISTRIBUTION]:"oss"});return e?.userEmail&&(o.append(Oo.ANONYMOUS_EMAIL,e.userEmail),o.append(Oo.EMAIL,e.userEmail)),e?.userId&&o.append(Oo.USER_ID,e.userId),`${F1}?${o.toString()}`}n(U1,"buildSupportUrl");const{isActiveSubscription:$n,showSubscriptionDialog:Nn}=es(),Vo="1.22.2";function G1(){const e=Xe(),o=Le(),t=tt(),s=ct(),a=qa(),l=Mt(),i=me(),r=Ze(),{staticUrls:u,buildDocsUrl:f}=io(),m=ue(),v=ao(),{getSelectedNodes:p,toggleSelectedNodesMode:w}=ls(),k=n(()=>o.activeWorkflow?.changeTracker,"getTracker");function g(){return m.get("Comfy.Queue.QPOV2")}n(g,"isQueuePanelV2Enabled");async function b(){await m.set("Comfy.Queue.QPOV2",!g())}n(b,"toggleQueuePanelV2");const S=n(C=>{const x=p();if(x.length===0)return;const N=ue().get("Comfy.SnapToGrid.GridSize");x.forEach(M=>{M.pos=C(M.pos,N)}),J.canvas.state.selectionChanged=!0,J.canvas.setDirty(!0,!0)},"moveSelectedNodes");return[{id:"Comfy.NewBlankWorkflow",icon:"pi pi-plus",label:"New Blank Workflow",menubarLabel:"New",category:"essentials",function:n(async()=>{J.rootGraph._nodes.length>0,await e.loadBlankWorkflow()},"function")},{id:"Comfy.OpenWorkflow",icon:"pi pi-folder-open",label:"Open Workflow",menubarLabel:"Open",category:"essentials",function:n(()=>{J.ui.loadFile()},"function")},{id:"Comfy.LoadDefaultWorkflow",icon:"pi pi-code",label:"Load Default Workflow",function:n(async()=>{J.rootGraph._nodes.length>0,await e.loadDefaultWorkflow()},"function")},{id:"Comfy.SaveWorkflow",icon:"pi pi-save",label:"Save Workflow",menubarLabel:"Save",category:"essentials",function:n(async()=>{const C=Le().activeWorkflow;C&&await e.saveWorkflow(C)},"function")},{id:"Comfy.PublishSubgraph",icon:"pi pi-save",label:"Publish Subgraph",menubarLabel:"Publish",function:n(async()=>{await ja().publishSubgraph()},"function")},{id:"Comfy.SaveWorkflowAs",icon:"pi pi-save",label:"Save Workflow As",menubarLabel:"Save As",category:"essentials",function:n(async()=>{const C=Le().activeWorkflow;C&&await e.saveWorkflowAs(C)},"function")},{id:"Comfy.ExportWorkflow",icon:"pi pi-download",label:"Export Workflow",menubarLabel:"Export",category:"essentials",function:n(async()=>{await e.exportWorkflow("workflow","workflow")},"function")},{id:"Comfy.ExportWorkflowAPI",icon:"pi pi-download",label:"Export Workflow (API Format)",menubarLabel:"Export (API)",function:n(async()=>{await e.exportWorkflow("workflow_api","output")},"function")},{id:"Comfy.Undo",icon:"pi pi-undo",label:"Undo",category:"essentials",function:n(async()=>{await k()?.undo?.()},"function")},{id:"Comfy.Redo",icon:"pi pi-refresh",label:"Redo",category:"essentials",function:n(async()=>{await k()?.redo?.()},"function")},{id:"Comfy.ClearWorkflow",icon:"pi pi-trash",label:"Clear Workflow",category:"essentials",function:n(()=>{if(!ue().get("Comfy.ConfirmClear")||confirm("Clear workflow?")){if(J.clean(),J.canvas.subgraph){const x=J.canvas.subgraph;lu(x).forEach(M=>x.remove(M))}Se.dispatchCustomEvent("graphCleared")}},"function")},{id:"Comfy.Canvas.ResetView",icon:"pi pi-expand",label:"Reset View",function:n(()=>{lo().resetView()},"function")},{id:"Comfy.OpenClipspace",icon:"pi pi-clipboard",label:"Clipspace",function:n(()=>{J.openClipspace()},"function")},{id:"Comfy.RefreshNodeDefinitions",icon:"pi pi-refresh",label:"Refresh Node Definitions",category:"essentials",function:n(async()=>{await J.refreshComboInNodes()},"function")},{id:"Comfy.Interrupt",icon:"pi pi-stop",label:"Interrupt",category:"essentials",function:n(async()=>{await Se.interrupt(r.activePromptId),l.add({severity:"info",summary:ce("g.interrupted"),detail:ce("toastMessages.interrupted"),life:1e3})},"function")},{id:"Comfy.ClearPendingTasks",icon:"pi pi-stop",label:"Clear Pending Tasks",category:"essentials",function:n(async()=>{await Tt().clear(["queue"]),l.add({severity:"info",summary:ce("g.confirmed"),detail:ce("toastMessages.pendingTasksDeleted"),life:3e3})},"function")},{id:"Comfy.BrowseTemplates",icon:"pi pi-folder-open",label:"Browse Templates",function:n(()=>{bs().show()},"function")},{id:"Comfy.Canvas.ZoomIn",icon:"pi pi-plus",label:"Zoom In",category:"view-controls",function:n(()=>{const C=J.canvas.ds;C.changeScale(C.scale*1.1,C.element?[C.element.width/2,C.element.height/2]:void 0),J.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.Canvas.ZoomOut",icon:"pi pi-minus",label:"Zoom Out",category:"view-controls",function:n(()=>{const C=J.canvas.ds;C.changeScale(C.scale/1.1,C.element?[C.element.width/2,C.element.height/2]:void 0),J.canvas.setDirty(!0,!0)},"function")},{id:"Experimental.ToggleVueNodes",label:n(()=>`Experimental: ${ue().get("Comfy.VueNodes.Enabled")?"Disable":"Enable"} Nodes 2.0`,"label"),function:n(async()=>{const C=ue(),x=C.get("Comfy.VueNodes.Enabled")??!1;await C.set("Comfy.VueNodes.Enabled",!x)},"function")},{id:"Comfy.Canvas.FitView",icon:"pi pi-expand",label:"Fit view to selected nodes",menubarLabel:"Zoom to fit",category:"view-controls",function:n(()=>{if(J.canvas.empty){l.add({severity:"error",summary:ce("toastMessages.emptyCanvas"),life:3e3});return}J.canvas.fitViewToSelectionAnimated()},"function")},{id:"Comfy.Canvas.ToggleLock",icon:"pi pi-lock",label:"Canvas Toggle Lock",category:"view-controls",function:n(()=>{J.canvas.state.readOnly=!J.canvas.state.readOnly},"function")},{id:"Comfy.Canvas.Lock",icon:"pi pi-lock",label:"Lock Canvas",category:"view-controls",function:n(()=>{J.canvas.state.readOnly=!0},"function")},{id:"Comfy.Canvas.Unlock",icon:"pi pi-lock-open",label:"Unlock Canvas",function:n(()=>{J.canvas.state.readOnly=!1},"function")},{id:"Comfy.Canvas.ToggleLinkVisibility",icon:"pi pi-eye",label:"Canvas Toggle Link Visibility",menubarLabel:"Node Links",versionAdded:"1.3.6",function:(()=>{const C=ue();let x=ge.SPLINE_LINK;return async()=>{const N=C.get("Comfy.LinkRenderMode");N===ge.HIDDEN_LINK?await C.set("Comfy.LinkRenderMode",x):(x=N,await C.set("Comfy.LinkRenderMode",ge.HIDDEN_LINK))}})(),active:n(()=>ue().get("Comfy.LinkRenderMode")!==ge.HIDDEN_LINK,"active")},{id:"Comfy.Canvas.ToggleMinimap",icon:"pi pi-map",label:"Canvas Toggle Minimap",menubarLabel:"Minimap",versionAdded:"1.24.1",function:n(async()=>{const C=ue();await C.set("Comfy.Minimap.Visible",!C.get("Comfy.Minimap.Visible"))},"function"),active:n(()=>ue().get("Comfy.Minimap.Visible"),"active")},{id:"Comfy.Queue.ToggleOverlay",icon:"pi pi-history",label:n(()=>ce("queue.toggleJobHistory"),"label"),menubarLabel:n(()=>ce("queue.jobHistory"),"menubarLabel"),versionAdded:"1.37.0",category:"view-controls",function:n(()=>{An().toggleOverlay()},"function"),active:n(()=>An().isOverlayExpanded,"active")},{id:"Comfy.QueuePrompt",icon:"pi pi-play",label:"Queue Prompt",versionAdded:"1.3.7",category:"essentials",function:n(async C=>{if(!$n.value){Nn();return}const x=wo().batchCount;await J.queuePrompt(0,x)},"function")},{id:"Comfy.QueuePromptFront",icon:"pi pi-play",label:"Queue Prompt (Front)",versionAdded:"1.3.7",category:"essentials",function:n(async C=>{if(!$n.value){Nn();return}const x=wo().batchCount;await J.queuePrompt(-1,x)},"function")},{id:"Comfy.QueueSelectedOutputNodes",icon:"pi pi-play",label:"Queue Selected Output Nodes",versionAdded:"1.19.6",function:n(async C=>{if(!$n.value){Nn();return}const x=wo().batchCount,N=p(),M=Xa(N);if(M.length===0){l.add({severity:"error",summary:ce("toastMessages.nothingToQueue"),detail:ce("toastMessages.pleaseSelectOutputNodes"),life:3e3});return}const $=iu(M);if($.length===0){l.add({severity:"error",summary:ce("toastMessages.failedToQueue"),detail:ce("toastMessages.failedExecutionPathResolution"),life:3e3});return}await J.queuePrompt(0,x,$)},"function")},{id:"Comfy.ShowSettingsDialog",icon:"pi pi-cog",label:"Show Settings Dialog",versionAdded:"1.3.7",category:"view-controls",function:n(()=>{t.showSettingsDialog()},"function")},{id:"Comfy.Graph.GroupSelectedNodes",icon:"pi pi-sitemap",label:"Group Selected Nodes",versionAdded:"1.3.7",category:"essentials",function:n(()=>{const{canvas:C}=J;if(!C.selectedItems?.size){l.add({severity:"error",summary:ce("toastMessages.nothingToGroup"),detail:ce("toastMessages.pleaseSelectNodesToGroup"),life:3e3});return}const x=new Wt,N=ue().get("Comfy.GroupSelectedNodes.Padding");x.resizeTo(C.selectedItems,N),C.graph?.add(x),x.recomputeInsideNodes(),rn().titleEditorTarget=x},"function")},{id:"Workspace.NextOpenedWorkflow",icon:"pi pi-step-forward",label:"Next Opened Workflow",versionAdded:"1.3.9",function:n(async()=>{await e.loadNextOpenedWorkflow()},"function")},{id:"Workspace.PreviousOpenedWorkflow",icon:"pi pi-step-backward",label:"Previous Opened Workflow",versionAdded:"1.3.9",function:n(async()=>{await e.loadPreviousOpenedWorkflow()},"function")},{id:"Comfy.Canvas.ToggleSelectedNodes.Mute",icon:"pi pi-volume-off",label:"Mute/Unmute Selected Nodes",versionAdded:"1.3.11",category:"essentials",function:n(()=>{w(Oe.NEVER),J.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.Canvas.ToggleSelectedNodes.Bypass",icon:"pi pi-shield",label:"Bypass/Unbypass Selected Nodes",versionAdded:"1.3.11",category:"essentials",function:n(()=>{w(Oe.BYPASS),J.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.Canvas.ToggleSelectedNodes.Pin",icon:"pi pi-pin",label:"Pin/Unpin Selected Nodes",versionAdded:"1.3.11",category:"essentials",function:n(()=>{p().forEach(C=>{C.pin(!C.pinned)}),J.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.Canvas.ToggleSelected.Pin",icon:"pi pi-pin",label:"Pin/Unpin Selected Items",versionAdded:"1.3.33",function:n(()=>{for(const C of J.canvas.selectedItems)(C instanceof gt||C instanceof Wt)&&C.pin(!C.pinned);J.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.Canvas.Resize",icon:"pi pi-minus",label:"Resize Selected Nodes",versionAdded:"",function:n(()=>{p().forEach(C=>{const x=C.computeSize();C.setSize([x[0],x[1]])}),J.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.Canvas.ToggleSelectedNodes.Collapse",icon:"pi pi-minus",label:"Collapse/Expand Selected Nodes",versionAdded:"1.3.11",function:n(()=>{p().forEach(C=>{C.collapse()}),J.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.ToggleTheme",icon:"pi pi-moon",label:"Toggle Theme (Dark/Light)",versionAdded:"1.3.12",function:(()=>{let C=ru.id,x=uu.id;return async()=>{const N=ue(),M=s.completedActivePalette;M.light_theme?(x=M.id,await N.set("Comfy.ColorPalette",C)):(C=M.id,await N.set("Comfy.ColorPalette",x))}})()},{id:"Workspace.ToggleBottomPanel",icon:"pi pi-list",label:"Toggle Bottom Panel",menubarLabel:"Bottom Panel",versionAdded:"1.3.22",category:"view-controls",function:n(()=>{v.toggleBottomPanel()},"function"),active:n(()=>v.bottomPanelVisible,"active")},{id:"Workspace.ToggleFocusMode",icon:"pi pi-eye",label:"Toggle Focus Mode",menubarLabel:"Focus Mode",versionAdded:"1.3.27",category:"view-controls",function:n(()=>{ot().toggleFocusMode()},"function"),active:n(()=>ot().focusMode,"active")},{id:"Comfy.Graph.FitGroupToContents",icon:"pi pi-expand",label:"Fit Group To Contents",versionAdded:"1.4.9",function:n(()=>{for(const C of J.canvas.selectedItems)if(C instanceof Wt){C.recomputeInsideNodes();const x=ue().get("Comfy.GroupSelectedNodes.Padding");C.resizeTo(C.children,x),J.canvas.setDirty(!1,!0)}},"function")},{id:"Comfy.Help.OpenComfyUIIssues",icon:"pi pi-github",label:"Open ComfyUI Issues",menubarLabel:"ComfyUI Issues",versionAdded:"1.5.5",function:n(()=>{window.open(u.githubIssues,"_blank")},"function")},{id:"Comfy.Help.OpenComfyUIDocs",icon:"pi pi-info-circle",label:"Open ComfyUI Docs",menubarLabel:"ComfyUI Docs",versionAdded:"1.5.5",function:n(()=>{window.open(f("/",{includeLocale:!0}),"_blank")},"function")},{id:"Comfy.Help.OpenComfyOrgDiscord",icon:"pi pi-discord",label:"Open Comfy-Org Discord",menubarLabel:"Comfy-Org Discord",versionAdded:"1.5.5",function:n(()=>{window.open(u.discord,"_blank")},"function")},{id:"Workspace.SearchBox.Toggle",icon:"pi pi-search",label:"Toggle Search Box",versionAdded:"1.5.7",function:n(()=>{ys().toggleVisible()},"function")},{id:"Comfy.Help.AboutComfyUI",icon:"pi pi-info-circle",label:"Open About ComfyUI",menubarLabel:"About ComfyUI",versionAdded:"1.6.4",function:n(()=>{t.showSettingsDialog("about")},"function")},{id:"Comfy.DuplicateWorkflow",icon:"pi pi-clone",label:"Duplicate Current Workflow",versionAdded:"1.6.15",function:n(async()=>{await e.duplicateWorkflow(o.activeWorkflow)},"function")},{id:"Workspace.CloseWorkflow",icon:"pi pi-times",label:"Close Current Workflow",versionAdded:"1.7.3",function:n(async()=>{o.activeWorkflow&&await e.closeWorkflow(o.activeWorkflow)},"function")},{id:"Comfy.ContactSupport",icon:"pi pi-question",label:"Contact Support",versionAdded:"1.17.8",function:n(()=>{const{userEmail:C,resolvedUserInfo:x}=ro(),N=U1({userEmail:C.value,userId:x.value?.id});window.open(N,"_blank")},"function")},{id:"Comfy.Help.OpenComfyUIForum",icon:"pi pi-comments",label:"Open ComfyUI Forum",menubarLabel:"ComfyUI Forum",versionAdded:"1.8.2",function:n(()=>{window.open(u.forum,"_blank")},"function")},{id:"Comfy.Canvas.DeleteSelectedItems",icon:"pi pi-trash",label:"Delete Selected Items",versionAdded:"1.10.5",function:n(()=>{J.canvas.deleteSelected(),J.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.Manager.CustomNodesManager.ShowCustomNodesMenu",icon:"pi pi-puzzle",label:"Custom Nodes Manager",versionAdded:"1.12.10",function:n(async()=>{await ft().openManager({showToastOnLegacyError:!0})},"function")},{id:"Comfy.Manager.ShowUpdateAvailablePacks",icon:"pi pi-sync",label:"Check for Custom Node Updates",versionAdded:"1.17.0",function:n(async()=>{const C=ft();if(C.managerUIState.value===cu.DISABLED){l.add({severity:"error",summary:ce("g.error"),detail:ce("manager.notAvailable"),life:3e3});return}await C.openManager({initialTab:Xt.UpdateAvailable,showToastOnLegacyError:!1})},"function")},{id:"Comfy.Manager.ShowMissingPacks",icon:"pi pi-exclamation-circle",label:"Install Missing Custom Nodes",versionAdded:"1.17.0",function:n(async()=>{await ft().openManager({initialTab:Xt.Missing,showToastOnLegacyError:!1})},"function")},{id:"Comfy.User.OpenSignInDialog",icon:"pi pi-user",label:"Open Sign In Dialog",versionAdded:"1.17.6",function:n(async()=>{await t.showSignInDialog()},"function")},{id:"Comfy.User.SignOut",icon:"pi pi-sign-out",label:"Sign Out",versionAdded:"1.18.1",function:n(async()=>{await a.logout()},"function")},{id:"Comfy.Canvas.MoveSelectedNodes.Up",icon:"pi pi-arrow-up",label:"Move Selected Nodes Up",versionAdded:Vo,function:n(()=>S(([C,x],N)=>[C,x-N]),"function")},{id:"Comfy.Canvas.MoveSelectedNodes.Down",icon:"pi pi-arrow-down",label:"Move Selected Nodes Down",versionAdded:Vo,function:n(()=>S(([C,x],N)=>[C,x+N]),"function")},{id:"Comfy.Canvas.MoveSelectedNodes.Left",icon:"pi pi-arrow-left",label:"Move Selected Nodes Left",versionAdded:Vo,function:n(()=>S(([C,x],N)=>[C-N,x]),"function")},{id:"Comfy.Canvas.MoveSelectedNodes.Right",icon:"pi pi-arrow-right",label:"Move Selected Nodes Right",versionAdded:Vo,function:n(()=>S(([C,x],N)=>[C+N,x]),"function")},{id:"Comfy.Graph.ConvertToSubgraph",icon:"icon-[lucide--shrink]",label:"Convert Selection to Subgraph",versionAdded:"1.20.1",category:"essentials",function:n(()=>{const C=i.getCanvas(),x=C.subgraph??C.graph;if(!x)throw new TypeError("Canvas has no graph or subgraph set.");const N=x.convertToSubgraph(C.selectedItems);if(!N){l.add({severity:"error",summary:ce("toastMessages.cannotCreateSubgraph"),detail:ce("toastMessages.failedToConvertToSubgraph"),life:3e3});return}const{node:M}=N;C.select(M),i.updateSelectedItems()},"function")},{id:"Comfy.Graph.UnpackSubgraph",icon:"icon-[lucide--expand]",label:"Unpack the selected Subgraph",versionAdded:"1.26.3",function:n(()=>{const{unpackSubgraph:C}=Za();C()},"function")},{id:"Comfy.Graph.EditSubgraphWidgets",label:"Edit Subgraph Widgets",icon:"icon-[lucide--settings-2]",versionAdded:"1.28.5",function:n(()=>{so().openPanel("subgraph")},"function")},{id:"Comfy.Graph.ToggleWidgetPromotion",icon:"icon-[lucide--arrow-left-right]",label:"Toggle promotion of hovered widget",versionAdded:"1.30.1",function:au},{id:"Comfy.OpenManagerDialog",icon:"mdi mdi-puzzle-outline",label:"Manager",function:n(async()=>{await ft().openManager({initialTab:Xt.All,showToastOnLegacyError:!1})},"function")},{id:"Comfy.ToggleHelpCenter",icon:"pi pi-question-circle",label:"Help Center",function:n(()=>{zn().toggle()},"function"),active:n(()=>zn().isVisible,"active")},{id:"Comfy.ToggleCanvasInfo",icon:"pi pi-info-circle",label:"Canvas Performance",function:n(async()=>{const C=ue(),x=C.get("Comfy.Graph.CanvasInfo");await C.set("Comfy.Graph.CanvasInfo",!x)},"function"),active:n(()=>ue().get("Comfy.Graph.CanvasInfo"),"active")},{id:"Workspace.ToggleBottomPanel.Shortcuts",icon:"pi pi-key",label:"Show Keybindings Dialog",versionAdded:"1.24.1",category:"view-controls",function:n(()=>{v.togglePanel("shortcuts")},"function")},{id:"Comfy.Graph.ExitSubgraph",icon:"pi pi-arrow-up",label:"Exit Subgraph",versionAdded:"1.20.1",function:n(()=>{const C=me().getCanvas(),x=ts();C.graph&&C.setGraph(x.navigationStack.at(-2)??C.graph.rootGraph)},"function")},{id:"Comfy.Dev.ShowModelSelector",icon:"pi pi-box",label:"Show Model Selector (Dev)",versionAdded:"1.26.2",category:"view-controls",function:n(()=>{z1().show()},"function")},{id:"Comfy.Manager.CustomNodesManager.ShowLegacyCustomNodesMenu",icon:"pi pi-bars",label:"Custom Nodes (Legacy)",versionAdded:"1.16.4",function:n(async()=>{await ft().openManager({legacyCommand:"Comfy.Manager.CustomNodesManager.ToggleVisibility",showToastOnLegacyError:!0,isLegacyOnly:!0})},"function")},{id:"Comfy.Manager.ShowLegacyManagerMenu",icon:"mdi mdi-puzzle",label:"Manager Menu (Legacy)",versionAdded:"1.16.4",function:n(async()=>{await ft().openManager({showToastOnLegacyError:!0,isLegacyOnly:!0})},"function")},{id:"Comfy.Memory.UnloadModels",icon:"mdi mdi-vacuum-outline",label:"Unload Models",versionAdded:"1.16.4",function:n(async()=>{if(!ue().get("Comfy.Memory.AllowManualUnload")){Mt().add({severity:"error",summary:ce("g.error"),detail:ce("g.commandProhibited",{command:"Comfy.Memory.UnloadModels"}),life:3e3});return}await Se.freeMemory({freeExecutionCache:!1})},"function")},{id:"Comfy.Memory.UnloadModelsAndExecutionCache",icon:"mdi mdi-vacuum-outline",label:"Unload Models and Execution Cache",versionAdded:"1.16.4",function:n(async()=>{if(!ue().get("Comfy.Memory.AllowManualUnload")){Mt().add({severity:"error",summary:ce("g.error"),detail:ce("g.commandProhibited",{command:"Comfy.Memory.UnloadModelsAndExecutionCache"}),life:3e3});return}await Se.freeMemory({freeExecutionCache:!0})},"function")},{id:"Comfy.BrowseModelAssets",icon:"pi pi-folder-open",label:"Experimental: Browse Model Assets",versionAdded:"1.28.3",function:n(async()=>{if(!ue().get("Comfy.Assets.UseAssetAPI")){if(!await t.confirm({title:"Enable Asset API",message:"The Asset API is currently disabled. Would you like to enable it?",type:"default"}))return;await ue().set("Comfy.Assets.UseAssetAPI",!0),await e.reloadCurrentWorkflow()}await Xc().browse({assetType:"models",title:ce("sideToolbar.modelLibrary"),onAssetSelected:n(x=>{const N=B1(x);N.success||(l.add({severity:"error",summary:ce("g.error"),detail:ce("assetBrowser.failedToCreateNode")}),console.error("Node creation failed:",N.error))},"onAssetSelected")})},"function")},{id:"Comfy.ToggleAssetAPI",icon:"pi pi-database",label:n(()=>`Experimental: ${ue().get("Comfy.Assets.UseAssetAPI")?"Disable":"Enable"} AssetAPI`,"label"),function:n(async()=>{const C=ue(),x=C.get("Comfy.Assets.UseAssetAPI")??!1;await C.set("Comfy.Assets.UseAssetAPI",!x),await Xe().reloadCurrentWorkflow()},"function")},{id:"Comfy.ToggleQPOV2",icon:"pi pi-list",label:"Toggle Queue Panel V2",function:b},{id:"Comfy.ToggleLinear",icon:"pi pi-database",label:"toggle linear mode",function:n(()=>i.linearMode=!i.linearMode,"function")}].map(C=>({...C,source:"System"}))}n(G1,"useCoreCommands");const j1=n(()=>{const e="/workspace/",o=`${e}assets/images/favicon_progress_16x16/frame_9.png`,t=ri(o),s=Ze(),a=10;ae([()=>s.executionProgress,()=>s.isIdle],([l,i])=>{if(i)t.value=o;else{const r=Math.min(Math.max(0,Math.floor(l*a)),a-1);t.value=`${e}assets/images/favicon_progress_16x16/frame_${r}.png`}})},"useProgressFavicon");var Un=(e=>(e.NoPreviews="none",e.Auto="auto",e.Latent2RGB="latent2rgb",e.TAESD="taesd",e))(Un||{}),Gn=(e=>(e.DEBUG="DEBUG",e.INFO="INFO",e.WARNING="WARNING",e.ERROR="ERROR",e.CRITICAL="CRITICAL",e))(Gn||{}),jn=(e=>(e.MD5="md5",e.SHA1="sha1",e.SHA256="sha256",e.SHA512="sha512",e))(jn||{}),Qt=(e=>(e.Auto="auto",e.Disable="disable",e.Enable="enable",e))(Qt||{}),Pe=(e=>(e.AUTO="auto",e.FP64="fp64",e.FP32="fp32",e.FP16="fp16",e.BF16="bf16",e.FP8E4M3FN="fp8_e4m3fn",e.FP8E5M2="fp8_e5m2",e))(Pe||{}),Go=(e=>(e.Auto="auto",e.Split="split",e.Quad="quad",e.Pytorch="pytorch",e))(Go||{}),jo=(e=>(e.Auto="auto",e.GPUOnly="gpu-only",e.HighVram="highvram",e.NormalVram="normalvram",e.LowVram="lowvram",e.NoVram="novram",e.CPU="cpu",e))(jo||{});const H1=[{id:"listen",name:"Host: The IP address to listen on",category:["Network"],type:"text",defaultValue:"127.0.0.1"},{id:"port",name:"Port: The port to listen on",category:["Network"],type:"number",defaultValue:8e3},{id:"tls-keyfile",name:"TLS Key File: Path to TLS key file for HTTPS",category:["Network"],type:"text",defaultValue:""},{id:"tls-certfile",name:"TLS Certificate File: Path to TLS certificate file for HTTPS",category:["Network"],type:"text",defaultValue:""},{id:"enable-cors-header",name:'Enable CORS header: Use "*" for all origins or specify domain',category:["Network"],type:"text",defaultValue:""},{id:"max-upload-size",name:"Maximum upload size (MB)",category:["Network"],type:"number",defaultValue:100},{id:"cuda-device",name:"CUDA device index to use",category:["CUDA"],type:"number",defaultValue:null},{id:"cuda-malloc",name:"Use CUDA malloc for memory allocation",category:["CUDA"],type:"combo",options:Object.values(Qt),defaultValue:Qt.Auto,getValue:n(e=>{switch(e){case Qt.Auto:return{};case Qt.Enable:return{"cuda-malloc":!0};case Qt.Disable:return{"disable-cuda-malloc":!0}}},"getValue")},{id:"global-precision",name:"Global floating point precision",category:["Inference"],type:"combo",options:[Pe.AUTO,Pe.FP32,Pe.FP16],defaultValue:Pe.AUTO,tooltip:"Global floating point precision",getValue:n(e=>{switch(e){case Pe.AUTO:return{};case Pe.FP32:return{"force-fp32":!0};case Pe.FP16:return{"force-fp16":!0};default:return{}}},"getValue")},{id:"unet-precision",name:"UNET precision",category:["Inference"],type:"combo",options:[Pe.AUTO,Pe.FP64,Pe.FP32,Pe.FP16,Pe.BF16,Pe.FP8E4M3FN,Pe.FP8E5M2],defaultValue:Pe.AUTO,tooltip:"UNET precision",getValue:n(e=>{switch(e){case Pe.AUTO:return{};default:return{[`${e.toLowerCase()}-unet`]:!0}}},"getValue")},{id:"vae-precision",name:"VAE precision",category:["Inference"],type:"combo",options:[Pe.AUTO,Pe.FP16,Pe.FP32,Pe.BF16],defaultValue:Pe.AUTO,tooltip:"VAE precision",getValue:n(e=>{switch(e){case Pe.AUTO:return{};default:return{[`${e.toLowerCase()}-vae`]:!0}}},"getValue")},{id:"cpu-vae",name:"Run VAE on CPU",category:["Inference"],type:"boolean",defaultValue:!1},{id:"text-encoder-precision",name:"Text Encoder precision",category:["Inference"],type:"combo",options:[Pe.AUTO,Pe.FP8E4M3FN,Pe.FP8E5M2,Pe.FP16,Pe.FP32],defaultValue:Pe.AUTO,tooltip:"Text Encoder precision",getValue:n(e=>{switch(e){case Pe.AUTO:return{};default:return{[`${e.toLowerCase()}-text-enc`]:!0}}},"getValue")},{id:"force-channels-last",name:"Force channels-last memory format",category:["Memory"],type:"boolean",defaultValue:!1},{id:"directml",name:"DirectML device index",category:["Memory"],type:"number",defaultValue:null},{id:"disable-ipex-optimize",name:"Disable IPEX optimization",category:["Memory"],type:"boolean",defaultValue:!1},{id:"preview-method",name:"Method used for latent previews",category:["Preview"],type:"combo",options:Object.values(Un),defaultValue:Un.NoPreviews},{id:"preview-size",name:"Size of preview images",category:["Preview"],type:"slider",defaultValue:512,attrs:{min:128,max:2048,step:128}},{id:"cache-classic",name:"Use classic cache system",category:["Cache"],type:"boolean",defaultValue:!1},{id:"cache-lru",name:"Use LRU caching with a maximum of N node results cached.",category:["Cache"],type:"number",defaultValue:null,tooltip:"May use more RAM/VRAM."},{id:"cross-attention-method",name:"Cross attention method",category:["Attention"],type:"combo",options:Object.values(Go),defaultValue:Go.Auto,getValue:n(e=>{switch(e){case Go.Auto:return{};default:return{[`use-${e.toLowerCase()}-cross-attention`]:!0}}},"getValue")},{id:"disable-xformers",name:"Disable xFormers optimization",type:"boolean",defaultValue:!1},{id:"force-upcast-attention",name:"Force attention upcast",category:["Attention"],type:"boolean",defaultValue:!1},{id:"dont-upcast-attention",name:"Prevent attention upcast",category:["Attention"],type:"boolean",defaultValue:!1},{id:"vram-management",name:"VRAM management mode",category:["Memory"],type:"combo",options:Object.values(jo),defaultValue:jo.Auto,getValue:n(e=>{switch(e){case jo.Auto:return{};default:return{[e]:!0}}},"getValue")},{id:"reserve-vram",name:"Reserved VRAM (GB)",category:["Memory"],type:"number",defaultValue:null,tooltip:"Set the amount of vram in GB you want to reserve for use by your OS/other software. By default some amount is reserved depending on your OS."},{id:"default-hashing-function",name:"Default hashing function for model files",type:"combo",options:Object.values(jn),defaultValue:jn.SHA256},{id:"disable-smart-memory",name:"Disable smart memory management",tooltip:"Force ComfyUI to aggressively offload to regular ram instead of keeping models in vram when it can.",category:["Memory"],type:"boolean",defaultValue:!1},{id:"deterministic",name:"Make pytorch use slower deterministic algorithms when it can.",type:"boolean",defaultValue:!1,tooltip:"Note that this might not make images deterministic in all cases."},{id:"fast",name:"Enable some untested and potentially quality deteriorating optimizations.",type:"boolean",defaultValue:!1},{id:"dont-print-server",name:"Don't print server output to console.",type:"boolean",defaultValue:!1},{id:"disable-metadata",name:"Disable saving prompt metadata in files.",type:"boolean",defaultValue:!1},{id:"enable-manager-legacy-ui",name:"Use legacy Manager UI",tooltip:"Uses the legacy ComfyUI-Manager UI instead of the new UI.",type:"boolean",defaultValue:!1},{id:"disable-all-custom-nodes",name:"Disable loading all custom nodes.",type:"boolean",defaultValue:!1},{id:"log-level",name:"Logging verbosity level",type:"combo",options:Object.values(Gn),defaultValue:Gn.INFO,getValue:n(e=>({verbose:e}),"getValue")},{id:"input-directory",name:"Input directory",category:["Directories"],type:"text",defaultValue:""},{id:"output-directory",name:"Output directory",category:["Directories"],type:"text",defaultValue:""}],q1={key:0,role:"status","aria-live":"polite",class:"fixed inset-x-0 bottom-6 z-50 mx-auto w-4/5 max-w-3xl overflow-hidden rounded-lg border border-border-default bg-base-background shadow-lg"},Vl=q({__name:"HoneyToast",props:en({visible:{type:Boolean}},{expanded:{type:Boolean,default:!1},expandedModifiers:{}}),emits:["update:expanded"],setup(e){const o=ko(e,"expanded");function t(){o.value=!o.value}return n(t,"toggle"),(s,a)=>(d(),U(Nt,{to:"body"},[F(Zo,{"enter-active-class":"transition-all duration-300 ease-out","enter-from-class":"translate-y-full opacity-0","enter-to-class":"translate-y-0 opacity-100","leave-active-class":"transition-all duration-200 ease-in","leave-from-class":"translate-y-0 opacity-100","leave-to-class":"translate-y-full opacity-0"},{default:E(()=>[s.visible?(d(),T("div",q1,[c("div",{class:Q(y(le)("overflow-hidden transition-all duration-300",o.value?"max-h-[400px]":"max-h-0"))},[ve(s.$slots,"default",{isExpanded:o.value})],2),ve(s.$slots,"footer",{isExpanded:o.value,toggle:t})])):V("",!0)]),_:3})]))}}),va=q({__name:"StatusBadge",props:{label:{},severity:{default:"default"}},setup(e){function o(t){const s="inline-flex h-3.5 items-center justify-center rounded-full px-1 text-xxxs font-semibold uppercase";switch(t){case"danger":return`${s} bg-destructive-background text-white`;case"contrast":return`${s} bg-base-foreground text-base-background`;case"warn":return`${s} bg-warning-background text-base-background`;case"secondary":return`${s} bg-secondary-background text-base-foreground`;default:return`${s} bg-primary-background text-base-foreground`}}return n(o,"badgeClasses"),(t,s)=>(d(),T("span",{class:Q(o(t.severity))},R(t.label),3))}}),K1={class:"flex flex-col"},Q1={class:"text-sm text-base-foreground"},J1={key:0,class:"text-xs text-muted-foreground"},Y1={class:"flex items-center gap-2"},X1={class:"text-xs text-base-foreground"},Z1={key:3,class:"text-xs text-muted-foreground"},ek=q({__name:"ProgressToastItem",props:{job:{}},setup(e){const{t:o}=pe(),t=h(()=>Math.round(e.job.progress*100)),s=h(()=>e.job.status==="completed"),a=h(()=>e.job.status==="failed"),l=h(()=>e.job.status==="running"),i=h(()=>e.job.status==="created");return(r,u)=>(d(),T("div",{class:Q(y(le)("flex items-center justify-between rounded-lg bg-modal-card-background px-4 py-3",s.value&&"opacity-50"))},[c("div",K1,[c("span",Q1,R(r.job.assetName),1),l.value?(d(),T("span",J1)):V("",!0)]),c("div",Y1,[a.value?(d(),T(ne,{key:0},[u[0]||(u[0]=c("i",{class:"icon-[lucide--circle-alert] size-4 text-destructive-background"},null,-1)),F(va,{label:y(o)("progressToast.failed"),severity:"danger"},null,8,["label"])],64)):s.value?(d(),U(va,{key:1,label:y(o)("progressToast.finished"),severity:"contrast"},null,8,["label"])):l.value?(d(),T(ne,{key:2},[u[1]||(u[1]=c("i",{class:"icon-[lucide--loader-circle] size-4 animate-spin text-base-foreground"},null,-1)),c("span",X1,R(t.value)+"% ",1)],64)):i.value?(d(),T("span",Z1,R(y(o)("progressToast.pending")),1)):V("",!0)])],2))}}),tk={class:"flex h-12 items-center justify-between border-b border-border-default px-4"},ok={class:"text-sm font-bold text-base-foreground"},nk={class:"flex items-center gap-2"},sk={class:"flex min-w-30 flex-col items-stretch rounded-lg border border-interface-stroke bg-interface-panel-surface px-2 py-3"},ak={class:"relative max-h-75 overflow-y-auto px-4 py-4"},lk={key:0,class:"absolute right-1 top-4 h-12 w-1 rounded-full bg-muted-foreground"},ik={class:"flex flex-col gap-2"},rk={key:1,class:"flex flex-col items-center justify-center py-6 text-center"},uk={class:"text-sm text-muted-foreground"},ck={class:"flex h-12 items-center justify-between border-t border-border-default px-4"},dk={class:"flex items-center gap-2 text-sm"},pk={class:"font-bold text-base-foreground"},fk={class:"font-bold text-base-foreground"},mk={class:"font-bold text-base-foreground"},gk={class:"flex items-center gap-2"},vk={key:0,class:"text-sm text-muted-foreground"},hk={class:"flex items-center"},yk=q({__name:"ModelImportProgressDialog",setup(e){const{t:o}=pe(),t=du(),s=h(()=>t.hasDownloads),a=L(!1),l=L("all"),i=L(null);_t(()=>!a.value,()=>i.value?.hide());const r=[{value:"all",label:"all"},{value:"completed",label:"completed"},{value:"failed",label:"failed"}];function u(x){i.value?.toggle(x)}n(u,"onFilterClick");function f(x){l.value=x,i.value?.hide()}n(f,"setFilter");const m=h(()=>t.downloadList),v=h(()=>t.finishedDownloads.filter(x=>x.status==="completed")),p=h(()=>t.finishedDownloads.filter(x=>x.status==="failed")),w=h(()=>t.hasActiveDownloads),k=h(()=>m.value.find(N=>N.status==="running")?.assetName||o("progressToast.downloadingModel")),g=h(()=>v.value.length+p.value.length),b=h(()=>m.value.length),S=h(()=>{switch(l.value){case"completed":return v.value;case"failed":return p.value;default:return m.value}}),_=h(()=>{const x=r.find(N=>N.value===l.value);return o(x?`progressToast.filter.${x.label}`:"progressToast.filter.all")});function C(){t.clearFinishedDownloads(),a.value=!1}return n(C,"closeDialog"),(x,N)=>(d(),U(Vl,{expanded:a.value,"onUpdate:expanded":N[0]||(N[0]=M=>a.value=M),visible:s.value},{default:E(()=>[c("div",tk,[c("h3",ok,R(y(o)("progressToast.importingModels")),1),c("div",nk,[F(X,{variant:"secondary",size:"md",class:"gap-1.5 px-2",onClick:u},{default:E(()=>[N[1]||(N[1]=c("i",{class:"icon-[lucide--list-filter] size-4"},null,-1)),c("span",null,R(_.value),1),N[2]||(N[2]=c("i",{class:"icon-[lucide--chevron-down] size-3"},null,-1))]),_:1}),F(y(Ye),{ref_key:"filterPopoverRef",ref:i,"append-to":"body",dismissable:!0,"close-on-escape":!0,unstyled:"",pt:{root:{class:"absolute z-50"},content:{class:"bg-transparent border-none p-0 pt-2 rounded-lg shadow-lg"}}},{default:E(()=>[c("div",sk,[(d(),T(ne,null,be(r,M=>F(X,{key:M.value,variant:"textonly",size:"sm",class:Q(y(le)("w-full justify-start bg-transparent",l.value===M.value&&"bg-secondary-background-selected")),onClick:n($=>f(M.value),"onClick")},{default:E(()=>[$e(R(y(o)(`progressToast.filter.${M.label}`)),1)]),_:2},1032,["class","onClick"])),64))])]),_:1},512)])]),c("div",ak,[S.value.length>3?(d(),T("div",lk)):V("",!0),c("div",ik,[(d(!0),T(ne,null,be(S.value,M=>(d(),U(ek,{key:M.taskId,job:M},null,8,["job"]))),128))]),S.value.length===0?(d(),T("div",rk,[c("span",uk,R(y(o)("progressToast.noImportsInQueue",{filter:_.value})),1)])):V("",!0)])]),footer:E(({toggle:M})=>[c("div",ck,[c("div",dk,[w.value?(d(),T(ne,{key:0},[N[3]||(N[3]=c("i",{class:"icon-[lucide--loader-circle] size-4 animate-spin text-muted-foreground"},null,-1)),c("span",pk,R(k.value),1)],64)):p.value.length>0?(d(),T(ne,{key:1},[N[4]||(N[4]=c("i",{class:"icon-[lucide--circle-alert] size-4 text-destructive-background"},null,-1)),c("span",fk,R(y(o)("progressToast.downloadsFailed",{count:p.value.length})),1)],64)):(d(),T(ne,{key:2},[N[5]||(N[5]=c("i",{class:"icon-[lucide--check-circle] size-4 text-jade-600"},null,-1)),c("span",mk,R(y(o)("progressToast.allDownloadsCompleted")),1)],64))]),c("div",gk,[w.value?(d(),T("span",vk,R(y(o)("progressToast.progressCount",{completed:g.value,total:b.value})),1)):V("",!0),c("div",hk,[F(X,{variant:"muted-textonly",size:"icon","aria-label":a.value?y(o)("contextMenu.Collapse"):y(o)("contextMenu.Expand"),onClick:Ce(M,["stop"])},{default:E(()=>[c("i",{class:Q(y(le)("size-4",a.value?"icon-[lucide--chevron-down]":"icon-[lucide--chevron-up]"))},null,2)]),_:2},1032,["aria-label","onClick"]),w.value?V("",!0):(d(),U(X,{key:0,variant:"muted-textonly",size:"icon","aria-label":y(o)("g.close"),onClick:Ce(C,["stop"])},{default:E(()=>N[6]||(N[6]=[c("i",{class:"icon-[lucide--x] size-4"},null,-1)])),_:1},8,["aria-label"]))])])])]),_:1},8,["expanded","visible"]))}}),bk=10080*60*1e3,Rl=Dt("versionCompatibility",()=>{const e=ns(),o=ue(),t=h(()=>pu.app_version),s=h(()=>e.systemStats?.system?.comfyui_version??""),a=h(()=>e.systemStats?.system?.required_frontend_version??""),l=h(()=>!t.value||!a.value||!Vt.valid(t.value)||!Vt.valid(a.value)?!1:Vt.gt(a.value,t.value)),i=h(()=>!1),r=h(()=>l.value),u=h(()=>!t.value||!s.value||!a.value?null:`${t.value}-${s.value}-${a.value}`),f=ui("comfy.versionMismatch.dismissals",{},localStorage,{serializer:{read:n(b=>{try{return JSON.parse(b)}catch{return{}}},"read"),write:n(b=>JSON.stringify(b),"write")}}),m=h(()=>{if(!u.value)return!1;const b=f.value[u.value];return b?Date.now()<b:!1}),v=h(()=>{const b=o.get("Comfy.VersionCompatibility.DisableWarnings");return r.value&&!m.value&&!b}),p=h(()=>l.value?{type:"outdated",frontendVersion:t.value,requiredVersion:a.value}:null);async function w(){e.systemStats||await _a(e.isInitialized)}n(w,"checkVersionCompatibility");function k(){if(!u.value)return;const b=Date.now()+bk;f.value={...f.value,[u.value]:b}}n(k,"dismissWarning");async function g(){await w()}return n(g,"initialize"),{frontendVersion:t,backendVersion:s,requiredFrontendVersion:a,hasVersionMismatch:r,shouldShowWarning:v,warningMessage:p,isFrontendOutdated:l,isFrontendNewer:i,checkVersionCompatibility:w,dismissWarning:k,initialize:g}});function wk(e={}){const{immediate:o=!1}=e,{t}=pe(),s=Mt(),a=Rl();let l=!1;const i=n(()=>{if(l)return;const r=a.warningMessage;if(!r)return;const u=t("g.frontendOutdated",{frontendVersion:r.frontendVersion,requiredVersion:r.requiredVersion}),f=t("g.versionMismatchWarningMessage",{warning:t("g.versionMismatchWarning"),detail:u});s.addAlert(f),l=!0,a.dismissWarning()},"showWarning");return Ve(()=>{o&&_t(()=>a.shouldShowWarning,()=>{i()},{immediate:!0,once:!0})}),{showWarning:i,shouldShowWarning:h(()=>a.shouldShowWarning),dismissWarning:a.dismissWarning,hasVersionMismatch:h(()=>a.hasVersionMismatch)}}n(wk,"useFrontendVersionMismatchWarning");function kk(){const e=dl(),o=wo();let t=!1,s=0;Se.addEventListener("graphChanged",()=>{o.mode==="change"&&(s?t=!0:(t=!1,J.queuePrompt(0,o.batchCount),s++))}),e.$subscribe(async()=>{s=e.count,!s&&!J.lastExecutionError&&(o.mode==="instant"||o.mode==="change"&&t)&&(t=!1,await J.queuePrompt(0,o.batchCount))},{detached:!0})}n(kk,"setupAutoQueueHandler");const Ck={class:"absolute w-full h-full"},xk={class:"workflow-tabs-container pointer-events-auto h-9.5 w-full"},Sk={class:"flex h-full items-center"},_k={class:"sidebar-content-container h-full w-full overflow-x-hidden overflow-y-auto border-r-1 border-node-component-border"},Tk=["src"],$k={key:0,class:"pointer-events-none object-contain flex-1 max-h-full brightness-50 opacity-10",src:mu},Nk={class:"actionbar-container flex h-12 items-center rounded-lg border border-[var(--interface-stroke)] p-2 gap-2 bg-comfy-menu-bg justify-end"},Ik={class:"rounded-lg border p-2 gap-2 h-full border-[var(--interface-stroke)] bg-comfy-menu-bg flex flex-col"},Mk={class:"grow-1 flex justify-start flex-col overflow-y-auto contain-size *:max-h-100"},Pk={class:"p-4 pb-0 border-t border-node-component-border"},Dk=q({__name:"LinearView",setup(e){const o=$o(),t=_e(),s=h(()=>{function m(v){const p=$l(v,new Map),w=v.widgets?.map(k=>{const g=p(k);return g.callback=function(b){if(Vv(b))return k.value=b??void 0,k.callback?.(k.value)},g})??[];return{id:`${v.id}`,title:v.title,type:v.type,mode:0,selected:!1,executing:!1,widgets:w}}return n(m,"nodeToNodeData"),J.rootGraph.nodes.filter(v=>v.mode===0&&v.widgets?.length).map(m)}),{isLoggedIn:a}=ro(),l=Ge(),i={options:{step2:1,precision:1,min:1,max:100},value:1,name:ce("Number of generations"),type:"number"},{batchCount:r}=Fe(wo());async function u(m){const p="shiftKey"in m&&m.shiftKey?"Comfy.QueuePromptFront":"Comfy.QueuePrompt";r.value>1,await t.execute(p,{metadata:{subscribe_to_run:!1,trigger_source:"button"}})}n(u,"runButtonClick");function f(){window.open("https://support.comfy.org/hc/en-us/requests/new?ticket_form_id=40026345549204","_blank","noopener,noreferrer")}return n(f,"openFeedback"),(m,v)=>(d(),T("div",Ck,[c("div",xk,[c("div",Sk,[F(Pl),F(Ml)])]),F(y(Dn),{class:"h-[calc(100%-38px)] w-full bg-comfy-menu-secondary-bg",pt:{gutter:{class:"bg-transparent w-4 -mx-3"}}},{default:E(()=>[F(y($t),{size:1,class:"min-w-min bg-comfy-menu-bg"},{default:E(()=>[c("div",_k,[F(ms,{extension:y(fu)()},null,8,["extension"])])]),_:1}),F(y($t),{size:98,class:"flex flex-row overflow-y-auto flex-wrap min-w-min gap-4 m-4"},{default:E(()=>[(d(!0),T(ne,null,be(y(o).latestOutput,p=>(d(),T("img",{key:p,class:"pointer-events-none object-contain flex-1 max-h-full",src:p},null,8,Tk))),128)),y(o).latestOutput.length===0?(d(),T("img",$k)):V("",!0)]),_:1}),F(y($t),{size:1,class:"flex flex-col gap-1 p-1 min-w-min"},{default:E(()=>[c("div",Nk,[F(X,{variant:"secondary",onClick:f},{default:E(()=>[$e(R(y(ce)("g.feedback")),1)]),_:1}),F(X,{variant:"secondary",class:"min-w-max",onClick:v[0]||(v[0]=p=>y(me)().linearMode=!1)},{default:E(()=>[$e(R(y(ce)("linearMode.openWorkflow"))+" ",1),v[3]||(v[3]=c("i",{class:"icon-[comfy--workflow]"},null,-1))]),_:1}),F(X,{variant:"inverted",onClick:v[1]||(v[1]=p=>y(Xe)().exportWorkflow("workflow","workflow"))},{default:E(()=>[$e(R(y(ce)("linearMode.share")),1)]),_:1}),y(a)?(d(),U(wl,{key:0})):y(l)?(d(),U(kl,{key:1})):V("",!0)]),c("div",Ik,[c("div",Mk,[(d(!0),T(ne,null,be(s.value,p=>(d(),U(cl,{key:p.id,"node-data":p,class:"border-b-1 border-node-component-border pt-1 pb-2 last:border-none"},null,8,["node-data"]))),128))]),c("div",Pk,[F(_u,{modelValue:y(r),"onUpdate:modelValue":v[2]||(v[2]=p=>it(r)?r.value=p:null),widget:i,class:"*:[.min-w-56]:basis-0"},null,8,["modelValue"]),F(X,{class:"w-full mt-4",onClick:u},{default:E(()=>[v[4]||(v[4]=c("i",{class:"icon-[lucide--play]"},null,-1)),$e(" "+R(y(ce)("menu.run")),1)]),_:1})])])]),_:1})]),_:1})]))}}),Ak={key:0,class:"flex items-center px-4 py-2"},Lk={class:"flex w-full items-center justify-between py-2"},Ek={class:"flex flex-col text-sm leading-normal font-medium"},Ok={class:"text-muted"},Vk={class:"h-full"},Rk={class:"break-words whitespace-pre-wrap"},Wk={class:"flex w-full items-center justify-between px-6 py-2 shadow-lg"},zk={class:"flex items-center text-base leading-none"},Bk={class:"flex items-center"},Fk={class:"flex items-center gap-4"},Uk={key:0,class:"text-sm text-muted-foreground"},Gk={class:"flex items-center"},jk=q({__name:"ManagerProgressToast",setup(e){const{t:o}=pe(),t=gu(),s=ue(),{runFullConflictAnalysis:a}=sl(),l=L(!1),i=L(0),r=h(()=>[{label:o("manager.installationQueue")},{label:o("manager.failed",{count:t.failedTasksIds.length})}]),u=h(()=>i.value===0?t.succeededTasksLogs:t.failedTasksLogs),f=h(()=>t.taskLogs.length>0),m=L(!1),v=L(!1),p=h(()=>t.isProcessingTasks||m.value),w=n(G=>{const H=u.value[G];if(!H)return!1;const K=t.taskQueue;return K?[...K.running_queue||[],...K.pending_queue||[]].some(ie=>ie.ui_id===H.taskId):!1},"isTaskInProgress"),k=h(()=>t.succeededTasksIds.length+t.failedTasksIds.length),g=h(()=>{const G=Object.keys(t.taskHistory).length,H=t.taskQueue,K=H?(H.running_queue?.length||0)+(H.pending_queue?.length||0):0;return G+K}),b=h(()=>m.value?o("manager.restartingBackend"):v.value?o("manager.extensionsSuccessfullyInstalled"):t.taskLogs.length?t.taskLogs.at(-1)?.taskName??o("manager.installingDependencies"):o("manager.installingDependencies")),S=L({});function _(G){S.value[G]=!S.value[G]}n(_,"togglePanel");const C=L(null),{y:x}=Ma(C,{eventListenerOptions:{passive:!0}}),N=L(null),M=L(!1),$=h(()=>u.value?.at(-1)?.logs);function I(G){return G?Math.abs(G.scrollHeight-G.scrollTop-G.clientHeight)<20:!1}n(I,"isAtBottom");function P(){!N.value||M.value||(N.value.scrollTop=N.value.scrollHeight)}n(P,"scrollLastPanelToBottom");function z(){x.value=C.value?.scrollHeight??0}n(z,"scrollContentToBottom");function j(){M.value=!1}n(j,"resetUserScrolling");function D(G){const H=G.target;H===N.value&&(M.value=!I(H))}n(D,"handleScroll");function A(){M.value||P()}n(A,"onLogsAdded"),_t($,A,{flush:"post",deep:!0}),_t(()=>l.value,z),_t(()=>!l.value,j);function B(){t.resetTaskState(),l.value=!1}n(B,"closeToast");async function W(){const G=s.get("Comfy.Toast.DisableReconnectingToast");try{await s.set("Comfy.Toast.DisableReconnectingToast",!0),m.value=!0,Ae(Se,"reconnected",n(async()=>{try{t.setStale(),await _e().execute("Comfy.RefreshNodeDefinitions"),await Xe().reloadCurrentWorkflow(),a()}finally{await s.set("Comfy.Toast.DisableReconnectingToast",G),m.value=!1,v.value=!0,setTimeout(()=>{B()},3e3)}},"onReconnect"),{once:!0}),await ol().rebootComfyUI()}catch(H){throw await s.set("Comfy.Toast.DisableReconnectingToast",G),m.value=!1,v.value=!1,B(),H}}return n(W,"handleRestart"),Ve(()=>{z()}),rt(()=>{l.value=!1}),(G,H)=>(d(),U(Vl,{expanded:l.value,"onUpdate:expanded":H[1]||(H[1]=K=>l.value=K),visible:f.value},{default:E(()=>[l.value?(d(),T("div",Ak,[F(y(xi),{"active-index":i.value,"onUpdate:activeIndex":H[0]||(H[0]=K=>i.value=K),model:r.value,class:"w-full border-none",pt:{menu:{class:"border-none"},menuitem:{class:"font-medium"},action:{class:"px-4 py-2"}}},null,8,["active-index","model"])])):V("",!0),c("div",{ref_key:"sectionsContainerRef",ref:C,class:"scroll-container max-h-[450px] overflow-y-auto px-6 py-4",style:{scrollbarWidth:"thin",scrollbarColor:"rgba(156, 163, 175, 0.5) transparent"}},[(d(!0),T(ne,null,be(u.value,(K,ee)=>(d(),T("div",{key:ee},[F(y(Qn),{expanded:S.value[ee]===!0,toggleable:"",class:"shadow-elevation-1 mt-2 rounded-lg"},{header:E(()=>[c("div",Lk,[c("div",Ek,[c("span",null,R(K.taskName),1),c("span",Ok,R(w(ee)?y(o)("g.inProgress"):y(o)("g.completed")+" "),1)])])]),toggleicon:E(()=>[F(X,{variant:"textonly",class:"text-neutral-300",onClick:n(ie=>_(ee),"onClick")},{default:E(()=>[c("i",{class:Q(S.value[ee]?"pi pi-chevron-right":"pi pi-chevron-down")},null,2)]),_:2},1032,["onClick"])]),default:E(()=>[c("div",{ref_for:!0,ref:ee===u.value.length-1?ie=>N.value=ie:void 0,class:Q(["h-64 overflow-y-auto rounded-lg bg-black",{"h-64":ee!==u.value.length-1,grow:ee===u.value.length-1}]),onScroll:D},[c("div",Vk,[(d(!0),T(ne,null,be(K.logs,(ie,Y)=>(d(),T("div",{key:Y,class:"text-muted"},[c("pre",Rk,R(ie),1)]))),128))])],34)]),_:2},1032,["expanded"])]))),128))],512)]),footer:E(({toggle:K})=>[c("div",Wk,[c("div",zk,[c("div",Bk,[p.value?(d(),T(ne,{key:0},[F(vu,{duration:"1s",class:"mr-2"}),c("span",null,R(b.value),1)],64)):v.value?(d(),T(ne,{key:1},[H[2]||(H[2]=c("span",{class:"mr-2"},"",-1)),c("span",null,R(b.value),1)],64)):(d(),T(ne,{key:2},[H[3]||(H[3]=c("span",{class:"mr-2"},"",-1)),c("span",null,R(y(o)("manager.restartToApplyChanges")),1)],64))])]),c("div",Fk,[p.value?(d(),T("span",Uk,R(k.value)+" "+R(y(o)("g.progressCountOf"))+" "+R(g.value),1)):V("",!0),c("div",Gk,[!p.value&&!v.value?(d(),U(X,{key:0,variant:"secondary",class:"mr-4 rounded-full border-2 border-base-foreground px-3 text-base-foreground hover:bg-secondary-background-hover",onClick:W},{default:E(()=>[$e(R(y(o)("manager.applyChanges")),1)]),_:1})):v.value?V("",!0):(d(),U(X,{key:1,variant:"muted-textonly",size:"sm",class:"rounded-full font-bold","aria-label":y(o)(l.value?"contextMenu.Collapse":"contextMenu.Expand"),onClick:Ce(K,["stop"])},{default:E(()=>[c("i",{class:Q(l.value?"pi pi-chevron-up":"pi pi-chevron-down")},null,2)]),_:2},1032,["aria-label","onClick"])),F(X,{variant:"muted-textonly",size:"sm",class:"rounded-full font-bold","aria-label":y(o)("g.close"),onClick:Ce(B,["stop"])},{default:E(()=>H[4]||(H[4]=[c("i",{class:"pi pi-times"},null,-1)])),_:1},8,["aria-label"])])])])]),_:1},8,["expanded","visible"]))}}),Hk={class:"comfyui-body grid h-full w-full overflow-hidden"},qk=q({__name:"GraphView",setup(e){kk(),j1(),P1();const{t:o}=pe(),t=Bt(),s=ue(),a=Ze(),l=ct(),i=Tt(),r=Xn(),u=Rl(),f=L(null),{linearMode:m}=Fe(me());Ka(),ae(()=>l.completedActivePalette,$=>{const I="dark-theme";$.light_theme?document.body.classList.remove(I):document.body.classList.add(I),Ge()&&bo().changeTheme({color:"rgba(0, 0, 0, 0)",symbolColor:$.colors.comfy_base["input-text"]})},{immediate:!0}),Ge()&&ae(()=>i.tasks,($,I)=>{const P=new Set(I.filter(z=>z.isRunning).map(z=>z.promptId));$.filter(z=>P.has(z.promptId)&&z.isHistory).forEach(z=>{bo().Events.incrementUserProperty(`execution:${z.displayStatus.toLowerCase()}`,1),bo().Events.trackEvent("execution",{status:z.displayStatus.toLowerCase()})})},{deep:!0}),ke(()=>{const $=s.get("Comfy.TextareaWidget.FontSize");document.documentElement.style.setProperty("--comfy-textarea-font-size",`${$}px`)}),ke(()=>{const $=s.get("Comfy.TreeExplorer.ItemPadding");document.documentElement.style.setProperty("--comfy-tree-explorer-item-padding",`${$}px`)}),ke(async()=>{const $=s.get("Comfy.Locale");if($)try{await hu($),Fa.global.locale.value=$}catch(I){console.error(`Failed to switch to locale "${$}":`,I)}});const v=h(()=>s.get("Comfy.UseNewMenu"));ke(()=>{v.value==="Disabled"?(J.ui.menuContainer.style.setProperty("display","block"),J.ui.restoreMenuPosition()):J.ui.menuContainer.style.setProperty("display","none")}),ke(()=>{i.maxHistoryItems=s.get("Comfy.Queue.MaxHistoryItems")});const p=n(()=>{const $=G1();_e().registerCommands($),el().registerCoreMenuCommands(),yn().registerCoreKeybindings(),Ho().registerCoreSidebarTabs(),ao().registerCoreBottomPanelTabs(),J.extensionManager=ot()},"init"),w=dl(),k=Ho(),g=n(async $=>{w.update($),await i.update(),k.activeSidebarTabId==="assets"&&await r.updateHistory()},"onStatus"),b=n(async()=>{await i.update(),k.activeSidebarTabId==="assets"&&await r.updateHistory()},"onExecutionSuccess"),S={severity:"error",summary:o("g.reconnecting")},_=n(()=>{s.get("Comfy.Toast.DisableReconnectingToast")||(t.remove(S),t.add(S))},"onReconnecting"),C=n(()=>{s.get("Comfy.Toast.DisableReconnectingToast")||(t.remove(S),t.add({severity:"success",summary:o("g.reconnected"),life:2e3}))},"onReconnected");Ve(()=>{Se.addEventListener("status",g),Se.addEventListener("execution_success",b),Se.addEventListener("reconnecting",_),Se.addEventListener("reconnected",C),a.bindExecutionEvents();try{p(),f.value?.prepend(J.ui.menuContainer)}catch($){console.error("Failed to init ComfyUI frontend",$)}}),rt(()=>{Se.removeEventListener("status",g),Se.removeEventListener("execution_success",b),Se.removeEventListener("reconnecting",_),Se.removeEventListener("reconnected",C),a.unbindExecutionEvents()}),Ae(window,"keydown",yn().keybindHandler);const{wrapWithErrorHandling:x,wrapWithErrorHandlingAsync:N}=Ft();wk({immediate:!0}),Re(()=>{u.initialize().catch($=>{console.warn("Version compatibility check failed:",$)})});const M=n(()=>{hl(()=>{x(yn().registerUserKeybindings)(),x(Su().loadServerConfig)(H1,s.get("Comfy.Server.ServerConfigValues")),N(yu().loadModelFolders)(),N(rs().loadNodeFrequencies)(),ht().nodeSearchService.searchNode("")},1e3)},"onGraphReady");return($,I)=>(d(),T(ne,null,[c("div",Hk,[I[0]||(I[0]=c("div",{id:"comfyui-body-top",class:"comfyui-body-top"},null,-1)),I[1]||(I[1]=c("div",{id:"comfyui-body-bottom",class:"comfyui-body-bottom"},null,-1)),I[2]||(I[2]=c("div",{id:"comfyui-body-left",class:"comfyui-body-left"},null,-1)),I[3]||(I[3]=c("div",{id:"comfyui-body-right",class:"comfyui-body-right"},null,-1)),de(c("div",{id:"graph-canvas-container",ref_key:"graphCanvasContainerRef",ref:f,class:"graph-canvas-container"},[F(T1,{onReady:M})],512),[[Qe,!y(m)]]),y(m)?(d(),U(Dk,{key:0})):V("",!0)]),F(cd),F(I1),F(yk),F(jk),y(Ge)()?V("",!0):(d(),U(fd,{key:0})),F(pd)],64))}}),Kk=Ee(qk,[["__scopeId","data-v-5229bbd8"]]),lC=Object.freeze(Object.defineProperty({__proto__:null,default:Kk},Symbol.toStringTag,{value:"Module"}));export{lC as G,ad as _,rd as a,xd as g};
//# sourceMappingURL=GraphView-Bm6waOtx.js.map
