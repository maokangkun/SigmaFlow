{"version":3,"mappings":"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","names":["getCategoryIcon","__name","categoryId","useWorkflowTemplatesStore","defineStore","customTemplates","shallowRef","coreTemplates","englishTemplates","isLoaded","ref","knownTemplateNames","getTemplateByName","name","enhancedTemplates","template","categoryFilters","addLocalizedFieldsToTemplate","categoryTitle","st","normalizeI18nKey","localizeTemplateList","templates","localizeTemplateCategory","templateCategory","createAllCategory","coreTemplatesWithSourceModule","category","customTemplatesWithSourceModule","moduleName","groupedTemplates","computed","allTemplates","t","enhancedTemplate","templateFuse","fuseOptions","Fuse","filterTemplatesByCategory","filter","navGroupedTemplates","items","gettingStartedText","essentialCat","cat","hasEssentialCategories","categoryGroups","categoryGroup","categoryIcon","group","groupName","word","extensionItems","loadWorkflowTemplates","api","locale","i18n","coreResult","englishResult","isCloud","coreNames","customNames","error","getEnglishMetadata","templateName","OnCloseKey","BREAKPOINTS","PANEL_SIZES","slots","useSlots","closeDialog","inject","notMobile","useBreakpoints","isLeftPanelOpen","isRightPanelOpen","mobileMenuOpen","hasRightPanel","watch","isDesktop","showLeftPanel","toggleLeftPanel","toggleRightPanel","layoutClasses","cn","rightPanelButtonClasses","closeButtonClasses","mainContainerClasses","headerClasses","rightAreaClasses","contentContainerClasses","rightPanelClasses","emit","__emit","isCollapsed","__props","value","toggleCollapse","_hoisted_1","_hoisted_2","_sfc_render","_ctx","_cache","_openBlock","_createElementBlock","_createElementVNode","_hoisted_3","collapsedGroups","getFirstItemId","firstEntry","activeItem","useFeatureFlags","flags","reactive","featureFlag","featurePath","defaultValue","readonly","usePopoverSizing","options","minWidth","maxWidth","style","selectedItems","_useModel","searchQuery","useI18n","selectedCount","popoverStyle","attrs","useAttrs","originalOptions","results","useFuse","filteredOptions","searchResults","result","item","selectedItem","getLabel","val","found","o","optionStyle","styles","useAssetFilterOptions","assets","availableFileFormats","extensions","toValue","asset","extension","uniqWith","a","b","format","availableBaseModels","models","baseModel","model","fileFormats","baseModels","sortBy","sortOptions","containerClasses","leftSideClasses","rightSideClasses","selectClasses","handleFilterChange","option","props","settingStore","useSettingStore","titleId","useId","descId","tooltipDelay","useImage","shouldShowImage","cardClasses","base","elementProps","createGridStyle","padding","gap","columns","gridStyle","getAssetDescription","getAssetBaseModel","filterByCategory","filterByFileFormats","formats","formatSet","filterByBaseModels","modelSet","useAssetBrowser","assetsSource","selectedCategory","filters","transformAssetForDisplay","typeTag","tag","description","badges","stats","d","availableCategories","categories","uniqueCategories","contentTitle","categoryFilteredAssets","fuseResults","searchFiltered","filteredAssets","sortedAssets","updateFilters","newFilters","ACRONYM_TAGS","formatCategoryLabel","raw","segment","upper","lower","provide","fetchAssets","assetService","fetchedAssets","isLoading","execute","useAsyncState","modelToNodeStore","useModelToNodeStore","primaryCategoryTag","tagFromAssets","mapped","activeCategoryTag","displayTitle","label","shouldShowLeftPanel","handleClose","handleAssetSelectAndEmit","isUploadButtonEnabled","handleUploadClick","dialogComponentProps","useAssetBrowserDialog","dialogStore","useDialogStore","dialogKey","show","handleAssetSelected","AssetBrowserModal","browse","nodeOutputStore","useNodeOutputStore","currentIndex","isHovered","actualDimensions","videoError","currentVideoUrl","hasMultipleVideos","newUrls","handleVideoLoad","event","video","handleVideoError","handleDownload","downloadFile","useToast","handleRemove","setCurrentIndex","index","handleMouseEnter","handleMouseLeave","getNavigationDotClass","handleKeyDown","getVideoFilename","url","actionButtonClass","commandStore","useCommandStore","imageError","currentImageEl","currentImageUrl","hasMultipleImages","imageAltText","handleImageLoad","img","handleImageError","setupNodeForMaskEditor","node","app","handleEditMask","getImageFilename","hasMedia","nodeId","renderError","toastErrorHandler","useErrorHandling","onErrorCaptured","clickableClasses","popover","togglePopover","variant","menuBackgroundStyle","labelClasses","textClasses","iconColorClass","iconClass","dotClasses","popoverPt","POLL_INTERVAL_MS","MAX_POLL_DURATION_MS","rootClass","subscribe","isActiveSubscription","fetchStatus","useSubscription","telemetry","useTelemetry","isPolling","pollInterval","startPollingSubscriptionStatus","startTime","poll","stopPolling","handleSubscribe","onBeforeUnmount","toast","toastStore","useToastStore","newMessages","message","messagesToRemove","requested","updateToastPosition","styleElement","createStyleElement","rect","nextTick","_runWhenIdle","runWhenGlobalIdle","safeGlobal","_targetWindow","runner","_timeout","disposed","end","targetWindow","timeout","handle","workspaceState","useWorkspaceStore","exitFocusMode","watchEffect","workflowStore","useWorkflowStore","handleBeforeUnload","onMounted","sidebarLocation","unifiedWidth","sidebarPanelVisible","useSidebarTabStore","bottomPanelVisible","useBottomPanelStore","activeSidebarTabId","sidebarStateKey","ComfyRunButton","defineAsyncComponent","__vitePreload","settingsStore","position","visible","tabContainer","panelRef","dragHandleRef","isDocked","useLocalStorage","storedPosition","x","y","isDragging","useDraggable","minY","watchDebounced","newX","newY","setInitialPosition","screenWidth","screenHeight","menuWidth","menuHeight","clamp","captureLastDragState","newVisible","useEventListener","lastDragState","newIsDragging","distanceLeft","distanceRight","distanceTop","distanceBottom","closestEdge","min","curr","verticalRatio","horizontalRatio","isMouseOverDropZone","onMouseEnterDropZone","onMouseLeaveDropZone","dragging","actionbarClass","panelClass","menu","dialogService","useDialogService","workflowService","useWorkflowService","isEditing","itemLabel","itemInputRef","wrapperRef","rename","newName","initialName","ComfyWorkflow","appendJsonExt","navigationStore","useSubgraphNavigationStore","isRoot","menuItems","startRename","handleClick","inputBlur","doRename","useOverflowObserver","element","isOverflowing","disposeFns","checkOverflowFn","checkOverflow","debounce","useMutationObserver","useResizeObserver","fn","MIN_WIDTH","ITEM_GAP","ITEM_PADDING","ICON_WIDTH","breadcrumbRef","workflowName","isBlueprint","useSubgraphStore","collapseTabs","overflowingTabs","breadcrumbElement","subgraph","canvas","useCanvasStore","title","rootGraph","forEachSubgraphNode","home","overflowObserver","el","itemsWithIcon","separators","separatorWidth","itemsWidth","separatorsWidth","gapsWidth","totalWidth","containerWidth","onUpdated","useActionBarButtonStore","extensionStore","useExtensionStore","e","actionBarButtonStore","buildDocsUrl","useExternalLink","planSettingsLabel","userDisplayName","userEmail","userPhotoUrl","handleSignOut","useCurrentUser","authActions","useFirebaseAuthActions","handleOpenUserSettings","handleOpenPlanAndCreditsSettings","handleTopUp","handleOpenPartnerNodesInfo","handleLogout","handleSubscribed","isLoggedIn","photoURL","closePopover","handleSignIn","apiNodesOverviewUrl","popoverRef","hideTimeout","showTimeout","showPopover","cancelHidePopover","hidePopover","workspaceStore","isElectron","legacyCommandsContainerRef","mountCustomExtension","bottomPanelStore","isShortcutsTabActive","activeTabId","shouldCapitalizeTab","tabId","getTabDisplayTitle","tab","openKeybindingSettings","closeBottomPanel","useAbsolutePosition","useTransform","lgCanvas","canvasPosToClientPos","updateCanvasPosition","useCanvasPositionConversion","computeStyle","pos","size","scale","left","top","width","height","config","intersect","x1","y1","x2","y2","useDomClipping","margin","calculateClipPath","elementRect","canvasRect","isSelected","selectedArea","offset","intersection","clipX","clipY","clipWidth","clipHeight","canvasElement","clipPath","widget","widgetElement","positionStyle","updatePosition","clippingStyle","updateClipPath","canvasStore","enableDomClipping","updateDomClipping","selectedNode","renderArea","selectedAreaConfig","useElementBounding","widgetState","_","__","oldVisible","isDOMWidget","tooltip","mountElementIfVisible","domWidgetStore","useDomWidgetStore","widgetStates","updateWidgets","lowQuality","currentGraph","isInCorrectGraph","whenever","useChainCallback","useZoomControls","isModalVisible","showModal","hideModal","toggleModal","hasActivePopup","useMinimapGraph","graph","onGraphChanged","nodeStatesCache","linksCache","lastNodeCount","updateFlags","layoutStoreVersion","layoutStore","originalCallbacksMap","handleGraphChangedThrottled","useThrottleFn","setupEventListeners","g","originalCallbacks","cleanupEventListeners","oldGraph","structureChanged","positionChanged","connectionChanged","dataSource","MinimapDataSourceFactory","currentNodeCount","nodes","currentState","currentNodeIds","n","currentLinks","useMinimapInteraction","containerRef","bounds","centerViewOn","containerRect","updateContainerRect","handlePointerDown","target","handlePointerMove","offsetX","offsetY","worldX","worldY","releasePointer","c","ds","delta","newScale","useMinimapRenderer","canvasRef","settings","needsFullRedraw","needsBoundsUpdate","renderMinimap","ctx","renderMinimapToCanvas","updateBounds","updateViewport","useMinimapSettings","colorPaletteStore","useColorPaletteStore","nodeColors","showLinks","showGroups","renderBypass","isLightTheme","containerStyles","panelStyles","useMinimapViewport","viewportTransform","canvasDimensions","updateCanvasDimensions","canvasEl","dpr","calculateGraphBounds","sourceBounds","enforceMinimumBounds","calculateScale","calculateMinimapScale","viewportWidth","viewportHeight","centerOffsetX","centerOffsetY","startViewportSync","stopViewportSync","useRafFn","useMinimap","minimapRef","initialized","updateOption","key","renderer","viewport","interaction","graphManager","pauseChangeDetection","resumeChangeDetection","init","destroy","newCanvas","oldCanvas","newGraph","isVisible","toggle","setMinimapRef","viewportStyles","transform","buttonRef","isCanvasReadOnly","currentModeIcon","unlockCommandText","lockCommandText","setMode","mode","minimap","formatKeySequence","interval","applyZoom","inputValue","executeCommand","command","startRepeat","cmd","stopRepeat","filteredMinimapStyles","zoomInCommandText","zoomOutCommandText","zoomToFitCommandText","zoomInput","zoomInputContainer","newVal","canvasInteractions","useCanvasInteractions","stringifiedMinimapStyles","buttonGroupKeys","buttonKeys","additionalButtonStyles","buttonStyles","buttonGroupStyles","acc","linkHidden","LiteGraph","fitViewCommandText","minimapCommandText","zoomButtonClass","minimapButtonClass","fitViewTooltip","shortcut","minimapTooltip","linkVisibilityTooltip","linkVisibilityAriaLabel","linkVisibleClass","onMinimapToggleClick","onLinkVisibilityToggleClick","idleTimeout","nodeDefStore","useNodeDefStore","tooltipRef","tooltipText","hideTooltip","showTooltip","comfyApp","onIdle","ctor","nodeDef","inputSlot","isOverNodeInput","inputName","translatedTooltip","outputSlot","isOverNodeOutput","toggleBypass","toLightThemeColor","color","adjustColor","showColorPicker","NO_COLOR_OPTION","colorOptions","LGraphCanvas","selectedColorOption","applyColor","colorOption","colorName","canvasColorOption","isColorable","currentColorOption","currentColor","localizedCurrentColorName","updateColorSelectionFromNode","newSelectedItems","getItemsColorOption","useSelectionState","sidebarTabStore","nodeHelpStore","useNodeHelpStore","nodeLibraryTabId","useNodeLibrarySidebarTab","storeToRefs","selectedNodes","i","isLGraphNode","hasAnySelection","hasSingleSelection","hasMultipleSelection","isSingleNode","isSingleSubgraph","isSingleImageNode","isImageNode","hasSubgraphs","SubgraphNode","hasAny3DNodeSelected","enable3DViewer","isLoad3dNode","hasImageNode","hasOutputNodesSelected","filterOutputNodes","computeSelectionStatesFromNodes","LGraphEventMode","selectedNodesStates","def","isSidebarActive","currentHelpNode","isUnpackVisible","isConvertVisible","isDeletable","buttonHovered","selectedOutputNodes","isOutputNode","outputNodeStokeStyle","toggleHelp","onInfoClick","open3DViewer","openMaskEditor","isRefreshableWidget","useRefreshableSelection","graphStore","refreshableWidgets","isRefreshable","refreshSelected","moreOptionsOpen","forceCloseMoreOptionsSignal","restoreMoreOptionsSignal","moreOptionsRestorePending","moreOptionsWasOpenBeforeDrag","moreOptionsSelectionSignature","buildSelectionSignature","store","isLGraphGroup","currentSelectionMatchesSignature","useSelectionToolboxPosition","toolboxRef","getSelectableItems","useSelectedLiteGraphItems","shouldRenderVueNodes","useVueFeatureFlags","worldPosition","canvasLeft","canvasTop","updateSelectionBounds","selectableItems","allBounds","layout","LGraphNode","LGraphGroup","unionBounds","computeUnionBounds","updateTransform","screenX","screenY","startSync","stopSync","changed","v","handleDragStateChange","handleDragStart","handleDragEnd","selectionMatches","shouldRestore","litegraphDragging","vueNodeDragging","onUnmounted","resetMoreOptionsState","useFrameNodes","titleEditorStore","useTitleEditorStore","canFrame","frameNodes","useCanvasRefresh","useNodeCustomization","canvasRefresh","shapeOptions","RenderShape","shapeOption","firstColorableItem","currentBgColor","currentShape","useGroupMenuOptions","groupContext","bump","shape","groupNodes","allSame","createModeAction","useImageMenuOptions","openImage","copyImage","blob","resolve","saveImage","useSelectedNodeActions","getSelectedNodes","toggleSelectedNodesMode","optimalSize","useNodeMenuOptions","applyShape","adjustNodeSize","toggleNodeCollapse","toggleNodePin","toggleNodeBypass","runBranch","shapeSubmenu","colorSubmenu","showNodeHelp","states","useNodeArrangement","alignOptions","distributeOptions","alignOption","newPositions","alignNodes","distributeOption","distributeNodes","useSelectionOperations","currentTitle","newTitle","titledItem","baseTitle","useSubgraphOperations","nodeBookmarkStore","useNodeBookmarkStore","convertToSubgraph","res","subgraphNodes","subgraphNode","useSelectionMenuOptions","copySelection","duplicateSelection","deleteSelection","renameSelection","applyAlign","applyDistribute","unpackSubgraph","addSubgraphToLibrary","alignSubmenu","align","distributeSubmenu","distribute","BadgeVariant","convertToGroupNodes","nodeOptionsInstance","toggleNodeOptions","clickedFromToolbox","registerNodeOptionsInstance","instance","useMoreOptionsMenu","hasSubgraphsComputed","computeSelectionFlags","getImageMenuOptions","getNodeInfoOption","getAdjustSizeOption","getNodeVisualOptions","getPinOption","getBypassOption","getRunBranchOption","getFitGroupToNodesOption","getGroupShapeOptions","getGroupColorOptions","getGroupModeOptions","getBasicSelectionOptions","getSubgraphOptions","getMultipleNodesOptions","getDeleteOption","getAlignmentOptions","hasMultipleNodes","optionsVersion","menuOptions","selectedGroups","hasSubgraphsSelected","menuOptionsWithSubmenu","buttonEl","extensionService","useExtensionService","extensionToolboxCommands","commandIds","commandId","showInfoButton","showConvertToSubgraph","showFrameNodes","showSubgraphButtons","showBypass","showLoad3DViewer","showMaskEditor","showDelete","showRefresh","showExecute","showAnyPrimaryActions","showAnyControlActions","showInput","editedTitle","inputPositionStyle","inputFontStyle","inputStyle","previousCanvasDraggable","onEdit","newValue","trimmedTitle","useSubmenuPositioning","toggleSubmenu","submenu","currentSubmenu","submenuRefs","isCurrentlyOpen","opt","sm","menuItem","menuItemRect","mainPopoverContent","mainPopoverRect","tempTarget","createPositionedTarget","tempEvent","createMouseEvent","cleanupTempTarget","id","clientX","clientY","delay","getCurrentShape","__expose","handleSubmenuClick","subOption","isShapeSelected","isColorSubmenu","targetElement","isTriggeredByToolbox","isOpen","wasOpenBeforeHide","lastProgrammaticHideReason","hideAllSubmenus","overlayElCache","resolveOverlayEl","direct","btn","candidates","best","r","dist","repositionPopover","overlayEl","marginY","openPopover","triggerEvent","reason","hideAll","restoreAttempts","attemptRestore","hide","handleOptionClick","submenuKey","setSubmenuRef","onPopoverShow","onPopoverHide","useSearchBoxStore","useMouse","newSearchBoxEnabled","setPopoverRef","toggleVisible","_sfc_main","AutoComplete","inputEl","oldVal","showCategory","showIdName","showNodeFrequency","nodeFrequencyStore","useNodeFrequencyStore","nodeFrequency","isBookmarked","enableNodePreview","autoCompletePlus","nodeSearchFilterVisible","inputId","suggestions","hoveredSuggestion","currentQuery","placeholder","debouncedTrackSearch","query","search","queryIsEmpty","onAddNode","inputElement","reFocusInput","onAddFilter","filterAndValue","onRemoveFilter","setHoverSuggestion","listenerController","disconnectOnReset","searchBoxStore","litegraphService","useLitegraphService","dismissable","getNewNodeLocation","nodeFilters","addFilter","removeFilter","f","toRaw","clearFilters","addNode","showSearchBox","showNewSearchBox","getFirstLink","firstLink","dataType","showContextMenu","fromSlot","toType","commonOptions","cancelResetOnContextClose","afterRerouteId","connectionOptions","signal","createEvent","reset","handleDroppedOnCanvas","canvasEventHandler","linkReleaseAction","linkReleaseActionShift","preventDefault","cancelNextReset","LinkReleaseTriggerAction","attributes","contentRef","SLIDER_START_POSITION","isVideoType","sliderPosition","elementX","elementWidth","isOutside","useMouseInElement","outside","baseImageClass","overlayImageClass","baseClasses","sizeClasses","opacityClasses","useLazyPagination","itemsPerPage","initialPage","currentPage","loadedPages","itemsArray","itemData","paginatedItems","loadedPageNumbers","endIndex","hasMoreItems","loadedPagesArray","totalPages","loadNextPage","nextPage","newLoadedPages","length","useTemplateFiltering","selectedModels","selectedUseCases","selectedRunsOn","templatesArray","templateData","fuse","availableModels","availableUseCases","tagSet","availableRunsOn","debouncedSearchQuery","refDebounced","filteredBySearch","filteredByModels","selectedModel","filteredByUseCases","selectedTag","filteredByRunsOn","isExternalAPI","isComfyUI","getVramMetric","sortedTemplates","nameA","nameB","dateA","vramA","vramB","sizeA","sizeB","filteredTemplates","resetFilters","removeModelFilter","m","removeUseCaseFilter","removeRunsOnFilter","runsOn","filteredCount","totalCount","debouncedTrackFilterChange","useTemplateWorkflows","workflowTemplatesStore","selectedTemplate","loadingTemplateId","isTemplatesLoaded","allTemplateGroups","loadTemplates","selectFirstTemplateCategory","firstCategory","selectTemplateCategory","getTemplateThumbnailUrl","sourceModule","basePath","indexSuffix","getTemplateTitle","fallback","getTemplateDescription","loadWorkflowTemplate","json","actualSourceModule","fetchTemplateJson","sessionStartTime","templateWasSelected","onClose","getEffectiveSourceModule","getBaseThumbnailSrc","getOverlayThumbnailSrc","openTutorial","navItems","navigationFilteredTemplates","selectedNavItem","selectedModelObjects","selectedUseCaseObjects","useCase","selectedRunsOnObjects","loadingTemplate","hoveredTemplate","cardRefs","templateListKey","modelSearchText","modelOptions","useCaseOptions","runsOnOptions","modelFilterLabel","useCaseFilterLabel","runsOnFilterLabel","loadTrigger","shouldUsePagination","paginatedTemplates","isLoadingMore","hasMoreTemplates","resetPagination","displayTemplates","useIntersectionObserver","onLoadWorkflow","pageTitle","navItem","sub","DIALOG_KEY","useWorkflowTemplateSelectorDialog","source","WorkflowTemplateSelectorDialog","whileMouseDown","elementOrEvent","callback","iteration","intervalId","dispose","disposeGlobal","disposeLocal","menuItemStore","useMenuItemStore","colorPaletteService","useColorPaletteService","managerState","useManagerState","menuRef","menuButtonRef","nodes2Enabled","onLogoMenuClick","translateMenuItem","translatedLabel","showSettings","defaultPanel","SettingDialogHeader","SettingDialogContent","showManageExtensions","ManagerTab","themeMenuItems","palette","extraMenuItems","translatedItems","helpIndex","helpItem","isLastItem","onMenuShow","isZoomCommand","handleZoomMouseDown","handleItemClick","hasActiveStateSiblings","handleNodes2ToggleClick","onNodes2ToggleChange","overlayValue","shouldShowBadge","computedTooltip","toggleConsole","isShortcutsPanelVisible","toggleShortcutsPanel","releaseApiClient","axios","getComfyApiBaseUrl","useReleaseService","handleApiError","err","context","routeSpecificErrors","axiosError","status","data","executeApiRequest","apiCall","errorContext","isAbortError","params","endpoint","useReleaseStore","releases","releaseService","systemStatsStore","useSystemStatsStore","currentComfyUIVersion","releaseVersion","releaseStatus","releaseTimestamp","showVersionUpdates","recentRelease","recentReleases","THREE_DAYS_MS","isNewVersionAvailable","compare","isLatestVersion","hasMediumOrHighAttention","attention","shouldShowToast","shouldShowRedDot","version","shouldShowPopup","handleSkipRelease","handleShowChangelog","handleWhatsNewSeen","fetchReleases","until","fetchedReleases","stringToLocale","initialize","TIME_UNITS","SUBMENU_CONFIG","staticUrls","releaseStore","isSubmenuVisible","submenuRef","submenuStyle","hoverTimeout","openedAt","hasReleases","shouldShowManagerRedDot","useConflictAcknowledgment","moreItems","openExternalLink","openDevTools","onReinstall","hasVisibleMoreItems","moreMenuItem","PuzzleIcon","clearHoverTimeout","calculateSubmenuPosition","button","submenuWidth","estimatedHeight","submenuHeight","formatReleaseDate","dateString","date","diffTime","timeUnits","unit","suffix","shouldShowUpdateButton","release","onMenuItemHover","moreButton","onMenuItemLeave","onSubmenuHover","onSubmenuLeave","electronAPI","onReleaseClick","versionAnchor","formatVersionAnchor","changelogUrl","onUpdate","isDismissed","latestRelease","shouldShow","changelogBaseUrl","hideTimer","startAutoHide","dismissToast","clearAutoHide","handleSkip","handleLearnMore","handleUpdate","formattedContent","renderMarkdownToHtml","closePopup","useHelpCenterStore","helpCenterStore","isHelpCenterVisible","showReleaseRedDot","conflictDetection","useConflictDetection","showNodeConflictDialog","shouldShowConflictRedDot","markConflictsAsSeen","isSmall","toRefs","toggleHelpCenter","closeHelpCenter","handleWhatsNewDismissed","showConflictModal","userStore","useUserStore","logout","openTemplates","ENTER_OVERFLOW_MARGIN","EXIT_OVERFLOW_MARGIN","sideToolbarRef","contentMeasureRef","topToolbarRef","bottomToolbarRef","sidebarStyle","isConnected","selectedTab","tabs","onTabClick","keybindingStore","useKeybindingStore","getTabTooltipSuffix","keybinding","groupClasses","containerHeight","topHeight","bottomHeight","contentHeight","useTopbarBadgeStore","breakpoints","breakpointsTailwind","isXl","isLg","displayMode","topbarBadgeStore","POPOVER_WIDTH","thumbnailUrl","isActiveTab","positionRef","middle","popoverWidth","halfWidth","shift","newPos","workflowTabRef","workflowThumbnail","useWorkflowThumbnail","autoSaveSetting","autoSaveDelay","shouldShowStatusIndicator","closeWorkflows","onCloseWorkflow","tabGetter","usePragmaticDraggable","usePragmaticDroppable","fromIndex","wf","toIndex","workflow","workflowBookmarkStore","useWorkflowBookmarkStore","rightClickedTab","showOverflowArrows","leftArrowEnabled","rightArrowEnabled","workflowToOption","selectedWorkflow","onWorkflowChange","contextMenuItems","handleWheel","scrollElement","scrollAmount","scrollContent","scroll","direction","ensureActiveTabVisible","containerElement","activeTabElement","stopArrivedWatch","stopOverflowWatch","_prev","onCleanup","scrollState","useScroll","atLeft","atRight","isOverflow","useGraphNodeManager","createNode","deleteNode","setSource","useLayoutMutations","vueNodeData","nodeRefs","refreshNodeSlots","nodeRef","currentData","slotMetadata","input","updatedWidgets","slotInfo","extractVueNodeData","subgraphId","reactiveWidgets","shallowReactive","safeWidgets","reactiveComputed","spec","nodeType","apiNode","getNode","validateWidgetValue","updateVueWidgetState","widgetName","w","updatedData","createWrappedWidgetCallback","originalCallback","updateInProgress","setupNodeWidgetCallbacks","syncWithGraph","currentNodes","handleNodeAdded","initializeVueNodeLayout","nodePosition","nodeSize","LayoutSource","handleNodeRemoved","createCleanupFunction","originalOnNodeAdded","originalOnNodeRemoved","originalOnTrigger","cleanup","triggerHandlers","propertyEvent","slotErrorsEvent","slotLinksEvent","NodeSlotType","useVueNodesMigrationDismissed","createSharedComposable","useLayoutSync","unsubscribe","change","liteNode","useVueNodeLifecycleIndividual","layoutMutations","nodeManager","isVueNodeToastDismissed","hasShownMigrationToast","initializeNodeManager","activeGraph","manager","reroute","parent","linkIds","link","disposeNodeManagerAndSyncs","enabled","wasEnabled","ensureCorrectLayoutScale","vueMode","oldVueMode","useVueNodeLifecycle","getNodeBounds","nodeLeft","nodeTop","nodeRight","nodeBottom","viewportEdges","viewport_width","viewport_height","xOffset","yOffset","leftEdge","rightEdge","topEdge","bottomEdge","boundsIntersect","boxA","boxB","aLeft","aRight","aTop","aBottom","bLeft","bRight","bTop","bBottom","leftOf","rightOf","above","below","useViewportCullingIndividual","inViewport","nodeBounds","updateVisibility","nodeElements","displayValue","useViewportCulling","safePricingExecution","calculateRunwayDurationPrice","durationWidget","duration","pixversePricingCalculator","qualityWidget","motionModeWidget","quality","motionMode","byteDanceVideoPricingCalculator","modelWidget","resolutionWidget","resolution","seconds","priceByModel","modelKey","resKey","baseRange","min10s","max10s","minCost","maxCost","minStr","maxStr","ltxvPricingCalculator","modelTable","pps","SORA_SIZES","ALL_SIZES","validateSora2Selection","modelRaw","sizeRaw","perSecForSora2","formatRunPrice","perSec","sora2PricingCalculator","getWidgetValue","validationError","apiNodeCosts","numImagesWidget","turboWidget","numImages","renderingSpeedWidget","characterInput","hasCharacter","basePrice","renderingSpeed","modeWidget","modeValue","durationValue","modelValue","modality","nWidget","effectSceneWidget","effectScene","sizeWidget","basePriceRange","generateAudioWidget","generateAudio","aspectRatioWidget","lengthWidget","quadWidget","styleWidget","textureWidget","textureQualityWidget","quad","texture","textureQuality","sequentialGenerationWidget","maxImagesWidget","maxImages","resolutionStr","useNodePricing","nodeName","priceConfig","usePriceBadge","updateSubgraphCredits","isCreditsBadge","newBadges","collectCreditsBadges","getCreditsBadge","visited","badge","price","LGraphBadge","useComputedWithWidgetWatch","widgetNames","triggerCanvasRedraw","widgetValues","widgetsToObserve","currentValues","indexesToObserve","_type","computeFn","computedWithControl","useNodeBadge","priceBadge","nodeSourceBadgeMode","nodeIdBadgeMode","nodeLifeCycleBadgeMode","showApiPricingBadge","badgeTextVisible","badgeMode","NodeBadgeMode","nodePricing","BadgePosition","s","hasDynamicPricing","creditsBadge","createBadge","relevantWidgetNames","useCanvasDrop","args","loc","dndData","basePos","useSharedCanvasPositionConversion","ComfyNodeDefImpl","ComfyModelDef","nodeAtPos","targetProvider","targetGraphNode","providers","provider","useContextMenuTranslation","legacyMenuCompat","getCanvasMenuOptions","getCanvasCenterMenuOptions","newApiItems","legacyItems","nodeMenuFn","getNodeMenuOptionsWithExtensions","translateMenus","values","reInput","reWidget","cvt","tinp","twgt","te","extraInfo","matchInput","match","matchWidget","OriginalContextMenu","ContextMenu","shouldIgnoreCopyPaste","clipboardHTMLWrapper","useCopy","serializedData","useGlobalLitegraph","LGraph","LLink","DragAndScale","pasteClipboardItems","usePaste","pasteItemsOnNode","contentType","filteredItems","currentNode","isNodeSelected","isImageNodeSelected","isVideoNodeSelected","isVideoNode","isAudioNodeSelected","isAudioNode","imageNode","audioNode","videoNode","newNode","useLitegraphSettings","canvasInfoEnabled","zoomSpeed","linkRenderMode","minFontSizeForLOD","linkMarkerShape","maximumFps","dragZoomEnabled","CanvasPointer","navigationMode","leftMouseBehavior","mouseWheelScroll","CORE_SETTINGS","oldValue","LinkMarkerShape","useWorkflowAutoSave","autoSaveTimeout","isSaving","needsAutoSave","scheduleAutoSave","activeWorkflow","newSetting","useTemplateUrlLoader","route","useRoute","router","useRouter","templateWorkflows","TEMPLATE_NAMESPACE","PRESERVED_QUERY_NAMESPACES","isValidParameter","param","cleanupUrlParams","newQuery","templateParam","sourceParam","clearPreservedQuery","useWorkflowPersistence","templateUrlLoader","ensureTemplateQueryFromIntent","hydratePreservedQuery","mergedQuery","mergePreservedQueryIntoQuery","workflowPersistenceEnabled","persistCurrentWorkflow","ourKeys","loadWorkflowFromStorage","loadPreviousWorkflowFromStorage","getStorageValue","clientId","sessionWorkflow","localWorkflow","loadDefaultWorkflow","initializeWorkflow","loadTemplateFromUrlIfPresent","activeWorkflowKey","setStorageValue","tryOnScopeDispose","openWorkflows","restoreState","paths","activeIndex","storedWorkflows","storedActiveIndex","TransformStateKey","useTransformSettling","settleDelay","passive","isTransforming","markTransformActive","markTransformSettled","useDebounceFn","useTransformState","camera","transformStyle","syncWithCanvas","canvasToScreen","point","screenToCanvas","getNodeScreenBounds","topLeft","calculateAdjustedMargin","baseMargin","isNodeTooSmall","getExpandedViewportBounds","marginX","testViewportIntersection","screenPos","isNodeInViewport","nodePos","adjustedMargin","getViewportBounds","bottomRight","useLOD","pixelRatio","useDevicePixelRatio","baseFontSize","dprAdjustment","minFontSize","threshold","isLOD","isInteracting","handlePointerUp","handlePointerCancel","showOptionsPanel","toggleOptionsPanel","useNodeZIndex","layoutSource","bringNodeToFront","hasMultipleNodesSelected","count","useNodeEventHandlersIndividual","shouldHandleNodePointerEvents","handleNodeSelect","nodeData","collapsed","syntheticEvent","nodeIds","addToSelection","useNodeEventHandlers","useNodeSnap","gridSize","alwaysSnap","shouldSnap","applySnapToPosition","posArray","snapPoint","applySnapToSize","gridSizeValue","sizeArray","useShiftKeySync","shiftKeyState","syncShiftState","isShiftPressed","trackShiftKey","initialEvent","handleKeyEvent","stopKeydown","stopKeyup","useNodeLayout","nodeIdMaybe","mutations","selectedNodeIds","transformState","layoutRef","zIndex","dragStartPos","dragStartMouse","otherSelectedNodesStartPositions","rafId","stopShiftSync","startDrag","nodeLayout","handleDrag","mouseDelta","canvasOrigin","canvasWithDelta","canvasDelta","newPosition","otherNodeId","startPos","newOtherPosition","endDrag","boundsUpdates","currentLayout","currentPos","snappedPos","moveNodeTo","useNodePointerInteractions","nodeDataMaybe","onNodeSelect","nodeIdComputed","forwardEventToCanvas","forwardMiddlePointerIfNeeded","isMiddlePointerInput","dragStyle","startPosition","cleanupDragState","safeDragEnd","handleDragTermination","handleContextMenu","trackingConfigs","updates","nodeUpdates","resizeObserver","entries","conv","updatesByType","nodesNeedingSlotResync","entry","elementType","elementId","type","borderBox","cx","cy","topLeftCanvas","syncNodeSlotLayoutsFromDOM","useVueElementTracking","appIdentifierMaybe","trackingType","appIdentifier","getCurrentInstance","useNodeExecutionState","nodeLocatorIdMaybe","locatorId","nodeLocationProgressStates","isIdle","useExecutionStore","progressState","executing","progress","state","progressPercentage","prog","executionState","useNodePreviewState","nodePreviewImages","previewUrls","urls","hasPreview","latestPreviewUrl","shouldShowPreviewImg","applyHandleDelta","startSize","horizontalMultiplier","verticalMultiplier","computeAdjustedPosition","nextSize","widthDelta","heightDelta","computeResizeOutcome","snapFn","resized","snapped","createResizeSession","toCanvasDelta","startPointer","currentPointer","safeScale","useNodeResize","resizeCallback","isResizing","resizeStartPointer","resizeSession","nodeElement","moveEvent","session","outcome","upEvent","stopMoveListen","stopUpListen","baseResizeHandleClasses","POSITION_EPSILON","progressClasses","handleNodeCollapse","handleNodeTitleUpdate","handleNodeRightClick","nodeLocatorId","getLocatorIdFromNodeData","executionStore","hasExecutionError","hasAnyError","bypassed","muted","nodeBodyBackgroundColor","applyLightThemeColor","nodeOpacity","globalOpacity","hasInputs","nonWidgetedInputs","hasOutputs","pointerHandlers","nodeContainerRef","cornerResizeHandles","startResize","currentPosition","deltaX","deltaY","handleResizePointerDown","from","to","currentWidth","currentHeight","hasCustomContent","nodeMedia","borderClass","outlineClass","handleCollapse","handleHeaderTitleUpdate","handleEnterSubgraph","litegraphNode","getNodeByLocatorId","nodeOutputs","nodeOutputLocatorId","lgraphNode","newOutputs","hasVideoInput","isDraggingOver","handleDragOver","canDrop","handleDragLeave","handleDrop","pendingCallbacks","isNewUserDetermined","isNewUserCached","newUserService","checkIsNewUser","isNewUserSettings","hasNoWorkflow","hasNoPreviousWorkflow","registerInitCallback","initializeIfNewUser","isNewUser","STORAGE_KEY","bannerDismissed","vueNodesEnabled","showVueNodesBanner","handleDismiss","handleTryItOut","nodeSearchboxPopoverRef","betaMenuEnabled","workflowTabsPosition","canvasMenuEnabled","tooltipEnabled","selectionToolboxEnabled","activeSidebarTab","showUI","minimapEnabled","vueNodeLifecycle","handleTransformUpdate","handleVueNodeLifecycleReset","allNodes","spellcheckEnabled","textarea","IS_CONTROL_WIDGET","updateControlWidgetLabel","l","currentPaletteId","lastNodeErrors","slot","nodeErrors","inputIndex","loadCustomNodesI18n","i18nData","comfyAppReady","workflowPersistence","ChangeTracker","UnauthorizedError","migrateToLitegraphReroute","workflowJSON","migratedWorkflowJSON","migrateLegacyRerouteNodes","switchBack","disableVueNodes","showMainMenuToast","DEFAULT_TITLE","TITLE_SUFFIX","useBrowserTabTitle","executionText","newMenuEnabled","isAutoSaveEnabled","isActiveWorkflowModified","isActiveWorkflowPersisted","shouldShowUnsavedIndicator","isUnsavedText","workflowNameText","nodeExecutionTitle","runningNodes","workflowTitle","useTitle","frameworkOptions","projectOptions","tempNavigation","searchText","selectedFrameworks","selectedProjects","selectedSort","useModelSelectorDialog","SampleModelSelector","createModelNodeFromAsset","validatedAsset","assetItemSchema","errorMessage","validAsset","userMetadata","filename","MODELS_TAG","MISSING_TAG","targetGraph","ZENDESK_FIELDS","SUPPORT_BASE_URL","buildSupportUrl","searchParams","showSubscriptionDialog","moveSelectedNodesVersionAdded","useCoreCommands","firebaseAuthActions","getTracker","moveSelectedNodes","positionUpdater","getAllNonIoNodesInSubgraph","useQueueStore","current","nodesToFit","selectionBounds","lgBounds","setDirty","lastLinksRenderMode","currentMode","metadata","batchCount","useQueueSettingsStore","executionIds","getExecutionIdsForSelectedNodes","previousDarkTheme","DEFAULT_DARK_COLOR_PALETTE","previousLightTheme","DEFAULT_LIGHT_COLOR_PALETTE","theme","resolvedUserInfo","supportUrl","ManagerUIState","showSubgraphNodeDialog","tryToggleWidgetPromotion","currentValue","useProgressFavicon","defaultFavicon","favicon","useFavicon","totalFrames","frame","LatentPreviewMethod","LogLevel","HashFunction","CudaMalloc","FloatingPointPrecision","CrossAttentionMethod","VramManagement","SERVER_CONFIG_ITEMS","DISMISSAL_DURATION_MS","useVersionCompatibilityStore","frontendVersion","backendVersion","requiredFrontendVersion","isFrontendOutdated","valid","gt","isFrontendNewer","hasVersionMismatch","versionKey","dismissalStorage","useStorage","dismissedUntil","shouldShowWarning","warningMessage","checkVersionCompatibility","dismissWarning","dismissUntil","useFrontendVersionMismatchWarning","immediate","versionCompatibilityStore","hasShownWarning","showWarning","detailMessage","fullMessage","setupAutoQueueHandler","queueCountStore","useQueuePendingTaskCountStore","queueSettingsStore","graphHasChanged","internalCount","queueStore","assetsStore","useAssetsStore","graphCanvasContainerRef","useFirebaseAuthStore","newTheme","DARK_THEME_CLASS","newTasks","oldTasks","oldRunningTaskIds","task","fontSize","loadLocale","useNewMenu","coreCommands","useKeybindingService","queuePendingTaskCountStore","onStatus","onExecutionSuccess","reconnectingMessage","onReconnecting","onReconnected","wrapWithErrorHandling","wrapWithErrorHandlingAsync","onGraphReady","useServerConfigStore","useModelStore"],"ignoreList":[],"sources":["../../../../../../ComfyUI_frontend/src/utils/categoryIcons.ts","../../../../../../ComfyUI_frontend/src/platform/workflow/templates/repositories/workflowTemplatesStore.ts","../../../../../../ComfyUI_frontend/src/types/widgetTypes.ts","../../../../../../ComfyUI_frontend/src/components/widget/layout/BaseModalLayout.vue","../../../../../../ComfyUI_frontend/src/components/widget/nav/NavTitle.vue","../../../../../../ComfyUI_frontend/src/components/widget/panel/PanelHeader.vue","../../../../../../ComfyUI_frontend/src/components/widget/panel/LeftSidePanel.vue","../../../../../../ComfyUI_frontend/src/composables/useFeatureFlags.ts","../../../../../../ComfyUI_frontend/src/composables/usePopoverSizing.ts","../../../../../../ComfyUI_frontend/src/components/input/MultiSelect.vue","../../../../../../ComfyUI_frontend/src/components/input/SingleSelect.vue","../../../../../../ComfyUI_frontend/src/platform/assets/composables/useAssetFilterOptions.ts","../../../../../../ComfyUI_frontend/src/platform/assets/components/AssetFilterBar.vue","../../../../../../ComfyUI_frontend/src/platform/assets/components/AssetCard.vue","../../../../../../ComfyUI_frontend/src/utils/gridUtil.ts","../../../../../../ComfyUI_frontend/src/platform/assets/components/AssetGrid.vue","../../../../../../ComfyUI_frontend/src/platform/assets/utils/assetMetadataUtils.ts","../../../../../../ComfyUI_frontend/src/platform/assets/composables/useAssetBrowser.ts","../../../../../../ComfyUI_frontend/src/platform/assets/utils/categoryLabel.ts","../../../../../../ComfyUI_frontend/src/platform/assets/components/AssetBrowserModal.vue","../../../../../../ComfyUI_frontend/src/platform/assets/composables/useAssetBrowserDialog.ts","../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/VideoPreview.vue","../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/components/ImagePreview.vue","../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/components/NodeContent.vue","../../../../../../ComfyUI_frontend/src/components/topbar/TopbarBadge.vue","../../../../../../ComfyUI_frontend/src/platform/cloud/subscription/components/SubscribeButton.vue","../../../../../../ComfyUI_frontend/src/components/toast/GlobalToast.vue","../../../../../../ComfyUI_frontend/src/base/common/async.ts","../../../../../../ComfyUI_frontend/src/components/MenuHamburger.vue","../../../../../../ComfyUI_frontend/src/components/dialog/UnloadWindowConfirmDialog.vue","../../../../../../ComfyUI_frontend/src/components/LiteGraphCanvasSplitterOverlay.vue","../../../../../../ComfyUI_frontend/src/components/actionbar/ComfyRunButton/index.ts","../../../../../../ComfyUI_frontend/src/components/actionbar/ComfyActionbar.vue","../../../../../../ComfyUI_frontend/src/components/breadcrumb/SubgraphBreadcrumbItem.vue","../../../../../../ComfyUI_frontend/src/composables/element/useOverflowObserver.ts","../../../../../../ComfyUI_frontend/src/components/breadcrumb/SubgraphBreadcrumb.vue","../../../../../../ComfyUI_frontend/src/stores/actionBarButtonStore.ts","../../../../../../ComfyUI_frontend/src/components/topbar/ActionBarButtons.vue","../../../../../../ComfyUI_frontend/src/components/topbar/CurrentUserPopover.vue","../../../../../../ComfyUI_frontend/src/components/topbar/CurrentUserButton.vue","../../../../../../ComfyUI_frontend/src/components/topbar/LoginButton.vue","../../../../../../ComfyUI_frontend/src/components/TopMenuSection.vue","../../../../../../ComfyUI_frontend/src/components/common/ExtensionSlot.vue","../../../../../../ComfyUI_frontend/src/components/bottomPanel/BottomPanel.vue","../../../../../../ComfyUI_frontend/src/composables/element/useAbsolutePosition.ts","../../../../../../ComfyUI_frontend/src/composables/element/useDomClipping.ts","../../../../../../ComfyUI_frontend/src/components/graph/widgets/DomWidget.vue","../../../../../../ComfyUI_frontend/src/components/graph/DomWidgets.vue","../../../../../../ComfyUI_frontend/src/composables/useZoomControls.ts","../../../../../../ComfyUI_frontend/src/renderer/extensions/minimap/composables/useMinimapGraph.ts","../../../../../../ComfyUI_frontend/src/renderer/extensions/minimap/composables/useMinimapInteraction.ts","../../../../../../ComfyUI_frontend/src/renderer/extensions/minimap/composables/useMinimapRenderer.ts","../../../../../../ComfyUI_frontend/src/renderer/extensions/minimap/composables/useMinimapSettings.ts","../../../../../../ComfyUI_frontend/src/renderer/extensions/minimap/composables/useMinimapViewport.ts","../../../../../../ComfyUI_frontend/src/renderer/extensions/minimap/composables/useMinimap.ts","../../../../../../ComfyUI_frontend/src/components/graph/CanvasModeSelector.vue","../../../../../../ComfyUI_frontend/src/components/graph/modals/ZoomControlsModal.vue","../../../../../../ComfyUI_frontend/src/components/graph/GraphCanvasMenu.vue","../../../../../../ComfyUI_frontend/src/components/graph/NodeTooltip.vue","../../../../../../ComfyUI_frontend/src/components/graph/selectionToolbox/BypassButton.vue","../../../../../../ComfyUI_frontend/src/components/graph/selectionToolbox/ColorPickerButton.vue","../../../../../../ComfyUI_frontend/src/composables/graph/useSelectionState.ts","../../../../../../ComfyUI_frontend/src/components/graph/selectionToolbox/ConvertToSubgraphButton.vue","../../../../../../ComfyUI_frontend/src/components/graph/selectionToolbox/DeleteButton.vue","../../../../../../ComfyUI_frontend/src/components/graph/selectionToolbox/ExecuteButton.vue","../../../../../../ComfyUI_frontend/src/components/graph/selectionToolbox/ExtensionCommandButton.vue","../../../../../../ComfyUI_frontend/src/components/graph/selectionToolbox/InfoButton.vue","../../../../../../ComfyUI_frontend/src/components/graph/selectionToolbox/Load3DViewerButton.vue","../../../../../../ComfyUI_frontend/src/components/graph/selectionToolbox/MaskEditorButton.vue","../../../../../../ComfyUI_frontend/src/composables/useRefreshableSelection.ts","../../../../../../ComfyUI_frontend/src/components/graph/selectionToolbox/RefreshSelectionButton.vue","../../../../../../ComfyUI_frontend/src/components/graph/selectionToolbox/SaveToSubgraphLibrary.vue","../../../../../../ComfyUI_frontend/src/composables/canvas/useSelectionToolboxPosition.ts","../../../../../../ComfyUI_frontend/src/composables/graph/useFrameNodes.ts","../../../../../../ComfyUI_frontend/src/components/graph/selectionToolbox/FrameNodes.vue","../../../../../../ComfyUI_frontend/src/composables/graph/useCanvasRefresh.ts","../../../../../../ComfyUI_frontend/src/composables/graph/useNodeCustomization.ts","../../../../../../ComfyUI_frontend/src/composables/graph/useGroupMenuOptions.ts","../../../../../../ComfyUI_frontend/src/composables/graph/useImageMenuOptions.ts","../../../../../../ComfyUI_frontend/src/composables/graph/useSelectedNodeActions.ts","../../../../../../ComfyUI_frontend/src/composables/graph/useNodeMenuOptions.ts","../../../../../../ComfyUI_frontend/src/composables/graph/useNodeArrangement.ts","../../../../../../ComfyUI_frontend/src/composables/graph/useSelectionOperations.ts","../../../../../../ComfyUI_frontend/src/composables/graph/useSubgraphOperations.ts","../../../../../../ComfyUI_frontend/src/composables/graph/useSelectionMenuOptions.ts","../../../../../../ComfyUI_frontend/src/composables/graph/useMoreOptionsMenu.ts","../../../../../../ComfyUI_frontend/src/components/graph/selectionToolbox/NodeOptionsButton.vue","../../../../../../ComfyUI_frontend/src/components/graph/selectionToolbox/VerticalDivider.vue","../../../../../../ComfyUI_frontend/src/components/graph/SelectionToolbox.vue","../../../../../../ComfyUI_frontend/src/components/graph/TitleEditor.vue","../../../../../../ComfyUI_frontend/src/composables/graph/useSubmenuPositioning.ts","../../../../../../ComfyUI_frontend/src/components/graph/selectionToolbox/MenuOptionItem.vue","../../../../../../ComfyUI_frontend/src/components/graph/selectionToolbox/SubmenuPopover.vue","../../../../../../ComfyUI_frontend/src/components/graph/selectionToolbox/NodeOptions.vue","../../../../../../ComfyUI_frontend/src/stores/workspace/searchBoxStore.ts","../../../../../../ComfyUI_frontend/src/components/primevueOverride/AutoCompletePlus.vue","../../../../../../ComfyUI_frontend/src/components/searchbox/NodeSearchItem.vue","../../../../../../ComfyUI_frontend/src/components/searchbox/NodeSearchBox.vue","../../../../../../ComfyUI_frontend/src/components/searchbox/NodeSearchBoxPopover.vue","../../../../../../ComfyUI_frontend/src/components/icons/ComfyLogo.vue","../../../../../../ComfyUI_frontend/src/components/templates/thumbnails/BaseThumbnail.vue","../../../../../../ComfyUI_frontend/src/components/templates/thumbnails/CompareSliderThumbnail.vue","../../../../../../ComfyUI_frontend/src/components/templates/thumbnails/DefaultThumbnail.vue","../../../../../../ComfyUI_frontend/src/components/templates/thumbnails/HoverDissolveThumbnail.vue","../../../../../../ComfyUI_frontend/src/composables/useLazyPagination.ts","../../../../../../ComfyUI_frontend/src/composables/useTemplateFiltering.ts","../../../../../../ComfyUI_frontend/src/platform/workflow/templates/composables/useTemplateWorkflows.ts","../../../../../../ComfyUI_frontend/src/components/custom/widget/WorkflowTemplateSelectorDialog.vue","../../../../../../ComfyUI_frontend/src/composables/useWorkflowTemplateSelectorDialog.ts","../../../../../../ComfyUI_frontend/src/utils/mouseDownUtil.ts","../../../../../../ComfyUI_frontend/src/components/sidebar/ComfyMenuButton.vue","../../../../../../ComfyUI_frontend/src/components/sidebar/SidebarIcon.vue","../../../../../../ComfyUI_frontend/src/components/sidebar/SidebarBottomPanelToggleButton.vue","../../../../../../ComfyUI_frontend/src/components/sidebar/SidebarShortcutsToggleButton.vue","../../../../../../ComfyUI_frontend/src/components/icons/PuzzleIcon.vue","../../../../../../ComfyUI_frontend/src/platform/updates/common/releaseService.ts","../../../../../../ComfyUI_frontend/src/platform/updates/common/releaseStore.ts","../../../../../../ComfyUI_frontend/src/components/helpcenter/HelpCenterMenuContent.vue","../../../../../../ComfyUI_frontend/src/platform/updates/components/ReleaseNotificationToast.vue","../../../../../../ComfyUI_frontend/src/platform/updates/components/WhatsNewPopup.vue","../../../../../../ComfyUI_frontend/src/stores/helpCenterStore.ts","../../../../../../ComfyUI_frontend/src/components/sidebar/SidebarHelpCenterIcon.vue","../../../../../../ComfyUI_frontend/src/components/sidebar/SidebarLogoutIcon.vue","../../../../../../ComfyUI_frontend/src/components/sidebar/SidebarTemplatesButton.vue","../../../../../../ComfyUI_frontend/src/components/sidebar/SideToolbar.vue","../../../../../../ComfyUI_frontend/src/stores/topbarBadgeStore.ts","../../../../../../ComfyUI_frontend/src/components/topbar/TopbarBadges.vue","../../../../../../ComfyUI_frontend/src/components/topbar/WorkflowTabPopover.vue","../../../../../../ComfyUI_frontend/src/components/topbar/WorkflowTab.vue","../../../../../../ComfyUI_frontend/src/components/topbar/WorkflowOverflowMenu.vue","../../../../../../ComfyUI_frontend/src/components/topbar/WorkflowTabs.vue","../../../../../../ComfyUI_frontend/src/composables/graph/useGraphNodeManager.ts","../../../../../../ComfyUI_frontend/src/composables/useVueNodesMigrationDismissed.ts","../../../../../../ComfyUI_frontend/src/renderer/core/layout/sync/useLayoutSync.ts","../../../../../../ComfyUI_frontend/src/composables/graph/useVueNodeLifecycle.ts","../../../../../../ComfyUI_frontend/src/composables/graph/useViewportCulling.ts","../../../../../../ComfyUI_frontend/src/composables/node/useNodePricing.ts","../../../../../../ComfyUI_frontend/src/composables/node/usePriceBadge.ts","../../../../../../ComfyUI_frontend/src/composables/node/useWatchWidget.ts","../../../../../../ComfyUI_frontend/src/composables/node/useNodeBadge.ts","../../../../../../ComfyUI_frontend/src/composables/useCanvasDrop.ts","../../../../../../ComfyUI_frontend/src/composables/useContextMenuTranslation.ts","../../../../../../ComfyUI_frontend/src/workbench/eventHelpers.ts","../../../../../../ComfyUI_frontend/src/composables/useCopy.ts","../../../../../../ComfyUI_frontend/src/composables/useGlobalLitegraph.ts","../../../../../../ComfyUI_frontend/src/composables/usePaste.ts","../../../../../../ComfyUI_frontend/src/platform/settings/composables/useLitegraphSettings.ts","../../../../../../ComfyUI_frontend/src/platform/settings/constants/coreSettings.ts","../../../../../../ComfyUI_frontend/src/platform/workflow/persistence/composables/useWorkflowAutoSave.ts","../../../../../../ComfyUI_frontend/src/platform/workflow/templates/composables/useTemplateUrlLoader.ts","../../../../../../ComfyUI_frontend/src/platform/workflow/persistence/composables/useWorkflowPersistence.ts","../../../../../../ComfyUI_frontend/src/renderer/core/layout/injectionKeys.ts","../../../../../../ComfyUI_frontend/src/renderer/core/layout/transform/useTransformSettling.ts","../../../../../../ComfyUI_frontend/src/renderer/core/layout/transform/useTransformState.ts","../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/lod/useLOD.ts","../../../../../../ComfyUI_frontend/src/renderer/core/layout/transform/TransformPane.vue","../../../../../../ComfyUI_frontend/src/renderer/extensions/minimap/MiniMap.vue","../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/composables/useNodeZIndex.ts","../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/composables/useNodeEventHandlers.ts","../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/composables/useNodeSnap.ts","../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/composables/useShiftKeySync.ts","../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/layout/useNodeLayout.ts","../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/composables/useNodePointerInteractions.ts","../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/composables/useVueNodeResizeTracking.ts","../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/execution/useNodeExecutionState.ts","../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/preview/useNodePreviewState.ts","../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/interactions/resize/resizeMath.ts","../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/interactions/resize/useNodeResize.ts","../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/components/LivePreview.vue","../../../../../../ComfyUI_frontend/src/renderer/extensions/vueNodes/components/LGraphNode.vue","../../../../../../ComfyUI_frontend/src/services/newUserService.ts","../../../../../../ComfyUI_frontend/src/components/topbar/TryVueNodeBanner.vue","../../../../../../ComfyUI_frontend/src/components/graph/GraphCanvas.vue","../../../../../../ComfyUI_frontend/src/components/toast/RerouteMigrationToast.vue","../../../../../../ComfyUI_frontend/src/components/toast/VueNodesMigrationToast.vue","../../../../../../ComfyUI_frontend/src/composables/useBrowserTabTitle.ts","../../../../../../ComfyUI_frontend/src/components/widget/panel/RightSidePanel.vue","../../../../../../ComfyUI_frontend/src/components/widget/SampleModelSelector.vue","../../../../../../ComfyUI_frontend/src/composables/useModelSelectorDialog.ts","../../../../../../ComfyUI_frontend/src/platform/assets/utils/createModelNodeFromAsset.ts","../../../../../../ComfyUI_frontend/src/platform/support/config.ts","../../../../../../ComfyUI_frontend/src/composables/useCoreCommands.ts","../../../../../../ComfyUI_frontend/src/composables/useProgressFavicon.ts","../../../../../../ComfyUI_frontend/src/types/serverArgs.ts","../../../../../../ComfyUI_frontend/src/constants/serverConfig.ts","../../../../../../ComfyUI_frontend/src/platform/updates/common/versionCompatibilityStore.ts","../../../../../../ComfyUI_frontend/src/platform/updates/common/useFrontendVersionMismatchWarning.ts","../../../../../../ComfyUI_frontend/src/services/autoQueueService.ts","../../../../../../ComfyUI_frontend/src/views/GraphView.vue"],"sourcesContent":["/**\n * Maps category IDs to their corresponding Lucide icon classes\n */\nexport const getCategoryIcon = (categoryId: string): string => {\n  const iconMap: Record<string, string> = {\n    // Main categories\n    all: 'icon-[lucide--list]',\n    'getting-started': 'icon-[lucide--graduation-cap]',\n\n    // Generation types\n    'generation-image': 'icon-[lucide--image]',\n    image: 'icon-[lucide--image]',\n    'generation-video': 'icon-[lucide--film]',\n    video: 'icon-[lucide--film]',\n    'generation-3d': 'icon-[lucide--box]',\n    '3d': 'icon-[lucide--box]',\n    'generation-audio': 'icon-[lucide--volume-2]',\n    audio: 'icon-[lucide--volume-2]',\n    'generation-llm': 'icon-[lucide--message-square-text]',\n\n    // API and models\n    'api-nodes': 'icon-[lucide--hand-coins]',\n    'closed-models': 'icon-[lucide--hand-coins]',\n\n    // LLMs and AI\n    llm: 'icon-[lucide--message-square-text]',\n    llms: 'icon-[lucide--message-square-text]',\n    'llm-api': 'icon-[lucide--message-square-text]',\n\n    // Performance and hardware\n    'small-models': 'icon-[lucide--zap]',\n    performance: 'icon-[lucide--zap]',\n    'mac-compatible': 'icon-[lucide--command]',\n    'runs-on-mac': 'icon-[lucide--command]',\n\n    // Training\n    'lora-training': 'icon-[lucide--dumbbell]',\n    training: 'icon-[lucide--dumbbell]',\n\n    // Extensions and tools\n    extensions: 'icon-[lucide--puzzle]',\n    tools: 'icon-[lucide--wrench]',\n\n    // Fallbacks for common patterns\n    upscaling: 'icon-[lucide--maximize-2]',\n    controlnet: 'icon-[lucide--sliders-horizontal]',\n    'area-composition': 'icon-[lucide--layout-grid]'\n  }\n\n  // Return mapped icon or fallback to folder\n  return iconMap[categoryId.toLowerCase()] || 'icon-[lucide--folder]'\n}\n","import Fuse from 'fuse.js'\nimport { defineStore } from 'pinia'\nimport { computed, ref, shallowRef } from 'vue'\n\nimport { i18n, st } from '@/i18n'\nimport { isCloud } from '@/platform/distribution/types'\nimport { api } from '@/scripts/api'\nimport type { NavGroupData, NavItemData } from '@/types/navTypes'\nimport { getCategoryIcon } from '@/utils/categoryIcons'\nimport { normalizeI18nKey } from '@/utils/formatUtil'\n\nimport type {\n  TemplateGroup,\n  TemplateInfo,\n  WorkflowTemplates\n} from '../types/template'\n\n// Enhanced template interface for easier filtering\ninterface EnhancedTemplate extends TemplateInfo {\n  sourceModule: string\n  category?: string\n  categoryType?: string\n  categoryGroup?: string // 'GENERATION TYPE' or 'CLOSED SOURCE MODELS'\n  isEssential?: boolean\n  isPartnerNode?: boolean // Computed from OpenSource === false\n  searchableText?: string\n}\n\nexport const useWorkflowTemplatesStore = defineStore(\n  'workflowTemplates',\n  () => {\n    const customTemplates = shallowRef<{ [moduleName: string]: string[] }>({})\n    const coreTemplates = shallowRef<WorkflowTemplates[]>([])\n    const englishTemplates = shallowRef<WorkflowTemplates[]>([])\n    const isLoaded = ref(false)\n    const knownTemplateNames = ref(new Set<string>())\n\n    const getTemplateByName = (name: string): EnhancedTemplate | undefined => {\n      return enhancedTemplates.value.find((template) => template.name === name)\n    }\n\n    // Store filter mappings for dynamic categories\n    type FilterData = {\n      category?: string\n      categoryGroup?: string\n    }\n\n    const categoryFilters = ref(new Map<string, FilterData>())\n\n    /**\n     * Add localization fields to a template.\n     */\n    const addLocalizedFieldsToTemplate = (\n      template: TemplateInfo,\n      categoryTitle: string\n    ) => ({\n      ...template,\n      localizedTitle: st(\n        `templateWorkflows.template.${normalizeI18nKey(categoryTitle)}.${normalizeI18nKey(template.name)}`,\n        template.title ?? template.name\n      ),\n      localizedDescription: st(\n        `templateWorkflows.templateDescription.${normalizeI18nKey(categoryTitle)}.${normalizeI18nKey(template.name)}`,\n        template.description\n      )\n    })\n\n    /**\n     * Add localization fields to all templates in a list of templates.\n     */\n    const localizeTemplateList = (\n      templates: TemplateInfo[],\n      categoryTitle: string\n    ) =>\n      templates.map((template) =>\n        addLocalizedFieldsToTemplate(template, categoryTitle)\n      )\n\n    /**\n     * Add localization fields to a template category and all its constituent templates.\n     */\n    const localizeTemplateCategory = (templateCategory: WorkflowTemplates) => ({\n      ...templateCategory,\n      localizedTitle: st(\n        `templateWorkflows.category.${normalizeI18nKey(templateCategory.title)}`,\n        templateCategory.title ?? templateCategory.moduleName\n      ),\n      templates: localizeTemplateList(\n        templateCategory.templates,\n        templateCategory.title\n      )\n    })\n\n    // Create an \"All\" category that combines all templates\n    const createAllCategory = () => {\n      // First, get core templates with source module added\n      const coreTemplatesWithSourceModule = coreTemplates.value.flatMap(\n        (category) =>\n          // For each template in each category, add the sourceModule and pass through any localized fields\n          category.templates.map((template) => {\n            // Get localized template with its original category title for i18n lookup\n            const localizedTemplate = addLocalizedFieldsToTemplate(\n              template,\n              category.title\n            )\n            return {\n              ...localizedTemplate,\n              sourceModule: category.moduleName\n            }\n          })\n      )\n\n      // Now handle custom templates\n      const customTemplatesWithSourceModule = Object.entries(\n        customTemplates.value\n      ).flatMap(([moduleName, templates]) =>\n        templates.map((name) => ({\n          name,\n          mediaType: 'image',\n          mediaSubtype: 'jpg',\n          description: name,\n          sourceModule: moduleName\n        }))\n      )\n\n      return {\n        moduleName: 'all',\n        title: 'All',\n        localizedTitle: st('templateWorkflows.category.All', 'All Templates'),\n        templates: [\n          ...coreTemplatesWithSourceModule,\n          ...customTemplatesWithSourceModule\n        ]\n      }\n    }\n\n    /**\n     * Original grouped templates for backward compatibility\n     */\n    const groupedTemplates = computed<TemplateGroup[]>(() => {\n      // Get regular categories\n      const allTemplates = [\n        ...coreTemplates.value.map(localizeTemplateCategory),\n        ...Object.entries(customTemplates.value).map(\n          ([moduleName, templates]) => ({\n            moduleName,\n            title: moduleName,\n            localizedTitle: st(\n              `templateWorkflows.category.${normalizeI18nKey(moduleName)}`,\n              moduleName\n            ),\n            templates: templates.map((name) => ({\n              name,\n              mediaType: 'image',\n              mediaSubtype: 'jpg',\n              description: name\n            }))\n          })\n        )\n      ]\n\n      // Group templates by their main category\n      const groupedByCategory = [\n        {\n          label: st(\n            'templateWorkflows.category.ComfyUI Examples',\n            'ComfyUI Examples'\n          ),\n          modules: [\n            createAllCategory(),\n            ...allTemplates.filter((t) => t.moduleName === 'default')\n          ]\n        },\n        ...(Object.keys(customTemplates.value).length > 0\n          ? [\n              {\n                label: st(\n                  'templateWorkflows.category.Custom Nodes',\n                  'Custom Nodes'\n                ),\n                modules: allTemplates.filter((t) => t.moduleName !== 'default')\n              }\n            ]\n          : [])\n      ]\n\n      return groupedByCategory\n    })\n\n    /**\n     * Enhanced templates with proper categorization for filtering\n     */\n    const enhancedTemplates = computed<EnhancedTemplate[]>(() => {\n      const allTemplates: EnhancedTemplate[] = []\n\n      // Process core templates\n      coreTemplates.value.forEach((category) => {\n        category.templates.forEach((template) => {\n          const enhancedTemplate: EnhancedTemplate = {\n            ...template,\n            sourceModule: category.moduleName,\n            category: category.title,\n            categoryType: category.type,\n            categoryGroup: category.category,\n            isEssential: category.isEssential,\n            isPartnerNode: template.openSource === false,\n            searchableText: [\n              template.title || template.name,\n              template.description || '',\n              category.title,\n              ...(template.tags || []),\n              ...(template.models || [])\n            ].join(' ')\n          }\n\n          allTemplates.push(enhancedTemplate)\n        })\n      })\n\n      // Process custom templates\n      Object.entries(customTemplates.value).forEach(\n        ([moduleName, templates]) => {\n          templates.forEach((name) => {\n            const enhancedTemplate: EnhancedTemplate = {\n              name,\n              title: name,\n              description: name,\n              mediaType: 'image',\n              mediaSubtype: 'jpg',\n              sourceModule: moduleName,\n              category: 'Extensions',\n              categoryType: 'extension',\n              searchableText: `${name} ${moduleName} extension`\n            }\n            allTemplates.push(enhancedTemplate)\n          })\n        }\n      )\n\n      // TODO: Temporary filtering of custom node templates on local installations\n      // Future: Add UX that allows local users to opt-in to templates with custom nodes,\n      // potentially conditional on whether they have those specific custom nodes installed.\n      // This would provide better template discovery while respecting local user workflows.\n      const filteredTemplates = isCloud\n        ? allTemplates\n        : allTemplates.filter(\n            (template) => !template.requiresCustomNodes?.length\n          )\n\n      return filteredTemplates\n    })\n\n    /**\n     * Fuse.js instance for advanced template searching and filtering\n     */\n    const templateFuse = computed(() => {\n      const fuseOptions = {\n        keys: [\n          { name: 'searchableText', weight: 0.4 },\n          { name: 'title', weight: 0.3 },\n          { name: 'name', weight: 0.2 },\n          { name: 'tags', weight: 0.1 }\n        ],\n        threshold: 0.3,\n        includeScore: true\n      }\n\n      return new Fuse(enhancedTemplates.value, fuseOptions)\n    })\n\n    /**\n     * Filter templates by category ID using stored filter mappings\n     */\n    const filterTemplatesByCategory = (categoryId: string) => {\n      if (categoryId === 'all') {\n        return enhancedTemplates.value\n      }\n\n      if (categoryId === 'basics') {\n        // Filter for templates from categories marked as essential\n        return enhancedTemplates.value.filter((t) => t.isEssential)\n      }\n\n      if (categoryId === 'partner-nodes') {\n        // Filter for templates where OpenSource === false\n        return enhancedTemplates.value.filter((t) => t.isPartnerNode)\n      }\n\n      // Handle extension-specific filters\n      if (categoryId.startsWith('extension-')) {\n        const moduleName = categoryId.replace('extension-', '')\n        return enhancedTemplates.value.filter(\n          (t) => t.sourceModule === moduleName\n        )\n      }\n\n      // Look up the filter from our stored mappings\n      const filter = categoryFilters.value.get(categoryId)\n      if (!filter) {\n        return enhancedTemplates.value\n      }\n\n      // Apply the filter\n      return enhancedTemplates.value.filter((template) => {\n        if (filter.category && template.category !== filter.category) {\n          return false\n        }\n        if (\n          filter.categoryGroup &&\n          template.categoryGroup !== filter.categoryGroup\n        ) {\n          return false\n        }\n        return true\n      })\n    }\n\n    /**\n     * New navigation structure dynamically built from JSON categories\n     */\n    const navGroupedTemplates = computed<(NavItemData | NavGroupData)[]>(() => {\n      if (!isLoaded.value) return []\n\n      const items: (NavItemData | NavGroupData)[] = []\n\n      // Clear and rebuild filter mappings\n      categoryFilters.value.clear()\n\n      // 1. All Templates - always first\n      items.push({\n        id: 'all',\n        label: st('templateWorkflows.category.All', 'All Templates'),\n        icon: getCategoryIcon('all')\n      })\n\n      // 2. Basics (isEssential categories) - always second if it exists\n      let gettingStartedText = 'Getting Started'\n      const essentialCat = coreTemplates.value.find(\n        (cat) => cat.isEssential && cat.templates.length > 0\n      )\n      const hasEssentialCategories = Boolean(essentialCat)\n\n      if (essentialCat) {\n        gettingStartedText = essentialCat.title\n      }\n      if (hasEssentialCategories) {\n        items.push({\n          id: 'basics',\n          label: gettingStartedText,\n          icon: 'icon-[lucide--graduation-cap]'\n        })\n      }\n\n      // 3. Group categories from JSON dynamically\n      const categoryGroups = new Map<\n        string,\n        { title: string; items: NavItemData[] }\n      >()\n\n      // Process all categories from JSON\n      coreTemplates.value.forEach((category) => {\n        // Skip essential categories as they're handled as Basics\n        if (category.isEssential) return\n\n        const categoryGroup = category.category\n        const categoryIcon = category.icon\n\n        if (categoryGroup) {\n          if (!categoryGroups.has(categoryGroup)) {\n            categoryGroups.set(categoryGroup, {\n              title: categoryGroup,\n              items: []\n            })\n          }\n\n          const group = categoryGroups.get(categoryGroup)!\n\n          // Generate unique ID for this category\n          const categoryId = `${categoryGroup.toLowerCase().replace(/\\s+/g, '-')}-${category.title.toLowerCase().replace(/\\s+/g, '-')}`\n\n          // Store the filter mapping\n          categoryFilters.value.set(categoryId, {\n            category: category.title,\n            categoryGroup: categoryGroup\n          })\n\n          group.items.push({\n            id: categoryId,\n            label: st(\n              `templateWorkflows.category.${normalizeI18nKey(category.title)}`,\n              category.title\n            ),\n            icon: categoryIcon || getCategoryIcon(category.type || 'default')\n          })\n        }\n      })\n\n      // Add grouped categories\n      categoryGroups.forEach((group, groupName) => {\n        if (group.items.length > 0) {\n          items.push({\n            title: st(\n              `templateWorkflows.category.${normalizeI18nKey(groupName)}`,\n              groupName\n                .split(' ')\n                .map(\n                  (word) =>\n                    word.charAt(0).toUpperCase() + word.slice(1).toLowerCase()\n                )\n                .join(' ')\n            ),\n            items: group.items\n          })\n        }\n      })\n\n      // 3.5. Partner Nodes - virtual category for OpenSource === false templates\n      const partnerNodeCount = enhancedTemplates.value.filter(\n        (t) => t.isPartnerNode\n      ).length\n\n      if (partnerNodeCount > 0) {\n        items.push({\n          id: 'partner-nodes',\n          label: st(\n            'templateWorkflows.category.Partner Nodes',\n            'Partner Nodes'\n          ),\n          icon: 'icon-[lucide--handshake]'\n        })\n      }\n\n      // 4. Extensions - always last\n      const extensionCounts = enhancedTemplates.value.filter(\n        (t) => t.sourceModule !== 'default'\n      ).length\n\n      if (extensionCounts > 0) {\n        // Get unique extension modules\n        const extensionModules = Array.from(\n          new Set(\n            enhancedTemplates.value\n              .filter((t) => t.sourceModule !== 'default')\n              .map((t) => t.sourceModule)\n          )\n        ).sort()\n\n        const extensionItems: NavItemData[] = extensionModules.map(\n          (moduleName) => ({\n            id: `extension-${moduleName}`,\n            label: st(\n              `templateWorkflows.category.${normalizeI18nKey(moduleName)}`,\n              moduleName\n            ),\n            icon: getCategoryIcon('extensions')\n          })\n        )\n\n        items.push({\n          title: st('templateWorkflows.category.Extensions', 'Extensions'),\n          items: extensionItems,\n          collapsible: true\n        })\n      }\n\n      return items\n    })\n\n    async function loadWorkflowTemplates() {\n      try {\n        if (!isLoaded.value) {\n          customTemplates.value = await api.getWorkflowTemplates()\n          const locale = i18n.global.locale.value\n\n          const [coreResult, englishResult] = await Promise.all([\n            api.getCoreWorkflowTemplates(locale),\n            isCloud && locale !== 'en'\n              ? api.getCoreWorkflowTemplates('en')\n              : Promise.resolve([])\n          ])\n\n          coreTemplates.value = coreResult\n          englishTemplates.value = englishResult\n\n          const coreNames = coreTemplates.value.flatMap((category) =>\n            category.templates.map((template) => template.name)\n          )\n          const customNames = Object.values(customTemplates.value).flat()\n          knownTemplateNames.value = new Set([...coreNames, ...customNames])\n\n          isLoaded.value = true\n        }\n      } catch (error) {\n        console.error('Error fetching workflow templates:', error)\n      }\n    }\n\n    function getEnglishMetadata(templateName: string): {\n      tags?: string[]\n      category?: string\n      useCase?: string\n      models?: string[]\n      license?: string\n    } | null {\n      if (englishTemplates.value.length === 0) {\n        return null\n      }\n\n      for (const category of englishTemplates.value) {\n        const template = category.templates.find((t) => t.name === templateName)\n        if (template) {\n          return {\n            tags: template.tags,\n            category: category.title,\n            useCase: template.useCase,\n            models: template.models,\n            license: template.license\n          }\n        }\n      }\n\n      return null\n    }\n\n    return {\n      groupedTemplates,\n      navGroupedTemplates,\n      enhancedTemplates,\n      templateFuse,\n      filterTemplatesByCategory,\n      isLoaded,\n      loadWorkflowTemplates,\n      knownTemplateNames,\n      getTemplateByName,\n      getEnglishMetadata\n    }\n  }\n)\n","import type { InjectionKey } from 'vue'\n\nexport type AssetKind = 'image' | 'video' | 'audio' | 'model' | 'unknown'\n\nexport const OnCloseKey: InjectionKey<() => void> = Symbol()\n","<template>\n  <div :class=\"layoutClasses\">\n    <IconButton\n      v-show=\"!isRightPanelOpen && hasRightPanel\"\n      :class=\"rightPanelButtonClasses\"\n      @click=\"toggleRightPanel\"\n    >\n      <i class=\"icon-[lucide--panel-right] text-sm\" />\n    </IconButton>\n    <IconButton :class=\"closeButtonClasses\" @click=\"closeDialog\">\n      <i class=\"pi pi-times text-sm\"></i>\n    </IconButton>\n    <div class=\"flex h-full w-full\">\n      <Transition name=\"slide-panel\">\n        <nav\n          v-if=\"$slots.leftPanel && showLeftPanel\"\n          :class=\"[\n            PANEL_SIZES.width,\n            PANEL_SIZES.minWidth,\n            PANEL_SIZES.maxWidth\n          ]\"\n        >\n          <slot name=\"leftPanel\"></slot>\n        </nav>\n      </Transition>\n\n      <div :class=\"mainContainerClasses\">\n        <div class=\"flex h-full w-full flex-col\">\n          <header v-if=\"$slots.header\" :class=\"headerClasses\">\n            <div class=\"flex flex-1 shrink-0 gap-2\">\n              <IconButton v-if=\"!notMobile\" @click=\"toggleLeftPanel\">\n                <i\n                  v-if=\"!showLeftPanel\"\n                  class=\"icon-[lucide--panel-left] text-sm\"\n                />\n                <i v-else class=\"icon-[lucide--panel-left-close] text-sm\" />\n              </IconButton>\n              <slot name=\"header\"></slot>\n            </div>\n            <slot name=\"header-right-area\"></slot>\n            <div :class=\"rightAreaClasses\">\n              <IconButton\n                v-if=\"isRightPanelOpen && hasRightPanel\"\n                @click=\"toggleRightPanel\"\n              >\n                <i class=\"icon-[lucide--panel-right-close] text-sm\" />\n              </IconButton>\n            </div>\n          </header>\n\n          <main class=\"flex min-h-0 flex-1 flex-col\">\n            <!-- Fallback title bar when no leftPanel is provided -->\n            <slot name=\"contentFilter\"></slot>\n            <h2\n              v-if=\"!$slots.leftPanel\"\n              class=\"text-xxl m-0 px-6 pt-2 pb-6 capitalize\"\n            >\n              {{ contentTitle }}\n            </h2>\n            <div :class=\"contentContainerClasses\">\n              <slot name=\"content\"></slot>\n            </div>\n          </main>\n        </div>\n        <aside\n          v-if=\"hasRightPanel && isRightPanelOpen\"\n          :class=\"rightPanelClasses\"\n        >\n          <slot name=\"rightPanel\"></slot>\n        </aside>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useBreakpoints } from '@vueuse/core'\nimport { computed, inject, ref, useSlots, watch } from 'vue'\n\nimport IconButton from '@/components/button/IconButton.vue'\nimport { OnCloseKey } from '@/types/widgetTypes'\nimport { cn } from '@/utils/tailwindUtil'\n\nconst { contentTitle } = defineProps<{\n  contentTitle: string\n}>()\n\nconst BREAKPOINTS = { md: 880 }\nconst PANEL_SIZES = {\n  width: 'w-1/3',\n  minWidth: 'min-w-40',\n  maxWidth: 'max-w-56'\n}\n\nconst slots = useSlots()\nconst closeDialog = inject(OnCloseKey, () => {})\n\nconst breakpoints = useBreakpoints(BREAKPOINTS)\nconst notMobile = breakpoints.greater('md')\n\nconst isLeftPanelOpen = ref<boolean>(true)\nconst isRightPanelOpen = ref<boolean>(false)\nconst mobileMenuOpen = ref<boolean>(false)\n\nconst hasRightPanel = computed(() => !!slots.rightPanel)\n\nwatch(notMobile, (isDesktop) => {\n  if (!isDesktop) {\n    mobileMenuOpen.value = false\n  }\n})\n\nconst showLeftPanel = computed(() => {\n  const shouldShow = notMobile.value\n    ? isLeftPanelOpen.value\n    : mobileMenuOpen.value\n  return shouldShow\n})\n\nconst toggleLeftPanel = () => {\n  if (notMobile.value) {\n    isLeftPanelOpen.value = !isLeftPanelOpen.value\n  } else {\n    mobileMenuOpen.value = !mobileMenuOpen.value\n  }\n}\n\nconst toggleRightPanel = () => {\n  isRightPanelOpen.value = !isRightPanelOpen.value\n}\n\n// Computed classes for better readability\nconst layoutClasses = cn(\n  'base-widget-layout',\n  'rounded-2xl overflow-hidden relative'\n)\n\nconst rightPanelButtonClasses = computed(() => {\n  return cn('absolute top-4 right-18 z-10', 'transition-opacity duration-200', {\n    'opacity-0 pointer-events-none':\n      isRightPanelOpen.value || !hasRightPanel.value\n  })\n})\n\nconst closeButtonClasses = cn(\n  'absolute top-4 right-6 z-10',\n  'transition-opacity duration-200'\n)\n\nconst mainContainerClasses = cn('flex-1 flex bg-base-background')\n\nconst headerClasses = cn(\n  'w-full h-18 px-6',\n  'flex items-center justify-between gap-2'\n)\n\nconst rightAreaClasses = computed(() => {\n  return cn(\n    'flex justify-end gap-2 w-0',\n    hasRightPanel.value && !isRightPanelOpen.value ? 'min-w-22' : 'min-w-10'\n  )\n})\n\nconst contentContainerClasses = computed(() => {\n  return cn('min-h-0 px-6 pt-0 pb-10', 'overflow-y-auto scrollbar-hide')\n})\n\nconst rightPanelClasses = computed(() => {\n  return cn('w-1/4 min-w-40 max-w-80')\n})\n</script>\n<style scoped>\n.base-widget-layout {\n  height: 80vh;\n  width: 90vw;\n  max-width: 1280px;\n  aspect-ratio: 20/13;\n}\n\n@media (min-width: 1450px) {\n  .base-widget-layout {\n    max-width: 1724px;\n  }\n}\n\n/* Fade transition for buttons */\n.fade-enter-active,\n.fade-leave-active {\n  transition: opacity 0.2s ease;\n}\n\n.fade-enter-from,\n.fade-leave-to {\n  opacity: 0;\n}\n\n/* Slide transition for left panel */\n.slide-panel-enter-active,\n.slide-panel-leave-active {\n  transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n  will-change: transform;\n  backface-visibility: hidden;\n}\n\n.slide-panel-enter-from,\n.slide-panel-leave-to {\n  transform: translateX(-100%);\n}\n</style>\n","<template>\n  <div\n    :class=\"\n      cn(\n        'flex items-center justify-between m-0 px-3 py-0 pt-5',\n        collapsible && 'cursor-pointer select-none'\n      )\n    \"\n    @click=\"collapsible && toggleCollapse()\"\n  >\n    <h3 class=\"text-xs font-bold text-text-secondary uppercase\">\n      {{ title }}\n    </h3>\n    <i\n      v-if=\"collapsible\"\n      :class=\"\n        cn(\n          'pi transition-transform duration-200 text-xs text-text-secondary ',\n          isCollapsed ? 'pi-chevron-right' : 'pi-chevron-down'\n        )\n      \"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\n\nimport { cn } from '@/utils/tailwindUtil'\n\nconst {\n  title,\n  modelValue = false,\n  collapsible = false\n} = defineProps<{\n  title: string\n  modelValue?: boolean\n  collapsible?: boolean\n}>()\n\nconst emit = defineEmits<{\n  'update:modelValue': [value: boolean]\n}>()\n\nconst isCollapsed = computed({\n  get: () => modelValue,\n  set: (value: boolean) => emit('update:modelValue', value)\n})\n\nconst toggleCollapse = () => {\n  isCollapsed.value = !isCollapsed.value\n}\n</script>\n","<template>\n  <header class=\"flex h-16 items-center justify-between px-6\">\n    <div class=\"flex items-center gap-2 pl-1\">\n      <slot name=\"icon\">\n        <i class=\"text-neutral icon-[lucide--puzzle] text-base\" />\n      </slot>\n      <h2 class=\"text-neutral text-base font-bold\">\n        <slot></slot>\n      </h2>\n    </div>\n  </header>\n</template>\n","<template>\n  <div class=\"flex h-full w-full flex-col bg-modal-panel-background\">\n    <PanelHeader>\n      <template #icon>\n        <slot name=\"header-icon\"></slot>\n      </template>\n      <slot name=\"header-title\"></slot>\n    </PanelHeader>\n\n    <nav\n      class=\"flex scrollbar-hide flex-1 flex-col gap-1 overflow-y-auto px-3 py-4\"\n    >\n      <template v-for=\"(item, index) in navItems\" :key=\"index\">\n        <div v-if=\"'items' in item\" class=\"flex flex-col gap-2\">\n          <NavTitle\n            v-model=\"collapsedGroups[item.title]\"\n            :title=\"item.title\"\n            :collapsible=\"item.collapsible\"\n          />\n          <template v-if=\"!item.collapsible || !collapsedGroups[item.title]\">\n            <NavItem\n              v-for=\"subItem in item.items\"\n              :key=\"subItem.id\"\n              :icon=\"subItem.icon\"\n              :active=\"activeItem === subItem.id\"\n              @click=\"activeItem = subItem.id\"\n            >\n              {{ subItem.label }}\n            </NavItem>\n          </template>\n        </div>\n        <div v-else class=\"flex flex-col gap-2\">\n          <NavItem\n            :icon=\"item.icon\"\n            :active=\"activeItem === item.id\"\n            @click=\"activeItem = item.id\"\n          >\n            {{ item.label }}\n          </NavItem>\n        </div>\n      </template>\n    </nav>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, ref } from 'vue'\n\nimport NavItem from '@/components/widget/nav/NavItem.vue'\nimport NavTitle from '@/components/widget/nav/NavTitle.vue'\nimport type { NavGroupData, NavItemData } from '@/types/navTypes'\n\nimport PanelHeader from './PanelHeader.vue'\n\nconst { navItems = [], modelValue } = defineProps<{\n  navItems?: (NavItemData | NavGroupData)[]\n  modelValue?: string | null\n}>()\n\nconst emit = defineEmits<{\n  'update:modelValue': [value: string | null]\n}>()\n\n// Track collapsed state for each group\nconst collapsedGroups = ref<Record<string, boolean>>({})\n\nconst getFirstItemId = () => {\n  if (!navItems || navItems.length === 0) {\n    return null\n  }\n\n  const firstEntry = navItems[0]\n\n  if ('items' in firstEntry && firstEntry.items.length > 0) {\n    return firstEntry.items[0].id\n  }\n  if ('id' in firstEntry) {\n    return firstEntry.id\n  }\n\n  return null\n}\n\nconst activeItem = computed({\n  get: () => modelValue ?? getFirstItemId(),\n  set: (value: string | null) => emit('update:modelValue', value)\n})\n</script>\n","import { computed, reactive, readonly } from 'vue'\n\nimport { api } from '@/scripts/api'\n\n/**\n * Known server feature flags (top-level, not extensions)\n */\nexport enum ServerFeatureFlag {\n  SUPPORTS_PREVIEW_METADATA = 'supports_preview_metadata',\n  MAX_UPLOAD_SIZE = 'max_upload_size',\n  MANAGER_SUPPORTS_V4 = 'extension.manager.supports_v4',\n  MODEL_UPLOAD_BUTTON_ENABLED = 'model_upload_button_enabled'\n}\n\n/**\n * Composable for reactive access to server-side feature flags\n */\nexport function useFeatureFlags() {\n  const flags = reactive({\n    get supportsPreviewMetadata() {\n      return api.getServerFeature(ServerFeatureFlag.SUPPORTS_PREVIEW_METADATA)\n    },\n    get maxUploadSize() {\n      return api.getServerFeature(ServerFeatureFlag.MAX_UPLOAD_SIZE)\n    },\n    get supportsManagerV4() {\n      return api.getServerFeature(ServerFeatureFlag.MANAGER_SUPPORTS_V4)\n    },\n    get modelUploadButtonEnabled() {\n      return api.getServerFeature(\n        ServerFeatureFlag.MODEL_UPLOAD_BUTTON_ENABLED,\n        false\n      )\n    }\n  })\n\n  const featureFlag = <T = unknown>(featurePath: string, defaultValue?: T) =>\n    computed(() => api.getServerFeature(featurePath, defaultValue))\n\n  return {\n    flags: readonly(flags),\n    featureFlag\n  }\n}\n","import { computed } from 'vue'\nimport type { CSSProperties, ComputedRef } from 'vue'\n\ninterface PopoverSizeOptions {\n  minWidth?: string\n  maxWidth?: string\n}\n\n/**\n * Composable for managing popover sizing styles\n * @param options Popover size configuration\n * @returns Computed style object for popover sizing\n */\nexport function usePopoverSizing(\n  options: PopoverSizeOptions\n): ComputedRef<CSSProperties> {\n  return computed(() => {\n    const { minWidth, maxWidth } = options\n    const style: CSSProperties = {}\n\n    if (minWidth) {\n      style.minWidth = minWidth\n    }\n\n    if (maxWidth) {\n      style.maxWidth = maxWidth\n    }\n\n    return style\n  })\n}\n","<template>\n  <!--\n    Note: Unlike SingleSelect, we don't need an explicit options prop because:\n    1. Our value template only shows a static label (not dynamic based on selection)\n    2. We display a count badge instead of actual selected labels\n    3. All PrimeVue props (including options) are passed via v-bind=\"$attrs\"\n    option-label=\"name\" is required because our option template directly accesses option.name\n    max-selected-labels=\"0\" is required to show count badge instead of selected item labels\n  -->\n  <MultiSelect\n    v-model=\"selectedItems\"\n    v-bind=\"{ ...$attrs, options: filteredOptions }\"\n    option-label=\"name\"\n    unstyled\n    :max-selected-labels=\"0\"\n    :pt=\"{\n      root: ({ props }: MultiSelectPassThroughMethodOptions) => ({\n        class: cn(\n          'h-10 relative inline-flex cursor-pointer select-none',\n          'rounded-lg bg-base-background text-base-foreground',\n          'transition-all duration-200 ease-in-out',\n          'border-[2.5px] border-solid',\n          selectedCount > 0\n            ? 'border-node-component-border'\n            : 'border-transparent',\n          'focus-within:border-node-component-border',\n          { 'opacity-60 cursor-default': props.disabled }\n        )\n      }),\n      labelContainer: {\n        class:\n          'flex-1 flex items-center overflow-hidden whitespace-nowrap pl-4 py-2 '\n      },\n      label: {\n        class: 'p-0'\n      },\n      dropdown: {\n        class: 'flex shrink-0 cursor-pointer items-center justify-center px-3'\n      },\n      header: () => ({\n        class:\n          showSearchBox || showSelectedCount || showClearButton\n            ? 'block'\n            : 'hidden'\n      }),\n      // Overlay & list visuals unchanged\n      overlay: {\n        class: cn(\n          'mt-2 rounded-lg py-2 px-2',\n          'bg-base-background',\n          'text-base-foreground',\n          'border border-solid border-border-default'\n        )\n      },\n      listContainer: () => ({\n        style: { maxHeight: `min(${listMaxHeight}, 50vh)` },\n        class: 'scrollbar-custom'\n      }),\n      list: {\n        class: 'flex flex-col gap-0 p-0 m-0 list-none border-none text-sm'\n      },\n      // Option row hover and focus tone\n      option: ({ context }: MultiSelectPassThroughMethodOptions) => ({\n        class: cn(\n          'flex gap-2 items-center h-10 px-2 rounded-lg',\n          'hover:bg-secondary-background-hover',\n          // Add focus/highlight state for keyboard navigation\n          context?.focused &&\n            'bg-secondary-background-selected hover:bg-secondary-background-selected'\n        )\n      }),\n      // Hide built-in checkboxes entirely via PT (no :deep)\n      pcHeaderCheckbox: {\n        root: { class: 'hidden' },\n        style: { display: 'none' }\n      },\n      pcOptionCheckbox: {\n        root: { class: 'hidden' },\n        style: { display: 'none' }\n      }\n    }\"\n    :aria-label=\"label || t('g.multiSelectDropdown')\"\n    role=\"combobox\"\n    :aria-expanded=\"false\"\n    aria-haspopup=\"listbox\"\n    tabindex=\"0\"\n  >\n    <template\n      v-if=\"showSearchBox || showSelectedCount || showClearButton\"\n      #header\n    >\n      <div class=\"flex flex-col px-2 pt-2 pb-0\">\n        <SearchBox\n          v-if=\"showSearchBox\"\n          v-model=\"searchQuery\"\n          :class=\"showSelectedCount || showClearButton ? 'mb-2' : ''\"\n          :show-order=\"true\"\n          :show-border=\"true\"\n          :place-holder=\"searchPlaceholder\"\n        />\n        <div\n          v-if=\"showSelectedCount || showClearButton\"\n          class=\"mt-2 flex items-center justify-between\"\n        >\n          <span\n            v-if=\"showSelectedCount\"\n            class=\"px-1 text-sm text-base-foreground\"\n          >\n            {{\n              selectedCount > 0\n                ? $t('g.itemsSelected', { selectedCount })\n                : $t('g.itemSelected', { selectedCount })\n            }}\n          </span>\n          <TextButton\n            v-if=\"showClearButton\"\n            :label=\"$t('g.clearAll')\"\n            type=\"transparent\"\n            size=\"fit-content\"\n            class=\"text-sm text-text-primary\"\n            @click.stop=\"selectedItems = []\"\n          />\n        </div>\n        <div class=\"my-4 h-px bg-border-default\"></div>\n      </div>\n    </template>\n\n    <!-- Trigger value (keep text scale identical) -->\n    <template #value>\n      <span class=\"text-sm text-muted-foreground\">\n        {{ label }}\n      </span>\n      <span\n        v-if=\"selectedCount > 0\"\n        class=\"pointer-events-none absolute -top-2 -right-2 z-10 flex h-5 w-5 items-center justify-center rounded-full bg-primary-background text-xs font-semibold text-base-foreground\"\n      >\n        {{ selectedCount }}\n      </span>\n    </template>\n\n    <!-- Chevron size identical to current -->\n    <template #dropdownicon>\n      <i class=\"icon-[lucide--chevron-down] text-lg text-neutral-400\" />\n    </template>\n\n    <!-- Custom option row: square checkbox + label (unchanged layout/colors) -->\n    <template #option=\"slotProps\">\n      <div class=\"flex items-center gap-2\" :style=\"popoverStyle\">\n        <div\n          class=\"flex h-4 w-4 shrink-0 items-center justify-center rounded p-0.5 transition-all duration-200\"\n          :class=\"\n            slotProps.selected\n              ? 'bg-primary-background'\n              : 'bg-secondary-background'\n          \"\n        >\n          <i\n            v-if=\"slotProps.selected\"\n            class=\"text-bold icon-[lucide--check] text-xs text-white\"\n          />\n        </div>\n        <Button\n          class=\"border-none bg-transparent text-left outline-none\"\n          unstyled\n          >{{ slotProps.option.name }}</Button\n        >\n      </div>\n    </template>\n  </MultiSelect>\n</template>\n\n<script setup lang=\"ts\">\nimport { useFuse } from '@vueuse/integrations/useFuse'\nimport type { UseFuseOptions } from '@vueuse/integrations/useFuse'\nimport Button from 'primevue/button'\nimport type { MultiSelectPassThroughMethodOptions } from 'primevue/multiselect'\nimport MultiSelect from 'primevue/multiselect'\nimport { computed, useAttrs } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport SearchBox from '@/components/input/SearchBox.vue'\nimport { usePopoverSizing } from '@/composables/usePopoverSizing'\nimport { cn } from '@/utils/tailwindUtil'\n\nimport TextButton from '../button/TextButton.vue'\nimport type { SelectOption } from './types'\n\ntype Option = SelectOption\n\ndefineOptions({\n  inheritAttrs: false\n})\n\ninterface Props {\n  /** Input label shown on the trigger button */\n  label?: string\n  /** Show search box in the panel header */\n  showSearchBox?: boolean\n  /** Show selected count text in the panel header */\n  showSelectedCount?: boolean\n  /** Show \"Clear all\" action in the panel header */\n  showClearButton?: boolean\n  /** Placeholder for the search input */\n  searchPlaceholder?: string\n  /** Maximum height of the dropdown panel (default: 28rem) */\n  listMaxHeight?: string\n  /** Minimum width of the popover (default: auto) */\n  popoverMinWidth?: string\n  /** Maximum width of the popover (default: auto) */\n  popoverMaxWidth?: string\n  // Note: options prop is intentionally omitted.\n  // It's passed via $attrs to maximize PrimeVue API compatibility\n}\nconst {\n  label,\n  showSearchBox = false,\n  showSelectedCount = false,\n  showClearButton = false,\n  searchPlaceholder = 'Search...',\n  listMaxHeight = '28rem',\n  popoverMinWidth,\n  popoverMaxWidth\n} = defineProps<Props>()\n\nconst selectedItems = defineModel<Option[]>({\n  required: true\n})\nconst searchQuery = defineModel<string>('searchQuery', { default: '' })\n\nconst { t } = useI18n()\nconst selectedCount = computed(() => selectedItems.value.length)\n\nconst popoverStyle = usePopoverSizing({\n  minWidth: popoverMinWidth,\n  maxWidth: popoverMaxWidth\n})\nconst attrs = useAttrs()\nconst originalOptions = computed(() => (attrs.options as Option[]) || [])\n\n// Use VueUse's useFuse for better reactivity and performance\nconst fuseOptions: UseFuseOptions<Option> = {\n  fuseOptions: {\n    keys: ['name', 'value'],\n    threshold: 0.3,\n    includeScore: false\n  },\n  matchAllWhenSearchEmpty: true\n}\n\nconst { results } = useFuse(searchQuery, originalOptions, fuseOptions)\n\n// Filter options based on search, but always include selected items\nconst filteredOptions = computed(() => {\n  if (!searchQuery.value || searchQuery.value.trim() === '') {\n    return originalOptions.value\n  }\n\n  // results.value already contains the search results from useFuse\n  const searchResults = results.value.map(\n    (result: { item: Option }) => result.item\n  )\n\n  // Include selected items that aren't in search results\n  const selectedButNotInResults = selectedItems.value.filter(\n    (item) =>\n      !searchResults.some((result: Option) => result.value === item.value)\n  )\n\n  return [...selectedButNotInResults, ...searchResults]\n})\n</script>\n","<template>\n  <!--\n    Note: We explicitly pass options here (not just via $attrs) because:\n    1. Our custom value template needs options to look up labels from values\n    2. PrimeVue's value slot only provides 'value' and 'placeholder', not the selected item's label\n    3. We need to maintain the icon slot functionality in the value template\n    option-label=\"name\" is required because our option template directly accesses option.name\n  -->\n  <Select\n    v-model=\"selectedItem\"\n    v-bind=\"$attrs\"\n    :options=\"options\"\n    option-label=\"name\"\n    option-value=\"value\"\n    unstyled\n    :pt=\"{\n      root: ({ props }: SelectPassThroughMethodOptions<SelectOption>) => ({\n        class: [\n          // container\n          'h-10 relative inline-flex cursor-pointer select-none items-center',\n          // trigger surface\n          'rounded-lg',\n          'bg-base-background text-base-foreground',\n          'border-[2.5px] border-solid border-transparent',\n          'transition-all duration-200 ease-in-out',\n          'focus-within:border-node-component-border',\n          // disabled\n          { 'opacity-60 cursor-default': props.disabled }\n        ]\n      }),\n      label: {\n        class:\n          // Align with MultiSelect labelContainer spacing\n          'flex-1 flex items-center whitespace-nowrap pl-4 py-2 outline-hidden'\n      },\n      dropdown: {\n        class:\n          // Right chevron touch area\n          'flex shrink-0 items-center justify-center px-3 py-2'\n      },\n      overlay: {\n        class: cn(\n          'mt-2 p-2 rounded-lg',\n          'bg-base-background text-base-foreground',\n          'border border-solid border-border-default'\n        )\n      },\n      listContainer: () => ({\n        style: `max-height: min(${listMaxHeight}, 50vh)`,\n        class: 'scrollbar-custom'\n      }),\n      list: {\n        class:\n          // Same list tone/size as MultiSelect\n          'flex flex-col gap-0 p-0 m-0 list-none border-none text-sm'\n      },\n      option: ({ context }: SelectPassThroughMethodOptions<SelectOption>) => ({\n        class: cn(\n          // Row layout\n          'flex items-center justify-between gap-3 px-2 py-3 rounded',\n          'hover:bg-secondary-background-hover',\n          // Add focus state for keyboard navigation\n          context.focused && 'bg-secondary-background-hover',\n          // Selected state + check icon\n          context.selected &&\n            'bg-secondary-background-selected hover:bg-secondary-background-selected'\n        )\n      }),\n      optionLabel: {\n        class: 'truncate'\n      },\n      optionGroupLabel: {\n        class: 'px-3 py-2 text-xs uppercase tracking-wide text-muted-foreground'\n      },\n      emptyMessage: {\n        class: 'px-3 py-2 text-sm text-muted-foreground'\n      }\n    }\"\n    :aria-label=\"label || t('g.singleSelectDropdown')\"\n    role=\"combobox\"\n    :aria-expanded=\"false\"\n    aria-haspopup=\"listbox\"\n    :tabindex=\"0\"\n  >\n    <!-- Trigger value -->\n    <template #value=\"slotProps\">\n      <div class=\"flex items-center gap-2 text-sm text-neutral-500\">\n        <slot name=\"icon\" />\n        <span\n          v-if=\"slotProps.value !== null && slotProps.value !== undefined\"\n          class=\"text-base-foreground\"\n        >\n          {{ getLabel(slotProps.value) }}\n        </span>\n        <span v-else class=\"text-base-foreground\">\n          {{ label }}\n        </span>\n      </div>\n    </template>\n\n    <!-- Trigger caret -->\n    <template #dropdownicon>\n      <i class=\"icon-[lucide--chevron-down] text-base text-neutral-500\" />\n    </template>\n\n    <!-- Option row -->\n    <template #option=\"{ option, selected }\">\n      <div\n        class=\"flex w-full items-center justify-between gap-3\"\n        :style=\"optionStyle\"\n      >\n        <span class=\"truncate\">{{ option.name }}</span>\n        <i v-if=\"selected\" class=\"icon-[lucide--check] text-base-foreground\" />\n      </div>\n    </template>\n  </Select>\n</template>\n\n<script setup lang=\"ts\">\nimport type { SelectPassThroughMethodOptions } from 'primevue/select'\nimport Select from 'primevue/select'\nimport { computed } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport { cn } from '@/utils/tailwindUtil'\n\nimport type { SelectOption } from './types'\n\ndefineOptions({\n  inheritAttrs: false\n})\n\nconst {\n  label,\n  options,\n  listMaxHeight = '28rem',\n  popoverMinWidth,\n  popoverMaxWidth\n} = defineProps<{\n  label?: string\n  /**\n   * Required for displaying the selected item's label.\n   * Cannot rely on $attrs alone because we need to access options\n   * in getLabel() to map values to their display names.\n   */\n  options?: SelectOption[]\n  /** Maximum height of the dropdown panel (default: 28rem) */\n  listMaxHeight?: string\n  /** Minimum width of the popover (default: auto) */\n  popoverMinWidth?: string\n  /** Maximum width of the popover (default: auto) */\n  popoverMaxWidth?: string\n}>()\n\nconst selectedItem = defineModel<string | null>({ required: true })\n\nconst { t } = useI18n()\n\n/**\n * Maps a value to its display label.\n * Necessary because PrimeVue's value slot doesn't provide the selected item's label,\n * only the raw value. We need this to show the correct text when an item is selected.\n */\nconst getLabel = (val: string | null | undefined) => {\n  if (val == null) return label ?? ''\n  if (!options) return label ?? ''\n  const found = options.find((o) => o.value === val)\n  return found ? found.name : (label ?? '')\n}\n\n// Extract complex style logic from template\nconst optionStyle = computed(() => {\n  if (!popoverMinWidth && !popoverMaxWidth) return undefined\n\n  const styles: string[] = []\n  if (popoverMinWidth) styles.push(`min-width: ${popoverMinWidth}`)\n  if (popoverMaxWidth) styles.push(`max-width: ${popoverMaxWidth}`)\n\n  return styles.join('; ')\n})\n</script>\n","import { uniqWith } from 'es-toolkit'\nimport { computed, toValue } from 'vue'\nimport type { MaybeRefOrGetter } from 'vue'\n\nimport type { SelectOption } from '@/components/input/types'\nimport type { AssetItem } from '@/platform/assets/schemas/assetSchema'\n\n/**\n * Composable that extracts available filter options from asset data\n * Provides reactive computed properties for file formats and base models\n */\nexport function useAssetFilterOptions(assets: MaybeRefOrGetter<AssetItem[]>) {\n  /**\n   * Extract unique file formats from asset names\n   * Returns sorted SelectOption array with extensions\n   */\n  const availableFileFormats = computed<SelectOption[]>(() => {\n    const assetList = toValue(assets)\n    const extensions = assetList\n      .map((asset) => {\n        const extension = asset.name.split('.').pop()\n        return extension && extension !== asset.name ? extension : null\n      })\n      .filter((extension): extension is string => extension !== null)\n\n    const uniqueExtensions = uniqWith(extensions, (a, b) => a === b)\n\n    return uniqueExtensions.sort().map((format) => ({\n      name: `.${format}`,\n      value: format\n    }))\n  })\n\n  /**\n   * Extract unique base models from asset user metadata\n   * Returns sorted SelectOption array with base model names\n   */\n  const availableBaseModels = computed<SelectOption[]>(() => {\n    const assetList = toValue(assets)\n    const models = assetList\n      .map((asset) => asset.user_metadata?.base_model)\n      .filter(\n        (baseModel): baseModel is string =>\n          baseModel !== undefined && typeof baseModel === 'string'\n      )\n\n    const uniqueModels = uniqWith(models, (a, b) => a === b)\n\n    return uniqueModels.sort().map((model) => ({\n      name: model,\n      value: model\n    }))\n  })\n\n  return {\n    availableFileFormats,\n    availableBaseModels\n  }\n}\n","<template>\n  <div :class=\"containerClasses\" data-component-id=\"asset-filter-bar\">\n    <div :class=\"leftSideClasses\" data-component-id=\"asset-filter-bar-left\">\n      <MultiSelect\n        v-if=\"availableFileFormats.length > 0\"\n        v-model=\"fileFormats\"\n        :label=\"$t('assetBrowser.fileFormats')\"\n        :options=\"availableFileFormats\"\n        :class=\"selectClasses\"\n        data-component-id=\"asset-filter-file-formats\"\n        @update:model-value=\"handleFilterChange\"\n      />\n\n      <MultiSelect\n        v-if=\"availableBaseModels.length > 0\"\n        v-model=\"baseModels\"\n        :label=\"$t('assetBrowser.baseModels')\"\n        :options=\"availableBaseModels\"\n        :class=\"selectClasses\"\n        data-component-id=\"asset-filter-base-models\"\n        @update:model-value=\"handleFilterChange\"\n      />\n    </div>\n\n    <div :class=\"rightSideClasses\" data-component-id=\"asset-filter-bar-right\">\n      <SingleSelect\n        v-model=\"sortBy\"\n        :label=\"$t('assetBrowser.sortBy')\"\n        :options=\"sortOptions\"\n        :class=\"selectClasses\"\n        data-component-id=\"asset-filter-sort\"\n        @update:model-value=\"handleFilterChange\"\n      >\n        <template #icon>\n          <i class=\"icon-[lucide--arrow-up-down] size-3\" />\n        </template>\n      </SingleSelect>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref } from 'vue'\n\nimport MultiSelect from '@/components/input/MultiSelect.vue'\nimport SingleSelect from '@/components/input/SingleSelect.vue'\nimport type { SelectOption } from '@/components/input/types'\nimport { t } from '@/i18n'\nimport { useAssetFilterOptions } from '@/platform/assets/composables/useAssetFilterOptions'\nimport type { AssetItem } from '@/platform/assets/schemas/assetSchema'\nimport { cn } from '@/utils/tailwindUtil'\n\nexport interface FilterState {\n  fileFormats: string[]\n  baseModels: string[]\n  sortBy: string\n}\n\nconst { assets = [] } = defineProps<{\n  assets?: AssetItem[]\n}>()\n\nconst fileFormats = ref<SelectOption[]>([])\nconst baseModels = ref<SelectOption[]>([])\nconst sortBy = ref('name-asc')\n\nconst { availableFileFormats, availableBaseModels } =\n  useAssetFilterOptions(assets)\n\nconst sortOptions = [\n  { name: t('assetBrowser.sortAZ'), value: 'name-asc' },\n  { name: t('assetBrowser.sortZA'), value: 'name-desc' },\n  { name: t('assetBrowser.sortRecent'), value: 'recent' }\n]\n\nconst emit = defineEmits<{\n  filterChange: [filters: FilterState]\n}>()\n\nconst containerClasses = cn(\n  'flex gap-4 items-center justify-between',\n  'px-6 pt-2 pb-6'\n)\nconst leftSideClasses = cn('flex gap-4 items-center')\nconst rightSideClasses = cn('flex items-center')\nconst selectClasses = cn('min-w-32')\n\nfunction handleFilterChange() {\n  emit('filterChange', {\n    fileFormats: fileFormats.value.map((option: SelectOption) => option.value),\n    baseModels: baseModels.value.map((option: SelectOption) => option.value),\n    sortBy: sortBy.value\n  })\n}\n</script>\n","<template>\n  <component\n    :is=\"interactive ? 'button' : 'div'\"\n    data-component-id=\"AssetCard\"\n    :data-asset-id=\"asset.id\"\n    v-bind=\"elementProps\"\n    :class=\"cardClasses\"\n    @click=\"interactive && $emit('select', asset)\"\n    @keydown.enter=\"interactive && $emit('select', asset)\"\n  >\n    <div class=\"relative aspect-square w-full overflow-hidden rounded-xl\">\n      <img\n        v-if=\"shouldShowImage\"\n        :src=\"asset.preview_url\"\n        class=\"h-full w-full object-contain\"\n      />\n      <div\n        v-else\n        class=\"flex h-full w-full items-center justify-center bg-gradient-to-br from-smoke-400 via-smoke-800 to-charcoal-400\"\n      ></div>\n      <AssetBadgeGroup :badges=\"asset.badges\" />\n    </div>\n    <div :class=\"cn('p-4 h-32 flex flex-col justify-between')\">\n      <div>\n        <h3\n          :id=\"titleId\"\n          v-tooltip.top=\"{ value: asset.name, showDelay: tooltipDelay }\"\n          :class=\"\n            cn(\n              'mb-2 m-0 text-base font-semibold line-clamp-2 wrap-anywhere',\n              'text-base-foreground'\n            )\n          \"\n        >\n          {{ asset.name }}\n        </h3>\n        <p\n          :id=\"descId\"\n          v-tooltip.top=\"{ value: asset.description, showDelay: tooltipDelay }\"\n          :class=\"\n            cn(\n              'm-0 text-sm leading-6 overflow-hidden [-webkit-box-orient:vertical] [-webkit-line-clamp:2] [display:-webkit-box]',\n              'text-muted-foreground'\n            )\n          \"\n        >\n          {{ asset.description }}\n        </p>\n      </div>\n      <div :class=\"cn('flex gap-4 text-xs text-muted-foreground')\">\n        <span v-if=\"asset.stats.stars\" class=\"flex items-center gap-1\">\n          <i class=\"icon-[lucide--star] size-3\" />\n          {{ asset.stats.stars }}\n        </span>\n        <span v-if=\"asset.stats.downloadCount\" class=\"flex items-center gap-1\">\n          <i class=\"icon-[lucide--download] size-3\" />\n          {{ asset.stats.downloadCount }}\n        </span>\n        <span v-if=\"asset.stats.formattedDate\" class=\"flex items-center gap-1\">\n          <i class=\"icon-[lucide--clock] size-3\" />\n          {{ asset.stats.formattedDate }}\n        </span>\n      </div>\n    </div>\n  </component>\n</template>\n\n<script setup lang=\"ts\">\nimport { useImage } from '@vueuse/core'\nimport { computed, useId } from 'vue'\n\nimport AssetBadgeGroup from '@/platform/assets/components/AssetBadgeGroup.vue'\nimport type { AssetDisplayItem } from '@/platform/assets/composables/useAssetBrowser'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { cn } from '@/utils/tailwindUtil'\n\nconst props = defineProps<{\n  asset: AssetDisplayItem\n  interactive?: boolean\n}>()\n\nconst settingStore = useSettingStore()\n\nconst titleId = useId()\nconst descId = useId()\n\nconst tooltipDelay = computed<number>(() =>\n  settingStore.get('LiteGraph.Node.TooltipDelay')\n)\n\nconst { error } = useImage({\n  src: props.asset.preview_url ?? '',\n  alt: props.asset.name\n})\n\nconst shouldShowImage = computed(() => props.asset.preview_url && !error.value)\n\nconst cardClasses = computed(() => {\n  const base = cn(\n    'rounded-xl overflow-hidden transition-all duration-200 bg-modal-card-background'\n  )\n\n  if (!props.interactive) {\n    return base\n  }\n\n  return cn(\n    base,\n    'group',\n    'appearance-none bg-transparent p-0 m-0',\n    'font-inherit text-inherit outline-none cursor-pointer text-left',\n    'hover:bg-secondary-background',\n    'border-none',\n    'focus:outline-solid outline-azure-600 outline-4'\n  )\n})\n\nconst elementProps = computed(() =>\n  props.interactive\n    ? {\n        type: 'button',\n        'aria-labelledby': titleId,\n        'aria-describedby': descId\n      }\n    : {\n        'aria-labelledby': titleId,\n        'aria-describedby': descId\n      }\n)\n\ndefineEmits<{\n  select: [asset: AssetDisplayItem]\n}>()\n</script>\n","import type { CSSProperties } from 'vue'\n\ninterface GridOptions {\n  /** Minimum width for each grid item (default: 15rem) */\n  minWidth?: string\n  /** Maximum width for each grid item (default: 1fr) */\n  maxWidth?: string\n  /** Padding around the grid (default: 0) */\n  padding?: string\n  /** Gap between grid items (default: 1rem) */\n  gap?: string\n  /** Fixed number of columns (overrides auto-fill with minmax) */\n  columns?: number\n}\n\n/**\n * Creates CSS grid styles for responsive grid layouts\n * @param options Grid configuration options\n * @returns CSS properties object for grid styling\n */\nexport function createGridStyle(options: GridOptions = {}): CSSProperties {\n  const {\n    minWidth = '15rem',\n    maxWidth = '1fr',\n    padding = '0',\n    gap = '1rem',\n    columns\n  } = options\n\n  // Runtime validation for columns\n  if (columns !== undefined && columns < 1) {\n    console.warn('createGridStyle: columns must be >= 1, defaulting to 1')\n  }\n\n  const gridTemplateColumns = columns\n    ? `repeat(${Math.max(1, columns ?? 1)}, 1fr)`\n    : `repeat(auto-fill, minmax(${minWidth}, ${maxWidth}))`\n\n  return {\n    display: 'grid',\n    gridTemplateColumns,\n    padding,\n    gap\n  }\n}\n","<template>\n  <div\n    data-component-id=\"AssetGrid\"\n    :style=\"gridStyle\"\n    role=\"grid\"\n    aria-label=\"Asset collection\"\n    :aria-rowcount=\"-1\"\n    :aria-colcount=\"-1\"\n    :aria-setsize=\"assets.length\"\n  >\n    <!-- Loading state -->\n    <div\n      v-if=\"loading\"\n      class=\"col-span-full flex items-center justify-center py-20\"\n    >\n      <i\n        class=\"icon-[lucide--loader] size-12 animate-spin text-muted-foreground\"\n      />\n    </div>\n    <!-- Empty state -->\n    <div\n      v-else-if=\"assets.length === 0\"\n      class=\"col-span-full flex flex-col items-center justify-center py-16 text-muted-foreground\"\n    >\n      <i class=\"mb-4 icon-[lucide--search] size-10\" />\n      <h3 class=\"mb-2 text-lg font-medium\">\n        {{ $t('assetBrowser.noAssetsFound') }}\n      </h3>\n      <p class=\"text-sm\">{{ $t('assetBrowser.tryAdjustingFilters') }}</p>\n    </div>\n    <template v-else>\n      <AssetCard\n        v-for=\"asset in assets\"\n        :key=\"asset.id\"\n        :asset=\"asset\"\n        :interactive=\"true\"\n        role=\"gridcell\"\n        @select=\"$emit('assetSelect', $event)\"\n      />\n    </template>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\n\nimport AssetCard from '@/platform/assets/components/AssetCard.vue'\nimport type { AssetDisplayItem } from '@/platform/assets/composables/useAssetBrowser'\nimport { createGridStyle } from '@/utils/gridUtil'\n\ndefineProps<{\n  assets: AssetDisplayItem[]\n  loading?: boolean\n}>()\n\ndefineEmits<{\n  assetSelect: [asset: AssetDisplayItem]\n}>()\n\n// Use same grid style as BaseModalLayout\nconst gridStyle = computed(() => createGridStyle())\n</script>\n","import type { AssetItem } from '@/platform/assets/schemas/assetSchema'\n\n/**\n * Type-safe utilities for extracting metadata from assets\n */\n\n/**\n * Safely extracts string description from asset metadata\n * @param asset - The asset to extract description from\n * @returns The description string or null if not present/not a string\n */\nexport function getAssetDescription(asset: AssetItem): string | null {\n  return typeof asset.user_metadata?.description === 'string'\n    ? asset.user_metadata.description\n    : null\n}\n\n/**\n * Safely extracts string base_model from asset metadata\n * @param asset - The asset to extract base_model from\n * @returns The base_model string or null if not present/not a string\n */\nexport function getAssetBaseModel(asset: AssetItem): string | null {\n  return typeof asset.user_metadata?.base_model === 'string'\n    ? asset.user_metadata.base_model\n    : null\n}\n","import { computed, ref } from 'vue'\nimport type { Ref } from 'vue'\nimport { useFuse } from '@vueuse/integrations/useFuse'\nimport type { UseFuseOptions } from '@vueuse/integrations/useFuse'\n\nimport { d, t } from '@/i18n'\nimport type { FilterState } from '@/platform/assets/components/AssetFilterBar.vue'\nimport type { AssetItem } from '@/platform/assets/schemas/assetSchema'\nimport {\n  getAssetBaseModel,\n  getAssetDescription\n} from '@/platform/assets/utils/assetMetadataUtils'\n\nfunction filterByCategory(category: string) {\n  return (asset: AssetItem) => {\n    return category === 'all' || asset.tags.includes(category)\n  }\n}\n\nfunction filterByFileFormats(formats: string[]) {\n  return (asset: AssetItem) => {\n    if (formats.length === 0) return true\n    const formatSet = new Set(formats)\n    const extension = asset.name.split('.').pop()?.toLowerCase()\n    return extension ? formatSet.has(extension) : false\n  }\n}\n\nfunction filterByBaseModels(models: string[]) {\n  return (asset: AssetItem) => {\n    if (models.length === 0) return true\n    const modelSet = new Set(models)\n    const baseModel = getAssetBaseModel(asset)\n    return baseModel ? modelSet.has(baseModel) : false\n  }\n}\n\ntype AssetBadge = {\n  label: string\n  type: 'type' | 'base' | 'size'\n}\n\n// Display properties for transformed assets\nexport interface AssetDisplayItem extends AssetItem {\n  description: string\n  badges: AssetBadge[]\n  stats: {\n    formattedDate?: string\n    downloadCount?: string\n    stars?: string\n  }\n}\n\n/**\n * Asset Browser composable\n * Manages search, filtering, asset transformation and selection logic\n */\nexport function useAssetBrowser(\n  assetsSource: Ref<AssetItem[] | undefined> = ref<AssetItem[] | undefined>([])\n) {\n  const assets = computed<AssetItem[]>(() => assetsSource.value ?? [])\n  // State\n  const searchQuery = ref('')\n  const selectedCategory = ref('all')\n  const filters = ref<FilterState>({\n    sortBy: 'name-asc',\n    fileFormats: [],\n    baseModels: []\n  })\n\n  // Transform API asset to display asset\n  function transformAssetForDisplay(asset: AssetItem): AssetDisplayItem {\n    // Extract description from metadata or create from tags\n    const typeTag = asset.tags.find((tag) => tag !== 'models')\n    const description =\n      getAssetDescription(asset) ||\n      `${typeTag || t('assetBrowser.unknown')} model`\n\n    // Create badges from tags and metadata\n    const badges: AssetBadge[] = []\n\n    // Type badge from non-root tag\n    if (typeTag) {\n      badges.push({ label: typeTag, type: 'type' })\n    }\n\n    // Base model badge from metadata\n    const baseModel = getAssetBaseModel(asset)\n    if (baseModel) {\n      badges.push({\n        label: baseModel,\n        type: 'base'\n      })\n    }\n\n    // Create display stats from API data\n    const stats = {\n      formattedDate: d(new Date(asset.created_at), { dateStyle: 'short' }),\n      downloadCount: undefined, // Not available in API\n      stars: undefined // Not available in API\n    }\n\n    return {\n      ...asset,\n      description,\n      badges,\n      stats\n    }\n  }\n\n  const availableCategories = computed(() => {\n    const categories = assets.value\n      .filter((asset) => asset.tags[0] === 'models')\n      .map((asset) => asset.tags[1])\n      .filter((tag): tag is string => typeof tag === 'string' && tag.length > 0)\n\n    const uniqueCategories = Array.from(new Set(categories))\n      .sort()\n      .map((category) => ({\n        id: category,\n        label: category.charAt(0).toUpperCase() + category.slice(1),\n        icon: 'icon-[lucide--package]'\n      }))\n\n    return [\n      {\n        id: 'all',\n        label: t('assetBrowser.allModels'),\n        icon: 'icon-[lucide--folder]'\n      },\n      ...uniqueCategories\n    ]\n  })\n\n  // Compute content title from selected category\n  const contentTitle = computed(() => {\n    if (selectedCategory.value === 'all') {\n      return t('assetBrowser.allModels')\n    }\n\n    const category = availableCategories.value.find(\n      (cat) => cat.id === selectedCategory.value\n    )\n    return category?.label || t('assetBrowser.assets')\n  })\n\n  // Category-filtered assets for filter options (before search/format/base model filters)\n  const categoryFilteredAssets = computed(() => {\n    return assets.value.filter(filterByCategory(selectedCategory.value))\n  })\n\n  const fuseOptions: UseFuseOptions<AssetItem> = {\n    fuseOptions: {\n      keys: [\n        { name: 'name', weight: 0.4 },\n        { name: 'tags', weight: 0.3 }\n      ],\n      threshold: 0.4, // Higher threshold for typo tolerance (0.0 = exact, 1.0 = match all)\n      ignoreLocation: true, // Search anywhere in the string, not just at the beginning\n      includeScore: true\n    },\n    matchAllWhenSearchEmpty: true\n  }\n\n  const { results: fuseResults } = useFuse(\n    searchQuery,\n    categoryFilteredAssets,\n    fuseOptions\n  )\n\n  const searchFiltered = computed(() =>\n    fuseResults.value.map((result) => result.item)\n  )\n\n  const filteredAssets = computed(() => {\n    const filtered = searchFiltered.value\n      .filter(filterByFileFormats(filters.value.fileFormats))\n      .filter(filterByBaseModels(filters.value.baseModels))\n\n    const sortedAssets = [...filtered]\n    sortedAssets.sort((a, b) => {\n      switch (filters.value.sortBy) {\n        case 'name-desc':\n          return b.name.localeCompare(a.name)\n        case 'recent':\n          return (\n            new Date(b.created_at).getTime() - new Date(a.created_at).getTime()\n          )\n        case 'popular':\n          return a.name.localeCompare(b.name)\n        case 'name-asc':\n        default:\n          return a.name.localeCompare(b.name)\n      }\n    })\n\n    // Transform to display format\n    return sortedAssets.map(transformAssetForDisplay)\n  })\n\n  function updateFilters(newFilters: FilterState) {\n    filters.value = { ...newFilters }\n  }\n\n  return {\n    searchQuery,\n    selectedCategory,\n    availableCategories,\n    contentTitle,\n    categoryFilteredAssets,\n    filteredAssets,\n    updateFilters\n  }\n}\n","const ACRONYM_TAGS = new Set(['VAE', 'CLIP', 'GLIGEN'])\n\nexport function formatCategoryLabel(raw?: string): string {\n  if (!raw) return 'Models'\n\n  // Special display name mappings\n  if (raw === 'diffusion_models') return 'Diffusion'\n\n  return raw\n    .split('_')\n    .map((segment) => {\n      const upper = segment.toUpperCase()\n      if (ACRONYM_TAGS.has(upper)) return upper\n\n      const lower = segment.toLowerCase()\n      return lower.charAt(0).toUpperCase() + lower.slice(1)\n    })\n    .join(' ')\n}\n","<template>\n  <BaseModalLayout\n    data-component-id=\"AssetBrowserModal\"\n    class=\"size-full max-h-full max-w-full min-w-0\"\n    :content-title=\"displayTitle\"\n    @close=\"handleClose\"\n  >\n    <template v-if=\"shouldShowLeftPanel\" #leftPanel>\n      <LeftSidePanel\n        v-model=\"selectedCategory\"\n        data-component-id=\"AssetBrowserModal-LeftSidePanel\"\n        :nav-items=\"availableCategories\"\n      >\n        <template #header-icon>\n          <div class=\"icon-[lucide--folder] size-4\" />\n        </template>\n        <template #header-title>\n          <span class=\"capitalize\">{{ displayTitle }}</span>\n        </template>\n      </LeftSidePanel>\n    </template>\n\n    <template #header>\n      <div class=\"flex w-full items-center justify-between gap-2\">\n        <SearchBox\n          v-model=\"searchQuery\"\n          :autofocus=\"true\"\n          size=\"lg\"\n          :placeholder=\"$t('assetBrowser.searchAssetsPlaceholder')\"\n          class=\"max-w-96\"\n        />\n        <IconTextButton\n          v-if=\"isUploadButtonEnabled\"\n          type=\"accent\"\n          size=\"md\"\n          class=\"!h-10 [&>span]:hidden md:[&>span]:inline\"\n          :label=\"$t('assetBrowser.uploadModel')\"\n          :on-click=\"handleUploadClick\"\n        >\n          <template #icon>\n            <i class=\"icon-[lucide--upload]\" />\n          </template>\n        </IconTextButton>\n      </div>\n    </template>\n\n    <template #contentFilter>\n      <AssetFilterBar\n        :assets=\"categoryFilteredAssets\"\n        @filter-change=\"updateFilters\"\n      />\n    </template>\n\n    <template #content>\n      <AssetGrid\n        :assets=\"filteredAssets\"\n        :loading=\"isLoading\"\n        @asset-select=\"handleAssetSelectAndEmit\"\n      />\n    </template>\n  </BaseModalLayout>\n</template>\n\n<script setup lang=\"ts\">\nimport { useAsyncState } from '@vueuse/core'\nimport { computed, provide, watch } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport IconTextButton from '@/components/button/IconTextButton.vue'\nimport SearchBox from '@/components/input/SearchBox.vue'\nimport BaseModalLayout from '@/components/widget/layout/BaseModalLayout.vue'\nimport LeftSidePanel from '@/components/widget/panel/LeftSidePanel.vue'\nimport { useFeatureFlags } from '@/composables/useFeatureFlags'\nimport AssetFilterBar from '@/platform/assets/components/AssetFilterBar.vue'\nimport AssetGrid from '@/platform/assets/components/AssetGrid.vue'\nimport type { AssetDisplayItem } from '@/platform/assets/composables/useAssetBrowser'\nimport { useAssetBrowser } from '@/platform/assets/composables/useAssetBrowser'\nimport type { AssetItem } from '@/platform/assets/schemas/assetSchema'\nimport { assetService } from '@/platform/assets/services/assetService'\nimport { formatCategoryLabel } from '@/platform/assets/utils/categoryLabel'\nimport { useModelToNodeStore } from '@/stores/modelToNodeStore'\nimport { OnCloseKey } from '@/types/widgetTypes'\n\nconst props = defineProps<{\n  nodeType?: string\n  inputName?: string\n  onSelect?: (asset: AssetItem) => void\n  onClose?: () => void\n  showLeftPanel?: boolean\n  title?: string\n  assetType?: string\n}>()\n\nconst { t } = useI18n()\n\nconst emit = defineEmits<{\n  'asset-select': [asset: AssetDisplayItem]\n  close: []\n}>()\n\nprovide(OnCloseKey, props.onClose ?? (() => {}))\n\nconst fetchAssets = async () => {\n  if (props.nodeType) {\n    return (await assetService.getAssetsForNodeType(props.nodeType)) ?? []\n  }\n\n  if (props.assetType) {\n    return (await assetService.getAssetsByTag(props.assetType)) ?? []\n  }\n\n  return []\n}\n\nconst {\n  state: fetchedAssets,\n  isLoading,\n  execute\n} = useAsyncState<AssetItem[]>(fetchAssets, [], { immediate: false })\n\nwatch(\n  () => [props.nodeType, props.assetType],\n  async () => {\n    await execute()\n  },\n  { immediate: true }\n)\n\nconst {\n  searchQuery,\n  selectedCategory,\n  availableCategories,\n  categoryFilteredAssets,\n  filteredAssets,\n  updateFilters\n} = useAssetBrowser(fetchedAssets)\n\nconst modelToNodeStore = useModelToNodeStore()\n\nconst primaryCategoryTag = computed(() => {\n  const assets = fetchedAssets.value ?? []\n  const tagFromAssets = assets\n    .map((asset) => asset.tags?.find((tag) => tag !== 'models'))\n    .find((tag): tag is string => typeof tag === 'string' && tag.length > 0)\n\n  if (tagFromAssets) return tagFromAssets\n\n  if (props.nodeType) {\n    const mapped = modelToNodeStore.getCategoryForNodeType(props.nodeType)\n    if (mapped) return mapped\n  }\n\n  if (props.assetType) return props.assetType\n\n  return 'models'\n})\n\nconst activeCategoryTag = computed(() => {\n  if (selectedCategory.value !== 'all') {\n    return selectedCategory.value\n  }\n  return primaryCategoryTag.value\n})\n\nconst displayTitle = computed(() => {\n  if (props.title) return props.title\n\n  const label = formatCategoryLabel(activeCategoryTag.value)\n  return t('assetBrowser.allCategory', { category: label })\n})\n\nconst shouldShowLeftPanel = computed(() => {\n  return props.showLeftPanel ?? true\n})\n\nfunction handleClose() {\n  props.onClose?.()\n  emit('close')\n}\n\nfunction handleAssetSelectAndEmit(asset: AssetDisplayItem) {\n  emit('asset-select', asset)\n  // onSelect callback is provided by dialog composable layer\n  // It handles the appropriate transformation (filename extraction or full asset)\n  props.onSelect?.(asset)\n}\n\nconst { flags } = useFeatureFlags()\nconst isUploadButtonEnabled = computed(() => flags.modelUploadButtonEnabled)\n\nfunction handleUploadClick() {\n  // Will be implemented in the future commit\n}\n</script>\n","import AssetBrowserModal from '@/platform/assets/components/AssetBrowserModal.vue'\nimport type { AssetItem } from '@/platform/assets/schemas/assetSchema'\nimport { useDialogStore } from '@/stores/dialogStore'\nimport type { DialogComponentProps } from '@/stores/dialogStore'\n\ninterface ShowOptions {\n  /** ComfyUI node type for context (e.g., 'CheckpointLoaderSimple') */\n  nodeType: string\n  /** Widget input name (e.g., 'ckpt_name') */\n  inputName: string\n  /** Current selected asset value */\n  currentValue?: string\n  onAssetSelected?: (asset: AssetItem) => void\n}\n\ninterface BrowseOptions {\n  /** Asset type tag to filter by (e.g., 'models') */\n  assetType: string\n  /** Custom modal title (optional) */\n  title?: string\n  /** Called when asset selected */\n  onAssetSelected?: (asset: AssetItem) => void\n}\n\nconst dialogComponentProps: DialogComponentProps = {\n  headless: true,\n  modal: true,\n  closable: true,\n  pt: {\n    root: {\n      class: 'rounded-2xl overflow-hidden asset-browser-dialog'\n    },\n    header: {\n      class: '!p-0 hidden'\n    },\n    content: {\n      class: '!p-0 !m-0 h-full w-full'\n    }\n  }\n} as const\n\nexport const useAssetBrowserDialog = () => {\n  const dialogStore = useDialogStore()\n  const dialogKey = 'global-asset-browser'\n\n  async function show(props: ShowOptions) {\n    const handleAssetSelected = (asset: AssetItem) => {\n      props.onAssetSelected?.(asset)\n      dialogStore.closeDialog({ key: dialogKey })\n    }\n\n    dialogStore.showDialog({\n      key: dialogKey,\n      component: AssetBrowserModal,\n      props: {\n        nodeType: props.nodeType,\n        inputName: props.inputName,\n        currentValue: props.currentValue,\n        onSelect: handleAssetSelected,\n        onClose: () => dialogStore.closeDialog({ key: dialogKey })\n      },\n      dialogComponentProps\n    })\n  }\n\n  async function browse(options: BrowseOptions): Promise<void> {\n    const handleAssetSelected = (asset: AssetItem) => {\n      options.onAssetSelected?.(asset)\n      dialogStore.closeDialog({ key: dialogKey })\n    }\n\n    dialogStore.showDialog({\n      key: dialogKey,\n      component: AssetBrowserModal,\n      props: {\n        showLeftPanel: true,\n        assetType: options.assetType,\n        title: options.title,\n        onSelect: handleAssetSelected,\n        onClose: () => dialogStore.closeDialog({ key: dialogKey })\n      },\n      dialogComponentProps\n    })\n  }\n\n  return { show, browse }\n}\n","<template>\n  <div\n    v-if=\"imageUrls.length > 0\"\n    class=\"video-preview group relative flex size-full min-h-16 min-w-16 flex-col px-2\"\n    tabindex=\"0\"\n    role=\"region\"\n    :aria-label=\"$t('g.videoPreview')\"\n    @mouseenter=\"handleMouseEnter\"\n    @mouseleave=\"handleMouseLeave\"\n    @keydown=\"handleKeyDown\"\n  >\n    <!-- Video Wrapper -->\n    <div\n      class=\"relative h-88 w-full grow overflow-hidden rounded-[5px] bg-node-component-surface\"\n    >\n      <!-- Error State -->\n      <div\n        v-if=\"videoError\"\n        class=\"flex size-full flex-col items-center justify-center bg-smoke-800/50 text-center text-white\"\n      >\n        <i class=\"mb-2 icon-[lucide--video-off] h-12 w-12 text-smoke-400\" />\n        <p class=\"text-sm text-smoke-300\">{{ $t('g.videoFailedToLoad') }}</p>\n        <p class=\"mt-1 text-xs text-smoke-400\">\n          {{ getVideoFilename(currentVideoUrl) }}\n        </p>\n      </div>\n\n      <!-- Loading State -->\n      <Skeleton v-else-if=\"isLoading\" class=\"size-full\" border-radius=\"5px\" />\n\n      <!-- Main Video -->\n      <video\n        v-else\n        :src=\"currentVideoUrl\"\n        class=\"block size-full object-contain\"\n        controls\n        loop\n        playsinline\n        @loadeddata=\"handleVideoLoad\"\n        @error=\"handleVideoError\"\n      />\n\n      <!-- Floating Action Buttons (appear on hover) -->\n      <div v-if=\"isHovered\" class=\"actions absolute top-2 right-2 flex gap-1\">\n        <!-- Download Button -->\n        <button\n          class=\"action-btn cursor-pointer rounded-lg border-0 bg-white p-2 text-black shadow-sm transition-all duration-200 hover:bg-smoke-100\"\n          :title=\"$t('g.downloadVideo')\"\n          :aria-label=\"$t('g.downloadVideo')\"\n          @click=\"handleDownload\"\n        >\n          <i class=\"icon-[lucide--download] h-4 w-4\" />\n        </button>\n\n        <!-- Close Button -->\n        <button\n          class=\"action-btn cursor-pointer rounded-lg border-0 bg-white p-2 text-black shadow-sm transition-all duration-200 hover:bg-smoke-100\"\n          :title=\"$t('g.removeVideo')\"\n          :aria-label=\"$t('g.removeVideo')\"\n          @click=\"handleRemove\"\n        >\n          <i class=\"icon-[lucide--x] h-4 w-4\" />\n        </button>\n      </div>\n\n      <!-- Multiple Videos Navigation -->\n      <div\n        v-if=\"hasMultipleVideos\"\n        class=\"absolute right-2 bottom-2 left-2 flex justify-center gap-1\"\n      >\n        <button\n          v-for=\"(_, index) in imageUrls\"\n          :key=\"index\"\n          :class=\"getNavigationDotClass(index)\"\n          :aria-label=\"\n            $t('g.viewVideoOfTotal', {\n              index: index + 1,\n              total: imageUrls.length\n            })\n          \"\n          @click=\"setCurrentIndex(index)\"\n        />\n      </div>\n    </div>\n\n    <div class=\"relative\">\n      <!-- Video Dimensions -->\n      <div class=\"mt-2 text-center text-xs text-white\">\n        <span v-if=\"videoError\" class=\"text-red-400\">\n          {{ $t('g.errorLoadingVideo') }}\n        </span>\n        <span v-else-if=\"isLoading\" class=\"text-smoke-400\">\n          {{ $t('g.loading') }}...\n        </span>\n        <span v-else>\n          {{ actualDimensions || $t('g.calculatingDimensions') }}\n        </span>\n      </div>\n      <LODFallback />\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useToast } from 'primevue'\nimport Skeleton from 'primevue/skeleton'\nimport { computed, ref, watch } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport { downloadFile } from '@/base/common/downloadUtil'\nimport { useNodeOutputStore } from '@/stores/imagePreviewStore'\n\nimport LODFallback from './components/LODFallback.vue'\n\ninterface VideoPreviewProps {\n  /** Array of video URLs to display */\n  readonly imageUrls: readonly string[] // Named imageUrls for consistency with parent components\n  /** Optional node ID for context-aware actions */\n  readonly nodeId?: string\n}\n\nconst props = defineProps<VideoPreviewProps>()\n\nconst { t } = useI18n()\nconst nodeOutputStore = useNodeOutputStore()\n\n// Component state\nconst currentIndex = ref(0)\nconst isHovered = ref(false)\nconst actualDimensions = ref<string | null>(null)\nconst videoError = ref(false)\nconst isLoading = ref(false)\n\n// Computed values\nconst currentVideoUrl = computed(() => props.imageUrls[currentIndex.value])\nconst hasMultipleVideos = computed(() => props.imageUrls.length > 1)\n\n// Watch for URL changes and reset state\nwatch(\n  () => props.imageUrls,\n  (newUrls) => {\n    // Reset current index if it's out of bounds\n    if (currentIndex.value >= newUrls.length) {\n      currentIndex.value = 0\n    }\n\n    // Reset loading and error states when URLs change\n    actualDimensions.value = null\n    videoError.value = false\n    isLoading.value = false\n  },\n  { deep: true }\n)\n\n// Event handlers\nconst handleVideoLoad = (event: Event) => {\n  if (!event.target || !(event.target instanceof HTMLVideoElement)) return\n  const video = event.target\n  isLoading.value = false\n  videoError.value = false\n  if (video.videoWidth && video.videoHeight) {\n    actualDimensions.value = `${video.videoWidth} x ${video.videoHeight}`\n  }\n}\n\nconst handleVideoError = () => {\n  isLoading.value = false\n  videoError.value = true\n  actualDimensions.value = null\n}\n\nconst handleDownload = () => {\n  try {\n    downloadFile(currentVideoUrl.value)\n  } catch (error) {\n    useToast().add({\n      severity: 'error',\n      summary: 'Error',\n      detail: t('g.failedToDownloadVideo'),\n      life: 3000,\n      group: 'video-preview'\n    })\n  }\n}\n\nconst handleRemove = () => {\n  if (!props.nodeId) return\n  nodeOutputStore.removeNodeOutputs(props.nodeId)\n}\n\nconst setCurrentIndex = (index: number) => {\n  if (index >= 0 && index < props.imageUrls.length) {\n    currentIndex.value = index\n    actualDimensions.value = null\n    isLoading.value = true\n    videoError.value = false\n  }\n}\n\nconst handleMouseEnter = () => {\n  isHovered.value = true\n}\n\nconst handleMouseLeave = () => {\n  isHovered.value = false\n}\n\nconst getNavigationDotClass = (index: number) => {\n  return [\n    'w-2 h-2 rounded-full transition-all duration-200 border-0 cursor-pointer',\n    index === currentIndex.value ? 'bg-white' : 'bg-white/50 hover:bg-white/80'\n  ]\n}\n\nconst handleKeyDown = (event: KeyboardEvent) => {\n  if (props.imageUrls.length <= 1) return\n\n  switch (event.key) {\n    case 'ArrowLeft':\n      event.preventDefault()\n      setCurrentIndex(\n        currentIndex.value > 0\n          ? currentIndex.value - 1\n          : props.imageUrls.length - 1\n      )\n      break\n    case 'ArrowRight':\n      event.preventDefault()\n      setCurrentIndex(\n        currentIndex.value < props.imageUrls.length - 1\n          ? currentIndex.value + 1\n          : 0\n      )\n      break\n    case 'Home':\n      event.preventDefault()\n      setCurrentIndex(0)\n      break\n    case 'End':\n      event.preventDefault()\n      setCurrentIndex(props.imageUrls.length - 1)\n      break\n  }\n}\n\nconst getVideoFilename = (url: string): string => {\n  try {\n    return new URL(url).searchParams.get('filename') || 'Unknown file'\n  } catch {\n    return 'Invalid URL'\n  }\n}\n</script>\n","<template>\n  <div\n    v-if=\"imageUrls.length > 0\"\n    class=\"image-preview group relative flex size-full min-h-16 min-w-16 flex-col px-2 justify-center\"\n    tabindex=\"0\"\n    role=\"region\"\n    :aria-label=\"$t('g.imagePreview')\"\n    @mouseenter=\"handleMouseEnter\"\n    @mouseleave=\"handleMouseLeave\"\n    @keydown=\"handleKeyDown\"\n  >\n    <!-- Image Wrapper -->\n    <div\n      class=\"min-h-88 w-full overflow-hidden rounded-[5px] bg-node-component-surface\"\n    >\n      <!-- Error State -->\n      <div\n        v-if=\"imageError\"\n        class=\"flex size-full flex-col items-center justify-center bg-smoke-800/50 text-center text-white\"\n      >\n        <i class=\"mb-2 icon-[lucide--image-off] h-12 w-12 text-smoke-400\" />\n        <p class=\"text-sm text-smoke-300\">{{ $t('g.imageFailedToLoad') }}</p>\n        <p class=\"mt-1 text-xs text-smoke-400\">\n          {{ getImageFilename(currentImageUrl) }}\n        </p>\n      </div>\n\n      <!-- Loading State -->\n      <Skeleton v-else-if=\"isLoading\" class=\"size-full\" border-radius=\"5px\" />\n\n      <!-- Main Image -->\n      <img\n        v-else\n        ref=\"currentImageEl\"\n        :src=\"currentImageUrl\"\n        :alt=\"imageAltText\"\n        class=\"block size-full object-contain pointer-events-none\"\n        @load=\"handleImageLoad\"\n        @error=\"handleImageError\"\n      />\n\n      <!-- Floating Action Buttons (appear on hover) -->\n      <div v-if=\"isHovered\" class=\"actions absolute top-2 right-2 flex gap-2.5\">\n        <!-- Mask/Edit Button -->\n        <button\n          v-if=\"!hasMultipleImages\"\n          :class=\"actionButtonClass\"\n          :title=\"$t('g.editOrMaskImage')\"\n          :aria-label=\"$t('g.editOrMaskImage')\"\n          @click=\"handleEditMask\"\n        >\n          <i-comfy:mask class=\"h-4 w-4\" />\n        </button>\n\n        <!-- Download Button -->\n        <button\n          :class=\"actionButtonClass\"\n          :title=\"$t('g.downloadImage')\"\n          :aria-label=\"$t('g.downloadImage')\"\n          @click=\"handleDownload\"\n        >\n          <i class=\"icon-[lucide--download] h-4 w-4\" />\n        </button>\n\n        <!-- Close Button -->\n        <button\n          :class=\"actionButtonClass\"\n          :title=\"$t('g.removeImage')\"\n          :aria-label=\"$t('g.removeImage')\"\n          @click=\"handleRemove\"\n        >\n          <i class=\"icon-[lucide--x] h-4 w-4\" />\n        </button>\n      </div>\n\n      <!-- Multiple Images Navigation -->\n      <div\n        v-if=\"hasMultipleImages\"\n        class=\"absolute right-2 bottom-2 left-2 flex justify-center gap-1\"\n      >\n        <button\n          v-for=\"(_, index) in imageUrls\"\n          :key=\"index\"\n          :class=\"getNavigationDotClass(index)\"\n          :aria-label=\"\n            $t('g.viewImageOfTotal', {\n              index: index + 1,\n              total: imageUrls.length\n            })\n          \"\n          @click=\"setCurrentIndex(index)\"\n        />\n      </div>\n    </div>\n\n    <div class=\"relative\">\n      <!-- Image Dimensions -->\n      <div class=\"mt-2 text-center text-xs text-white\">\n        <span v-if=\"imageError\" class=\"text-red-400\">\n          {{ $t('g.errorLoadingImage') }}\n        </span>\n        <span v-else-if=\"isLoading\" class=\"text-smoke-400\">\n          {{ $t('g.loading') }}...\n        </span>\n        <span v-else>\n          {{ actualDimensions || $t('g.calculatingDimensions') }}\n        </span>\n      </div>\n      <LODFallback />\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useToast } from 'primevue'\nimport Skeleton from 'primevue/skeleton'\nimport { computed, ref, watch } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport { downloadFile } from '@/base/common/downloadUtil'\nimport { app } from '@/scripts/app'\nimport { useCommandStore } from '@/stores/commandStore'\nimport { useNodeOutputStore } from '@/stores/imagePreviewStore'\n\nimport LODFallback from './LODFallback.vue'\n\ninterface ImagePreviewProps {\n  /** Array of image URLs to display */\n  readonly imageUrls: readonly string[]\n  /** Optional node ID for context-aware actions */\n  readonly nodeId?: string\n}\n\nconst props = defineProps<ImagePreviewProps>()\n\nconst { t } = useI18n()\nconst commandStore = useCommandStore()\nconst nodeOutputStore = useNodeOutputStore()\n\nconst actionButtonClass =\n  'flex h-8 min-h-8 items-center justify-center gap-2.5 rounded-lg border-0 bg-button-surface px-2 py-2 text-button-surface-contrast shadow-sm transition-colors duration-200 hover:bg-button-hover-surface focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-button-surface-contrast focus-visible:ring-offset-2 focus-visible:ring-offset-transparent cursor-pointer'\n\n// Component state\nconst currentIndex = ref(0)\nconst isHovered = ref(false)\nconst actualDimensions = ref<string | null>(null)\nconst imageError = ref(false)\nconst isLoading = ref(false)\n\nconst currentImageEl = ref<HTMLImageElement>()\n\n// Computed values\nconst currentImageUrl = computed(() => props.imageUrls[currentIndex.value])\nconst hasMultipleImages = computed(() => props.imageUrls.length > 1)\nconst imageAltText = computed(() => `Node output ${currentIndex.value + 1}`)\n\n// Watch for URL changes and reset state\nwatch(\n  () => props.imageUrls,\n  (newUrls) => {\n    // Reset current index if it's out of bounds\n    if (currentIndex.value >= newUrls.length) {\n      currentIndex.value = 0\n    }\n\n    // Reset loading and error states when URLs change\n    actualDimensions.value = null\n    imageError.value = false\n    isLoading.value = false\n  },\n  { deep: true }\n)\n\n// Event handlers\nconst handleImageLoad = (event: Event) => {\n  if (!event.target || !(event.target instanceof HTMLImageElement)) return\n  const img = event.target\n  isLoading.value = false\n  imageError.value = false\n  if (img.naturalWidth && img.naturalHeight) {\n    actualDimensions.value = `${img.naturalWidth} x ${img.naturalHeight}`\n  }\n}\n\nconst handleImageError = () => {\n  isLoading.value = false\n  imageError.value = true\n  actualDimensions.value = null\n}\n\n// In vueNodes mode, we need to set them manually before opening the mask editor.\nconst setupNodeForMaskEditor = () => {\n  if (!props.nodeId || !currentImageEl.value) return\n  const node = app.rootGraph?.getNodeById(props.nodeId)\n  if (!node) return\n  node.imageIndex = currentIndex.value\n  node.imgs = [currentImageEl.value]\n  app.canvas?.select(node)\n}\n\nconst handleEditMask = () => {\n  setupNodeForMaskEditor()\n  void commandStore.execute('Comfy.MaskEditor.OpenMaskEditor')\n}\n\nconst handleDownload = () => {\n  try {\n    downloadFile(currentImageUrl.value)\n  } catch (error) {\n    useToast().add({\n      severity: 'error',\n      summary: 'Error',\n      detail: t('g.failedToDownloadImage'),\n      life: 3000,\n      group: 'image-preview'\n    })\n  }\n}\n\nconst handleRemove = () => {\n  if (!props.nodeId) return\n  nodeOutputStore.removeNodeOutputs(props.nodeId)\n}\n\nconst setCurrentIndex = (index: number) => {\n  if (index >= 0 && index < props.imageUrls.length) {\n    currentIndex.value = index\n    actualDimensions.value = null\n    isLoading.value = false\n    imageError.value = false\n  }\n}\n\nconst handleMouseEnter = () => {\n  isHovered.value = true\n}\n\nconst handleMouseLeave = () => {\n  isHovered.value = false\n}\n\nconst getNavigationDotClass = (index: number) => {\n  return [\n    'w-2 h-2 rounded-full transition-all duration-200 border-0 cursor-pointer',\n    index === currentIndex.value ? 'bg-white' : 'bg-white/50 hover:bg-white/80'\n  ]\n}\n\nconst handleKeyDown = (event: KeyboardEvent) => {\n  if (props.imageUrls.length <= 1) return\n\n  switch (event.key) {\n    case 'ArrowLeft':\n      event.preventDefault()\n      setCurrentIndex(\n        currentIndex.value > 0\n          ? currentIndex.value - 1\n          : props.imageUrls.length - 1\n      )\n      break\n    case 'ArrowRight':\n      event.preventDefault()\n      setCurrentIndex(\n        currentIndex.value < props.imageUrls.length - 1\n          ? currentIndex.value + 1\n          : 0\n      )\n      break\n    case 'Home':\n      event.preventDefault()\n      setCurrentIndex(0)\n      break\n    case 'End':\n      event.preventDefault()\n      setCurrentIndex(props.imageUrls.length - 1)\n      break\n  }\n}\n\nconst getImageFilename = (url: string): string => {\n  try {\n    return new URL(url).searchParams.get('filename') || 'Unknown file'\n  } catch {\n    return 'Invalid URL'\n  }\n}\n</script>\n","<template>\n  <div v-if=\"renderError\" class=\"node-error p-2 text-sm text-red-500\">\n    {{ st('nodeErrors.content', 'Node Content Error') }}\n  </div>\n  <div v-else class=\"lg-node-content flex grow flex-col\">\n    <!-- Default slot for custom content -->\n    <slot>\n      <VideoPreview\n        v-if=\"hasMedia && media?.type === 'video'\"\n        :image-urls=\"media.urls\"\n        :node-id=\"nodeId\"\n        class=\"mt-2\"\n      />\n      <ImagePreview\n        v-else-if=\"hasMedia && media?.type === 'image'\"\n        :image-urls=\"media.urls\"\n        :node-id=\"nodeId\"\n        class=\"mt-2\"\n      />\n    </slot>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, onErrorCaptured, ref } from 'vue'\n\nimport type { VueNodeData } from '@/composables/graph/useGraphNodeManager'\nimport { useErrorHandling } from '@/composables/useErrorHandling'\nimport { st } from '@/i18n'\n\nimport VideoPreview from '../VideoPreview.vue'\nimport ImagePreview from './ImagePreview.vue'\n\ninterface NodeContentProps {\n  nodeData?: VueNodeData\n  media?: {\n    type: 'image' | 'video'\n    urls: string[]\n  }\n}\n\nconst props = defineProps<NodeContentProps>()\n\nconst hasMedia = computed(() => props.media && props.media.urls.length > 0)\n\n// Get node ID from nodeData\nconst nodeId = computed(() => props.nodeData?.id?.toString())\n\n// Error boundary implementation\nconst renderError = ref<string | null>(null)\nconst { toastErrorHandler } = useErrorHandling()\n\nonErrorCaptured((error) => {\n  renderError.value = error.message\n  toastErrorHandler(error)\n  return false\n})\n</script>\n","<template>\n  <!-- Icon-only mode with Popover -->\n  <div\n    v-if=\"displayMode === 'icon-only'\"\n    class=\"relative inline-flex h-full shrink-0 items-center justify-center px-2\"\n    :class=\"clickableClasses\"\n    :style=\"menuBackgroundStyle\"\n    @click=\"togglePopover\"\n  >\n    <i\n      v-if=\"iconClass\"\n      :class=\"['shrink-0 text-base', iconClass, iconColorClass]\"\n    />\n    <div\n      v-else-if=\"badge.label\"\n      class=\"shrink-0 rounded-full px-1.5 py-0.5 text-xxxs font-semibold\"\n      :class=\"labelClasses\"\n    >\n      {{ badge.label }}\n    </div>\n    <div v-else class=\"size-2 shrink-0 rounded-full\" :class=\"dotClasses\" />\n    <Popover\n      ref=\"popover\"\n      append-to=\"body\"\n      :auto-z-index=\"true\"\n      :base-z-index=\"1000\"\n      :dismissable=\"true\"\n      :close-on-escape=\"true\"\n      unstyled\n      :pt=\"popoverPt\"\n    >\n      <div class=\"flex max-w-xs min-w-40 flex-col gap-2 p-3\">\n        <div\n          v-if=\"badge.label\"\n          class=\"w-fit rounded-full px-1.5 py-0.5 text-xxxs font-semibold\"\n          :class=\"labelClasses\"\n        >\n          {{ badge.label }}\n        </div>\n        <div class=\"text-sm font-inter\">{{ badge.text }}</div>\n        <div v-if=\"badge.tooltip\" class=\"text-xs\">\n          {{ badge.tooltip }}\n        </div>\n      </div>\n    </Popover>\n  </div>\n\n  <!-- Compact mode: Icon + Label only with Popover -->\n  <div\n    v-else-if=\"displayMode === 'compact'\"\n    class=\"relative inline-flex h-full\"\n    :style=\"menuBackgroundStyle\"\n  >\n    <div\n      class=\"flex h-full shrink-0 items-center gap-2 whitespace-nowrap\"\n      :class=\"[\n        { 'flex-row-reverse': reverseOrder },\n        noPadding ? '' : 'px-3',\n        clickableClasses\n      ]\"\n      @click=\"togglePopover\"\n    >\n      <i\n        v-if=\"iconClass\"\n        :class=\"['shrink-0 text-base', iconClass, iconColorClass]\"\n      />\n      <div\n        v-if=\"badge.label\"\n        class=\"shrink-0 rounded-full px-1.5 py-0.5 text-xxxs font-semibold\"\n        :class=\"labelClasses\"\n      >\n        {{ badge.label }}\n      </div>\n    </div>\n    <Popover\n      ref=\"popover\"\n      append-to=\"body\"\n      :auto-z-index=\"true\"\n      :base-z-index=\"1000\"\n      :dismissable=\"true\"\n      :close-on-escape=\"true\"\n      unstyled\n      :pt=\"popoverPt\"\n    >\n      <div class=\"flex max-w-xs min-w-40 flex-col gap-2 p-3\">\n        <div\n          v-if=\"badge.label\"\n          class=\"w-fit rounded-full px-1.5 py-0.5 text-xxxs font-semibold\"\n          :class=\"labelClasses\"\n        >\n          {{ badge.label }}\n        </div>\n        <div class=\"text-sm font-inter\">{{ badge.text }}</div>\n        <div v-if=\"badge.tooltip\" class=\"text-xs\">\n          {{ badge.tooltip }}\n        </div>\n      </div>\n    </Popover>\n  </div>\n\n  <!-- Full mode: Icon + Label + Text -->\n  <div\n    v-else\n    v-tooltip=\"badge.tooltip\"\n    class=\"flex h-full shrink-0 items-center gap-2 whitespace-nowrap\"\n    :class=\"[{ 'flex-row-reverse': reverseOrder }, noPadding ? '' : 'px-3']\"\n    :style=\"menuBackgroundStyle\"\n  >\n    <i\n      v-if=\"iconClass\"\n      :class=\"['shrink-0 text-base', iconClass, iconColorClass]\"\n    />\n    <div\n      v-if=\"badge.label\"\n      class=\"shrink-0 rounded-full px-1.5 py-0.5 text-xxxs font-semibold\"\n      :class=\"labelClasses\"\n    >\n      {{ badge.label }}\n    </div>\n    <div class=\"font-inter text-sm\" :class=\"textClasses\">\n      {{ badge.text }}\n    </div>\n  </div>\n</template>\n<script setup lang=\"ts\">\nimport Popover from 'primevue/popover'\nimport { computed, ref } from 'vue'\n\nimport type { TopbarBadge } from '@/types/comfy'\nimport { cn } from '@/utils/tailwindUtil'\n\nconst props = withDefaults(\n  defineProps<{\n    badge: TopbarBadge\n    displayMode?: 'full' | 'compact' | 'icon-only'\n    reverseOrder?: boolean\n    noPadding?: boolean\n    backgroundColor?: string\n  }>(),\n  {\n    displayMode: 'full',\n    reverseOrder: false,\n    noPadding: false,\n    backgroundColor: 'var(--comfy-menu-bg)'\n  }\n)\n\nconst popover = ref<InstanceType<typeof Popover>>()\n\nconst togglePopover = (event: Event) => {\n  popover.value?.toggle(event)\n}\n\nconst variant = computed(() => props.badge.variant ?? 'info')\n\nconst menuBackgroundStyle = computed(() => ({\n  backgroundColor: props.backgroundColor\n}))\n\nconst labelClasses = computed(() => {\n  switch (variant.value) {\n    case 'error':\n      return 'bg-danger-100 text-white'\n    case 'warning':\n      return 'bg-gold-600 text-black'\n    case 'info':\n    default:\n      return 'bg-white text-black'\n  }\n})\n\nconst textClasses = computed(() => {\n  switch (variant.value) {\n    case 'error':\n      return 'text-danger-100'\n    case 'warning':\n      return 'text-gold-600'\n    case 'info':\n    default:\n      return 'text-text-primary'\n  }\n})\n\nconst iconColorClass = computed(() => textClasses.value)\n\nconst iconClass = computed(() => {\n  if (props.badge.icon) {\n    return props.badge.icon\n  }\n  switch (variant.value) {\n    case 'error':\n      return 'pi pi-exclamation-circle'\n    case 'warning':\n      return 'pi pi-exclamation-triangle'\n    case 'info':\n    default:\n      return undefined\n  }\n})\n\nconst clickableClasses = 'cursor-pointer transition-opacity hover:opacity-80'\n\nconst dotClasses = computed(() => {\n  switch (variant.value) {\n    case 'error':\n      return 'bg-danger-100'\n    case 'warning':\n      return 'bg-gold-600'\n    case 'info':\n    default:\n      return 'bg-slate-100'\n  }\n})\n\nconst popoverPt = computed(() => ({\n  root: {\n    class: cn('absolute z-50')\n  },\n  content: {\n    class: cn(\n      'mt-1 rounded-lg',\n      'bg-base-background',\n      'text-base-foreground',\n      'shadow-lg',\n      'border border-border-default'\n    )\n  }\n}))\n</script>\n","<template>\n  <Button\n    :label=\"label || $t('subscription.required.subscribe')\"\n    :size=\"size\"\n    :loading=\"isLoading\"\n    :disabled=\"isPolling\"\n    severity=\"primary\"\n    :style=\"\n      variant === 'gradient'\n        ? {\n            background: 'var(--color-subscription-button-gradient)',\n            color: 'var(--color-white)'\n          }\n        : undefined\n    \"\n    :pt=\"{\n      root: {\n        class: rootClass\n      }\n    }\"\n    @click=\"handleSubscribe\"\n  />\n</template>\n\n<script setup lang=\"ts\">\nimport Button from 'primevue/button'\nimport { computed, onBeforeUnmount, ref } from 'vue'\n\nimport { useSubscription } from '@/platform/cloud/subscription/composables/useSubscription'\nimport { isCloud } from '@/platform/distribution/types'\nimport { useTelemetry } from '@/platform/telemetry'\nimport { cn } from '@/utils/tailwindUtil'\n\nconst props = withDefaults(\n  defineProps<{\n    label?: string\n    size?: 'small' | 'large'\n    variant?: 'default' | 'gradient'\n    fluid?: boolean\n  }>(),\n  {\n    size: 'large',\n    variant: 'default',\n    fluid: true\n  }\n)\n\nconst rootClass = computed(() => cn('font-bold', props.fluid && 'w-full'))\n\nconst emit = defineEmits<{\n  subscribed: []\n}>()\n\nconst { subscribe, isActiveSubscription, fetchStatus } = useSubscription()\nconst telemetry = useTelemetry()\n\nconst isLoading = ref(false)\nconst isPolling = ref(false)\nlet pollInterval: number | null = null\n\nconst POLL_INTERVAL_MS = 3000 // Poll every 3 seconds\nconst MAX_POLL_DURATION_MS = 5 * 60 * 1000 // Stop polling after 5 minutes\n\nconst startPollingSubscriptionStatus = () => {\n  isPolling.value = true\n  isLoading.value = true\n\n  const startTime = Date.now()\n\n  const poll = async () => {\n    try {\n      if (Date.now() - startTime > MAX_POLL_DURATION_MS) {\n        stopPolling()\n        return\n      }\n\n      await fetchStatus()\n\n      if (isActiveSubscription.value) {\n        stopPolling()\n        telemetry?.trackMonthlySubscriptionSucceeded()\n        emit('subscribed')\n      }\n    } catch (error) {\n      console.error(\n        '[SubscribeButton] Error polling subscription status:',\n        error\n      )\n    }\n  }\n\n  void poll()\n  pollInterval = window.setInterval(poll, POLL_INTERVAL_MS)\n}\n\nconst stopPolling = () => {\n  if (pollInterval) {\n    clearInterval(pollInterval)\n    pollInterval = null\n  }\n  isPolling.value = false\n  isLoading.value = false\n}\n\nconst handleSubscribe = async () => {\n  if (isCloud) {\n    useTelemetry()?.trackSubscription('subscribe_clicked')\n  }\n\n  isLoading.value = true\n  try {\n    await subscribe()\n\n    startPollingSubscriptionStatus()\n  } catch (error) {\n    console.error('[SubscribeButton] Error initiating subscription:', error)\n    isLoading.value = false\n  }\n}\n\nonBeforeUnmount(() => {\n  stopPolling()\n})\n</script>\n","<template>\n  <Toast />\n</template>\n\n<script setup lang=\"ts\">\nimport Toast from 'primevue/toast'\nimport { useToast } from 'primevue/usetoast'\nimport { nextTick, watch } from 'vue'\n\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useToastStore } from '@/platform/updates/common/toastStore'\n\nconst toast = useToast()\nconst toastStore = useToastStore()\nconst settingStore = useSettingStore()\n\nwatch(\n  () => toastStore.messagesToAdd,\n  (newMessages) => {\n    if (newMessages.length === 0) {\n      return\n    }\n\n    newMessages.forEach((message) => {\n      toast.add(message)\n    })\n    toastStore.messagesToAdd = []\n  },\n  { deep: true }\n)\n\nwatch(\n  () => toastStore.messagesToRemove,\n  (messagesToRemove) => {\n    if (messagesToRemove.length === 0) {\n      return\n    }\n\n    messagesToRemove.forEach((message) => {\n      toast.remove(message)\n    })\n    toastStore.messagesToRemove = []\n  },\n  { deep: true }\n)\n\nwatch(\n  () => toastStore.removeAllRequested,\n  (requested) => {\n    if (requested) {\n      toast.removeAllGroups()\n      toastStore.removeAllRequested = false\n    }\n  }\n)\n\nfunction updateToastPosition() {\n  const styleElement =\n    document.getElementById('dynamic-toast-style') || createStyleElement()\n  const rect = document\n    .querySelector('.graph-canvas-container')\n    ?.getBoundingClientRect()\n  if (!rect) return\n\n  styleElement.textContent = `\n    .p-toast.p-component.p-toast-top-right {\n      top: ${rect.top + 100}px !important;\n      right: ${window.innerWidth - (rect.left + rect.width) + 20}px !important;\n       z-index: 10000 !important;\n    }\n  `\n}\n\nfunction createStyleElement() {\n  const style = document.createElement('style')\n  style.id = 'dynamic-toast-style'\n  document.head.appendChild(style)\n  return style\n}\n\nwatch(\n  () => settingStore.get('Comfy.UseNewMenu'),\n  () => nextTick(updateToastPosition),\n  { immediate: true }\n)\nwatch(\n  () => settingStore.get('Comfy.Sidebar.Location'),\n  () => nextTick(updateToastPosition),\n  { immediate: true }\n)\n</script>\n","/**\n * Cross-browser async utilities for scheduling tasks during browser idle time\n * with proper fallbacks for browsers that don't support requestIdleCallback.\n *\n * Implementation based on:\n * https://github.com/microsoft/vscode/blob/main/src/vs/base/common/async.ts\n */\n\ninterface IdleDeadline {\n  didTimeout: boolean\n  timeRemaining(): number\n}\n\ninterface IDisposable {\n  dispose(): void\n}\n\n/**\n * Internal implementation function that handles the actual scheduling logic.\n * Uses feature detection to determine whether to use native requestIdleCallback\n * or fall back to setTimeout-based implementation.\n */\nlet _runWhenIdle: (\n  targetWindow: any,\n  callback: (idle: IdleDeadline) => void,\n  timeout?: number\n) => IDisposable\n\n/**\n * Execute the callback during the next browser idle period.\n * Falls back to setTimeout-based scheduling in browsers without native support.\n */\nexport let runWhenGlobalIdle: (\n    callback: (idle: IdleDeadline) => void,\n    timeout?: number\n  ) => IDisposable\n\n  // Self-invoking function to set up the idle callback implementation\n;(function () {\n  const safeGlobal: any = globalThis\n\n  if (\n    typeof safeGlobal.requestIdleCallback !== 'function' ||\n    typeof safeGlobal.cancelIdleCallback !== 'function'\n  ) {\n    // Fallback implementation for browsers without native support (e.g., Safari)\n    _runWhenIdle = (_targetWindow, runner, _timeout?) => {\n      setTimeout(() => {\n        if (disposed) {\n          return\n        }\n\n        // Simulate IdleDeadline - give 15ms window (one frame at ~64fps)\n        const end = Date.now() + 15\n        const deadline: IdleDeadline = {\n          didTimeout: true,\n          timeRemaining() {\n            return Math.max(0, end - Date.now())\n          }\n        }\n\n        runner(Object.freeze(deadline))\n      })\n\n      let disposed = false\n      return {\n        dispose() {\n          if (disposed) {\n            return\n          }\n          disposed = true\n        }\n      }\n    }\n  } else {\n    // Native requestIdleCallback implementation\n    _runWhenIdle = (targetWindow: typeof safeGlobal, runner, timeout?) => {\n      const handle: number = targetWindow.requestIdleCallback(\n        runner,\n        typeof timeout === 'number' ? { timeout } : undefined\n      )\n\n      let disposed = false\n      return {\n        dispose() {\n          if (disposed) {\n            return\n          }\n          disposed = true\n          targetWindow.cancelIdleCallback(handle)\n        }\n      }\n    }\n  }\n\n  runWhenGlobalIdle = (runner, timeout) =>\n    _runWhenIdle(globalThis, runner, timeout)\n})()\n","<template>\n  <div\n    v-show=\"workspaceState.focusMode\"\n    class=\"comfy-menu-hamburger no-drag top-0 right-0\"\n  >\n    <Button\n      v-tooltip=\"{ value: $t('menu.showMenu'), showDelay: 300 }\"\n      icon=\"pi pi-bars\"\n      severity=\"secondary\"\n      text\n      size=\"large\"\n      :aria-label=\"$t('menu.showMenu')\"\n      aria-live=\"assertive\"\n      @click=\"exitFocusMode\"\n      @contextmenu=\"showNativeSystemMenu\"\n    />\n    <div class=\"window-actions-spacer\" />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport Button from 'primevue/button'\nimport { watchEffect } from 'vue'\n\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { app } from '@/scripts/app'\nimport { useWorkspaceStore } from '@/stores/workspaceStore'\nimport { showNativeSystemMenu } from '@/utils/envUtil'\n\nconst workspaceState = useWorkspaceStore()\nconst settingStore = useSettingStore()\nconst exitFocusMode = () => {\n  workspaceState.focusMode = false\n}\n\nwatchEffect(() => {\n  if (settingStore.get('Comfy.UseNewMenu') !== 'Disabled') {\n    return\n  }\n  if (workspaceState.focusMode) {\n    app.ui.menuContainer.style.display = 'none'\n  } else {\n    app.ui.menuContainer.style.display = 'block'\n  }\n})\n</script>\n\n<style scoped>\n@reference '../assets/css/style.css';\n\n.comfy-menu-hamburger {\n  @apply fixed z-9999 flex flex-row;\n}\n</style>\n","<template>\n  <div>\n    <!--\n    UnloadWindowConfirmDialog: This component does not render\n    anything visible. It is used to confirm the user wants to\n    close the window, and if they do, it will call the\n    beforeunload event.\n    -->\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { onBeforeUnmount, onMounted } from 'vue'\n\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\n\nconst settingStore = useSettingStore()\nconst workflowStore = useWorkflowStore()\n\nconst handleBeforeUnload = (event: BeforeUnloadEvent) => {\n  if (\n    settingStore.get('Comfy.Window.UnloadConfirmation') &&\n    workflowStore.modifiedWorkflows.length > 0\n  ) {\n    event.preventDefault()\n    return true\n  }\n  return undefined\n}\n\nonMounted(() => {\n  window.addEventListener('beforeunload', handleBeforeUnload)\n})\n\nonBeforeUnmount(() => {\n  window.removeEventListener('beforeunload', handleBeforeUnload)\n})\n</script>\n","<template>\n  <div class=\"splitter-overlay-root pointer-events-none flex flex-col\">\n    <slot name=\"workflow-tabs\" />\n\n    <div\n      class=\"pointer-events-none flex flex-1 overflow-hidden\"\n      :class=\"{\n        'flex-row': sidebarLocation === 'left',\n        'flex-row-reverse': sidebarLocation === 'right'\n      }\"\n    >\n      <div class=\"side-toolbar-container\">\n        <slot name=\"side-toolbar\" />\n      </div>\n\n      <Splitter\n        key=\"main-splitter-stable\"\n        class=\"splitter-overlay flex-1 overflow-hidden\"\n        :pt:gutter=\"sidebarPanelVisible ? '' : 'hidden'\"\n        :state-key=\"sidebarStateKey || 'main-splitter'\"\n        state-storage=\"local\"\n      >\n        <SplitterPanel\n          v-if=\"sidebarLocation === 'left'\"\n          class=\"side-bar-panel pointer-events-auto\"\n          :min-size=\"10\"\n          :size=\"20\"\n          :style=\"{\n            display:\n              sidebarPanelVisible && sidebarLocation === 'left'\n                ? 'flex'\n                : 'none'\n          }\"\n        >\n          <slot\n            v-if=\"sidebarPanelVisible && sidebarLocation === 'left'\"\n            name=\"side-bar-panel\"\n          />\n        </SplitterPanel>\n\n        <SplitterPanel :size=\"80\" class=\"flex flex-col\">\n          <slot name=\"topmenu\" :sidebar-panel-visible=\"sidebarPanelVisible\" />\n\n          <Splitter\n            class=\"splitter-overlay splitter-overlay-bottom mr-1 mb-1 ml-1 flex-1\"\n            layout=\"vertical\"\n            :pt:gutter=\"\n              'rounded-tl-lg rounded-tr-lg ' +\n              (bottomPanelVisible ? '' : 'hidden')\n            \"\n            state-key=\"bottom-panel-splitter\"\n            state-storage=\"local\"\n          >\n            <SplitterPanel class=\"graph-canvas-panel relative\">\n              <slot name=\"graph-canvas-panel\" />\n            </SplitterPanel>\n            <SplitterPanel\n              v-show=\"bottomPanelVisible\"\n              class=\"bottom-panel pointer-events-auto rounded-lg\"\n            >\n              <slot name=\"bottom-panel\" />\n            </SplitterPanel>\n          </Splitter>\n        </SplitterPanel>\n\n        <SplitterPanel\n          v-if=\"sidebarLocation === 'right'\"\n          class=\"side-bar-panel pointer-events-auto\"\n          :min-size=\"10\"\n          :size=\"20\"\n          :style=\"{\n            display:\n              sidebarPanelVisible && sidebarLocation === 'right'\n                ? 'flex'\n                : 'none'\n          }\"\n        >\n          <slot\n            v-if=\"sidebarPanelVisible && sidebarLocation === 'right'\"\n            name=\"side-bar-panel\"\n          />\n        </SplitterPanel>\n      </Splitter>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport Splitter from 'primevue/splitter'\nimport SplitterPanel from 'primevue/splitterpanel'\nimport { computed } from 'vue'\n\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useBottomPanelStore } from '@/stores/workspace/bottomPanelStore'\nimport { useSidebarTabStore } from '@/stores/workspace/sidebarTabStore'\n\nconst settingStore = useSettingStore()\nconst sidebarLocation = computed<'left' | 'right'>(() =>\n  settingStore.get('Comfy.Sidebar.Location')\n)\n\nconst unifiedWidth = computed(() =>\n  settingStore.get('Comfy.Sidebar.UnifiedWidth')\n)\n\nconst sidebarPanelVisible = computed(\n  () => useSidebarTabStore().activeSidebarTab !== null\n)\nconst bottomPanelVisible = computed(\n  () => useBottomPanelStore().bottomPanelVisible\n)\nconst activeSidebarTabId = computed(\n  () => useSidebarTabStore().activeSidebarTabId\n)\n\nconst sidebarStateKey = computed(() => {\n  if (unifiedWidth.value) {\n    return 'unified-sidebar'\n  }\n  // When no tab is active, use a default key to maintain state\n  return activeSidebarTabId.value ?? 'default-sidebar'\n})\n</script>\n\n<style scoped>\n@reference '../assets/css/style.css';\n\n:deep(.p-splitter-gutter) {\n  pointer-events: auto;\n}\n\n:deep(.p-splitter-gutter:hover),\n:deep(.p-splitter-gutter[data-p-gutter-resizing='true']) {\n  transition: background-color 0.2s ease 300ms;\n  background-color: var(--p-primary-color);\n}\n\n.side-bar-panel {\n  background-color: var(--bg-color);\n}\n\n.bottom-panel {\n  background-color: var(--comfy-menu-bg);\n  border: 1px solid var(--p-panel-border-color);\n  max-width: 100%;\n  overflow-x: auto;\n}\n\n.splitter-overlay-bottom :deep(.p-splitter-gutter) {\n  transform: translateY(5px);\n}\n\n.splitter-overlay {\n  @apply bg-transparent pointer-events-none border-none;\n}\n\n.splitter-overlay-root {\n  @apply w-full h-full absolute top-0 left-0;\n\n  /* Set it the same as the ComfyUI menu */\n  /* Note: Lite-graph DOM widgets have the same z-index as the node id, so\n  999 should be sufficient to make sure splitter overlays on node's DOM\n  widgets */\n  z-index: 999;\n}\n</style>\n","import { defineAsyncComponent } from 'vue'\n\nimport { isCloud } from '@/platform/distribution/types'\n\nexport default isCloud && window.__CONFIG__?.subscription_required\n  ? defineAsyncComponent(() => import('./CloudRunButtonWrapper.vue'))\n  : defineAsyncComponent(() => import('./ComfyQueueButton.vue'))\n","<template>\n  <div class=\"flex h-full items-center\">\n    <div\n      v-if=\"isDragging && !isDocked\"\n      :class=\"actionbarClass\"\n      @mouseenter=\"onMouseEnterDropZone\"\n      @mouseleave=\"onMouseLeaveDropZone\"\n    >\n      {{ t('actionbar.dockToTop') }}\n    </div>\n\n    <Panel\n      class=\"pointer-events-auto z-1000\"\n      :style=\"style\"\n      :class=\"panelClass\"\n      :pt=\"{\n        header: { class: 'hidden' },\n        content: { class: isDocked ? 'p-0' : 'p-1' }\n      }\"\n    >\n      <div ref=\"panelRef\" class=\"flex items-center select-none\">\n        <span\n          ref=\"dragHandleRef\"\n          :class=\"\n            cn(\n              'drag-handle cursor-grab w-3 h-max mr-2',\n              isDragging && 'cursor-grabbing'\n            )\n          \"\n        />\n\n        <ComfyRunButton />\n      </div>\n    </Panel>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport {\n  useDraggable,\n  useEventListener,\n  useLocalStorage,\n  watchDebounced\n} from '@vueuse/core'\nimport { clamp } from 'es-toolkit/compat'\nimport Panel from 'primevue/panel'\nimport { computed, nextTick, onMounted, ref, watch } from 'vue'\n\nimport { t } from '@/i18n'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useTelemetry } from '@/platform/telemetry'\nimport { cn } from '@/utils/tailwindUtil'\n\nimport ComfyRunButton from './ComfyRunButton'\n\nconst settingsStore = useSettingStore()\n\nconst position = computed(() => settingsStore.get('Comfy.UseNewMenu'))\nconst visible = computed(() => position.value !== 'Disabled')\n\nconst tabContainer = document.querySelector('.workflow-tabs-container')\nconst panelRef = ref<HTMLElement | null>(null)\nconst dragHandleRef = ref<HTMLElement | null>(null)\nconst isDocked = useLocalStorage('Comfy.MenuPosition.Docked', true)\nconst storedPosition = useLocalStorage('Comfy.MenuPosition.Floating', {\n  x: 0,\n  y: 0\n})\nconst {\n  x,\n  y,\n  style: style,\n  isDragging\n} = useDraggable(panelRef, {\n  initialValue: { x: 0, y: 0 },\n  handle: dragHandleRef,\n  containerElement: document.body,\n  onMove: (event) => {\n    // Prevent dragging the menu over the top of the tabs\n    const minY = tabContainer?.getBoundingClientRect().bottom ?? 40\n    if (event.y < minY) {\n      event.y = minY\n    }\n  }\n})\n\n// Update storedPosition when x or y changes\nwatchDebounced(\n  [x, y],\n  ([newX, newY]) => {\n    storedPosition.value = { x: newX, y: newY }\n  },\n  { debounce: 300 }\n)\n\n// Set initial position to bottom center\nconst setInitialPosition = () => {\n  if (panelRef.value) {\n    const screenWidth = window.innerWidth\n    const screenHeight = window.innerHeight\n    const menuWidth = panelRef.value.offsetWidth\n    const menuHeight = panelRef.value.offsetHeight\n\n    if (menuWidth === 0 || menuHeight === 0) {\n      return\n    }\n\n    // Check if stored position exists and is within bounds\n    if (storedPosition.value.x !== 0 || storedPosition.value.y !== 0) {\n      // Ensure stored position is within screen bounds\n      x.value = clamp(storedPosition.value.x, 0, screenWidth - menuWidth)\n      y.value = clamp(storedPosition.value.y, 0, screenHeight - menuHeight)\n      captureLastDragState()\n      return\n    }\n\n    // If no stored position or current position, set to bottom center\n    if (x.value === 0 && y.value === 0) {\n      x.value = clamp((screenWidth - menuWidth) / 2, 0, screenWidth - menuWidth)\n      y.value = clamp(\n        screenHeight - menuHeight - 10,\n        0,\n        screenHeight - menuHeight\n      )\n      captureLastDragState()\n    }\n  }\n}\nonMounted(setInitialPosition)\nwatch(visible, async (newVisible) => {\n  if (newVisible) {\n    await nextTick(setInitialPosition)\n  }\n})\n\n/**\n * Track run button handle drag start using mousedown on the drag handle.\n */\nuseEventListener(dragHandleRef, 'mousedown', () => {\n  useTelemetry()?.trackUiButtonClicked({\n    button_id: 'actionbar_run_handle_drag_start'\n  })\n})\n\nconst lastDragState = ref({\n  x: x.value,\n  y: y.value,\n  windowWidth: window.innerWidth,\n  windowHeight: window.innerHeight\n})\nconst captureLastDragState = () => {\n  lastDragState.value = {\n    x: x.value,\n    y: y.value,\n    windowWidth: window.innerWidth,\n    windowHeight: window.innerHeight\n  }\n}\nwatch(\n  isDragging,\n  (newIsDragging) => {\n    if (!newIsDragging) {\n      // Stop dragging\n      captureLastDragState()\n    }\n  },\n  { immediate: true }\n)\n\nconst adjustMenuPosition = () => {\n  if (panelRef.value) {\n    const screenWidth = window.innerWidth\n    const screenHeight = window.innerHeight\n    const menuWidth = panelRef.value.offsetWidth\n    const menuHeight = panelRef.value.offsetHeight\n\n    // Calculate distances to all edges\n    const distanceLeft = lastDragState.value.x\n    const distanceRight =\n      lastDragState.value.windowWidth - (lastDragState.value.x + menuWidth)\n    const distanceTop = lastDragState.value.y\n    const distanceBottom =\n      lastDragState.value.windowHeight - (lastDragState.value.y + menuHeight)\n\n    // Find the smallest distance to determine which edge to anchor to\n    const distances = [\n      { edge: 'left', distance: distanceLeft },\n      { edge: 'right', distance: distanceRight },\n      { edge: 'top', distance: distanceTop },\n      { edge: 'bottom', distance: distanceBottom }\n    ]\n    const closestEdge = distances.reduce((min, curr) =>\n      curr.distance < min.distance ? curr : min\n    )\n\n    // Calculate vertical position as a percentage of screen height\n    const verticalRatio =\n      lastDragState.value.y / lastDragState.value.windowHeight\n    const horizontalRatio =\n      lastDragState.value.x / lastDragState.value.windowWidth\n\n    // Apply positioning based on closest edge\n    if (closestEdge.edge === 'left') {\n      x.value = closestEdge.distance // Maintain exact distance from left\n      y.value = verticalRatio * screenHeight\n    } else if (closestEdge.edge === 'right') {\n      x.value = screenWidth - menuWidth - closestEdge.distance // Maintain exact distance from right\n      y.value = verticalRatio * screenHeight\n    } else if (closestEdge.edge === 'top') {\n      x.value = horizontalRatio * screenWidth\n      y.value = closestEdge.distance // Maintain exact distance from top\n    } else {\n      // bottom\n      x.value = horizontalRatio * screenWidth\n      y.value = screenHeight - menuHeight - closestEdge.distance // Maintain exact distance from bottom\n    }\n\n    // Ensure the menu stays within the screen bounds\n    x.value = clamp(x.value, 0, screenWidth - menuWidth)\n    y.value = clamp(y.value, 0, screenHeight - menuHeight)\n  }\n}\n\nuseEventListener(window, 'resize', adjustMenuPosition)\n\n// Drop zone state\nconst isMouseOverDropZone = ref(false)\n\n// Mouse event handlers for self-contained drop zone\nconst onMouseEnterDropZone = () => {\n  if (isDragging.value) {\n    isMouseOverDropZone.value = true\n  }\n}\n\nconst onMouseLeaveDropZone = () => {\n  if (isDragging.value) {\n    isMouseOverDropZone.value = false\n  }\n}\n\n// Handle drag state changes\nwatch(isDragging, (dragging) => {\n  if (dragging) {\n    // Starting to drag - undock if docked\n    if (isDocked.value) {\n      isDocked.value = false\n    }\n  } else {\n    // Stopped dragging - dock if mouse is over drop zone\n    if (isMouseOverDropZone.value) {\n      isDocked.value = true\n    }\n    // Reset drop zone state\n    isMouseOverDropZone.value = false\n  }\n})\nconst actionbarClass = computed(() =>\n  cn(\n    'w-[265px] border-dashed border-blue-500 opacity-80',\n    'm-1.5 flex items-center justify-center self-stretch',\n    'rounded-md before:w-50 before:-ml-50 before:h-full',\n    isMouseOverDropZone.value &&\n      'border-[3px] opacity-100 scale-105 shadow-[0_0_20px] shadow-blue-500'\n  )\n)\nconst panelClass = computed(() =>\n  cn(\n    'actionbar pointer-events-auto z1000',\n    isDragging.value && 'select-none pointer-events-none',\n    isDocked.value\n      ? 'p-0 static mr-2 border-none bg-transparent'\n      : 'fixed shadow-interface'\n  )\n)\n</script>\n","<template>\n  <a\n    ref=\"wrapperRef\"\n    v-tooltip.bottom=\"{\n      value: item.label,\n      showDelay: 512\n    }\"\n    draggable=\"false\"\n    href=\"#\"\n    class=\"p-breadcrumb-item-link h-12 cursor-pointer px-2\"\n    :class=\"{\n      'flex items-center gap-1': isActive,\n      'p-breadcrumb-item-link-menu-visible': menu?.overlayVisible,\n      'p-breadcrumb-item-link-icon-visible': isActive,\n      'active-breadcrumb-item': isActive\n    }\"\n    @click=\"handleClick\"\n  >\n    <span class=\"p-breadcrumb-item-label px-2\">{{ item.label }}</span>\n    <Tag v-if=\"item.isBlueprint\" :value=\"'Blueprint'\" severity=\"primary\" />\n    <i v-if=\"isActive\" class=\"pi pi-angle-down text-[10px]\"></i>\n  </a>\n  <Menu\n    v-if=\"isActive\"\n    ref=\"menu\"\n    :model=\"menuItems\"\n    :popup=\"true\"\n    :pt=\"{\n      root: {\n        style: 'background-color: var(--comfy-menu-bg)'\n      },\n      itemLink: {\n        class: 'py-2'\n      }\n    }\"\n  />\n  <InputText\n    v-if=\"isEditing\"\n    ref=\"itemInputRef\"\n    v-model=\"itemLabel\"\n    class=\"fixed z-10000 px-2 py-2 text-[.8rem]\"\n    @blur=\"inputBlur(false)\"\n    @click.stop\n    @keydown.enter=\"inputBlur(true)\"\n    @keydown.esc=\"inputBlur(false)\"\n  />\n</template>\n\n<script setup lang=\"ts\">\nimport InputText from 'primevue/inputtext'\nimport type { MenuState } from 'primevue/menu'\nimport Menu from 'primevue/menu'\nimport type { MenuItem } from 'primevue/menuitem'\nimport Tag from 'primevue/tag'\nimport { computed, nextTick, ref } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport { useWorkflowService } from '@/platform/workflow/core/services/workflowService'\nimport {\n  ComfyWorkflow,\n  useWorkflowStore\n} from '@/platform/workflow/management/stores/workflowStore'\nimport { useDialogService } from '@/services/dialogService'\nimport { useCommandStore } from '@/stores/commandStore'\nimport { useSubgraphNavigationStore } from '@/stores/subgraphNavigationStore'\nimport { appendJsonExt } from '@/utils/formatUtil'\n\ninterface Props {\n  item: MenuItem\n  isActive?: boolean\n}\n\nconst props = withDefaults(defineProps<Props>(), {\n  isActive: false\n})\n\nconst { t } = useI18n()\nconst menu = ref<InstanceType<typeof Menu> & MenuState>()\nconst dialogService = useDialogService()\nconst workflowStore = useWorkflowStore()\nconst workflowService = useWorkflowService()\nconst isEditing = ref(false)\nconst itemLabel = ref<string>()\nconst itemInputRef = ref<{ $el?: HTMLInputElement }>()\nconst wrapperRef = ref<HTMLAnchorElement>()\n\nconst rename = async (\n  newName: string | null | undefined,\n  initialName: string\n) => {\n  if (newName && newName !== initialName) {\n    // Synchronize the node titles with the new name\n    props.item.updateTitle?.(newName)\n\n    if (workflowStore.activeSubgraph) {\n      workflowStore.activeSubgraph.name = newName\n    } else if (workflowStore.activeWorkflow) {\n      try {\n        await workflowService.renameWorkflow(\n          workflowStore.activeWorkflow,\n          ComfyWorkflow.basePath + appendJsonExt(newName)\n        )\n      } catch (error) {\n        console.error(error)\n        dialogService.showErrorDialog(error)\n        return\n      }\n    }\n\n    // Force the navigation stack to recompute the labels\n    // TODO: investigate if there is a better way to do this\n    const navigationStore = useSubgraphNavigationStore()\n    navigationStore.restoreState(navigationStore.exportState())\n  }\n}\n\nconst isRoot = props.item.key === 'root'\nconst menuItems = computed<MenuItem[]>(() => {\n  return [\n    {\n      label: t('g.rename'),\n      icon: 'pi pi-pencil',\n      command: startRename\n    },\n    {\n      label: t('breadcrumbsMenu.duplicate'),\n      icon: 'pi pi-copy',\n      command: async () => {\n        await workflowService.duplicateWorkflow(workflowStore.activeWorkflow!)\n      },\n      visible: isRoot && !props.item.isBlueprint\n    },\n    {\n      separator: true,\n      visible: isRoot\n    },\n    {\n      label: t('menuLabels.Save'),\n      icon: 'pi pi-save',\n      command: async () => {\n        await useCommandStore().execute('Comfy.SaveWorkflow')\n      },\n      visible: isRoot\n    },\n    {\n      label: t('menuLabels.Save As'),\n      icon: 'pi pi-save',\n      command: async () => {\n        await useCommandStore().execute('Comfy.SaveWorkflowAs')\n      },\n      visible: isRoot\n    },\n    {\n      separator: true\n    },\n    {\n      label: t('breadcrumbsMenu.clearWorkflow'),\n      icon: 'pi pi-trash',\n      command: async () => {\n        await useCommandStore().execute('Comfy.ClearWorkflow')\n      }\n    },\n    {\n      separator: true,\n      visible: props.item.key === 'root' && props.item.isBlueprint\n    },\n    {\n      label: t('subgraphStore.publish'),\n      icon: 'pi pi-copy',\n      command: async () => {\n        await workflowService.saveWorkflowAs(workflowStore.activeWorkflow!)\n      },\n      visible: props.item.key === 'root' && props.item.isBlueprint\n    },\n    {\n      separator: true,\n      visible: isRoot\n    },\n    {\n      label: props.item.isBlueprint\n        ? t('breadcrumbsMenu.deleteBlueprint')\n        : t('breadcrumbsMenu.deleteWorkflow'),\n      icon: 'pi pi-times',\n      command: async () => {\n        await workflowService.deleteWorkflow(workflowStore.activeWorkflow!)\n      },\n      visible: isRoot\n    }\n  ]\n})\n\nconst handleClick = (event: MouseEvent) => {\n  if (isEditing.value) {\n    return\n  }\n\n  if (event.detail === 1) {\n    if (props.isActive) {\n      menu.value?.toggle(event)\n    } else {\n      props.item.command?.({ item: props.item, originalEvent: event })\n    }\n  } else if (props.isActive && event.detail === 2) {\n    menu.value?.hide()\n    event.stopPropagation()\n    event.preventDefault()\n    startRename()\n  }\n}\n\nconst startRename = () => {\n  isEditing.value = true\n  itemLabel.value = props.item.label as string\n  void nextTick(() => {\n    if (itemInputRef.value?.$el) {\n      itemInputRef.value.$el.focus()\n      itemInputRef.value.$el.select()\n      if (wrapperRef.value) {\n        itemInputRef.value.$el.style.width = `${Math.max(200, wrapperRef.value.offsetWidth)}px`\n      }\n    }\n  })\n}\n\nconst inputBlur = async (doRename: boolean) => {\n  if (doRename) {\n    await rename(itemLabel.value, props.item.label as string)\n  }\n\n  isEditing.value = false\n}\n</script>\n\n<style scoped>\n@reference '../../assets/css/style.css';\n\n.p-breadcrumb-item-link,\n.p-breadcrumb-item-icon {\n  @apply select-none;\n}\n\n.p-breadcrumb-item-link {\n  @apply overflow-hidden;\n}\n\n.p-breadcrumb-item-label {\n  @apply whitespace-nowrap text-ellipsis overflow-hidden;\n}\n\n.active-breadcrumb-item {\n  color: var(--text-primary);\n}\n</style>\n","import { useMutationObserver, useResizeObserver } from '@vueuse/core'\nimport { debounce } from 'es-toolkit/compat'\nimport { readonly, ref } from 'vue'\n\n/**\n * Observes an element for overflow changes and optionally debounces the check\n * @param element - The element to observe\n * @param options - The options for the observer\n * @param options.debounceTime - The time to debounce the check in milliseconds\n * @param options.useMutationObserver - Whether to use a mutation observer to check for overflow\n * @param options.useResizeObserver - Whether to use a resize observer to check for overflow\n * @returns An object containing the isOverflowing state and the checkOverflow function to manually trigger\n */\nexport const useOverflowObserver = (\n  element: HTMLElement,\n  options?: {\n    debounceTime?: number\n    useMutationObserver?: boolean\n    useResizeObserver?: boolean\n    onCheck?: (isOverflowing: boolean) => void\n  }\n) => {\n  options = {\n    debounceTime: 25,\n    useMutationObserver: true,\n    useResizeObserver: true,\n    ...options\n  }\n\n  const isOverflowing = ref(false)\n  const disposeFns: (() => void)[] = []\n  const disposed = ref(false)\n\n  const checkOverflowFn = () => {\n    isOverflowing.value = element.scrollWidth > element.clientWidth\n    options.onCheck?.(isOverflowing.value)\n  }\n\n  const checkOverflow = options.debounceTime\n    ? debounce(checkOverflowFn, options.debounceTime)\n    : checkOverflowFn\n\n  if (options.useMutationObserver) {\n    disposeFns.push(\n      useMutationObserver(element, checkOverflow, {\n        subtree: true,\n        childList: true\n      }).stop\n    )\n  }\n  if (options.useResizeObserver) {\n    disposeFns.push(useResizeObserver(element, checkOverflow).stop)\n  }\n\n  return {\n    isOverflowing: readonly(isOverflowing),\n    disposed: readonly(disposed),\n    checkOverflow,\n    dispose: () => {\n      disposed.value = true\n      disposeFns.forEach((fn) => fn())\n    }\n  }\n}\n","<template>\n  <div\n    class=\"subgraph-breadcrumb w-auto drop-shadow-[var(--interface-panel-drop-shadow)]\"\n    :class=\"{\n      'subgraph-breadcrumb-collapse': collapseTabs,\n      'subgraph-breadcrumb-overflow': overflowingTabs\n    }\"\n    :style=\"{\n      '--p-breadcrumb-gap': `0px`,\n      '--p-breadcrumb-item-margin': `${ITEM_GAP / 2}px`,\n      '--p-breadcrumb-item-min-width': `${MIN_WIDTH}px`,\n      '--p-breadcrumb-item-padding': `${ITEM_PADDING}px`,\n      '--p-breadcrumb-icon-width': `${ICON_WIDTH}px`\n    }\"\n  >\n    <Breadcrumb\n      ref=\"breadcrumbRef\"\n      class=\"w-fit rounded-lg p-0\"\n      :model=\"items\"\n      :pt=\"{ item: { class: 'pointer-events-auto' } }\"\n      :aria-label=\"$t('g.graphNavigation')\"\n    >\n      <template #item=\"{ item }\">\n        <SubgraphBreadcrumbItem\n          :item=\"item\"\n          :is-active=\"item === items.at(-1)\"\n        />\n      </template>\n      <template #separator\n        ><span style=\"transform: scale(1.5)\"> / </span></template\n      >\n    </Breadcrumb>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport Breadcrumb from 'primevue/breadcrumb'\nimport type { MenuItem } from 'primevue/menuitem'\nimport { computed, onUpdated, ref, watch } from 'vue'\n\nimport SubgraphBreadcrumbItem from '@/components/breadcrumb/SubgraphBreadcrumbItem.vue'\nimport { useOverflowObserver } from '@/composables/element/useOverflowObserver'\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useSubgraphNavigationStore } from '@/stores/subgraphNavigationStore'\nimport { useSubgraphStore } from '@/stores/subgraphStore'\nimport { forEachSubgraphNode } from '@/utils/graphTraversalUtil'\n\nconst MIN_WIDTH = 28\nconst ITEM_GAP = 8\nconst ITEM_PADDING = 8\nconst ICON_WIDTH = 20\n\nconst workflowStore = useWorkflowStore()\nconst navigationStore = useSubgraphNavigationStore()\nconst breadcrumbRef = ref<InstanceType<typeof Breadcrumb>>()\nconst workflowName = computed(() => workflowStore.activeWorkflow?.filename)\nconst isBlueprint = computed(() =>\n  useSubgraphStore().isSubgraphBlueprint(workflowStore.activeWorkflow)\n)\nconst collapseTabs = ref(false)\nconst overflowingTabs = ref(false)\n\nconst breadcrumbElement = computed(() => {\n  if (!breadcrumbRef.value) return null\n\n  const el = (breadcrumbRef.value as unknown as { $el: HTMLElement }).$el\n  const list = el?.querySelector('.p-breadcrumb-list') as HTMLElement\n  return list\n})\n\nconst items = computed(() => {\n  const items = navigationStore.navigationStack.map<MenuItem>((subgraph) => ({\n    label: subgraph.name,\n    command: () => {\n      useTelemetry()?.trackUiButtonClicked({\n        button_id: 'breadcrumb_subgraph_item_selected'\n      })\n      const canvas = useCanvasStore().getCanvas()\n      if (!canvas.graph) throw new TypeError('Canvas has no graph')\n\n      canvas.setGraph(subgraph)\n    },\n    updateTitle: (title: string) => {\n      const rootGraph = useCanvasStore().getCanvas().graph?.rootGraph\n      if (!rootGraph) return\n\n      forEachSubgraphNode(rootGraph, subgraph.id, (node) => {\n        node.title = title\n      })\n    }\n  }))\n\n  return [home.value, ...items]\n})\n\nconst home = computed(() => ({\n  label: workflowName.value,\n  icon: 'pi pi-home',\n  key: 'root',\n  isBlueprint: isBlueprint.value,\n  command: () => {\n    useTelemetry()?.trackUiButtonClicked({\n      button_id: 'breadcrumb_subgraph_root_selected'\n    })\n    const canvas = useCanvasStore().getCanvas()\n    if (!canvas.graph) throw new TypeError('Canvas has no graph')\n\n    canvas.setGraph(canvas.graph.rootGraph)\n  }\n}))\n\n// Check for overflow on breadcrumb items and collapse/expand the breadcrumb to fit\nlet overflowObserver: ReturnType<typeof useOverflowObserver> | undefined\nwatch(breadcrumbElement, (el) => {\n  overflowObserver?.dispose()\n  overflowObserver = undefined\n\n  if (!el) return\n\n  overflowObserver = useOverflowObserver(el, {\n    onCheck: (isOverflowing) => {\n      overflowingTabs.value = isOverflowing\n\n      if (collapseTabs.value) {\n        // Items are currently hidden, check if we can show them\n        if (!isOverflowing) {\n          const items = [\n            ...el.querySelectorAll('.p-breadcrumb-item')\n          ] as HTMLElement[]\n\n          if (items.length < 3) return\n\n          const itemsWithIcon = items.filter((item) =>\n            item.querySelector('.p-breadcrumb-item-link-icon-visible')\n          ).length\n          const separators = el.querySelectorAll(\n            '.p-breadcrumb-separator'\n          ) as NodeListOf<HTMLElement>\n          const separator = separators[separators.length - 1] as HTMLElement\n          const separatorWidth = separator.offsetWidth\n\n          // items + separators + gaps + icons\n          const itemsWidth =\n            (MIN_WIDTH + ITEM_PADDING + ITEM_PADDING) * items.length +\n            itemsWithIcon * ICON_WIDTH\n          const separatorsWidth = (items.length - 1) * separatorWidth\n          const gapsWidth = (items.length - 1) * (ITEM_GAP * 2)\n          const totalWidth = itemsWidth + separatorsWidth + gapsWidth\n          const containerWidth = el.clientWidth\n\n          if (totalWidth <= containerWidth) {\n            collapseTabs.value = false\n          }\n        }\n      } else if (isOverflowing) {\n        collapseTabs.value = true\n      }\n    }\n  })\n})\n\n// If e.g. the workflow name changes, we need to check the overflow again\nonUpdated(() => {\n  if (!overflowObserver?.disposed.value) {\n    overflowObserver?.checkOverflow()\n  }\n})\n</script>\n\n<style scoped>\n@reference '../../assets/css/style.css';\n\n.subgraph-breadcrumb:not(:empty) {\n  flex: auto;\n  flex-shrink: 10000;\n  min-width: 120px;\n}\n\n.subgraph-breadcrumb,\n:deep(.p-breadcrumb) {\n  @apply overflow-hidden;\n}\n\n:deep(.p-breadcrumb) {\n  width: 100%;\n  background-color: transparent;\n}\n\n:deep(.p-breadcrumb-item) {\n  @apply flex items-center overflow-hidden;\n  min-width: calc(var(--p-breadcrumb-item-min-width) + 1rem);\n  /* Collapse middle items first */\n  flex-shrink: 10000;\n}\n\n:deep(.p-breadcrumb-separator) {\n  display: flex;\n  padding: 0 var(--p-breadcrumb-item-margin);\n}\n\n:deep(.p-breadcrumb-item-link) {\n  padding: 0\n    calc(var(--p-breadcrumb-item-margin) + var(--p-breadcrumb-item-padding));\n}\n\n:deep(.p-breadcrumb-separator),\n:deep(.p-breadcrumb-item) {\n  @apply h-12;\n  border-top: 1px solid var(--interface-stroke);\n  border-bottom: 1px solid var(--interface-stroke);\n  background-color: var(--comfy-menu-bg);\n}\n\n:deep(.p-breadcrumb-item:has(.p-breadcrumb-item-link-icon-visible)) {\n  min-width: calc(var(--p-breadcrumb-item-min-width) + 1rem + 20px);\n}\n\n:deep(.p-breadcrumb-item:first-child) {\n  @apply rounded-l-lg;\n  /* Then collapse the root workflow */\n  flex-shrink: 5000;\n  border-left: 1px solid var(--interface-stroke);\n\n  .p-breadcrumb-item-link {\n    padding-left: var(--p-breadcrumb-item-padding);\n  }\n}\n\n:deep(.p-breadcrumb-item:last-child) {\n  @apply rounded-r-lg;\n  /* Then collapse the active item */\n  flex-shrink: 1;\n  border-right: 1px solid var(--interface-stroke);\n}\n\n:deep(.p-breadcrumb-item-link:hover),\n:deep(.p-breadcrumb-item-link-menu-visible) {\n  background-color: color-mix(\n    in srgb,\n    var(--fg-color) 10%,\n    var(--comfy-menu-bg)\n  ) !important;\n  color: var(--fg-color);\n}\n</style>\n\n<style>\n@reference '../../assets/css/style.css';\n\n.subgraph-breadcrumb-collapse .p-breadcrumb-list {\n  .p-breadcrumb-item,\n  .p-breadcrumb-separator {\n    @apply hidden;\n  }\n\n  .p-breadcrumb-item:nth-last-child(3),\n  .p-breadcrumb-separator:nth-last-child(2),\n  .p-breadcrumb-item:nth-last-child(1) {\n    @apply flex;\n  }\n}\n</style>\n","import { defineStore } from 'pinia'\nimport { computed } from 'vue'\n\nimport type { ActionBarButton } from '@/types/comfy'\n\nimport { useExtensionStore } from './extensionStore'\n\nexport const useActionBarButtonStore = defineStore('actionBarButton', () => {\n  const extensionStore = useExtensionStore()\n\n  const buttons = computed<ActionBarButton[]>(() =>\n    extensionStore.extensions.flatMap((e) => e.actionBarButtons ?? [])\n  )\n\n  return {\n    buttons\n  }\n})\n","<template>\n  <div class=\"flex h-full shrink-0 items-center gap-1\">\n    <Button\n      v-for=\"(button, index) in actionBarButtonStore.buttons\"\n      :key=\"index\"\n      v-tooltip.bottom=\"button.tooltip\"\n      :label=\"button.label\"\n      :aria-label=\"button.tooltip || button.label\"\n      :class=\"button.class\"\n      text\n      rounded\n      severity=\"secondary\"\n      class=\"h-7\"\n      @click=\"button.onClick\"\n    >\n      <template #icon>\n        <i :class=\"button.icon\" />\n      </template>\n    </Button>\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport Button from 'primevue/button'\n\nimport { useActionBarButtonStore } from '@/stores/actionBarButtonStore'\n\nconst actionBarButtonStore = useActionBarButtonStore()\n</script>\n","<!-- A popover that shows current user information and actions -->\n<template>\n  <div class=\"current-user-popover w-72\">\n    <!-- User Info Section -->\n    <div class=\"p-3\">\n      <div class=\"flex flex-col items-center\">\n        <UserAvatar\n          class=\"mb-3\"\n          :photo-url=\"userPhotoUrl\"\n          :pt:icon:class=\"{\n            'text-2xl!': !userPhotoUrl\n          }\"\n          size=\"large\"\n        />\n\n        <!-- User Details -->\n        <h3 class=\"my-0 mb-1 truncate text-lg font-semibold\">\n          {{ userDisplayName || $t('g.user') }}\n        </h3>\n        <p v-if=\"userEmail\" class=\"my-0 truncate text-sm text-muted\">\n          {{ userEmail }}\n        </p>\n      </div>\n    </div>\n\n    <div v-if=\"isActiveSubscription\" class=\"flex items-center justify-between\">\n      <div class=\"flex flex-col gap-1\">\n        <UserCredit text-class=\"text-2xl\" />\n        <Button\n          :label=\"$t('subscription.partnerNodesCredits')\"\n          severity=\"secondary\"\n          text\n          size=\"small\"\n          class=\"pl-6 p-0 h-auto justify-start\"\n          :pt=\"{\n            root: {\n              class: 'hover:bg-transparent active:bg-transparent'\n            }\n          }\"\n          @click=\"handleOpenPartnerNodesInfo\"\n        />\n      </div>\n      <Button\n        :label=\"$t('credits.topUp.topUp')\"\n        severity=\"secondary\"\n        size=\"small\"\n        @click=\"handleTopUp\"\n      />\n    </div>\n    <SubscribeButton\n      v-else\n      :label=\"$t('subscription.subscribeToComfyCloud')\"\n      size=\"small\"\n      variant=\"gradient\"\n      @subscribed=\"handleSubscribed\"\n    />\n\n    <Divider class=\"my-2\" />\n\n    <Button\n      class=\"justify-start\"\n      :label=\"$t('userSettings.title')\"\n      icon=\"pi pi-cog\"\n      text\n      fluid\n      severity=\"secondary\"\n      @click=\"handleOpenUserSettings\"\n    />\n\n    <Button\n      v-if=\"isActiveSubscription\"\n      class=\"justify-start\"\n      :label=\"$t(planSettingsLabel)\"\n      icon=\"pi pi-receipt\"\n      text\n      fluid\n      severity=\"secondary\"\n      @click=\"handleOpenPlanAndCreditsSettings\"\n    />\n\n    <Divider class=\"my-2\" />\n\n    <Button\n      class=\"justify-start\"\n      :label=\"$t('auth.signOut.signOut')\"\n      icon=\"pi pi-sign-out\"\n      text\n      fluid\n      severity=\"secondary\"\n      @click=\"handleLogout\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport Button from 'primevue/button'\nimport Divider from 'primevue/divider'\nimport { onMounted } from 'vue'\n\nimport UserAvatar from '@/components/common/UserAvatar.vue'\nimport UserCredit from '@/components/common/UserCredit.vue'\nimport { useCurrentUser } from '@/composables/auth/useCurrentUser'\nimport { useFirebaseAuthActions } from '@/composables/auth/useFirebaseAuthActions'\nimport { useExternalLink } from '@/composables/useExternalLink'\nimport SubscribeButton from '@/platform/cloud/subscription/components/SubscribeButton.vue'\nimport { useSubscription } from '@/platform/cloud/subscription/composables/useSubscription'\nimport { isCloud } from '@/platform/distribution/types'\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useDialogService } from '@/services/dialogService'\n\nconst emit = defineEmits<{\n  close: []\n}>()\n\nconst { buildDocsUrl } = useExternalLink()\n\nconst planSettingsLabel = isCloud\n  ? 'settingsCategories.PlanCredits'\n  : 'settingsCategories.Credits'\n\nconst { userDisplayName, userEmail, userPhotoUrl, handleSignOut } =\n  useCurrentUser()\nconst authActions = useFirebaseAuthActions()\nconst dialogService = useDialogService()\nconst { isActiveSubscription, fetchStatus } = useSubscription()\n\nconst handleOpenUserSettings = () => {\n  dialogService.showSettingsDialog('user')\n  emit('close')\n}\n\nconst handleOpenPlanAndCreditsSettings = () => {\n  if (isCloud) {\n    dialogService.showSettingsDialog('subscription')\n  } else {\n    dialogService.showSettingsDialog('credits')\n  }\n\n  emit('close')\n}\n\nconst handleTopUp = () => {\n  // Track purchase credits entry from avatar popover\n  useTelemetry()?.trackAddApiCreditButtonClicked()\n  dialogService.showTopUpCreditsDialog()\n  emit('close')\n}\n\nconst handleOpenPartnerNodesInfo = () => {\n  window.open(\n    buildDocsUrl('/tutorials/api-nodes/overview#api-nodes', {\n      includeLocale: true\n    }),\n    '_blank'\n  )\n  emit('close')\n}\n\nconst handleLogout = async () => {\n  await handleSignOut()\n  emit('close')\n}\n\nconst handleSubscribed = async () => {\n  await fetchStatus()\n}\n\nonMounted(() => {\n  void authActions.fetchBalance()\n})\n</script>\n","<!-- A button that shows current authenticated user's avatar -->\n<template>\n  <div>\n    <Button\n      v-if=\"isLoggedIn\"\n      class=\"user-profile-button p-1 hover:bg-transparent\"\n      severity=\"secondary\"\n      text\n      :aria-label=\"$t('g.currentUser')\"\n      @click=\"popover?.toggle($event)\"\n    >\n      <div\n        class=\"flex items-center gap-1 rounded-full hover:bg-interface-button-hover-surface\"\n      >\n        <UserAvatar :photo-url=\"photoURL\" />\n\n        <i class=\"pi pi-chevron-down px-1\" :style=\"{ fontSize: '0.6rem' }\" />\n      </div>\n    </Button>\n\n    <Popover ref=\"popover\" :show-arrow=\"false\">\n      <CurrentUserPopover @close=\"closePopover\" />\n    </Popover>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport Button from 'primevue/button'\nimport Popover from 'primevue/popover'\nimport { computed, ref } from 'vue'\n\nimport UserAvatar from '@/components/common/UserAvatar.vue'\nimport { useCurrentUser } from '@/composables/auth/useCurrentUser'\n\nimport CurrentUserPopover from './CurrentUserPopover.vue'\n\nconst { isLoggedIn, userPhotoUrl } = useCurrentUser()\n\nconst popover = ref<InstanceType<typeof Popover> | null>(null)\nconst photoURL = computed<string | undefined>(\n  () => userPhotoUrl.value ?? undefined\n)\n\nconst closePopover = () => {\n  popover.value?.hide()\n}\n</script>\n","<template>\n  <Button\n    v-if=\"!isLoggedIn\"\n    outlined\n    rounded\n    severity=\"secondary\"\n    class=\"size-8 bg-secondary-background text-base-foreground hover:bg-secondary-background-hover\"\n    @click=\"handleSignIn()\"\n    @mouseenter=\"showPopover\"\n    @mouseleave=\"hidePopover\"\n  >\n    <template #icon>\n      <i class=\"icon-[lucide--user] size-4\" />\n    </template>\n  </Button>\n  <Popover\n    ref=\"popoverRef\"\n    class=\"p-2\"\n    @mouseout=\"hidePopover\"\n    @mouseover=\"cancelHidePopover\"\n  >\n    <div>\n      <div class=\"mb-1\">{{ t('auth.loginButton.tooltipHelp') }}</div>\n      <a\n        :href=\"apiNodesOverviewUrl\"\n        target=\"_blank\"\n        class=\"text-neutral-500 hover:text-primary\"\n        >{{ t('auth.loginButton.tooltipLearnMore') }}</a\n      >\n    </div>\n  </Popover>\n</template>\n\n<script setup lang=\"ts\">\nimport Button from 'primevue/button'\nimport Popover from 'primevue/popover'\nimport { ref } from 'vue'\n\nimport { useCurrentUser } from '@/composables/auth/useCurrentUser'\nimport { useExternalLink } from '@/composables/useExternalLink'\nimport { t } from '@/i18n'\n\nconst { isLoggedIn, handleSignIn } = useCurrentUser()\nconst { buildDocsUrl } = useExternalLink()\nconst apiNodesOverviewUrl = buildDocsUrl(\n  '/tutorials/api-nodes/overview#api-nodes',\n  {\n    includeLocale: true\n  }\n)\nconst popoverRef = ref<InstanceType<typeof Popover> | null>(null)\nlet hideTimeout: ReturnType<typeof setTimeout> | null = null\nlet showTimeout: ReturnType<typeof setTimeout> | null = null\n\nconst showPopover = (event: Event) => {\n  // Clear any existing timeouts\n  if (hideTimeout) {\n    clearTimeout(hideTimeout)\n    hideTimeout = null\n  }\n  if (showTimeout) {\n    clearTimeout(showTimeout)\n    showTimeout = null\n  }\n\n  showTimeout = setTimeout(() => {\n    if (popoverRef.value) {\n      popoverRef.value.show(event, event.target as HTMLElement)\n    }\n  }, 200)\n}\n\nconst cancelHidePopover = () => {\n  if (hideTimeout) {\n    clearTimeout(hideTimeout)\n    hideTimeout = null\n  }\n}\n\nconst hidePopover = () => {\n  // Clear show timeout if mouse leaves before popover appears\n  if (showTimeout) {\n    clearTimeout(showTimeout)\n    showTimeout = null\n  }\n\n  hideTimeout = setTimeout(() => {\n    if (popoverRef.value) {\n      popoverRef.value.hide()\n    }\n  }, 150) // Minimal delay to allow moving to popover\n}\n</script>\n","<template>\n  <div v-if=\"!workspaceStore.focusMode\" class=\"ml-1 flex gap-x-0.5 pt-1\">\n    <div class=\"min-w-0 flex-1\">\n      <SubgraphBreadcrumb />\n    </div>\n\n    <div\n      class=\"actionbar-container pointer-events-auto flex h-12 items-center rounded-lg border border-[var(--interface-stroke)] px-2 shadow-interface\"\n    >\n      <ActionBarButtons />\n      <!-- Support for legacy topbar elements attached by custom scripts, hidden if no elements present -->\n      <div\n        ref=\"legacyCommandsContainerRef\"\n        class=\"[&:not(:has(*>*:not(:empty)))]:hidden\"\n      ></div>\n      <ComfyActionbar />\n      <CurrentUserButton v-if=\"isLoggedIn\" class=\"shrink-0\" />\n      <LoginButton v-else-if=\"isDesktop\" />\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { onMounted, ref } from 'vue'\n\nimport ComfyActionbar from '@/components/actionbar/ComfyActionbar.vue'\nimport SubgraphBreadcrumb from '@/components/breadcrumb/SubgraphBreadcrumb.vue'\nimport ActionBarButtons from '@/components/topbar/ActionBarButtons.vue'\nimport CurrentUserButton from '@/components/topbar/CurrentUserButton.vue'\nimport LoginButton from '@/components/topbar/LoginButton.vue'\nimport { useCurrentUser } from '@/composables/auth/useCurrentUser'\nimport { app } from '@/scripts/app'\nimport { useWorkspaceStore } from '@/stores/workspaceStore'\nimport { isElectron } from '@/utils/envUtil'\n\nconst workspaceStore = useWorkspaceStore()\nconst { isLoggedIn } = useCurrentUser()\nconst isDesktop = isElectron()\n\n// Maintain support for legacy topbar elements attached by custom scripts\nconst legacyCommandsContainerRef = ref<HTMLElement>()\nonMounted(() => {\n  if (legacyCommandsContainerRef.value) {\n    app.menu.element.style.width = 'fit-content'\n    legacyCommandsContainerRef.value.appendChild(app.menu.element)\n  }\n})\n</script>\n\n<style scoped>\n.actionbar-container {\n  background-color: var(--comfy-menu-bg);\n}\n</style>\n","<template>\n  <component :is=\"extension.component\" v-if=\"extension.type === 'vue'\" />\n  <div\n    v-else\n    :ref=\"\n      (el) => {\n        if (el)\n          mountCustomExtension(\n            props.extension as CustomExtension,\n            el as HTMLElement\n          )\n      }\n    \"\n  />\n</template>\n\n<script setup lang=\"ts\">\nimport { onBeforeUnmount } from 'vue'\n\nimport type { CustomExtension, VueExtension } from '@/types/extensionTypes'\n\nconst props = defineProps<{\n  extension: VueExtension | CustomExtension\n}>()\n\nconst mountCustomExtension = (extension: CustomExtension, el: HTMLElement) => {\n  extension.render(el)\n}\n\nonBeforeUnmount(() => {\n  if (props.extension.type === 'custom' && props.extension.destroy) {\n    props.extension.destroy()\n  }\n})\n</script>\n","<template>\n  <div class=\"flex h-full flex-col\">\n    <Tabs\n      :key=\"$i18n.locale\"\n      v-model:value=\"bottomPanelStore.activeBottomPanelTabId\"\n      style=\"--p-tabs-tablist-background: var(--comfy-menu-bg)\"\n    >\n      <TabList\n        pt:tab-list=\"border-none h-full flex items-center py-2 border-b-1 border-solid\"\n        class=\"bg-transparent\"\n      >\n        <div class=\"flex w-full justify-between\">\n          <div class=\"tabs-container\">\n            <Tab\n              v-for=\"tab in bottomPanelStore.bottomPanelTabs\"\n              :key=\"tab.id\"\n              :value=\"tab.id\"\n              class=\"m-1 mx-2 border-none\"\n              :class=\"{\n                'tab-list-single-item':\n                  bottomPanelStore.bottomPanelTabs.length === 1\n              }\"\n              :pt:root=\"\n                (x: TabPassThroughMethodOptions) => ({\n                  class: {\n                    'p-3 rounded-lg': true,\n                    'pointer-events-none':\n                      bottomPanelStore.bottomPanelTabs.length === 1\n                  },\n                  style: {\n                    color: 'var(--fg-color)',\n                    backgroundColor:\n                      !x.context.active ||\n                      bottomPanelStore.bottomPanelTabs.length === 1\n                        ? ''\n                        : 'var(--bg-color)'\n                  }\n                })\n              \"\n            >\n              <span class=\"font-normal\">\n                {{ getTabDisplayTitle(tab) }}\n              </span>\n            </Tab>\n          </div>\n          <div class=\"flex items-center gap-2\">\n            <Button\n              v-if=\"isShortcutsTabActive\"\n              :label=\"$t('shortcuts.manageShortcuts')\"\n              icon=\"pi pi-cog\"\n              severity=\"secondary\"\n              size=\"small\"\n              text\n              @click=\"openKeybindingSettings\"\n            />\n            <Button\n              class=\"justify-self-end\"\n              icon=\"pi pi-times\"\n              severity=\"secondary\"\n              size=\"small\"\n              text\n              @click=\"closeBottomPanel\"\n            />\n          </div>\n        </div>\n      </TabList>\n    </Tabs>\n    <!-- h-0 to force the div to grow -->\n    <div class=\"h-0 grow\">\n      <ExtensionSlot\n        v-if=\"\n          bottomPanelStore.bottomPanelVisible &&\n          bottomPanelStore.activeBottomPanelTab\n        \"\n        :extension=\"bottomPanelStore.activeBottomPanelTab\"\n      />\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport Button from 'primevue/button'\nimport Tab from 'primevue/tab'\nimport type { TabPassThroughMethodOptions } from 'primevue/tab'\nimport TabList from 'primevue/tablist'\nimport Tabs from 'primevue/tabs'\nimport { computed } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport ExtensionSlot from '@/components/common/ExtensionSlot.vue'\nimport { useDialogService } from '@/services/dialogService'\nimport { useBottomPanelStore } from '@/stores/workspace/bottomPanelStore'\nimport type { BottomPanelExtension } from '@/types/extensionTypes'\n\nconst bottomPanelStore = useBottomPanelStore()\nconst dialogService = useDialogService()\nconst { t } = useI18n()\n\nconst isShortcutsTabActive = computed(() => {\n  const activeTabId = bottomPanelStore.activeBottomPanelTabId\n  return (\n    activeTabId === 'shortcuts-essentials' ||\n    activeTabId === 'shortcuts-view-controls'\n  )\n})\n\nconst shouldCapitalizeTab = (tabId: string): boolean => {\n  return tabId !== 'shortcuts-essentials' && tabId !== 'shortcuts-view-controls'\n}\n\nconst getTabDisplayTitle = (tab: BottomPanelExtension): string => {\n  const title = tab.titleKey ? t(tab.titleKey) : tab.title || ''\n  return shouldCapitalizeTab(tab.id) ? title.toUpperCase() : title\n}\n\nconst openKeybindingSettings = async () => {\n  dialogService.showSettingsDialog('keybinding')\n}\n\nconst closeBottomPanel = () => {\n  bottomPanelStore.activePanel = null\n}\n</script>\n\n<style scoped>\n:deep(.p-tablist-active-bar) {\n  display: none;\n}\n</style>\n","import type { CSSProperties } from 'vue'\nimport { ref, watch } from 'vue'\n\nimport { useCanvasPositionConversion } from '@/composables/element/useCanvasPositionConversion'\nimport type { Size, Vector2 } from '@/lib/litegraph/src/litegraph'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\n\nexport interface PositionConfig {\n  /* The position of the element on litegraph canvas */\n  pos: Vector2\n  /* The size of the element on litegraph canvas */\n  size: Size\n  /* The scale factor of the canvas */\n  scale?: number\n}\n\nexport function useAbsolutePosition(options: { useTransform?: boolean } = {}) {\n  const { useTransform = false } = options\n\n  const canvasStore = useCanvasStore()\n  const lgCanvas = canvasStore.getCanvas()\n  const { canvasPosToClientPos, update: updateCanvasPosition } =\n    useCanvasPositionConversion(lgCanvas.canvas, lgCanvas)\n\n  const settingStore = useSettingStore()\n  watch(\n    [\n      () => settingStore.get('Comfy.Sidebar.Location'),\n      () => settingStore.get('Comfy.Sidebar.Size'),\n      () => settingStore.get('Comfy.UseNewMenu')\n    ],\n    () => updateCanvasPosition(),\n    { flush: 'post' }\n  )\n\n  /**\n   * @note Do NOT convert style to a computed value, as it will cause lag when\n   * updating the style on different animation frames. Vue's computed value is\n   * evaluated asynchronously.\n   */\n  const style = ref<CSSProperties>({})\n\n  /**\n   * Compute the style of the element based on the position and size.\n   *\n   * @param position\n   */\n  const computeStyle = (position: PositionConfig): CSSProperties => {\n    const { pos, size, scale = lgCanvas.ds.scale } = position\n    const [left, top] = canvasPosToClientPos(pos)\n    const [width, height] = size\n\n    return useTransform\n      ? {\n          position: 'fixed',\n          transformOrigin: '0 0',\n          transform: `scale(${scale})`,\n          left: `${left}px`,\n          top: `${top}px`,\n          width: `${width}px`,\n          height: `${height}px`\n        }\n      : {\n          position: 'fixed',\n          left: `${left}px`,\n          top: `${top}px`,\n          width: `${width * scale}px`,\n          height: `${height * scale}px`\n        }\n  }\n\n  /**\n   * Update the position of the element on the litegraph canvas.\n   *\n   * @param config\n   */\n  const updatePosition = (config: PositionConfig) => {\n    style.value = computeStyle(config)\n  }\n\n  return {\n    style,\n    updatePosition\n  }\n}\n","import type { CSSProperties } from 'vue'\nimport { ref } from 'vue'\n\ninterface Rect {\n  x: number\n  y: number\n  width: number\n  height: number\n}\n\n/**\n * Finds the intersection between two rectangles\n */\nfunction intersect(a: Rect, b: Rect): [number, number, number, number] | null {\n  const x1 = Math.max(a.x, b.x)\n  const y1 = Math.max(a.y, b.y)\n  const x2 = Math.min(a.x + a.width, b.x + b.width)\n  const y2 = Math.min(a.y + a.height, b.y + b.height)\n\n  if (x1 >= x2 || y1 >= y2) {\n    return null\n  }\n\n  return [x1, y1, x2 - x1, y2 - y1]\n}\n\ninterface ClippingOptions {\n  margin?: number\n}\n\nexport const useDomClipping = (options: ClippingOptions = {}) => {\n  const style = ref<CSSProperties>({})\n  const { margin = 4 } = options\n\n  /**\n   * Calculates a clip path for an element based on its intersection with a selected area\n   */\n  const calculateClipPath = (\n    elementRect: DOMRect,\n    canvasRect: DOMRect,\n    isSelected: boolean,\n    selectedArea?: {\n      x: number\n      y: number\n      width: number\n      height: number\n      scale: number\n      offset: [number, number]\n    }\n  ): string => {\n    if (!isSelected && selectedArea) {\n      const { scale, offset } = selectedArea\n\n      // Get intersection in browser space\n      const intersection = intersect(\n        {\n          x: elementRect.left - canvasRect.left,\n          y: elementRect.top - canvasRect.top,\n          width: elementRect.width,\n          height: elementRect.height\n        },\n        {\n          x: (selectedArea.x + offset[0] - margin) * scale,\n          y: (selectedArea.y + offset[1] - margin) * scale,\n          width: (selectedArea.width + 2 * margin) * scale,\n          height: (selectedArea.height + 2 * margin) * scale\n        }\n      )\n\n      if (!intersection) {\n        return ''\n      }\n\n      // Convert intersection to canvas scale (element has scale transform)\n      const clipX =\n        (intersection[0] - elementRect.left + canvasRect.left) / scale + 'px'\n      const clipY =\n        (intersection[1] - elementRect.top + canvasRect.top) / scale + 'px'\n      const clipWidth = intersection[2] / scale + 'px'\n      const clipHeight = intersection[3] / scale + 'px'\n\n      return `polygon(0% 0%, 0% 100%, ${clipX} 100%, ${clipX} ${clipY}, calc(${clipX} + ${clipWidth}) ${clipY}, calc(${clipX} + ${clipWidth}) calc(${clipY} + ${clipHeight}), ${clipX} calc(${clipY} + ${clipHeight}), ${clipX} 100%, 100% 100%, 100% 0%)`\n    }\n\n    return ''\n  }\n\n  /**\n   * Updates the clip-path style based on element and selection information\n   */\n  const updateClipPath = (\n    element: HTMLElement,\n    canvasElement: HTMLCanvasElement,\n    isSelected: boolean,\n    selectedArea?: {\n      x: number\n      y: number\n      width: number\n      height: number\n      scale: number\n      offset: [number, number]\n    }\n  ) => {\n    const elementRect = element.getBoundingClientRect()\n    const canvasRect = canvasElement.getBoundingClientRect()\n\n    const clipPath = calculateClipPath(\n      elementRect,\n      canvasRect,\n      isSelected,\n      selectedArea\n    )\n\n    style.value = {\n      clipPath: clipPath || 'none',\n      willChange: 'clip-path'\n    }\n  }\n\n  return {\n    style,\n    updateClipPath\n  }\n}\n","<template>\n  <div\n    v-show=\"widgetState.visible\"\n    ref=\"widgetElement\"\n    class=\"dom-widget\"\n    :title=\"tooltip\"\n    :style=\"style\"\n  >\n    <component\n      :is=\"widget.component\"\n      v-if=\"isComponentWidget(widget)\"\n      :model-value=\"widget.value\"\n      :widget=\"widget\"\n      v-bind=\"widget.props\"\n      @update:model-value=\"emit('update:widgetValue', $event)\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useElementBounding, useEventListener } from '@vueuse/core'\nimport type { CSSProperties } from 'vue'\nimport { computed, nextTick, onMounted, ref, watch } from 'vue'\n\nimport { useAbsolutePosition } from '@/composables/element/useAbsolutePosition'\nimport { useDomClipping } from '@/composables/element/useDomClipping'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { isComponentWidget, isDOMWidget } from '@/scripts/domWidget'\nimport type { DomWidgetState } from '@/stores/domWidgetStore'\n\nconst { widgetState } = defineProps<{\n  widgetState: DomWidgetState\n}>()\nconst widget = widgetState.widget\n\nconst emit = defineEmits<{\n  'update:widgetValue': [value: string | object]\n}>()\n\nconst widgetElement = ref<HTMLElement | undefined>()\n\n/**\n * @note Do NOT convert style to a computed value, as it will cause lag when\n * updating the style on different animation frames. Vue's computed value is\n * evaluated asynchronously.\n */\nconst style = ref<CSSProperties>({})\nconst { style: positionStyle, updatePosition } = useAbsolutePosition({\n  useTransform: true\n})\nconst { style: clippingStyle, updateClipPath } = useDomClipping()\n\nconst canvasStore = useCanvasStore()\nconst settingStore = useSettingStore()\nconst enableDomClipping = computed(() =>\n  settingStore.get('Comfy.DOMClippingEnabled')\n)\n\nconst updateDomClipping = () => {\n  const lgCanvas = canvasStore.canvas\n  if (!lgCanvas || !widgetElement.value) return\n\n  const selectedNode = Object.values(lgCanvas.selected_nodes ?? {})[0]\n  if (!selectedNode) {\n    // Clear clipping when no node is selected\n    updateClipPath(widgetElement.value, lgCanvas.canvas, false, undefined)\n    return\n  }\n\n  const isSelected = selectedNode === widgetState.widget.node\n  const renderArea = selectedNode?.renderArea\n  const offset = lgCanvas.ds.offset\n  const scale = lgCanvas.ds.scale\n  const selectedAreaConfig = renderArea\n    ? {\n        x: renderArea[0],\n        y: renderArea[1],\n        width: renderArea[2],\n        height: renderArea[3],\n        scale,\n        offset: [offset[0], offset[1]] as [number, number]\n      }\n    : undefined\n\n  updateClipPath(\n    widgetElement.value,\n    lgCanvas.canvas,\n    isSelected,\n    selectedAreaConfig\n  )\n}\n\n/**\n * @note mapping between canvas position and client position depends on the\n * canvas element's position, so we need to watch the canvas element's position\n * and update the position of the widget accordingly.\n */\nconst { left, top } = useElementBounding(canvasStore.getCanvas().canvas)\nwatch(\n  [() => widgetState, left, top],\n  ([widgetState, _, __]) => {\n    updatePosition(widgetState)\n    if (enableDomClipping.value) {\n      updateDomClipping()\n    }\n\n    style.value = {\n      ...positionStyle.value,\n      ...(enableDomClipping.value ? clippingStyle.value : {}),\n      zIndex: widgetState.zIndex,\n      pointerEvents:\n        widgetState.readonly || widget.computedDisabled ? 'none' : 'auto',\n      opacity: widget.computedDisabled ? 0.5 : 1\n    }\n  },\n  { deep: true }\n)\n\nwatch(\n  () => widgetState.visible,\n  (newVisible, oldVisible) => {\n    if (!newVisible && oldVisible) {\n      widget.options.onHide?.(widget)\n    }\n  }\n)\nuseEventListener(document, 'mousedown', (event) => {\n  if (!isDOMWidget(widget) || !widgetState.visible || !widget.element.blur) {\n    return\n  }\n  if (!widget.element.contains(event.target as HTMLElement)) {\n    widget.element.blur()\n  }\n})\n\nonMounted(() => {\n  if (!isDOMWidget(widget)) {\n    return\n  }\n  useEventListener(\n    widget.element,\n    widget.options.selectOn ?? ['focus', 'click'],\n    () => {\n      const lgCanvas = canvasStore.canvas\n      lgCanvas?.selectNode(widgetState.widget.node)\n      lgCanvas?.bringToFront(widgetState.widget.node)\n    }\n  )\n})\n\nconst inputSpec = widget.node.constructor.nodeData\nconst tooltip = inputSpec?.inputs?.[widget.name]?.tooltip\n\n// Mount DOM element when widget is or becomes visible\nconst mountElementIfVisible = () => {\n  if (!(widgetState.visible && isDOMWidget(widget) && widgetElement.value)) {\n    return\n  }\n  // Only append if not already a child\n  if (widgetElement.value.contains(widget.element)) {\n    return\n  }\n  widgetElement.value.appendChild(widget.element)\n}\n\n// Check on mount - but only after next tick to ensure visibility is calculated\nonMounted(() => {\n  nextTick(() => {\n    mountElementIfVisible()\n  }).catch((error) => {\n    console.error('Error mounting DOM widget element:', error)\n  })\n})\n\n// And watch for visibility changes\nwatch(\n  () => widgetState.visible,\n  () => {\n    mountElementIfVisible()\n  }\n)\n</script>\n\n<style scoped>\n@reference '../../../assets/css/style.css';\n\n.dom-widget > * {\n  @apply h-full w-full;\n}\n</style>\n","<template>\n  <!-- Create a new stacking context for widgets to avoid z-index issues -->\n  <div class=\"isolate\">\n    <DomWidget\n      v-for=\"widgetState in widgetStates\"\n      :key=\"widgetState.widget.id\"\n      :widget-state=\"widgetState\"\n      @update:widget-value=\"widgetState.widget.value = $event\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { whenever } from '@vueuse/core'\nimport { computed } from 'vue'\n\nimport DomWidget from '@/components/graph/widgets/DomWidget.vue'\nimport { useChainCallback } from '@/composables/functional/useChainCallback'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useDomWidgetStore } from '@/stores/domWidgetStore'\n\nconst domWidgetStore = useDomWidgetStore()\n\nconst widgetStates = computed(() => [...domWidgetStore.widgetStates.values()])\n\nconst updateWidgets = () => {\n  const lgCanvas = canvasStore.canvas\n  if (!lgCanvas) return\n\n  const lowQuality = lgCanvas.low_quality\n  const currentGraph = lgCanvas.graph\n\n  for (const widgetState of widgetStates.value) {\n    const widget = widgetState.widget\n\n    // Early exit for non-visible widgets\n    if (!widget.isVisible() || !widgetState.active) {\n      widgetState.visible = false\n      continue\n    }\n\n    // Check if the widget's node is in the current graph\n    const node = widget.node\n    const isInCorrectGraph = currentGraph?.nodes.includes(node)\n\n    widgetState.visible =\n      !!isInCorrectGraph &&\n      lgCanvas.isNodeVisible(node) &&\n      !(widget.options.hideOnZoom && lowQuality)\n\n    if (widgetState.visible && node) {\n      const margin = widget.margin\n      widgetState.pos = [node.pos[0] + margin, node.pos[1] + margin + widget.y]\n      widgetState.size = [\n        (widget.width ?? node.width) - margin * 2,\n        (widget.computedHeight ?? 50) - margin * 2\n      ]\n      // TODO: optimize this logic as it's O(n), where n is the number of nodes\n      widgetState.zIndex = lgCanvas.graph?.nodes.indexOf(node) ?? -1\n      widgetState.readonly = lgCanvas.read_only\n    }\n  }\n}\n\nconst canvasStore = useCanvasStore()\nwhenever(\n  () => canvasStore.canvas,\n  (canvas) =>\n    (canvas.onDrawForeground = useChainCallback(\n      canvas.onDrawForeground,\n      updateWidgets\n    )),\n  { immediate: true }\n)\n</script>\n","import { computed, ref } from 'vue'\n\nexport function useZoomControls() {\n  const isModalVisible = ref(false)\n\n  const showModal = () => {\n    isModalVisible.value = true\n  }\n\n  const hideModal = () => {\n    isModalVisible.value = false\n  }\n\n  const toggleModal = () => {\n    isModalVisible.value = !isModalVisible.value\n  }\n\n  const hasActivePopup = computed(() => isModalVisible.value)\n\n  return {\n    isModalVisible,\n    showModal,\n    hideModal,\n    toggleModal,\n    hasActivePopup\n  }\n}\n","import { useThrottleFn } from '@vueuse/core'\nimport { ref, watch } from 'vue'\nimport type { Ref } from 'vue'\n\nimport type {\n  LGraph,\n  LGraphNode,\n  LGraphTriggerEvent\n} from '@/lib/litegraph/src/litegraph'\nimport type { NodeId } from '@/platform/workflow/validation/schemas/workflowSchema'\nimport { layoutStore } from '@/renderer/core/layout/store/layoutStore'\nimport { api } from '@/scripts/api'\n\nimport { MinimapDataSourceFactory } from '../data/MinimapDataSourceFactory'\nimport type { UpdateFlags } from '../types'\n\ninterface GraphCallbacks {\n  onNodeAdded?: (node: LGraphNode) => void\n  onNodeRemoved?: (node: LGraphNode) => void\n  onConnectionChange?: (node: LGraphNode) => void\n  onTrigger?: (event: LGraphTriggerEvent) => void\n}\n\nexport function useMinimapGraph(\n  graph: Ref<LGraph | null>,\n  onGraphChanged: () => void\n) {\n  const nodeStatesCache = new Map<NodeId, string>()\n  const linksCache = ref<string>('')\n  const lastNodeCount = ref(0)\n  const updateFlags = ref<UpdateFlags>({\n    bounds: false,\n    nodes: false,\n    connections: false,\n    viewport: false\n  })\n\n  // Track LayoutStore version for change detection\n  const layoutStoreVersion = layoutStore.getVersion()\n\n  // Map to store original callbacks per graph ID\n  const originalCallbacksMap = new Map<string, GraphCallbacks>()\n\n  const handleGraphChangedThrottled = useThrottleFn(() => {\n    onGraphChanged()\n  }, 500)\n\n  const setupEventListeners = () => {\n    const g = graph.value\n    if (!g) return\n\n    // Check if we've already wrapped this graph's callbacks\n    if (originalCallbacksMap.has(g.id)) {\n      return\n    }\n\n    // Store the original callbacks for this graph\n    const originalCallbacks: GraphCallbacks = {\n      onNodeAdded: g.onNodeAdded,\n      onNodeRemoved: g.onNodeRemoved,\n      onConnectionChange: g.onConnectionChange,\n      onTrigger: g.onTrigger\n    }\n    originalCallbacksMap.set(g.id, originalCallbacks)\n\n    g.onNodeAdded = function (node: LGraphNode) {\n      originalCallbacks.onNodeAdded?.call(this, node)\n      void handleGraphChangedThrottled()\n    }\n\n    g.onNodeRemoved = function (node: LGraphNode) {\n      originalCallbacks.onNodeRemoved?.call(this, node)\n      nodeStatesCache.delete(node.id)\n      void handleGraphChangedThrottled()\n    }\n\n    g.onConnectionChange = function (node: LGraphNode) {\n      originalCallbacks.onConnectionChange?.call(this, node)\n      void handleGraphChangedThrottled()\n    }\n\n    g.onTrigger = function (event: LGraphTriggerEvent) {\n      originalCallbacks.onTrigger?.call(this, event)\n\n      // Listen for visual property changes that affect minimap rendering\n      if (\n        event.type === 'node:property:changed' &&\n        (event.property === 'mode' ||\n          event.property === 'bgcolor' ||\n          event.property === 'color')\n      ) {\n        // Invalidate cache for this node to force redraw\n        nodeStatesCache.delete(String(event.nodeId))\n        void handleGraphChangedThrottled()\n      }\n    }\n  }\n\n  const cleanupEventListeners = (oldGraph?: LGraph) => {\n    const g = oldGraph || graph.value\n    if (!g) return\n\n    const originalCallbacks = originalCallbacksMap.get(g.id)\n    if (!originalCallbacks) {\n      console.error(\n        'Attempted to cleanup event listeners for graph that was never set up'\n      )\n      return\n    }\n\n    g.onNodeAdded = originalCallbacks.onNodeAdded\n    g.onNodeRemoved = originalCallbacks.onNodeRemoved\n    g.onConnectionChange = originalCallbacks.onConnectionChange\n    g.onTrigger = originalCallbacks.onTrigger\n\n    originalCallbacksMap.delete(g.id)\n  }\n\n  const checkForChangesInternal = () => {\n    const g = graph.value\n    if (!g) return false\n\n    let structureChanged = false\n    let positionChanged = false\n    let connectionChanged = false\n\n    // Use unified data source for change detection\n    const dataSource = MinimapDataSourceFactory.create(g)\n\n    // Check for node count changes\n    const currentNodeCount = dataSource.getNodeCount()\n    if (currentNodeCount !== lastNodeCount.value) {\n      structureChanged = true\n      lastNodeCount.value = currentNodeCount\n    }\n\n    // Check for node position/size changes\n    const nodes = dataSource.getNodes()\n    for (const node of nodes) {\n      const nodeId = node.id\n      const currentState = `${node.x},${node.y},${node.width},${node.height}`\n\n      if (nodeStatesCache.get(nodeId) !== currentState) {\n        positionChanged = true\n        nodeStatesCache.set(nodeId, currentState)\n      }\n    }\n\n    // Clean up removed nodes from cache\n    const currentNodeIds = new Set(nodes.map((n) => n.id))\n    for (const [nodeId] of nodeStatesCache) {\n      if (!currentNodeIds.has(nodeId)) {\n        nodeStatesCache.delete(nodeId)\n        structureChanged = true\n      }\n    }\n\n    // TODO: update when Layoutstore tracks links\n    const currentLinks = JSON.stringify(g.links || {})\n    if (currentLinks !== linksCache.value) {\n      connectionChanged = true\n      linksCache.value = currentLinks\n    }\n\n    if (structureChanged || positionChanged) {\n      updateFlags.value.bounds = true\n      updateFlags.value.nodes = true\n    }\n\n    if (connectionChanged) {\n      updateFlags.value.connections = true\n    }\n\n    return structureChanged || positionChanged || connectionChanged\n  }\n\n  const init = () => {\n    setupEventListeners()\n    api.addEventListener('graphChanged', handleGraphChangedThrottled)\n\n    watch(layoutStoreVersion, () => {\n      void handleGraphChangedThrottled()\n    })\n  }\n\n  const destroy = () => {\n    cleanupEventListeners()\n    api.removeEventListener('graphChanged', handleGraphChangedThrottled)\n    nodeStatesCache.clear()\n  }\n\n  const clearCache = () => {\n    nodeStatesCache.clear()\n    linksCache.value = ''\n    lastNodeCount.value = 0\n  }\n\n  return {\n    updateFlags,\n    setupEventListeners,\n    cleanupEventListeners,\n    checkForChanges: checkForChangesInternal,\n    init,\n    destroy,\n    clearCache\n  }\n}\n","import { ref } from 'vue'\nimport type { Ref } from 'vue'\n\nimport type { MinimapCanvas } from '../types'\n\nexport function useMinimapInteraction(\n  containerRef: Ref<HTMLDivElement | undefined>,\n  bounds: Ref<{ minX: number; minY: number; width: number; height: number }>,\n  scale: Ref<number>,\n  width: number,\n  height: number,\n  centerViewOn: (worldX: number, worldY: number) => void,\n  canvas: Ref<MinimapCanvas | null>\n) {\n  const isDragging = ref(false)\n  const containerRect = ref({\n    left: 0,\n    top: 0,\n    width: width,\n    height: height\n  })\n\n  const updateContainerRect = () => {\n    if (!containerRef.value) return\n\n    const rect = containerRef.value.getBoundingClientRect()\n    containerRect.value = {\n      left: rect.left,\n      top: rect.top,\n      width: rect.width,\n      height: rect.height\n    }\n  }\n\n  const handlePointerDown = (e: PointerEvent) => {\n    isDragging.value = true\n    updateContainerRect()\n    const target = e.currentTarget\n    if (target instanceof HTMLElement) {\n      target.setPointerCapture(e.pointerId)\n    }\n    handlePointerMove(e)\n  }\n\n  const handlePointerMove = (e: PointerEvent) => {\n    if (!isDragging.value || !canvas.value) return\n\n    const x = e.clientX - containerRect.value.left\n    const y = e.clientY - containerRect.value.top\n\n    const offsetX = (width - bounds.value.width * scale.value) / 2\n    const offsetY = (height - bounds.value.height * scale.value) / 2\n\n    const worldX = (x - offsetX) / scale.value + bounds.value.minX\n    const worldY = (y - offsetY) / scale.value + bounds.value.minY\n\n    centerViewOn(worldX, worldY)\n  }\n\n  const releasePointer = (e?: PointerEvent) => {\n    isDragging.value = false\n    if (!e) return\n\n    const target = e.currentTarget\n    if (\n      target instanceof HTMLElement &&\n      target.hasPointerCapture(e.pointerId)\n    ) {\n      target.releasePointerCapture(e.pointerId)\n    }\n  }\n\n  const handlePointerUp = releasePointer\n\n  const handlePointerCancel = releasePointer\n\n  const handleWheel = (e: WheelEvent) => {\n    e.preventDefault()\n\n    const c = canvas.value\n    if (!c) return\n\n    if (\n      containerRect.value.left === 0 &&\n      containerRect.value.top === 0 &&\n      containerRef.value\n    ) {\n      updateContainerRect()\n    }\n\n    const ds = c.ds\n    const delta = e.deltaY > 0 ? 0.9 : 1.1\n\n    const newScale = ds.scale * delta\n\n    const MIN_SCALE = 0.1\n    const MAX_SCALE = 10\n\n    if (newScale < MIN_SCALE || newScale > MAX_SCALE) return\n\n    const x = e.clientX - containerRect.value.left\n    const y = e.clientY - containerRect.value.top\n\n    const offsetX = (width - bounds.value.width * scale.value) / 2\n    const offsetY = (height - bounds.value.height * scale.value) / 2\n\n    const worldX = (x - offsetX) / scale.value + bounds.value.minX\n    const worldY = (y - offsetY) / scale.value + bounds.value.minY\n\n    ds.scale = newScale\n\n    centerViewOn(worldX, worldY)\n  }\n\n  return {\n    isDragging,\n    containerRect,\n    updateContainerRect,\n    handlePointerDown,\n    handlePointerMove,\n    handlePointerUp,\n    handlePointerCancel,\n    handleWheel\n  }\n}\n","import { ref } from 'vue'\nimport type { Ref } from 'vue'\n\nimport type { LGraph } from '@/lib/litegraph/src/litegraph'\n\nimport { renderMinimapToCanvas } from '../minimapCanvasRenderer'\nimport type { UpdateFlags } from '../types'\n\nexport function useMinimapRenderer(\n  canvasRef: Ref<HTMLCanvasElement | undefined>,\n  graph: Ref<LGraph | null>,\n  bounds: Ref<{ minX: number; minY: number; width: number; height: number }>,\n  scale: Ref<number>,\n  updateFlags: Ref<UpdateFlags>,\n  settings: {\n    nodeColors: Ref<boolean>\n    showLinks: Ref<boolean>\n    showGroups: Ref<boolean>\n    renderBypass: Ref<boolean>\n    renderError: Ref<boolean>\n  },\n  width: number,\n  height: number\n) {\n  const needsFullRedraw = ref(true)\n  const needsBoundsUpdate = ref(true)\n\n  const renderMinimap = () => {\n    const g = graph.value\n    if (!canvasRef.value || !g) return\n\n    const ctx = canvasRef.value.getContext('2d')\n    if (!ctx) return\n\n    // Fast path for 0 nodes - just show background\n    if (!g._nodes || g._nodes.length === 0) {\n      ctx.clearRect(0, 0, width, height)\n      return\n    }\n\n    const needsRedraw =\n      needsFullRedraw.value ||\n      updateFlags.value.nodes ||\n      updateFlags.value.connections\n\n    if (needsRedraw) {\n      renderMinimapToCanvas(canvasRef.value, g, {\n        bounds: bounds.value,\n        scale: scale.value,\n        settings: {\n          nodeColors: settings.nodeColors.value,\n          showLinks: settings.showLinks.value,\n          showGroups: settings.showGroups.value,\n          renderBypass: settings.renderBypass.value,\n          renderError: settings.renderError.value\n        },\n        width,\n        height\n      })\n\n      needsFullRedraw.value = false\n      updateFlags.value.nodes = false\n      updateFlags.value.connections = false\n    }\n  }\n\n  const updateMinimap = (\n    updateBounds: () => void,\n    updateViewport: () => void\n  ) => {\n    if (needsBoundsUpdate.value || updateFlags.value.bounds) {\n      updateBounds()\n      needsBoundsUpdate.value = false\n      updateFlags.value.bounds = false\n      needsFullRedraw.value = true\n      // When bounds change, we need to update the viewport position\n      updateFlags.value.viewport = true\n    }\n\n    if (\n      needsFullRedraw.value ||\n      updateFlags.value.nodes ||\n      updateFlags.value.connections\n    ) {\n      renderMinimap()\n    }\n\n    // Update viewport if needed (e.g., after bounds change)\n    if (updateFlags.value.viewport) {\n      updateViewport()\n      updateFlags.value.viewport = false\n    }\n  }\n\n  const forceFullRedraw = () => {\n    needsFullRedraw.value = true\n    updateFlags.value.bounds = true\n    updateFlags.value.nodes = true\n    updateFlags.value.connections = true\n    updateFlags.value.viewport = true\n  }\n\n  return {\n    needsFullRedraw,\n    needsBoundsUpdate,\n    renderMinimap,\n    updateMinimap,\n    forceFullRedraw\n  }\n}\n","import { computed } from 'vue'\n\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useColorPaletteStore } from '@/stores/workspace/colorPaletteStore'\n\n/**\n * Composable for minimap configuration options that are set by the user in the\n * settings. Provides reactive computed properties for the settings.\n */\nexport function useMinimapSettings() {\n  const settingStore = useSettingStore()\n  const colorPaletteStore = useColorPaletteStore()\n\n  const nodeColors = computed(() =>\n    settingStore.get('Comfy.Minimap.NodeColors')\n  )\n  const showLinks = computed(() => settingStore.get('Comfy.Minimap.ShowLinks'))\n  const showGroups = computed(() =>\n    settingStore.get('Comfy.Minimap.ShowGroups')\n  )\n  const renderBypass = computed(() =>\n    settingStore.get('Comfy.Minimap.RenderBypassState')\n  )\n  const renderError = computed(() =>\n    settingStore.get('Comfy.Minimap.RenderErrorState')\n  )\n\n  const width = 253\n  const height = 200\n\n  // Theme-aware colors\n  const isLightTheme = computed(\n    () => colorPaletteStore.completedActivePalette.light_theme\n  )\n\n  const containerStyles = computed(() => ({\n    width: `${width}px`,\n    height: `${height}px`,\n    border: '1px solid var(--interface-stroke)',\n    borderRadius: '8px'\n  }))\n\n  const panelStyles = computed(() => ({\n    width: `210px`,\n    height: `${height}px`,\n    border: '1px solid var(--interface-stroke)',\n    borderRadius: '8px'\n  }))\n\n  return {\n    nodeColors,\n    showLinks,\n    showGroups,\n    renderBypass,\n    renderError,\n    containerStyles,\n    panelStyles,\n    isLightTheme\n  }\n}\n","import { useRafFn } from '@vueuse/core'\nimport { computed, ref } from 'vue'\nimport type { Ref } from 'vue'\n\nimport type { LGraph } from '@/lib/litegraph/src/litegraph'\nimport {\n  calculateMinimapScale,\n  enforceMinimumBounds\n} from '@/renderer/core/spatial/boundsCalculator'\nimport { MinimapDataSourceFactory } from '@/renderer/extensions/minimap/data/MinimapDataSourceFactory'\n\nimport type { MinimapBounds, MinimapCanvas, ViewportTransform } from '../types'\n\nexport function useMinimapViewport(\n  canvas: Ref<MinimapCanvas | null>,\n  graph: Ref<LGraph | null>,\n  width: number,\n  height: number\n) {\n  const bounds = ref<MinimapBounds>({\n    minX: 0,\n    minY: 0,\n    maxX: 0,\n    maxY: 0,\n    width: 0,\n    height: 0\n  })\n\n  const scale = ref(1)\n  const viewportTransform = ref<ViewportTransform>({\n    x: 0,\n    y: 0,\n    width: 0,\n    height: 0\n  })\n\n  const canvasDimensions = ref({\n    width: 0,\n    height: 0\n  })\n\n  const updateCanvasDimensions = () => {\n    const c = canvas.value\n    if (!c) return\n\n    const canvasEl = c.canvas\n    const dpr = window.devicePixelRatio || 1\n\n    canvasDimensions.value = {\n      width: canvasEl.clientWidth || canvasEl.width / dpr,\n      height: canvasEl.clientHeight || canvasEl.height / dpr\n    }\n  }\n\n  const calculateGraphBounds = (): MinimapBounds => {\n    // Use unified data source\n    const dataSource = MinimapDataSourceFactory.create(graph.value)\n\n    if (!dataSource.hasData()) {\n      return { minX: 0, minY: 0, maxX: 100, maxY: 100, width: 100, height: 100 }\n    }\n\n    const sourceBounds = dataSource.getBounds()\n    return enforceMinimumBounds(sourceBounds)\n  }\n\n  const calculateScale = () => {\n    return calculateMinimapScale(bounds.value, width, height)\n  }\n\n  const updateViewport = () => {\n    const c = canvas.value\n    if (!c) return\n\n    if (\n      canvasDimensions.value.width === 0 ||\n      canvasDimensions.value.height === 0\n    ) {\n      updateCanvasDimensions()\n    }\n\n    const ds = c.ds\n\n    const viewportWidth = canvasDimensions.value.width / ds.scale\n    const viewportHeight = canvasDimensions.value.height / ds.scale\n\n    const worldX = -ds.offset[0]\n    const worldY = -ds.offset[1]\n\n    const centerOffsetX = (width - bounds.value.width * scale.value) / 2\n    const centerOffsetY = (height - bounds.value.height * scale.value) / 2\n\n    viewportTransform.value = {\n      x: (worldX - bounds.value.minX) * scale.value + centerOffsetX,\n      y: (worldY - bounds.value.minY) * scale.value + centerOffsetY,\n      width: viewportWidth * scale.value,\n      height: viewportHeight * scale.value\n    }\n  }\n\n  const updateBounds = () => {\n    bounds.value = calculateGraphBounds()\n    scale.value = calculateScale()\n  }\n\n  const centerViewOn = (worldX: number, worldY: number) => {\n    const c = canvas.value\n    if (!c) return\n\n    if (\n      canvasDimensions.value.width === 0 ||\n      canvasDimensions.value.height === 0\n    ) {\n      updateCanvasDimensions()\n    }\n\n    const ds = c.ds\n\n    const viewportWidth = canvasDimensions.value.width / ds.scale\n    const viewportHeight = canvasDimensions.value.height / ds.scale\n\n    ds.offset[0] = -(worldX - viewportWidth / 2)\n    ds.offset[1] = -(worldY - viewportHeight / 2)\n\n    c.setDirty(true, true)\n  }\n  const { resume: startViewportSync, pause: stopViewportSync } =\n    useRafFn(updateViewport)\n\n  return {\n    bounds: computed(() => bounds.value),\n    scale: computed(() => scale.value),\n    viewportTransform: computed(() => viewportTransform.value),\n    canvasDimensions: computed(() => canvasDimensions.value),\n    updateCanvasDimensions,\n    updateViewport,\n    updateBounds,\n    centerViewOn,\n    startViewportSync,\n    stopViewportSync\n  }\n}\n","import { useRafFn } from '@vueuse/core'\nimport { computed, nextTick, ref, watch } from 'vue'\n\nimport type { LGraph } from '@/lib/litegraph/src/litegraph'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\n\nimport type { MinimapCanvas, MinimapSettingsKey } from '../types'\nimport { useMinimapGraph } from './useMinimapGraph'\nimport { useMinimapInteraction } from './useMinimapInteraction'\nimport { useMinimapRenderer } from './useMinimapRenderer'\nimport { useMinimapSettings } from './useMinimapSettings'\nimport { useMinimapViewport } from './useMinimapViewport'\n\nexport function useMinimap() {\n  const canvasStore = useCanvasStore()\n  const workflowStore = useWorkflowStore()\n  const settingStore = useSettingStore()\n\n  const containerRef = ref<HTMLDivElement>()\n  const canvasRef = ref<HTMLCanvasElement>()\n  const minimapRef = ref<HTMLElement | null>(null)\n\n  const visible = ref(true)\n  const initialized = ref(false)\n\n  const width = 250\n  const height = 200\n\n  const canvas = computed(() => canvasStore.canvas as MinimapCanvas | null)\n  const graph = computed(() => {\n    // If we're in a subgraph, use that; otherwise use the canvas graph\n    const activeSubgraph = workflowStore.activeSubgraph\n    return (activeSubgraph || canvas.value?.graph) as LGraph | null\n  })\n\n  // Settings\n  const settings = useMinimapSettings()\n  const {\n    nodeColors,\n    showLinks,\n    showGroups,\n    renderBypass,\n    renderError,\n    containerStyles,\n    panelStyles\n  } = settings\n\n  const updateOption = async (key: MinimapSettingsKey, value: boolean) => {\n    await settingStore.set(key, value)\n    renderer.forceFullRedraw()\n    renderer.updateMinimap(viewport.updateBounds, viewport.updateViewport)\n  }\n\n  // Viewport management\n  const viewport = useMinimapViewport(canvas, graph, width, height)\n\n  // Interaction handling\n  const interaction = useMinimapInteraction(\n    containerRef,\n    viewport.bounds,\n    viewport.scale,\n    width,\n    height,\n    viewport.centerViewOn,\n    canvas\n  )\n\n  // Graph event management\n  const graphManager = useMinimapGraph(graph, () => {\n    renderer.forceFullRedraw()\n    renderer.updateMinimap(viewport.updateBounds, viewport.updateViewport)\n  })\n\n  // Rendering\n  const renderer = useMinimapRenderer(\n    canvasRef,\n    graph,\n    viewport.bounds,\n    viewport.scale,\n    graphManager.updateFlags,\n    settings,\n    width,\n    height\n  )\n\n  // RAF loop for continuous updates\n  const { pause: pauseChangeDetection, resume: resumeChangeDetection } =\n    useRafFn(\n      async () => {\n        if (visible.value) {\n          const hasChanges = await graphManager.checkForChanges()\n          if (hasChanges) {\n            renderer.updateMinimap(\n              viewport.updateBounds,\n              viewport.updateViewport\n            )\n          }\n        }\n      },\n      { immediate: false }\n    )\n\n  const init = async () => {\n    if (initialized.value) return\n\n    visible.value = settingStore.get('Comfy.Minimap.Visible')\n\n    if (canvas.value && graph.value) {\n      graphManager.init()\n\n      if (containerRef.value) {\n        interaction.updateContainerRect()\n      }\n      viewport.updateCanvasDimensions()\n\n      window.addEventListener('resize', interaction.updateContainerRect)\n      window.addEventListener('scroll', interaction.updateContainerRect)\n      window.addEventListener('resize', viewport.updateCanvasDimensions)\n\n      renderer.forceFullRedraw()\n      renderer.updateMinimap(viewport.updateBounds, viewport.updateViewport)\n      viewport.updateViewport()\n\n      if (visible.value) {\n        resumeChangeDetection()\n        viewport.startViewportSync()\n      }\n      initialized.value = true\n    }\n  }\n\n  const destroy = () => {\n    pauseChangeDetection()\n    viewport.stopViewportSync()\n    graphManager.destroy()\n\n    window.removeEventListener('resize', interaction.updateContainerRect)\n    window.removeEventListener('scroll', interaction.updateContainerRect)\n    window.removeEventListener('resize', viewport.updateCanvasDimensions)\n\n    initialized.value = false\n  }\n\n  watch(\n    canvas,\n    async (newCanvas, oldCanvas) => {\n      if (oldCanvas) {\n        graphManager.cleanupEventListeners()\n        pauseChangeDetection()\n        viewport.stopViewportSync()\n        graphManager.destroy()\n        window.removeEventListener('resize', interaction.updateContainerRect)\n        window.removeEventListener('scroll', interaction.updateContainerRect)\n        window.removeEventListener('resize', viewport.updateCanvasDimensions)\n      }\n      if (newCanvas && !initialized.value) {\n        await init()\n      }\n    },\n    { immediate: true, flush: 'post' }\n  )\n\n  // Watch for graph changes (e.g., when navigating to/from subgraphs)\n  watch(graph, (newGraph, oldGraph) => {\n    if (newGraph && newGraph !== oldGraph) {\n      graphManager.cleanupEventListeners(oldGraph || undefined)\n      graphManager.setupEventListeners()\n      renderer.forceFullRedraw()\n      renderer.updateMinimap(viewport.updateBounds, viewport.updateViewport)\n    }\n  })\n\n  watch(visible, async (isVisible) => {\n    if (isVisible) {\n      if (containerRef.value) {\n        interaction.updateContainerRect()\n      }\n      viewport.updateCanvasDimensions()\n\n      renderer.forceFullRedraw()\n\n      await nextTick()\n      await nextTick()\n\n      renderer.updateMinimap(viewport.updateBounds, viewport.updateViewport)\n      viewport.updateViewport()\n      resumeChangeDetection()\n      viewport.startViewportSync()\n    } else {\n      pauseChangeDetection()\n      viewport.stopViewportSync()\n    }\n  })\n\n  const toggle = async () => {\n    visible.value = !visible.value\n    await settingStore.set('Comfy.Minimap.Visible', visible.value)\n  }\n\n  const setMinimapRef = (ref: HTMLElement | null) => {\n    minimapRef.value = ref\n  }\n\n  // Dynamic viewport styles based on actual viewport transform\n  const viewportStyles = computed(() => {\n    const transform = viewport.viewportTransform.value\n    return {\n      transform: `translate(${transform.x}px, ${transform.y}px)`,\n      width: `${transform.width}px`,\n      height: `${transform.height}px`,\n      border: `2px solid ${settings.isLightTheme.value ? '#E0E0E0' : '#FFF'}`,\n      backgroundColor: `rgba(255, 255, 255, 0.2)`,\n      willChange: 'transform',\n      backfaceVisibility: 'hidden' as const,\n      perspective: '1000px',\n      pointerEvents: 'none' as const\n    }\n  })\n\n  return {\n    visible: computed(() => visible.value),\n    initialized: computed(() => initialized.value),\n\n    containerRef,\n    canvasRef,\n    containerStyles,\n    viewportStyles,\n    panelStyles,\n    width,\n    height,\n\n    nodeColors,\n    showLinks,\n    showGroups,\n    renderBypass,\n    renderError,\n\n    init,\n    destroy,\n    toggle,\n    renderMinimap: renderer.renderMinimap,\n    handlePointerDown: interaction.handlePointerDown,\n    handlePointerMove: interaction.handlePointerMove,\n    handlePointerUp: interaction.handlePointerUp,\n    handlePointerCancel: interaction.handlePointerCancel,\n    handleWheel: interaction.handleWheel,\n    setMinimapRef,\n    updateOption\n  }\n}\n","<template>\n  <Button\n    ref=\"buttonRef\"\n    severity=\"secondary\"\n    class=\"group h-8 rounded-none! bg-comfy-menu-bg p-0 transition-none! hover:rounded-lg! hover:bg-interface-button-hover-surface!\"\n    :style=\"buttonStyles\"\n    @click=\"toggle\"\n  >\n    <template #default>\n      <div class=\"flex items-center gap-1 pr-0.5\">\n        <div\n          class=\"rounded-lg bg-interface-panel-selected-surface p-2 group-hover:bg-interface-button-hover-surface\"\n        >\n          <i :class=\"currentModeIcon\" class=\"block h-4 w-4\" />\n        </div>\n        <i class=\"icon-[lucide--chevron-down] block h-4 w-4 pr-1.5\" />\n      </div>\n    </template>\n  </Button>\n\n  <Popover\n    ref=\"popover\"\n    :auto-z-index=\"true\"\n    :base-z-index=\"1000\"\n    :dismissable=\"true\"\n    :close-on-escape=\"true\"\n    unstyled\n    :pt=\"popoverPt\"\n  >\n    <div class=\"flex flex-col gap-1\">\n      <div\n        class=\"flex cursor-pointer items-center justify-between px-3 py-2 text-sm hover:bg-node-component-surface-hovered\"\n        @click=\"setMode('select')\"\n      >\n        <div class=\"flex items-center gap-2\">\n          <i class=\"icon-[lucide--mouse-pointer-2] h-4 w-4\" />\n          <span>{{ $t('graphCanvasMenu.select') }}</span>\n        </div>\n        <span class=\"text-[9px] text-text-primary\">{{\n          unlockCommandText\n        }}</span>\n      </div>\n\n      <div\n        class=\"flex cursor-pointer items-center justify-between rounded px-3 py-2 text-sm hover:bg-node-component-surface-hovered\"\n        @click=\"setMode('hand')\"\n      >\n        <div class=\"flex items-center gap-2\">\n          <i class=\"icon-[lucide--hand] h-4 w-4\" />\n          <span>{{ $t('graphCanvasMenu.hand') }}</span>\n        </div>\n        <span class=\"text-[9px] text-text-primary\">{{ lockCommandText }}</span>\n      </div>\n    </div>\n  </Popover>\n</template>\n\n<script setup lang=\"ts\">\nimport Button from 'primevue/button'\nimport Popover from 'primevue/popover'\nimport { computed, ref } from 'vue'\n\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useCommandStore } from '@/stores/commandStore'\n\ninterface Props {\n  buttonStyles?: Record<string, string>\n}\n\ndefineProps<Props>()\nconst buttonRef = ref<InstanceType<typeof Button>>()\nconst popover = ref<InstanceType<typeof Popover>>()\nconst commandStore = useCommandStore()\nconst canvasStore = useCanvasStore()\n\nconst isCanvasReadOnly = computed(() => canvasStore.canvas?.read_only ?? false)\n\nconst currentModeIcon = computed(() =>\n  isCanvasReadOnly.value\n    ? 'icon-[lucide--hand]'\n    : 'icon-[lucide--mouse-pointer-2]'\n)\n\nconst unlockCommandText = computed(() =>\n  commandStore\n    .formatKeySequence(commandStore.getCommand('Comfy.Canvas.Unlock'))\n    .toUpperCase()\n)\n\nconst lockCommandText = computed(() =>\n  commandStore\n    .formatKeySequence(commandStore.getCommand('Comfy.Canvas.Lock'))\n    .toUpperCase()\n)\n\nconst toggle = (event: Event) => {\n  const el = (buttonRef.value as any)?.$el || buttonRef.value\n  popover.value?.toggle(event, el)\n}\n\nconst setMode = (mode: 'select' | 'hand') => {\n  if (mode === 'select' && isCanvasReadOnly.value) {\n    void commandStore.execute('Comfy.Canvas.Unlock')\n  } else if (mode === 'hand' && !isCanvasReadOnly.value) {\n    void commandStore.execute('Comfy.Canvas.Lock')\n  }\n  popover.value?.hide()\n}\n\nconst popoverPt = computed(() => ({\n  root: {\n    class: 'absolute z-50 -translate-y-2'\n  },\n  content: {\n    class: [\n      'mb-2 text-text-primary',\n      'shadow-lg border border-interface-stroke',\n      'bg-nav-background',\n      'rounded-lg',\n      'p-2 px-3',\n      'min-w-39',\n      'select-none'\n    ]\n  }\n}))\n</script>\n","<template>\n  <div\n    v-if=\"visible\"\n    class=\"absolute right-0 bottom-[62px] z-1300 flex w-[250px] justify-center border-0! bg-inherit!\"\n  >\n    <div\n      class=\"w-4/5 rounded-lg border border-interface-stroke bg-interface-panel-surface p-2 text-text-primary shadow-lg select-none\"\n      :style=\"filteredMinimapStyles\"\n      @click.stop\n    >\n      <div class=\"flex flex-col gap-1\">\n        <div\n          class=\"flex cursor-pointer items-center justify-between rounded px-3 py-2 text-sm hover:bg-node-component-surface-hovered\"\n          @mousedown=\"startRepeat('Comfy.Canvas.ZoomIn')\"\n          @mouseup=\"stopRepeat\"\n          @mouseleave=\"stopRepeat\"\n        >\n          <span class=\"font-medium\">{{ $t('graphCanvasMenu.zoomIn') }}</span>\n          <span class=\"text-[9px] text-text-primary\">{{\n            zoomInCommandText\n          }}</span>\n        </div>\n\n        <div\n          class=\"flex cursor-pointer items-center justify-between rounded px-3 py-2 text-sm hover:bg-node-component-surface-hovered\"\n          @mousedown=\"startRepeat('Comfy.Canvas.ZoomOut')\"\n          @mouseup=\"stopRepeat\"\n          @mouseleave=\"stopRepeat\"\n        >\n          <span class=\"font-medium\">{{ $t('graphCanvasMenu.zoomOut') }}</span>\n          <span class=\"text-[9px] text-text-primary\">{{\n            zoomOutCommandText\n          }}</span>\n        </div>\n\n        <div\n          class=\"flex cursor-pointer items-center justify-between rounded px-3 py-2 text-sm hover:bg-node-component-surface-hovered\"\n          @click=\"executeCommand('Comfy.Canvas.FitView')\"\n        >\n          <span class=\"font-medium\">{{ $t('zoomControls.zoomToFit') }}</span>\n          <span class=\"text-[9px] text-text-primary\">{{\n            zoomToFitCommandText\n          }}</span>\n        </div>\n\n        <div\n          ref=\"zoomInputContainer\"\n          class=\"zoomInputContainer flex items-center gap-1 rounded bg-input-surface p-2\"\n        >\n          <InputNumber\n            ref=\"zoomInput\"\n            :default-value=\"canvasStore.appScalePercentage\"\n            :min=\"1\"\n            :max=\"1000\"\n            :show-buttons=\"false\"\n            :use-grouping=\"false\"\n            :unstyled=\"true\"\n            input-class=\"bg-transparent border-none outline-hidden text-sm shadow-none my-0 w-full\"\n            fluid\n            @input=\"applyZoom\"\n            @keyup.enter=\"applyZoom\"\n          />\n          <span class=\"flex-shrink-0 text-sm text-text-primary\">%</span>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport type { InputNumberInputEvent } from 'primevue'\nimport { InputNumber } from 'primevue'\nimport { computed, nextTick, ref, watch } from 'vue'\n\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useMinimap } from '@/renderer/extensions/minimap/composables/useMinimap'\nimport { useCommandStore } from '@/stores/commandStore'\n\nconst minimap = useMinimap()\nconst commandStore = useCommandStore()\nconst canvasStore = useCanvasStore()\nconst { formatKeySequence } = useCommandStore()\n\ninterface Props {\n  visible: boolean\n}\n\nconst props = defineProps<Props>()\n\nconst interval = ref<number | null>(null)\n\nconst applyZoom = (val: InputNumberInputEvent) => {\n  const inputValue = val.value as number\n  if (isNaN(inputValue) || inputValue < 1 || inputValue > 1000) {\n    return\n  }\n  canvasStore.setAppZoomFromPercentage(inputValue)\n}\n\nconst executeCommand = (command: string) => {\n  void commandStore.execute(command)\n}\n\nconst startRepeat = (command: string) => {\n  if (interval.value) return\n  const cmd = () => commandStore.execute(command)\n  void cmd()\n  interval.value = window.setInterval(cmd, 100)\n}\n\nconst stopRepeat = () => {\n  if (interval.value) {\n    clearInterval(interval.value)\n    interval.value = null\n  }\n}\nconst filteredMinimapStyles = computed(() => {\n  return {\n    ...minimap.containerStyles.value,\n    height: undefined,\n    width: undefined\n  }\n})\nconst zoomInCommandText = computed(() =>\n  formatKeySequence(commandStore.getCommand('Comfy.Canvas.ZoomIn'))\n)\nconst zoomOutCommandText = computed(() =>\n  formatKeySequence(commandStore.getCommand('Comfy.Canvas.ZoomOut'))\n)\nconst zoomToFitCommandText = computed(() =>\n  formatKeySequence(commandStore.getCommand('Comfy.Canvas.FitView'))\n)\nconst zoomInput = ref<InstanceType<typeof InputNumber> | null>(null)\nconst zoomInputContainer = ref<HTMLDivElement | null>(null)\n\nwatch(\n  () => props.visible,\n  async (newVal) => {\n    if (newVal) {\n      await nextTick()\n      const input = zoomInputContainer.value?.querySelector(\n        'input'\n      ) as HTMLInputElement\n      input?.focus()\n    }\n  }\n)\n</script>\n<style>\n.zoomInputContainer:focus-within {\n  border: 1px solid var(--color-white);\n}\n</style>\n","<template>\n  <div>\n    <ZoomControlsModal :visible=\"isModalVisible\" @close=\"hideModal\" />\n\n    <!-- Backdrop -->\n    <div\n      v-if=\"hasActivePopup\"\n      class=\"fixed inset-0 z-1200\"\n      @click=\"hideModal\"\n    ></div>\n\n    <ButtonGroup\n      class=\"absolute right-0 bottom-0 z-[1200] flex-row gap-1 border-[1px] border-interface-stroke bg-comfy-menu-bg p-2\"\n      :style=\"{\n        ...stringifiedMinimapStyles.buttonGroupStyles\n      }\"\n      @wheel=\"canvasInteractions.handleWheel\"\n    >\n      <CanvasModeSelector\n        :button-styles=\"stringifiedMinimapStyles.buttonStyles\"\n      />\n\n      <div class=\"h-[27px] w-[1px] self-center bg-node-divider\" />\n\n      <Button\n        v-tooltip.top=\"fitViewTooltip\"\n        severity=\"secondary\"\n        icon=\"pi pi-expand\"\n        :aria-label=\"fitViewTooltip\"\n        :style=\"stringifiedMinimapStyles.buttonStyles\"\n        class=\"h-8 w-8 bg-comfy-menu-bg p-0 hover:bg-interface-button-hover-surface!\"\n        @click=\"() => commandStore.execute('Comfy.Canvas.FitView')\"\n      >\n        <template #icon>\n          <i class=\"icon-[lucide--focus] h-4 w-4\" />\n        </template>\n      </Button>\n\n      <Button\n        ref=\"zoomButton\"\n        v-tooltip.top=\"t('zoomControls.label')\"\n        severity=\"secondary\"\n        :label=\"t('zoomControls.label')\"\n        :class=\"zoomButtonClass\"\n        :aria-label=\"t('zoomControls.label')\"\n        data-testid=\"zoom-controls-button\"\n        :style=\"stringifiedMinimapStyles.buttonStyles\"\n        @click=\"toggleModal\"\n      >\n        <span class=\"inline-flex items-center gap-1 px-2 text-xs\">\n          <span>{{ canvasStore.appScalePercentage }}%</span>\n          <i class=\"icon-[lucide--chevron-down] h-4 w-4\" />\n        </span>\n      </Button>\n\n      <div class=\"h-[27px] w-[1px] self-center bg-node-divider\" />\n\n      <Button\n        ref=\"minimapButton\"\n        v-tooltip.top=\"minimapTooltip\"\n        severity=\"secondary\"\n        :aria-label=\"minimapTooltip\"\n        data-testid=\"toggle-minimap-button\"\n        :style=\"stringifiedMinimapStyles.buttonStyles\"\n        :class=\"minimapButtonClass\"\n        @click=\"onMinimapToggleClick\"\n      >\n        <template #icon>\n          <i class=\"icon-[lucide--map] h-4 w-4\" />\n        </template>\n      </Button>\n\n      <Button\n        v-tooltip.top=\"{\n          value: linkVisibilityTooltip,\n          pt: {\n            root: {\n              style: 'z-index: 2; transform: translateY(-20px);'\n            }\n          }\n        }\"\n        severity=\"secondary\"\n        :class=\"linkVisibleClass\"\n        :aria-label=\"linkVisibilityAriaLabel\"\n        data-testid=\"toggle-link-visibility-button\"\n        :style=\"stringifiedMinimapStyles.buttonStyles\"\n        @click=\"onLinkVisibilityToggleClick\"\n      >\n        <template #icon>\n          <i class=\"icon-[lucide--route-off] h-4 w-4\" />\n        </template>\n      </Button>\n    </ButtonGroup>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport Button from 'primevue/button'\nimport ButtonGroup from 'primevue/buttongroup'\nimport { computed, onBeforeUnmount, onMounted } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport { useZoomControls } from '@/composables/useZoomControls'\nimport { LiteGraph } from '@/lib/litegraph/src/litegraph'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useCanvasInteractions } from '@/renderer/core/canvas/useCanvasInteractions'\nimport { useMinimap } from '@/renderer/extensions/minimap/composables/useMinimap'\nimport { useCommandStore } from '@/stores/commandStore'\n\nimport CanvasModeSelector from './CanvasModeSelector.vue'\nimport ZoomControlsModal from './modals/ZoomControlsModal.vue'\n\nconst { t } = useI18n()\nconst commandStore = useCommandStore()\nconst { formatKeySequence } = useCommandStore()\nconst canvasStore = useCanvasStore()\nconst settingStore = useSettingStore()\nconst canvasInteractions = useCanvasInteractions()\nconst minimap = useMinimap()\n\nconst { isModalVisible, toggleModal, hideModal, hasActivePopup } =\n  useZoomControls()\n\nconst stringifiedMinimapStyles = computed(() => {\n  const buttonGroupKeys = ['borderRadius']\n  const buttonKeys = ['borderRadius']\n  const additionalButtonStyles = {\n    border: 'none'\n  }\n\n  const containerStyles = minimap.containerStyles.value\n\n  const buttonStyles = {\n    ...Object.fromEntries(\n      Object.entries(containerStyles).filter(([key]) =>\n        buttonKeys.includes(key)\n      )\n    ),\n    ...additionalButtonStyles\n  }\n  const buttonGroupStyles = Object.entries(containerStyles)\n    .filter(([key]) => buttonGroupKeys.includes(key))\n    .reduce((acc, [key, value]) => ({ ...acc, [key]: value }), {})\n\n  return { buttonStyles, buttonGroupStyles }\n})\n\n// Computed properties for reactive states\nconst linkHidden = computed(\n  () => settingStore.get('Comfy.LinkRenderMode') === LiteGraph.HIDDEN_LINK\n)\n\n// Computed properties for command text\nconst fitViewCommandText = computed(() =>\n  formatKeySequence(\n    commandStore.getCommand('Comfy.Canvas.FitView')\n  ).toUpperCase()\n)\nconst minimapCommandText = computed(() =>\n  formatKeySequence(\n    commandStore.getCommand('Comfy.Canvas.ToggleMinimap')\n  ).toUpperCase()\n)\n\n// Computed properties for button classes and states\nconst zoomButtonClass = computed(() => [\n  'bg-comfy-menu-bg',\n  isModalVisible.value ? 'not-active:bg-interface-panel-selected-surface!' : '',\n  'hover:bg-interface-button-hover-surface!',\n  'p-0',\n  'h-8',\n  'w-15'\n])\n\nconst minimapButtonClass = computed(() => ({\n  'bg-comfy-menu-bg': true,\n  'hover:bg-interface-button-hover-surface!': true,\n  'not-active:bg-interface-panel-selected-surface!': settingStore.get(\n    'Comfy.Minimap.Visible'\n  ),\n  'p-0': true,\n  'w-8': true,\n  'h-8': true\n}))\n\n// Computed properties for tooltip and aria-label texts\nconst fitViewTooltip = computed(() => {\n  const label = t('graphCanvasMenu.fitView')\n  const shortcut = fitViewCommandText.value\n  return shortcut ? `${label} (${shortcut})` : label\n})\nconst minimapTooltip = computed(() => {\n  const label = settingStore.get('Comfy.Minimap.Visible')\n    ? t('zoomControls.hideMinimap')\n    : t('zoomControls.showMinimap')\n  const shortcut = minimapCommandText.value\n  return shortcut ? `${label} (${shortcut})` : label\n})\nconst linkVisibilityTooltip = computed(() =>\n  linkHidden.value\n    ? t('graphCanvasMenu.showLinks')\n    : t('graphCanvasMenu.hideLinks')\n)\nconst linkVisibilityAriaLabel = computed(() =>\n  linkHidden.value\n    ? t('graphCanvasMenu.showLinks')\n    : t('graphCanvasMenu.hideLinks')\n)\nconst linkVisibleClass = computed(() => [\n  'bg-comfy-menu-bg',\n  linkHidden.value ? 'not-active:bg-interface-panel-selected-surface!' : '',\n  'hover:bg-interface-button-hover-surface!',\n  'p-0',\n  'w-8',\n  'h-8'\n])\n\nonMounted(() => {\n  canvasStore.initScaleSync()\n})\n\n/**\n * Track minimap toggle button click and execute the command.\n */\nconst onMinimapToggleClick = () => {\n  useTelemetry()?.trackUiButtonClicked({\n    button_id: 'graph_menu_minimap_toggle_clicked'\n  })\n  void commandStore.execute('Comfy.Canvas.ToggleMinimap')\n}\n\n/**\n * Track hide/show links button click and execute the command.\n */\nconst onLinkVisibilityToggleClick = () => {\n  useTelemetry()?.trackUiButtonClicked({\n    button_id: 'graph_menu_hide_links_toggle_clicked'\n  })\n  void commandStore.execute('Comfy.Canvas.ToggleLinkVisibility')\n}\n\nonBeforeUnmount(() => {\n  canvasStore.cleanupScaleSync()\n})\n</script>\n","<template>\n  <div\n    v-if=\"tooltipText\"\n    ref=\"tooltipRef\"\n    class=\"node-tooltip\"\n    :style=\"{ left, top }\"\n  >\n    {{ tooltipText }}\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useEventListener } from '@vueuse/core'\nimport { nextTick, ref } from 'vue'\n\nimport { st } from '@/i18n'\nimport {\n  LiteGraph,\n  isOverNodeInput,\n  isOverNodeOutput\n} from '@/lib/litegraph/src/litegraph'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { app as comfyApp } from '@/scripts/app'\nimport { isDOMWidget } from '@/scripts/domWidget'\nimport { useNodeDefStore } from '@/stores/nodeDefStore'\nimport { normalizeI18nKey } from '@/utils/formatUtil'\n\nlet idleTimeout: number\nconst nodeDefStore = useNodeDefStore()\nconst settingStore = useSettingStore()\nconst tooltipRef = ref<HTMLDivElement | undefined>()\nconst tooltipText = ref('')\nconst left = ref<string>()\nconst top = ref<string>()\n\nfunction hideTooltip() {\n  return (tooltipText.value = '')\n}\n\nasync function showTooltip(tooltip: string | null | undefined) {\n  if (!tooltip) return\n\n  left.value = comfyApp.canvas.mouse[0] + 'px'\n  top.value = comfyApp.canvas.mouse[1] + 'px'\n  tooltipText.value = tooltip\n\n  await nextTick()\n\n  const rect = tooltipRef.value?.getBoundingClientRect()\n  if (!rect) return\n\n  if (rect.right > window.innerWidth) {\n    left.value = comfyApp.canvas.mouse[0] - rect.width + 'px'\n  }\n\n  if (rect.top < 0) {\n    top.value = comfyApp.canvas.mouse[1] + rect.height + 'px'\n  }\n}\n\nfunction onIdle() {\n  const { canvas } = comfyApp\n  const node = canvas?.node_over\n  if (!node) return\n\n  const ctor = node.constructor as { title_mode?: 0 | 1 | 2 | 3 }\n  const nodeDef = nodeDefStore.nodeDefsByName[node.type ?? '']\n\n  if (\n    ctor.title_mode !== LiteGraph.NO_TITLE &&\n    canvas.graph_mouse[1] < node.pos[1] // If we are over a node, but not within the node then we are on its title\n  ) {\n    return showTooltip(nodeDef?.description)\n  }\n\n  if (node.flags?.collapsed) return\n\n  const inputSlot = isOverNodeInput(\n    node,\n    canvas.graph_mouse[0],\n    canvas.graph_mouse[1],\n    [0, 0]\n  )\n  if (inputSlot !== -1) {\n    const inputName = node.inputs[inputSlot].name\n    const translatedTooltip = st(\n      `nodeDefs.${normalizeI18nKey(node.type ?? '')}.inputs.${normalizeI18nKey(inputName)}.tooltip`,\n      nodeDef?.inputs[inputName]?.tooltip ?? ''\n    )\n    return showTooltip(translatedTooltip)\n  }\n\n  const outputSlot = isOverNodeOutput(\n    node,\n    canvas.graph_mouse[0],\n    canvas.graph_mouse[1],\n    [0, 0]\n  )\n  if (outputSlot !== -1) {\n    const translatedTooltip = st(\n      `nodeDefs.${normalizeI18nKey(node.type ?? '')}.outputs.${outputSlot}.tooltip`,\n      nodeDef?.outputs[outputSlot]?.tooltip ?? ''\n    )\n    return showTooltip(translatedTooltip)\n  }\n\n  const widget = comfyApp.canvas.getWidgetAtCursor()\n  // Dont show for DOM widgets, these use native browser tooltips as we dont get proper mouse events on these\n  if (widget && !isDOMWidget(widget)) {\n    const translatedTooltip = st(\n      `nodeDefs.${normalizeI18nKey(node.type ?? '')}.inputs.${normalizeI18nKey(widget.name)}.tooltip`,\n      nodeDef?.inputs[widget.name]?.tooltip ?? ''\n    )\n    // Widget tooltip can be set dynamically, current translation collection does not support this.\n    return showTooltip(widget.tooltip ?? translatedTooltip)\n  }\n}\n\nconst onMouseMove = (e: MouseEvent) => {\n  hideTooltip()\n  clearTimeout(idleTimeout)\n\n  if ((e.target as Node).nodeName !== 'CANVAS') return\n  idleTimeout = window.setTimeout(\n    onIdle,\n    settingStore.get('LiteGraph.Node.TooltipDelay')\n  )\n}\n\nuseEventListener(window, 'mousemove', onMouseMove)\nuseEventListener(window, 'click', hideTooltip)\n</script>\n\n<style lang=\"css\" scoped>\n.node-tooltip {\n  pointer-events: none;\n  background: var(--comfy-input-bg);\n  border-radius: 5px;\n  box-shadow: 0 0 5px rgb(0 0 0 / 0.4);\n  color: var(--input-text);\n  font-family: sans-serif;\n  left: 0;\n  max-width: 30vw;\n  padding: 4px 8px;\n  position: absolute;\n  top: 0;\n  transform: translate(5px, calc(-100% - 5px));\n  white-space: pre-wrap;\n  z-index: 99999;\n}\n</style>\n","<template>\n  <Button\n    v-tooltip.top=\"{\n      value: $t('commands.Comfy_Canvas_ToggleSelectedNodes_Bypass.label'),\n      showDelay: 1000\n    }\"\n    severity=\"secondary\"\n    text\n    data-testid=\"bypass-button\"\n    class=\"hover:bg-secondary-background\"\n    @click=\"toggleBypass\"\n  >\n    <template #icon>\n      <i class=\"icon-[lucide--redo-dot] h-4 w-4\" />\n    </template>\n  </Button>\n</template>\n\n<script setup lang=\"ts\">\nimport Button from 'primevue/button'\n\nimport { useCommandStore } from '@/stores/commandStore'\n\nconst commandStore = useCommandStore()\n\nconst toggleBypass = async () => {\n  await commandStore.execute('Comfy.Canvas.ToggleSelectedNodes.Bypass')\n}\n</script>\n","<template>\n  <div class=\"relative\">\n    <Button\n      v-tooltip.top=\"{\n        value: localizedCurrentColorName ?? t('color.noColor'),\n        showDelay: 1000\n      }\"\n      data-testid=\"color-picker-button\"\n      severity=\"secondary\"\n      text\n      @click=\"() => (showColorPicker = !showColorPicker)\"\n    >\n      <div class=\"flex items-center gap-1 px-0\">\n        <i\n          class=\"pi pi-circle-fill h-4 w-4\"\n          :style=\"{ color: currentColor ?? '' }\"\n        />\n        <i\n          class=\"pi pi-chevron-down h-4 w-4 py-1\"\n          :style=\"{ fontSize: '0.5rem' }\"\n        />\n      </div>\n    </Button>\n    <div\n      v-if=\"showColorPicker\"\n      class=\"color-picker-container absolute -top-10 left-1/2\"\n    >\n      <SelectButton\n        :model-value=\"selectedColorOption\"\n        :options=\"colorOptions\"\n        option-label=\"name\"\n        data-key=\"value\"\n        @update:model-value=\"applyColor\"\n      >\n        <template #option=\"{ option }\">\n          <i\n            v-tooltip.top=\"option.localizedName\"\n            class=\"pi pi-circle-fill\"\n            :style=\"{\n              color: isLightTheme ? option.value.light : option.value.dark\n            }\"\n            :data-testid=\"option.name\"\n          />\n        </template>\n      </SelectButton>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport Button from 'primevue/button'\nimport SelectButton from 'primevue/selectbutton'\nimport type { Raw } from 'vue'\nimport { computed, ref, watch } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport type {\n  ColorOption as CanvasColorOption,\n  Positionable\n} from '@/lib/litegraph/src/litegraph'\nimport {\n  LGraphCanvas,\n  LiteGraph,\n  isColorable\n} from '@/lib/litegraph/src/litegraph'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useColorPaletteStore } from '@/stores/workspace/colorPaletteStore'\nimport { adjustColor } from '@/utils/colorUtil'\nimport { getItemsColorOption } from '@/utils/litegraphUtil'\n\nconst { t } = useI18n()\nconst canvasStore = useCanvasStore()\nconst colorPaletteStore = useColorPaletteStore()\nconst workflowStore = useWorkflowStore()\nconst isLightTheme = computed(\n  () => colorPaletteStore.completedActivePalette.light_theme\n)\nconst toLightThemeColor = (color: string) =>\n  adjustColor(color, { lightness: 0.5 })\n\nconst showColorPicker = ref(false)\n\ntype ColorOption = {\n  name: string\n  localizedName: string\n  value: {\n    dark: string\n    light: string\n  }\n}\n\nconst NO_COLOR_OPTION: ColorOption = {\n  name: 'noColor',\n  localizedName: t('color.noColor'),\n  value: {\n    dark: LiteGraph.NODE_DEFAULT_BGCOLOR,\n    light: toLightThemeColor(LiteGraph.NODE_DEFAULT_BGCOLOR)\n  }\n}\nconst colorOptions: ColorOption[] = [\n  NO_COLOR_OPTION,\n  ...Object.entries(LGraphCanvas.node_colors).map(([name, color]) => ({\n    name,\n    localizedName: t(`color.${name}`),\n    value: {\n      dark: color.bgcolor,\n      light: toLightThemeColor(color.bgcolor)\n    }\n  }))\n]\n\nconst selectedColorOption = ref<ColorOption | null>(null)\nconst applyColor = (colorOption: ColorOption | null) => {\n  const colorName = colorOption?.name ?? NO_COLOR_OPTION.name\n  const canvasColorOption =\n    colorName === NO_COLOR_OPTION.name\n      ? null\n      : LGraphCanvas.node_colors[colorName]\n\n  for (const item of canvasStore.selectedItems) {\n    if (isColorable(item)) {\n      item.setColorOption(canvasColorOption)\n    }\n  }\n\n  canvasStore.canvas?.setDirty(true, true)\n  currentColorOption.value = canvasColorOption\n  showColorPicker.value = false\n  workflowStore.activeWorkflow?.changeTracker.checkState()\n}\n\nconst currentColorOption = ref<CanvasColorOption | null>(null)\nconst currentColor = computed(() =>\n  currentColorOption.value\n    ? isLightTheme.value\n      ? toLightThemeColor(currentColorOption.value?.bgcolor)\n      : currentColorOption.value?.bgcolor\n    : null\n)\n\nconst localizedCurrentColorName = computed(() => {\n  if (!currentColorOption.value?.bgcolor) return null\n  const colorOption = colorOptions.find(\n    (option) =>\n      option.value.dark === currentColorOption.value?.bgcolor ||\n      option.value.light === currentColorOption.value?.bgcolor\n  )\n  return colorOption?.localizedName ?? NO_COLOR_OPTION.localizedName\n})\nconst updateColorSelectionFromNode = (\n  newSelectedItems: Raw<Positionable[]>\n) => {\n  showColorPicker.value = false\n  selectedColorOption.value = null\n  currentColorOption.value = getItemsColorOption(newSelectedItems)\n}\nwatch(\n  () => canvasStore.selectedItems,\n  (newSelectedItems) => {\n    updateColorSelectionFromNode(newSelectedItems)\n  },\n  { immediate: true }\n)\n</script>\n\n<style scoped>\n@reference '../../../assets/css/style.css';\n\n.color-picker-container {\n  transform: translateX(-50%);\n}\n\n:deep(.p-togglebutton) {\n  @apply py-2 px-1;\n}\n</style>\n","import { storeToRefs } from 'pinia'\nimport { computed } from 'vue'\n\nimport { useNodeLibrarySidebarTab } from '@/composables/sidebarTabs/useNodeLibrarySidebarTab'\nimport type { LGraphNode } from '@/lib/litegraph/src/litegraph'\nimport { LGraphEventMode, SubgraphNode } from '@/lib/litegraph/src/litegraph'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useNodeDefStore } from '@/stores/nodeDefStore'\nimport { useNodeHelpStore } from '@/stores/workspace/nodeHelpStore'\nimport { useSidebarTabStore } from '@/stores/workspace/sidebarTabStore'\nimport { isImageNode, isLGraphNode, isLoad3dNode } from '@/utils/litegraphUtil'\nimport { filterOutputNodes } from '@/utils/nodeFilterUtil'\n\nexport interface NodeSelectionState {\n  collapsed: boolean\n  pinned: boolean\n  bypassed: boolean\n}\n\n/**\n * Centralized computed selection state + shared helper actions to avoid duplication\n * between selection toolbox, context menus, and other UI affordances.\n */\nexport function useSelectionState() {\n  const canvasStore = useCanvasStore()\n  const nodeDefStore = useNodeDefStore()\n  const sidebarTabStore = useSidebarTabStore()\n  const nodeHelpStore = useNodeHelpStore()\n  const { id: nodeLibraryTabId } = useNodeLibrarySidebarTab()\n\n  const { selectedItems } = storeToRefs(canvasStore)\n\n  const selectedNodes = computed(() => {\n    return selectedItems.value.filter((i: unknown) =>\n      isLGraphNode(i)\n    ) as LGraphNode[]\n  })\n\n  const nodeDef = computed(() => {\n    if (selectedNodes.value.length !== 1) return null\n    return nodeDefStore.fromLGraphNode(selectedNodes.value[0])\n  })\n\n  const hasAnySelection = computed(() => selectedItems.value.length > 0)\n  const hasSingleSelection = computed(() => selectedItems.value.length === 1)\n  const hasMultipleSelection = computed(() => selectedItems.value.length > 1)\n\n  const isSingleNode = computed(\n    () => hasSingleSelection.value && isLGraphNode(selectedItems.value[0])\n  )\n  const isSingleSubgraph = computed(\n    () =>\n      isSingleNode.value &&\n      (selectedItems.value[0] as LGraphNode)?.isSubgraphNode?.()\n  )\n  const isSingleImageNode = computed(\n    () =>\n      isSingleNode.value && isImageNode(selectedItems.value[0] as LGraphNode)\n  )\n\n  const hasSubgraphs = computed(() =>\n    selectedItems.value.some((i: unknown) => i instanceof SubgraphNode)\n  )\n\n  const hasAny3DNodeSelected = computed(() => {\n    const enable3DViewer = useSettingStore().get('Comfy.Load3D.3DViewerEnable')\n    return (\n      selectedNodes.value.length === 1 &&\n      selectedNodes.value.some(isLoad3dNode) &&\n      enable3DViewer\n    )\n  })\n\n  const hasImageNode = computed(() => isSingleImageNode.value)\n  const hasOutputNodesSelected = computed(\n    () => filterOutputNodes(selectedNodes.value).length > 0\n  )\n\n  // Helper function to compute selection flags (reused by both computed and function)\n  const computeSelectionStatesFromNodes = (\n    nodes: LGraphNode[]\n  ): NodeSelectionState => {\n    if (!nodes.length)\n      return { collapsed: false, pinned: false, bypassed: false }\n    return {\n      collapsed: nodes.some((n) => n.flags?.collapsed),\n      pinned: nodes.some((n) => n.pinned),\n      bypassed: nodes.some((n) => n.mode === LGraphEventMode.BYPASS)\n    }\n  }\n\n  const selectedNodesStates = computed<NodeSelectionState>(() =>\n    computeSelectionStatesFromNodes(selectedNodes.value)\n  )\n\n  // On-demand computation (non-reactive) so callers can fetch fresh flags\n  const computeSelectionFlags = (): NodeSelectionState =>\n    computeSelectionStatesFromNodes(selectedNodes.value)\n\n  /** Toggle node help sidebar/panel for the single selected node (if any). */\n  const showNodeHelp = () => {\n    const def = nodeDef.value\n    if (!def) return\n\n    const isSidebarActive =\n      sidebarTabStore.activeSidebarTabId === nodeLibraryTabId\n    const currentHelpNode: any = nodeHelpStore.currentHelpNode\n    const isSameNodeHelpOpen =\n      isSidebarActive &&\n      nodeHelpStore.isHelpOpen &&\n      currentHelpNode &&\n      currentHelpNode.nodePath === def.nodePath\n\n    if (isSameNodeHelpOpen) {\n      nodeHelpStore.closeHelp()\n      sidebarTabStore.toggleSidebarTab(nodeLibraryTabId)\n      return\n    }\n\n    if (!isSidebarActive) sidebarTabStore.toggleSidebarTab(nodeLibraryTabId)\n    nodeHelpStore.openHelp(def)\n  }\n\n  return {\n    selectedItems,\n    selectedNodes,\n    nodeDef,\n    showNodeHelp,\n    hasAny3DNodeSelected,\n    hasAnySelection,\n    hasSingleSelection,\n    hasMultipleSelection,\n    isSingleNode,\n    isSingleSubgraph,\n    isSingleImageNode,\n    hasSubgraphs,\n    hasImageNode,\n    hasOutputNodesSelected,\n    selectedNodesStates,\n    computeSelectionFlags\n  }\n}\n","<template>\n  <Button\n    v-if=\"isUnpackVisible\"\n    v-tooltip.top=\"{\n      value: $t('commands.Comfy_Graph_UnpackSubgraph.label'),\n      showDelay: 1000\n    }\"\n    severity=\"secondary\"\n    data-testid=\"convert-to-subgraph-button\"\n    text\n    @click=\"() => commandStore.execute('Comfy.Graph.UnpackSubgraph')\"\n  >\n    <template #icon>\n      <i class=\"icon-[lucide--expand] h-4 w-4\" />\n    </template>\n  </Button>\n  <Button\n    v-else-if=\"isConvertVisible\"\n    v-tooltip.top=\"{\n      value: $t('commands.Comfy_Graph_ConvertToSubgraph.label'),\n      showDelay: 1000\n    }\"\n    severity=\"secondary\"\n    data-testid=\"convert-to-subgraph-button\"\n    text\n    @click=\"() => commandStore.execute('Comfy.Graph.ConvertToSubgraph')\"\n  >\n    <template #icon>\n      <i class=\"icon-[lucide--shrink]\" />\n    </template>\n  </Button>\n</template>\n\n<script setup lang=\"ts\">\nimport Button from 'primevue/button'\nimport { computed } from 'vue'\n\nimport { useSelectionState } from '@/composables/graph/useSelectionState'\nimport { useCommandStore } from '@/stores/commandStore'\n\nconst commandStore = useCommandStore()\nconst { isSingleSubgraph, hasAnySelection } = useSelectionState()\n\nconst isUnpackVisible = isSingleSubgraph\nconst isConvertVisible = computed(\n  () => hasAnySelection.value && !isSingleSubgraph.value\n)\n</script>\n","<template>\n  <Button\n    v-show=\"isDeletable\"\n    v-tooltip.top=\"{\n      value: $t('commands.Comfy_Canvas_DeleteSelectedItems.label'),\n      showDelay: 1000\n    }\"\n    severity=\"secondary\"\n    text\n    icon-class=\"w-4 h-4\"\n    icon=\"pi pi-trash\"\n    data-testid=\"delete-button\"\n    @click=\"() => commandStore.execute('Comfy.Canvas.DeleteSelectedItems')\"\n  />\n</template>\n\n<script setup lang=\"ts\">\nimport Button from 'primevue/button'\nimport { computed } from 'vue'\n\nimport { useSelectionState } from '@/composables/graph/useSelectionState'\nimport type { Positionable } from '@/lib/litegraph/src/interfaces'\nimport { useCommandStore } from '@/stores/commandStore'\n\nconst commandStore = useCommandStore()\nconst { selectedItems } = useSelectionState()\n\nconst isDeletable = computed(() =>\n  selectedItems.value.some((x: Positionable) => x.removable !== false)\n)\n</script>\n","<template>\n  <Button\n    v-tooltip.top=\"{\n      value: t('selectionToolbox.executeButton.tooltip'),\n      showDelay: 1000\n    }\"\n    class=\"size-8 bg-primary-background text-white p-0\"\n    text\n    @mouseenter=\"() => handleMouseEnter()\"\n    @mouseleave=\"() => handleMouseLeave()\"\n    @click=\"handleClick\"\n  >\n    <i class=\"icon-[lucide--play] size-4\" />\n  </Button>\n</template>\n\n<script setup lang=\"ts\">\nimport Button from 'primevue/button'\nimport { computed, ref } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport { useSelectionState } from '@/composables/graph/useSelectionState'\nimport type { LGraphNode } from '@/lib/litegraph/src/litegraph'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useCommandStore } from '@/stores/commandStore'\nimport { isLGraphNode } from '@/utils/litegraphUtil'\nimport { isOutputNode } from '@/utils/nodeFilterUtil'\n\nconst { t } = useI18n()\nconst commandStore = useCommandStore()\nconst canvasStore = useCanvasStore()\nconst { selectedNodes } = useSelectionState()\n\nconst canvas = canvasStore.getCanvas()\nconst buttonHovered = ref(false)\nconst selectedOutputNodes = computed(() =>\n  selectedNodes.value.filter(isLGraphNode).filter(isOutputNode)\n)\n\nfunction outputNodeStokeStyle(this: LGraphNode) {\n  if (\n    this.selected &&\n    this.constructor.nodeData?.output_node &&\n    buttonHovered.value\n  ) {\n    return { color: 'orange', lineWidth: 2, padding: 10 }\n  }\n}\n\nconst handleMouseEnter = () => {\n  buttonHovered.value = true\n  for (const node of selectedOutputNodes.value) {\n    node.strokeStyles['outputNode'] = outputNodeStokeStyle\n  }\n  canvas.setDirty(true)\n}\n\nconst handleMouseLeave = () => {\n  buttonHovered.value = false\n  canvas.setDirty(true)\n}\n\nconst handleClick = async () => {\n  await commandStore.execute('Comfy.QueueSelectedOutputNodes')\n}\n</script>\n","<template>\n  <Button\n    v-tooltip.top=\"{\n      value:\n        st(`commands.${normalizeI18nKey(command.id)}.label`, '') || undefined,\n      showDelay: 1000\n    }\"\n    severity=\"secondary\"\n    text\n    icon-class=\"w-4 h-4\"\n    :icon=\"typeof command.icon === 'function' ? command.icon() : command.icon\"\n    @click=\"() => commandStore.execute(command.id)\"\n  />\n</template>\n\n<script setup lang=\"ts\">\nimport Button from 'primevue/button'\n\nimport { st } from '@/i18n'\nimport type { ComfyCommand } from '@/stores/commandStore'\nimport { useCommandStore } from '@/stores/commandStore'\nimport { normalizeI18nKey } from '@/utils/formatUtil'\n\ndefineProps<{\n  command: ComfyCommand\n}>()\n\nconst commandStore = useCommandStore()\n</script>\n","<template>\n  <Button\n    v-tooltip.top=\"{\n      value: $t('g.info'),\n      showDelay: 1000\n    }\"\n    data-testid=\"info-button\"\n    text\n    severity=\"secondary\"\n    @click=\"onInfoClick\"\n  >\n    <i class=\"icon-[lucide--info] h-4 w-4\" />\n  </Button>\n</template>\n\n<script setup lang=\"ts\">\nimport Button from 'primevue/button'\n\nimport { useSelectionState } from '@/composables/graph/useSelectionState'\nimport { useTelemetry } from '@/platform/telemetry'\n\nconst { showNodeHelp: toggleHelp } = useSelectionState()\n\n/**\n * Track node info button click and toggle node help.\n */\nconst onInfoClick = () => {\n  useTelemetry()?.trackUiButtonClicked({\n    button_id: 'selection_toolbox_node_info_opened'\n  })\n  toggleHelp()\n}\n</script>\n","<template>\n  <Button\n    v-tooltip.top=\"{\n      value: $t('commands.Comfy_3DViewer_Open3DViewer.label'),\n      showDelay: 1000\n    }\"\n    severity=\"secondary\"\n    text\n    icon=\"pi pi-pencil\"\n    icon-class=\"w-4 h-4\"\n    @click=\"open3DViewer\"\n  />\n</template>\n\n<script setup lang=\"ts\">\nimport Button from 'primevue/button'\n\nimport { useCommandStore } from '@/stores/commandStore'\n\nconst commandStore = useCommandStore()\n\nconst open3DViewer = () => {\n  void commandStore.execute('Comfy.3DViewer.Open3DViewer')\n}\n</script>\n","<template>\n  <Button\n    v-show=\"isSingleImageNode\"\n    v-tooltip.top=\"{\n      value: $t('commands.Comfy_MaskEditor_OpenMaskEditor.label'),\n      showDelay: 1000\n    }\"\n    severity=\"secondary\"\n    text\n    @click=\"openMaskEditor\"\n  >\n    <i-comfy:mask class=\"!h-4 !w-4\" />\n  </Button>\n</template>\n\n<script setup lang=\"ts\">\nimport Button from 'primevue/button'\n\nimport { useSelectionState } from '@/composables/graph/useSelectionState'\nimport { useCommandStore } from '@/stores/commandStore'\n\nconst commandStore = useCommandStore()\nconst { isSingleImageNode } = useSelectionState()\n\nconst openMaskEditor = () => {\n  void commandStore.execute('Comfy.MaskEditor.OpenMaskEditor')\n}\n</script>\n","import { computed, ref, watchEffect } from 'vue'\n\nimport type { LGraphNode } from '@/lib/litegraph/src/litegraph'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { isLGraphNode } from '@/utils/litegraphUtil'\n\ninterface RefreshableItem {\n  refresh: () => Promise<void> | void\n}\n\nconst isRefreshableWidget = (widget: unknown): widget is RefreshableItem =>\n  widget != null &&\n  typeof widget === 'object' &&\n  'refresh' in widget &&\n  typeof widget.refresh === 'function'\n\n/**\n * Tracks selected nodes and their refreshable widgets\n */\nexport const useRefreshableSelection = () => {\n  const graphStore = useCanvasStore()\n  const selectedNodes = ref<LGraphNode[]>([])\n\n  watchEffect(() => {\n    selectedNodes.value = graphStore.selectedItems.filter(isLGraphNode)\n  })\n\n  const refreshableWidgets = computed<RefreshableItem[]>(() =>\n    selectedNodes.value.flatMap((node) => {\n      if (!node.widgets) return []\n      const items: RefreshableItem[] = []\n      for (const widget of node.widgets) {\n        if (isRefreshableWidget(widget)) {\n          items.push(widget)\n        }\n      }\n      return items\n    })\n  )\n\n  const isRefreshable = computed(() => refreshableWidgets.value.length > 0)\n\n  async function refreshSelected() {\n    if (!isRefreshable.value) return\n\n    await Promise.all(refreshableWidgets.value.map((item) => item.refresh()))\n  }\n\n  return {\n    isRefreshable,\n    refreshSelected\n  }\n}\n","<template>\n  <Button\n    v-show=\"isRefreshable\"\n    v-tooltip.top=\"t('g.refreshNode')\"\n    severity=\"secondary\"\n    text\n    data-testid=\"refresh-button\"\n    @click=\"refreshSelected\"\n  >\n    <i class=\"icon-[lucide--refresh-cw] h-4 w-4\" />\n  </Button>\n</template>\n\n<script setup lang=\"ts\">\nimport Button from 'primevue/button'\nimport { useI18n } from 'vue-i18n'\n\nimport { useRefreshableSelection } from '@/composables/useRefreshableSelection'\n\nconst { t } = useI18n()\nconst { isRefreshable, refreshSelected } = useRefreshableSelection()\n</script>\n","<template>\n  <Button\n    v-show=\"isVisible\"\n    v-tooltip.top=\"{\n      value: $t('commands.Comfy_PublishSubgraph.label'),\n      showDelay: 1000\n    }\"\n    severity=\"secondary\"\n    text\n    @click=\"() => commandStore.execute('Comfy.PublishSubgraph')\"\n  >\n    <template #icon>\n      <i class=\"icon-[lucide--book-open]\" />\n    </template>\n  </Button>\n</template>\n\n<script setup lang=\"ts\">\nimport Button from 'primevue/button'\nimport { computed } from 'vue'\n\nimport { SubgraphNode } from '@/lib/litegraph/src/litegraph'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useCommandStore } from '@/stores/commandStore'\n\nconst commandStore = useCommandStore()\nconst canvasStore = useCanvasStore()\n\nconst isVisible = computed(() => {\n  return (\n    canvasStore.selectedItems?.length === 1 &&\n    canvasStore.selectedItems[0] instanceof SubgraphNode\n  )\n})\n</script>\n","import { useElementBounding, useRafFn } from '@vueuse/core'\nimport { computed, onUnmounted, ref, watch } from 'vue'\nimport type { Ref } from 'vue'\n\nimport { useSelectedLiteGraphItems } from '@/composables/canvas/useSelectedLiteGraphItems'\nimport { useVueFeatureFlags } from '@/composables/useVueFeatureFlags'\nimport type { ReadOnlyRect } from '@/lib/litegraph/src/interfaces'\nimport {\n  LGraphGroup,\n  LGraphNode,\n  LiteGraph\n} from '@/lib/litegraph/src/litegraph'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { layoutStore } from '@/renderer/core/layout/store/layoutStore'\nimport { isLGraphGroup, isLGraphNode } from '@/utils/litegraphUtil'\nimport { computeUnionBounds } from '@/utils/mathUtil'\n\n/**\n * Manages the position of the selection toolbox independently.\n * Uses CSS custom properties for performant transform updates.\n */\n\n// Shared signals for auxiliary UI (e.g., MoreOptions) to coordinate hide/restore\nexport const moreOptionsOpen = ref(false)\nexport const forceCloseMoreOptionsSignal = ref(0)\nexport const restoreMoreOptionsSignal = ref(0)\nexport const moreOptionsRestorePending = ref(false)\nlet moreOptionsWasOpenBeforeDrag = false\nlet moreOptionsSelectionSignature: string | null = null\n\nfunction buildSelectionSignature(\n  store: ReturnType<typeof useCanvasStore>\n): string | null {\n  const c = store.canvas\n  if (!c) return null\n  const items = Array.from(c.selectedItems)\n  if (items.length !== 1) return null\n  const item = items[0]\n  if (isLGraphNode(item)) return `N:${item.id}`\n  if (isLGraphGroup(item)) return `G:${item.id}`\n  return null\n}\n\nfunction currentSelectionMatchesSignature(\n  store: ReturnType<typeof useCanvasStore>\n) {\n  if (!moreOptionsSelectionSignature) return false\n  return buildSelectionSignature(store) === moreOptionsSelectionSignature\n}\n\nexport function useSelectionToolboxPosition(\n  toolboxRef: Ref<HTMLElement | undefined>\n) {\n  const canvasStore = useCanvasStore()\n  const lgCanvas = canvasStore.getCanvas()\n  const { getSelectableItems } = useSelectedLiteGraphItems()\n  const { shouldRenderVueNodes } = useVueFeatureFlags()\n\n  // World position of selection center\n  const worldPosition = ref({ x: 0, y: 0 })\n\n  const visible = ref(false)\n\n  // Use VueUse to reactively track canvas bounding rect\n  const { left: canvasLeft, top: canvasTop } = useElementBounding(\n    lgCanvas.canvas\n  )\n\n  /**\n   * Update position based on selection\n   */\n  const updateSelectionBounds = () => {\n    const selectableItems = getSelectableItems()\n\n    if (!selectableItems.size) {\n      visible.value = false\n      return\n    }\n\n    visible.value = true\n\n    // Get bounds for all selected items\n    const allBounds: ReadOnlyRect[] = []\n    for (const item of selectableItems) {\n      // Skip items without valid IDs\n      if (item.id == null) continue\n\n      if (shouldRenderVueNodes.value && typeof item.id === 'string') {\n        // Use layout store for Vue nodes (only works with string IDs)\n        const layout = layoutStore.getNodeLayoutRef(item.id).value\n        if (layout) {\n          allBounds.push([\n            layout.bounds.x,\n            layout.bounds.y,\n            layout.bounds.width,\n            layout.bounds.height\n          ])\n        }\n      } else {\n        // Fallback to LiteGraph bounds for regular nodes or non-string IDs\n        if (item instanceof LGraphNode || item instanceof LGraphGroup) {\n          allBounds.push([\n            item.pos[0],\n            item.pos[1] - LiteGraph.NODE_TITLE_HEIGHT,\n            item.size[0],\n            item.size[1] + LiteGraph.NODE_TITLE_HEIGHT\n          ])\n        }\n      }\n    }\n\n    // Compute union bounds\n    const unionBounds = computeUnionBounds(allBounds)\n    if (!unionBounds) return\n\n    worldPosition.value = {\n      x: unionBounds.x + unionBounds.width / 2,\n      // createBounds() applied a default padding of 10px\n      // so adjust Y to maintain visual consistency\n      y: unionBounds.y - 10\n    }\n\n    updateTransform()\n  }\n\n  const updateTransform = () => {\n    if (!visible.value) return\n\n    const { scale, offset } = lgCanvas.ds\n\n    const screenX =\n      (worldPosition.value.x + offset[0]) * scale + canvasLeft.value\n    const screenY =\n      (worldPosition.value.y + offset[1]) * scale + canvasTop.value\n\n    // Update CSS custom properties directly for best performance\n    if (toolboxRef.value) {\n      toolboxRef.value.style.setProperty('--tb-x', `${screenX}px`)\n      toolboxRef.value.style.setProperty('--tb-y', `${screenY}px`)\n    }\n  }\n\n  // Sync with canvas transform\n  const { resume: startSync, pause: stopSync } = useRafFn(updateTransform)\n\n  // Watch for selection changes\n  watch(\n    () => canvasStore.getCanvas().state.selectionChanged,\n    (changed) => {\n      if (changed) {\n        if (moreOptionsRestorePending.value || moreOptionsSelectionSignature) {\n          moreOptionsRestorePending.value = false\n          moreOptionsWasOpenBeforeDrag = false\n          if (!moreOptionsOpen.value) {\n            moreOptionsSelectionSignature = null\n          } else {\n            moreOptionsSelectionSignature = buildSelectionSignature(canvasStore)\n          }\n        }\n        updateSelectionBounds()\n        canvasStore.getCanvas().state.selectionChanged = false\n        if (visible.value) {\n          startSync()\n        } else {\n          stopSync()\n        }\n      }\n    },\n    { immediate: true }\n  )\n  watch(\n    () => moreOptionsOpen.value,\n    (v) => {\n      if (v) {\n        moreOptionsSelectionSignature = buildSelectionSignature(canvasStore)\n      } else if (!canvasStore.canvas?.state?.draggingItems) {\n        moreOptionsSelectionSignature = null\n        if (moreOptionsRestorePending.value)\n          moreOptionsRestorePending.value = false\n      }\n    }\n  )\n\n  const handleDragStateChange = (dragging: boolean) => {\n    if (dragging) {\n      handleDragStart()\n      return\n    }\n\n    handleDragEnd()\n  }\n\n  const handleDragStart = () => {\n    visible.value = false\n\n    // Early return if more options wasn't open\n    if (!moreOptionsOpen.value) {\n      moreOptionsRestorePending.value = false\n      moreOptionsWasOpenBeforeDrag = false\n      return\n    }\n\n    // Handle more options cleanup\n    const currentSig = buildSelectionSignature(canvasStore)\n    const selectionChanged = currentSig !== moreOptionsSelectionSignature\n\n    if (selectionChanged) {\n      moreOptionsSelectionSignature = null\n    }\n    moreOptionsOpen.value = false\n    moreOptionsWasOpenBeforeDrag = true\n    moreOptionsRestorePending.value = !!moreOptionsSelectionSignature\n\n    if (moreOptionsRestorePending.value) {\n      forceCloseMoreOptionsSignal.value++\n      return\n    }\n\n    moreOptionsWasOpenBeforeDrag = false\n  }\n\n  const handleDragEnd = () => {\n    requestAnimationFrame(() => {\n      updateSelectionBounds()\n\n      const selectionMatches = currentSelectionMatchesSignature(canvasStore)\n      const shouldRestore =\n        moreOptionsWasOpenBeforeDrag &&\n        visible.value &&\n        moreOptionsRestorePending.value &&\n        selectionMatches\n\n      // Single point of assignment for each ref\n      moreOptionsRestorePending.value =\n        shouldRestore && moreOptionsRestorePending.value\n      moreOptionsWasOpenBeforeDrag = false\n\n      if (shouldRestore) {\n        restoreMoreOptionsSignal.value++\n      }\n    })\n  }\n\n  // Unified dragging state - combines both LiteGraph and Vue node dragging\n  const isDragging = computed((): boolean => {\n    const litegraphDragging = canvasStore.canvas?.state?.draggingItems ?? false\n    const vueNodeDragging =\n      shouldRenderVueNodes.value && layoutStore.isDraggingVueNodes.value\n    return litegraphDragging || vueNodeDragging\n  })\n\n  watch(isDragging, handleDragStateChange)\n\n  onUnmounted(() => {\n    resetMoreOptionsState()\n  })\n\n  return {\n    visible\n  }\n}\n\n// External cleanup utility to be called when SelectionToolbox component unmounts\nfunction resetMoreOptionsState() {\n  moreOptionsOpen.value = false\n  moreOptionsRestorePending.value = false\n  moreOptionsWasOpenBeforeDrag = false\n  moreOptionsSelectionSignature = null\n}\n","import { computed } from 'vue'\n\nimport { useSelectionState } from '@/composables/graph/useSelectionState'\nimport { LGraphGroup } from '@/lib/litegraph/src/litegraph'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useTitleEditorStore } from '@/renderer/core/canvas/canvasStore'\nimport { app } from '@/scripts/app'\n\n/**\n * Composable encapsulating logic for framing currently selected nodes into a group.\n */\nexport function useFrameNodes() {\n  const settingStore = useSettingStore()\n  const titleEditorStore = useTitleEditorStore()\n  const { hasMultipleSelection } = useSelectionState()\n\n  const canFrame = computed(() => hasMultipleSelection.value)\n\n  const frameNodes = () => {\n    const { canvas } = app\n    if (!canvas.selectedItems?.size) return\n    const group = new LGraphGroup()\n    const padding = settingStore.get('Comfy.GroupSelectedNodes.Padding')\n    group.resizeTo(canvas.selectedItems, padding)\n    canvas.graph?.add(group)\n    titleEditorStore.titleEditorTarget = group\n  }\n\n  return { frameNodes, canFrame }\n}\n","<template>\n  <Button\n    v-tooltip.top=\"{\n      value: $t('g.frameNodes'),\n      showDelay: 1000\n    }\"\n    class=\"frame-nodes-button\"\n    text\n    severity=\"secondary\"\n    @click=\"frameNodes\"\n  >\n    <i class=\"icon-[lucide--frame] h-4 w-4\" />\n  </Button>\n</template>\n\n<script setup lang=\"ts\">\nimport Button from 'primevue/button'\n\nimport { useFrameNodes } from '@/composables/graph/useFrameNodes'\n\nconst { frameNodes } = useFrameNodes()\n</script>\n","// call nextTick on all changeTracker\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\n\n/**\n * Composable for refreshing nodes in the graph\n * */\nexport function useCanvasRefresh() {\n  const canvasStore = useCanvasStore()\n  const workflowStore = useWorkflowStore()\n  const refreshCanvas = () => {\n    canvasStore.canvas?.emitBeforeChange()\n    canvasStore.canvas?.setDirty(true, true)\n    canvasStore.canvas?.graph?.afterChange()\n    canvasStore.canvas?.emitAfterChange()\n    workflowStore.activeWorkflow?.changeTracker?.checkState()\n  }\n\n  return {\n    refreshCanvas\n  }\n}\n","import { computed } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport {\n  LGraphCanvas,\n  LGraphNode,\n  LiteGraph,\n  RenderShape,\n  isColorable\n} from '@/lib/litegraph/src/litegraph'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useColorPaletteStore } from '@/stores/workspace/colorPaletteStore'\nimport { adjustColor } from '@/utils/colorUtil'\n\nimport { useCanvasRefresh } from './useCanvasRefresh'\n\ninterface ColorOption {\n  name: string\n  localizedName: string\n  value: {\n    dark: string\n    light: string\n  }\n}\n\ninterface ShapeOption {\n  name: string\n  localizedName: string\n  value: RenderShape\n}\n\n/**\n * Composable for handling node color and shape customization\n */\nexport function useNodeCustomization() {\n  const { t } = useI18n()\n  const canvasStore = useCanvasStore()\n  const colorPaletteStore = useColorPaletteStore()\n  const canvasRefresh = useCanvasRefresh()\n  const isLightTheme = computed(\n    () => colorPaletteStore.completedActivePalette.light_theme\n  )\n\n  const toLightThemeColor = (color: string) =>\n    adjustColor(color, { lightness: 0.5 })\n\n  // Color options\n  const NO_COLOR_OPTION: ColorOption = {\n    name: 'noColor',\n    localizedName: t('color.noColor'),\n    value: {\n      dark: LiteGraph.NODE_DEFAULT_BGCOLOR,\n      light: toLightThemeColor(LiteGraph.NODE_DEFAULT_BGCOLOR)\n    }\n  }\n\n  const colorOptions: ColorOption[] = [\n    NO_COLOR_OPTION,\n    ...Object.entries(LGraphCanvas.node_colors).map(([name, color]) => ({\n      name,\n      localizedName: t(`color.${name}`),\n      value: {\n        dark: color.bgcolor,\n        light: toLightThemeColor(color.bgcolor)\n      }\n    }))\n  ]\n\n  // Shape options\n  const shapeOptions: ShapeOption[] = [\n    {\n      name: 'default',\n      localizedName: t('shape.default'),\n      value: RenderShape.ROUND\n    },\n    {\n      name: 'box',\n      localizedName: t('shape.box'),\n      value: RenderShape.BOX\n    },\n    {\n      name: 'card',\n      localizedName: t('shape.CARD'),\n      value: RenderShape.CARD\n    }\n  ]\n\n  const applyColor = (colorOption: ColorOption | null) => {\n    const colorName = colorOption?.name ?? NO_COLOR_OPTION.name\n    const canvasColorOption =\n      colorName === NO_COLOR_OPTION.name\n        ? null\n        : LGraphCanvas.node_colors[colorName]\n\n    for (const item of canvasStore.selectedItems) {\n      if (isColorable(item)) {\n        item.setColorOption(canvasColorOption)\n      }\n    }\n\n    canvasRefresh.refreshCanvas()\n  }\n\n  const applyShape = (shapeOption: ShapeOption) => {\n    const selectedNodes = Array.from(canvasStore.selectedItems).filter(\n      (item): item is LGraphNode => item instanceof LGraphNode\n    )\n\n    if (selectedNodes.length === 0) {\n      return\n    }\n\n    selectedNodes.forEach((node) => {\n      node.shape = shapeOption.value\n    })\n\n    canvasRefresh.refreshCanvas()\n  }\n\n  const getCurrentColor = (): ColorOption | null => {\n    const selectedItems = Array.from(canvasStore.selectedItems)\n    if (selectedItems.length === 0) return null\n\n    // Get color from first colorable item\n    const firstColorableItem = selectedItems.find((item) => isColorable(item))\n    if (!firstColorableItem || !isColorable(firstColorableItem)) return null\n\n    // Get the current color option from the colorable item\n    const currentColorOption = firstColorableItem.getColorOption()\n    const currentBgColor = currentColorOption?.bgcolor ?? null\n\n    // Find matching color option\n    return (\n      colorOptions.find(\n        (option) =>\n          option.value.dark === currentBgColor ||\n          option.value.light === currentBgColor\n      ) ?? NO_COLOR_OPTION\n    )\n  }\n\n  const getCurrentShape = (): ShapeOption | null => {\n    const selectedNodes = Array.from(canvasStore.selectedItems).filter(\n      (item): item is LGraphNode => item instanceof LGraphNode\n    )\n\n    if (selectedNodes.length === 0) return null\n\n    const firstNode = selectedNodes[0]\n    const currentShape = firstNode.shape ?? RenderShape.ROUND\n\n    return (\n      shapeOptions.find((option) => option.value === currentShape) ??\n      shapeOptions[0]\n    )\n  }\n\n  return {\n    colorOptions,\n    shapeOptions,\n    applyColor,\n    applyShape,\n    getCurrentColor,\n    getCurrentShape,\n    isLightTheme\n  }\n}\n","import { useI18n } from 'vue-i18n'\n\nimport { LGraphEventMode } from '@/lib/litegraph/src/litegraph'\nimport type { LGraphGroup, LGraphNode } from '@/lib/litegraph/src/litegraph'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\n\nimport { useCanvasRefresh } from './useCanvasRefresh'\nimport type { MenuOption } from './useMoreOptionsMenu'\nimport { useNodeCustomization } from './useNodeCustomization'\n\n/**\n * Composable for group-related menu operations\n */\nexport function useGroupMenuOptions() {\n  const { t } = useI18n()\n  const canvasStore = useCanvasStore()\n  const workflowStore = useWorkflowStore()\n  const settingStore = useSettingStore()\n  const canvasRefresh = useCanvasRefresh()\n  const { shapeOptions, colorOptions, isLightTheme } = useNodeCustomization()\n\n  const getFitGroupToNodesOption = (groupContext: LGraphGroup): MenuOption => ({\n    label: 'Fit Group To Nodes',\n    icon: 'icon-[lucide--move-diagonal-2]',\n    action: () => {\n      try {\n        groupContext.recomputeInsideNodes()\n      } catch (e) {\n        console.warn('Failed to recompute group nodes:', e)\n        return\n      }\n\n      const padding = settingStore.get('Comfy.GroupSelectedNodes.Padding')\n      groupContext.resizeTo(groupContext.children, padding)\n      groupContext.graph?.change()\n      canvasStore.canvas?.setDirty(true, true)\n      workflowStore.activeWorkflow?.changeTracker?.checkState()\n    }\n  })\n\n  const getGroupShapeOptions = (\n    groupContext: LGraphGroup,\n    bump: () => void\n  ): MenuOption => ({\n    label: t('contextMenu.Shape'),\n    icon: 'icon-[lucide--box]',\n    hasSubmenu: true,\n    submenu: shapeOptions.map((shape) => ({\n      label: shape.localizedName,\n      action: () => {\n        const nodes = (groupContext.nodes || []) as LGraphNode[]\n        nodes.forEach((node) => (node.shape = shape.value))\n        canvasRefresh.refreshCanvas()\n        bump()\n      }\n    }))\n  })\n\n  const getGroupColorOptions = (\n    groupContext: LGraphGroup,\n    bump: () => void\n  ): MenuOption => ({\n    label: t('contextMenu.Color'),\n    icon: 'icon-[lucide--palette]',\n    hasSubmenu: true,\n    submenu: colorOptions.map((colorOption) => ({\n      label: colorOption.localizedName,\n      color: isLightTheme.value\n        ? colorOption.value.light\n        : colorOption.value.dark,\n      action: () => {\n        groupContext.color = isLightTheme.value\n          ? colorOption.value.light\n          : colorOption.value.dark\n        canvasRefresh.refreshCanvas()\n        bump()\n      }\n    }))\n  })\n\n  const getGroupModeOptions = (\n    groupContext: LGraphGroup,\n    bump: () => void\n  ): MenuOption[] => {\n    const options: MenuOption[] = []\n\n    try {\n      groupContext.recomputeInsideNodes()\n    } catch (e) {\n      console.warn('Failed to recompute group nodes for mode options:', e)\n      return options\n    }\n\n    const groupNodes = (groupContext.nodes || []) as LGraphNode[]\n    if (!groupNodes.length) return options\n\n    // Check if all nodes have the same mode\n    let allSame = true\n    for (let i = 1; i < groupNodes.length; i++) {\n      if (groupNodes[i].mode !== groupNodes[0].mode) {\n        allSame = false\n        break\n      }\n    }\n\n    const createModeAction = (label: string, mode: LGraphEventMode) => ({\n      label: t(`selectionToolbox.${label}`),\n      icon:\n        mode === LGraphEventMode.BYPASS\n          ? 'icon-[lucide--ban]'\n          : mode === LGraphEventMode.NEVER\n            ? 'icon-[lucide--zap-off]'\n            : 'icon-[lucide--play]',\n      action: () => {\n        groupNodes.forEach((n) => {\n          n.mode = mode\n        })\n        canvasStore.canvas?.setDirty(true, true)\n        groupContext.graph?.change()\n        workflowStore.activeWorkflow?.changeTracker?.checkState()\n        bump()\n      }\n    })\n\n    if (allSame) {\n      const current = groupNodes[0].mode\n      switch (current) {\n        case LGraphEventMode.ALWAYS:\n          options.push(\n            createModeAction('Set Group Nodes to Never', LGraphEventMode.NEVER)\n          )\n          options.push(\n            createModeAction('Bypass Group Nodes', LGraphEventMode.BYPASS)\n          )\n          break\n        case LGraphEventMode.NEVER:\n          options.push(\n            createModeAction(\n              'Set Group Nodes to Always',\n              LGraphEventMode.ALWAYS\n            )\n          )\n          options.push(\n            createModeAction('Bypass Group Nodes', LGraphEventMode.BYPASS)\n          )\n          break\n        case LGraphEventMode.BYPASS:\n          options.push(\n            createModeAction(\n              'Set Group Nodes to Always',\n              LGraphEventMode.ALWAYS\n            )\n          )\n          options.push(\n            createModeAction('Set Group Nodes to Never', LGraphEventMode.NEVER)\n          )\n          break\n        default:\n          options.push(\n            createModeAction(\n              'Set Group Nodes to Always',\n              LGraphEventMode.ALWAYS\n            )\n          )\n          options.push(\n            createModeAction('Set Group Nodes to Never', LGraphEventMode.NEVER)\n          )\n          options.push(\n            createModeAction('Bypass Group Nodes', LGraphEventMode.BYPASS)\n          )\n          break\n      }\n    } else {\n      options.push(\n        createModeAction('Set Group Nodes to Always', LGraphEventMode.ALWAYS)\n      )\n      options.push(\n        createModeAction('Set Group Nodes to Never', LGraphEventMode.NEVER)\n      )\n      options.push(\n        createModeAction('Bypass Group Nodes', LGraphEventMode.BYPASS)\n      )\n    }\n\n    return options\n  }\n\n  return {\n    getFitGroupToNodesOption,\n    getGroupShapeOptions,\n    getGroupColorOptions,\n    getGroupModeOptions\n  }\n}\n","import { useI18n } from 'vue-i18n'\n\nimport { downloadFile } from '@/base/common/downloadUtil'\nimport { useCommandStore } from '@/stores/commandStore'\n\nimport type { MenuOption } from './useMoreOptionsMenu'\n\n/**\n * Composable for image-related menu operations\n */\nexport function useImageMenuOptions() {\n  const { t } = useI18n()\n\n  const openMaskEditor = () => {\n    const commandStore = useCommandStore()\n    void commandStore.execute('Comfy.MaskEditor.OpenMaskEditor')\n  }\n\n  const openImage = (node: any) => {\n    if (!node?.imgs?.length) return\n    const img = node.imgs[node.imageIndex ?? 0]\n    if (!img) return\n    const url = new URL(img.src)\n    url.searchParams.delete('preview')\n    window.open(url.toString(), '_blank')\n  }\n\n  const copyImage = async (node: any) => {\n    if (!node?.imgs?.length) return\n    const img = node.imgs[node.imageIndex ?? 0]\n    if (!img) return\n\n    const canvas = document.createElement('canvas')\n    const ctx = canvas.getContext('2d')\n    if (!ctx) return\n\n    canvas.width = img.naturalWidth\n    canvas.height = img.naturalHeight\n    ctx.drawImage(img, 0, 0)\n\n    try {\n      const blob = await new Promise<Blob | null>((resolve) => {\n        canvas.toBlob(resolve, 'image/png')\n      })\n\n      if (!blob) {\n        console.warn('Failed to create image blob')\n        return\n      }\n\n      // Check if clipboard API is available\n      if (!navigator.clipboard?.write) {\n        console.warn('Clipboard API not available')\n        return\n      }\n\n      await navigator.clipboard.write([\n        new ClipboardItem({ 'image/png': blob })\n      ])\n    } catch (error) {\n      console.error('Failed to copy image to clipboard:', error)\n    }\n  }\n\n  const saveImage = (node: any) => {\n    if (!node?.imgs?.length) return\n    const img = node.imgs[node.imageIndex ?? 0]\n    if (!img) return\n\n    try {\n      const url = new URL(img.src)\n      url.searchParams.delete('preview')\n      downloadFile(url.toString())\n    } catch (error) {\n      console.error('Failed to save image:', error)\n    }\n  }\n\n  const getImageMenuOptions = (node: any): MenuOption[] => {\n    if (!node?.imgs?.length) return []\n\n    return [\n      {\n        label: t('contextMenu.Open in Mask Editor'),\n        action: () => openMaskEditor()\n      },\n      {\n        label: t('contextMenu.Open Image'),\n        icon: 'icon-[lucide--external-link]',\n        action: () => openImage(node)\n      },\n      {\n        label: t('contextMenu.Copy Image'),\n        icon: 'icon-[lucide--copy]',\n        action: () => copyImage(node)\n      },\n      {\n        label: t('contextMenu.Save Image'),\n        icon: 'icon-[lucide--download]',\n        action: () => saveImage(node)\n      }\n    ]\n  }\n\n  return {\n    getImageMenuOptions\n  }\n}\n","import { useSelectedLiteGraphItems } from '@/composables/canvas/useSelectedLiteGraphItems'\nimport { LGraphEventMode } from '@/lib/litegraph/src/litegraph'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { app } from '@/scripts/app'\nimport { useCommandStore } from '@/stores/commandStore'\nimport { filterOutputNodes } from '@/utils/nodeFilterUtil'\n\n/**\n * Composable for handling node information and utility operations\n */\nexport function useSelectedNodeActions() {\n  const { getSelectedNodes, toggleSelectedNodesMode } =\n    useSelectedLiteGraphItems()\n  const commandStore = useCommandStore()\n  const workflowStore = useWorkflowStore()\n\n  const adjustNodeSize = () => {\n    const selectedNodes = getSelectedNodes()\n\n    selectedNodes.forEach((node) => {\n      const optimalSize = node.computeSize()\n      node.setSize([optimalSize[0], optimalSize[1]])\n    })\n\n    app.canvas.setDirty(true, true)\n    workflowStore.activeWorkflow?.changeTracker?.checkState()\n  }\n\n  const toggleNodeCollapse = () => {\n    const selectedNodes = getSelectedNodes()\n    selectedNodes.forEach((node) => {\n      node.collapse()\n    })\n\n    app.canvas.setDirty(true, true)\n    workflowStore.activeWorkflow?.changeTracker?.checkState()\n  }\n\n  const toggleNodePin = () => {\n    const selectedNodes = getSelectedNodes()\n    selectedNodes.forEach((node) => {\n      node.pin(!node.pinned)\n    })\n\n    app.canvas.setDirty(true, true)\n    workflowStore.activeWorkflow?.changeTracker?.checkState()\n  }\n\n  const toggleNodeBypass = () => {\n    toggleSelectedNodesMode(LGraphEventMode.BYPASS)\n    app.canvas.setDirty(true, true)\n  }\n\n  const runBranch = async () => {\n    const selectedNodes = getSelectedNodes()\n    const selectedOutputNodes = filterOutputNodes(selectedNodes)\n    if (selectedOutputNodes.length === 0) return\n    await commandStore.execute('Comfy.QueueSelectedOutputNodes')\n  }\n\n  return {\n    adjustNodeSize,\n    toggleNodeCollapse,\n    toggleNodePin,\n    toggleNodeBypass,\n    runBranch\n  }\n}\n","import { computed } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport type { MenuOption } from './useMoreOptionsMenu'\nimport { useNodeCustomization } from './useNodeCustomization'\nimport { useSelectedNodeActions } from './useSelectedNodeActions'\nimport type { NodeSelectionState } from './useSelectionState'\n\n/**\n * Composable for node-related menu operations\n */\nexport function useNodeMenuOptions() {\n  const { t } = useI18n()\n  const { shapeOptions, applyShape, applyColor, colorOptions, isLightTheme } =\n    useNodeCustomization()\n  const {\n    adjustNodeSize,\n    toggleNodeCollapse,\n    toggleNodePin,\n    toggleNodeBypass,\n    runBranch\n  } = useSelectedNodeActions()\n\n  const shapeSubmenu = computed(() =>\n    shapeOptions.map((shape) => ({\n      label: shape.localizedName,\n      action: () => applyShape(shape)\n    }))\n  )\n\n  const colorSubmenu = computed(() => {\n    return colorOptions.map((colorOption) => ({\n      label: colorOption.localizedName,\n      color: isLightTheme.value\n        ? colorOption.value.light\n        : colorOption.value.dark,\n      action: () =>\n        applyColor(colorOption.name === 'noColor' ? null : colorOption)\n    }))\n  })\n\n  const getAdjustSizeOption = (): MenuOption => ({\n    label: t('contextMenu.Adjust Size'),\n    icon: 'icon-[lucide--move-diagonal-2]',\n    action: adjustNodeSize\n  })\n\n  const getNodeVisualOptions = (\n    states: NodeSelectionState,\n    bump: () => void\n  ): MenuOption[] => [\n    {\n      label: states.collapsed\n        ? t('contextMenu.Expand Node')\n        : t('contextMenu.Minimize Node'),\n      icon: states.collapsed\n        ? 'icon-[lucide--maximize-2]'\n        : 'icon-[lucide--minimize-2]',\n      action: () => {\n        toggleNodeCollapse()\n        bump()\n      }\n    },\n    {\n      label: t('contextMenu.Shape'),\n      icon: 'icon-[lucide--box]',\n      hasSubmenu: true,\n      submenu: shapeSubmenu.value,\n      action: () => {}\n    },\n    {\n      label: t('contextMenu.Color'),\n      icon: 'icon-[lucide--palette]',\n      hasSubmenu: true,\n      submenu: colorSubmenu.value,\n      action: () => {}\n    }\n  ]\n\n  const getPinOption = (\n    states: NodeSelectionState,\n    bump: () => void\n  ): MenuOption => ({\n    label: states.pinned ? t('contextMenu.Unpin') : t('contextMenu.Pin'),\n    icon: states.pinned ? 'icon-[lucide--pin-off]' : 'icon-[lucide--pin]',\n    action: () => {\n      toggleNodePin()\n      bump()\n    }\n  })\n\n  const getBypassOption = (\n    states: NodeSelectionState,\n    bump: () => void\n  ): MenuOption => ({\n    label: states.bypassed\n      ? t('contextMenu.Remove Bypass')\n      : t('contextMenu.Bypass'),\n    icon: states.bypassed ? 'icon-[lucide--zap-off]' : 'icon-[lucide--ban]',\n    shortcut: 'Ctrl+B',\n    action: () => {\n      toggleNodeBypass()\n      bump()\n    }\n  })\n\n  const getRunBranchOption = (): MenuOption => ({\n    label: t('contextMenu.Run Branch'),\n    icon: 'icon-[lucide--play]',\n    action: runBranch\n  })\n\n  const getNodeInfoOption = (showNodeHelp: () => void): MenuOption => ({\n    label: t('contextMenu.Node Info'),\n    icon: 'icon-[lucide--info]',\n    action: showNodeHelp\n  })\n\n  return {\n    getNodeInfoOption,\n    getAdjustSizeOption,\n    getNodeVisualOptions,\n    getPinOption,\n    getBypassOption,\n    getRunBranchOption,\n    colorSubmenu\n  }\n}\n","import { useI18n } from 'vue-i18n'\n\nimport type { Direction } from '@/lib/litegraph/src/interfaces'\nimport { alignNodes, distributeNodes } from '@/lib/litegraph/src/utils/arrange'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { isLGraphNode } from '@/utils/litegraphUtil'\n\nimport { useCanvasRefresh } from './useCanvasRefresh'\n\ninterface AlignOption {\n  name: string\n  localizedName: string\n  value: Direction\n  icon: string\n}\n\ninterface DistributeOption {\n  name: string\n  localizedName: string\n  value: boolean // true for horizontal, false for vertical\n  icon: string\n}\n\n/**\n * Composable for handling node alignment and distribution\n */\nexport function useNodeArrangement() {\n  const { t } = useI18n()\n  const canvasStore = useCanvasStore()\n  const canvasRefresh = useCanvasRefresh()\n  const alignOptions: AlignOption[] = [\n    {\n      name: 'top',\n      localizedName: t('contextMenu.Top'),\n      value: 'top',\n      icon: 'icon-[lucide--align-start-vertical]'\n    },\n    {\n      name: 'bottom',\n      localizedName: t('contextMenu.Bottom'),\n      value: 'bottom',\n      icon: 'icon-[lucide--align-end-vertical]'\n    },\n    {\n      name: 'left',\n      localizedName: t('contextMenu.Left'),\n      value: 'left',\n      icon: 'icon-[lucide--align-start-horizontal]'\n    },\n    {\n      name: 'right',\n      localizedName: t('contextMenu.Right'),\n      value: 'right',\n      icon: 'icon-[lucide--align-end-horizontal]'\n    }\n  ]\n\n  const distributeOptions: DistributeOption[] = [\n    {\n      name: 'horizontal',\n      localizedName: t('contextMenu.Horizontal'),\n      value: true,\n      icon: 'icon-[lucide--align-center-horizontal]'\n    },\n    {\n      name: 'vertical',\n      localizedName: t('contextMenu.Vertical'),\n      value: false,\n      icon: 'icon-[lucide--align-center-vertical]'\n    }\n  ]\n\n  const applyAlign = (alignOption: AlignOption) => {\n    const selectedNodes = Array.from(canvasStore.selectedItems).filter((item) =>\n      isLGraphNode(item)\n    )\n\n    if (selectedNodes.length === 0) {\n      return\n    }\n\n    const newPositions = alignNodes(selectedNodes, alignOption.value)\n    canvasStore.canvas?.repositionNodesVueMode(newPositions)\n\n    canvasRefresh.refreshCanvas()\n  }\n\n  const applyDistribute = (distributeOption: DistributeOption) => {\n    const selectedNodes = Array.from(canvasStore.selectedItems).filter((item) =>\n      isLGraphNode(item)\n    )\n\n    if (selectedNodes.length < 2) {\n      return\n    }\n\n    const newPositions = distributeNodes(selectedNodes, distributeOption.value)\n    canvasStore.canvas?.repositionNodesVueMode(newPositions)\n    canvasRefresh.refreshCanvas()\n  }\n\n  return {\n    alignOptions,\n    distributeOptions,\n    applyAlign,\n    applyDistribute\n  }\n}\n","// import { useSelectedLiteGraphItems } from '@/composables/canvas/useSelectedLiteGraphItems' // Unused for now\nimport { t } from '@/i18n'\nimport { LGraphNode } from '@/lib/litegraph/src/litegraph'\nimport { useToastStore } from '@/platform/updates/common/toastStore'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport {\n  useCanvasStore,\n  useTitleEditorStore\n} from '@/renderer/core/canvas/canvasStore'\nimport { app } from '@/scripts/app'\nimport { useDialogService } from '@/services/dialogService'\n\n/**\n * Composable for handling basic selection operations like copy, paste, duplicate, delete, rename\n */\nexport function useSelectionOperations() {\n  // const { getSelectedNodes } = useSelectedLiteGraphItems() // Unused for now\n  const canvasStore = useCanvasStore()\n  const toastStore = useToastStore()\n  const dialogService = useDialogService()\n  const titleEditorStore = useTitleEditorStore()\n  const workflowStore = useWorkflowStore()\n\n  const copySelection = () => {\n    const canvas = app.canvas\n    if (!canvas.selectedItems || canvas.selectedItems.size === 0) {\n      toastStore.add({\n        severity: 'warn',\n        summary: t('g.nothingToCopy'),\n        detail: t('g.selectItemsToCopy'),\n        life: 3000\n      })\n      return\n    }\n\n    canvas.copyToClipboard()\n    toastStore.add({\n      severity: 'success',\n      summary: t('g.copied'),\n      detail: t('g.itemsCopiedToClipboard'),\n      life: 2000\n    })\n  }\n\n  const pasteSelection = () => {\n    const canvas = app.canvas\n    canvas.pasteFromClipboard({ connectInputs: false })\n\n    // Trigger change tracking\n    workflowStore.activeWorkflow?.changeTracker?.checkState()\n  }\n\n  const duplicateSelection = () => {\n    const canvas = app.canvas\n    if (!canvas.selectedItems || canvas.selectedItems.size === 0) {\n      toastStore.add({\n        severity: 'warn',\n        summary: t('g.nothingToDuplicate'),\n        detail: t('g.selectItemsToDuplicate'),\n        life: 3000\n      })\n      return\n    }\n\n    // Copy current selection\n    canvas.copyToClipboard()\n\n    // Clear selection to avoid confusion\n    canvas.selectedItems.clear()\n    canvasStore.updateSelectedItems()\n\n    // Paste to create duplicates\n    canvas.pasteFromClipboard({ connectInputs: false })\n\n    // Trigger change tracking\n    workflowStore.activeWorkflow?.changeTracker?.checkState()\n  }\n\n  const deleteSelection = () => {\n    const canvas = app.canvas\n    if (!canvas.selectedItems || canvas.selectedItems.size === 0) {\n      toastStore.add({\n        severity: 'warn',\n        summary: t('g.nothingToDelete'),\n        detail: t('g.selectItemsToDelete'),\n        life: 3000\n      })\n      return\n    }\n\n    canvas.deleteSelected()\n    canvas.setDirty(true, true)\n\n    // Trigger change tracking\n    workflowStore.activeWorkflow?.changeTracker?.checkState()\n  }\n\n  const renameSelection = async () => {\n    const selectedItems = Array.from(canvasStore.selectedItems)\n\n    // Handle single node selection\n    if (selectedItems.length === 1) {\n      const item = selectedItems[0]\n\n      // For nodes, use the title editor\n      if (item instanceof LGraphNode) {\n        titleEditorStore.titleEditorTarget = item\n        return\n      }\n\n      // For other items like groups, use prompt dialog\n      const currentTitle = 'title' in item ? (item.title as string) : ''\n      const newTitle = await dialogService.prompt({\n        title: t('g.rename'),\n        message: t('g.enterNewName'),\n        defaultValue: currentTitle\n      })\n\n      if (newTitle && newTitle !== currentTitle) {\n        if ('title' in item) {\n          // Type-safe assignment for items with title property\n          const titledItem = item as { title: string }\n          titledItem.title = newTitle\n          app.canvas.setDirty(true, true)\n          workflowStore.activeWorkflow?.changeTracker?.checkState()\n        }\n      }\n      return\n    }\n\n    // Handle multiple selections - batch rename\n    if (selectedItems.length > 1) {\n      const baseTitle = await dialogService.prompt({\n        title: t('g.batchRename'),\n        message: t('g.enterBaseName'),\n        defaultValue: 'Item'\n      })\n\n      if (baseTitle) {\n        selectedItems.forEach((item, index) => {\n          if ('title' in item) {\n            // Type-safe assignment for items with title property\n            const titledItem = item as { title: string }\n            titledItem.title = `${baseTitle} ${index + 1}`\n          }\n        })\n        app.canvas.setDirty(true, true)\n        workflowStore.activeWorkflow?.changeTracker?.checkState()\n      }\n      return\n    }\n\n    toastStore.add({\n      severity: 'warn',\n      summary: t('g.nothingToRename'),\n      detail: t('g.selectItemsToRename'),\n      life: 3000\n    })\n  }\n\n  return {\n    copySelection,\n    pasteSelection,\n    duplicateSelection,\n    deleteSelection,\n    renameSelection\n  }\n}\n","import { useSelectedLiteGraphItems } from '@/composables/canvas/useSelectedLiteGraphItems'\nimport { SubgraphNode } from '@/lib/litegraph/src/litegraph'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useNodeOutputStore } from '@/stores/imagePreviewStore'\nimport { useNodeBookmarkStore } from '@/stores/nodeBookmarkStore'\nimport { useNodeDefStore } from '@/stores/nodeDefStore'\nimport { isLGraphNode } from '@/utils/litegraphUtil'\n\n/**\n * Composable for handling subgraph-related operations\n */\nexport function useSubgraphOperations() {\n  const { getSelectedNodes } = useSelectedLiteGraphItems()\n  const canvasStore = useCanvasStore()\n  const workflowStore = useWorkflowStore()\n  const nodeOutputStore = useNodeOutputStore()\n  const nodeDefStore = useNodeDefStore()\n  const nodeBookmarkStore = useNodeBookmarkStore()\n\n  const convertToSubgraph = () => {\n    const canvas = canvasStore.getCanvas()\n    const graph = canvas.subgraph ?? canvas.graph\n    if (!graph) {\n      return null\n    }\n\n    const res = graph.convertToSubgraph(canvas.selectedItems)\n    if (!res) {\n      return\n    }\n\n    const { node } = res\n    canvas.select(node)\n    canvasStore.updateSelectedItems()\n    // Trigger change tracking\n    workflowStore.activeWorkflow?.changeTracker?.checkState()\n  }\n\n  const unpackSubgraph = () => {\n    const canvas = canvasStore.getCanvas()\n    const graph = canvas.subgraph ?? canvas.graph\n\n    if (!graph) {\n      return\n    }\n\n    const selectedItems = Array.from(canvas.selectedItems)\n    const subgraphNodes = selectedItems.filter(\n      (item): item is SubgraphNode => item instanceof SubgraphNode\n    )\n\n    if (subgraphNodes.length === 0) {\n      return\n    }\n\n    subgraphNodes.forEach((subgraphNode) => {\n      // Revoke any image previews for the subgraph\n      nodeOutputStore.revokeSubgraphPreviews(subgraphNode)\n\n      // Unpack the subgraph\n      graph.unpackSubgraph(subgraphNode)\n    })\n\n    // Trigger change tracking\n    workflowStore.activeWorkflow?.changeTracker?.checkState()\n  }\n\n  const addSubgraphToLibrary = async () => {\n    const selectedItems = Array.from(canvasStore.selectedItems)\n\n    // Handle single node selection like BookmarkButton.vue\n    if (selectedItems.length === 1) {\n      const item = selectedItems[0]\n      if (isLGraphNode(item)) {\n        const nodeDef = nodeDefStore.fromLGraphNode(item)\n        if (nodeDef) {\n          await nodeBookmarkStore.addBookmark(nodeDef.nodePath)\n          return\n        }\n      }\n    }\n\n    // Handle multiple nodes - convert to subgraph first then bookmark\n    const selectedNodes = getSelectedNodes()\n\n    if (selectedNodes.length === 0) {\n      return\n    }\n\n    // Check if selection contains subgraph nodes\n    const hasSubgraphs = selectedNodes.some(\n      (node) => node instanceof SubgraphNode\n    )\n\n    if (!hasSubgraphs) {\n      // Convert regular nodes to subgraph first\n      convertToSubgraph()\n      return\n    }\n\n    // For subgraph nodes, bookmark them\n    let bookmarkedCount = 0\n    for (const node of selectedNodes) {\n      if (node instanceof SubgraphNode) {\n        const nodeDef = nodeDefStore.fromLGraphNode(node)\n        if (nodeDef) {\n          await nodeBookmarkStore.addBookmark(nodeDef.nodePath)\n          bookmarkedCount++\n        }\n      }\n    }\n  }\n\n  const isSubgraphSelected = (): boolean => {\n    const selectedItems = Array.from(canvasStore.selectedItems)\n    return selectedItems.some((item) => item instanceof SubgraphNode)\n  }\n\n  const hasSelectableNodes = (): boolean => {\n    return getSelectedNodes().length > 0\n  }\n\n  return {\n    convertToSubgraph,\n    unpackSubgraph,\n    addSubgraphToLibrary,\n    isSubgraphSelected,\n    hasSelectableNodes\n  }\n}\n","import { computed } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport { useCommandStore } from '@/stores/commandStore'\n\nimport { useFrameNodes } from './useFrameNodes'\nimport { BadgeVariant } from './useMoreOptionsMenu'\nimport type { MenuOption } from './useMoreOptionsMenu'\nimport { useNodeArrangement } from './useNodeArrangement'\nimport { useSelectionOperations } from './useSelectionOperations'\nimport { useSubgraphOperations } from './useSubgraphOperations'\n\n/**\n * Composable for selection-related menu operations\n */\nexport function useSelectionMenuOptions() {\n  const { t } = useI18n()\n  const {\n    copySelection,\n    duplicateSelection,\n    deleteSelection,\n    renameSelection\n  } = useSelectionOperations()\n\n  const { alignOptions, distributeOptions, applyAlign, applyDistribute } =\n    useNodeArrangement()\n\n  const { convertToSubgraph, unpackSubgraph, addSubgraphToLibrary } =\n    useSubgraphOperations()\n\n  const { frameNodes } = useFrameNodes()\n\n  const alignSubmenu = computed(() =>\n    alignOptions.map((align) => ({\n      label: align.localizedName,\n      icon: align.icon,\n      action: () => applyAlign(align)\n    }))\n  )\n\n  const distributeSubmenu = computed(() =>\n    distributeOptions.map((distribute) => ({\n      label: distribute.localizedName,\n      icon: distribute.icon,\n      action: () => applyDistribute(distribute)\n    }))\n  )\n\n  const getBasicSelectionOptions = (): MenuOption[] => [\n    {\n      label: t('contextMenu.Rename'),\n      action: renameSelection\n    },\n    {\n      label: t('contextMenu.Copy'),\n      shortcut: 'Ctrl+C',\n      action: copySelection\n    },\n    {\n      label: t('contextMenu.Duplicate'),\n      shortcut: 'Ctrl+D',\n      action: duplicateSelection\n    }\n  ]\n\n  const getSubgraphOptions = (hasSubgraphs: boolean): MenuOption[] => {\n    if (hasSubgraphs) {\n      return [\n        {\n          label: t('contextMenu.Add Subgraph to Library'),\n          icon: 'icon-[lucide--folder-plus]',\n          action: addSubgraphToLibrary\n        },\n        {\n          label: t('contextMenu.Unpack Subgraph'),\n          icon: 'icon-[lucide--expand]',\n          action: unpackSubgraph\n        }\n      ]\n    } else {\n      return [\n        {\n          label: t('contextMenu.Convert to Subgraph'),\n          icon: 'icon-[lucide--shrink]',\n          action: convertToSubgraph,\n          badge: BadgeVariant.NEW\n        }\n      ]\n    }\n  }\n\n  const getMultipleNodesOptions = (): MenuOption[] => {\n    const convertToGroupNodes = () => {\n      const commandStore = useCommandStore()\n      void commandStore.execute(\n        'Comfy.GroupNode.ConvertSelectedNodesToGroupNode'\n      )\n    }\n\n    return [\n      {\n        label: t('contextMenu.Convert to Group Node'),\n        icon: 'icon-[lucide--group]',\n        action: convertToGroupNodes,\n        badge: BadgeVariant.DEPRECATED\n      },\n      {\n        label: t('g.frameNodes'),\n        icon: 'icon-[lucide--frame]',\n        action: frameNodes\n      }\n    ]\n  }\n\n  const getAlignmentOptions = (): MenuOption[] => [\n    {\n      label: t('contextMenu.Align Selected To'),\n      icon: 'icon-[lucide--align-start-horizontal]',\n      hasSubmenu: true,\n      submenu: alignSubmenu.value,\n      action: () => {}\n    },\n    {\n      label: t('contextMenu.Distribute Nodes'),\n      icon: 'icon-[lucide--align-center-horizontal]',\n      hasSubmenu: true,\n      submenu: distributeSubmenu.value,\n      action: () => {}\n    }\n  ]\n\n  const getDeleteOption = (): MenuOption => ({\n    label: t('contextMenu.Delete'),\n    icon: 'icon-[lucide--trash-2]',\n    shortcut: 'Delete',\n    action: deleteSelection\n  })\n\n  return {\n    getBasicSelectionOptions,\n    getSubgraphOptions,\n    getMultipleNodesOptions,\n    getDeleteOption,\n    getAlignmentOptions,\n    alignSubmenu,\n    distributeSubmenu\n  }\n}\n","import { computed, ref } from 'vue'\nimport type { Ref } from 'vue'\n\nimport type { LGraphGroup } from '@/lib/litegraph/src/litegraph'\nimport { isLGraphGroup } from '@/utils/litegraphUtil'\n\nimport { useGroupMenuOptions } from './useGroupMenuOptions'\nimport { useImageMenuOptions } from './useImageMenuOptions'\nimport { useNodeMenuOptions } from './useNodeMenuOptions'\nimport { useSelectionMenuOptions } from './useSelectionMenuOptions'\nimport { useSelectionState } from './useSelectionState'\n\nexport interface MenuOption {\n  label?: string\n  icon?: string\n  shortcut?: string\n  hasSubmenu?: boolean\n  type?: 'divider'\n  action?: () => void\n  submenu?: SubMenuOption[]\n  badge?: BadgeVariant\n}\n\nexport interface SubMenuOption {\n  label: string\n  icon?: string\n  action: () => void\n  color?: string\n}\n\nexport enum BadgeVariant {\n  NEW = 'new',\n  DEPRECATED = 'deprecated'\n}\n\n// Global singleton for NodeOptions component reference\nlet nodeOptionsInstance: null | NodeOptionsInstance = null\n\n/**\n * Toggle the node options popover\n * @param event - The trigger event\n * @param element - The target element (button) that triggered the popover\n */\nexport function toggleNodeOptions(\n  event: Event,\n  element: HTMLElement,\n  clickedFromToolbox: boolean = false\n) {\n  if (nodeOptionsInstance?.toggle) {\n    nodeOptionsInstance.toggle(event, element, clickedFromToolbox)\n  }\n}\n\n/**\n * Hide the node options popover\n */\ninterface NodeOptionsInstance {\n  toggle: (\n    event: Event,\n    element: HTMLElement,\n    clickedFromToolbox: boolean\n  ) => void\n  hide: () => void\n  isOpen: Ref<boolean>\n}\n\n/**\n * Register the NodeOptions component instance\n * @param instance - The NodeOptions component instance\n */\nexport function registerNodeOptionsInstance(\n  instance: null | NodeOptionsInstance\n) {\n  nodeOptionsInstance = instance\n}\n\n/**\n * Composable for managing the More Options menu configuration\n * Refactored to use smaller, focused composables for better maintainability\n */\nexport function useMoreOptionsMenu() {\n  const {\n    selectedItems,\n    selectedNodes,\n    nodeDef,\n    showNodeHelp,\n    hasSubgraphs: hasSubgraphsComputed,\n    hasImageNode,\n    hasOutputNodesSelected,\n    hasMultipleSelection,\n    computeSelectionFlags\n  } = useSelectionState()\n\n  const { getImageMenuOptions } = useImageMenuOptions()\n  const {\n    getNodeInfoOption,\n    getAdjustSizeOption,\n    getNodeVisualOptions,\n    getPinOption,\n    getBypassOption,\n    getRunBranchOption\n  } = useNodeMenuOptions()\n  const {\n    getFitGroupToNodesOption,\n    getGroupShapeOptions,\n    getGroupColorOptions,\n    getGroupModeOptions\n  } = useGroupMenuOptions()\n  const {\n    getBasicSelectionOptions,\n    getSubgraphOptions,\n    getMultipleNodesOptions,\n    getDeleteOption,\n    getAlignmentOptions\n  } = useSelectionMenuOptions()\n\n  const hasSubgraphs = hasSubgraphsComputed\n  const hasMultipleNodes = hasMultipleSelection\n\n  // Internal version to force menu rebuild after state mutations\n  const optionsVersion = ref(0)\n  const bump = () => {\n    optionsVersion.value++\n  }\n\n  const menuOptions = computed((): MenuOption[] => {\n    // Reference selection flags to ensure re-computation when they change\n\n    optionsVersion.value\n    const states = computeSelectionFlags()\n\n    // Detect single group selection context (and no nodes explicitly selected)\n    const selectedGroups = selectedItems.value.filter(\n      isLGraphGroup\n    ) as LGraphGroup[]\n    const groupContext: LGraphGroup | null =\n      selectedGroups.length === 1 && selectedNodes.value.length === 0\n        ? selectedGroups[0]\n        : null\n    const hasSubgraphsSelected = hasSubgraphs.value\n    const options: MenuOption[] = []\n\n    // Section 1: Basic selection operations (Rename, Copy, Duplicate)\n    options.push(...getBasicSelectionOptions())\n    options.push({ type: 'divider' })\n\n    // Section 2: Node Info & Size Adjustment\n    if (nodeDef.value) {\n      options.push(getNodeInfoOption(showNodeHelp))\n    }\n\n    if (groupContext) {\n      options.push(getFitGroupToNodesOption(groupContext))\n    } else {\n      options.push(getAdjustSizeOption())\n    }\n\n    // Section 3: Collapse/Shape/Color\n    if (groupContext) {\n      // Group context: Shape, Color, Divider\n      options.push(getGroupShapeOptions(groupContext, bump))\n      options.push(getGroupColorOptions(groupContext, bump))\n      options.push({ type: 'divider' })\n    } else {\n      // Node context: Expand/Minimize, Shape, Color, Divider\n      options.push(...getNodeVisualOptions(states, bump))\n      options.push({ type: 'divider' })\n    }\n\n    // Section 4: Image operations (if image node)\n    if (hasImageNode.value && selectedNodes.value.length > 0) {\n      options.push(...getImageMenuOptions(selectedNodes.value[0]))\n    }\n\n    // Section 5: Subgraph operations\n    options.push(...getSubgraphOptions(hasSubgraphsSelected))\n\n    // Section 6: Multiple nodes operations\n    if (hasMultipleNodes.value) {\n      options.push(...getMultipleNodesOptions())\n    }\n\n    // Section 7: Divider\n    options.push({ type: 'divider' })\n\n    // Section 8: Pin/Unpin (non-group only)\n    if (!groupContext) {\n      options.push(getPinOption(states, bump))\n    }\n\n    // Section 9: Alignment (if multiple nodes)\n    if (hasMultipleNodes.value) {\n      options.push(...getAlignmentOptions())\n    }\n\n    // Section 10: Mode operations\n    if (groupContext) {\n      // Group mode operations\n      options.push(...getGroupModeOptions(groupContext, bump))\n    } else {\n      // Bypass option for nodes\n      options.push(getBypassOption(states, bump))\n    }\n\n    // Section 11: Run Branch (if output nodes)\n    if (hasOutputNodesSelected.value) {\n      options.push(getRunBranchOption())\n    }\n\n    // Section 12: Final divider and Delete\n    options.push({ type: 'divider' })\n    options.push(getDeleteOption())\n\n    return options\n  })\n\n  // Computed property to get only menu items with submenus\n  const menuOptionsWithSubmenu = computed(() =>\n    menuOptions.value.filter((option) => option.hasSubmenu && option.submenu)\n  )\n\n  return {\n    menuOptions,\n    menuOptionsWithSubmenu,\n    bump,\n    hasSubgraphs,\n    registerNodeOptionsInstance\n  }\n}\n","<template>\n  <Button\n    ref=\"buttonRef\"\n    v-tooltip.top=\"{\n      value: $t('g.moreOptions'),\n      showDelay: 1000\n    }\"\n    data-testid=\"more-options-button\"\n    text\n    class=\"h-8 w-8 px-0\"\n    severity=\"secondary\"\n    @click=\"handleClick\"\n  >\n    <i class=\"icon-[lucide--more-vertical] h-4 w-4\" />\n  </Button>\n</template>\n\n<script setup lang=\"ts\">\nimport Button from 'primevue/button'\nimport { ref } from 'vue'\n\nimport { toggleNodeOptions } from '@/composables/graph/useMoreOptionsMenu'\n\nconst buttonRef = ref<InstanceType<typeof Button> | null>(null)\n\nconst handleClick = (event: Event) => {\n  const el = (buttonRef.value as any)?.$el || buttonRef.value\n  const buttonEl = el instanceof HTMLElement ? el : null\n  if (buttonEl) {\n    toggleNodeOptions(event, buttonEl, true)\n  }\n}\n</script>\n","<template>\n  <div class=\"h-6 w-px self-center bg-border-default\" />\n</template>\n","<template>\n  <div\n    ref=\"toolboxRef\"\n    style=\"transform: translate(var(--tb-x), var(--tb-y))\"\n    class=\"pointer-events-none fixed top-0 left-0 z-40\"\n  >\n    <Transition name=\"slide-up\">\n      <Panel\n        v-if=\"visible\"\n        class=\"selection-toolbox pointer-events-auto rounded-lg border border-interface-stroke bg-interface-panel-surface\"\n        :pt=\"{\n          header: 'hidden',\n          content: 'p-2 h-12 flex flex-row gap-1'\n        }\"\n        @wheel=\"canvasInteractions.forwardEventToCanvas\"\n      >\n        <DeleteButton v-if=\"showDelete\" />\n        <VerticalDivider v-if=\"showInfoButton && showAnyPrimaryActions\" />\n        <InfoButton v-if=\"showInfoButton\" />\n\n        <ColorPickerButton v-if=\"showColorPicker\" />\n        <FrameNodes v-if=\"showFrameNodes\" />\n        <ConvertToSubgraphButton v-if=\"showConvertToSubgraph\" />\n        <ConfigureSubgraph v-if=\"showSubgraphButtons\" />\n        <PublishSubgraphButton v-if=\"showSubgraphButtons\" />\n        <MaskEditorButton v-if=\"showMaskEditor\" />\n        <VerticalDivider\n          v-if=\"showAnyPrimaryActions && showAnyControlActions\"\n        />\n\n        <BypassButton v-if=\"showBypass\" />\n        <RefreshSelectionButton v-if=\"showRefresh\" />\n        <Load3DViewerButton v-if=\"showLoad3DViewer\" />\n\n        <ExtensionCommandButton\n          v-for=\"command in extensionToolboxCommands\"\n          :key=\"command.id\"\n          :command=\"command\"\n        />\n        <ExecuteButton v-if=\"showExecute\" />\n        <NodeOptionsButton />\n      </Panel>\n    </Transition>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport Panel from 'primevue/panel'\nimport { computed, ref } from 'vue'\n\nimport BypassButton from '@/components/graph/selectionToolbox/BypassButton.vue'\nimport ColorPickerButton from '@/components/graph/selectionToolbox/ColorPickerButton.vue'\nimport ConfigureSubgraph from '@/components/graph/selectionToolbox/ConfigureSubgraph.vue'\nimport ConvertToSubgraphButton from '@/components/graph/selectionToolbox/ConvertToSubgraphButton.vue'\nimport DeleteButton from '@/components/graph/selectionToolbox/DeleteButton.vue'\nimport ExecuteButton from '@/components/graph/selectionToolbox/ExecuteButton.vue'\nimport ExtensionCommandButton from '@/components/graph/selectionToolbox/ExtensionCommandButton.vue'\nimport InfoButton from '@/components/graph/selectionToolbox/InfoButton.vue'\nimport Load3DViewerButton from '@/components/graph/selectionToolbox/Load3DViewerButton.vue'\nimport MaskEditorButton from '@/components/graph/selectionToolbox/MaskEditorButton.vue'\nimport RefreshSelectionButton from '@/components/graph/selectionToolbox/RefreshSelectionButton.vue'\nimport PublishSubgraphButton from '@/components/graph/selectionToolbox/SaveToSubgraphLibrary.vue'\nimport { useSelectionToolboxPosition } from '@/composables/canvas/useSelectionToolboxPosition'\nimport { useSelectionState } from '@/composables/graph/useSelectionState'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useCanvasInteractions } from '@/renderer/core/canvas/useCanvasInteractions'\nimport { useExtensionService } from '@/services/extensionService'\nimport { useCommandStore } from '@/stores/commandStore'\nimport type { ComfyCommandImpl } from '@/stores/commandStore'\n\nimport FrameNodes from './selectionToolbox/FrameNodes.vue'\nimport NodeOptionsButton from './selectionToolbox/NodeOptionsButton.vue'\nimport VerticalDivider from './selectionToolbox/VerticalDivider.vue'\n\nconst commandStore = useCommandStore()\nconst canvasStore = useCanvasStore()\nconst extensionService = useExtensionService()\nconst canvasInteractions = useCanvasInteractions()\n\nconst toolboxRef = ref<HTMLElement | undefined>()\nconst { visible } = useSelectionToolboxPosition(toolboxRef)\n\nconst extensionToolboxCommands = computed<ComfyCommandImpl[]>(() => {\n  const commandIds = new Set<string>(\n    canvasStore.selectedItems\n      .map(\n        (item) =>\n          extensionService\n            .invokeExtensions('getSelectionToolboxCommands', item)\n            .flat() as string[]\n      )\n      .flat()\n  )\n  return Array.from(commandIds)\n    .map((commandId) => commandStore.getCommand(commandId))\n    .filter((command): command is ComfyCommandImpl => command !== undefined)\n})\n\nconst {\n  hasAnySelection,\n  hasMultipleSelection,\n  isSingleNode,\n  isSingleSubgraph,\n  isSingleImageNode,\n  hasAny3DNodeSelected,\n  hasOutputNodesSelected,\n  nodeDef\n} = useSelectionState()\nconst showInfoButton = computed(() => !!nodeDef.value)\n\nconst showColorPicker = computed(() => hasAnySelection.value)\nconst showConvertToSubgraph = computed(() => hasAnySelection.value)\nconst showFrameNodes = computed(() => hasMultipleSelection.value)\nconst showSubgraphButtons = computed(() => isSingleSubgraph.value)\n\nconst showBypass = computed(\n  () =>\n    isSingleNode.value || isSingleSubgraph.value || hasMultipleSelection.value\n)\nconst showLoad3DViewer = computed(() => hasAny3DNodeSelected.value)\nconst showMaskEditor = computed(() => isSingleImageNode.value)\n\nconst showDelete = computed(() => hasAnySelection.value)\nconst showRefresh = computed(() => hasAnySelection.value)\nconst showExecute = computed(() => hasOutputNodesSelected.value)\n\nconst showAnyPrimaryActions = computed(\n  () =>\n    showColorPicker.value ||\n    showConvertToSubgraph.value ||\n    showFrameNodes.value ||\n    showSubgraphButtons.value\n)\n\nconst showAnyControlActions = computed(() => showBypass.value)\n</script>\n\n<style scoped>\n.selection-toolbox {\n  transform: translateX(-50%) translateY(-120%);\n}\n\n@keyframes slideUp {\n  0% {\n    transform: translateX(-50%) translateY(-100%);\n    opacity: 0;\n  }\n  50% {\n    transform: translateX(-50%) translateY(-125%);\n    opacity: 0.5;\n  }\n  100% {\n    transform: translateX(-50%) translateY(-120%);\n    opacity: 1;\n  }\n}\n\n.slide-up-enter-active {\n  animation: slideUp 125ms ease-out;\n}\n\n.slide-up-leave-active {\n  animation: slideUp 25ms ease-out reverse;\n}\n</style>\n","<template>\n  <div\n    v-if=\"showInput\"\n    class=\"group-title-editor node-title-editor\"\n    :style=\"inputStyle\"\n  >\n    <EditableText\n      :is-editing=\"showInput\"\n      :model-value=\"editedTitle\"\n      @edit=\"onEdit\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useEventListener } from '@vueuse/core'\nimport { computed, ref, watch } from 'vue'\nimport type { CSSProperties } from 'vue'\n\nimport EditableText from '@/components/common/EditableText.vue'\nimport { useAbsolutePosition } from '@/composables/element/useAbsolutePosition'\nimport {\n  LGraphGroup,\n  LGraphNode,\n  LiteGraph\n} from '@/lib/litegraph/src/litegraph'\nimport type { LiteGraphCanvasEvent } from '@/lib/litegraph/src/litegraph'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport {\n  useCanvasStore,\n  useTitleEditorStore\n} from '@/renderer/core/canvas/canvasStore'\nimport { app } from '@/scripts/app'\n\nconst settingStore = useSettingStore()\n\nconst showInput = ref(false)\nconst editedTitle = ref('')\nconst { style: inputPositionStyle, updatePosition } = useAbsolutePosition()\nconst inputFontStyle = ref<CSSProperties>({})\nconst inputStyle = computed<CSSProperties>(() => ({\n  ...inputPositionStyle.value,\n  ...inputFontStyle.value\n}))\n\nconst titleEditorStore = useTitleEditorStore()\nconst canvasStore = useCanvasStore()\nconst previousCanvasDraggable = ref(true)\n\nconst onEdit = (newValue: string) => {\n  if (titleEditorStore.titleEditorTarget && newValue?.trim()) {\n    const trimmedTitle = newValue.trim()\n    titleEditorStore.titleEditorTarget.title = trimmedTitle\n\n    // If this is a subgraph node, sync the runtime subgraph name for breadcrumb reactivity\n    const target = titleEditorStore.titleEditorTarget\n    if (target instanceof LGraphNode && target.isSubgraphNode?.()) {\n      target.subgraph.name = trimmedTitle\n    }\n\n    app.graph.setDirtyCanvas(true, true)\n  }\n  showInput.value = false\n  titleEditorStore.titleEditorTarget = null\n  canvasStore.canvas!.allow_dragcanvas = previousCanvasDraggable.value\n}\n\nwatch(\n  () => titleEditorStore.titleEditorTarget,\n  (target) => {\n    if (target === null) {\n      return\n    }\n    editedTitle.value = target.title\n    showInput.value = true\n    const canvas = canvasStore.canvas!\n    previousCanvasDraggable.value = canvas.allow_dragcanvas\n    canvas.allow_dragcanvas = false\n    const scale = canvas.ds.scale\n\n    if (target instanceof LGraphGroup) {\n      const group = target\n      updatePosition({\n        pos: group.pos,\n        size: [group.size[0], group.titleHeight]\n      })\n      inputFontStyle.value = { fontSize: `${group.font_size * scale}px` }\n    } else if (target instanceof LGraphNode) {\n      const node = target\n      const [x, y] = node.getBounding()\n      updatePosition({\n        pos: [x, y],\n        size: [node.width, LiteGraph.NODE_TITLE_HEIGHT]\n      })\n      inputFontStyle.value = { fontSize: `${12 * scale}px` }\n    }\n  }\n)\n\nconst canvasEventHandler = (event: LiteGraphCanvasEvent) => {\n  if (event.detail.subType === 'group-double-click') {\n    if (!settingStore.get('Comfy.Group.DoubleClickTitleToEdit')) {\n      return\n    }\n\n    const group: LGraphGroup = event.detail.group\n    const [_, y] = group.pos\n\n    const e = event.detail.originalEvent\n    const relativeY = e.canvasY - y\n    // Only allow editing if the click is on the title bar\n    if (relativeY <= group.titleHeight) {\n      titleEditorStore.titleEditorTarget = group\n    }\n  } else if (event.detail.subType === 'node-double-click') {\n    if (!settingStore.get('Comfy.Node.DoubleClickTitleToEdit')) {\n      return\n    }\n\n    const node: LGraphNode = event.detail.node\n    const [_, y] = node.pos\n\n    const e = event.detail.originalEvent\n    const relativeY = e.canvasY - y\n    // Only allow editing if the click is on the title bar\n    if (relativeY <= 0) {\n      titleEditorStore.titleEditorTarget = node\n    }\n  }\n}\n\nuseEventListener(document, 'litegraph:canvas', canvasEventHandler)\n</script>\n\n<style scoped>\n.group-title-editor.node-title-editor {\n  z-index: 9999;\n  padding: 0.25rem;\n}\n\n:deep(.editable-text) {\n  width: 100%;\n  height: 100%;\n}\n\n:deep(.editable-text input) {\n  width: 100%;\n  height: 100%;\n  /* Override the default font size */\n  font-size: inherit;\n}\n</style>\n","import { nextTick } from 'vue'\n\nimport type { MenuOption } from './useMoreOptionsMenu'\n\n/**\n * Composable for handling submenu positioning logic\n */\nexport function useSubmenuPositioning() {\n  /**\n   * Toggle submenu visibility with proper positioning\n   * @param option - Menu option with submenu\n   * @param event - Click event\n   * @param submenu - PrimeVue Popover reference\n   * @param currentSubmenu - Currently open submenu name\n   * @param menuOptionsWithSubmenu - All menu options with submenus\n   * @param submenuRefs - References to all submenu popovers\n   */\n  const toggleSubmenu = async (\n    option: MenuOption,\n    event: Event,\n    submenu: any, // Component instance with show/hide methods\n    currentSubmenu: { value: string | null },\n    menuOptionsWithSubmenu: MenuOption[],\n    submenuRefs: Record<string, any> // Component instances\n  ): Promise<void> => {\n    if (!option.label || !option.hasSubmenu) return\n\n    // Check if this submenu is currently open\n    const isCurrentlyOpen = currentSubmenu.value === option.label\n\n    // Hide all submenus first\n    menuOptionsWithSubmenu.forEach((opt) => {\n      const sm = submenuRefs[`submenu-${opt.label}`]\n      if (sm) {\n        sm.hide()\n      }\n    })\n    currentSubmenu.value = null\n\n    // If it wasn't open before, show it now\n    if (!isCurrentlyOpen) {\n      currentSubmenu.value = option.label\n      await nextTick()\n\n      const menuItem = event.currentTarget as HTMLElement\n      const menuItemRect = menuItem.getBoundingClientRect()\n\n      // Find the parent popover content element that contains this menu item\n      const mainPopoverContent = menuItem.closest(\n        '[data-pc-section=\"content\"]'\n      ) as HTMLElement\n\n      if (mainPopoverContent) {\n        const mainPopoverRect = mainPopoverContent.getBoundingClientRect()\n\n        // Create a temporary positioned element as the target\n        const tempTarget = createPositionedTarget(\n          mainPopoverRect.right + 8,\n          menuItemRect.top,\n          `submenu-target-${option.label}`\n        )\n\n        // Create event using the temp target\n        const tempEvent = createMouseEvent(\n          mainPopoverRect.right + 8,\n          menuItemRect.top\n        )\n\n        // Show submenu relative to temp target\n        submenu.show(tempEvent, tempTarget)\n\n        // Clean up temp target after a delay\n        cleanupTempTarget(tempTarget, 100)\n      } else {\n        // Fallback: position to the right of the menu item\n        const tempTarget = createPositionedTarget(\n          menuItemRect.right + 8,\n          menuItemRect.top,\n          `submenu-fallback-target-${option.label}`\n        )\n\n        // Create event using the temp target\n        const tempEvent = createMouseEvent(\n          menuItemRect.right + 8,\n          menuItemRect.top\n        )\n\n        // Show submenu relative to temp target\n        submenu.show(tempEvent, tempTarget)\n\n        // Clean up temp target after a delay\n        cleanupTempTarget(tempTarget, 100)\n      }\n    }\n  }\n\n  /**\n   * Create a temporary positioned DOM element for submenu targeting\n   */\n  const createPositionedTarget = (\n    left: number,\n    top: number,\n    id: string\n  ): HTMLElement => {\n    const tempTarget = document.createElement('div')\n    tempTarget.style.position = 'absolute'\n    tempTarget.style.left = `${left}px`\n    tempTarget.style.top = `${top}px`\n    tempTarget.style.width = '1px'\n    tempTarget.style.height = '1px'\n    tempTarget.style.pointerEvents = 'none'\n    tempTarget.style.visibility = 'hidden'\n    tempTarget.id = id\n\n    document.body.appendChild(tempTarget)\n    return tempTarget\n  }\n\n  /**\n   * Create a mouse event with specific coordinates\n   */\n  const createMouseEvent = (clientX: number, clientY: number): MouseEvent => {\n    return new MouseEvent('click', {\n      bubbles: true,\n      cancelable: true,\n      clientX,\n      clientY\n    })\n  }\n\n  /**\n   * Clean up temporary target element after delay\n   */\n  const cleanupTempTarget = (target: HTMLElement, delay: number): void => {\n    setTimeout(() => {\n      if (target.parentNode) {\n        target.parentNode.removeChild(target)\n      }\n    }, delay)\n  }\n\n  /**\n   * Hide all submenus\n   */\n  const hideAllSubmenus = (\n    menuOptionsWithSubmenu: MenuOption[],\n    submenuRefs: Record<string, any>, // Component instances\n    currentSubmenu: { value: string | null }\n  ): void => {\n    menuOptionsWithSubmenu.forEach((option) => {\n      const submenu = submenuRefs[`submenu-${option.label}`]\n      if (submenu) {\n        submenu.hide()\n      }\n    })\n    currentSubmenu.value = null\n  }\n\n  return {\n    toggleSubmenu,\n    hideAllSubmenus\n  }\n}\n","<template>\n  <div v-if=\"option.type === 'divider'\" class=\"my-1 h-px bg-border-default\" />\n  <div\n    v-else\n    role=\"button\"\n    class=\"group flex cursor-pointer items-center gap-2 rounded px-3 py-1.5 text-left text-sm text-text-primary hover:bg-interface-menu-component-surface-hovered\"\n    @click=\"handleClick\"\n  >\n    <i v-if=\"option.icon\" :class=\"[option.icon, 'h-4 w-4']\" />\n    <span class=\"flex-1\">{{ option.label }}</span>\n    <span\n      v-if=\"option.shortcut\"\n      class=\"flex h-3.5 min-w-3.5 items-center justify-center rounded bg-interface-menu-keybind-surface-default px-1 py-0 text-xxs\"\n    >\n      {{ option.shortcut }}\n    </span>\n    <i\n      v-if=\"option.hasSubmenu\"\n      :size=\"14\"\n      class=\"icon-[lucide--chevron-right] opacity-60\"\n    />\n    <Badge\n      v-if=\"option.badge\"\n      :severity=\"option.badge === 'new' ? 'info' : 'secondary'\"\n      :value=\"t(option.badge)\"\n      :class=\"\n        cn(\n          'h-4 gap-2.5 px-1 text-[9px] text-base-foreground uppercase rounded-4xl',\n          {\n            'bg-primary-background': option.badge === 'new',\n            'bg-secondary-background': option.badge === 'deprecated'\n          }\n        )\n      \"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { cn } from '@comfyorg/tailwind-utils'\nimport Badge from 'primevue/badge'\nimport { useI18n } from 'vue-i18n'\n\nimport type { MenuOption } from '@/composables/graph/useMoreOptionsMenu'\n\nconst { t } = useI18n()\n\ninterface Props {\n  option: MenuOption\n}\n\ninterface Emits {\n  (e: 'click', option: MenuOption, event: Event): void\n}\n\nconst props = defineProps<Props>()\nconst emit = defineEmits<Emits>()\n\nconst handleClick = (event: Event) => {\n  emit('click', props.option, event)\n}\n</script>\n","<template>\n  <Popover\n    ref=\"popover\"\n    :auto-z-index=\"true\"\n    :base-z-index=\"1100\"\n    :dismissable=\"true\"\n    :close-on-escape=\"true\"\n    unstyled\n    :pt=\"{\n      root: {\n        class: 'absolute z-[60]'\n      },\n      content: {\n        class: [\n          'text-base-foreground rounded-lg',\n          'shadow-lg border border-base-background',\n          'bg-interface-panel-surface'\n        ]\n      }\n    }\"\n  >\n    <div\n      :class=\"\n        isColorSubmenu\n          ? 'flex flex-col gap-1 p-2'\n          : 'flex flex-col p-2 min-w-40'\n      \"\n    >\n      <div\n        v-for=\"subOption in option.submenu\"\n        :key=\"subOption.label\"\n        :class=\"\n          cn(\n            'hover:bg-secondary-background-hover rounded cursor-pointer',\n            isColorSubmenu\n              ? 'w-7 h-7 flex items-center justify-center'\n              : 'flex items-center gap-2 px-3 py-1.5 text-sm'\n          )\n        \"\n        :title=\"subOption.label\"\n        @click=\"handleSubmenuClick(subOption)\"\n      >\n        <div\n          v-if=\"subOption.color\"\n          class=\"size-5 rounded-full border border-border-default\"\n          :style=\"{ backgroundColor: subOption.color }\"\n        />\n        <template v-else-if=\"!subOption.color\">\n          <i\n            v-if=\"isShapeSelected(subOption)\"\n            class=\"icon-[lucide--check] size-4 flex-shrink-0\"\n          />\n          <div v-else class=\"w-4 flex-shrink-0\" />\n          <span>{{ subOption.label }}</span>\n        </template>\n      </div>\n    </div>\n  </Popover>\n</template>\n\n<script setup lang=\"ts\">\nimport { cn } from '@comfyorg/tailwind-utils'\nimport Popover from 'primevue/popover'\nimport { computed, ref } from 'vue'\n\nimport type {\n  MenuOption,\n  SubMenuOption\n} from '@/composables/graph/useMoreOptionsMenu'\nimport { useNodeCustomization } from '@/composables/graph/useNodeCustomization'\n\ninterface Props {\n  option: MenuOption\n}\n\ninterface Emits {\n  (e: 'submenu-click', subOption: SubMenuOption): void\n}\n\nconst props = defineProps<Props>()\nconst emit = defineEmits<Emits>()\n\nconst { getCurrentShape } = useNodeCustomization()\n\nconst popover = ref<InstanceType<typeof Popover>>()\n\nconst show = (event: Event, target?: HTMLElement) => {\n  popover.value?.show(event, target)\n}\n\nconst hide = () => {\n  popover.value?.hide()\n}\n\ndefineExpose({\n  show,\n  hide\n})\n\nconst handleSubmenuClick = (subOption: SubMenuOption) => {\n  emit('submenu-click', subOption)\n}\n\nconst isShapeSelected = (subOption: SubMenuOption): boolean => {\n  if (subOption.color) return false\n\n  const currentShape = getCurrentShape()\n  if (!currentShape) return false\n\n  return currentShape.localizedName === subOption.label\n}\n\nconst isColorSubmenu = computed(() => {\n  return (\n    props.option.submenu &&\n    props.option.submenu.length > 0 &&\n    props.option.submenu.every((item) => item.color && !item.icon)\n  )\n})\n</script>\n","<template>\n  <div>\n    <Popover\n      ref=\"popover\"\n      :append-to=\"'body'\"\n      :auto-z-index=\"true\"\n      :base-z-index=\"1000\"\n      :dismissable=\"true\"\n      :close-on-escape=\"true\"\n      unstyled\n      :pt=\"{\n        root: {\n          class: 'absolute z-50 w-[300px]'\n        },\n        content: {\n          class: [\n            'mt-2 text-base-foreground rounded-lg',\n            'shadow-lg border border-border-default',\n            'bg-interface-panel-surface'\n          ]\n        }\n      }\"\n      @show=\"onPopoverShow\"\n      @hide=\"onPopoverHide\"\n      @wheel=\"canvasInteractions.forwardEventToCanvas\"\n    >\n      <div class=\"flex min-w-48 flex-col p-2\">\n        <MenuOptionItem\n          v-for=\"(option, index) in menuOptions\"\n          :key=\"option.label || `divider-${index}`\"\n          :option=\"option\"\n          @click=\"handleOptionClick\"\n        />\n      </div>\n    </Popover>\n\n    <SubmenuPopover\n      v-for=\"option in menuOptionsWithSubmenu\"\n      :key=\"`submenu-${option.label}`\"\n      :ref=\"(el) => setSubmenuRef(`submenu-${option.label}`, el)\"\n      :option=\"option\"\n      @submenu-click=\"handleSubmenuClick\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useRafFn } from '@vueuse/core'\nimport Popover from 'primevue/popover'\nimport { onMounted, onUnmounted, ref, watch } from 'vue'\n\nimport {\n  forceCloseMoreOptionsSignal,\n  moreOptionsOpen,\n  moreOptionsRestorePending,\n  restoreMoreOptionsSignal\n} from '@/composables/canvas/useSelectionToolboxPosition'\nimport {\n  registerNodeOptionsInstance,\n  useMoreOptionsMenu\n} from '@/composables/graph/useMoreOptionsMenu'\nimport type {\n  MenuOption,\n  SubMenuOption\n} from '@/composables/graph/useMoreOptionsMenu'\nimport { useSubmenuPositioning } from '@/composables/graph/useSubmenuPositioning'\nimport { useCanvasInteractions } from '@/renderer/core/canvas/useCanvasInteractions'\n\nimport MenuOptionItem from './MenuOptionItem.vue'\nimport SubmenuPopover from './SubmenuPopover.vue'\n\nconst popover = ref<InstanceType<typeof Popover>>()\nconst targetElement = ref<HTMLElement | null>(null)\nconst isTriggeredByToolbox = ref<boolean>(true)\n// Track open state ourselves so we can restore after drag/move\nconst isOpen = ref(false)\nconst wasOpenBeforeHide = ref(false)\n// Track why the popover was hidden so we only auto-reopen after drag.\ntype HideReason = 'manual' | 'drag'\nconst lastProgrammaticHideReason = ref<HideReason | null>(null)\nconst submenuRefs = ref<Record<string, InstanceType<typeof SubmenuPopover>>>({})\nconst currentSubmenu = ref<string | null>(null)\n\nconst { menuOptions, menuOptionsWithSubmenu, bump } = useMoreOptionsMenu()\nconst { toggleSubmenu, hideAllSubmenus } = useSubmenuPositioning()\nconst canvasInteractions = useCanvasInteractions()\n\nlet lastLogTs = 0\nconst LOG_INTERVAL = 120 // ms\nlet overlayElCache: HTMLElement | null = null\n\nfunction resolveOverlayEl(): HTMLElement | null {\n  // Prefer cached element (cleared on hide)\n  if (overlayElCache && overlayElCache.isConnected) return overlayElCache\n  // PrimeVue Popover root element (component instance $el)\n  const direct = (popover.value as any)?.$el\n  if (direct instanceof HTMLElement) {\n    overlayElCache = direct\n    return direct\n  }\n  // Fallback: try to locate a recent popover root near the button (same z-index class + absolute)\n  const btn = targetElement.value\n  if (btn) {\n    const candidates = Array.from(\n      document.querySelectorAll('div.absolute.z-50')\n    ) as HTMLElement[]\n    // Heuristic: pick the one closest (vertically) below the button\n    const rect = btn.getBoundingClientRect()\n    let best: { el: HTMLElement; dist: number } | null = null\n    for (const el of candidates) {\n      const r = el.getBoundingClientRect()\n      const dist = Math.abs(r.top - rect.bottom)\n      if (!best || dist < best.dist) best = { el, dist }\n    }\n    if (best && best.el) {\n      overlayElCache = best.el\n      return best.el\n    }\n  }\n  return null\n}\n\nconst repositionPopover = () => {\n  if (!isOpen.value) return\n  const btn = targetElement.value\n  const overlayEl = resolveOverlayEl()\n  if (!btn || !overlayEl) return\n  const rect = btn.getBoundingClientRect()\n  const marginY = 8 // tailwind mt-2 ~ 0.5rem = 8px\n  const left = isTriggeredByToolbox.value\n    ? rect.left + rect.width / 2\n    : rect.right - rect.width / 4\n  const top = isTriggeredByToolbox.value\n    ? rect.bottom + marginY\n    : rect.top - marginY - 6\n  try {\n    overlayEl.style.position = 'fixed'\n    overlayEl.style.left = `${left}px`\n    overlayEl.style.top = `${top}px`\n    overlayEl.style.transform = 'translate(-50%, 0)'\n  } catch (e) {\n    console.warn('[NodeOptions] Failed to set overlay style', e)\n    return\n  }\n  const now = performance.now()\n  if (now - lastLogTs > LOG_INTERVAL) {\n    lastLogTs = now\n  }\n}\n\nconst { resume: startSync, pause: stopSync } = useRafFn(repositionPopover)\n\nfunction openPopover(\n  triggerEvent?: Event,\n  element?: HTMLElement,\n  clickedFromToolbox?: boolean\n): boolean {\n  const el = element || targetElement.value\n  if (!el || !el.isConnected) return false\n  targetElement.value = el\n  if (clickedFromToolbox !== undefined)\n    isTriggeredByToolbox.value = clickedFromToolbox\n  bump()\n  popover.value?.show(triggerEvent ?? new Event('reopen'), el)\n  isOpen.value = true\n  moreOptionsOpen.value = true\n  moreOptionsRestorePending.value = false\n  return true\n}\n\nfunction closePopover(reason: HideReason = 'manual') {\n  lastProgrammaticHideReason.value = reason\n  popover.value?.hide()\n  isOpen.value = false\n  moreOptionsOpen.value = false\n  stopSync()\n  hideAll()\n  if (reason !== 'drag') {\n    wasOpenBeforeHide.value = false\n    // Natural hide: cancel any pending restore\n    moreOptionsRestorePending.value = false\n  } else {\n    if (!moreOptionsRestorePending.value) {\n      wasOpenBeforeHide.value = true\n      moreOptionsRestorePending.value = true\n    }\n  }\n}\n\nlet restoreAttempts = 0\nfunction attemptRestore() {\n  if (isOpen.value) return\n  if (!wasOpenBeforeHide.value && !moreOptionsRestorePending.value) return\n  // Try immediately\n  if (openPopover(new Event('reopen'), targetElement.value || undefined)) {\n    wasOpenBeforeHide.value = false\n    restoreAttempts = 0\n    return\n  }\n  // Defer with limited retries (layout / mount race)\n  if (restoreAttempts >= 5) return\n  restoreAttempts++\n  requestAnimationFrame(() => attemptRestore())\n}\n\nconst toggle = (\n  event: Event,\n  element?: HTMLElement,\n  clickedFromToolbox?: boolean\n) => {\n  if (isOpen.value) closePopover('manual')\n  else openPopover(event, element, clickedFromToolbox)\n}\n\nconst hide = (reason: HideReason = 'manual') => closePopover(reason)\n\n// Export functions for external triggering\ndefineExpose({\n  toggle,\n  hide,\n  isOpen\n})\n\nconst hideAll = () => {\n  hideAllSubmenus(\n    menuOptionsWithSubmenu.value,\n    submenuRefs.value,\n    currentSubmenu\n  )\n}\n\nconst handleOptionClick = (option: MenuOption, event: Event) => {\n  if (!option.hasSubmenu && option.action) {\n    option.action()\n    hide()\n  } else if (option.hasSubmenu) {\n    event.stopPropagation()\n    const submenuKey = `submenu-${option.label}`\n    const submenu = submenuRefs.value[submenuKey]\n\n    if (submenu) {\n      void toggleSubmenu(\n        option,\n        event,\n        submenu,\n        currentSubmenu,\n        menuOptionsWithSubmenu.value,\n        submenuRefs.value\n      )\n    }\n  }\n}\n\nconst handleSubmenuClick = (subOption: SubMenuOption) => {\n  subOption.action()\n  hide('manual')\n}\n\nconst setSubmenuRef = (key: string, el: any) => {\n  if (el) {\n    submenuRefs.value[key] = el\n  } else {\n    delete submenuRefs.value[key]\n  }\n}\n\n// Distinguish outside click (PrimeVue dismiss) from programmatic hides.\nconst onPopoverShow = () => {\n  overlayElCache = resolveOverlayEl()\n  // Delay first reposition slightly to ensure DOM fully painted\n  requestAnimationFrame(() => repositionPopover())\n  startSync()\n}\n\nconst onPopoverHide = () => {\n  if (lastProgrammaticHideReason.value == null) {\n    isOpen.value = false\n    hideAll()\n    wasOpenBeforeHide.value = false\n    moreOptionsOpen.value = false\n    moreOptionsRestorePending.value = false\n  }\n  overlayElCache = null\n  stopSync()\n  lastProgrammaticHideReason.value = null\n}\n\n// Watch for forced close (drag start)\nwatch(\n  () => forceCloseMoreOptionsSignal.value,\n  () => {\n    if (isOpen.value) hide('drag')\n    else\n      wasOpenBeforeHide.value =\n        wasOpenBeforeHide.value || moreOptionsRestorePending.value\n  }\n)\n\nwatch(\n  () => restoreMoreOptionsSignal.value,\n  () => attemptRestore()\n)\n\nonMounted(() => {\n  // Register this instance globally\n  registerNodeOptionsInstance({\n    toggle,\n    hide,\n    isOpen\n  })\n\n  if (moreOptionsRestorePending.value && !isOpen.value) {\n    requestAnimationFrame(() => attemptRestore())\n  }\n})\n\nonUnmounted(() => {\n  stopSync()\n  // Unregister on unmount\n  registerNodeOptionsInstance(null)\n})\n</script>\n","import { useMouse } from '@vueuse/core'\nimport { defineStore } from 'pinia'\nimport { computed, ref, shallowRef } from 'vue'\n\nimport type NodeSearchBoxPopover from '@/components/searchbox/NodeSearchBoxPopover.vue'\nimport type { CanvasPointerEvent } from '@/lib/litegraph/src/litegraph'\nimport { useSettingStore } from '@/platform/settings/settingStore'\n\nexport const useSearchBoxStore = defineStore('searchBox', () => {\n  const settingStore = useSettingStore()\n  const { x, y } = useMouse()\n\n  const newSearchBoxEnabled = computed(\n    () => settingStore.get('Comfy.NodeSearchBoxImpl') === 'default'\n  )\n\n  const popoverRef = shallowRef<InstanceType<\n    typeof NodeSearchBoxPopover\n  > | null>(null)\n\n  function setPopoverRef(\n    popover: InstanceType<typeof NodeSearchBoxPopover> | null\n  ) {\n    popoverRef.value = popover\n  }\n\n  const visible = ref(false)\n  function toggleVisible() {\n    if (newSearchBoxEnabled.value) {\n      visible.value = !visible.value\n      return\n    }\n    if (!popoverRef.value) return\n    popoverRef.value.showSearchBox(\n      new MouseEvent('click', {\n        clientX: x.value,\n        clientY: y.value,\n        // @ts-expect-error layerY is a nonstandard property\n        layerY: y.value\n      }) as unknown as CanvasPointerEvent\n    )\n  }\n\n  return {\n    newSearchBoxEnabled,\n    setPopoverRef,\n    toggleVisible,\n    visible\n  }\n})\n","<!-- Auto complete with extra event \"focused-option-changed\" -->\n<script>\nimport AutoComplete from 'primevue/autocomplete'\n\nexport default {\n  name: 'AutoCompletePlus',\n  extends: AutoComplete,\n  emits: ['focused-option-changed'],\n  data() {\n    return {\n      // Flag to determine if IME is active\n      isComposing: false\n    }\n  },\n  mounted() {\n    if (typeof AutoComplete.mounted === 'function') {\n      AutoComplete.mounted.call(this)\n    }\n\n    // Retrieve the actual <input> element and attach IME events\n    const inputEl = this.$el.querySelector('input')\n    if (inputEl) {\n      inputEl.addEventListener('compositionstart', () => {\n        this.isComposing = true\n      })\n      inputEl.addEventListener('compositionend', () => {\n        this.isComposing = false\n      })\n    }\n    // Add a watcher on the focusedOptionIndex property\n    this.$watch(\n      () => this.focusedOptionIndex,\n      (newVal, oldVal) => {\n        // Emit a custom event when focusedOptionIndex changes\n        this.$emit('focused-option-changed', newVal)\n      }\n    )\n  },\n  methods: {\n    // Override onKeyDown to block Enter when IME is active\n    onKeyDown(event) {\n      if (event.key === 'Enter' && this.isComposing) {\n        event.preventDefault()\n        event.stopPropagation()\n        return\n      }\n\n      AutoComplete.methods.onKeyDown.call(this, event)\n    }\n  }\n}\n</script>\n","<template>\n  <div\n    class=\"option-container flex w-full cursor-pointer items-center justify-between overflow-hidden px-2 py-0\"\n  >\n    <div class=\"option-display-name flex flex-col font-semibold\">\n      <div>\n        <span v-if=\"isBookmarked\">\n          <i class=\"pi pi-bookmark-fill mr-1 text-sm\" />\n        </span>\n        <span v-html=\"highlightQuery(nodeDef.display_name, currentQuery)\" />\n        <span>&nbsp;</span>\n        <Tag v-if=\"showIdName\" severity=\"secondary\">\n          <span v-html=\"highlightQuery(nodeDef.name, currentQuery)\" />\n        </Tag>\n      </div>\n      <div\n        v-if=\"showCategory\"\n        class=\"option-category truncate text-sm font-light text-muted\"\n      >\n        {{ nodeDef.category.replaceAll('/', ' > ') }}\n      </div>\n    </div>\n    <div class=\"option-badges\">\n      <Tag\n        v-if=\"nodeDef.experimental\"\n        :value=\"$t('g.experimental')\"\n        severity=\"primary\"\n      />\n      <Tag\n        v-if=\"nodeDef.deprecated\"\n        :value=\"$t('g.deprecated')\"\n        severity=\"danger\"\n      />\n      <Tag\n        v-if=\"showNodeFrequency && nodeFrequency > 0\"\n        :value=\"formatNumberWithSuffix(nodeFrequency, { roundToInt: true })\"\n        severity=\"secondary\"\n      />\n      <Chip\n        v-if=\"nodeDef.nodeSource.type !== NodeSourceType.Unknown\"\n        class=\"text-sm font-light\"\n      >\n        {{ nodeDef.nodeSource.displayText }}\n      </Chip>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport Chip from 'primevue/chip'\nimport Tag from 'primevue/tag'\nimport { computed } from 'vue'\n\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useNodeBookmarkStore } from '@/stores/nodeBookmarkStore'\nimport type { ComfyNodeDefImpl } from '@/stores/nodeDefStore'\nimport { useNodeFrequencyStore } from '@/stores/nodeDefStore'\nimport { NodeSourceType } from '@/types/nodeSource'\nimport { formatNumberWithSuffix, highlightQuery } from '@/utils/formatUtil'\n\nconst settingStore = useSettingStore()\nconst showCategory = computed(() =>\n  settingStore.get('Comfy.NodeSearchBoxImpl.ShowCategory')\n)\nconst showIdName = computed(() =>\n  settingStore.get('Comfy.NodeSearchBoxImpl.ShowIdName')\n)\nconst showNodeFrequency = computed(() =>\n  settingStore.get('Comfy.NodeSearchBoxImpl.ShowNodeFrequency')\n)\nconst nodeFrequencyStore = useNodeFrequencyStore()\nconst nodeFrequency = computed(() =>\n  nodeFrequencyStore.getNodeFrequency(props.nodeDef)\n)\n\nconst nodeBookmarkStore = useNodeBookmarkStore()\nconst isBookmarked = computed(() =>\n  nodeBookmarkStore.isBookmarked(props.nodeDef)\n)\n\nconst props = defineProps<{\n  nodeDef: ComfyNodeDefImpl\n  currentQuery: string\n}>()\n</script>\n\n<style scoped>\n:deep(.highlight) {\n  background-color: var(--p-primary-color);\n  color: var(--p-primary-contrast-color);\n  font-weight: 700;\n  border-radius: 0.25rem;\n  padding: 0 0.125rem;\n  margin: -0.125rem 0.125rem;\n}\n</style>\n","<template>\n  <div\n    class=\"comfy-vue-node-search-container flex w-full min-w-96 items-center justify-center\"\n  >\n    <div\n      v-if=\"enableNodePreview\"\n      class=\"comfy-vue-node-preview-container absolute top-[50px] left-[-350px]\"\n    >\n      <NodePreview\n        v-if=\"hoveredSuggestion\"\n        :key=\"hoveredSuggestion?.name || ''\"\n        :node-def=\"hoveredSuggestion\"\n      />\n    </div>\n\n    <Button\n      icon=\"pi pi-filter\"\n      severity=\"secondary\"\n      class=\"filter-button z-10\"\n      @click=\"nodeSearchFilterVisible = true\"\n    />\n    <Dialog\n      v-model:visible=\"nodeSearchFilterVisible\"\n      class=\"min-w-96\"\n      dismissable-mask\n      modal\n      @hide=\"reFocusInput\"\n    >\n      <template #header>\n        <h3>{{ $t('g.addNodeFilterCondition') }}</h3>\n      </template>\n      <div class=\"_dialog-body\">\n        <NodeSearchFilter @add-filter=\"onAddFilter\" />\n      </div>\n    </Dialog>\n\n    <AutoCompletePlus\n      ref=\"autoCompletePlus\"\n      :model-value=\"filters\"\n      class=\"comfy-vue-node-search-box z-10 grow\"\n      scroll-height=\"40vh\"\n      :placeholder=\"placeholder\"\n      :input-id=\"inputId\"\n      append-to=\"self\"\n      :suggestions=\"suggestions\"\n      :delay=\"100\"\n      :loading=\"!nodeFrequencyStore.isLoaded\"\n      complete-on-focus\n      auto-option-focus\n      force-selection\n      multiple\n      :option-label=\"'display_name'\"\n      @complete=\"search($event.query)\"\n      @option-select=\"onAddNode($event.value)\"\n      @focused-option-changed=\"setHoverSuggestion($event)\"\n    >\n      <template #option=\"{ option }\">\n        <NodeSearchItem :node-def=\"option\" :current-query=\"currentQuery\" />\n      </template>\n      <!-- FilterAndValue -->\n      <template #chip=\"{ value }\">\n        <SearchFilterChip\n          v-if=\"value.filterDef && value.value\"\n          :key=\"`${value.filterDef.id}-${value.value}`\"\n          :text=\"value.value\"\n          :badge=\"value.filterDef.invokeSequence.toUpperCase()\"\n          :badge-class=\"value.filterDef.invokeSequence + '-badge'\"\n          @remove=\"\n            onRemoveFilter(\n              $event,\n              value as FuseFilterWithValue<ComfyNodeDefImpl, string>\n            )\n          \"\n        />\n      </template>\n    </AutoCompletePlus>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { debounce } from 'es-toolkit/compat'\nimport Button from 'primevue/button'\nimport Dialog from 'primevue/dialog'\nimport { computed, nextTick, onMounted, ref } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport NodePreview from '@/components/node/NodePreview.vue'\nimport AutoCompletePlus from '@/components/primevueOverride/AutoCompletePlus.vue'\nimport NodeSearchFilter from '@/components/searchbox/NodeSearchFilter.vue'\nimport NodeSearchItem from '@/components/searchbox/NodeSearchItem.vue'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useTelemetry } from '@/platform/telemetry'\nimport type { ComfyNodeDefImpl } from '@/stores/nodeDefStore'\nimport { useNodeDefStore, useNodeFrequencyStore } from '@/stores/nodeDefStore'\nimport type { FuseFilterWithValue } from '@/utils/fuseUtil'\n\nimport SearchFilterChip from '../common/SearchFilterChip.vue'\n\nconst settingStore = useSettingStore()\nconst { t } = useI18n()\nconst telemetry = useTelemetry()\n\nconst enableNodePreview = computed(() =>\n  settingStore.get('Comfy.NodeSearchBoxImpl.NodePreview')\n)\n\nconst { filters, searchLimit = 64 } = defineProps<{\n  filters: FuseFilterWithValue<ComfyNodeDefImpl, string>[]\n  searchLimit?: number\n}>()\n\nconst autoCompletePlus = ref()\nconst nodeSearchFilterVisible = ref(false)\nconst inputId = `comfy-vue-node-search-box-input-${Math.random()}`\nconst suggestions = ref<ComfyNodeDefImpl[]>([])\nconst hoveredSuggestion = ref<ComfyNodeDefImpl | null>(null)\nconst currentQuery = ref('')\nconst placeholder = computed(() => {\n  return filters.length === 0 ? t('g.searchNodes') + '...' : ''\n})\n\nconst nodeDefStore = useNodeDefStore()\nconst nodeFrequencyStore = useNodeFrequencyStore()\n\n// Debounced search tracking (500ms as per implementation plan)\nconst debouncedTrackSearch = debounce((query: string) => {\n  if (query.trim()) {\n    telemetry?.trackNodeSearch({ query })\n  }\n}, 500)\n\nconst search = (query: string) => {\n  const queryIsEmpty = query === '' && filters.length === 0\n  currentQuery.value = query\n  suggestions.value = queryIsEmpty\n    ? nodeFrequencyStore.topNodeDefs\n    : [\n        ...nodeDefStore.nodeSearchService.searchNode(query, filters, {\n          limit: searchLimit\n        })\n      ]\n\n  // Track search queries with debounce\n  debouncedTrackSearch(query)\n}\n\nconst emit = defineEmits(['addFilter', 'removeFilter', 'addNode'])\n\n// Track node selection and emit addNode event\nconst onAddNode = (nodeDef: ComfyNodeDefImpl) => {\n  telemetry?.trackNodeSearchResultSelected({\n    node_type: nodeDef.name,\n    last_query: currentQuery.value\n  })\n  emit('addNode', nodeDef)\n}\n\nlet inputElement: HTMLInputElement | null = null\nconst reFocusInput = async () => {\n  inputElement ??= document.getElementById(inputId) as HTMLInputElement\n  if (inputElement) {\n    inputElement.blur()\n    await nextTick(() => inputElement?.focus())\n  }\n}\n\nonMounted(() => {\n  inputElement ??= document.getElementById(inputId) as HTMLInputElement\n  if (inputElement) inputElement.focus()\n  autoCompletePlus.value.hide = () => search('')\n  search('')\n  autoCompletePlus.value.show()\n})\nconst onAddFilter = (\n  filterAndValue: FuseFilterWithValue<ComfyNodeDefImpl, string>\n) => {\n  nodeSearchFilterVisible.value = false\n  emit('addFilter', filterAndValue)\n}\nconst onRemoveFilter = async (\n  event: Event,\n  filterAndValue: FuseFilterWithValue<ComfyNodeDefImpl, string>\n) => {\n  event.stopPropagation()\n  event.preventDefault()\n  emit('removeFilter', filterAndValue)\n  await reFocusInput()\n}\nconst setHoverSuggestion = (index: number) => {\n  if (index === -1) {\n    hoveredSuggestion.value = null\n    return\n  }\n  const value = suggestions.value[index]\n  hoveredSuggestion.value = value\n}\n</script>\n","<template>\n  <div>\n    <Dialog\n      v-model:visible=\"visible\"\n      modal\n      :dismissable-mask=\"dismissable\"\n      :pt=\"{\n        root: {\n          class: 'invisible-dialog-root',\n          role: 'search'\n        },\n        mask: { class: 'node-search-box-dialog-mask' },\n        transition: {\n          enterFromClass: 'opacity-0 scale-75',\n          // 100ms is the duration of the transition in the dialog component\n          enterActiveClass: 'transition-all duration-100 ease-out',\n          leaveActiveClass: 'transition-all duration-100 ease-in',\n          leaveToClass: 'opacity-0 scale-75'\n        }\n      }\"\n      @hide=\"clearFilters\"\n    >\n      <template #container>\n        <NodeSearchBox\n          :filters=\"nodeFilters\"\n          @add-filter=\"addFilter\"\n          @remove-filter=\"removeFilter\"\n          @add-node=\"addNode\"\n        />\n      </template>\n    </Dialog>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useEventListener } from '@vueuse/core'\nimport { storeToRefs } from 'pinia'\nimport Dialog from 'primevue/dialog'\nimport { computed, ref, toRaw, watch, watchEffect } from 'vue'\n\nimport type { Point } from '@/lib/litegraph/src/interfaces'\nimport type { LiteGraphCanvasEvent } from '@/lib/litegraph/src/litegraph'\nimport { LGraphNode, LiteGraph } from '@/lib/litegraph/src/litegraph'\nimport type { CanvasPointerEvent } from '@/lib/litegraph/src/types/events'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useLitegraphService } from '@/services/litegraphService'\nimport type { ComfyNodeDefImpl } from '@/stores/nodeDefStore'\nimport { useNodeDefStore } from '@/stores/nodeDefStore'\nimport { useSearchBoxStore } from '@/stores/workspace/searchBoxStore'\nimport { LinkReleaseTriggerAction } from '@/types/searchBoxTypes'\nimport type { FuseFilterWithValue } from '@/utils/fuseUtil'\n\nimport NodeSearchBox from './NodeSearchBox.vue'\n\nlet triggerEvent: CanvasPointerEvent | null = null\nlet listenerController: AbortController | null = null\nlet disconnectOnReset = false\n\nconst settingStore = useSettingStore()\nconst searchBoxStore = useSearchBoxStore()\nconst litegraphService = useLitegraphService()\n\nconst { visible, newSearchBoxEnabled } = storeToRefs(searchBoxStore)\nconst dismissable = ref(true)\nfunction getNewNodeLocation(): Point {\n  return triggerEvent\n    ? [triggerEvent.canvasX, triggerEvent.canvasY]\n    : litegraphService.getCanvasCenter()\n}\nconst nodeFilters = ref<FuseFilterWithValue<ComfyNodeDefImpl, string>[]>([])\nfunction addFilter(filter: FuseFilterWithValue<ComfyNodeDefImpl, string>) {\n  nodeFilters.value.push(filter)\n}\nfunction removeFilter(filter: FuseFilterWithValue<ComfyNodeDefImpl, string>) {\n  nodeFilters.value = nodeFilters.value.filter(\n    (f) => toRaw(f) !== toRaw(filter)\n  )\n}\nfunction clearFilters() {\n  nodeFilters.value = []\n}\nfunction closeDialog() {\n  visible.value = false\n}\nconst canvasStore = useCanvasStore()\n\nfunction addNode(nodeDef: ComfyNodeDefImpl) {\n  const node = litegraphService.addNodeOnGraph(nodeDef, {\n    pos: getNewNodeLocation()\n  })\n\n  if (disconnectOnReset && triggerEvent) {\n    canvasStore.getCanvas().linkConnector.connectToNode(node, triggerEvent)\n  } else if (!triggerEvent) {\n    console.warn('The trigger event was undefined when addNode was called.')\n  }\n\n  disconnectOnReset = false\n\n  // Notify changeTracker - new step should be added\n  useWorkflowStore().activeWorkflow?.changeTracker?.checkState()\n  window.requestAnimationFrame(closeDialog)\n}\n\nfunction showSearchBox(e: CanvasPointerEvent | null) {\n  if (newSearchBoxEnabled.value) {\n    if (e?.pointerType === 'touch') {\n      setTimeout(() => {\n        showNewSearchBox(e)\n      }, 128)\n    } else {\n      showNewSearchBox(e)\n    }\n  } else {\n    canvasStore.getCanvas().showSearchBox(e)\n  }\n}\n\nfunction getFirstLink() {\n  return canvasStore.getCanvas().linkConnector.renderLinks.at(0)\n}\n\nconst nodeDefStore = useNodeDefStore()\nfunction showNewSearchBox(e: CanvasPointerEvent | null) {\n  const firstLink = getFirstLink()\n  if (firstLink) {\n    const filter =\n      firstLink.toType === 'input'\n        ? nodeDefStore.nodeSearchService.inputTypeFilter\n        : nodeDefStore.nodeSearchService.outputTypeFilter\n\n    const dataType = firstLink.fromSlot.type?.toString() ?? ''\n    addFilter({\n      filterDef: filter,\n      value: dataType\n    })\n  }\n\n  visible.value = true\n  triggerEvent = e\n\n  // Prevent the dialog from being dismissed immediately\n  dismissable.value = false\n  setTimeout(() => {\n    dismissable.value = true\n  }, 300)\n}\n\nfunction showContextMenu(e: CanvasPointerEvent) {\n  const firstLink = getFirstLink()\n  if (!firstLink) return\n\n  const { node, fromSlot, toType } = firstLink\n  const commonOptions = {\n    e,\n    allow_searchbox: true,\n    showSearchBox: () => {\n      cancelResetOnContextClose()\n      showSearchBox(e)\n    }\n  }\n  const afterRerouteId = firstLink.fromReroute?.id\n  const connectionOptions =\n    toType === 'input'\n      ? { nodeFrom: node, slotFrom: fromSlot, afterRerouteId }\n      : { nodeTo: node, slotTo: fromSlot, afterRerouteId }\n\n  const canvas = canvasStore.getCanvas()\n  const menu = canvas.showConnectionMenu({\n    ...connectionOptions,\n    ...commonOptions\n  })\n\n  if (!menu) {\n    console.warn('No menu was returned from showConnectionMenu')\n    return\n  }\n\n  triggerEvent = e\n  listenerController = new AbortController()\n  const { signal } = listenerController\n  const options = { once: true, signal }\n\n  // Connect the node after it is created via context menu\n  useEventListener(\n    canvas.canvas,\n    'connect-new-default-node',\n    (createEvent) => {\n      if (!(createEvent instanceof CustomEvent))\n        throw new Error('Invalid event')\n\n      const node: unknown = createEvent.detail?.node\n      if (!(node instanceof LGraphNode)) throw new Error('Invalid node')\n\n      disconnectOnReset = false\n      createEvent.preventDefault()\n      canvas.linkConnector.connectToNode(node, e)\n    },\n    options\n  )\n\n  // Reset when the context menu is closed\n  const cancelResetOnContextClose = useEventListener(\n    menu.controller.signal,\n    'abort',\n    reset,\n    options\n  )\n}\n\n// Disable litegraph's default behavior of release link and search box.\nwatchEffect(() => {\n  const { canvas } = canvasStore\n  if (!canvas) return\n\n  LiteGraph.release_link_on_empty_shows_menu = false\n  canvas.allow_searchbox = false\n\n  useEventListener(\n    canvas.linkConnector.events,\n    'dropped-on-canvas',\n    handleDroppedOnCanvas\n  )\n})\n\nfunction canvasEventHandler(e: LiteGraphCanvasEvent) {\n  if (e.detail.subType === 'empty-double-click') {\n    showSearchBox(e.detail.originalEvent)\n  } else if (e.detail.subType === 'group-double-click') {\n    const group = e.detail.group\n    const [_, y] = group.pos\n    const relativeY = e.detail.originalEvent.canvasY - y\n    // Show search box if the click is NOT on the title bar\n    if (relativeY > group.titleHeight) {\n      showSearchBox(e.detail.originalEvent)\n    }\n  }\n}\n\nconst linkReleaseAction = computed(() =>\n  settingStore.get('Comfy.LinkRelease.Action')\n)\n\nconst linkReleaseActionShift = computed(() =>\n  settingStore.get('Comfy.LinkRelease.ActionShift')\n)\n\n// Prevent normal LinkConnector reset (called by CanvasPointer.finally)\nfunction preventDefault(e: Event) {\n  return e.preventDefault()\n}\nfunction cancelNextReset(e: CustomEvent<CanvasPointerEvent>) {\n  e.preventDefault()\n\n  const canvas = canvasStore.getCanvas()\n  canvas.linkConnector.state.snapLinksPos = [e.detail.canvasX, e.detail.canvasY]\n  useEventListener(canvas.linkConnector.events, 'reset', preventDefault, {\n    once: true\n  })\n}\n\nfunction handleDroppedOnCanvas(e: CustomEvent<CanvasPointerEvent>) {\n  disconnectOnReset = true\n  const action = e.detail.shiftKey\n    ? linkReleaseActionShift.value\n    : linkReleaseAction.value\n  switch (action) {\n    case LinkReleaseTriggerAction.SEARCH_BOX:\n      cancelNextReset(e)\n      showSearchBox(e.detail)\n      break\n    case LinkReleaseTriggerAction.CONTEXT_MENU:\n      cancelNextReset(e)\n      showContextMenu(e.detail)\n      break\n    case LinkReleaseTriggerAction.NO_ACTION:\n    default:\n      break\n  }\n}\n\n// Resets litegraph state\nfunction reset() {\n  listenerController?.abort()\n  listenerController = null\n  triggerEvent = null\n\n  const canvas = canvasStore.getCanvas()\n  canvas.linkConnector.events.removeEventListener('reset', preventDefault)\n  if (disconnectOnReset) canvas.linkConnector.disconnectLinks()\n\n  canvas.linkConnector.reset()\n  canvas.setDirty(true, true)\n}\n\n// Reset connecting links when the search box is closed\nwatch(visible, () => {\n  if (!visible.value) reset()\n})\n\nuseEventListener(document, 'litegraph:canvas', canvasEventHandler)\ndefineExpose({ showSearchBox })\n</script>\n\n<style>\n.invisible-dialog-root {\n  width: 60%;\n  min-width: 24rem;\n  max-width: 48rem;\n  border: 0 !important;\n  background-color: transparent !important;\n  margin-top: 25vh;\n  margin-left: 400px;\n}\n@media all and (max-width: 768px) {\n  .invisible-dialog-root {\n    margin-left: 0;\n  }\n}\n\n.node-search-box-dialog-mask {\n  align-items: flex-start !important;\n}\n</style>\n","<template>\n  <svg\n    :class=\"iconClass\"\n    :width=\"size\"\n    :height=\"size\"\n    viewBox=\"0 0 18 18\"\n    xmlns=\"http://www.w3.org/2000/svg\"\n  >\n    <path\n      d=\"M14.8193 0.600586C15.1248 0.600586 15.3296 0.70893 15.459 0.881836C15.5914 1.05888 15.6471 1.33774 15.5527 1.66895L14.8037 4.30176C14.7063 4.64386 14.4729 4.97024 14.1641 5.21191C13.8544 5.45415 13.496 5.58984 13.1699 5.58984H13.1689L9.5791 5.59668H7.90625C7.52654 5.59668 7.19496 5.84986 7.09082 6.21289L5.69434 11.0889C5.63007 11.3133 5.66134 11.5534 5.77734 11.7529L5.83203 11.8359C5.99177 12.0491 6.24252 12.1758 6.50977 12.1758H6.51074L8.88281 12.1709H11.4971C11.7643 12.171 11.9541 12.254 12.084 12.3906L12.1357 12.4521C12.2685 12.6295 12.3249 12.9089 12.2305 13.2402L11.4805 15.8721C11.383 16.2144 11.1498 16.5415 10.8408 16.7832C10.5314 17.0252 10.1736 17.161 9.84766 17.1611H9.84668L6.25684 17.168H3.64258C3.33762 17.1679 3.13349 17.0588 3.00391 16.8857C2.87135 16.7087 2.81482 16.43 2.90918 16.0986L3.39551 14.3887C3.46841 14.1327 3.41794 13.8576 3.25879 13.6445V13.6436C3.09901 13.4303 2.84745 13.3037 2.58008 13.3037H1.18066C0.875088 13.3037 0.670398 13.1953 0.541016 13.0225C0.408483 12.8451 0.351891 12.5655 0.446289 12.2344L2.11914 6.38965L2.30371 5.74707V5.74609C2.40139 5.40341 2.63456 5.07671 2.94336 4.83496C3.25302 4.59258 3.61143 4.45705 3.9375 4.45703H5.6123C5.94484 4.45703 6.24083 4.26316 6.37891 3.9707L6.42773 3.83984L6.98145 1.89551C7.07894 1.55317 7.31212 1.22614 7.62109 0.984375C7.93074 0.742127 8.2892 0.606445 8.61523 0.606445H8.61621L12.1982 0.600586H14.8193Z\"\n      v-bind=\"attributes\"\n    />\n  </svg>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\n\ninterface Props {\n  size?: number | string\n  color?: string\n  class?: string\n  mode?: 'outline' | 'fill'\n}\nconst {\n  size = 16,\n  color = 'currentColor',\n  mode = 'outline',\n  class: className\n} = defineProps<Props>()\nconst iconClass = computed(() => className || '')\nconst attributes = computed(() => ({\n  stroke: mode === 'outline' ? color : undefined,\n  strokeWidth: mode === 'outline' ? 1 : undefined,\n  fill: mode === 'fill' ? color : 'none'\n}))\n</script>\n","<template>\n  <div\n    class=\"relative aspect-square w-full overflow-hidden rounded-t-lg select-none\"\n  >\n    <div\n      v-if=\"!error\"\n      ref=\"contentRef\"\n      class=\"h-full w-full transform-gpu transition-transform duration-1000 ease-out\"\n      :style=\"\n        isHovered ? { transform: `scale(${1 + hoverZoom / 100})` } : undefined\n      \"\n    >\n      <slot />\n    </div>\n    <div v-else class=\"flex h-full w-full items-center justify-center\">\n      <img\n        src=\"/assets/images/default-template.png\"\n        draggable=\"false\"\n        class=\"h-full w-full transform-gpu object-cover transition-transform duration-300 ease-out\"\n      />\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useEventListener } from '@vueuse/core'\nimport { onMounted, ref } from 'vue'\n\nconst error = ref(false)\nconst contentRef = ref<HTMLElement | null>(null)\n\nconst { hoverZoom = 4 } = defineProps<{\n  hoverZoom?: number\n  isHovered?: boolean\n}>()\n\nonMounted(() => {\n  const images = Array.from(contentRef.value?.getElementsByTagName('img') ?? [])\n  images.forEach((img) => {\n    useEventListener(img, 'error', () => {\n      error.value = true\n    })\n  })\n})\n</script>\n<style scoped>\nimg {\n  transition: transform 1s cubic-bezier(0.2, 0, 0.4, 1);\n}\n</style>\n","<template>\n  <BaseThumbnail :is-hovered=\"isHovered\">\n    <LazyImage\n      :src=\"baseImageSrc\"\n      :alt=\"alt\"\n      :image-class=\"\n        isVideoType\n          ? 'w-full h-full object-cover'\n          : 'max-w-full max-h-64 object-contain'\n      \"\n    />\n    <div ref=\"containerRef\" class=\"absolute inset-0\">\n      <LazyImage\n        :src=\"overlayImageSrc\"\n        :alt=\"alt\"\n        :image-class=\"\n          isVideoType\n            ? 'w-full h-full object-cover'\n            : 'max-w-full max-h-64 object-contain'\n        \"\n        :image-style=\"{\n          clipPath: `inset(0 ${100 - sliderPosition}% 0 0)`\n        }\"\n      />\n      <div\n        class=\"pointer-events-none absolute inset-y-0 z-10 w-0.5 bg-white/30 backdrop-blur-sm\"\n        :style=\"{\n          left: `${sliderPosition}%`\n        }\"\n      />\n    </div>\n  </BaseThumbnail>\n</template>\n\n<script setup lang=\"ts\">\nimport { useMouseInElement } from '@vueuse/core'\nimport { ref, watch } from 'vue'\n\nimport LazyImage from '@/components/common/LazyImage.vue'\nimport BaseThumbnail from '@/components/templates/thumbnails/BaseThumbnail.vue'\n\nconst SLIDER_START_POSITION = 50\n\nconst { baseImageSrc, overlayImageSrc, isHovered, isVideo } = defineProps<{\n  baseImageSrc: string\n  overlayImageSrc: string\n  alt: string\n  isHovered?: boolean\n  isVideo?: boolean\n}>()\n\nconst isVideoType =\n  isVideo ||\n  baseImageSrc?.toLowerCase().endsWith('.webp') ||\n  overlayImageSrc?.toLowerCase().endsWith('.webp') ||\n  false\n\nconst sliderPosition = ref(SLIDER_START_POSITION)\nconst containerRef = ref<HTMLElement | null>(null)\n\nconst { elementX, elementWidth, isOutside } = useMouseInElement(containerRef)\n\n// Update slider position based on mouse position when hovered\nwatch(\n  [() => isHovered, elementX, elementWidth, isOutside],\n  ([isHovered, x, width, outside]) => {\n    if (!isHovered) return\n    if (!outside) {\n      sliderPosition.value = (x / width) * 100\n    }\n  }\n)\n</script>\n","<template>\n  <BaseThumbnail :hover-zoom=\"hoverZoom\" :is-hovered=\"isHovered\">\n    <LazyImage\n      :src=\"src\"\n      :alt=\"alt\"\n      :image-class=\"[\n        'transform-gpu transition-transform duration-300 ease-out',\n        isVideoType\n          ? 'w-full h-full object-cover'\n          : 'max-w-full max-h-64 object-contain'\n      ]\"\n      :image-style=\"\n        isHovered ? { transform: `scale(${1 + hoverZoom / 100})` } : undefined\n      \"\n    />\n  </BaseThumbnail>\n</template>\n\n<script setup lang=\"ts\">\nimport LazyImage from '@/components/common/LazyImage.vue'\nimport BaseThumbnail from '@/components/templates/thumbnails/BaseThumbnail.vue'\n\nconst { src, isVideo } = defineProps<{\n  src: string\n  alt: string\n  hoverZoom: number\n  isHovered?: boolean\n  isVideo?: boolean\n}>()\n\nconst isVideoType = isVideo ?? (src?.toLowerCase().endsWith('.webp') || false)\n</script>\n","<template>\n  <BaseThumbnail :is-hovered=\"isHovered\">\n    <div class=\"relative h-full w-full\">\n      <div class=\"absolute inset-0\">\n        <LazyImage\n          :src=\"baseImageSrc\"\n          :alt=\"alt\"\n          :image-class=\"baseImageClass\"\n        />\n      </div>\n      <div class=\"absolute inset-0 z-10\">\n        <LazyImage\n          :src=\"overlayImageSrc\"\n          :alt=\"alt\"\n          :image-class=\"overlayImageClass\"\n        />\n      </div>\n    </div>\n  </BaseThumbnail>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\n\nimport LazyImage from '@/components/common/LazyImage.vue'\nimport BaseThumbnail from '@/components/templates/thumbnails/BaseThumbnail.vue'\n\nconst { baseImageSrc, overlayImageSrc, isVideo, isHovered } = defineProps<{\n  baseImageSrc: string\n  overlayImageSrc: string\n  alt: string\n  isHovered: boolean\n  isVideo?: boolean\n}>()\n\nconst isVideoType =\n  isVideo ||\n  baseImageSrc?.toLowerCase().endsWith('.webp') ||\n  overlayImageSrc?.toLowerCase().endsWith('.webp') ||\n  false\n\nconst baseImageClass = computed(() => {\n  const sizeClasses = isVideoType\n    ? 'size-full object-cover'\n    : 'size-full object-contain'\n  return sizeClasses\n})\n\nconst overlayImageClass = computed(() => {\n  const baseClasses = 'size-full transition-opacity duration-300'\n  const sizeClasses = isVideoType ? 'object-cover' : 'object-contain'\n  const opacityClasses = isHovered ? 'opacity-100' : 'opacity-0'\n  return `${baseClasses} ${sizeClasses} ${opacityClasses}`\n})\n</script>\n","import { computed, ref, shallowRef, watch } from 'vue'\nimport type { Ref } from 'vue'\n\ninterface LazyPaginationOptions {\n  itemsPerPage?: number\n  initialPage?: number\n}\n\nexport function useLazyPagination<T>(\n  items: Ref<T[]> | T[],\n  options: LazyPaginationOptions = {}\n) {\n  const { itemsPerPage = 12, initialPage = 1 } = options\n\n  const currentPage = ref(initialPage)\n  const isLoading = ref(false)\n  const loadedPages = shallowRef(new Set<number>([]))\n\n  // Get reactive items array\n  const itemsArray = computed(() => {\n    const itemData = 'value' in items ? items.value : items\n    return Array.isArray(itemData) ? itemData : []\n  })\n\n  // Simulate pagination by slicing the items\n  const paginatedItems = computed(() => {\n    const itemData = itemsArray.value\n    if (itemData.length === 0) {\n      return []\n    }\n\n    const loadedPageNumbers = Array.from(loadedPages.value).sort(\n      (a, b) => a - b\n    )\n    const maxLoadedPage = Math.max(...loadedPageNumbers, 0)\n    const endIndex = maxLoadedPage * itemsPerPage\n    return itemData.slice(0, endIndex)\n  })\n\n  const hasMoreItems = computed(() => {\n    const itemData = itemsArray.value\n    if (itemData.length === 0) {\n      return false\n    }\n\n    const loadedPagesArray = Array.from(loadedPages.value)\n    const maxLoadedPage = Math.max(...loadedPagesArray, 0)\n    return maxLoadedPage * itemsPerPage < itemData.length\n  })\n\n  const totalPages = computed(() => {\n    const itemData = itemsArray.value\n    if (itemData.length === 0) {\n      return 0\n    }\n    return Math.ceil(itemData.length / itemsPerPage)\n  })\n\n  const loadNextPage = async () => {\n    if (isLoading.value || !hasMoreItems.value) return\n\n    isLoading.value = true\n    const loadedPagesArray = Array.from(loadedPages.value)\n    const nextPage = Math.max(...loadedPagesArray, 0) + 1\n\n    // Simulate network delay\n    // await new Promise((resolve) => setTimeout(resolve, 5000))\n\n    const newLoadedPages = new Set(loadedPages.value)\n    newLoadedPages.add(nextPage)\n    loadedPages.value = newLoadedPages\n    currentPage.value = nextPage\n    isLoading.value = false\n  }\n\n  // Initialize with first page\n  watch(\n    () => itemsArray.value.length,\n    (length) => {\n      if (length > 0 && loadedPages.value.size === 0) {\n        loadedPages.value = new Set([1])\n      }\n    },\n    { immediate: true }\n  )\n\n  const reset = () => {\n    currentPage.value = initialPage\n    loadedPages.value = new Set([])\n    isLoading.value = false\n\n    // Immediately load first page if we have items\n    const itemData = itemsArray.value\n    if (itemData.length > 0) {\n      loadedPages.value = new Set([1])\n    }\n  }\n\n  return {\n    paginatedItems,\n    isLoading,\n    hasMoreItems,\n    currentPage,\n    totalPages,\n    loadNextPage,\n    reset\n  }\n}\n","import { refDebounced, watchDebounced } from '@vueuse/core'\nimport Fuse from 'fuse.js'\nimport { computed, ref, watch } from 'vue'\nimport type { Ref } from 'vue'\n\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useTelemetry } from '@/platform/telemetry'\nimport type { TemplateInfo } from '@/platform/workflow/templates/types/template'\nimport { debounce } from 'es-toolkit/compat'\n\nexport function useTemplateFiltering(\n  templates: Ref<TemplateInfo[]> | TemplateInfo[]\n) {\n  const settingStore = useSettingStore()\n\n  const searchQuery = ref('')\n  const selectedModels = ref<string[]>(\n    settingStore.get('Comfy.Templates.SelectedModels')\n  )\n  const selectedUseCases = ref<string[]>(\n    settingStore.get('Comfy.Templates.SelectedUseCases')\n  )\n  const selectedRunsOn = ref<string[]>(\n    settingStore.get('Comfy.Templates.SelectedRunsOn')\n  )\n  const sortBy = ref<\n    | 'default'\n    | 'alphabetical'\n    | 'newest'\n    | 'vram-low-to-high'\n    | 'model-size-low-to-high'\n  >(settingStore.get('Comfy.Templates.SortBy'))\n\n  const templatesArray = computed(() => {\n    const templateData = 'value' in templates ? templates.value : templates\n    return Array.isArray(templateData) ? templateData : []\n  })\n\n  // Fuse.js configuration for fuzzy search\n  const fuseOptions = {\n    keys: [\n      { name: 'name', weight: 0.3 },\n      { name: 'title', weight: 0.3 },\n      { name: 'description', weight: 0.2 },\n      { name: 'tags', weight: 0.1 },\n      { name: 'models', weight: 0.1 }\n    ],\n    threshold: 0.4,\n    includeScore: true,\n    includeMatches: true\n  }\n\n  const fuse = computed(() => new Fuse(templatesArray.value, fuseOptions))\n\n  const availableModels = computed(() => {\n    const modelSet = new Set<string>()\n    templatesArray.value.forEach((template) => {\n      if (Array.isArray(template.models)) {\n        template.models.forEach((model) => modelSet.add(model))\n      }\n    })\n    return Array.from(modelSet).sort()\n  })\n\n  const availableUseCases = computed(() => {\n    const tagSet = new Set<string>()\n    templatesArray.value.forEach((template) => {\n      if (template.tags && Array.isArray(template.tags)) {\n        template.tags.forEach((tag) => tagSet.add(tag))\n      }\n    })\n    return Array.from(tagSet).sort()\n  })\n\n  const availableRunsOn = computed(() => {\n    return ['ComfyUI', 'External or Remote API']\n  })\n\n  const debouncedSearchQuery = refDebounced(searchQuery, 50)\n\n  const filteredBySearch = computed(() => {\n    if (!debouncedSearchQuery.value.trim()) {\n      return templatesArray.value\n    }\n\n    const results = fuse.value.search(debouncedSearchQuery.value)\n    return results.map((result) => result.item)\n  })\n\n  const filteredByModels = computed(() => {\n    if (selectedModels.value.length === 0) {\n      return filteredBySearch.value\n    }\n\n    return filteredBySearch.value.filter((template) => {\n      if (!template.models || !Array.isArray(template.models)) {\n        return false\n      }\n      return selectedModels.value.some((selectedModel) =>\n        template.models?.includes(selectedModel)\n      )\n    })\n  })\n\n  const filteredByUseCases = computed(() => {\n    if (selectedUseCases.value.length === 0) {\n      return filteredByModels.value\n    }\n\n    return filteredByModels.value.filter((template) => {\n      if (!template.tags || !Array.isArray(template.tags)) {\n        return false\n      }\n      return selectedUseCases.value.some((selectedTag) =>\n        template.tags?.includes(selectedTag)\n      )\n    })\n  })\n\n  const filteredByRunsOn = computed(() => {\n    if (selectedRunsOn.value.length === 0) {\n      return filteredByUseCases.value\n    }\n\n    return filteredByUseCases.value.filter((template) => {\n      // Use openSource field to determine where template runs\n      // openSource === false -> External/Remote API\n      // openSource !== false -> ComfyUI (includes true and undefined)\n      const isExternalAPI = template.openSource === false\n      const isComfyUI = template.openSource !== false\n\n      return selectedRunsOn.value.some((selectedRunsOn) => {\n        if (selectedRunsOn === 'External or Remote API') {\n          return isExternalAPI\n        } else if (selectedRunsOn === 'ComfyUI') {\n          return isComfyUI\n        }\n        return false\n      })\n    })\n  })\n\n  const getVramMetric = (template: TemplateInfo) => {\n    if (\n      typeof template.vram === 'number' &&\n      Number.isFinite(template.vram) &&\n      template.vram > 0\n    ) {\n      return template.vram\n    }\n    return Number.POSITIVE_INFINITY\n  }\n\n  const sortedTemplates = computed(() => {\n    const templates = [...filteredByRunsOn.value]\n\n    switch (sortBy.value) {\n      case 'alphabetical':\n        return templates.sort((a, b) => {\n          const nameA = a.title || a.name || ''\n          const nameB = b.title || b.name || ''\n          return nameA.localeCompare(nameB)\n        })\n      case 'newest':\n        return templates.sort((a, b) => {\n          const dateA = new Date(a.date || '1970-01-01')\n          const dateB = new Date(b.date || '1970-01-01')\n          return dateB.getTime() - dateA.getTime()\n        })\n      case 'vram-low-to-high':\n        return templates.sort((a, b) => {\n          const vramA = getVramMetric(a)\n          const vramB = getVramMetric(b)\n\n          if (vramA === vramB) {\n            const nameA = a.title || a.name || ''\n            const nameB = b.title || b.name || ''\n            return nameA.localeCompare(nameB)\n          }\n\n          if (vramA === Number.POSITIVE_INFINITY) return 1\n          if (vramB === Number.POSITIVE_INFINITY) return -1\n\n          return vramA - vramB\n        })\n      case 'model-size-low-to-high':\n        return templates.sort((a: any, b: any) => {\n          const sizeA =\n            typeof a.size === 'number' ? a.size : Number.POSITIVE_INFINITY\n          const sizeB =\n            typeof b.size === 'number' ? b.size : Number.POSITIVE_INFINITY\n          if (sizeA === sizeB) return 0\n          return sizeA - sizeB\n        })\n      case 'default':\n      default:\n        // Keep original order (default order)\n        return templates\n    }\n  })\n\n  const filteredTemplates = computed(() => sortedTemplates.value)\n\n  const resetFilters = () => {\n    searchQuery.value = ''\n    selectedModels.value = []\n    selectedUseCases.value = []\n    selectedRunsOn.value = []\n    sortBy.value = 'newest'\n  }\n\n  const removeModelFilter = (model: string) => {\n    selectedModels.value = selectedModels.value.filter((m) => m !== model)\n  }\n\n  const removeUseCaseFilter = (tag: string) => {\n    selectedUseCases.value = selectedUseCases.value.filter((t) => t !== tag)\n  }\n\n  const removeRunsOnFilter = (runsOn: string) => {\n    selectedRunsOn.value = selectedRunsOn.value.filter((r) => r !== runsOn)\n  }\n\n  const filteredCount = computed(() => filteredTemplates.value.length)\n  const totalCount = computed(() => templatesArray.value.length)\n\n  // Template filter tracking (debounced to avoid excessive events)\n  const debouncedTrackFilterChange = debounce(() => {\n    useTelemetry()?.trackTemplateFilterChanged({\n      search_query: searchQuery.value || undefined,\n      selected_models: selectedModels.value,\n      selected_use_cases: selectedUseCases.value,\n      selected_runs_on: selectedRunsOn.value,\n      sort_by: sortBy.value,\n      filtered_count: filteredCount.value,\n      total_count: totalCount.value\n    })\n  }, 500)\n\n  // Watch for filter changes and track them\n  watch(\n    [searchQuery, selectedModels, selectedUseCases, selectedRunsOn, sortBy],\n    () => {\n      // Only track if at least one filter is active (to avoid tracking initial state)\n      const hasActiveFilters =\n        searchQuery.value.trim() !== '' ||\n        selectedModels.value.length > 0 ||\n        selectedUseCases.value.length > 0 ||\n        selectedRunsOn.value.length > 0 ||\n        sortBy.value !== 'default'\n\n      if (hasActiveFilters) {\n        debouncedTrackFilterChange()\n      }\n    },\n    { deep: true }\n  )\n\n  // Persist filter changes to settings (debounced to avoid excessive saves)\n  watchDebounced(\n    selectedModels,\n    (newValue) => {\n      void settingStore.set('Comfy.Templates.SelectedModels', newValue)\n    },\n    { debounce: 500, deep: true }\n  )\n\n  watchDebounced(\n    selectedUseCases,\n    (newValue) => {\n      void settingStore.set('Comfy.Templates.SelectedUseCases', newValue)\n    },\n    { debounce: 500, deep: true }\n  )\n\n  watchDebounced(\n    selectedRunsOn,\n    (newValue) => {\n      void settingStore.set('Comfy.Templates.SelectedRunsOn', newValue)\n    },\n    { debounce: 500, deep: true }\n  )\n\n  watchDebounced(\n    sortBy,\n    (newValue) => {\n      void settingStore.set('Comfy.Templates.SortBy', newValue)\n    },\n    { debounce: 500 }\n  )\n\n  return {\n    // State\n    searchQuery,\n    selectedModels,\n    selectedUseCases,\n    selectedRunsOn,\n    sortBy,\n\n    // Computed\n    filteredTemplates,\n    availableModels,\n    availableUseCases,\n    availableRunsOn,\n    filteredCount,\n    totalCount,\n\n    // Methods\n    resetFilters,\n    removeModelFilter,\n    removeUseCaseFilter,\n    removeRunsOnFilter\n  }\n}\n","import { computed, ref } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport { isCloud } from '@/platform/distribution/types'\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useWorkflowTemplatesStore } from '@/platform/workflow/templates/repositories/workflowTemplatesStore'\nimport type {\n  TemplateGroup,\n  TemplateInfo,\n  WorkflowTemplates\n} from '@/platform/workflow/templates/types/template'\nimport { api } from '@/scripts/api'\nimport { app } from '@/scripts/app'\nimport { useDialogStore } from '@/stores/dialogStore'\n\nexport function useTemplateWorkflows() {\n  const { t } = useI18n()\n  const workflowTemplatesStore = useWorkflowTemplatesStore()\n  const dialogStore = useDialogStore()\n\n  // State\n  const selectedTemplate = ref<WorkflowTemplates | null>(null)\n  const loadingTemplateId = ref<string | null>(null)\n\n  // Computed\n  const isTemplatesLoaded = computed(() => workflowTemplatesStore.isLoaded)\n  const allTemplateGroups = computed<TemplateGroup[]>(\n    () => workflowTemplatesStore.groupedTemplates\n  )\n\n  /**\n   * Loads all template workflows from the API\n   */\n  const loadTemplates = async () => {\n    if (!workflowTemplatesStore.isLoaded) {\n      await workflowTemplatesStore.loadWorkflowTemplates()\n    }\n    return workflowTemplatesStore.isLoaded\n  }\n\n  /**\n   * Selects the first template category as default\n   */\n  const selectFirstTemplateCategory = () => {\n    if (allTemplateGroups.value.length > 0) {\n      const firstCategory = allTemplateGroups.value[0].modules[0]\n      selectTemplateCategory(firstCategory)\n    }\n  }\n\n  /**\n   * Selects a template category\n   */\n  const selectTemplateCategory = (category: WorkflowTemplates | null) => {\n    selectedTemplate.value = category\n    return category !== null\n  }\n\n  /**\n   * Gets template thumbnail URL\n   */\n  const getTemplateThumbnailUrl = (\n    template: TemplateInfo,\n    sourceModule: string,\n    index = '1'\n  ) => {\n    const basePath =\n      sourceModule === 'default'\n        ? api.fileURL(`/templates/${template.name}`)\n        : api.apiURL(`/workflow_templates/${sourceModule}/${template.name}`)\n\n    const indexSuffix = sourceModule === 'default' && index ? `-${index}` : ''\n    return `${basePath}${indexSuffix}.${template.mediaSubtype}`\n  }\n\n  /**\n   * Gets formatted template title\n   */\n  const getTemplateTitle = (template: TemplateInfo, sourceModule: string) => {\n    const fallback =\n      template.title ?? template.name ?? `${sourceModule} Template`\n    return sourceModule === 'default'\n      ? (template.localizedTitle ?? fallback)\n      : fallback\n  }\n\n  /**\n   * Gets formatted template description\n   */\n  const getTemplateDescription = (template: TemplateInfo) => {\n    return (\n      (template.localizedDescription || template.description)\n        ?.replace(/[-_]/g, ' ')\n        .trim() ?? ''\n    )\n  }\n\n  /**\n   * Loads a workflow template\n   */\n  const loadWorkflowTemplate = async (id: string, sourceModule: string) => {\n    if (!isTemplatesLoaded.value) return false\n\n    loadingTemplateId.value = id\n    let json\n\n    try {\n      // Handle \"All\" category as a special case\n      if (sourceModule === 'all') {\n        // Find \"All\" category in the ComfyUI Examples group\n        const comfyExamplesGroup = allTemplateGroups.value.find(\n          (g) =>\n            g.label ===\n            t('templateWorkflows.category.ComfyUI Examples', 'ComfyUI Examples')\n        )\n        const allCategory = comfyExamplesGroup?.modules.find(\n          (m) => m.moduleName === 'all'\n        )\n        const template = allCategory?.templates.find((t) => t.name === id)\n\n        if (!template || !template.sourceModule) return false\n\n        // Use the stored source module for loading\n        const actualSourceModule = template.sourceModule\n        json = await fetchTemplateJson(id, actualSourceModule)\n\n        // Use source module for name\n        const workflowName =\n          actualSourceModule === 'default'\n            ? t(`templateWorkflows.template.${id}`, id)\n            : id\n\n        if (isCloud) {\n          useTelemetry()?.trackTemplate({\n            workflow_name: id,\n            template_source: actualSourceModule\n          })\n        }\n\n        dialogStore.closeDialog()\n        await app.loadGraphData(json, true, true, workflowName, {\n          openSource: 'template'\n        })\n\n        return true\n      }\n\n      // Regular case for normal categories\n      json = await fetchTemplateJson(id, sourceModule)\n\n      const workflowName =\n        sourceModule === 'default'\n          ? t(`templateWorkflows.template.${id}`, id)\n          : id\n\n      if (isCloud) {\n        useTelemetry()?.trackTemplate({\n          workflow_name: id,\n          template_source: sourceModule\n        })\n      }\n\n      dialogStore.closeDialog()\n      await app.loadGraphData(json, true, true, workflowName, {\n        openSource: 'template'\n      })\n\n      return true\n    } catch (error) {\n      console.error('Error loading workflow template:', error)\n      return false\n    } finally {\n      loadingTemplateId.value = null\n    }\n  }\n\n  /**\n   * Fetches template JSON from the appropriate endpoint\n   */\n  const fetchTemplateJson = async (id: string, sourceModule: string) => {\n    if (sourceModule === 'default') {\n      // Default templates provided by frontend are served on this separate endpoint\n      return fetch(api.fileURL(`/templates/${id}.json`)).then((r) => r.json())\n    } else {\n      return fetch(\n        api.apiURL(`/workflow_templates/${sourceModule}/${id}.json`)\n      ).then((r) => r.json())\n    }\n  }\n\n  return {\n    // State\n    selectedTemplate,\n    loadingTemplateId,\n\n    // Computed\n    isTemplatesLoaded,\n    allTemplateGroups,\n\n    // Methods\n    loadTemplates,\n    selectFirstTemplateCategory,\n    selectTemplateCategory,\n    getTemplateThumbnailUrl,\n    getTemplateTitle,\n    getTemplateDescription,\n    loadWorkflowTemplate\n  }\n}\n","<template>\n  <BaseModalLayout\n    :content-title=\"$t('templateWorkflows.title', 'Workflow Templates')\"\n    class=\"workflow-template-selector-dialog\"\n  >\n    <template #leftPanel>\n      <LeftSidePanel v-model=\"selectedNavItem\" :nav-items=\"navItems\">\n        <template #header-icon>\n          <i class=\"icon-[comfy--template]\" />\n        </template>\n        <template #header-title>\n          <span class=\"text-neutral text-base\">{{\n            $t('sideToolbar.templates', 'Templates')\n          }}</span>\n        </template>\n      </LeftSidePanel>\n    </template>\n\n    <template #header>\n      <SearchBox v-model=\"searchQuery\" size=\"lg\" class=\"max-w-[384px]\" />\n    </template>\n\n    <template #header-right-area>\n      <div class=\"flex gap-2\">\n        <IconTextButton\n          v-if=\"filteredCount !== totalCount\"\n          type=\"secondary\"\n          :label=\"$t('templateWorkflows.resetFilters', 'Clear Filters')\"\n          @click=\"resetFilters\"\n        >\n          <template #icon>\n            <i class=\"icon-[lucide--filter-x]\" />\n          </template>\n        </IconTextButton>\n      </div>\n    </template>\n\n    <template #contentFilter>\n      <div class=\"relative flex flex-wrap justify-between gap-2 px-6 pb-4\">\n        <div class=\"flex flex-wrap gap-2\">\n          <!-- Model Filter -->\n          <MultiSelect\n            v-model=\"selectedModelObjects\"\n            v-model:search-query=\"modelSearchText\"\n            class=\"w-[250px]\"\n            :label=\"modelFilterLabel\"\n            :options=\"modelOptions\"\n            :show-search-box=\"true\"\n            :show-selected-count=\"true\"\n            :show-clear-button=\"true\"\n          >\n            <template #icon>\n              <i class=\"icon-[lucide--cpu]\" />\n            </template>\n          </MultiSelect>\n\n          <!-- Use Case Filter -->\n          <MultiSelect\n            v-model=\"selectedUseCaseObjects\"\n            :label=\"useCaseFilterLabel\"\n            :options=\"useCaseOptions\"\n            :show-search-box=\"true\"\n            :show-selected-count=\"true\"\n            :show-clear-button=\"true\"\n          >\n            <template #icon>\n              <i class=\"icon-[lucide--target]\" />\n            </template>\n          </MultiSelect>\n\n          <!-- Runs On Filter -->\n          <MultiSelect\n            v-model=\"selectedRunsOnObjects\"\n            :label=\"runsOnFilterLabel\"\n            :options=\"runsOnOptions\"\n            :show-search-box=\"true\"\n            :show-selected-count=\"true\"\n            :show-clear-button=\"true\"\n          >\n            <template #icon>\n              <i class=\"icon-[lucide--server]\" />\n            </template>\n          </MultiSelect>\n        </div>\n\n        <!-- Sort Options -->\n        <div>\n          <SingleSelect\n            v-model=\"sortBy\"\n            :label=\"$t('templateWorkflows.sorting', 'Sort by')\"\n            :options=\"sortOptions\"\n            class=\"w-62.5\"\n          >\n            <template #icon>\n              <i class=\"icon-[lucide--arrow-up-down]\" />\n            </template>\n          </SingleSelect>\n        </div>\n      </div>\n      <div\n        v-if=\"!isLoading\"\n        class=\"text-neutral px-6 pt-4 pb-2 text-2xl font-semibold\"\n      >\n        <span>\n          {{ pageTitle }}\n        </span>\n      </div>\n    </template>\n\n    <template #content>\n      <!-- No Results State (only show when loaded and no results) -->\n      <div\n        v-if=\"!isLoading && filteredTemplates.length === 0\"\n        class=\"flex h-64 flex-col items-center justify-center text-neutral-500\"\n      >\n        <i class=\"mb-4 icon-[lucide--search] h-12 w-12 opacity-50\" />\n        <p class=\"mb-2 text-lg\">\n          {{ $t('templateWorkflows.noResults', 'No templates found') }}\n        </p>\n        <p class=\"text-sm\">\n          {{\n            $t(\n              'templateWorkflows.noResultsHint',\n              'Try adjusting your search or filters'\n            )\n          }}\n        </p>\n      </div>\n      <div v-else>\n        <!-- Title -->\n        <span\n          v-if=\"isLoading\"\n          class=\"inline-block h-8 w-48 animate-pulse rounded bg-dialog-surface\"\n        ></span>\n\n        <!-- Template Cards Grid -->\n        <div\n          :key=\"templateListKey\"\n          :style=\"gridStyle\"\n          data-testid=\"template-workflows-content\"\n        >\n          <!-- Loading Skeletons (show while loading initial data) -->\n          <CardContainer\n            v-for=\"n in isLoading ? 12 : 0\"\n            :key=\"`initial-skeleton-${n}`\"\n            size=\"compact\"\n            variant=\"ghost\"\n            rounded=\"lg\"\n            class=\"hover:bg-base-background\"\n          >\n            <template #top>\n              <CardTop ratio=\"landscape\">\n                <template #default>\n                  <div\n                    class=\"h-full w-full animate-pulse bg-dialog-surface\"\n                  ></div>\n                </template>\n              </CardTop>\n            </template>\n            <template #bottom>\n              <CardBottom>\n                <div class=\"px-4 py-3\">\n                  <div\n                    class=\"mb-2 h-6 animate-pulse rounded bg-dialog-surface\"\n                  ></div>\n                  <div\n                    class=\"h-4 animate-pulse rounded bg-dialog-surface\"\n                  ></div>\n                </div>\n              </CardBottom>\n            </template>\n          </CardContainer>\n\n          <!-- Actual Template Cards -->\n          <CardContainer\n            v-for=\"template in isLoading ? [] : displayTemplates\"\n            :key=\"template.name\"\n            ref=\"cardRefs\"\n            size=\"compact\"\n            variant=\"ghost\"\n            rounded=\"lg\"\n            :data-testid=\"`template-workflow-${template.name}`\"\n            class=\"hover:bg-base-background\"\n            @mouseenter=\"hoveredTemplate = template.name\"\n            @mouseleave=\"hoveredTemplate = null\"\n            @click=\"onLoadWorkflow(template)\"\n          >\n            <template #top>\n              <CardTop ratio=\"square\">\n                <template #default>\n                  <!-- Template Thumbnail -->\n                  <div\n                    class=\"relative h-full w-full overflow-hidden rounded-lg\"\n                  >\n                    <template v-if=\"template.mediaType === 'audio'\">\n                      <AudioThumbnail :src=\"getBaseThumbnailSrc(template)\" />\n                    </template>\n                    <template\n                      v-else-if=\"template.thumbnailVariant === 'compareSlider'\"\n                    >\n                      <CompareSliderThumbnail\n                        :base-image-src=\"getBaseThumbnailSrc(template)\"\n                        :overlay-image-src=\"getOverlayThumbnailSrc(template)\"\n                        :alt=\"\n                          getTemplateTitle(\n                            template,\n                            getEffectiveSourceModule(template)\n                          )\n                        \"\n                        :is-hovered=\"hoveredTemplate === template.name\"\n                        :is-video=\"\n                          template.mediaType === 'video' ||\n                          template.mediaSubtype === 'webp'\n                        \"\n                      />\n                    </template>\n                    <template\n                      v-else-if=\"template.thumbnailVariant === 'hoverDissolve'\"\n                    >\n                      <HoverDissolveThumbnail\n                        :base-image-src=\"getBaseThumbnailSrc(template)\"\n                        :overlay-image-src=\"getOverlayThumbnailSrc(template)\"\n                        :alt=\"\n                          getTemplateTitle(\n                            template,\n                            getEffectiveSourceModule(template)\n                          )\n                        \"\n                        :is-hovered=\"hoveredTemplate === template.name\"\n                        :is-video=\"\n                          template.mediaType === 'video' ||\n                          template.mediaSubtype === 'webp'\n                        \"\n                      />\n                    </template>\n                    <template v-else>\n                      <DefaultThumbnail\n                        :src=\"getBaseThumbnailSrc(template)\"\n                        :alt=\"\n                          getTemplateTitle(\n                            template,\n                            getEffectiveSourceModule(template)\n                          )\n                        \"\n                        :is-hovered=\"hoveredTemplate === template.name\"\n                        :is-video=\"\n                          template.mediaType === 'video' ||\n                          template.mediaSubtype === 'webp'\n                        \"\n                        :hover-zoom=\"\n                          template.thumbnailVariant === 'zoomHover' ? 16 : 5\n                        \"\n                      />\n                    </template>\n                    <ProgressSpinner\n                      v-if=\"loadingTemplate === template.name\"\n                      class=\"absolute inset-0 z-10 m-auto h-12 w-12\"\n                    />\n                  </div>\n                </template>\n                <template #bottom-right>\n                  <template v-if=\"template.tags && template.tags.length > 0\">\n                    <SquareChip\n                      v-for=\"tag in template.tags\"\n                      :key=\"tag\"\n                      :label=\"tag\"\n                    />\n                  </template>\n                </template>\n              </CardTop>\n            </template>\n            <template #bottom>\n              <CardBottom>\n                <div class=\"flex flex-col gap-2 pt-3\">\n                  <h3\n                    class=\"m-0 line-clamp-1 text-sm\"\n                    :title=\"\n                      getTemplateTitle(\n                        template,\n                        getEffectiveSourceModule(template)\n                      )\n                    \"\n                  >\n                    {{\n                      getTemplateTitle(\n                        template,\n                        getEffectiveSourceModule(template)\n                      )\n                    }}\n                  </h3>\n                  <div class=\"flex justify-between gap-2\">\n                    <div class=\"flex-1\">\n                      <p\n                        class=\"m-0 line-clamp-2 text-sm text-muted\"\n                        :title=\"getTemplateDescription(template)\"\n                      >\n                        {{ getTemplateDescription(template) }}\n                      </p>\n                    </div>\n                    <div\n                      v-if=\"template.tutorialUrl\"\n                      class=\"flex flex-col-reverse justify-center\"\n                    >\n                      <IconButton\n                        v-if=\"hoveredTemplate === template.name\"\n                        v-tooltip.bottom=\"$t('g.seeTutorial')\"\n                        v-bind=\"$attrs\"\n                        type=\"primary\"\n                        size=\"sm\"\n                        @click.stop=\"openTutorial(template)\"\n                      >\n                        <i class=\"icon-[lucide--info] size-4\" />\n                      </IconButton>\n                    </div>\n                  </div>\n                </div>\n              </CardBottom>\n            </template>\n          </CardContainer>\n\n          <!-- Loading More Skeletons -->\n          <CardContainer\n            v-for=\"n in isLoadingMore ? 6 : 0\"\n            :key=\"`skeleton-${n}`\"\n            size=\"compact\"\n            variant=\"ghost\"\n            rounded=\"lg\"\n            class=\"hover:bg-base-background\"\n          >\n            <template #top>\n              <CardTop ratio=\"square\">\n                <template #default>\n                  <div\n                    class=\"h-full w-full animate-pulse bg-dialog-surface\"\n                  ></div>\n                </template>\n              </CardTop>\n            </template>\n            <template #bottom>\n              <CardBottom>\n                <div class=\"px-4 py-3\">\n                  <div\n                    class=\"mb-2 h-6 animate-pulse rounded bg-dialog-surface\"\n                  ></div>\n                  <div\n                    class=\"h-4 animate-pulse rounded bg-dialog-surface\"\n                  ></div>\n                </div>\n              </CardBottom>\n            </template>\n          </CardContainer>\n        </div>\n      </div>\n\n      <!-- Load More Trigger -->\n      <div\n        v-if=\"!isLoading && hasMoreTemplates\"\n        ref=\"loadTrigger\"\n        class=\"mt-4 flex h-4 w-full items-center justify-center\"\n      >\n        <div v-if=\"isLoadingMore\" class=\"text-sm text-muted\">\n          {{ $t('templateWorkflows.loadingMore', 'Loading more...') }}\n        </div>\n      </div>\n\n      <!-- Results Summary -->\n      <div v-if=\"!isLoading\" class=\"mt-6 px-6 text-sm text-muted\">\n        {{\n          $t('templateWorkflows.resultsCount', {\n            count: filteredCount,\n            total: totalCount\n          })\n        }}\n      </div>\n    </template>\n  </BaseModalLayout>\n</template>\n\n<script setup lang=\"ts\">\nimport { useAsyncState } from '@vueuse/core'\nimport ProgressSpinner from 'primevue/progressspinner'\nimport { computed, onBeforeUnmount, onMounted, provide, ref, watch } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport IconButton from '@/components/button/IconButton.vue'\nimport IconTextButton from '@/components/button/IconTextButton.vue'\nimport CardBottom from '@/components/card/CardBottom.vue'\nimport CardContainer from '@/components/card/CardContainer.vue'\nimport CardTop from '@/components/card/CardTop.vue'\nimport SquareChip from '@/components/chip/SquareChip.vue'\nimport MultiSelect from '@/components/input/MultiSelect.vue'\nimport SearchBox from '@/components/input/SearchBox.vue'\nimport SingleSelect from '@/components/input/SingleSelect.vue'\nimport AudioThumbnail from '@/components/templates/thumbnails/AudioThumbnail.vue'\nimport CompareSliderThumbnail from '@/components/templates/thumbnails/CompareSliderThumbnail.vue'\nimport DefaultThumbnail from '@/components/templates/thumbnails/DefaultThumbnail.vue'\nimport HoverDissolveThumbnail from '@/components/templates/thumbnails/HoverDissolveThumbnail.vue'\nimport BaseModalLayout from '@/components/widget/layout/BaseModalLayout.vue'\nimport LeftSidePanel from '@/components/widget/panel/LeftSidePanel.vue'\nimport { useIntersectionObserver } from '@/composables/useIntersectionObserver'\nimport { useLazyPagination } from '@/composables/useLazyPagination'\nimport { useTemplateFiltering } from '@/composables/useTemplateFiltering'\nimport { isCloud } from '@/platform/distribution/types'\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useTemplateWorkflows } from '@/platform/workflow/templates/composables/useTemplateWorkflows'\nimport { useWorkflowTemplatesStore } from '@/platform/workflow/templates/repositories/workflowTemplatesStore'\nimport type { TemplateInfo } from '@/platform/workflow/templates/types/template'\nimport type { NavGroupData, NavItemData } from '@/types/navTypes'\nimport { OnCloseKey } from '@/types/widgetTypes'\nimport { createGridStyle } from '@/utils/gridUtil'\n\nconst { t } = useI18n()\n\nconst { onClose: originalOnClose } = defineProps<{\n  onClose: () => void\n}>()\n\n// Track session time for telemetry\nconst sessionStartTime = ref<number>(0)\nconst templateWasSelected = ref(false)\n\nonMounted(() => {\n  sessionStartTime.value = Date.now()\n})\n\n// Wrap onClose to track session end\nconst onClose = () => {\n  if (isCloud) {\n    const timeSpentSeconds = Math.floor(\n      (Date.now() - sessionStartTime.value) / 1000\n    )\n\n    useTelemetry()?.trackTemplateLibraryClosed({\n      template_selected: templateWasSelected.value,\n      time_spent_seconds: timeSpentSeconds\n    })\n  }\n\n  originalOnClose()\n}\n\nprovide(OnCloseKey, onClose)\n\n// Workflow templates store and composable\nconst workflowTemplatesStore = useWorkflowTemplatesStore()\nconst {\n  loadTemplates,\n  loadWorkflowTemplate,\n  getTemplateThumbnailUrl,\n  getTemplateTitle,\n  getTemplateDescription\n} = useTemplateWorkflows()\n\nconst getEffectiveSourceModule = (template: TemplateInfo) =>\n  template.sourceModule || 'default'\n\nconst getBaseThumbnailSrc = (template: TemplateInfo) => {\n  const sm = getEffectiveSourceModule(template)\n  return getTemplateThumbnailUrl(template, sm, sm === 'default' ? '1' : '')\n}\n\nconst getOverlayThumbnailSrc = (template: TemplateInfo) => {\n  const sm = getEffectiveSourceModule(template)\n  return getTemplateThumbnailUrl(template, sm, sm === 'default' ? '2' : '')\n}\n\n// Open tutorial in new tab\nconst openTutorial = (template: TemplateInfo) => {\n  if (template.tutorialUrl) {\n    window.open(template.tutorialUrl, '_blank')\n  }\n}\n\n// Get navigation items from the store, with skeleton items while loading\nconst navItems = computed<(NavItemData | NavGroupData)[]>(() => {\n  // Show skeleton navigation items while loading\n  if (isLoading.value) {\n    return [\n      {\n        id: 'skeleton-all',\n        label: 'All Templates',\n        icon: 'icon-[lucide--layout-grid]'\n      },\n      {\n        id: 'skeleton-basics',\n        label: 'Basics',\n        icon: 'icon-[lucide--graduation-cap]'\n      },\n      {\n        title: 'Generation Type',\n        items: [\n          { id: 'skeleton-1', label: '...', icon: 'icon-[lucide--loader-2]' },\n          { id: 'skeleton-2', label: '...', icon: 'icon-[lucide--loader-2]' }\n        ]\n      },\n      {\n        title: 'Closed Source Models',\n        items: [\n          { id: 'skeleton-3', label: '...', icon: 'icon-[lucide--loader-2]' }\n        ]\n      }\n    ]\n  }\n  return workflowTemplatesStore.navGroupedTemplates\n})\n\nconst gridStyle = computed(() => createGridStyle())\n\n// Get enhanced templates for better filtering\nconst allTemplates = computed(() => {\n  return workflowTemplatesStore.enhancedTemplates\n})\n\n// Filter templates based on selected navigation item\nconst navigationFilteredTemplates = computed(() => {\n  if (!selectedNavItem.value) {\n    return allTemplates.value\n  }\n\n  return workflowTemplatesStore.filterTemplatesByCategory(selectedNavItem.value)\n})\n\n// Template filtering\nconst {\n  searchQuery,\n  selectedModels,\n  selectedUseCases,\n  selectedRunsOn,\n  sortBy,\n  filteredTemplates,\n  availableModels,\n  availableUseCases,\n  availableRunsOn,\n  filteredCount,\n  totalCount,\n  resetFilters\n} = useTemplateFiltering(navigationFilteredTemplates)\n\n// Convert between string array and object array for MultiSelect component\nconst selectedModelObjects = computed({\n  get() {\n    return selectedModels.value.map((model) => ({ name: model, value: model }))\n  },\n  set(value: { name: string; value: string }[]) {\n    selectedModels.value = value.map((item) => item.value)\n  }\n})\n\nconst selectedUseCaseObjects = computed({\n  get() {\n    return selectedUseCases.value.map((useCase) => ({\n      name: useCase,\n      value: useCase\n    }))\n  },\n  set(value: { name: string; value: string }[]) {\n    selectedUseCases.value = value.map((item) => item.value)\n  }\n})\n\nconst selectedRunsOnObjects = computed({\n  get() {\n    return selectedRunsOn.value.map((runsOn) => ({\n      name: runsOn,\n      value: runsOn\n    }))\n  },\n  set(value: { name: string; value: string }[]) {\n    selectedRunsOn.value = value.map((item) => item.value)\n  }\n})\n\n// Loading states\nconst loadingTemplate = ref<string | null>(null)\nconst hoveredTemplate = ref<string | null>(null)\nconst cardRefs = ref<HTMLElement[]>([])\n\n// Force re-render key for templates when sorting changes\nconst templateListKey = ref(0)\n\n// Navigation\nconst selectedNavItem = ref<string | null>('all')\n\n// Search text for model filter\nconst modelSearchText = ref<string>('')\n\n// Filter options\nconst modelOptions = computed(() =>\n  availableModels.value.map((model) => ({\n    name: model,\n    value: model\n  }))\n)\n\nconst useCaseOptions = computed(() =>\n  availableUseCases.value.map((useCase) => ({\n    name: useCase,\n    value: useCase\n  }))\n)\n\nconst runsOnOptions = computed(() =>\n  availableRunsOn.value.map((runsOn) => ({\n    name: runsOn,\n    value: runsOn\n  }))\n)\n\n// Filter labels\nconst modelFilterLabel = computed(() => {\n  if (selectedModelObjects.value.length === 0) {\n    return t('templateWorkflows.modelFilter', 'Model Filter')\n  } else if (selectedModelObjects.value.length === 1) {\n    return selectedModelObjects.value[0].name\n  } else {\n    return t('templateWorkflows.modelsSelected', {\n      count: selectedModelObjects.value.length\n    })\n  }\n})\n\nconst useCaseFilterLabel = computed(() => {\n  if (selectedUseCaseObjects.value.length === 0) {\n    return t('templateWorkflows.useCaseFilter', 'Use Case')\n  } else if (selectedUseCaseObjects.value.length === 1) {\n    return selectedUseCaseObjects.value[0].name\n  } else {\n    return t('templateWorkflows.useCasesSelected', {\n      count: selectedUseCaseObjects.value.length\n    })\n  }\n})\n\nconst runsOnFilterLabel = computed(() => {\n  if (selectedRunsOnObjects.value.length === 0) {\n    return t('templateWorkflows.runsOnFilter', 'Runs On')\n  } else if (selectedRunsOnObjects.value.length === 1) {\n    return selectedRunsOnObjects.value[0].name\n  } else {\n    return t('templateWorkflows.runsOnSelected', {\n      count: selectedRunsOnObjects.value.length\n    })\n  }\n})\n\n// Sort options\nconst sortOptions = computed(() => [\n  { name: t('templateWorkflows.sort.newest', 'Newest'), value: 'newest' },\n  {\n    name: t('templateWorkflows.sort.default', 'Default'),\n    value: 'default'\n  },\n  {\n    name: t('templateWorkflows.sort.vramLowToHigh', 'VRAM Usage (Low to High)'),\n    value: 'vram-low-to-high'\n  },\n  {\n    name: t(\n      'templateWorkflows.sort.modelSizeLowToHigh',\n      'Model Size (Low to High)'\n    ),\n    value: 'model-size-low-to-high'\n  },\n  {\n    name: t('templateWorkflows.sort.alphabetical', 'Alphabetical (A-Z)'),\n    value: 'alphabetical'\n  }\n])\n\n// Lazy pagination setup\nconst loadTrigger = ref<HTMLElement | null>(null)\nconst shouldUsePagination = computed(() => !searchQuery.value.trim())\n\nconst {\n  paginatedItems: paginatedTemplates,\n  isLoading: isLoadingMore,\n  hasMoreItems: hasMoreTemplates,\n  loadNextPage,\n  reset: resetPagination\n} = useLazyPagination(filteredTemplates, { itemsPerPage: 24 }) // Load 24 items per page\n\n// Display templates (all when searching, paginated when not)\nconst displayTemplates = computed(() => {\n  return shouldUsePagination.value\n    ? paginatedTemplates.value\n    : filteredTemplates.value\n})\n\n// Set up intersection observer for lazy loading\nuseIntersectionObserver(loadTrigger, () => {\n  if (\n    shouldUsePagination.value &&\n    hasMoreTemplates.value &&\n    !isLoadingMore.value\n  ) {\n    void loadNextPage()\n  }\n})\n\n// Reset pagination when filters change\nwatch(\n  [\n    searchQuery,\n    selectedNavItem,\n    sortBy,\n    selectedModels,\n    selectedUseCases,\n    selectedRunsOn\n  ],\n  () => {\n    resetPagination()\n    // Clear loading state and force re-render of template list\n    loadingTemplate.value = null\n    templateListKey.value++\n  }\n)\n\n// Methods\nconst onLoadWorkflow = async (template: any) => {\n  loadingTemplate.value = template.name\n  try {\n    await loadWorkflowTemplate(\n      template.name,\n      getEffectiveSourceModule(template)\n    )\n    templateWasSelected.value = true\n    onClose()\n  } finally {\n    loadingTemplate.value = null\n  }\n}\n\nconst pageTitle = computed(() => {\n  const navItem = navItems.value.find((item) =>\n    'id' in item\n      ? item.id === selectedNavItem.value\n      : item.items?.some((sub) => sub.id === selectedNavItem.value)\n  )\n\n  if (!navItem) {\n    return t('templateWorkflows.allTemplates', 'All Templates')\n  }\n\n  return 'id' in navItem\n    ? navItem.label\n    : navItem.items?.find((i) => i.id === selectedNavItem.value)?.label ||\n        t('templateWorkflows.allTemplates', 'All Templates')\n})\n\n// Initialize templates loading with useAsyncState\nconst { isLoading } = useAsyncState(\n  async () => {\n    // Run both operations in parallel for better performance\n    await Promise.all([\n      loadTemplates(),\n      workflowTemplatesStore.loadWorkflowTemplates()\n    ])\n    return true\n  },\n  false, // initial state\n  {\n    immediate: true // Start loading immediately\n  }\n)\n\nonBeforeUnmount(() => {\n  cardRefs.value = [] // Release DOM refs\n})\n</script>\n\n<style>\n/* Ensure the workflow template selector dialog fits within provided dialog */\n.workflow-template-selector-dialog.base-widget-layout {\n  width: 100% !important;\n  max-width: 1400px;\n  height: 100% !important;\n  aspect-ratio: auto !important;\n}\n\n@media (min-width: 1600px) {\n  .workflow-template-selector-dialog.base-widget-layout {\n    max-width: 1600px;\n  }\n}\n</style>\n","import WorkflowTemplateSelectorDialog from '@/components/custom/widget/WorkflowTemplateSelectorDialog.vue'\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useDialogService } from '@/services/dialogService'\nimport { useDialogStore } from '@/stores/dialogStore'\n\nconst DIALOG_KEY = 'global-workflow-template-selector'\n\nexport const useWorkflowTemplateSelectorDialog = () => {\n  const dialogService = useDialogService()\n  const dialogStore = useDialogStore()\n\n  function hide() {\n    dialogStore.closeDialog({ key: DIALOG_KEY })\n  }\n\n  function show(source: 'sidebar' | 'menu' | 'command' = 'command') {\n    useTelemetry()?.trackTemplateLibraryOpened({ source })\n\n    dialogService.showLayoutDialog({\n      key: DIALOG_KEY,\n      component: WorkflowTemplateSelectorDialog,\n      props: {\n        onClose: hide\n      },\n      dialogComponentProps: {\n        pt: {\n          content: { class: '!px-0 overflow-hidden h-full !py-0' },\n          root: {\n            style:\n              'width: 90vw; height: 85vh; max-width: 1400px; display: flex;'\n          }\n        }\n      }\n    })\n  }\n\n  return {\n    show,\n    hide\n  }\n}\n","import { useEventListener } from '@vueuse/core'\n\nexport const whileMouseDown = (\n  elementOrEvent: HTMLElement | Event,\n  callback: (iteration: number) => void,\n  interval: number = 30\n) => {\n  const element =\n    elementOrEvent instanceof HTMLElement\n      ? elementOrEvent\n      : (elementOrEvent.target as HTMLElement)\n\n  let iteration = 0\n\n  const intervalId = setInterval(() => {\n    callback(iteration++)\n  }, interval)\n\n  const dispose = () => {\n    clearInterval(intervalId)\n    disposeGlobal()\n    disposeLocal()\n  }\n\n  // Listen for mouseup globally to catch cases where user drags out of element\n  const disposeGlobal = useEventListener(document, 'mouseup', dispose)\n  const disposeLocal = useEventListener(element, 'mouseup', dispose)\n\n  return {\n    dispose: dispose\n  }\n}\n","<template>\n  <div\n    ref=\"menuButtonRef\"\n    v-tooltip=\"{\n      value: t('sideToolbar.labels.menu'),\n      showDelay: 300,\n      hideDelay: 300\n    }\"\n    class=\"comfy-menu-button-wrapper flex shrink-0 cursor-pointer flex-col items-center justify-center p-2 transition-colors\"\n    :class=\"{\n      'comfy-menu-button-active': menuRef?.visible\n    }\"\n    @click=\"onLogoMenuClick($event)\"\n  >\n    <div class=\"flex h-8 w-8 items-center justify-center rounded-lg bg-black\">\n      <ComfyLogo\n        alt=\"ComfyUI Logo\"\n        class=\"comfyui-logo h-[18px] w-[18px] text-white\"\n        mode=\"fill\"\n      />\n    </div>\n  </div>\n\n  <TieredMenu\n    ref=\"menuRef\"\n    :model=\"translatedItems\"\n    :popup=\"true\"\n    class=\"comfy-command-menu\"\n    @show=\"onMenuShow\"\n  >\n    <template #item=\"{ item, props }\">\n      <a\n        v-if=\"item.key !== 'nodes-2.0-toggle'\"\n        class=\"p-menubar-item-link px-4 py-2\"\n        v-bind=\"props.action\"\n        :href=\"item.url\"\n        target=\"_blank\"\n        :class=\"typeof item.class === 'function' ? item.class() : item.class\"\n        @mousedown=\"\n          isZoomCommand(item) ? handleZoomMouseDown(item, $event) : undefined\n        \"\n        @click=\"handleItemClick(item, $event)\"\n      >\n        <i\n          v-if=\"hasActiveStateSiblings(item)\"\n          class=\"p-menubar-item-icon pi pi-check text-sm\"\n          :class=\"{ invisible: !item.comfyCommand?.active?.() }\"\n        />\n        <span\n          v-else-if=\"\n            item.icon && item.comfyCommand?.id !== 'Comfy.NewBlankWorkflow'\n          \"\n          class=\"p-menubar-item-icon text-sm\"\n          :class=\"item.icon\"\n        />\n        <span class=\"p-menubar-item-label text-nowrap\">{{ item.label }}</span>\n        <i\n          v-if=\"item.comfyCommand?.id === 'Comfy.NewBlankWorkflow'\"\n          class=\"ml-auto\"\n          :class=\"item.icon\"\n        />\n        <span\n          v-if=\"item?.comfyCommand?.keybinding\"\n          class=\"keybinding-tag ml-auto rounded border border-surface p-1 text-xs text-nowrap text-muted\"\n        >\n          {{ item.comfyCommand.keybinding.combo.toString() }}\n        </span>\n        <i v-if=\"item.items\" class=\"pi pi-angle-right ml-auto\" />\n      </a>\n      <div\n        v-else\n        class=\"flex items-center justify-between px-4 py-2\"\n        @click.stop=\"handleNodes2ToggleClick\"\n      >\n        <span class=\"p-menubar-item-label text-nowrap\">{{ item.label }}</span>\n        <ToggleSwitch\n          v-model=\"nodes2Enabled\"\n          class=\"ml-4\"\n          :aria-label=\"item.label\"\n          :pt=\"{\n            root: {\n              style: {\n                width: '38px',\n                height: '20px'\n              }\n            },\n            handle: {\n              style: {\n                width: '16px',\n                height: '16px'\n              }\n            }\n          }\"\n          @click.stop\n          @update:model-value=\"onNodes2ToggleChange\"\n        />\n      </div>\n    </template>\n  </TieredMenu>\n</template>\n\n<script setup lang=\"ts\">\nimport type { MenuItem } from 'primevue/menuitem'\nimport TieredMenu from 'primevue/tieredmenu'\nimport type { TieredMenuMethods, TieredMenuState } from 'primevue/tieredmenu'\nimport ToggleSwitch from 'primevue/toggleswitch'\nimport { computed, nextTick, ref } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport SettingDialogHeader from '@/components/dialog/header/SettingDialogHeader.vue'\nimport ComfyLogo from '@/components/icons/ComfyLogo.vue'\nimport { useWorkflowTemplateSelectorDialog } from '@/composables/useWorkflowTemplateSelectorDialog'\nimport SettingDialogContent from '@/platform/settings/components/SettingDialogContent.vue'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useColorPaletteService } from '@/services/colorPaletteService'\nimport { useCommandStore } from '@/stores/commandStore'\nimport { useDialogStore } from '@/stores/dialogStore'\nimport { useMenuItemStore } from '@/stores/menuItemStore'\nimport { useColorPaletteStore } from '@/stores/workspace/colorPaletteStore'\nimport { normalizeI18nKey } from '@/utils/formatUtil'\nimport { whileMouseDown } from '@/utils/mouseDownUtil'\nimport { useManagerState } from '@/workbench/extensions/manager/composables/useManagerState'\nimport { ManagerTab } from '@/workbench/extensions/manager/types/comfyManagerTypes'\n\nconst { t } = useI18n()\nconst commandStore = useCommandStore()\nconst menuItemStore = useMenuItemStore()\nconst colorPaletteStore = useColorPaletteStore()\nconst colorPaletteService = useColorPaletteService()\nconst dialogStore = useDialogStore()\nconst managerState = useManagerState()\nconst settingStore = useSettingStore()\n\nconst menuRef = ref<\n  ({ dirty: boolean } & TieredMenuMethods & TieredMenuState) | null\n>(null)\nconst menuButtonRef = ref<HTMLElement | null>(null)\n\nconst nodes2Enabled = computed({\n  get: () => settingStore.get('Comfy.VueNodes.Enabled') ?? false,\n  set: async (value: boolean) => {\n    await settingStore.set('Comfy.VueNodes.Enabled', value)\n  }\n})\n\nconst telemetry = useTelemetry()\n\nfunction onLogoMenuClick(event: MouseEvent) {\n  telemetry?.trackUiButtonClicked({\n    button_id: 'sidebar_comfy_menu_opened'\n  })\n  menuRef.value?.toggle(event)\n}\n\nconst translateMenuItem = (item: MenuItem): MenuItem => {\n  const label = typeof item.label === 'function' ? item.label() : item.label\n  const translatedLabel = label\n    ? t(`menuLabels.${normalizeI18nKey(label)}`, label)\n    : undefined\n\n  return {\n    ...item,\n    label: translatedLabel,\n    items: item.items?.map(translateMenuItem)\n  }\n}\n\nconst showSettings = (defaultPanel?: string) => {\n  dialogStore.showDialog({\n    key: 'global-settings',\n    headerComponent: SettingDialogHeader,\n    component: SettingDialogContent,\n    props: {\n      defaultPanel\n    }\n  })\n}\n\nconst showManageExtensions = async () => {\n  await managerState.openManager({\n    initialTab: ManagerTab.All,\n    showToastOnLegacyError: false\n  })\n}\n\nconst themeMenuItems = computed(() => {\n  return colorPaletteStore.palettes.map((palette) => ({\n    key: `theme-${palette.id}`,\n    label: palette.name,\n    parentPath: 'theme',\n    comfyCommand: {\n      active: () => colorPaletteStore.activePaletteId === palette.id\n    },\n    command: async () => {\n      await colorPaletteService.loadColorPalette(palette.id)\n    }\n  }))\n})\n\nconst extraMenuItems = computed(() => [\n  { separator: true },\n  {\n    key: 'theme',\n    label: t('menu.theme'),\n    items: themeMenuItems.value\n  },\n  {\n    key: 'nodes-2.0-toggle',\n    label: 'Nodes 2.0'\n  },\n  { separator: true },\n  {\n    key: 'browse-templates',\n    label: t('menuLabels.Browse Templates'),\n    icon: 'icon-[comfy--template]',\n    command: () => useWorkflowTemplateSelectorDialog().show('menu')\n  },\n  {\n    key: 'settings',\n    label: t('g.settings'),\n    icon: 'mdi mdi-cog-outline',\n    command: () => {\n      telemetry?.trackUiButtonClicked({\n        button_id: 'sidebar_settings_menu_opened'\n      })\n      showSettings()\n    }\n  },\n  {\n    key: 'manage-extensions',\n    label: t('menu.manageExtensions'),\n    icon: 'mdi mdi-puzzle-outline',\n    command: showManageExtensions\n  }\n])\n\nconst translatedItems = computed(() => {\n  const items = menuItemStore.menuItems.map(translateMenuItem)\n  let helpIndex = items.findIndex((item) => item.key === 'Help')\n  let helpItem: MenuItem | undefined\n\n  if (helpIndex !== -1) {\n    items[helpIndex].icon = 'mdi mdi-help-circle-outline'\n    // If help is not the last item (i.e. we have extension commands), separate them\n    const isLastItem = helpIndex !== items.length - 1\n    helpItem = items.splice(\n      helpIndex,\n      1,\n      ...(isLastItem\n        ? [\n            {\n              separator: true\n            }\n          ]\n        : [])\n    )[0]\n  }\n  helpIndex = items.length\n\n  items.splice(\n    helpIndex,\n    0,\n    ...extraMenuItems.value,\n    ...(helpItem\n      ? [\n          {\n            separator: true\n          },\n          helpItem\n        ]\n      : [])\n  )\n\n  return items\n})\n\nconst onMenuShow = () => {\n  void nextTick(() => {\n    // Force the menu to show submenus on hover\n    if (menuRef.value) {\n      menuRef.value.dirty = true\n    }\n  })\n}\n\nconst isZoomCommand = (item: MenuItem) => {\n  return (\n    item.comfyCommand?.id === 'Comfy.Canvas.ZoomIn' ||\n    item.comfyCommand?.id === 'Comfy.Canvas.ZoomOut'\n  )\n}\n\nconst handleZoomMouseDown = (item: MenuItem, event: MouseEvent) => {\n  if (item.comfyCommand) {\n    whileMouseDown(\n      event,\n      async () => {\n        await commandStore.execute(item.comfyCommand!.id)\n      },\n      50\n    )\n  }\n}\n\nconst handleItemClick = (item: MenuItem, event: MouseEvent) => {\n  // Prevent the menu from closing for zoom commands or commands that have active state\n  if (isZoomCommand(item) || item.comfyCommand?.active) {\n    event.preventDefault()\n    event.stopPropagation()\n    if (item.comfyCommand?.active) {\n      item.command?.({\n        item,\n        originalEvent: event\n      })\n    }\n    return false\n  }\n}\n\nconst hasActiveStateSiblings = (item: MenuItem): boolean => {\n  // Check if this item has siblings with active state (either from store or theme items)\n  return (\n    item.parentPath &&\n    (item.parentPath === 'theme' ||\n      menuItemStore.menuItemHasActiveStateChildren[item.parentPath])\n  )\n}\n\nconst handleNodes2ToggleClick = () => {\n  return false\n}\n\nconst onNodes2ToggleChange = async (value: boolean) => {\n  await settingStore.set('Comfy.VueNodes.Enabled', value)\n  telemetry?.trackUiButtonClicked({\n    button_id: `menu_nodes_2.0_toggle_${value ? 'enabled' : 'disabled'}`\n  })\n}\n</script>\n\n<style scoped>\n.comfy-menu-button-wrapper {\n  width: var(--sidebar-width);\n  height: var(--sidebar-item-height);\n}\n\n.comfy-menu-button-wrapper:hover {\n  background: var(--interface-panel-hover-surface);\n}\n\n.comfy-menu-button-active,\n.comfy-menu-button-active:hover {\n  background: var(--interface-panel-selected-surface);\n}\n\n.keybinding-tag {\n  background: var(--p-content-hover-background);\n  border-color: var(--p-content-border-color);\n  border-style: solid;\n}\n</style>\n\n<style>\n.comfy-command-menu {\n  --p-tieredmenu-item-focus-background: color-mix(\n    in srgb,\n    var(--fg-color) 15%,\n    transparent\n  );\n  --p-tieredmenu-item-active-background: color-mix(\n    in srgb,\n    var(--fg-color) 10%,\n    transparent\n  );\n}\n\n.comfy-command-menu ul {\n  background-color: var(--comfy-menu-bg) !important;\n}\n</style>\n","<template>\n  <Button\n    v-tooltip=\"{\n      value: computedTooltip,\n      showDelay: 300,\n      hideDelay: 300\n    }\"\n    text\n    :pt=\"{\n      root: {\n        class: `side-bar-button p-button-secondary ${\n          selected ? 'side-bar-button-selected' : ''\n        }`,\n        'aria-label': computedTooltip\n      }\n    }\"\n    @click=\"emit('click', $event)\"\n  >\n    <template #icon>\n      <div class=\"side-bar-button-content\">\n        <slot name=\"icon\">\n          <OverlayBadge v-if=\"shouldShowBadge\" :value=\"overlayValue\">\n            <i\n              v-if=\"typeof icon === 'string'\"\n              :class=\"icon + ' side-bar-button-icon'\"\n            />\n            <component :is=\"icon\" v-else class=\"side-bar-button-icon\" />\n          </OverlayBadge>\n          <i\n            v-else-if=\"typeof icon === 'string'\"\n            :class=\"icon + ' side-bar-button-icon'\"\n          />\n          <component\n            :is=\"icon\"\n            v-else-if=\"typeof icon === 'object'\"\n            class=\"side-bar-button-icon\"\n          />\n        </slot>\n        <span v-if=\"label && !isSmall\" class=\"side-bar-button-label\">{{\n          t(label)\n        }}</span>\n      </div>\n    </template>\n  </Button>\n</template>\n\n<script setup lang=\"ts\">\nimport Button from 'primevue/button'\nimport OverlayBadge from 'primevue/overlaybadge'\nimport { computed } from 'vue'\nimport type { Component } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nconst { t } = useI18n()\nconst {\n  icon = '',\n  selected = false,\n  tooltip = '',\n  tooltipSuffix = '',\n  iconBadge = '',\n  label = '',\n  isSmall = false\n} = defineProps<{\n  icon?: string | Component\n  selected?: boolean\n  tooltip?: string\n  tooltipSuffix?: string\n  iconBadge?: string | (() => string | null)\n  label?: string\n  isSmall?: boolean\n}>()\n\nconst emit = defineEmits<{\n  (e: 'click', event: MouseEvent): void\n}>()\nconst overlayValue = computed(() =>\n  typeof iconBadge === 'function' ? (iconBadge() ?? '') : iconBadge\n)\nconst shouldShowBadge = computed(() => !!overlayValue.value)\nconst computedTooltip = computed(() => t(tooltip) + tooltipSuffix)\n</script>\n\n<style>\n.side-bar-button-icon {\n  font-size: var(--sidebar-icon-size) !important;\n}\n\n.side-bar-button-selected {\n  background-color: var(--interface-panel-selected-surface);\n  color: var(--content-hover-fg);\n}\n.side-bar-button:hover {\n  background-color: var(--interface-panel-hover-surface);\n  color: var(--content-hover-fg);\n}\n\n.side-bar-button-selected .side-bar-button-icon {\n  font-size: var(--sidebar-icon-size) !important;\n}\n</style>\n\n<style scoped>\n@reference '../../assets/css/style.css';\n\n.side-bar-button {\n  width: var(--sidebar-width);\n  height: var(--sidebar-item-height);\n  border-radius: 0;\n  flex-shrink: 0;\n}\n\n.side-tool-bar-end .side-bar-button {\n  height: var(--sidebar-width);\n}\n\n.side-bar-button-content {\n  @apply flex flex-col items-center gap-2;\n}\n\n.side-bar-button-label {\n  @apply text-[10px] text-center;\n  line-height: 1;\n}\n\n.comfyui-body-left .side-bar-button.side-bar-button-selected,\n.comfyui-body-left .side-bar-button.side-bar-button-selected:hover {\n  border-left: 4px solid var(--p-button-text-primary-color);\n}\n\n.comfyui-body-right .side-bar-button.side-bar-button-selected,\n.comfyui-body-right .side-bar-button.side-bar-button-selected:hover {\n  border-right: 4px solid var(--p-button-text-primary-color);\n}\n</style>\n","<template>\n  <SidebarIcon\n    :label=\"$t('sideToolbar.labels.console')\"\n    :tooltip=\"$t('menu.toggleBottomPanel')\"\n    :selected=\"bottomPanelStore.activePanel == 'terminal'\"\n    @click=\"toggleConsole\"\n  >\n    <template #icon>\n      <i-ph:terminal-bold />\n    </template>\n  </SidebarIcon>\n</template>\n\n<script setup lang=\"ts\">\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useBottomPanelStore } from '@/stores/workspace/bottomPanelStore'\n\nimport SidebarIcon from './SidebarIcon.vue'\n\nconst bottomPanelStore = useBottomPanelStore()\n\n/**\n * Toggle console bottom panel and track UI button click.\n */\nconst toggleConsole = () => {\n  useTelemetry()?.trackUiButtonClicked({\n    button_id: 'sidebar_bottom_panel_console_toggled'\n  })\n  bottomPanelStore.toggleBottomPanel()\n}\n</script>\n","<template>\n  <SidebarIcon\n    :label=\"$t('shortcuts.shortcuts')\"\n    :tooltip=\"tooltipText\"\n    :selected=\"isShortcutsPanelVisible\"\n    @click=\"toggleShortcutsPanel\"\n  >\n    <template #icon>\n      <i class=\"icon-[lucide--keyboard]\" />\n    </template>\n  </SidebarIcon>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useCommandStore } from '@/stores/commandStore'\nimport { useBottomPanelStore } from '@/stores/workspace/bottomPanelStore'\n\nimport SidebarIcon from './SidebarIcon.vue'\n\nconst { t } = useI18n()\nconst bottomPanelStore = useBottomPanelStore()\nconst commandStore = useCommandStore()\nconst command = commandStore.getCommand('Workspace.ToggleBottomPanel.Shortcuts')\nconst { formatKeySequence } = commandStore\n\nconst isShortcutsPanelVisible = computed(\n  () => bottomPanelStore.activePanel === 'shortcuts'\n)\n\nconst tooltipText = computed(\n  () => `${t('shortcuts.keyboardShortcuts')} (${formatKeySequence(command)})`\n)\n\n/**\n * Toggle keyboard shortcuts panel and track UI button click.\n */\nconst toggleShortcutsPanel = () => {\n  useTelemetry()?.trackUiButtonClicked({\n    button_id: 'sidebar_shortcuts_panel_toggled'\n  })\n  bottomPanelStore.togglePanel('shortcuts')\n}\n</script>\n","<template>\n  <svg\n    xmlns=\"http://www.w3.org/2000/svg\"\n    :width=\"size\"\n    :height=\"size\"\n    viewBox=\"0 0 16 16\"\n    fill=\"none\"\n    :class=\"iconClass\"\n  >\n    <g clip-path=\"url(#clip0_1099_16244)\">\n      <path\n        d=\"M4.99992 3.00016C4.99992 2.07969 5.74611 1.3335 6.66658 1.3335C7.58706 1.3335 8.33325 2.07969 8.33325 3.00016V4.00016H8.99992C9.9318 4.00016 10.3977 4.00016 10.7653 4.1524C11.2553 4.35539 11.6447 4.74474 11.8477 5.2348C11.9999 5.60234 11.9999 6.06828 11.9999 7.00016H12.9999C13.9204 7.00016 14.6666 7.74635 14.6666 8.66683C14.6666 9.5873 13.9204 10.3335 12.9999 10.3335H11.9999V11.4668C11.9999 12.5869 11.9999 13.147 11.7819 13.5748C11.5902 13.9511 11.2842 14.2571 10.9079 14.4488C10.4801 14.6668 9.92002 14.6668 8.79992 14.6668H8.33325V13.5002C8.33325 12.6717 7.66168 12.0002 6.83325 12.0002C6.00482 12.0002 5.33325 12.6717 5.33325 13.5002V14.6668H4.53325C3.41315 14.6668 2.85309 14.6668 2.42527 14.4488C2.04895 14.2571 1.74299 13.9511 1.55124 13.5748C1.33325 13.147 1.33325 12.5869 1.33325 11.4668V10.3335H2.33325C3.25373 10.3335 3.99992 9.5873 3.99992 8.66683C3.99992 7.74635 3.25373 7.00016 2.33325 7.00016H1.33325C1.33325 6.06828 1.33325 5.60234 1.48549 5.2348C1.68848 4.74474 2.07783 4.35539 2.56789 4.1524C2.93543 4.00016 3.40137 4.00016 4.33325 4.00016H4.99992V3.00016Z\"\n        :stroke=\"color\"\n        stroke-width=\"1.2\"\n        stroke-linecap=\"round\"\n        stroke-linejoin=\"round\"\n      />\n    </g>\n    <defs>\n      <clipPath id=\"clip0_1099_16244\">\n        <rect width=\"16\" height=\"16\" fill=\"white\" />\n      </clipPath>\n    </defs>\n  </svg>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\n\ninterface Props {\n  size?: number | string\n  color?: string\n  class?: string\n}\nconst {\n  size = 16,\n  color = 'currentColor',\n  class: className\n} = defineProps<Props>()\nconst iconClass = computed(() => className || '')\n</script>\n","import type { AxiosError, AxiosResponse } from 'axios'\nimport axios from 'axios'\nimport { ref, watch } from 'vue'\n\nimport { getComfyApiBaseUrl } from '@/config/comfyApi'\nimport type { components, operations } from '@/types/comfyRegistryTypes'\nimport { isAbortError } from '@/utils/typeGuardUtil'\n\n// Use generated types from OpenAPI spec\nexport type ReleaseNote = components['schemas']['ReleaseNote']\ntype GetReleasesParams = operations['getReleaseNotes']['parameters']['query']\n\n// Use generated error response type\ntype ErrorResponse = components['schemas']['ErrorResponse']\n\nconst releaseApiClient = axios.create({\n  baseURL: getComfyApiBaseUrl(),\n  headers: {\n    'Content-Type': 'application/json'\n  }\n})\n\n// Release service for fetching release notes\nexport const useReleaseService = () => {\n  const isLoading = ref(false)\n  const error = ref<string | null>(null)\n\n  watch(\n    () => getComfyApiBaseUrl(),\n    (url) => {\n      releaseApiClient.defaults.baseURL = url\n    }\n  )\n\n  // No transformation needed - API response matches the generated type\n\n  // Handle API errors with context\n  const handleApiError = (\n    err: unknown,\n    context: string,\n    routeSpecificErrors?: Record<number, string>\n  ): string => {\n    if (!axios.isAxiosError(err))\n      return err instanceof Error\n        ? `${context}: ${err.message}`\n        : `${context}: Unknown error occurred`\n\n    const axiosError = err as AxiosError<ErrorResponse>\n\n    if (axiosError.response) {\n      const { status, data } = axiosError.response\n\n      if (routeSpecificErrors && routeSpecificErrors[status])\n        return routeSpecificErrors[status]\n\n      switch (status) {\n        case 400:\n          return `Bad request: ${data?.message || 'Invalid input'}`\n        case 401:\n          return 'Unauthorized: Authentication required'\n        case 403:\n          return `Forbidden: ${data?.message || 'Access denied'}`\n        case 404:\n          return `Not found: ${data?.message || 'Resource not found'}`\n        case 500:\n          return `Server error: ${data?.message || 'Internal server error'}`\n        default:\n          return `${context}: ${data?.message || axiosError.message}`\n      }\n    }\n\n    return `${context}: ${axiosError.message}`\n  }\n\n  // Execute API request with error handling\n  const executeApiRequest = async <T>(\n    apiCall: () => Promise<AxiosResponse<T>>,\n    errorContext: string,\n    routeSpecificErrors?: Record<number, string>\n  ): Promise<T | null> => {\n    isLoading.value = true\n    error.value = null\n\n    try {\n      const response = await apiCall()\n      return response.data\n    } catch (err) {\n      // Don't treat cancellations as errors\n      if (isAbortError(err)) return null\n\n      error.value = handleApiError(err, errorContext, routeSpecificErrors)\n      return null\n    } finally {\n      isLoading.value = false\n    }\n  }\n\n  // Fetch release notes from API\n  const getReleases = async (\n    params: GetReleasesParams,\n    signal?: AbortSignal\n  ): Promise<ReleaseNote[] | null> => {\n    const endpoint = '/releases'\n    const errorContext = 'Failed to get releases'\n    const routeSpecificErrors = {\n      400: 'Invalid project or version parameter'\n    }\n\n    const apiResponse = await executeApiRequest(\n      () =>\n        releaseApiClient.get<ReleaseNote[]>(endpoint, {\n          params,\n          signal\n        }),\n      errorContext,\n      routeSpecificErrors\n    )\n\n    return apiResponse\n  }\n\n  return {\n    isLoading,\n    error,\n    getReleases\n  }\n}\n","import { until } from '@vueuse/core'\nimport { defineStore } from 'pinia'\nimport { compare } from 'semver'\nimport { computed, ref } from 'vue'\n\nimport { isCloud } from '@/platform/distribution/types'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useSystemStatsStore } from '@/stores/systemStatsStore'\nimport { isElectron } from '@/utils/envUtil'\nimport { stringToLocale } from '@/utils/formatUtil'\n\nimport { useReleaseService } from './releaseService'\nimport type { ReleaseNote } from './releaseService'\n\n// Store for managing release notes\nexport const useReleaseStore = defineStore('release', () => {\n  // State\n  const releases = ref<ReleaseNote[]>([])\n  const isLoading = ref(false)\n  const error = ref<string | null>(null)\n\n  // Services\n  const releaseService = useReleaseService()\n  const systemStatsStore = useSystemStatsStore()\n  const settingStore = useSettingStore()\n\n  // Current ComfyUI version\n  const currentComfyUIVersion = computed(\n    () => systemStatsStore?.systemStats?.system?.comfyui_version ?? ''\n  )\n\n  // Release data from settings\n  const locale = computed(() => settingStore.get('Comfy.Locale'))\n  const releaseVersion = computed(() =>\n    settingStore.get('Comfy.Release.Version')\n  )\n  const releaseStatus = computed(() => settingStore.get('Comfy.Release.Status'))\n  const releaseTimestamp = computed(() =>\n    settingStore.get('Comfy.Release.Timestamp')\n  )\n  const showVersionUpdates = computed(() =>\n    settingStore.get('Comfy.Notification.ShowVersionUpdates')\n  )\n\n  // Most recent release\n  const recentRelease = computed(() => {\n    return releases.value[0] ?? null\n  })\n\n  // 3 most recent releases\n  const recentReleases = computed(() => {\n    return releases.value.slice(0, 3)\n  })\n\n  // Helper constants\n  const THREE_DAYS_MS = 3 * 24 * 60 * 60 * 1000 // 3 days\n\n  // New version available?\n  const isNewVersionAvailable = computed(\n    () =>\n      !!recentRelease.value &&\n      compare(\n        recentRelease.value.version,\n        currentComfyUIVersion.value || '0.0.0'\n      ) > 0\n  )\n\n  const isLatestVersion = computed(\n    () =>\n      !!recentRelease.value &&\n      compare(\n        recentRelease.value.version,\n        currentComfyUIVersion.value || '0.0.0'\n      ) === 0\n  )\n\n  const hasMediumOrHighAttention = computed(() => {\n    const attention = recentRelease.value?.attention\n    return attention === 'medium' || attention === 'high'\n  })\n\n  // Show toast if needed\n  const shouldShowToast = computed(() => {\n    // Only show on desktop version\n    if (!isElectron() || isCloud) {\n      return false\n    }\n\n    // Skip if notifications are disabled\n    if (!showVersionUpdates.value) {\n      return false\n    }\n\n    if (!isNewVersionAvailable.value) {\n      return false\n    }\n\n    // Skip if low attention\n    if (!hasMediumOrHighAttention.value) {\n      return false\n    }\n\n    // Skip if user already skipped or changelog seen\n    if (\n      releaseVersion.value === recentRelease.value?.version &&\n      ['skipped', 'changelog seen'].includes(releaseStatus.value)\n    ) {\n      return false\n    }\n\n    return true\n  })\n\n  // Show red-dot indicator\n  const shouldShowRedDot = computed(() => {\n    // Only show on desktop version\n    if (!isElectron() || isCloud) {\n      return false\n    }\n\n    // Skip if notifications are disabled\n    if (!showVersionUpdates.value) {\n      return false\n    }\n\n    // Already latest  no dot\n    if (!isNewVersionAvailable.value) {\n      return false\n    }\n\n    const { version } = recentRelease.value\n\n    // Changelog seen  clear dot\n    if (\n      releaseVersion.value === version &&\n      releaseStatus.value === 'changelog seen'\n    ) {\n      return false\n    }\n\n    // Attention medium / high (levels 2 & 3)\n    if (hasMediumOrHighAttention.value) {\n      // Persist until changelog is opened\n      return true\n    }\n\n    // Attention low (level 1) and skipped  keep up to 3 d\n    if (\n      releaseVersion.value === version &&\n      releaseStatus.value === 'skipped' &&\n      releaseTimestamp.value &&\n      Date.now() - releaseTimestamp.value >= THREE_DAYS_MS\n    ) {\n      return false\n    }\n\n    // Not skipped  show\n    return true\n  })\n\n  // Show \"What's New\" popup\n  const shouldShowPopup = computed(() => {\n    // Only show on desktop version\n    if (!isElectron() || isCloud) {\n      return false\n    }\n\n    // Skip if notifications are disabled\n    if (!showVersionUpdates.value) {\n      return false\n    }\n\n    if (!isLatestVersion.value) {\n      return false\n    }\n\n    // Hide if already seen\n    if (\n      releaseVersion.value === recentRelease.value.version &&\n      releaseStatus.value === \"what's new seen\"\n    ) {\n      return false\n    }\n\n    return true\n  })\n\n  // Action handlers for user interactions\n  async function handleSkipRelease(version: string): Promise<void> {\n    if (\n      version !== recentRelease.value?.version ||\n      releaseStatus.value === 'changelog seen'\n    ) {\n      return\n    }\n\n    await settingStore.set('Comfy.Release.Version', version)\n    await settingStore.set('Comfy.Release.Status', 'skipped')\n    await settingStore.set('Comfy.Release.Timestamp', Date.now())\n  }\n\n  async function handleShowChangelog(version: string): Promise<void> {\n    if (version !== recentRelease.value?.version) {\n      return\n    }\n\n    await settingStore.set('Comfy.Release.Version', version)\n    await settingStore.set('Comfy.Release.Status', 'changelog seen')\n    await settingStore.set('Comfy.Release.Timestamp', Date.now())\n  }\n\n  async function handleWhatsNewSeen(version: string): Promise<void> {\n    if (version !== recentRelease.value?.version) {\n      return\n    }\n\n    await settingStore.set('Comfy.Release.Version', version)\n    await settingStore.set('Comfy.Release.Status', \"what's new seen\")\n    await settingStore.set('Comfy.Release.Timestamp', Date.now())\n  }\n\n  // Fetch releases from API\n  async function fetchReleases(): Promise<void> {\n    if (isLoading.value) {\n      return\n    }\n\n    // Skip fetching if notifications are disabled\n    if (!showVersionUpdates.value) {\n      return\n    }\n\n    // Skip fetching if API nodes are disabled via argv\n    if (\n      systemStatsStore.systemStats?.system?.argv?.includes(\n        '--disable-api-nodes'\n      )\n    ) {\n      return\n    }\n    isLoading.value = true\n    error.value = null\n\n    try {\n      // Ensure system stats are loaded\n      if (!systemStatsStore.systemStats) {\n        await until(systemStatsStore.isInitialized)\n      }\n\n      const fetchedReleases = await releaseService.getReleases({\n        project: 'comfyui',\n        current_version: currentComfyUIVersion.value,\n        form_factor: systemStatsStore.getFormFactor(),\n        locale: stringToLocale(locale.value)\n      })\n\n      if (fetchedReleases !== null) {\n        releases.value = fetchedReleases\n      } else if (releaseService.error.value) {\n        error.value = releaseService.error.value\n      }\n    } catch (err) {\n      error.value =\n        err instanceof Error ? err.message : 'Unknown error occurred'\n    } finally {\n      isLoading.value = false\n    }\n  }\n\n  // Initialize store\n  async function initialize(): Promise<void> {\n    await fetchReleases()\n  }\n\n  return {\n    releases,\n    isLoading,\n    error,\n    recentRelease,\n    recentReleases,\n    shouldShowToast,\n    shouldShowRedDot,\n    shouldShowPopup,\n    shouldShowUpdateButton: isNewVersionAvailable,\n    handleSkipRelease,\n    handleShowChangelog,\n    handleWhatsNewSeen,\n    fetchReleases,\n    initialize\n  }\n})\n","<template>\n  <div\n    class=\"help-center-menu\"\n    role=\"menu\"\n    :aria-label=\"$t('helpCenter.helpFeedback')\"\n  >\n    <!-- Main Menu Items -->\n    <nav class=\"help-menu-section\" role=\"menubar\">\n      <button\n        v-for=\"menuItem in menuItems\"\n        v-show=\"menuItem.visible !== false\"\n        :key=\"menuItem.key\"\n        type=\"button\"\n        class=\"help-menu-item\"\n        :class=\"{ 'more-item': menuItem.key === 'more' }\"\n        role=\"menuitem\"\n        @click=\"menuItem.action\"\n        @mouseenter=\"onMenuItemHover(menuItem.key, $event)\"\n        @mouseleave=\"onMenuItemLeave(menuItem.key)\"\n      >\n        <div class=\"help-menu-icon-container\">\n          <div class=\"help-menu-icon\">\n            <component\n              :is=\"menuItem.icon\"\n              v-if=\"typeof menuItem.icon === 'object'\"\n              :size=\"16\"\n            />\n            <i v-else :class=\"menuItem.icon\" />\n          </div>\n          <div v-if=\"menuItem.showRedDot\" class=\"menu-red-dot\" />\n        </div>\n        <span class=\"menu-label\">{{ menuItem.label }}</span>\n        <i v-if=\"menuItem.key === 'more'\" class=\"pi pi-chevron-right\" />\n      </button>\n    </nav>\n\n    <!-- More Submenu -->\n    <Teleport to=\"body\">\n      <div\n        v-if=\"isSubmenuVisible\"\n        ref=\"submenuRef\"\n        class=\"more-submenu\"\n        :style=\"submenuStyle\"\n        @mouseenter=\"onSubmenuHover\"\n        @mouseleave=\"onSubmenuLeave\"\n      >\n        <template\n          v-for=\"submenuItem in moreMenuItem?.items\"\n          :key=\"submenuItem.key\"\n        >\n          <div\n            v-if=\"submenuItem.type === 'divider'\"\n            v-show=\"submenuItem.visible !== false\"\n            class=\"submenu-divider\"\n          />\n          <button\n            v-else\n            v-show=\"submenuItem.visible !== false\"\n            type=\"button\"\n            class=\"help-menu-item submenu-item\"\n            role=\"menuitem\"\n            @click=\"submenuItem.action\"\n          >\n            <span class=\"menu-label\">{{ submenuItem.label }}</span>\n          </button>\n        </template>\n      </div>\n    </Teleport>\n\n    <!-- What's New Section -->\n    <section v-if=\"showVersionUpdates\" class=\"whats-new-section\">\n      <h3 class=\"section-description\">{{ $t('helpCenter.whatsNew') }}</h3>\n\n      <!-- Release Items -->\n      <div\n        v-if=\"hasReleases\"\n        role=\"group\"\n        :aria-label=\"$t('helpCenter.recentReleases')\"\n      >\n        <article\n          v-for=\"release in releaseStore.recentReleases\"\n          :key=\"release.id || release.version\"\n          class=\"help-menu-item release-menu-item\"\n          role=\"button\"\n          tabindex=\"0\"\n          @click=\"onReleaseClick(release)\"\n          @keydown.enter=\"onReleaseClick(release)\"\n          @keydown.space.prevent=\"onReleaseClick(release)\"\n        >\n          <i class=\"pi pi-refresh help-menu-icon\" aria-hidden=\"true\" />\n          <div class=\"release-content\">\n            <span class=\"release-title\">\n              {{\n                $t('g.releaseTitle', {\n                  package: 'Comfy',\n                  version: release.version\n                })\n              }}\n            </span>\n            <time class=\"release-date\" :datetime=\"release.published_at\">\n              <span class=\"normal-state\">\n                {{ formatReleaseDate(release.published_at) }}\n              </span>\n              <span class=\"hover-state\">\n                {{ $t('helpCenter.clickToLearnMore') }}\n              </span>\n            </time>\n          </div>\n          <Button\n            v-if=\"shouldShowUpdateButton(release)\"\n            :label=\"$t('helpCenter.updateAvailable')\"\n            size=\"small\"\n            class=\"update-button\"\n            @click.stop=\"onUpdate(release)\"\n          />\n        </article>\n      </div>\n\n      <!-- Loading State -->\n      <div\n        v-else-if=\"releaseStore.isLoading\"\n        class=\"help-menu-item\"\n        role=\"status\"\n        aria-live=\"polite\"\n      >\n        <i class=\"pi pi-spin pi-spinner help-menu-icon\" aria-hidden=\"true\" />\n        <span>{{ $t('helpCenter.loadingReleases') }}</span>\n      </div>\n\n      <!-- No Releases State -->\n      <div v-else class=\"help-menu-item\" role=\"status\">\n        <i class=\"pi pi-info-circle help-menu-icon\" aria-hidden=\"true\" />\n        <span>{{ $t('helpCenter.noRecentReleases') }}</span>\n      </div>\n    </section>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport Button from 'primevue/button'\nimport { computed, nextTick, onBeforeUnmount, onMounted, ref } from 'vue'\nimport type { CSSProperties, Component } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport PuzzleIcon from '@/components/icons/PuzzleIcon.vue'\nimport { useExternalLink } from '@/composables/useExternalLink'\nimport { isCloud } from '@/platform/distribution/types'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useTelemetry } from '@/platform/telemetry'\nimport type { ReleaseNote } from '@/platform/updates/common/releaseService'\nimport { useReleaseStore } from '@/platform/updates/common/releaseStore'\nimport { useCommandStore } from '@/stores/commandStore'\nimport { electronAPI, isElectron } from '@/utils/envUtil'\nimport { formatVersionAnchor } from '@/utils/formatUtil'\nimport { useConflictAcknowledgment } from '@/workbench/extensions/manager/composables/useConflictAcknowledgment'\nimport { useManagerState } from '@/workbench/extensions/manager/composables/useManagerState'\nimport { ManagerTab } from '@/workbench/extensions/manager/types/comfyManagerTypes'\n\n// Types\ninterface MenuItem {\n  key: string\n  icon?: string | Component\n  label?: string\n  action?: () => void\n  visible?: boolean\n  type?: 'item' | 'divider'\n  items?: MenuItem[]\n  showRedDot?: boolean\n}\n\n// Constants\nconst TIME_UNITS = {\n  MINUTE: 60 * 1000,\n  HOUR: 60 * 60 * 1000,\n  DAY: 24 * 60 * 60 * 1000,\n  WEEK: 7 * 24 * 60 * 60 * 1000,\n  MONTH: 30 * 24 * 60 * 60 * 1000,\n  YEAR: 365 * 24 * 60 * 60 * 1000\n} as const\n\nconst SUBMENU_CONFIG = {\n  DELAY_MS: 100,\n  OFFSET_PX: 8,\n  Z_INDEX: 10001\n} as const\n\n// Composables\nconst { t } = useI18n()\nconst { staticUrls, buildDocsUrl } = useExternalLink()\nconst releaseStore = useReleaseStore()\nconst commandStore = useCommandStore()\nconst settingStore = useSettingStore()\nconst telemetry = useTelemetry()\n\n// Emits\nconst emit = defineEmits<{\n  close: []\n}>()\n\n// State\nconst isSubmenuVisible = ref(false)\nconst submenuRef = ref<HTMLElement | null>(null)\nconst submenuStyle = ref<CSSProperties>({})\nlet hoverTimeout: number | null = null\nconst openedAt = ref<number>(Date.now())\n\n// Computed\nconst hasReleases = computed(() => releaseStore.releases.length > 0)\nconst showVersionUpdates = computed(() =>\n  settingStore.get('Comfy.Notification.ShowVersionUpdates')\n)\n\n// Use conflict acknowledgment state from composable\nconst { shouldShowRedDot: shouldShowManagerRedDot } =\n  useConflictAcknowledgment()\n\nconst moreItems = computed<MenuItem[]>(() => {\n  const allMoreItems: MenuItem[] = [\n    {\n      key: 'desktop-guide',\n      type: 'item',\n      label: t('helpCenter.desktopUserGuide'),\n      visible: isElectron(),\n      action: () => {\n        trackResourceClick('docs', true)\n        openExternalLink(\n          buildDocsUrl('/installation/desktop', {\n            includeLocale: true,\n            platform: true\n          })\n        )\n        emit('close')\n      }\n    },\n    {\n      key: 'dev-tools',\n      type: 'item',\n      label: t('helpCenter.openDevTools'),\n      visible: isElectron(),\n      action: () => {\n        openDevTools()\n        emit('close')\n      }\n    },\n    {\n      key: 'divider-1',\n      type: 'divider',\n      visible: isElectron()\n    },\n    {\n      key: 'reinstall',\n      type: 'item',\n      label: t('helpCenter.reinstall'),\n      visible: isElectron(),\n      action: () => {\n        onReinstall()\n        emit('close')\n      }\n    }\n  ]\n\n  // Filter for visible items only\n  return allMoreItems.filter((item) => item.visible !== false)\n})\n\nconst hasVisibleMoreItems = computed(() => {\n  return !!moreItems.value.length\n})\n\nconst moreMenuItem = computed(() =>\n  menuItems.value.find((item) => item.key === 'more')\n)\n\nconst menuItems = computed<MenuItem[]>(() => {\n  const items: MenuItem[] = [\n    {\n      key: 'docs',\n      type: 'item',\n      icon: 'pi pi-book',\n      label: t('helpCenter.docs'),\n      action: () => {\n        trackResourceClick('docs', true)\n        openExternalLink(buildDocsUrl('/', { includeLocale: true }))\n        emit('close')\n      }\n    },\n    {\n      key: 'discord',\n      type: 'item',\n      icon: 'pi pi-discord',\n      label: 'Discord',\n      action: () => {\n        trackResourceClick('discord', true)\n        openExternalLink(staticUrls.discord)\n        emit('close')\n      }\n    },\n    {\n      key: 'github',\n      type: 'item',\n      icon: 'pi pi-github',\n      label: t('helpCenter.github'),\n      action: () => {\n        trackResourceClick('github', true)\n        openExternalLink(staticUrls.github)\n        emit('close')\n      }\n    },\n    {\n      key: 'help',\n      type: 'item',\n      icon: 'pi pi-question-circle',\n      label: t('helpCenter.helpFeedback'),\n      action: () => {\n        trackResourceClick('help_feedback', false)\n        void commandStore.execute('Comfy.ContactSupport')\n        emit('close')\n      }\n    }\n  ]\n\n  // Extension manager - only in non-cloud distributions\n  if (!isCloud) {\n    items.push({\n      key: 'manager',\n      type: 'item',\n      icon: PuzzleIcon,\n      label: t('helpCenter.managerExtension'),\n      showRedDot: shouldShowManagerRedDot.value,\n      action: async () => {\n        trackResourceClick('manager', false)\n        await useManagerState().openManager({\n          initialTab: ManagerTab.All,\n          showToastOnLegacyError: false\n        })\n        emit('close')\n      }\n    })\n  }\n\n  items.push({\n    key: 'more',\n    type: 'item',\n    icon: '',\n    label: t('helpCenter.more'),\n    visible: hasVisibleMoreItems.value,\n    action: () => {}, // No action for more item\n    items: moreItems.value\n  })\n\n  return items\n})\n\n// Utility Functions\nconst trackResourceClick = (\n  resourceType:\n    | 'docs'\n    | 'discord'\n    | 'github'\n    | 'help_feedback'\n    | 'manager'\n    | 'release_notes',\n  isExternal: boolean\n): void => {\n  telemetry?.trackHelpResourceClicked({\n    resource_type: resourceType,\n    is_external: isExternal,\n    source: 'help_center'\n  })\n}\n\nconst openExternalLink = (url: string): void => {\n  window.open(url, '_blank', 'noopener,noreferrer')\n}\n\nconst clearHoverTimeout = (): void => {\n  if (hoverTimeout) {\n    clearTimeout(hoverTimeout)\n    hoverTimeout = null\n  }\n}\n\nconst calculateSubmenuPosition = (button: HTMLElement): CSSProperties => {\n  const rect = button.getBoundingClientRect()\n  const submenuWidth = 210 // Width defined in CSS\n\n  // Get actual submenu height if available, otherwise estimate based on visible item count\n  const visibleItemCount =\n    moreMenuItem.value?.items?.filter((item) => item.visible !== false)\n      .length || 0\n  const estimatedHeight = visibleItemCount * 48 + 16 // ~48px per item + padding\n  const submenuHeight = submenuRef.value?.offsetHeight || estimatedHeight\n\n  // Get viewport dimensions\n  const viewportWidth = window.innerWidth\n  const viewportHeight = window.innerHeight\n\n  // Calculate basic position (aligned with button)\n  let top = rect.top\n  let left = rect.right + SUBMENU_CONFIG.OFFSET_PX\n\n  // Check if submenu would overflow viewport on the right\n  if (left + submenuWidth > viewportWidth) {\n    // Position submenu to the left of the button instead\n    left = rect.left - submenuWidth - SUBMENU_CONFIG.OFFSET_PX\n  }\n\n  // Check if submenu would overflow viewport at the bottom\n  if (top + submenuHeight > viewportHeight) {\n    // Position submenu above the button, aligned to bottom\n    top = Math.max(\n      SUBMENU_CONFIG.OFFSET_PX, // Minimum distance from top of viewport\n      rect.bottom - submenuHeight\n    )\n  }\n\n  // Ensure submenu doesn't go above viewport\n  if (top < SUBMENU_CONFIG.OFFSET_PX) {\n    top = SUBMENU_CONFIG.OFFSET_PX\n  }\n\n  top -= 8\n\n  return {\n    position: 'fixed',\n    top: `${top}px`,\n    left: `${left}px`,\n    zIndex: SUBMENU_CONFIG.Z_INDEX\n  }\n}\n\nconst formatReleaseDate = (dateString?: string): string => {\n  if (!dateString) return 'date'\n\n  const date = new Date(dateString)\n  const now = new Date()\n  const diffTime = Math.abs(now.getTime() - date.getTime())\n\n  const timeUnits = [\n    { unit: TIME_UNITS.YEAR, suffix: 'y' },\n    { unit: TIME_UNITS.MONTH, suffix: 'mo' },\n    { unit: TIME_UNITS.WEEK, suffix: 'w' },\n    { unit: TIME_UNITS.DAY, suffix: 'd' },\n    { unit: TIME_UNITS.HOUR, suffix: 'h' },\n    { unit: TIME_UNITS.MINUTE, suffix: 'min' }\n  ]\n\n  for (const { unit, suffix } of timeUnits) {\n    const value = Math.floor(diffTime / unit)\n    if (value > 0) {\n      return `${value}${suffix} ago`\n    }\n  }\n\n  return 'now'\n}\n\nconst shouldShowUpdateButton = (release: ReleaseNote): boolean => {\n  // Hide update buttons in cloud distribution\n  if (isCloud) return false\n\n  return (\n    releaseStore.shouldShowUpdateButton &&\n    release === releaseStore.recentReleases[0]\n  )\n}\n\n// Event Handlers\nconst onMenuItemHover = async (\n  key: string,\n  event: MouseEvent\n): Promise<void> => {\n  if (key !== 'more' || !moreMenuItem.value?.items) return\n\n  // Don't show submenu if all items are hidden\n  const hasVisibleItems = moreMenuItem.value.items.some(\n    (item) => item.visible !== false\n  )\n  if (!hasVisibleItems) return\n\n  clearHoverTimeout()\n\n  const moreButton = event.currentTarget as HTMLElement\n\n  // Calculate initial position before showing submenu\n  submenuStyle.value = calculateSubmenuPosition(moreButton)\n\n  // Show submenu with correct position\n  isSubmenuVisible.value = true\n\n  // After submenu is rendered, refine position if needed\n  await nextTick()\n  if (submenuRef.value) {\n    submenuStyle.value = calculateSubmenuPosition(moreButton)\n  }\n}\n\nconst onMenuItemLeave = (key: string): void => {\n  if (key !== 'more') return\n\n  hoverTimeout = window.setTimeout(() => {\n    isSubmenuVisible.value = false\n  }, SUBMENU_CONFIG.DELAY_MS)\n}\n\nconst onSubmenuHover = (): void => {\n  clearHoverTimeout()\n}\n\nconst onSubmenuLeave = (): void => {\n  isSubmenuVisible.value = false\n}\n\nconst openDevTools = (): void => {\n  if (isElectron()) {\n    electronAPI().openDevTools()\n  }\n}\n\nconst onReinstall = (): void => {\n  if (isElectron()) {\n    void electronAPI().reinstall()\n  }\n}\n\nconst onReleaseClick = (release: ReleaseNote): void => {\n  trackResourceClick('release_notes', true)\n  void releaseStore.handleShowChangelog(release.version)\n  const versionAnchor = formatVersionAnchor(release.version)\n  const changelogUrl = `${buildDocsUrl('/changelog', { includeLocale: true })}#${versionAnchor}`\n  openExternalLink(changelogUrl)\n  emit('close')\n}\n\nconst onUpdate = (_: ReleaseNote): void => {\n  trackResourceClick('docs', true)\n  openExternalLink(\n    buildDocsUrl('/installation/update_comfyui', { includeLocale: true })\n  )\n  emit('close')\n}\n\n// Lifecycle\nonMounted(async () => {\n  telemetry?.trackHelpCenterOpened({ source: 'sidebar' })\n  if (!hasReleases.value) {\n    await releaseStore.fetchReleases()\n  }\n})\n\nonBeforeUnmount(() => {\n  const timeSpentSeconds = Math.round((Date.now() - openedAt.value) / 1000)\n  telemetry?.trackHelpCenterClosed({ time_spent_seconds: timeSpentSeconds })\n})\n</script>\n\n<style scoped>\n.help-center-menu {\n  width: 380px;\n  max-height: 500px;\n  overflow-y: auto;\n  background: var(--p-content-background);\n  border-radius: 12px;\n  box-shadow: 0 8px 32px rgb(0 0 0 / 0.15);\n  border: 1px solid var(--p-content-border-color);\n  backdrop-filter: blur(8px);\n  position: relative;\n}\n\n.help-menu-section {\n  padding: 0.5rem 0;\n  border-bottom: 1px solid var(--p-content-border-color);\n}\n\n.help-menu-item {\n  display: flex;\n  align-items: center;\n  width: 100%;\n  padding: 0.75rem 1rem;\n  background: transparent;\n  border: none;\n  cursor: pointer;\n  transition: background-color 0.2s;\n  font-size: 0.9rem;\n  color: inherit;\n  text-align: left;\n}\n\n.help-menu-item:hover {\n  background-color: #007aff26;\n}\n\n.help-menu-item:focus,\n.help-menu-item:focus-visible {\n  outline: none;\n  box-shadow: none;\n}\n\n.help-menu-icon-container {\n  position: relative;\n  margin-right: 0.75rem;\n  width: 16px;\n  flex-shrink: 0;\n}\n\n.help-menu-icon {\n  margin-right: 0.75rem;\n  font-size: 1rem;\n  color: var(--p-text-muted-color);\n  width: 16px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex-shrink: 0;\n}\n\n.help-menu-icon svg {\n  color: var(--p-text-muted-color);\n}\n\n.menu-red-dot {\n  position: absolute;\n  top: -2px;\n  right: -2px;\n  width: 8px;\n  height: 8px;\n  background: #ff3b30;\n  border-radius: 50%;\n  border: 1.5px solid var(--p-content-background);\n  z-index: 1;\n}\n\n.menu-label {\n  flex: 1;\n}\n\n.more-item {\n  justify-content: space-between;\n}\n\n.whats-new-section {\n  padding: 0.5rem 0;\n}\n\n.section-description {\n  font-size: 0.8rem;\n  font-weight: 600;\n  color: var(--p-text-muted-color);\n  margin: 0 0 0.5rem;\n  padding: 0 1rem;\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n}\n\n.release-menu-item {\n  position: relative;\n}\n\n.release-content {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  gap: 0.25rem;\n  min-width: 0;\n}\n\n.release-title {\n  font-size: 0.9rem;\n  line-height: 1.2;\n  font-weight: 500;\n}\n\n.release-date {\n  height: 16px;\n  font-size: 0.75rem;\n  color: var(--p-text-muted-color);\n}\n\n.release-date .hover-state {\n  display: none;\n}\n\n.release-menu-item:hover .release-date .normal-state,\n.release-menu-item:focus-within .release-date .normal-state {\n  display: none;\n}\n\n.release-menu-item:hover .release-date .hover-state,\n.release-menu-item:focus-within .release-date .hover-state {\n  display: inline;\n}\n\n.update-button {\n  margin-left: 0.5rem;\n  font-size: 0.8rem;\n  padding: 0.25rem 0.75rem;\n  flex-shrink: 0;\n}\n\n/* Submenu Styles */\n.more-submenu {\n  width: 210px;\n  padding: 0.5rem 0;\n  background: var(--p-content-background);\n  border-radius: 12px;\n  border: 1px solid var(--p-content-border-color);\n  box-shadow: 0 8px 32px rgb(0 0 0 / 0.15);\n  overflow: hidden;\n  transition: opacity 0.15s ease-out;\n}\n\n.submenu-item {\n  padding: 0.75rem 1rem;\n  color: inherit;\n  font-size: 0.9rem;\n  font-weight: inherit;\n  line-height: inherit;\n}\n\n.submenu-item:hover {\n  background-color: #007aff26;\n}\n\n.submenu-item:focus,\n.submenu-item:focus-visible {\n  outline: none;\n  box-shadow: none;\n}\n\n.submenu-divider {\n  height: 1px;\n  background: #3e3e3e;\n  margin: 0.5rem 0;\n}\n\n/* Scrollbar Styling */\n.help-center-menu::-webkit-scrollbar {\n  width: 6px;\n}\n\n.help-center-menu::-webkit-scrollbar-track {\n  background: transparent;\n}\n\n.help-center-menu::-webkit-scrollbar-thumb {\n  background: var(--p-content-border-color);\n  border-radius: 3px;\n}\n\n.help-center-menu::-webkit-scrollbar-thumb:hover {\n  background: var(--p-text-muted-color);\n}\n\n/* Reduced Motion */\n@media (prefers-reduced-motion: reduce) {\n  .help-menu-item {\n    transition: none;\n  }\n}\n</style>\n","<template>\n  <div v-if=\"shouldShow\" class=\"release-toast-popup\">\n    <div class=\"release-notification-toast\">\n      <!-- Header section with icon and text -->\n      <div class=\"toast-header\">\n        <div class=\"toast-icon\">\n          <i class=\"pi pi-download\" />\n        </div>\n        <div class=\"toast-text\">\n          <div class=\"toast-title\">\n            {{ $t('releaseToast.newVersionAvailable') }}\n          </div>\n          <div class=\"toast-version-badge\">\n            {{ latestRelease?.version }}\n          </div>\n        </div>\n      </div>\n\n      <!-- Actions section -->\n      <div class=\"toast-actions-section\">\n        <div class=\"actions-row\">\n          <div class=\"left-actions\">\n            <a\n              class=\"learn-more-link\"\n              :href=\"changelogUrl\"\n              target=\"_blank\"\n              rel=\"noopener,noreferrer\"\n              @click=\"handleLearnMore\"\n            >\n              {{ $t('releaseToast.whatsNew') }}\n            </a>\n          </div>\n          <div class=\"right-actions\">\n            <button class=\"skip-button\" @click=\"handleSkip\">\n              {{ $t('releaseToast.skip') }}\n            </button>\n            <button class=\"cta-button\" @click=\"handleUpdate\">\n              {{ $t('releaseToast.update') }}\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, onMounted, ref, watch } from 'vue'\n\nimport { useExternalLink } from '@/composables/useExternalLink'\nimport { formatVersionAnchor } from '@/utils/formatUtil'\n\nimport type { ReleaseNote } from '../common/releaseService'\nimport { useReleaseStore } from '../common/releaseStore'\n\nconst { buildDocsUrl } = useExternalLink()\nconst releaseStore = useReleaseStore()\n\n// Local state for dismissed status\nconst isDismissed = ref(false)\n\n// Get latest release from store\nconst latestRelease = computed<ReleaseNote | null>(\n  () => releaseStore.recentRelease\n)\n\n// Show toast when new version available and not dismissed\nconst shouldShow = computed(\n  () => releaseStore.shouldShowToast && !isDismissed.value\n)\n\n// Generate changelog URL with version anchor (language-aware)\nconst changelogUrl = computed(() => {\n  const changelogBaseUrl = buildDocsUrl('/changelog', { includeLocale: true })\n  if (latestRelease.value?.version) {\n    const versionAnchor = formatVersionAnchor(latestRelease.value.version)\n    return `${changelogBaseUrl}#${versionAnchor}`\n  }\n  return changelogBaseUrl\n})\n\n// Auto-hide timer\nlet hideTimer: ReturnType<typeof setTimeout> | null = null\n\nconst startAutoHide = () => {\n  if (hideTimer) clearTimeout(hideTimer)\n  hideTimer = setTimeout(() => {\n    dismissToast()\n  }, 8000) // 8 second auto-hide\n}\n\nconst clearAutoHide = () => {\n  if (hideTimer) {\n    clearTimeout(hideTimer)\n    hideTimer = null\n  }\n}\n\nconst dismissToast = () => {\n  isDismissed.value = true\n  clearAutoHide()\n}\n\nconst handleSkip = () => {\n  if (latestRelease.value) {\n    void releaseStore.handleSkipRelease(latestRelease.value.version)\n  }\n  dismissToast()\n}\n\nconst handleLearnMore = () => {\n  if (latestRelease.value) {\n    void releaseStore.handleShowChangelog(latestRelease.value.version)\n  }\n  // Do not dismiss; anchor will navigate in new tab but keep toast? spec maybe wants dismiss? We'll dismiss.\n  dismissToast()\n}\n\nconst handleUpdate = () => {\n  window.open(\n    buildDocsUrl('/installation/update_comfyui', { includeLocale: true }),\n    '_blank'\n  )\n  dismissToast()\n}\n\n// Learn more handled by anchor href\n\n// Start auto-hide when toast becomes visible\nwatch(shouldShow, (isVisible) => {\n  if (isVisible) {\n    startAutoHide()\n  } else {\n    clearAutoHide()\n  }\n})\n\n// Initialize on mount\nonMounted(async () => {\n  // Fetch releases if not already loaded\n  if (!releaseStore.releases.length) {\n    await releaseStore.fetchReleases()\n  }\n})\n</script>\n\n<style scoped>\n/* Toast popup - positioning handled by parent */\n.release-toast-popup {\n  position: absolute;\n  bottom: 1rem;\n  z-index: 1000;\n  pointer-events: auto;\n}\n\n/* Sidebar positioning classes applied by parent - matching help center */\n.release-toast-popup.sidebar-left {\n  left: 1rem;\n}\n\n.release-toast-popup.sidebar-left.small-sidebar {\n  left: 1rem;\n}\n\n.release-toast-popup.sidebar-right {\n  right: 1rem;\n}\n\n/* Main toast container */\n.release-notification-toast {\n  width: 448px;\n  padding: 16px 16px 8px;\n  background: #353535;\n  box-shadow: 0 4px 4px rgb(0 0 0 / 0.25);\n  border-radius: 12px;\n  outline: 1px solid #4e4e4e;\n  outline-offset: -1px;\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n\n/* Header section */\n.toast-header {\n  display: flex;\n  gap: 16px;\n  align-items: flex-start;\n}\n\n/* Icon container */\n.toast-icon {\n  width: 42px;\n  height: 42px;\n  padding: 10px;\n  background: rgb(0 122 255 / 0.2);\n  border-radius: 8px;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n.toast-icon i {\n  color: #007aff;\n  font-size: 16px;\n}\n\n/* Text content */\n.toast-text {\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  gap: 4px;\n}\n\n.toast-title {\n  color: white;\n  font-size: 14px;\n  font-family: 'Satoshi', sans-serif;\n  font-weight: 500;\n  line-height: 18.2px;\n}\n\n.toast-version-badge {\n  color: #a0a1a2;\n  font-size: 12px;\n  font-family: 'Satoshi', sans-serif;\n  font-weight: 500;\n  line-height: 15.6px;\n}\n\n/* Actions section */\n.toast-actions-section {\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n}\n\n.actions-row {\n  padding-left: 58px; /* Align with text content */\n  padding-right: 0;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n}\n\n.left-actions {\n  display: flex;\n  align-items: center;\n}\n\n/* Learn more link - simple text link */\n.learn-more-link {\n  color: #60a5fa;\n  font-size: 12px;\n  font-family: 'Inter', sans-serif;\n  font-weight: 500;\n  line-height: 15.6px;\n  text-decoration: none;\n}\n\n.learn-more-link:hover {\n  text-decoration: underline;\n}\n\n.right-actions {\n  display: flex;\n  gap: 8px;\n  align-items: center;\n}\n\n/* Button styles */\n.skip-button {\n  padding: 8px 16px;\n  background: #353535;\n  border-radius: 6px;\n  outline: 1px solid #4e4e4e;\n  outline-offset: -1px;\n  border: none;\n  color: #aeaeb2;\n  font-size: 12px;\n  font-family: 'Inter', sans-serif;\n  font-weight: 500;\n  cursor: pointer;\n}\n\n.skip-button:hover {\n  background: #404040;\n}\n\n.cta-button {\n  padding: 8px 16px;\n  background: white;\n  border-radius: 6px;\n  outline: 1px solid #4e4e4e;\n  outline-offset: -1px;\n  border: none;\n  color: black;\n  font-size: 12px;\n  font-family: 'Inter', sans-serif;\n  font-weight: 500;\n  cursor: pointer;\n}\n\n.cta-button:hover {\n  background: #f0f0f0;\n}\n</style>\n","<template>\n  <div v-if=\"shouldShow\" class=\"whats-new-popup-container\">\n    <!-- Arrow pointing to help center -->\n    <div class=\"help-center-arrow\">\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        width=\"16\"\n        height=\"19\"\n        viewBox=\"0 0 16 19\"\n        fill=\"none\"\n      >\n        <!-- Arrow fill -->\n        <path\n          d=\"M15.25 1.27246L15.25 17.7275L0.999023 9.5L15.25 1.27246Z\"\n          fill=\"#353535\"\n        />\n        <!-- Top and bottom outlines only -->\n        <path\n          d=\"M15.25 1.27246L0.999023 9.5\"\n          stroke=\"#4e4e4e\"\n          stroke-width=\"1\"\n          fill=\"none\"\n        />\n        <path\n          d=\"M0.999023 9.5L15.25 17.7275\"\n          stroke=\"#4e4e4e\"\n          stroke-width=\"1\"\n          fill=\"none\"\n        />\n      </svg>\n    </div>\n\n    <div class=\"whats-new-popup\" @click.stop>\n      <!-- Close Button -->\n      <button\n        class=\"close-button\"\n        :aria-label=\"$t('g.close')\"\n        @click=\"closePopup\"\n      >\n        <div class=\"close-icon\"></div>\n      </button>\n\n      <!-- Release Content -->\n      <div class=\"popup-content\">\n        <div class=\"content-text\" v-html=\"formattedContent\"></div>\n\n        <!-- Actions Section -->\n        <div class=\"popup-actions\">\n          <a\n            class=\"learn-more-link\"\n            :href=\"changelogUrl\"\n            target=\"_blank\"\n            rel=\"noopener,noreferrer\"\n            @click=\"closePopup\"\n          >\n            {{ $t('whatsNewPopup.learnMore') }}\n          </a>\n          <!-- TODO: CTA button -->\n          <!-- <button class=\"cta-button\" @click=\"handleCTA\">CTA</button> -->\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, onMounted, ref } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport { useExternalLink } from '@/composables/useExternalLink'\nimport { formatVersionAnchor } from '@/utils/formatUtil'\nimport { renderMarkdownToHtml } from '@/utils/markdownRendererUtil'\n\nimport type { ReleaseNote } from '../common/releaseService'\nimport { useReleaseStore } from '../common/releaseStore'\n\nconst { t } = useI18n()\nconst { buildDocsUrl } = useExternalLink()\nconst releaseStore = useReleaseStore()\n\n// Define emits\nconst emit = defineEmits<{\n  'whats-new-dismissed': []\n}>()\n\n// Local state for dismissed status\nconst isDismissed = ref(false)\n\n// Get latest release from store\nconst latestRelease = computed<ReleaseNote | null>(\n  () => releaseStore.recentRelease\n)\n\n// Show popup when on latest version and not dismissed\nconst shouldShow = computed(\n  () => releaseStore.shouldShowPopup && !isDismissed.value\n)\n\n// Generate changelog URL with version anchor (language-aware)\nconst changelogUrl = computed(() => {\n  const changelogBaseUrl = buildDocsUrl('/changelog', { includeLocale: true })\n  if (latestRelease.value?.version) {\n    const versionAnchor = formatVersionAnchor(latestRelease.value.version)\n    return `${changelogBaseUrl}#${versionAnchor}`\n  }\n  return changelogBaseUrl\n})\n\nconst formattedContent = computed(() => {\n  if (!latestRelease.value?.content) {\n    return `<p>${t('whatsNewPopup.noReleaseNotes')}</p>`\n  }\n\n  try {\n    return renderMarkdownToHtml(latestRelease.value.content)\n  } catch (error) {\n    console.error('Error parsing markdown:', error)\n    // Fallback to plain text with line breaks\n    return latestRelease.value.content.replace(/\\n/g, '<br>')\n  }\n})\n\nconst show = () => {\n  isDismissed.value = false\n}\n\nconst hide = () => {\n  isDismissed.value = true\n  emit('whats-new-dismissed')\n}\n\nconst closePopup = async () => {\n  // Mark \"what's new\" seen when popup is closed\n  if (latestRelease.value) {\n    await releaseStore.handleWhatsNewSeen(latestRelease.value.version)\n  }\n  hide()\n}\n\n// Initialize on mount\nonMounted(async () => {\n  // Fetch releases if not already loaded\n  if (!releaseStore.releases.length) {\n    await releaseStore.fetchReleases()\n  }\n})\n\n// Expose methods for parent component\ndefineExpose({\n  show,\n  hide\n})\n</script>\n\n<style scoped>\n/* Popup container - positioning handled by parent */\n.whats-new-popup-container {\n  --whats-new-popup-bottom: 1rem;\n\n  position: absolute;\n  bottom: var(--whats-new-popup-bottom);\n  z-index: 1000;\n  pointer-events: auto;\n}\n\n/* Arrow pointing to help center */\n.help-center-arrow {\n  position: absolute;\n  bottom: calc(\n    var(--sidebar-width) * 2 + var(--sidebar-width) / 2\n  ); /* Position to center of help center icon (2 icons below + half icon height for center) */\n  transform: none;\n  z-index: 999;\n  pointer-events: none;\n}\n\n/* Position arrow based on sidebar location */\n.whats-new-popup-container.sidebar-left .help-center-arrow {\n  left: -14px; /* Overlap with popup outline */\n}\n\n.whats-new-popup-container.sidebar-left.small-sidebar .help-center-arrow {\n  left: -14px; /* Overlap with popup outline */\n  bottom: calc(\n    var(--sidebar-width) * 2 + var(--sidebar-icon-size) / 2 -\n      var(--whats-new-popup-bottom)\n  ); /* Position to center of help center icon (2 icons below + half icon height for center - what's new popup bottom position ) */\n}\n\n/* Sidebar positioning classes applied by parent */\n.whats-new-popup-container.sidebar-left {\n  left: 1rem;\n}\n\n.whats-new-popup-container.sidebar-left.small-sidebar {\n  left: 1rem;\n}\n\n.whats-new-popup-container.sidebar-right {\n  right: 1rem;\n}\n\n.whats-new-popup {\n  background: #353535;\n  border-radius: 12px;\n  max-width: 400px;\n  width: 400px;\n  outline: 1px solid #4e4e4e;\n  outline-offset: -1px;\n  box-shadow: 0 8px 32px rgb(0 0 0 / 0.3);\n  position: relative;\n}\n\n/* Content Section */\n.popup-content {\n  display: flex;\n  flex-direction: column;\n  gap: 24px;\n  max-height: 80vh;\n  overflow-y: auto;\n  padding: 32px 32px 24px;\n  border-radius: 12px;\n}\n\n/* Close button */\n.close-button {\n  position: absolute;\n  top: 0;\n  right: 0;\n  width: 32px;\n  height: 32px;\n  padding: 6px;\n  background: #7c7c7c;\n  border-radius: 16px;\n  border: none;\n  cursor: pointer;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  transform: translate(30%, -30%);\n  transition:\n    background-color 0.2s ease,\n    transform 0.1s ease;\n  z-index: 1;\n}\n\n.close-button:hover {\n  background: #8e8e8e;\n}\n\n.close-button:active {\n  background: #6a6a6a;\n  transform: translate(30%, -30%) scale(0.95);\n}\n\n.close-icon {\n  width: 16px;\n  height: 16px;\n  position: relative;\n  opacity: 0.9;\n  transition: opacity 0.2s ease;\n}\n\n.close-button:hover .close-icon {\n  opacity: 1;\n}\n\n.close-icon::before,\n.close-icon::after {\n  content: '';\n  position: absolute;\n  width: 12px;\n  height: 2px;\n  background: white;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%) rotate(45deg);\n  transition: background-color 0.2s ease;\n}\n\n.close-icon::after {\n  transform: translate(-50%, -50%) rotate(-45deg);\n}\n\n.content-text {\n  color: white;\n  font-size: 14px;\n  line-height: 1.5;\n  word-wrap: break-word;\n}\n\n/* Style the markdown content */\n/* Title */\n.content-text :deep(*) {\n  box-sizing: border-box;\n  margin: 0;\n  padding: 0;\n}\n\n.content-text :deep(h1) {\n  font-size: 16px;\n  font-weight: 700;\n  margin-bottom: 8px;\n}\n\n/* Version subtitle - targets the first p tag after h1 */\n.content-text :deep(h1 + p) {\n  color: #c0c0c0;\n  font-size: 16px;\n  font-weight: 500;\n  margin-bottom: 16px;\n  opacity: 0.8;\n}\n\n/* Regular paragraphs - short description */\n.content-text :deep(p) {\n  margin-bottom: 16px;\n  color: #e0e0e0;\n}\n\n/* List */\n.content-text :deep(ul),\n.content-text :deep(ol) {\n  margin-bottom: 16px;\n  padding-left: 0;\n  list-style: none;\n}\n\n.content-text :deep(ul:first-child),\n.content-text :deep(ol:first-child) {\n  margin-top: 0;\n}\n\n.content-text :deep(ul:last-child),\n.content-text :deep(ol:last-child) {\n  margin-bottom: 0;\n}\n\n/* List items */\n.content-text :deep(li) {\n  margin-bottom: 8px;\n  position: relative;\n  padding-left: 20px;\n}\n\n.content-text :deep(li:last-child) {\n  margin-bottom: 0;\n}\n\n/* Custom bullet points */\n.content-text :deep(li::before) {\n  content: '';\n  position: absolute;\n  left: 0;\n  top: 10px;\n  display: flex;\n  width: 8px;\n  height: 8px;\n  justify-content: center;\n  align-items: center;\n  aspect-ratio: 1/1;\n  border-radius: 100px;\n  background: #60a5fa;\n}\n\n/* List item strong text */\n.content-text :deep(li strong) {\n  color: #fff;\n  font-size: 14px;\n  display: block;\n  margin-bottom: 4px;\n}\n\n.content-text :deep(li p) {\n  font-size: 12px;\n  margin-bottom: 0;\n  line-height: 2;\n}\n\n/* Code styling */\n.content-text :deep(code) {\n  background-color: #2a2a2a;\n  border: 1px solid #4a4a4a;\n  border-radius: 4px;\n  padding: 2px 6px;\n  color: #f8f8f2;\n  white-space: nowrap;\n}\n\n/* Remove top margin for first media element */\n.content-text :deep(img:first-child),\n.content-text :deep(video:first-child),\n.content-text :deep(iframe:first-child) {\n  margin-top: -32px; /* Align with the top edge of the popup content */\n  margin-bottom: 24px;\n}\n\n/* Media elements */\n.content-text :deep(img),\n.content-text :deep(video),\n.content-text :deep(iframe) {\n  width: calc(100% + 64px);\n  height: auto;\n  margin: 24px -32px;\n  display: block;\n}\n\n/* Actions Section */\n.popup-actions {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  gap: 8px;\n}\n\n.learn-more-link {\n  color: #60a5fa;\n  font-size: 14px;\n  font-weight: 500;\n  line-height: 18.2px;\n  text-decoration: none;\n}\n\n.learn-more-link:hover {\n  text-decoration: underline;\n}\n\n.cta-button {\n  height: 40px;\n  padding: 0 20px;\n  background: white;\n  border-radius: 6px;\n  outline: 1px solid #4e4e4e;\n  outline-offset: -1px;\n  border: none;\n  color: #121212;\n  font-size: 14px;\n  font-weight: 500;\n  cursor: pointer;\n}\n\n.cta-button:hover {\n  background: #f0f0f0;\n}\n</style>\n","import { defineStore } from 'pinia'\nimport { ref } from 'vue'\n\nexport const useHelpCenterStore = defineStore('helpCenter', () => {\n  const isVisible = ref(false)\n\n  const toggle = () => {\n    isVisible.value = !isVisible.value\n  }\n\n  const show = () => {\n    isVisible.value = true\n  }\n\n  const hide = () => {\n    isVisible.value = false\n  }\n\n  return {\n    isVisible,\n    toggle,\n    show,\n    hide\n  }\n})\n","<template>\n  <div>\n    <SidebarIcon\n      icon=\"pi pi-question-circle\"\n      class=\"comfy-help-center-btn\"\n      :label=\"$t('menu.help')\"\n      :tooltip=\"$t('sideToolbar.helpCenter')\"\n      :icon-badge=\"shouldShowRedDot ? '' : ''\"\n      :is-small=\"isSmall\"\n      @click=\"toggleHelpCenter\"\n    />\n\n    <!-- Help Center Popup positioned within canvas area -->\n    <Teleport to=\"#graph-canvas-container\">\n      <div\n        v-if=\"isHelpCenterVisible\"\n        class=\"help-center-popup\"\n        :class=\"{\n          'sidebar-left': sidebarLocation === 'left',\n          'sidebar-right': sidebarLocation === 'right',\n          'small-sidebar': isSmall\n        }\"\n      >\n        <HelpCenterMenuContent @close=\"closeHelpCenter\" />\n      </div>\n    </Teleport>\n\n    <!-- Release Notification Toast positioned within canvas area -->\n    <Teleport to=\"#graph-canvas-container\">\n      <ReleaseNotificationToast\n        :class=\"{\n          'sidebar-left': sidebarLocation === 'left',\n          'sidebar-right': sidebarLocation === 'right',\n          'small-sidebar': isSmall\n        }\"\n      />\n    </Teleport>\n\n    <!-- WhatsNew Popup positioned within canvas area -->\n    <Teleport to=\"#graph-canvas-container\">\n      <WhatsNewPopup\n        :class=\"{\n          'sidebar-left': sidebarLocation === 'left',\n          'sidebar-right': sidebarLocation === 'right',\n          'small-sidebar': isSmall\n        }\"\n        @whats-new-dismissed=\"handleWhatsNewDismissed\"\n      />\n    </Teleport>\n\n    <!-- Backdrop to close popup when clicking outside -->\n    <Teleport to=\"body\">\n      <div\n        v-if=\"isHelpCenterVisible\"\n        class=\"help-center-backdrop\"\n        @click=\"closeHelpCenter\"\n      />\n    </Teleport>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { storeToRefs } from 'pinia'\nimport { computed, onMounted, toRefs } from 'vue'\n\nimport HelpCenterMenuContent from '@/components/helpcenter/HelpCenterMenuContent.vue'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useReleaseStore } from '@/platform/updates/common/releaseStore'\nimport ReleaseNotificationToast from '@/platform/updates/components/ReleaseNotificationToast.vue'\nimport WhatsNewPopup from '@/platform/updates/components/WhatsNewPopup.vue'\nimport { useDialogService } from '@/services/dialogService'\nimport { useHelpCenterStore } from '@/stores/helpCenterStore'\nimport { useConflictAcknowledgment } from '@/workbench/extensions/manager/composables/useConflictAcknowledgment'\nimport { useConflictDetection } from '@/workbench/extensions/manager/composables/useConflictDetection'\n\nimport SidebarIcon from './SidebarIcon.vue'\n\nconst settingStore = useSettingStore()\nconst releaseStore = useReleaseStore()\nconst helpCenterStore = useHelpCenterStore()\nconst { isVisible: isHelpCenterVisible } = storeToRefs(helpCenterStore)\nconst { shouldShowRedDot: showReleaseRedDot } = storeToRefs(releaseStore)\n\nconst conflictDetection = useConflictDetection()\n\nconst { showNodeConflictDialog } = useDialogService()\n\n// Use conflict acknowledgment state from composable - call only once\nconst { shouldShowRedDot: shouldShowConflictRedDot, markConflictsAsSeen } =\n  useConflictAcknowledgment()\n\nconst props = defineProps<{\n  isSmall: boolean\n}>()\nconst { isSmall } = toRefs(props)\n\n// Use either release red dot or conflict red dot\nconst shouldShowRedDot = computed((): boolean => {\n  const releaseRedDot = showReleaseRedDot.value\n  return releaseRedDot || shouldShowConflictRedDot.value\n})\n\nconst sidebarLocation = computed(() =>\n  settingStore.get('Comfy.Sidebar.Location')\n)\n\n/**\n * Toggle Help Center and track UI button click.\n */\nconst toggleHelpCenter = () => {\n  useTelemetry()?.trackUiButtonClicked({\n    button_id: 'sidebar_help_center_toggled'\n  })\n  helpCenterStore.toggle()\n}\n\nconst closeHelpCenter = () => {\n  helpCenterStore.hide()\n}\n\n/**\n * Handle What's New popup dismissal\n * Check if conflict modal should be shown after ComfyUI update\n */\nconst handleWhatsNewDismissed = async () => {\n  try {\n    // Check if conflict modal should be shown after update\n    const shouldShow =\n      await conflictDetection.shouldShowConflictModalAfterUpdate()\n    if (shouldShow) {\n      showConflictModal()\n    }\n  } catch (error) {\n    console.error('[HelpCenter] Error checking conflict modal:', error)\n  }\n}\n/**\n * Show the node conflict dialog with current conflict data\n */\nconst showConflictModal = () => {\n  showNodeConflictDialog({\n    showAfterWhatsNew: true,\n    dialogComponentProps: {\n      onClose: () => {\n        markConflictsAsSeen()\n      }\n    }\n  })\n}\n\n// Initialize release store on mount\nonMounted(async () => {\n  // Initialize release store to fetch releases for toast and popup\n  await releaseStore.initialize()\n})\n</script>\n\n<style scoped>\n.help-center-backdrop {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  z-index: 9999;\n  background: transparent;\n}\n\n.help-center-popup {\n  position: absolute;\n  bottom: 1rem;\n  z-index: 10000;\n  animation: slideInUp 0.2s ease-out;\n  pointer-events: auto;\n}\n\n.help-center-popup.sidebar-left {\n  left: 1rem;\n}\n\n.help-center-popup.sidebar-left.small-sidebar {\n  left: 1rem;\n}\n\n.help-center-popup.sidebar-right {\n  right: 1rem;\n}\n\n@keyframes slideInUp {\n  from {\n    opacity: 0;\n    transform: translateY(20px);\n  }\n\n  to {\n    opacity: 1;\n    transform: translateY(0);\n  }\n}\n\n:deep(.p-badge) {\n  background: #ff3b30;\n  color: #ff3b30;\n  min-width: 8px;\n  height: 8px;\n  padding: 0;\n  border-radius: 9999px;\n  font-size: 0;\n  margin-top: 4px;\n  margin-right: 4px;\n  border: none;\n  outline: none;\n  box-shadow: none;\n}\n\n:deep(.p-badge.p-badge-dot) {\n  width: 8px !important;\n}\n</style>\n","<template>\n  <SidebarIcon\n    icon=\"pi pi-sign-out\"\n    :tooltip=\"tooltip\"\n    :label=\"$t('sideToolbar.logout')\"\n    @click=\"logout\"\n  />\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport { useUserStore } from '@/stores/userStore'\n\nimport SidebarIcon from './SidebarIcon.vue'\n\nconst { t } = useI18n()\nconst userStore = useUserStore()\n\nconst tooltip = computed(\n  () => `${t('sideToolbar.logout')} (${userStore.currentUser?.username})`\n)\nconst logout = async () => {\n  await userStore.logout()\n  window.location.reload()\n}\n</script>\n","<template>\n  <SidebarIcon\n    icon=\"icon-[comfy--template]\"\n    :tooltip=\"$t('sideToolbar.templates')\"\n    :label=\"$t('sideToolbar.labels.templates')\"\n    :is-small=\"isSmall\"\n    class=\"templates-tab-button\"\n    @click=\"openTemplates\"\n  />\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\n\nimport { useWorkflowTemplateSelectorDialog } from '@/composables/useWorkflowTemplateSelectorDialog'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useTelemetry } from '@/platform/telemetry'\n\nimport SidebarIcon from './SidebarIcon.vue'\n\nconst settingStore = useSettingStore()\n\nconst isSmall = computed(\n  () => settingStore.get('Comfy.Sidebar.Size') === 'small'\n)\n\n/**\n * Open templates dialog from sidebar and track UI button click.\n */\nconst openTemplates = () => {\n  useTelemetry()?.trackUiButtonClicked({\n    button_id: 'sidebar_templates_dialog_opened'\n  })\n  useWorkflowTemplateSelectorDialog().show('sidebar')\n}\n</script>\n","<template>\n  <nav\n    ref=\"sideToolbarRef\"\n    class=\"side-tool-bar-container flex h-full flex-col items-center bg-transparent [.floating-sidebar]:-mr-2 pointer-events-auto\"\n    :class=\"{\n      'small-sidebar': isSmall,\n      'connected-sidebar': isConnected,\n      'floating-sidebar': !isConnected,\n      'overflowing-sidebar': isOverflowing,\n      'border-r border-[var(--interface-stroke)] shadow-interface': isConnected\n    }\"\n  >\n    <div\n      ref=\"contentMeasureRef\"\n      :class=\"\n        isOverflowing\n          ? 'side-tool-bar-container overflow-y-auto'\n          : 'flex flex-col h-full'\n      \"\n    >\n      <div ref=\"topToolbarRef\" :class=\"groupClasses\">\n        <ComfyMenuButton />\n        <SidebarIcon\n          v-for=\"tab in tabs\"\n          :key=\"tab.id\"\n          :icon=\"tab.icon\"\n          :icon-badge=\"tab.iconBadge\"\n          :tooltip=\"tab.tooltip\"\n          :tooltip-suffix=\"getTabTooltipSuffix(tab)\"\n          :label=\"tab.label || tab.title\"\n          :is-small=\"isSmall\"\n          :selected=\"tab.id === selectedTab?.id\"\n          :class=\"tab.id + '-tab-button'\"\n          @click=\"onTabClick(tab)\"\n        />\n        <SidebarTemplatesButton />\n      </div>\n\n      <div ref=\"bottomToolbarRef\" class=\"mt-auto\" :class=\"groupClasses\">\n        <SidebarLogoutIcon\n          v-if=\"userStore.isMultiUserServer\"\n          :is-small=\"isSmall\"\n        />\n        <SidebarHelpCenterIcon :is-small=\"isSmall\" />\n        <SidebarBottomPanelToggleButton :is-small=\"isSmall\" />\n        <SidebarShortcutsToggleButton :is-small=\"isSmall\" />\n      </div>\n    </div>\n  </nav>\n</template>\n\n<script setup lang=\"ts\">\nimport { useResizeObserver } from '@vueuse/core'\nimport { debounce } from 'es-toolkit/compat'\nimport { computed, nextTick, onBeforeUnmount, onMounted, ref, watch } from 'vue'\n\nimport ComfyMenuButton from '@/components/sidebar/ComfyMenuButton.vue'\nimport SidebarBottomPanelToggleButton from '@/components/sidebar/SidebarBottomPanelToggleButton.vue'\nimport SidebarShortcutsToggleButton from '@/components/sidebar/SidebarShortcutsToggleButton.vue'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useCommandStore } from '@/stores/commandStore'\nimport { useKeybindingStore } from '@/stores/keybindingStore'\nimport { useUserStore } from '@/stores/userStore'\nimport { useWorkspaceStore } from '@/stores/workspaceStore'\nimport type { SidebarTabExtension } from '@/types/extensionTypes'\nimport { cn } from '@/utils/tailwindUtil'\n\nimport SidebarHelpCenterIcon from './SidebarHelpCenterIcon.vue'\nimport SidebarIcon from './SidebarIcon.vue'\nimport SidebarLogoutIcon from './SidebarLogoutIcon.vue'\nimport SidebarTemplatesButton from './SidebarTemplatesButton.vue'\n\nconst workspaceStore = useWorkspaceStore()\nconst settingStore = useSettingStore()\nconst userStore = useUserStore()\nconst commandStore = useCommandStore()\nconst canvasStore = useCanvasStore()\nconst sideToolbarRef = ref<HTMLElement>()\nconst contentMeasureRef = ref<HTMLElement>()\nconst topToolbarRef = ref<HTMLElement>()\nconst bottomToolbarRef = ref<HTMLElement>()\n\nconst isSmall = computed(\n  () => settingStore.get('Comfy.Sidebar.Size') === 'small'\n)\nconst sidebarLocation = computed<'left' | 'right'>(() =>\n  settingStore.get('Comfy.Sidebar.Location')\n)\nconst sidebarStyle = computed(() => settingStore.get('Comfy.Sidebar.Style'))\nconst isConnected = computed(\n  () =>\n    selectedTab.value ||\n    isOverflowing.value ||\n    sidebarStyle.value === 'connected'\n)\n\nconst tabs = computed(() => workspaceStore.getSidebarTabs())\nconst selectedTab = computed(() => workspaceStore.sidebarTab.activeSidebarTab)\n\n/**\n * Handle sidebar tab icon click.\n * - Emits UI button telemetry for known tabs\n * - Delegates to the corresponding toggle command\n */\nconst onTabClick = async (item: SidebarTabExtension) => {\n  const telemetry = useTelemetry()\n\n  const isNodeLibraryTab = item.id === 'node-library'\n  const isModelLibraryTab = item.id === 'model-library'\n  const isWorkflowsTab = item.id === 'workflows'\n  const isAssetsTab = item.id === 'assets'\n\n  if (isNodeLibraryTab)\n    telemetry?.trackUiButtonClicked({\n      button_id: 'sidebar_tab_node_library_selected'\n    })\n  else if (isModelLibraryTab)\n    telemetry?.trackUiButtonClicked({\n      button_id: 'sidebar_tab_model_library_selected'\n    })\n  else if (isWorkflowsTab)\n    telemetry?.trackUiButtonClicked({\n      button_id: 'sidebar_tab_workflows_selected'\n    })\n  else if (isAssetsTab)\n    telemetry?.trackUiButtonClicked({\n      button_id: 'sidebar_tab_assets_media_selected'\n    })\n\n  await commandStore.commands\n    .find((cmd) => cmd.id === `Workspace.ToggleSidebarTab.${item.id}`)\n    ?.function?.()\n}\n\nconst keybindingStore = useKeybindingStore()\nconst getTabTooltipSuffix = (tab: SidebarTabExtension) => {\n  const keybinding = keybindingStore.getKeybindingByCommandId(\n    `Workspace.ToggleSidebarTab.${tab.id}`\n  )\n  return keybinding ? ` (${keybinding.combo.toString()})` : ''\n}\n\nconst isOverflowing = ref(false)\nconst groupClasses = computed(() =>\n  cn(\n    'sidebar-item-group flex flex-col items-center overflow-hidden flex-shrink-0' +\n      (isConnected.value ? '' : ' rounded-lg shadow-interface')\n  )\n)\n\nconst ENTER_OVERFLOW_MARGIN = 20\nconst EXIT_OVERFLOW_MARGIN = 50\n\nconst checkOverflow = debounce(() => {\n  if (!sideToolbarRef.value || !topToolbarRef.value || !bottomToolbarRef.value)\n    return\n\n  const containerHeight = sideToolbarRef.value.clientHeight\n  const topHeight = topToolbarRef.value.scrollHeight\n  const bottomHeight = bottomToolbarRef.value.scrollHeight\n  const contentHeight = topHeight + bottomHeight\n\n  if (isOverflowing.value) {\n    isOverflowing.value = containerHeight < contentHeight + EXIT_OVERFLOW_MARGIN\n  } else {\n    isOverflowing.value =\n      containerHeight < contentHeight + ENTER_OVERFLOW_MARGIN\n  }\n}, 16)\n\nonMounted(() => {\n  if (!sideToolbarRef.value) return\n\n  const overflowObserver = useResizeObserver(\n    sideToolbarRef.value,\n    checkOverflow\n  )\n\n  checkOverflow()\n\n  onBeforeUnmount(() => {\n    overflowObserver.stop()\n  })\n\n  watch(\n    [isSmall, sidebarLocation],\n    async () => {\n      if (canvasStore.canvas) {\n        if (sidebarLocation.value === 'left') {\n          await nextTick()\n          canvasStore.canvas.fpsInfoLocation = [\n            sideToolbarRef.value?.getBoundingClientRect()?.right,\n            null\n          ]\n        } else {\n          canvasStore.canvas.fpsInfoLocation = null\n        }\n        canvasStore.canvas.setDirty(false, true)\n      }\n    },\n    { immediate: true }\n  )\n})\n</script>\n\n<style>\n/* Global CSS variables for sidebar\n * These variables need to be global (not scoped) because they are used by\n * teleported components like WhatsNewPopup that render outside the sidebar\n * but need to reference sidebar dimensions for proper positioning.\n */\n:root {\n  --sidebar-padding: 4px;\n  --sidebar-icon-size: 1rem;\n\n  --sidebar-default-floating-width: 48px;\n  --sidebar-default-connected-width: calc(\n    var(--sidebar-default-floating-width) + var(--sidebar-padding) * 2\n  );\n  --sidebar-default-item-height: 56px;\n\n  --sidebar-small-floating-width: 48px;\n  --sidebar-small-connected-width: calc(\n    var(--sidebar-small-floating-width) + var(--sidebar-padding) * 2\n  );\n  --sidebar-small-item-height: 48px;\n\n  --sidebar-width: var(--sidebar-default-floating-width);\n  --sidebar-item-height: var(--sidebar-default-item-height);\n}\n\n:root:has(.side-tool-bar-container.small-sidebar) {\n  --sidebar-width: var(--sidebar-small-floating-width);\n  --sidebar-item-height: var(--sidebar-small-item-height);\n}\n\n:root:has(.side-tool-bar-container.connected-sidebar) {\n  --sidebar-width: var(--sidebar-default-connected-width);\n}\n\n:root:has(.side-tool-bar-container.small-sidebar.connected-sidebar) {\n  --sidebar-width: var(--sidebar-small-connected-width);\n}\n</style>\n\n<style scoped>\n@reference \"tailwindcss\";\n\n.floating-sidebar {\n  padding: var(--sidebar-padding);\n}\n\n.floating-sidebar .sidebar-item-group {\n  border-color: var(--p-panel-border-color);\n}\n\n.connected-sidebar {\n  padding: var(--sidebar-padding) 0;\n  background-color: var(--comfy-menu-bg);\n}\n\n.sidebar-item-group {\n  background-color: var(--comfy-menu-bg);\n  border: 1px solid transparent;\n}\n\n.overflowing-sidebar :deep(.comfy-menu-button-wrapper) {\n  position: sticky;\n  top: 0;\n  z-index: 1;\n  background-color: var(--comfy-menu-bg);\n}\n</style>\n","import { defineStore } from 'pinia'\nimport { computed } from 'vue'\n\nimport type { TopbarBadge } from '@/types/comfy'\n\nimport { useExtensionStore } from './extensionStore'\n\nexport const useTopbarBadgeStore = defineStore('topbarBadge', () => {\n  const extensionStore = useExtensionStore()\n\n  const badges = computed<TopbarBadge[]>(() =>\n    extensionStore.extensions.flatMap((e) => e.topbarBadges ?? [])\n  )\n\n  return {\n    badges\n  }\n})\n","<template>\n  <div class=\"flex h-full shrink-0 items-center\">\n    <TopbarBadge\n      v-for=\"badge in topbarBadgeStore.badges\"\n      :key=\"badge.text\"\n      :badge\n      :display-mode=\"displayMode\"\n      :reverse-order=\"reverseOrder\"\n      :no-padding=\"noPadding\"\n    />\n  </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport { breakpointsTailwind, useBreakpoints } from '@vueuse/core'\nimport { computed } from 'vue'\n\nimport { useTopbarBadgeStore } from '@/stores/topbarBadgeStore'\n\nimport TopbarBadge from './TopbarBadge.vue'\n\nwithDefaults(\n  defineProps<{\n    reverseOrder?: boolean\n    noPadding?: boolean\n  }>(),\n  {\n    reverseOrder: false,\n    noPadding: false\n  }\n)\n\nconst breakpoints = useBreakpoints(breakpointsTailwind)\nconst isXl = breakpoints.greaterOrEqual('xl')\nconst isLg = breakpoints.greaterOrEqual('lg')\n\nconst displayMode = computed<'full' | 'compact' | 'icon-only'>(() => {\n  if (isXl.value) return 'full'\n  if (isLg.value) return 'compact'\n  return 'icon-only'\n})\n\nconst topbarBadgeStore = useTopbarBadgeStore()\n</script>\n","<template>\n  <div\n    ref=\"positionRef\"\n    class=\"absolute bottom-0 left-1/2 -translate-x-1/2\"\n  ></div>\n  <Popover\n    ref=\"popoverRef\"\n    append-to=\"body\"\n    :pt=\"{\n      root: {\n        class: 'workflow-popover-fade fit-content',\n        'data-popover-id': id\n      }\n    }\"\n    @mouseenter=\"cancelHidePopover\"\n    @mouseleave=\"hidePopover\"\n  >\n    <div class=\"workflow-preview-content\">\n      <div\n        v-if=\"thumbnailUrl && !isActiveTab\"\n        class=\"workflow-preview-thumbnail relative\"\n      >\n        <img\n          :src=\"thumbnailUrl\"\n          class=\"block h-[200px] rounded-lg object-cover p-2\"\n          :style=\"{ width: `${POPOVER_WIDTH}px` }\"\n        />\n      </div>\n      <div class=\"workflow-preview-footer\">\n        <span class=\"workflow-preview-name\">{{ workflowFilename }}</span>\n      </div>\n    </div>\n  </Popover>\n</template>\n\n<script setup lang=\"ts\">\nimport Popover from 'primevue/popover'\nimport { nextTick, ref, toRefs, useId } from 'vue'\n\nconst POPOVER_WIDTH = 250\n\ninterface Props {\n  workflowFilename: string\n  thumbnailUrl?: string\n  isActiveTab: boolean\n}\n\nconst props = defineProps<Props>()\nconst { thumbnailUrl, isActiveTab } = toRefs(props)\nconst popoverRef = ref<InstanceType<typeof Popover> | null>(null)\nconst positionRef = ref<HTMLElement | null>(null)\nlet hideTimeout: ReturnType<typeof setTimeout> | null = null\nlet showTimeout: ReturnType<typeof setTimeout> | null = null\nconst id = useId()\n\nconst showPopover = (event: Event) => {\n  // Clear any existing timeouts\n  if (hideTimeout) {\n    clearTimeout(hideTimeout)\n    hideTimeout = null\n  }\n  if (showTimeout) {\n    clearTimeout(showTimeout)\n    showTimeout = null\n  }\n\n  // Show popover after a short delay\n  showTimeout = setTimeout(async () => {\n    if (popoverRef.value && positionRef.value) {\n      popoverRef.value.show(event, positionRef.value)\n      await nextTick()\n      // PrimeVue has a bug where when the tabs are scrolled, it positions the element incorrectly\n      // Manually set the position to the middle of the tab and prevent it from going off the left/right edge\n      const el = document.querySelector(\n        `.workflow-popover-fade[data-popover-id=\"${id}\"]`\n      ) as HTMLElement\n      if (el) {\n        const middle = positionRef.value!.getBoundingClientRect().left\n        const popoverWidth = el.getBoundingClientRect().width\n        const halfWidth = popoverWidth / 2\n        let pos = middle - halfWidth\n        let shift = 0\n\n        // Calculate shift when clamping is needed\n        if (pos < 0) {\n          shift = pos - 8 // Negative shift to move arrow left\n          pos = 8\n        } else if (pos + popoverWidth > window.innerWidth) {\n          const newPos = window.innerWidth - popoverWidth - 16\n          shift = pos - newPos // Positive shift to move arrow right\n          pos = newPos\n        }\n\n        if (shift + halfWidth < 0) {\n          shift = -halfWidth + 24\n        }\n\n        el.style.left = `${pos}px`\n        el.style.setProperty('--shift', `${shift}px`)\n      }\n    }\n  }, 200) // 200ms delay before showing\n}\n\nconst cancelHidePopover = () => {\n  // Temporarily disable this functionality until we need the popover to be interactive:\n  /*\n  if (hideTimeout) {\n    clearTimeout(hideTimeout)\n    hideTimeout = null\n  }\n  */\n}\n\nconst hidePopover = () => {\n  // Clear show timeout if mouse leaves before popover appears\n  if (showTimeout) {\n    clearTimeout(showTimeout)\n    showTimeout = null\n  }\n\n  hideTimeout = setTimeout(() => {\n    if (popoverRef.value) {\n      popoverRef.value.hide()\n    }\n  }, 100) // Minimal delay to allow moving to popover\n}\n\nconst togglePopover = (event: Event) => {\n  if (popoverRef.value) {\n    popoverRef.value.toggle(event)\n  }\n}\n\ndefineExpose({\n  showPopover,\n  hidePopover,\n  togglePopover\n})\n</script>\n\n<style scoped>\n@reference '../../assets/css/style.css';\n\n.workflow-preview-content {\n  @apply flex flex-col rounded-xl overflow-hidden;\n  max-width: var(--popover-width);\n  background-color: var(--comfy-menu-bg);\n  color: var(--fg-color);\n}\n\n.workflow-preview-thumbnail {\n  @apply relative p-2;\n}\n\n.workflow-preview-thumbnail img {\n  @apply shadow-md;\n  background-color: color-mix(in srgb, var(--comfy-menu-bg) 70%, black);\n}\n\n.dark-theme .workflow-preview-thumbnail img {\n  @apply shadow-lg;\n}\n\n.workflow-preview-footer {\n  @apply pt-1 pb-2 px-3;\n}\n\n.workflow-preview-name {\n  @apply block text-sm font-medium overflow-hidden text-ellipsis whitespace-nowrap;\n  color: var(--fg-color);\n}\n</style>\n\n<style>\n@reference '../../assets/css/style.css';\n\n.workflow-popover-fade {\n  --p-popover-background: transparent;\n  --p-popover-content-padding: 0;\n  @apply bg-transparent rounded-xl shadow-lg;\n  transition: opacity 0.15s ease-out !important;\n}\n\n.workflow-popover-fade.p-popover-flipped {\n  @apply -translate-y-full;\n}\n\n.dark-theme .workflow-popover-fade {\n  @apply shadow-2xl;\n}\n\n.workflow-popover-fade.p-popover::after,\n.workflow-popover-fade.p-popover::before {\n  --p-popover-border-color: var(--comfy-menu-secondary-bg);\n  left: 50%;\n  transform: translateX(calc(-50% + var(--shift)));\n  margin-left: 0;\n}\n</style>\n","<template>\n  <div\n    ref=\"workflowTabRef\"\n    class=\"workflow-tab group flex gap-2 p-2\"\n    v-bind=\"$attrs\"\n    @mouseenter=\"handleMouseEnter\"\n    @mouseleave=\"handleMouseLeave\"\n    @click=\"handleClick\"\n  >\n    <span class=\"workflow-label inline-block max-w-[150px] truncate text-sm\">\n      {{ workflowOption.workflow.filename }}\n    </span>\n    <div class=\"relative\">\n      <span\n        v-if=\"shouldShowStatusIndicator\"\n        class=\"absolute top-1/2 left-1/2 z-10 w-4 -translate-1/2 bg-(--comfy-menu-bg) text-2xl font-bold group-hover:hidden\"\n        ></span\n      >\n      <Button\n        class=\"close-button invisible w-auto p-0\"\n        icon=\"pi pi-times\"\n        text\n        severity=\"secondary\"\n        size=\"small\"\n        @click.stop=\"onCloseWorkflow(workflowOption)\"\n      />\n    </div>\n  </div>\n\n  <WorkflowTabPopover\n    ref=\"popoverRef\"\n    :workflow-filename=\"workflowOption.workflow.filename\"\n    :thumbnail-url=\"thumbnailUrl\"\n    :is-active-tab=\"isActiveTab\"\n  />\n</template>\n\n<script setup lang=\"ts\">\nimport Button from 'primevue/button'\nimport { computed, onUnmounted, ref } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport {\n  usePragmaticDraggable,\n  usePragmaticDroppable\n} from '@/composables/usePragmaticDragAndDrop'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useWorkflowService } from '@/platform/workflow/core/services/workflowService'\nimport type { ComfyWorkflow } from '@/platform/workflow/management/stores/workflowStore'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { useWorkflowThumbnail } from '@/renderer/core/thumbnail/useWorkflowThumbnail'\nimport { useWorkspaceStore } from '@/stores/workspaceStore'\n\nimport WorkflowTabPopover from './WorkflowTabPopover.vue'\n\ninterface WorkflowOption {\n  value: string\n  workflow: ComfyWorkflow\n}\n\nconst props = defineProps<{\n  class?: string\n  workflowOption: WorkflowOption\n}>()\n\nconst { t } = useI18n()\n\nconst workspaceStore = useWorkspaceStore()\nconst workflowStore = useWorkflowStore()\nconst settingStore = useSettingStore()\nconst workflowTabRef = ref<HTMLElement | null>(null)\nconst popoverRef = ref<InstanceType<typeof WorkflowTabPopover> | null>(null)\nconst workflowThumbnail = useWorkflowThumbnail()\n\n// Use computed refs to cache autosave settings\nconst autoSaveSetting = computed(() =>\n  settingStore.get('Comfy.Workflow.AutoSave')\n)\nconst autoSaveDelay = computed(() =>\n  settingStore.get('Comfy.Workflow.AutoSaveDelay')\n)\n\nconst shouldShowStatusIndicator = computed(() => {\n  if (workspaceStore.shiftDown) {\n    // Branch 1: Shift key is held down, do not show the status indicator.\n    return false\n  }\n  if (!props.workflowOption.workflow.isPersisted) {\n    // Branch 2: Workflow is not persisted, show the status indicator.\n    return true\n  }\n  if (props.workflowOption.workflow.isModified) {\n    // Branch 3: Workflow is modified.\n    if (autoSaveSetting.value === 'off') {\n      // Sub-branch 3a: Autosave is off, so show the status indicator.\n      return true\n    }\n    if (autoSaveSetting.value === 'after delay' && autoSaveDelay.value > 3000) {\n      // Sub-branch 3b: Autosave delay is too high, so show the status indicator.\n      return true\n    }\n    // Sub-branch 3c: Workflow is modified but no condition applies, do not show the status indicator.\n    return false\n  }\n  // Default: do not show the status indicator. This should not be reachable.\n  return false\n})\n\nconst isActiveTab = computed(() => {\n  return workflowStore.activeWorkflow?.key === props.workflowOption.workflow.key\n})\n\nconst thumbnailUrl = computed(() => {\n  return workflowThumbnail.getThumbnail(props.workflowOption.workflow.key)\n})\n\n// Event handlers that delegate to the popover component\nconst handleMouseEnter = (event: Event) => {\n  popoverRef.value?.showPopover(event)\n}\n\nconst handleMouseLeave = () => {\n  popoverRef.value?.hidePopover()\n}\n\nconst handleClick = (event: Event) => {\n  popoverRef.value?.togglePopover(event)\n}\n\nconst closeWorkflows = async (options: WorkflowOption[]) => {\n  for (const opt of options) {\n    if (\n      !(await useWorkflowService().closeWorkflow(opt.workflow, {\n        warnIfUnsaved: !workspaceStore.shiftDown,\n        hint: t('sideToolbar.workflowTab.dirtyCloseHint')\n      }))\n    ) {\n      // User clicked cancel\n      break\n    }\n  }\n}\n\nconst onCloseWorkflow = async (option: WorkflowOption) => {\n  await closeWorkflows([option])\n}\nconst tabGetter = () => workflowTabRef.value as HTMLElement\n\nusePragmaticDraggable(tabGetter, {\n  getInitialData: () => {\n    return {\n      workflowKey: props.workflowOption.workflow.key\n    }\n  }\n})\n\nusePragmaticDroppable(tabGetter, {\n  getData: () => {\n    return {\n      workflowKey: props.workflowOption.workflow.key\n    }\n  },\n  onDrop: (e) => {\n    const fromIndex = workflowStore.openWorkflows.findIndex(\n      (wf) => wf.key === e.source.data.workflowKey\n    )\n    const toIndex = workflowStore.openWorkflows.findIndex(\n      (wf) => wf.key === e.location.current.dropTargets[0]?.data.workflowKey\n    )\n    if (fromIndex !== toIndex) {\n      workflowStore.reorderWorkflows(fromIndex, toIndex)\n    }\n  }\n})\n\nonUnmounted(() => {\n  popoverRef.value?.hidePopover()\n})\n</script>\n\n<style>\n.p-tooltip.workflow-tab-tooltip {\n  z-index: 1200 !important;\n}\n</style>\n","<template>\n  <div>\n    <Button\n      v-tooltip=\"{ value: $t('g.moreWorkflows'), showDelay: 300 }\"\n      class=\"rounded-none\"\n      icon=\"pi pi-ellipsis-h\"\n      text\n      severity=\"secondary\"\n      :aria-label=\"$t('g.moreWorkflows')\"\n      @click=\"menu?.toggle($event)\"\n    />\n    <Menu\n      ref=\"menu\"\n      :model=\"menuItems\"\n      :popup=\"true\"\n      class=\"max-h-[40vh] overflow-auto\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport Button from 'primevue/button'\nimport Menu from 'primevue/menu'\nimport { computed, ref } from 'vue'\n\nimport { useWorkflowService } from '@/platform/workflow/core/services/workflowService'\nimport type { ComfyWorkflow } from '@/platform/workflow/management/stores/workflowStore'\n\nconst props = defineProps<{\n  workflows: ComfyWorkflow[]\n  activeWorkflow: ComfyWorkflow | null\n}>()\n\nconst menu = ref<InstanceType<typeof Menu> | null>(null)\nconst workflowService = useWorkflowService()\n\nconst menuItems = computed(() =>\n  props.workflows.map((workflow: ComfyWorkflow) => ({\n    label: workflow.filename,\n    icon:\n      props.activeWorkflow?.key === workflow.key ? 'pi pi-check' : undefined,\n    command: () => {\n      void workflowService.openWorkflow(workflow)\n    }\n  }))\n)\n</script>\n","<template>\n  <div\n    ref=\"containerRef\"\n    class=\"workflow-tabs-container flex h-full max-w-full flex-auto flex-row overflow-hidden border-b border-[var(--interface-stroke)] shadow-interface\"\n    :class=\"{ 'workflow-tabs-container-desktop': isDesktop }\"\n  >\n    <Button\n      v-if=\"showOverflowArrows\"\n      icon=\"pi pi-chevron-left\"\n      text\n      severity=\"secondary\"\n      class=\"overflow-arrow overflow-arrow-left\"\n      :disabled=\"!leftArrowEnabled\"\n      @mousedown=\"whileMouseDown($event, () => scroll(-1))\"\n    />\n    <ScrollPanel\n      class=\"no-drag overflow-hidden\"\n      :pt:content=\"{\n        class: 'p-0 w-full flex',\n        onwheel: handleWheel\n      }\"\n      pt:bar-x=\"h-1\"\n    >\n      <SelectButton\n        class=\"workflow-tabs bg-transparent\"\n        :class=\"props.class\"\n        :model-value=\"selectedWorkflow\"\n        :options=\"options\"\n        option-label=\"label\"\n        data-key=\"value\"\n        @update:model-value=\"onWorkflowChange\"\n      >\n        <template #option=\"{ option }\">\n          <WorkflowTab\n            :workflow-option=\"option\"\n            @contextmenu=\"showContextMenu($event, option)\"\n            @click.middle=\"onCloseWorkflow(option)\"\n          />\n        </template>\n      </SelectButton>\n    </ScrollPanel>\n    <Button\n      v-if=\"showOverflowArrows\"\n      icon=\"pi pi-chevron-right\"\n      text\n      severity=\"secondary\"\n      class=\"overflow-arrow overflow-arrow-right\"\n      :disabled=\"!rightArrowEnabled\"\n      @mousedown=\"whileMouseDown($event, () => scroll(1))\"\n    />\n    <WorkflowOverflowMenu\n      v-if=\"showOverflowArrows\"\n      :workflows=\"workflowStore.openWorkflows\"\n      :active-workflow=\"workflowStore.activeWorkflow\"\n    />\n    <Button\n      v-tooltip=\"{ value: $t('sideToolbar.newBlankWorkflow'), showDelay: 300 }\"\n      class=\"new-blank-workflow-button no-drag shrink-0 rounded-none\"\n      icon=\"pi pi-plus\"\n      text\n      severity=\"secondary\"\n      :aria-label=\"$t('sideToolbar.newBlankWorkflow')\"\n      @click=\"() => commandStore.execute('Comfy.NewBlankWorkflow')\"\n    />\n    <ContextMenu ref=\"menu\" :model=\"contextMenuItems\" />\n    <div v-if=\"isDesktop\" class=\"window-actions-spacer app-drag shrink-0\" />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useScroll } from '@vueuse/core'\nimport Button from 'primevue/button'\nimport ContextMenu from 'primevue/contextmenu'\nimport ScrollPanel from 'primevue/scrollpanel'\nimport SelectButton from 'primevue/selectbutton'\nimport { computed, nextTick, onUpdated, ref, watch } from 'vue'\nimport type { WatchStopHandle } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport WorkflowTab from '@/components/topbar/WorkflowTab.vue'\nimport { useOverflowObserver } from '@/composables/element/useOverflowObserver'\nimport { useWorkflowService } from '@/platform/workflow/core/services/workflowService'\nimport type { ComfyWorkflow } from '@/platform/workflow/management/stores/workflowStore'\nimport {\n  useWorkflowBookmarkStore,\n  useWorkflowStore\n} from '@/platform/workflow/management/stores/workflowStore'\nimport { useCommandStore } from '@/stores/commandStore'\nimport { useWorkspaceStore } from '@/stores/workspaceStore'\nimport { isElectron } from '@/utils/envUtil'\nimport { whileMouseDown } from '@/utils/mouseDownUtil'\n\nimport WorkflowOverflowMenu from './WorkflowOverflowMenu.vue'\n\ninterface WorkflowOption {\n  value: string\n  workflow: ComfyWorkflow\n}\n\nconst props = defineProps<{\n  class?: string\n}>()\n\nconst { t } = useI18n()\nconst workspaceStore = useWorkspaceStore()\nconst workflowStore = useWorkflowStore()\nconst workflowBookmarkStore = useWorkflowBookmarkStore()\nconst workflowService = useWorkflowService()\n\nconst rightClickedTab = ref<WorkflowOption | undefined>()\nconst menu = ref()\nconst containerRef = ref<HTMLElement | null>(null)\nconst showOverflowArrows = ref(false)\nconst leftArrowEnabled = ref(false)\nconst rightArrowEnabled = ref(false)\n\nconst isDesktop = isElectron()\n\nconst workflowToOption = (workflow: ComfyWorkflow): WorkflowOption => ({\n  value: workflow.path,\n  workflow\n})\n\nconst options = computed<WorkflowOption[]>(() =>\n  workflowStore.openWorkflows.map(workflowToOption)\n)\nconst selectedWorkflow = computed<WorkflowOption | null>(() =>\n  workflowStore.activeWorkflow\n    ? workflowToOption(workflowStore.activeWorkflow as ComfyWorkflow)\n    : null\n)\n\nconst onWorkflowChange = async (option: WorkflowOption) => {\n  // Prevent unselecting the current workflow\n  if (!option) {\n    return\n  }\n  // Prevent reloading the current workflow\n  if (selectedWorkflow.value?.value === option.value) {\n    return\n  }\n\n  await workflowService.openWorkflow(option.workflow)\n}\n\nconst closeWorkflows = async (options: WorkflowOption[]) => {\n  for (const opt of options) {\n    if (\n      !(await workflowService.closeWorkflow(opt.workflow, {\n        warnIfUnsaved: !workspaceStore.shiftDown\n      }))\n    ) {\n      // User clicked cancel\n      break\n    }\n  }\n}\n\nconst onCloseWorkflow = async (option: WorkflowOption) => {\n  await closeWorkflows([option])\n}\n\nconst showContextMenu = (event: MouseEvent, option: WorkflowOption) => {\n  rightClickedTab.value = option\n  menu.value.show(event)\n}\nconst contextMenuItems = computed(() => {\n  const tab = rightClickedTab.value as WorkflowOption\n  if (!tab) return []\n  const index = options.value.findIndex((v) => v.workflow === tab.workflow)\n\n  return [\n    {\n      label: t('tabMenu.duplicateTab'),\n      command: async () => {\n        await workflowService.duplicateWorkflow(tab.workflow)\n      }\n    },\n    {\n      separator: true\n    },\n    {\n      label: t('tabMenu.closeTab'),\n      command: () => onCloseWorkflow(tab)\n    },\n    {\n      label: t('tabMenu.closeTabsToLeft'),\n      command: () => closeWorkflows(options.value.slice(0, index)),\n      disabled: index <= 0\n    },\n    {\n      label: t('tabMenu.closeTabsToRight'),\n      command: () => closeWorkflows(options.value.slice(index + 1)),\n      disabled: index === options.value.length - 1\n    },\n    {\n      label: t('tabMenu.closeOtherTabs'),\n      command: () =>\n        closeWorkflows([\n          ...options.value.slice(index + 1),\n          ...options.value.slice(0, index)\n        ]),\n      disabled: options.value.length <= 1\n    },\n    {\n      label: workflowBookmarkStore.isBookmarked(tab.workflow.path)\n        ? t('tabMenu.removeFromBookmarks')\n        : t('tabMenu.addToBookmarks'),\n      command: () => workflowBookmarkStore.toggleBookmarked(tab.workflow.path),\n      disabled: tab.workflow.isTemporary\n    }\n  ]\n})\nconst commandStore = useCommandStore()\n\n// Horizontal scroll on wheel\nconst handleWheel = (event: WheelEvent) => {\n  const scrollElement = event.currentTarget as HTMLElement\n  const scrollAmount = event.deltaX || event.deltaY\n  scrollElement.scroll({\n    left: scrollElement.scrollLeft + scrollAmount\n  })\n}\n\nconst scrollContent = computed(\n  () =>\n    (containerRef.value?.querySelector(\n      '.p-scrollpanel-content'\n    ) as HTMLElement | null) ?? null\n)\n\nconst scroll = (direction: number) => {\n  const el = scrollContent.value\n  if (!el) return\n  el.scrollBy({ left: direction * 20 })\n}\n\nconst ensureActiveTabVisible = async (\n  options: { waitForDom?: boolean } = {}\n) => {\n  if (!selectedWorkflow.value) return\n\n  if (options.waitForDom !== false) {\n    await nextTick()\n  }\n\n  const containerElement = containerRef.value\n  if (!containerElement) return\n\n  const activeTabElement = containerElement.querySelector(\n    '.p-togglebutton-checked'\n  )\n  if (!activeTabElement) return\n\n  activeTabElement.scrollIntoView({ block: 'nearest', inline: 'nearest' })\n}\n\n// Scroll to active offscreen tab when opened\nwatch(\n  () => workflowStore.activeWorkflow,\n  () => {\n    void ensureActiveTabVisible()\n  },\n  { immediate: true }\n)\n\nlet overflowObserver: ReturnType<typeof useOverflowObserver> | null = null\nlet stopArrivedWatch: WatchStopHandle | null = null\nlet stopOverflowWatch: WatchStopHandle | null = null\n\nwatch(\n  scrollContent,\n  (el, _prev, onCleanup) => {\n    stopArrivedWatch?.()\n    stopOverflowWatch?.()\n    overflowObserver?.dispose()\n\n    if (!el) return\n\n    const scrollState = useScroll(el)\n\n    stopArrivedWatch = watch(\n      [\n        () => scrollState.arrivedState.left,\n        () => scrollState.arrivedState.right\n      ],\n      ([atLeft, atRight]) => {\n        leftArrowEnabled.value = !atLeft\n        rightArrowEnabled.value = !atRight\n      },\n      { immediate: true }\n    )\n\n    overflowObserver = useOverflowObserver(el)\n    stopOverflowWatch = watch(\n      overflowObserver.isOverflowing,\n      (isOverflow) => {\n        showOverflowArrows.value = isOverflow\n        if (!isOverflow) return\n        void nextTick(() => {\n          // Force a new check after arrows are updated\n          scrollState.measure()\n          void ensureActiveTabVisible({ waitForDom: false })\n        })\n      },\n      { immediate: true }\n    )\n\n    onCleanup(() => {\n      stopArrivedWatch?.()\n      stopOverflowWatch?.()\n      overflowObserver?.dispose()\n    })\n  },\n  { immediate: true }\n)\n\nonUpdated(() => {\n  if (!overflowObserver?.disposed.value) {\n    overflowObserver?.checkOverflow()\n  }\n})\n</script>\n\n<style scoped>\n@reference '../../assets/css/style.css';\n\n.workflow-tabs-container {\n  background-color: var(--comfy-menu-bg);\n}\n\n:deep(.p-togglebutton) {\n  @apply p-0 bg-transparent rounded-none shrink relative border-0 border-r border-solid;\n  border-right-color: var(--border-color);\n  min-width: 90px;\n}\n\n.overflow-arrow {\n  @apply px-2 rounded-none;\n}\n\n.overflow-arrow[disabled] {\n  @apply opacity-25;\n}\n\n:deep(.p-togglebutton > .p-togglebutton-content) {\n  @apply max-w-full;\n}\n\n:deep(.workflow-tab) {\n  @apply max-w-full;\n}\n\n:deep(.p-togglebutton::before) {\n  @apply hidden;\n}\n\n:deep(.p-togglebutton:first-child) {\n  @apply border-l border-solid;\n  border-left-color: var(--border-color);\n}\n\n:deep(.p-togglebutton:not(:first-child)) {\n  @apply border-l-0;\n}\n\n:deep(.p-togglebutton.p-togglebutton-checked) {\n  @apply border-b border-solid h-full;\n  border-bottom-color: var(--p-button-text-primary-color);\n}\n\n:deep(.p-togglebutton:not(.p-togglebutton-checked)) {\n  @apply opacity-75;\n}\n\n:deep(.p-togglebutton-checked) .close-button,\n:deep(.p-togglebutton:hover) .close-button {\n  @apply visible;\n}\n\n:deep(.p-scrollpanel-content) {\n  @apply h-full;\n}\n\n:deep(.workflow-tabs) {\n  display: flex;\n}\n\n/* Scrollbar half opacity to avoid blocking the active tab bottom border */\n:deep(.p-scrollpanel:hover .p-scrollpanel-bar),\n:deep(.p-scrollpanel:active .p-scrollpanel-bar) {\n  @apply opacity-50;\n}\n\n:deep(.p-selectbutton) {\n  @apply rounded-none h-full;\n}\n\n.workflow-tabs-container-desktop {\n  max-width: env(titlebar-area-width, 100vw);\n}\n\n.window-actions-spacer {\n  @apply flex-auto;\n  /* If we are using custom titlebar, then we need to add a gap for the user to drag the window */\n  --window-actions-spacer-width: min(75px, env(titlebar-area-width, 0) * 9999);\n  min-width: var(--window-actions-spacer-width);\n}\n</style>\n","/**\n * Vue node lifecycle management for LiteGraph integration\n * Provides event-driven reactivity with performance optimizations\n */\nimport { reactiveComputed } from '@vueuse/core'\nimport { reactive, shallowReactive } from 'vue'\n\nimport { useChainCallback } from '@/composables/functional/useChainCallback'\nimport type {\n  INodeInputSlot,\n  INodeOutputSlot\n} from '@/lib/litegraph/src/interfaces'\nimport type { IBaseWidget } from '@/lib/litegraph/src/types/widgets'\nimport { useLayoutMutations } from '@/renderer/core/layout/operations/layoutMutations'\nimport { LayoutSource } from '@/renderer/core/layout/types'\nimport type { InputSpec } from '@/schemas/nodeDef/nodeDefSchemaV2'\nimport { isDOMWidget } from '@/scripts/domWidget'\nimport { useNodeDefStore } from '@/stores/nodeDefStore'\nimport type { WidgetValue } from '@/types/simplifiedWidget'\n\nimport type {\n  LGraph,\n  LGraphBadge,\n  LGraphNode,\n  LGraphTriggerAction,\n  LGraphTriggerEvent,\n  LGraphTriggerParam\n} from '../../lib/litegraph/src/litegraph'\nimport { NodeSlotType } from '../../lib/litegraph/src/types/globalEnums'\n\nexport interface WidgetSlotMetadata {\n  index: number\n  linked: boolean\n}\n\nexport interface SafeWidgetData {\n  name: string\n  type: string\n  value: WidgetValue\n  label?: string\n  options?: Record<string, unknown>\n  callback?: ((value: unknown) => void) | undefined\n  spec?: InputSpec\n  slotMetadata?: WidgetSlotMetadata\n  isDOMWidget?: boolean\n}\n\nexport interface VueNodeData {\n  id: string\n  title: string\n  type: string\n  mode: number\n  selected: boolean\n  executing: boolean\n  apiNode?: boolean\n  badges?: (LGraphBadge | (() => LGraphBadge))[]\n  subgraphId?: string | null\n  widgets?: SafeWidgetData[]\n  inputs?: INodeInputSlot[]\n  outputs?: INodeOutputSlot[]\n  hasErrors?: boolean\n  flags?: {\n    collapsed?: boolean\n    pinned?: boolean\n  }\n  color?: string\n  bgcolor?: string\n}\n\nexport interface GraphNodeManager {\n  // Reactive state - safe data extracted from LiteGraph nodes\n  vueNodeData: ReadonlyMap<string, VueNodeData>\n\n  // Access to original LiteGraph nodes (non-reactive)\n  getNode(id: string): LGraphNode | undefined\n\n  // Lifecycle methods\n  cleanup(): void\n}\n\nexport function useGraphNodeManager(graph: LGraph): GraphNodeManager {\n  // Get layout mutations composable\n  const { createNode, deleteNode, setSource } = useLayoutMutations()\n  const nodeDefStore = useNodeDefStore()\n  // Safe reactive data extracted from LiteGraph nodes\n  const vueNodeData = reactive(new Map<string, VueNodeData>())\n\n  // Non-reactive storage for original LiteGraph nodes\n  const nodeRefs = new Map<string, LGraphNode>()\n\n  const refreshNodeSlots = (nodeId: string) => {\n    const nodeRef = nodeRefs.get(nodeId)\n    const currentData = vueNodeData.get(nodeId)\n\n    if (!nodeRef || !currentData) return\n\n    // Only extract slot-related data instead of full node re-extraction\n    const slotMetadata = new Map<string, WidgetSlotMetadata>()\n\n    nodeRef.inputs?.forEach((input, index) => {\n      if (!input?.widget?.name) return\n      slotMetadata.set(input.widget.name, {\n        index,\n        linked: input.link != null\n      })\n    })\n\n    // Update only widgets with new slot metadata, keeping other widget data intact\n    const updatedWidgets = currentData.widgets?.map((widget) => {\n      const slotInfo = slotMetadata.get(widget.name)\n      return slotInfo ? { ...widget, slotMetadata: slotInfo } : widget\n    })\n\n    vueNodeData.set(nodeId, {\n      ...currentData,\n      widgets: updatedWidgets,\n      inputs: nodeRef.inputs ? [...nodeRef.inputs] : undefined,\n      outputs: nodeRef.outputs ? [...nodeRef.outputs] : undefined\n    })\n  }\n\n  // Extract safe data from LiteGraph node for Vue consumption\n  function extractVueNodeData(node: LGraphNode): VueNodeData {\n    // Determine subgraph ID - null for root graph, string for subgraphs\n    const subgraphId =\n      node.graph && 'id' in node.graph && node.graph !== node.graph.rootGraph\n        ? String(node.graph.id)\n        : null\n    // Extract safe widget data\n    const slotMetadata = new Map<string, WidgetSlotMetadata>()\n\n    const reactiveWidgets = shallowReactive<IBaseWidget[]>(node.widgets ?? [])\n    Object.defineProperty(node, 'widgets', {\n      get() {\n        return reactiveWidgets\n      },\n      set(v) {\n        reactiveWidgets.splice(0, reactiveWidgets.length, ...v)\n      }\n    })\n\n    const safeWidgets = reactiveComputed<SafeWidgetData[]>(() => {\n      node.inputs?.forEach((input, index) => {\n        if (!input?.widget?.name) return\n        slotMetadata.set(input.widget.name, {\n          index,\n          linked: input.link != null\n        })\n      })\n      return (\n        node.widgets?.map((widget) => {\n          try {\n            // TODO: Use widget.getReactiveData() once TypeScript types are updated\n            let value = widget.value\n\n            // For combo widgets, if value is undefined, use the first option as default\n            if (\n              value === undefined &&\n              widget.type === 'combo' &&\n              widget.options?.values &&\n              Array.isArray(widget.options.values) &&\n              widget.options.values.length > 0\n            ) {\n              value = widget.options.values[0]\n            }\n            const spec = nodeDefStore.getInputSpecForWidget(node, widget.name)\n            const slotInfo = slotMetadata.get(widget.name)\n\n            return {\n              name: widget.name,\n              type: widget.type,\n              value: value,\n              label: widget.label,\n              options: widget.options ? { ...widget.options } : undefined,\n              callback: widget.callback,\n              spec,\n              slotMetadata: slotInfo,\n              isDOMWidget: isDOMWidget(widget)\n            }\n          } catch (error) {\n            return {\n              name: widget.name || 'unknown',\n              type: widget.type || 'text',\n              value: undefined\n            }\n          }\n        }) ?? []\n      )\n    })\n\n    const nodeType =\n      node.type ||\n      node.constructor?.comfyClass ||\n      node.constructor?.title ||\n      node.constructor?.name ||\n      'Unknown'\n\n    const apiNode = node.constructor?.nodeData?.api_node ?? false\n    const badges = node.badges\n\n    return {\n      id: String(node.id),\n      title: typeof node.title === 'string' ? node.title : '',\n      type: nodeType,\n      mode: node.mode || 0,\n      selected: node.selected || false,\n      executing: false, // Will be updated separately based on execution state\n      subgraphId,\n      apiNode,\n      badges,\n      hasErrors: !!node.has_errors,\n      widgets: safeWidgets,\n      inputs: node.inputs ? [...node.inputs] : undefined,\n      outputs: node.outputs ? [...node.outputs] : undefined,\n      flags: node.flags ? { ...node.flags } : undefined,\n      color: node.color || undefined,\n      bgcolor: node.bgcolor || undefined\n    }\n  }\n\n  // Get access to original LiteGraph node (non-reactive)\n  const getNode = (id: string): LGraphNode | undefined => {\n    return nodeRefs.get(id)\n  }\n\n  /**\n   * Validates that a value is a valid WidgetValue type\n   */\n  const validateWidgetValue = (value: unknown): WidgetValue => {\n    if (value === null || value === undefined || value === void 0) {\n      return undefined\n    }\n    if (\n      typeof value === 'string' ||\n      typeof value === 'number' ||\n      typeof value === 'boolean'\n    ) {\n      return value\n    }\n    if (typeof value === 'object') {\n      // Check if it's a File array\n      if (\n        Array.isArray(value) &&\n        value.length > 0 &&\n        value.every((item): item is File => item instanceof File)\n      ) {\n        return value\n      }\n      // Otherwise it's a generic object\n      return value\n    }\n    // If none of the above, return undefined\n    console.warn(`Invalid widget value type: ${typeof value}`, value)\n    return undefined\n  }\n\n  /**\n   * Updates Vue state when widget values change\n   */\n  const updateVueWidgetState = (\n    nodeId: string,\n    widgetName: string,\n    value: unknown\n  ): void => {\n    try {\n      const currentData = vueNodeData.get(nodeId)\n      if (!currentData?.widgets) return\n\n      const updatedWidgets = currentData.widgets.map((w) =>\n        w.name === widgetName ? { ...w, value: validateWidgetValue(value) } : w\n      )\n      // Create a completely new object to ensure Vue reactivity triggers\n      const updatedData = {\n        ...currentData,\n        widgets: updatedWidgets\n      }\n\n      vueNodeData.set(nodeId, updatedData)\n    } catch (error) {\n      // Ignore widget update errors to prevent cascade failures\n    }\n  }\n\n  /**\n   * Creates a wrapped callback for a widget that maintains LiteGraph/Vue sync\n   */\n  const createWrappedWidgetCallback = (\n    widget: { value?: unknown; name: string }, // LiteGraph widget with minimal typing\n    originalCallback: ((value: unknown) => void) | undefined,\n    nodeId: string\n  ) => {\n    let updateInProgress = false\n\n    return (value: unknown) => {\n      if (updateInProgress) return\n      updateInProgress = true\n\n      try {\n        // 1. Update the widget value in LiteGraph (critical for LiteGraph state)\n        // Validate that the value is of an acceptable type\n        if (\n          value !== null &&\n          value !== undefined &&\n          typeof value !== 'string' &&\n          typeof value !== 'number' &&\n          typeof value !== 'boolean' &&\n          typeof value !== 'object'\n        ) {\n          console.warn(`Invalid widget value type: ${typeof value}`)\n          updateInProgress = false\n          return\n        }\n\n        // Always update widget.value to ensure sync\n        widget.value = value\n\n        // 2. Call the original callback if it exists\n        if (originalCallback) {\n          originalCallback.call(widget, value)\n        }\n\n        // 3. Update Vue state to maintain synchronization\n        updateVueWidgetState(nodeId, widget.name, value)\n      } finally {\n        updateInProgress = false\n      }\n    }\n  }\n\n  /**\n   * Sets up widget callbacks for a node\n   */\n  const setupNodeWidgetCallbacks = (node: LGraphNode) => {\n    if (!node.widgets) return\n\n    const nodeId = String(node.id)\n\n    node.widgets.forEach((widget) => {\n      const originalCallback = widget.callback\n      widget.callback = createWrappedWidgetCallback(\n        widget,\n        originalCallback,\n        nodeId\n      )\n    })\n  }\n\n  const syncWithGraph = () => {\n    if (!graph?._nodes) return\n\n    const currentNodes = new Set(graph._nodes.map((n) => String(n.id)))\n\n    // Remove deleted nodes\n    for (const id of Array.from(vueNodeData.keys())) {\n      if (!currentNodes.has(id)) {\n        nodeRefs.delete(id)\n        vueNodeData.delete(id)\n      }\n    }\n\n    // Add/update existing nodes\n    graph._nodes.forEach((node) => {\n      const id = String(node.id)\n\n      // Store non-reactive reference\n      nodeRefs.set(id, node)\n\n      // Set up widget callbacks BEFORE extracting data (critical order)\n      setupNodeWidgetCallbacks(node)\n\n      // Extract and store safe data for Vue\n      vueNodeData.set(id, extractVueNodeData(node))\n    })\n  }\n\n  /**\n   * Handles node addition to the graph - sets up Vue state and spatial indexing\n   * Defers position extraction until after potential configure() calls\n   */\n  const handleNodeAdded = (\n    node: LGraphNode,\n    originalCallback?: (node: LGraphNode) => void\n  ) => {\n    const id = String(node.id)\n\n    // Store non-reactive reference to original node\n    nodeRefs.set(id, node)\n\n    // Set up widget callbacks BEFORE extracting data (critical order)\n    setupNodeWidgetCallbacks(node)\n\n    // Extract initial data for Vue (may be incomplete during graph configure)\n    vueNodeData.set(id, extractVueNodeData(node))\n\n    const initializeVueNodeLayout = () => {\n      // Extract actual positions after configure() has potentially updated them\n      const nodePosition = { x: node.pos[0], y: node.pos[1] }\n      const nodeSize = { width: node.size[0], height: node.size[1] }\n\n      // Add node to layout store with final positions\n      setSource(LayoutSource.Canvas)\n      void createNode(id, {\n        position: nodePosition,\n        size: nodeSize,\n        zIndex: node.order || 0,\n        visible: true\n      })\n    }\n\n    // Check if we're in the middle of configuring the graph (workflow loading)\n    if (window.app?.configuringGraph) {\n      // During workflow loading - defer layout initialization until configure completes\n      // Chain our callback with any existing onAfterGraphConfigured callback\n      node.onAfterGraphConfigured = useChainCallback(\n        node.onAfterGraphConfigured,\n        () => {\n          // Re-extract data now that configure() has populated title/slots/widgets/etc.\n          vueNodeData.set(id, extractVueNodeData(node))\n          initializeVueNodeLayout()\n        }\n      )\n    } else {\n      // Not during workflow loading - initialize layout immediately\n      // This handles individual node additions during normal operation\n      initializeVueNodeLayout()\n    }\n\n    // Call original callback if provided\n    if (originalCallback) {\n      void originalCallback(node)\n    }\n  }\n\n  /**\n   * Handles node removal from the graph - cleans up all references\n   */\n  const handleNodeRemoved = (\n    node: LGraphNode,\n    originalCallback?: (node: LGraphNode) => void\n  ) => {\n    const id = String(node.id)\n\n    // Remove node from layout store\n    setSource(LayoutSource.Canvas)\n    void deleteNode(id)\n\n    // Clean up all tracking references\n    nodeRefs.delete(id)\n    vueNodeData.delete(id)\n\n    // Call original callback if provided\n    if (originalCallback) {\n      originalCallback(node)\n    }\n  }\n\n  /**\n   * Creates cleanup function for event listeners and state\n   */\n  const createCleanupFunction = (\n    originalOnNodeAdded: ((node: LGraphNode) => void) | undefined,\n    originalOnNodeRemoved: ((node: LGraphNode) => void) | undefined,\n    originalOnTrigger: ((event: LGraphTriggerEvent) => void) | undefined\n  ) => {\n    return () => {\n      // Restore original callbacks\n      graph.onNodeAdded = originalOnNodeAdded || undefined\n      graph.onNodeRemoved = originalOnNodeRemoved || undefined\n      graph.onTrigger = originalOnTrigger || undefined\n\n      // Clear all state maps\n      nodeRefs.clear()\n      vueNodeData.clear()\n    }\n  }\n\n  /**\n   * Sets up event listeners - now simplified with extracted handlers\n   */\n  const setupEventListeners = (): (() => void) => {\n    // Store original callbacks\n    const originalOnNodeAdded = graph.onNodeAdded\n    const originalOnNodeRemoved = graph.onNodeRemoved\n    const originalOnTrigger = graph.onTrigger\n\n    // Set up graph event handlers\n    graph.onNodeAdded = (node: LGraphNode) => {\n      handleNodeAdded(node, originalOnNodeAdded)\n    }\n\n    graph.onNodeRemoved = (node: LGraphNode) => {\n      handleNodeRemoved(node, originalOnNodeRemoved)\n    }\n\n    const triggerHandlers: {\n      [K in LGraphTriggerAction]: (event: LGraphTriggerParam<K>) => void\n    } = {\n      'node:property:changed': (propertyEvent) => {\n        const nodeId = String(propertyEvent.nodeId)\n        const currentData = vueNodeData.get(nodeId)\n\n        if (currentData) {\n          switch (propertyEvent.property) {\n            case 'title':\n              vueNodeData.set(nodeId, {\n                ...currentData,\n                title: String(propertyEvent.newValue)\n              })\n              break\n            case 'flags.collapsed':\n              vueNodeData.set(nodeId, {\n                ...currentData,\n                flags: {\n                  ...currentData.flags,\n                  collapsed: Boolean(propertyEvent.newValue)\n                }\n              })\n              break\n            case 'flags.pinned':\n              vueNodeData.set(nodeId, {\n                ...currentData,\n                flags: {\n                  ...currentData.flags,\n                  pinned: Boolean(propertyEvent.newValue)\n                }\n              })\n              break\n            case 'mode':\n              vueNodeData.set(nodeId, {\n                ...currentData,\n                mode:\n                  typeof propertyEvent.newValue === 'number'\n                    ? propertyEvent.newValue\n                    : 0\n              })\n              break\n            case 'color':\n              vueNodeData.set(nodeId, {\n                ...currentData,\n                color:\n                  typeof propertyEvent.newValue === 'string'\n                    ? propertyEvent.newValue\n                    : undefined\n              })\n              break\n            case 'bgcolor':\n              vueNodeData.set(nodeId, {\n                ...currentData,\n                bgcolor:\n                  typeof propertyEvent.newValue === 'string'\n                    ? propertyEvent.newValue\n                    : undefined\n              })\n          }\n        }\n      },\n      'node:slot-errors:changed': (slotErrorsEvent) => {\n        refreshNodeSlots(String(slotErrorsEvent.nodeId))\n      },\n      'node:slot-links:changed': (slotLinksEvent) => {\n        if (slotLinksEvent.slotType === NodeSlotType.INPUT) {\n          refreshNodeSlots(String(slotLinksEvent.nodeId))\n        }\n      }\n    }\n\n    graph.onTrigger = (event: LGraphTriggerEvent) => {\n      switch (event.type) {\n        case 'node:property:changed':\n          triggerHandlers['node:property:changed'](event)\n          break\n        case 'node:slot-errors:changed':\n          triggerHandlers['node:slot-errors:changed'](event)\n          break\n        case 'node:slot-links:changed':\n          triggerHandlers['node:slot-links:changed'](event)\n          break\n      }\n\n      // Chain to original handler\n      originalOnTrigger?.(event)\n    }\n\n    // Initialize state\n    syncWithGraph()\n\n    // Return cleanup function\n    return createCleanupFunction(\n      originalOnNodeAdded || undefined,\n      originalOnNodeRemoved || undefined,\n      originalOnTrigger || undefined\n    )\n  }\n\n  // Set up event listeners immediately\n  const cleanup = setupEventListeners()\n\n  // Process any existing nodes after event listeners are set up\n  if (graph._nodes && graph._nodes.length > 0) {\n    graph._nodes.forEach((node: LGraphNode) => {\n      if (graph.onNodeAdded) {\n        graph.onNodeAdded(node)\n      }\n    })\n  }\n\n  return {\n    vueNodeData,\n    getNode,\n    cleanup\n  }\n}\n","import { createSharedComposable, useLocalStorage } from '@vueuse/core'\n\n// Browser storage events don't fire in the same tab, so separate\n// useLocalStorage() calls create isolated reactive refs. Use shared\n// composable to ensure all components use the same ref instance.\nexport const useVueNodesMigrationDismissed = createSharedComposable(() =>\n  useLocalStorage('comfy.vueNodesMigration.dismissed', false)\n)\n","/**\n * Composable for syncing LiteGraph with the Layout system\n *\n * Implements one-way sync from Layout Store to LiteGraph.\n * The layout store is the single source of truth.\n */\nimport { onUnmounted, ref } from 'vue'\n\nimport type { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { layoutStore } from '@/renderer/core/layout/store/layoutStore'\n\n/**\n * Composable for syncing LiteGraph with the Layout system\n * This replaces the bidirectional sync with a one-way sync\n */\nexport function useLayoutSync() {\n  const unsubscribe = ref<() => void>()\n\n  /**\n   * Start syncing from Layout  LiteGraph\n   */\n  function startSync(canvas: ReturnType<typeof useCanvasStore>['canvas']) {\n    if (!canvas?.graph) return\n\n    // Cancel last subscription\n    stopSync()\n    // Subscribe to layout changes\n    unsubscribe.value = layoutStore.onChange((change) => {\n      // Apply changes to LiteGraph regardless of source\n      // The layout store is the single source of truth\n      for (const nodeId of change.nodeIds) {\n        const layout = layoutStore.getNodeLayoutRef(nodeId).value\n        if (!layout) continue\n\n        const liteNode = canvas.graph?.getNodeById(parseInt(nodeId))\n        if (!liteNode) continue\n\n        if (\n          liteNode.pos[0] !== layout.position.x ||\n          liteNode.pos[1] !== layout.position.y\n        ) {\n          liteNode.pos[0] = layout.position.x\n          liteNode.pos[1] = layout.position.y\n        }\n\n        if (\n          liteNode.size[0] !== layout.size.width ||\n          liteNode.size[1] !== layout.size.height\n        ) {\n          // Use setSize() to trigger onResize callback\n          liteNode.setSize([layout.size.width, layout.size.height])\n        }\n      }\n\n      // Trigger single redraw for all changes\n      canvas.setDirty(true, true)\n    })\n  }\n\n  function stopSync() {\n    unsubscribe.value?.()\n    unsubscribe.value = undefined\n  }\n\n  onUnmounted(stopSync)\n\n  return {\n    startSync,\n    stopSync\n  }\n}\n","import { createSharedComposable, whenever } from '@vueuse/core'\nimport { shallowRef, watch } from 'vue'\n\nimport { useGraphNodeManager } from '@/composables/graph/useGraphNodeManager'\nimport type { GraphNodeManager } from '@/composables/graph/useGraphNodeManager'\nimport { useVueFeatureFlags } from '@/composables/useVueFeatureFlags'\nimport { useVueNodesMigrationDismissed } from '@/composables/useVueNodesMigrationDismissed'\nimport type { LGraphNode } from '@/lib/litegraph/src/litegraph'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useLayoutMutations } from '@/renderer/core/layout/operations/layoutMutations'\nimport { layoutStore } from '@/renderer/core/layout/store/layoutStore'\nimport { useLayoutSync } from '@/renderer/core/layout/sync/useLayoutSync'\nimport { ensureCorrectLayoutScale } from '@/renderer/extensions/vueNodes/layout/ensureCorrectLayoutScale'\nimport { app as comfyApp } from '@/scripts/app'\nimport { useToastStore } from '@/platform/updates/common/toastStore'\n\nfunction useVueNodeLifecycleIndividual() {\n  const canvasStore = useCanvasStore()\n  const layoutMutations = useLayoutMutations()\n  const { shouldRenderVueNodes } = useVueFeatureFlags()\n\n  const nodeManager = shallowRef<GraphNodeManager | null>(null)\n\n  const { startSync } = useLayoutSync()\n\n  const isVueNodeToastDismissed = useVueNodesMigrationDismissed()\n\n  let hasShownMigrationToast = false\n\n  const initializeNodeManager = () => {\n    // Use canvas graph if available (handles subgraph contexts), fallback to app graph\n    const activeGraph = comfyApp.canvas?.graph\n    if (!activeGraph || nodeManager.value) return\n\n    // Initialize the core node manager\n    const manager = useGraphNodeManager(activeGraph)\n    nodeManager.value = manager\n\n    // Initialize layout system with existing nodes from active graph\n    const nodes = activeGraph._nodes.map((node: LGraphNode) => ({\n      id: node.id.toString(),\n      pos: [node.pos[0], node.pos[1]] as [number, number],\n      size: [node.size[0], node.size[1]] as [number, number]\n    }))\n    layoutStore.initializeFromLiteGraph(nodes)\n\n    // Seed reroutes into the Layout Store so hit-testing uses the new path\n    for (const reroute of activeGraph.reroutes.values()) {\n      const [x, y] = reroute.pos\n      const parent = reroute.parentId ?? undefined\n      const linkIds = Array.from(reroute.linkIds)\n      layoutMutations.createReroute(reroute.id, { x, y }, parent, linkIds)\n    }\n\n    // Seed existing links into the Layout Store (topology only)\n    for (const link of activeGraph._links.values()) {\n      layoutMutations.createLink(\n        link.id,\n        link.origin_id,\n        link.origin_slot,\n        link.target_id,\n        link.target_slot\n      )\n    }\n\n    // Initialize layout sync (one-way: Layout Store  LiteGraph)\n    startSync(canvasStore.canvas)\n  }\n\n  const disposeNodeManagerAndSyncs = () => {\n    if (!nodeManager.value) return\n\n    try {\n      nodeManager.value.cleanup()\n    } catch {\n      /* empty */\n    }\n    nodeManager.value = null\n  }\n\n  // Watch for Vue nodes enabled state changes\n  watch(\n    () => shouldRenderVueNodes.value && Boolean(comfyApp.canvas?.graph),\n    (enabled, wasEnabled) => {\n      if (enabled) {\n        initializeNodeManager()\n        ensureCorrectLayoutScale(\n          comfyApp.canvas?.graph?.extra.workflowRendererVersion\n        )\n        if (\n          wasEnabled === false &&\n          !isVueNodeToastDismissed.value &&\n          !hasShownMigrationToast\n        ) {\n          hasShownMigrationToast = true\n          useToastStore().add({\n            group: 'vue-nodes-migration',\n            severity: 'info',\n            life: 0\n          })\n        }\n      }\n    },\n    { immediate: true }\n  )\n\n  whenever(\n    () => !shouldRenderVueNodes.value,\n    () => {\n      ensureCorrectLayoutScale(\n        comfyApp.canvas?.graph?.extra.workflowRendererVersion\n      )\n      disposeNodeManagerAndSyncs()\n      comfyApp.canvas?.setDirty(true, true)\n    }\n  )\n\n  // Consolidated watch for slot layout sync management\n  watch(\n    () => shouldRenderVueNodes.value,\n    (vueMode, oldVueMode) => {\n      const modeChanged = vueMode !== oldVueMode\n\n      // Clear stale slot layouts when switching modes\n      if (modeChanged) {\n        layoutStore.clearAllSlotLayouts()\n      }\n    },\n    { immediate: true, flush: 'sync' }\n  )\n\n  // Handle case where Vue nodes are enabled but graph starts empty\n  const setupEmptyGraphListener = () => {\n    const activeGraph = comfyApp.canvas?.graph\n    if (\n      !shouldRenderVueNodes.value ||\n      nodeManager.value ||\n      activeGraph?._nodes.length !== 0\n    ) {\n      return\n    }\n    const originalOnNodeAdded = activeGraph.onNodeAdded\n    activeGraph.onNodeAdded = function (node: LGraphNode) {\n      // Restore original handler\n      activeGraph.onNodeAdded = originalOnNodeAdded\n\n      // Initialize node manager if needed\n      if (shouldRenderVueNodes.value && !nodeManager.value) {\n        initializeNodeManager()\n      }\n\n      // Call original handler\n      if (originalOnNodeAdded) {\n        originalOnNodeAdded.call(this, node)\n      }\n    }\n  }\n\n  // Cleanup function for component unmounting\n  const cleanup = () => {\n    if (nodeManager.value) {\n      nodeManager.value.cleanup()\n      nodeManager.value = null\n    }\n  }\n\n  return {\n    nodeManager,\n\n    // Lifecycle methods\n    initializeNodeManager,\n    disposeNodeManagerAndSyncs,\n    setupEmptyGraphListener,\n    cleanup\n  }\n}\n\nexport const useVueNodeLifecycle = createSharedComposable(\n  useVueNodeLifecycleIndividual\n)\n","/**\n * Vue Nodes Viewport Culling\n *\n * Principles:\n * 1. Query DOM directly using data attributes (no cache to maintain)\n * 2. Set display none on element to avoid cascade resolution overhead\n * 3. Only run when transform changes (event driven)\n */\nimport { createSharedComposable, useThrottleFn } from '@vueuse/core'\nimport { computed } from 'vue'\n\nimport { useVueNodeLifecycle } from '@/composables/graph/useVueNodeLifecycle'\nimport type { LGraphNode } from '@/lib/litegraph/src/LGraphNode'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { app } from '@/scripts/app'\n\ntype Bounds = [left: number, right: number, top: number, bottom: number]\n\nfunction getNodeBounds(node: LGraphNode): Bounds {\n  const [nodeLeft, nodeTop] = node.pos\n  const nodeRight = nodeLeft + node.size[0]\n  const nodeBottom = nodeTop + node.size[1]\n  return [nodeLeft, nodeRight, nodeTop, nodeBottom]\n}\n\nfunction viewportEdges(\n  canvas: ReturnType<typeof useCanvasStore>['canvas']\n): Bounds | undefined {\n  if (!canvas) {\n    return\n  }\n  const ds = canvas.ds\n  const viewport_width = canvas.canvas.width\n  const viewport_height = canvas.canvas.height\n  const margin = 500 * ds.scale\n\n  const [xOffset, yOffset] = ds.offset\n\n  const leftEdge = -margin / ds.scale - xOffset\n  const rightEdge = (viewport_width + margin) / ds.scale - xOffset\n  const topEdge = -margin / ds.scale - yOffset\n  const bottomEdge = (viewport_height + margin) / ds.scale - yOffset\n  return [leftEdge, rightEdge, topEdge, bottomEdge]\n}\n\nfunction boundsIntersect(boxA: Bounds, boxB: Bounds): boolean {\n  const [aLeft, aRight, aTop, aBottom] = boxA\n  const [bLeft, bRight, bTop, bBottom] = boxB\n\n  const leftOf = aRight < bLeft\n  const rightOf = aLeft > bRight\n  const above = aBottom < bTop\n  const below = aTop > bBottom\n  return !(leftOf || rightOf || above || below)\n}\n\nfunction useViewportCullingIndividual() {\n  const canvasStore = useCanvasStore()\n  const { nodeManager } = useVueNodeLifecycle()\n\n  const viewport = computed(() => viewportEdges(canvasStore.canvas))\n\n  function inViewport(node: LGraphNode | undefined): boolean {\n    if (!viewport.value || !node) {\n      return true\n    }\n    const nodeBounds = getNodeBounds(node)\n    return boundsIntersect(nodeBounds, viewport.value)\n  }\n\n  /**\n   * Update visibility of all nodes based on viewport\n   * Queries DOM directly - no cache maintenance needed\n   */\n  function updateVisibility() {\n    if (!nodeManager.value || !app.canvas) return // load bearing app.canvas check for workflows being loaded.\n\n    const nodeElements = document.querySelectorAll('[data-node-id]')\n    for (const element of nodeElements) {\n      const nodeId = element.getAttribute('data-node-id')\n      if (!nodeId) continue\n\n      const node = nodeManager.value.getNode(nodeId)\n      if (!node) continue\n\n      const displayValue = inViewport(node) ? '' : 'none'\n      if (\n        element instanceof HTMLElement &&\n        element.style.display !== displayValue\n      ) {\n        element.style.display = displayValue\n      }\n    }\n  }\n\n  const handleTransformUpdate = useThrottleFn(() => updateVisibility, 100, true)\n\n  return { handleTransformUpdate }\n}\n\nexport const useViewportCulling = createSharedComposable(\n  useViewportCullingIndividual\n)\n","import type { INodeInputSlot, LGraphNode } from '@/lib/litegraph/src/litegraph'\nimport type { IComboWidget } from '@/lib/litegraph/src/types/widgets'\n\n/**\n * Function that calculates dynamic pricing based on node widget values\n */\ntype PricingFunction = (node: LGraphNode) => string\n\n/**\n * Safely executes a pricing function with error handling\n * Returns null if the function throws an error, allowing the node to still render\n */\nfunction safePricingExecution(\n  fn: PricingFunction,\n  node: LGraphNode,\n  fallback: string = ''\n): string {\n  try {\n    return fn(node)\n  } catch (error) {\n    // Log error in development but don't throw to avoid breaking node rendering\n    if (process.env.NODE_ENV === 'development') {\n      console.warn(\n        'Pricing calculation failed for node:',\n        node.constructor?.nodeData?.name,\n        error\n      )\n    }\n    return fallback\n  }\n}\n\n/**\n * Helper function to calculate Runway duration-based pricing\n * @param node - The LiteGraph node\n * @returns Formatted price string\n */\nconst calculateRunwayDurationPrice = (node: LGraphNode): string => {\n  const durationWidget = node.widgets?.find(\n    (w) => w.name === 'duration'\n  ) as IComboWidget\n\n  if (!durationWidget) return '$0.05/second'\n\n  const duration = Number(durationWidget.value)\n  // If duration is 0 or NaN, don't fall back to 5 seconds - just use 0\n  const validDuration = isNaN(duration) ? 5 : duration\n  const cost = (0.05 * validDuration).toFixed(2)\n  return `$${cost}/Run`\n}\n\nconst pixversePricingCalculator = (node: LGraphNode): string => {\n  const durationWidget = node.widgets?.find(\n    (w) => w.name === 'duration_seconds'\n  ) as IComboWidget\n  const qualityWidget = node.widgets?.find(\n    (w) => w.name === 'quality'\n  ) as IComboWidget\n  const motionModeWidget = node.widgets?.find(\n    (w) => w.name === 'motion_mode'\n  ) as IComboWidget\n\n  if (!durationWidget || !qualityWidget) {\n    return '$0.45-1.2/Run (varies with duration, quality & motion mode)'\n  }\n\n  const duration = String(durationWidget.value)\n  const quality = String(qualityWidget.value)\n  const motionMode = String(motionModeWidget?.value)\n\n  // Basic pricing based on duration and quality\n  if (duration.includes('5')) {\n    if (quality.includes('1080p')) return '$1.2/Run'\n    if (quality.includes('720p') && motionMode?.includes('fast'))\n      return '$1.2/Run'\n    if (quality.includes('720p') && motionMode?.includes('normal'))\n      return '$0.6/Run'\n    if (quality.includes('540p') && motionMode?.includes('fast'))\n      return '$0.9/Run'\n    if (quality.includes('540p') && motionMode?.includes('normal'))\n      return '$0.45/Run'\n    if (quality.includes('360p') && motionMode?.includes('fast'))\n      return '$0.9/Run'\n    if (quality.includes('360p') && motionMode?.includes('normal'))\n      return '$0.45/Run'\n    if (quality.includes('720p') && motionMode?.includes('fast'))\n      return '$1.2/Run'\n  } else if (duration.includes('8')) {\n    if (quality.includes('720p') && motionMode?.includes('normal'))\n      return '$1.2/Run'\n    if (quality.includes('540p') && motionMode?.includes('normal'))\n      return '$0.9/Run'\n    if (quality.includes('540p') && motionMode?.includes('fast'))\n      return '$1.2/Run'\n    if (quality.includes('360p') && motionMode?.includes('normal'))\n      return '$0.9/Run'\n    if (quality.includes('360p') && motionMode?.includes('fast'))\n      return '$1.2/Run'\n    if (quality.includes('1080p') && motionMode?.includes('normal'))\n      return '$1.2/Run'\n    if (quality.includes('1080p') && motionMode?.includes('fast'))\n      return '$1.2/Run'\n    if (quality.includes('720p') && motionMode?.includes('normal'))\n      return '$1.2/Run'\n    if (quality.includes('720p') && motionMode?.includes('fast'))\n      return '$1.2/Run'\n  }\n\n  return '$0.9/Run'\n}\n\nconst byteDanceVideoPricingCalculator = (node: LGraphNode): string => {\n  const modelWidget = node.widgets?.find(\n    (w) => w.name === 'model'\n  ) as IComboWidget\n  const durationWidget = node.widgets?.find(\n    (w) => w.name === 'duration'\n  ) as IComboWidget\n  const resolutionWidget = node.widgets?.find(\n    (w) => w.name === 'resolution'\n  ) as IComboWidget\n\n  if (!modelWidget || !durationWidget || !resolutionWidget) return 'Token-based'\n\n  const model = String(modelWidget.value).toLowerCase()\n  const resolution = String(resolutionWidget.value).toLowerCase()\n  const seconds = parseFloat(String(durationWidget.value))\n  const priceByModel: Record<string, Record<string, [number, number]>> = {\n    'seedance-1-0-pro': {\n      '480p': [0.23, 0.24],\n      '720p': [0.51, 0.56],\n      '1080p': [1.18, 1.22]\n    },\n    'seedance-1-0-lite': {\n      '480p': [0.17, 0.18],\n      '720p': [0.37, 0.41],\n      '1080p': [0.85, 0.88]\n    }\n  }\n\n  const modelKey = model.includes('seedance-1-0-pro')\n    ? 'seedance-1-0-pro'\n    : model.includes('seedance-1-0-lite')\n      ? 'seedance-1-0-lite'\n      : ''\n\n  const resKey = resolution.includes('1080')\n    ? '1080p'\n    : resolution.includes('720')\n      ? '720p'\n      : resolution.includes('480')\n        ? '480p'\n        : ''\n\n  const baseRange =\n    modelKey && resKey ? priceByModel[modelKey]?.[resKey] : undefined\n  if (!baseRange) return 'Token-based'\n\n  const [min10s, max10s] = baseRange\n  const scale = seconds / 10\n  const minCost = min10s * scale\n  const maxCost = max10s * scale\n\n  const minStr = `$${minCost.toFixed(2)}/Run`\n  const maxStr = `$${maxCost.toFixed(2)}/Run`\n\n  return minStr === maxStr\n    ? minStr\n    : `$${minCost.toFixed(2)}-$${maxCost.toFixed(2)}/Run`\n}\n\nconst ltxvPricingCalculator = (node: LGraphNode): string => {\n  const modelWidget = node.widgets?.find(\n    (w) => w.name === 'model'\n  ) as IComboWidget\n  const durationWidget = node.widgets?.find(\n    (w) => w.name === 'duration'\n  ) as IComboWidget\n  const resolutionWidget = node.widgets?.find(\n    (w) => w.name === 'resolution'\n  ) as IComboWidget\n\n  const fallback = '$0.04-0.24/second'\n  if (!modelWidget || !durationWidget || !resolutionWidget) return fallback\n\n  const model = String(modelWidget.value).toLowerCase()\n  const resolution = String(resolutionWidget.value).toLowerCase()\n  const seconds = parseFloat(String(durationWidget.value))\n  const priceByModel: Record<string, Record<string, number>> = {\n    'ltx-2 (pro)': {\n      '1920x1080': 0.06,\n      '2560x1440': 0.12,\n      '3840x2160': 0.24\n    },\n    'ltx-2 (fast)': {\n      '1920x1080': 0.04,\n      '2560x1440': 0.08,\n      '3840x2160': 0.16\n    }\n  }\n\n  const modelTable = priceByModel[model]\n  if (!modelTable) return fallback\n\n  const pps = modelTable[resolution]\n  if (!pps) return fallback\n\n  const cost = (pps * seconds).toFixed(2)\n  return `$${cost}/Run`\n}\n\n// ---- constants ----\nconst SORA_SIZES = {\n  BASIC: new Set(['720x1280', '1280x720']),\n  PRO: new Set(['1024x1792', '1792x1024'])\n}\nconst ALL_SIZES = new Set([...SORA_SIZES.BASIC, ...SORA_SIZES.PRO])\n\n// ---- sora-2 pricing helpers ----\nfunction validateSora2Selection(\n  modelRaw: string,\n  duration: number,\n  sizeRaw: string\n): string | undefined {\n  const model = modelRaw?.toLowerCase() ?? ''\n  const size = sizeRaw?.toLowerCase() ?? ''\n\n  if (!duration || Number.isNaN(duration)) return 'Set duration (4s / 8s / 12s)'\n  if (!size) return 'Set size (720x1280, 1280x720, 1024x1792, 1792x1024)'\n  if (!ALL_SIZES.has(size))\n    return 'Invalid size. Must be 720x1280, 1280x720, 1024x1792, or 1792x1024.'\n\n  if (model.includes('sora-2-pro')) return undefined\n\n  if (model.includes('sora-2') && !SORA_SIZES.BASIC.has(size))\n    return 'sora-2 supports only 720x1280 or 1280x720'\n\n  if (!model.includes('sora-2')) return 'Unsupported model'\n\n  return undefined\n}\n\nfunction perSecForSora2(modelRaw: string, sizeRaw: string): number {\n  const model = modelRaw?.toLowerCase() ?? ''\n  const size = sizeRaw?.toLowerCase() ?? ''\n\n  if (model.includes('sora-2-pro')) {\n    return SORA_SIZES.PRO.has(size) ? 0.5 : 0.3\n  }\n  if (model.includes('sora-2')) return 0.1\n\n  return SORA_SIZES.PRO.has(size) ? 0.5 : 0.1\n}\n\nfunction formatRunPrice(perSec: number, duration: number) {\n  return `$${(perSec * duration).toFixed(2)}/Run`\n}\n\n// ---- pricing calculator ----\nconst sora2PricingCalculator: PricingFunction = (node: LGraphNode): string => {\n  const getWidgetValue = (name: string) =>\n    String(node.widgets?.find((w) => w.name === name)?.value ?? '')\n\n  const model = getWidgetValue('model')\n  const size = getWidgetValue('size')\n  const duration = Number(\n    node.widgets?.find((w) => ['duration', 'duration_s'].includes(w.name))\n      ?.value\n  )\n\n  if (!model || !size || !duration) return 'Set model, duration & size'\n\n  const validationError = validateSora2Selection(model, duration, size)\n  if (validationError) return validationError\n\n  const perSec = perSecForSora2(model, size)\n  return formatRunPrice(perSec, duration)\n}\n\n/**\n * Static pricing data for API nodes, now supporting both strings and functions\n */\nconst apiNodeCosts: Record<string, { displayPrice: string | PricingFunction }> =\n  {\n    FluxProCannyNode: {\n      displayPrice: '$0.05/Run'\n    },\n    FluxProDepthNode: {\n      displayPrice: '$0.05/Run'\n    },\n    FluxProExpandNode: {\n      displayPrice: '$0.05/Run'\n    },\n    FluxProFillNode: {\n      displayPrice: '$0.05/Run'\n    },\n    FluxProUltraImageNode: {\n      displayPrice: '$0.06/Run'\n    },\n    FluxProKontextProNode: {\n      displayPrice: '$0.04/Run'\n    },\n    FluxProKontextMaxNode: {\n      displayPrice: '$0.08/Run'\n    },\n    OpenAIVideoSora2: {\n      displayPrice: sora2PricingCalculator\n    },\n    IdeogramV1: {\n      displayPrice: (node: LGraphNode): string => {\n        const numImagesWidget = node.widgets?.find(\n          (w) => w.name === 'num_images'\n        ) as IComboWidget\n        const turboWidget = node.widgets?.find(\n          (w) => w.name === 'turbo'\n        ) as IComboWidget\n\n        if (!numImagesWidget) return '$0.02-0.06 x num_images/Run'\n\n        const numImages = Number(numImagesWidget.value) || 1\n        const turbo = String(turboWidget?.value).toLowerCase() === 'true'\n        const basePrice = turbo ? 0.02 : 0.06\n        const cost = (basePrice * numImages).toFixed(2)\n        return `$${cost}/Run`\n      }\n    },\n    IdeogramV2: {\n      displayPrice: (node: LGraphNode): string => {\n        const numImagesWidget = node.widgets?.find(\n          (w) => w.name === 'num_images'\n        ) as IComboWidget\n        const turboWidget = node.widgets?.find(\n          (w) => w.name === 'turbo'\n        ) as IComboWidget\n\n        if (!numImagesWidget) return '$0.05-0.08 x num_images/Run'\n\n        const numImages = Number(numImagesWidget.value) || 1\n        const turbo = String(turboWidget?.value).toLowerCase() === 'true'\n        const basePrice = turbo ? 0.05 : 0.08\n        const cost = (basePrice * numImages).toFixed(2)\n        return `$${cost}/Run`\n      }\n    },\n    IdeogramV3: {\n      displayPrice: (node: LGraphNode): string => {\n        const renderingSpeedWidget = node.widgets?.find(\n          (w) => w.name === 'rendering_speed'\n        ) as IComboWidget\n        const numImagesWidget = node.widgets?.find(\n          (w) => w.name === 'num_images'\n        ) as IComboWidget\n        const characterInput = node.inputs?.find(\n          (i) => i.name === 'character_image'\n        ) as INodeInputSlot\n        const hasCharacter =\n          typeof characterInput?.link !== 'undefined' &&\n          characterInput.link != null\n\n        if (!renderingSpeedWidget)\n          return '$0.03-0.08 x num_images/Run (varies with rendering speed & num_images)'\n\n        const numImages = Number(numImagesWidget?.value) || 1\n        let basePrice = 0.06 // default balanced price\n\n        const renderingSpeed = String(renderingSpeedWidget.value)\n        if (renderingSpeed.toLowerCase().includes('quality')) {\n          if (hasCharacter) {\n            basePrice = 0.2\n          } else {\n            basePrice = 0.09\n          }\n        } else if (renderingSpeed.toLowerCase().includes('default')) {\n          if (hasCharacter) {\n            basePrice = 0.15\n          } else {\n            basePrice = 0.06\n          }\n        } else if (renderingSpeed.toLowerCase().includes('turbo')) {\n          if (hasCharacter) {\n            basePrice = 0.1\n          } else {\n            basePrice = 0.03\n          }\n        }\n\n        const totalCost = (basePrice * numImages).toFixed(2)\n        return `$${totalCost}/Run`\n      }\n    },\n    KlingCameraControlI2VNode: {\n      displayPrice: '$0.49/Run'\n    },\n    KlingCameraControlT2VNode: {\n      displayPrice: '$0.14/Run'\n    },\n    KlingDualCharacterVideoEffectNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const modeWidget = node.widgets?.find(\n          (w) => w.name === 'mode'\n        ) as IComboWidget\n        const modelWidget = node.widgets?.find(\n          (w) => w.name === 'model_name'\n        ) as IComboWidget\n        const durationWidget = node.widgets?.find(\n          (w) => w.name === 'duration'\n        ) as IComboWidget\n        if (!modeWidget || !modelWidget || !durationWidget)\n          return '$0.14-2.80/Run (varies with model, mode & duration)'\n\n        const modeValue = String(modeWidget.value)\n        const durationValue = String(durationWidget.value)\n        const modelValue = String(modelWidget.value)\n\n        // Same pricing matrix as KlingTextToVideoNode\n        if (modelValue.includes('v1-6') || modelValue.includes('v1-5')) {\n          if (modeValue.includes('pro')) {\n            return durationValue.includes('10') ? '$0.98/Run' : '$0.49/Run'\n          } else {\n            return durationValue.includes('10') ? '$0.56/Run' : '$0.28/Run'\n          }\n        } else if (modelValue.includes('v1')) {\n          if (modeValue.includes('pro')) {\n            return durationValue.includes('10') ? '$0.98/Run' : '$0.49/Run'\n          } else {\n            return durationValue.includes('10') ? '$0.28/Run' : '$0.14/Run'\n          }\n        }\n\n        return '$0.14/Run'\n      }\n    },\n    KlingImage2VideoNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const modeWidget = node.widgets?.find(\n          (w) => w.name === 'mode'\n        ) as IComboWidget\n        const modelWidget = node.widgets?.find(\n          (w) => w.name === 'model_name'\n        ) as IComboWidget\n        const durationWidget = node.widgets?.find(\n          (w) => w.name === 'duration'\n        ) as IComboWidget\n\n        if (!modeWidget) {\n          if (!modelWidget)\n            return '$0.14-2.80/Run (varies with model, mode & duration)'\n\n          const modelValue = String(modelWidget.value)\n          if (\n            modelValue.includes('v2-1-master') ||\n            modelValue.includes('v2-master')\n          ) {\n            return '$1.40/Run'\n          } else if (\n            modelValue.includes('v1-6') ||\n            modelValue.includes('v1-5')\n          ) {\n            return '$0.28/Run'\n          }\n          return '$0.14/Run'\n        }\n\n        const modeValue = String(modeWidget.value)\n        const durationValue = String(durationWidget.value)\n        const modelValue = String(modelWidget.value)\n\n        // Same pricing matrix as KlingTextToVideoNode\n        if (modelValue.includes('v2-5-turbo')) {\n          if (durationValue.includes('10')) {\n            return '$0.70/Run'\n          }\n          return '$0.35/Run' // 5s default\n        } else if (\n          modelValue.includes('v2-1-master') ||\n          modelValue.includes('v2-master')\n        ) {\n          if (durationValue.includes('10')) {\n            return '$2.80/Run'\n          }\n          return '$1.40/Run' // 5s default\n        } else if (\n          modelValue.includes('v2-1') ||\n          modelValue.includes('v1-6') ||\n          modelValue.includes('v1-5')\n        ) {\n          if (modeValue.includes('pro')) {\n            return durationValue.includes('10') ? '$0.98/Run' : '$0.49/Run'\n          } else {\n            return durationValue.includes('10') ? '$0.56/Run' : '$0.28/Run'\n          }\n        } else if (modelValue.includes('v1')) {\n          if (modeValue.includes('pro')) {\n            return durationValue.includes('10') ? '$0.98/Run' : '$0.49/Run'\n          } else {\n            return durationValue.includes('10') ? '$0.28/Run' : '$0.14/Run'\n          }\n        }\n\n        return '$0.14/Run'\n      }\n    },\n    KlingImageGenerationNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const imageInputWidget = node.inputs?.find((i) => i.name === 'image')\n        // If link is not null => image is connected => modality is image to image\n        const modality = imageInputWidget?.link\n          ? 'image to image'\n          : 'text to image'\n        const modelWidget = node.widgets?.find(\n          (w) => w.name === 'model_name'\n        ) as IComboWidget\n        const nWidget = node.widgets?.find(\n          (w) => w.name === 'n'\n        ) as IComboWidget\n\n        if (!modelWidget)\n          return '$0.0035-0.028 x n/Run (varies with modality & model)'\n\n        const model = String(modelWidget.value)\n        const n = Number(nWidget?.value) || 1\n        let basePrice = 0.014 // default\n\n        if (modality.includes('text to image')) {\n          if (model.includes('kling-v1-5') || model.includes('kling-v2')) {\n            basePrice = 0.014\n          } else if (model.includes('kling-v1')) {\n            basePrice = 0.0035\n          }\n        } else if (modality.includes('image to image')) {\n          if (model.includes('kling-v1-5')) {\n            basePrice = 0.028\n          } else if (model.includes('kling-v1')) {\n            basePrice = 0.0035\n          }\n        }\n\n        const totalCost = (basePrice * n).toFixed(4)\n        return `$${totalCost}/Run`\n      }\n    },\n    KlingLipSyncAudioToVideoNode: {\n      displayPrice: '~$0.10/Run'\n    },\n    KlingLipSyncTextToVideoNode: {\n      displayPrice: '~$0.10/Run'\n    },\n    KlingSingleImageVideoEffectNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const effectSceneWidget = node.widgets?.find(\n          (w) => w.name === 'effect_scene'\n        ) as IComboWidget\n\n        if (!effectSceneWidget)\n          return '$0.28-0.49/Run (varies with effect scene)'\n\n        const effectScene = String(effectSceneWidget.value)\n        if (\n          effectScene.includes('fuzzyfuzzy') ||\n          effectScene.includes('squish')\n        ) {\n          return '$0.28/Run'\n        } else if (effectScene.includes('dizzydizzy')) {\n          return '$0.49/Run'\n        } else if (effectScene.includes('bloombloom')) {\n          return '$0.49/Run'\n        } else if (effectScene.includes('expansion')) {\n          return '$0.28/Run'\n        }\n\n        return '$0.28/Run'\n      }\n    },\n    KlingStartEndFrameNode: {\n      displayPrice: (node: LGraphNode): string => {\n        // Same pricing as KlingTextToVideoNode per CSV (\"Same as text to video\")\n        const modeWidget = node.widgets?.find(\n          (w) => w.name === 'mode'\n        ) as IComboWidget\n        if (!modeWidget)\n          return '$0.14-2.80/Run (varies with model, mode & duration)'\n\n        const modeValue = String(modeWidget.value)\n\n        // Same pricing matrix as KlingTextToVideoNode\n        if (modeValue.includes('v2-1')) {\n          if (modeValue.includes('10s')) {\n            return '$0.98/Run' // pro, 10s\n          }\n          return '$0.49/Run' // pro, 5s default\n        } else if (modeValue.includes('v2-master')) {\n          if (modeValue.includes('10s')) {\n            return '$2.80/Run'\n          }\n          return '$1.40/Run' // 5s default\n        } else if (modeValue.includes('v1-6')) {\n          if (modeValue.includes('pro')) {\n            return modeValue.includes('10s') ? '$0.98/Run' : '$0.49/Run'\n          } else {\n            return modeValue.includes('10s') ? '$0.56/Run' : '$0.28/Run'\n          }\n        } else if (modeValue.includes('v1')) {\n          if (modeValue.includes('pro')) {\n            return modeValue.includes('10s') ? '$0.98/Run' : '$0.49/Run'\n          } else {\n            return modeValue.includes('10s') ? '$0.28/Run' : '$0.14/Run'\n          }\n        }\n\n        return '$0.14/Run'\n      }\n    },\n    KlingTextToVideoNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const modeWidget = node.widgets?.find(\n          (w) => w.name === 'mode'\n        ) as IComboWidget\n        if (!modeWidget)\n          return '$0.14-2.80/Run (varies with model, mode & duration)'\n\n        const modeValue = String(modeWidget.value)\n\n        // Pricing matrix from CSV data based on mode string content\n        if (modeValue.includes('v2-5-turbo')) {\n          if (modeValue.includes('10')) {\n            return '$0.70/Run'\n          }\n          return '$0.35/Run' // 5s default\n        } else if (modeValue.includes('v2-1-master')) {\n          if (modeValue.includes('10s')) {\n            return '$2.80/Run' // price is the same as for v2-master model\n          }\n          return '$1.40/Run' // price is the same as for v2-master model\n        } else if (modeValue.includes('v2-master')) {\n          if (modeValue.includes('10s')) {\n            return '$2.80/Run'\n          }\n          return '$1.40/Run' // 5s default\n        } else if (modeValue.includes('v1-6')) {\n          if (modeValue.includes('pro')) {\n            return modeValue.includes('10s') ? '$0.98/Run' : '$0.49/Run'\n          } else {\n            return modeValue.includes('10s') ? '$0.56/Run' : '$0.28/Run'\n          }\n        } else if (modeValue.includes('v1')) {\n          if (modeValue.includes('pro')) {\n            return modeValue.includes('10s') ? '$0.98/Run' : '$0.49/Run'\n          } else {\n            return modeValue.includes('10s') ? '$0.28/Run' : '$0.14/Run'\n          }\n        }\n\n        return '$0.14/Run'\n      }\n    },\n    KlingVideoExtendNode: {\n      displayPrice: '$0.28/Run'\n    },\n    KlingVirtualTryOnNode: {\n      displayPrice: '$0.07/Run'\n    },\n    LumaImageToVideoNode: {\n      displayPrice: (node: LGraphNode): string => {\n        // Same pricing as LumaVideoNode per CSV\n        const modelWidget = node.widgets?.find(\n          (w) => w.name === 'model'\n        ) as IComboWidget\n        const resolutionWidget = node.widgets?.find(\n          (w) => w.name === 'resolution'\n        ) as IComboWidget\n        const durationWidget = node.widgets?.find(\n          (w) => w.name === 'duration'\n        ) as IComboWidget\n\n        if (!modelWidget || !resolutionWidget || !durationWidget) {\n          return '$0.14-11.47/Run (varies with model, resolution & duration)'\n        }\n\n        const model = String(modelWidget.value)\n        const resolution = String(resolutionWidget.value).toLowerCase()\n        const duration = String(durationWidget.value)\n\n        if (model.includes('ray-flash-2')) {\n          if (duration.includes('5s')) {\n            if (resolution.includes('4k')) return '$2.19/Run'\n            if (resolution.includes('1080p')) return '$0.55/Run'\n            if (resolution.includes('720p')) return '$0.24/Run'\n            if (resolution.includes('540p')) return '$0.14/Run'\n          } else if (duration.includes('9s')) {\n            if (resolution.includes('4k')) return '$3.95/Run'\n            if (resolution.includes('1080p')) return '$0.99/Run'\n            if (resolution.includes('720p')) return '$0.43/Run'\n            if (resolution.includes('540p')) return '$0.252/Run'\n          }\n        } else if (model.includes('ray-2')) {\n          if (duration.includes('5s')) {\n            if (resolution.includes('4k')) return '$6.37/Run'\n            if (resolution.includes('1080p')) return '$1.59/Run'\n            if (resolution.includes('720p')) return '$0.71/Run'\n            if (resolution.includes('540p')) return '$0.40/Run'\n          } else if (duration.includes('9s')) {\n            if (resolution.includes('4k')) return '$11.47/Run'\n            if (resolution.includes('1080p')) return '$2.87/Run'\n            if (resolution.includes('720p')) return '$1.28/Run'\n            if (resolution.includes('540p')) return '$0.72/Run'\n          }\n        } else if (model.includes('ray-1.6')) {\n          return '$0.35/Run'\n        }\n\n        return '$0.55/Run'\n      }\n    },\n    LumaVideoNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const modelWidget = node.widgets?.find(\n          (w) => w.name === 'model'\n        ) as IComboWidget\n        const resolutionWidget = node.widgets?.find(\n          (w) => w.name === 'resolution'\n        ) as IComboWidget\n        const durationWidget = node.widgets?.find(\n          (w) => w.name === 'duration'\n        ) as IComboWidget\n\n        if (!modelWidget || !resolutionWidget || !durationWidget) {\n          return '$0.14-11.47/Run (varies with model, resolution & duration)'\n        }\n\n        const model = String(modelWidget.value)\n        const resolution = String(resolutionWidget.value).toLowerCase()\n        const duration = String(durationWidget.value)\n\n        if (model.includes('ray-flash-2')) {\n          if (duration.includes('5s')) {\n            if (resolution.includes('4k')) return '$2.19/Run'\n            if (resolution.includes('1080p')) return '$0.55/Run'\n            if (resolution.includes('720p')) return '$0.24/Run'\n            if (resolution.includes('540p')) return '$0.14/Run'\n          } else if (duration.includes('9s')) {\n            if (resolution.includes('4k')) return '$3.95/Run'\n            if (resolution.includes('1080p')) return '$0.99/Run'\n            if (resolution.includes('720p')) return '$0.43/Run'\n            if (resolution.includes('540p')) return '$0.252/Run'\n          }\n        } else if (model.includes('ray-2')) {\n          if (duration.includes('5s')) {\n            if (resolution.includes('4k')) return '$6.37/Run'\n            if (resolution.includes('1080p')) return '$1.59/Run'\n            if (resolution.includes('720p')) return '$0.71/Run'\n            if (resolution.includes('540p')) return '$0.40/Run'\n          } else if (duration.includes('9s')) {\n            if (resolution.includes('4k')) return '$11.47/Run'\n            if (resolution.includes('1080p')) return '$2.87/Run'\n            if (resolution.includes('720p')) return '$1.28/Run'\n            if (resolution.includes('540p')) return '$0.72/Run'\n          }\n        } else if (model.includes('ray-1-6')) {\n          return '$0.35/Run'\n        }\n\n        return '$0.55/Run'\n      }\n    },\n    MinimaxImageToVideoNode: {\n      displayPrice: '$0.43/Run'\n    },\n    MinimaxTextToVideoNode: {\n      displayPrice: '$0.43/Run'\n    },\n    MinimaxHailuoVideoNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const resolutionWidget = node.widgets?.find(\n          (w) => w.name === 'resolution'\n        ) as IComboWidget\n        const durationWidget = node.widgets?.find(\n          (w) => w.name === 'duration'\n        ) as IComboWidget\n\n        if (!resolutionWidget || !durationWidget) {\n          return '$0.28-0.56/Run (varies with resolution & duration)'\n        }\n\n        const resolution = String(resolutionWidget.value)\n        const duration = String(durationWidget.value)\n\n        if (resolution.includes('768P')) {\n          if (duration.includes('6')) return '$0.28/Run'\n          if (duration.includes('10')) return '$0.56/Run'\n        } else if (resolution.includes('1080P')) {\n          if (duration.includes('6')) return '$0.49/Run'\n        }\n\n        return '$0.43/Run' // default median\n      }\n    },\n    OpenAIDalle2: {\n      displayPrice: (node: LGraphNode): string => {\n        const sizeWidget = node.widgets?.find(\n          (w) => w.name === 'size'\n        ) as IComboWidget\n        const nWidget = node.widgets?.find(\n          (w) => w.name === 'n'\n        ) as IComboWidget\n\n        if (!sizeWidget) return '$0.016-0.02 x n/Run (varies with size & n)'\n\n        const size = String(sizeWidget.value)\n        const n = Number(nWidget?.value) || 1\n        let basePrice = 0.02 // default\n\n        if (size.includes('1024x1024')) {\n          basePrice = 0.02\n        } else if (size.includes('512x512')) {\n          basePrice = 0.018\n        } else if (size.includes('256x256')) {\n          basePrice = 0.016\n        }\n\n        const totalCost = (basePrice * n).toFixed(3)\n        return `$${totalCost}/Run`\n      }\n    },\n    OpenAIDalle3: {\n      displayPrice: (node: LGraphNode): string => {\n        // Get size and quality widgets\n        const sizeWidget = node.widgets?.find(\n          (w) => w.name === 'size'\n        ) as IComboWidget\n        const qualityWidget = node.widgets?.find(\n          (w) => w.name === 'quality'\n        ) as IComboWidget\n\n        if (!sizeWidget || !qualityWidget)\n          return '$0.04-0.12/Run (varies with size & quality)'\n\n        const size = String(sizeWidget.value)\n        const quality = String(qualityWidget.value)\n\n        // Pricing matrix based on CSV data\n        if (size.includes('1024x1024')) {\n          return quality.includes('hd') ? '$0.08/Run' : '$0.04/Run'\n        } else if (size.includes('1792x1024') || size.includes('1024x1792')) {\n          return quality.includes('hd') ? '$0.12/Run' : '$0.08/Run'\n        }\n\n        // Default value\n        return '$0.04/Run'\n      }\n    },\n    OpenAIGPTImage1: {\n      displayPrice: (node: LGraphNode): string => {\n        const qualityWidget = node.widgets?.find(\n          (w) => w.name === 'quality'\n        ) as IComboWidget\n        const nWidget = node.widgets?.find(\n          (w) => w.name === 'n'\n        ) as IComboWidget\n\n        if (!qualityWidget)\n          return '$0.011-0.30 x n/Run (varies with quality & n)'\n\n        const quality = String(qualityWidget.value)\n        const n = Number(nWidget?.value) || 1\n        let basePriceRange = '$0.046-0.07' // default medium\n\n        if (quality.includes('high')) {\n          basePriceRange = '$0.167-0.30'\n        } else if (quality.includes('medium')) {\n          basePriceRange = '$0.046-0.07'\n        } else if (quality.includes('low')) {\n          basePriceRange = '$0.011-0.02'\n        }\n\n        if (n === 1) {\n          return `${basePriceRange}/Run`\n        } else {\n          return `${basePriceRange} x ${n}/Run`\n        }\n      }\n    },\n    PikaImageToVideoNode2_2: {\n      displayPrice: (node: LGraphNode): string => {\n        const durationWidget = node.widgets?.find(\n          (w) => w.name === 'duration'\n        ) as IComboWidget\n        const resolutionWidget = node.widgets?.find(\n          (w) => w.name === 'resolution'\n        ) as IComboWidget\n\n        if (!durationWidget || !resolutionWidget) {\n          return '$0.2-1.0/Run (varies with duration & resolution)'\n        }\n\n        const duration = String(durationWidget.value)\n        const resolution = String(resolutionWidget.value)\n\n        if (duration.includes('5')) {\n          if (resolution.includes('1080p')) return '$0.45/Run'\n          if (resolution.includes('720p')) return '$0.2/Run'\n        } else if (duration.includes('10')) {\n          if (resolution.includes('1080p')) return '$1.0/Run'\n          if (resolution.includes('720p')) return '$0.6/Run'\n        }\n\n        return '$0.2/Run'\n      }\n    },\n    PikaScenesV2_2: {\n      displayPrice: (node: LGraphNode): string => {\n        const durationWidget = node.widgets?.find(\n          (w) => w.name === 'duration'\n        ) as IComboWidget\n        const resolutionWidget = node.widgets?.find(\n          (w) => w.name === 'resolution'\n        ) as IComboWidget\n\n        if (!durationWidget || !resolutionWidget) {\n          return '$0.2-1.0/Run (varies with duration & resolution)'\n        }\n\n        const duration = String(durationWidget.value)\n        const resolution = String(resolutionWidget.value)\n\n        if (duration.includes('5')) {\n          if (resolution.includes('720p')) return '$0.3/Run'\n          if (resolution.includes('1080p')) return '$0.5/Run'\n        } else if (duration.includes('10')) {\n          if (resolution.includes('720p')) return '$0.4/Run'\n          if (resolution.includes('1080p')) return '$1.5/Run'\n        }\n\n        return '$0.3/Run'\n      }\n    },\n    PikaStartEndFrameNode2_2: {\n      displayPrice: (node: LGraphNode): string => {\n        const durationWidget = node.widgets?.find(\n          (w) => w.name === 'duration'\n        ) as IComboWidget\n        const resolutionWidget = node.widgets?.find(\n          (w) => w.name === 'resolution'\n        ) as IComboWidget\n\n        if (!durationWidget || !resolutionWidget) {\n          return '$0.2-1.0/Run (varies with duration & resolution)'\n        }\n\n        const duration = String(durationWidget.value)\n        const resolution = String(resolutionWidget.value)\n\n        if (duration.includes('5')) {\n          if (resolution.includes('720p')) return '$0.2/Run'\n          if (resolution.includes('1080p')) return '$0.3/Run'\n        } else if (duration.includes('10')) {\n          if (resolution.includes('720p')) return '$0.25/Run'\n          if (resolution.includes('1080p')) return '$1.0/Run'\n        }\n\n        return '$0.2/Run'\n      }\n    },\n    PikaTextToVideoNode2_2: {\n      displayPrice: (node: LGraphNode): string => {\n        const durationWidget = node.widgets?.find(\n          (w) => w.name === 'duration'\n        ) as IComboWidget\n        const resolutionWidget = node.widgets?.find(\n          (w) => w.name === 'resolution'\n        ) as IComboWidget\n\n        if (!durationWidget || !resolutionWidget) {\n          return '$0.2-1.5/Run (varies with duration & resolution)'\n        }\n\n        const duration = String(durationWidget.value)\n        const resolution = String(resolutionWidget.value)\n\n        if (duration.includes('5')) {\n          if (resolution.includes('1080p')) return '$0.45/Run'\n          if (resolution.includes('720p')) return '$0.2/Run'\n        } else if (duration.includes('10')) {\n          if (resolution.includes('1080p')) return '$1.0/Run'\n          if (resolution.includes('720p')) return '$0.6/Run'\n        }\n\n        return '$0.45/Run'\n      }\n    },\n    Pikadditions: {\n      displayPrice: '$0.3/Run'\n    },\n    Pikaffects: {\n      displayPrice: '$0.45/Run'\n    },\n    Pikaswaps: {\n      displayPrice: '$0.3/Run'\n    },\n    PixverseImageToVideoNode: {\n      displayPrice: pixversePricingCalculator\n    },\n    PixverseTextToVideoNode: {\n      displayPrice: pixversePricingCalculator\n    },\n    PixverseTransitionVideoNode: {\n      displayPrice: pixversePricingCalculator\n    },\n    RecraftCreativeUpscaleNode: {\n      displayPrice: '$0.25/Run'\n    },\n    RecraftCrispUpscaleNode: {\n      displayPrice: '$0.004/Run'\n    },\n    RecraftGenerateColorFromImageNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const nWidget = node.widgets?.find(\n          (w) => w.name === 'n'\n        ) as IComboWidget\n        if (!nWidget) return '$0.04 x n/Run'\n\n        const n = Number(nWidget.value) || 1\n        const cost = (0.04 * n).toFixed(2)\n        return `$${cost}/Run`\n      }\n    },\n    RecraftGenerateImageNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const nWidget = node.widgets?.find(\n          (w) => w.name === 'n'\n        ) as IComboWidget\n        if (!nWidget) return '$0.04 x n/Run'\n\n        const n = Number(nWidget.value) || 1\n        const cost = (0.04 * n).toFixed(2)\n        return `$${cost}/Run`\n      }\n    },\n    RecraftGenerateVectorImageNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const nWidget = node.widgets?.find(\n          (w) => w.name === 'n'\n        ) as IComboWidget\n        if (!nWidget) return '$0.08 x n/Run'\n\n        const n = Number(nWidget.value) || 1\n        const cost = (0.08 * n).toFixed(2)\n        return `$${cost}/Run`\n      }\n    },\n    RecraftImageInpaintingNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const nWidget = node.widgets?.find(\n          (w) => w.name === 'n'\n        ) as IComboWidget\n        if (!nWidget) return '$0.04 x n/Run'\n\n        const n = Number(nWidget.value) || 1\n        const cost = (0.04 * n).toFixed(2)\n        return `$${cost}/Run`\n      }\n    },\n    RecraftImageToImageNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const nWidget = node.widgets?.find(\n          (w) => w.name === 'n'\n        ) as IComboWidget\n        if (!nWidget) return '$0.04 x n/Run'\n\n        const n = Number(nWidget.value) || 1\n        const cost = (0.04 * n).toFixed(2)\n        return `$${cost}/Run`\n      }\n    },\n    RecraftRemoveBackgroundNode: {\n      displayPrice: '$0.01/Run'\n    },\n    RecraftReplaceBackgroundNode: {\n      displayPrice: '$0.04/Run'\n    },\n    RecraftTextToImageNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const nWidget = node.widgets?.find(\n          (w) => w.name === 'n'\n        ) as IComboWidget\n        if (!nWidget) return '$0.04 x n/Run'\n\n        const n = Number(nWidget.value) || 1\n        const cost = (0.04 * n).toFixed(2)\n        return `$${cost}/Run`\n      }\n    },\n    RecraftTextToVectorNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const nWidget = node.widgets?.find(\n          (w) => w.name === 'n'\n        ) as IComboWidget\n        if (!nWidget) return '$0.08 x n/Run'\n\n        const n = Number(nWidget.value) || 1\n        const cost = (0.08 * n).toFixed(2)\n        return `$${cost}/Run`\n      }\n    },\n    RecraftVectorizeImageNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const nWidget = node.widgets?.find(\n          (w) => w.name === 'n'\n        ) as IComboWidget\n        if (!nWidget) return '$0.01 x n/Run'\n\n        const n = Number(nWidget.value) || 1\n        const cost = (0.01 * n).toFixed(2)\n        return `$${cost}/Run`\n      }\n    },\n    StabilityStableImageSD_3_5Node: {\n      displayPrice: (node: LGraphNode): string => {\n        const modelWidget = node.widgets?.find(\n          (w) => w.name === 'model'\n        ) as IComboWidget\n\n        if (!modelWidget) return '$0.035-0.065/Run (varies with model)'\n\n        const model = String(modelWidget.value).toLowerCase()\n        if (model.includes('large')) {\n          return '$0.065/Run'\n        } else if (model.includes('medium')) {\n          return '$0.035/Run'\n        }\n\n        return '$0.035/Run'\n      }\n    },\n    StabilityStableImageUltraNode: {\n      displayPrice: '$0.08/Run'\n    },\n    StabilityUpscaleConservativeNode: {\n      displayPrice: '$0.25/Run'\n    },\n    StabilityUpscaleCreativeNode: {\n      displayPrice: '$0.25/Run'\n    },\n    StabilityUpscaleFastNode: {\n      displayPrice: '$0.01/Run'\n    },\n    StabilityTextToAudio: {\n      displayPrice: '$0.20/Run'\n    },\n    StabilityAudioToAudio: {\n      displayPrice: '$0.20/Run'\n    },\n    StabilityAudioInpaint: {\n      displayPrice: '$0.20/Run'\n    },\n    VeoVideoGenerationNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const durationWidget = node.widgets?.find(\n          (w) => w.name === 'duration_seconds'\n        ) as IComboWidget\n\n        if (!durationWidget) return '$2.50-5.0/Run (varies with duration)'\n\n        const price = 0.5 * Number(durationWidget.value)\n        return `$${price.toFixed(2)}/Run`\n      }\n    },\n    Veo3VideoGenerationNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const modelWidget = node.widgets?.find(\n          (w) => w.name === 'model'\n        ) as IComboWidget\n        const generateAudioWidget = node.widgets?.find(\n          (w) => w.name === 'generate_audio'\n        ) as IComboWidget\n\n        if (!modelWidget || !generateAudioWidget) {\n          return '$0.80-3.20/Run (varies with model & audio generation)'\n        }\n\n        const model = String(modelWidget.value)\n        const generateAudio =\n          String(generateAudioWidget.value).toLowerCase() === 'true'\n\n        if (\n          model.includes('veo-3.0-fast-generate-001') ||\n          model.includes('veo-3.1-fast-generate')\n        ) {\n          return generateAudio ? '$1.20/Run' : '$0.80/Run'\n        } else if (\n          model.includes('veo-3.0-generate-001') ||\n          model.includes('veo-3.1-generate')\n        ) {\n          return generateAudio ? '$3.20/Run' : '$1.60/Run'\n        }\n\n        // Default fallback\n        return '$0.80-3.20/Run'\n      }\n    },\n    LumaImageNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const modelWidget = node.widgets?.find(\n          (w) => w.name === 'model'\n        ) as IComboWidget\n        const aspectRatioWidget = node.widgets?.find(\n          (w) => w.name === 'aspect_ratio'\n        ) as IComboWidget\n\n        if (!modelWidget || !aspectRatioWidget) {\n          return '$0.0045-0.0182/Run (varies with model & aspect ratio)'\n        }\n\n        const model = String(modelWidget.value)\n\n        if (model.includes('photon-flash-1')) {\n          return '$0.0019/Run'\n        } else if (model.includes('photon-1')) {\n          return '$0.0073/Run'\n        }\n\n        return '$0.0172/Run'\n      }\n    },\n    LumaImageModifyNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const modelWidget = node.widgets?.find(\n          (w) => w.name === 'model'\n        ) as IComboWidget\n\n        if (!modelWidget) {\n          return '$0.0019-0.0073/Run (varies with model)'\n        }\n\n        const model = String(modelWidget.value)\n\n        if (model.includes('photon-flash-1')) {\n          return '$0.0019/Run'\n        } else if (model.includes('photon-1')) {\n          return '$0.0073/Run'\n        }\n\n        return '$0.0172/Run'\n      }\n    },\n    MoonvalleyTxt2VideoNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const lengthWidget = node.widgets?.find(\n          (w) => w.name === 'length'\n        ) as IComboWidget\n\n        // If no length widget exists, default to 5s pricing\n        if (!lengthWidget) return '$1.50/Run'\n\n        const length = String(lengthWidget.value)\n        if (length === '5s') {\n          return '$1.50/Run'\n        } else if (length === '10s') {\n          return '$3.00/Run'\n        }\n\n        return '$1.50/Run'\n      }\n    },\n    MoonvalleyImg2VideoNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const lengthWidget = node.widgets?.find(\n          (w) => w.name === 'length'\n        ) as IComboWidget\n\n        // If no length widget exists, default to 5s pricing\n        if (!lengthWidget) return '$1.50/Run'\n\n        const length = String(lengthWidget.value)\n        if (length === '5s') {\n          return '$1.50/Run'\n        } else if (length === '10s') {\n          return '$3.00/Run'\n        }\n\n        return '$1.50/Run'\n      }\n    },\n    MoonvalleyVideo2VideoNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const lengthWidget = node.widgets?.find(\n          (w) => w.name === 'length'\n        ) as IComboWidget\n\n        // If no length widget exists, default to 5s pricing\n        if (!lengthWidget) return '$2.25/Run'\n\n        const length = String(lengthWidget.value)\n        if (length === '5s') {\n          return '$2.25/Run'\n        } else if (length === '10s') {\n          return '$4.00/Run'\n        }\n\n        return '$2.25/Run'\n      }\n    },\n    // Runway nodes - using actual node names from ComfyUI\n    RunwayTextToImageNode: {\n      displayPrice: '$0.08/Run'\n    },\n    RunwayImageToVideoNodeGen3a: {\n      displayPrice: calculateRunwayDurationPrice\n    },\n    RunwayImageToVideoNodeGen4: {\n      displayPrice: calculateRunwayDurationPrice\n    },\n    RunwayFirstLastFrameNode: {\n      displayPrice: calculateRunwayDurationPrice\n    },\n    // Rodin nodes - all have the same pricing structure\n    Rodin3D_Regular: {\n      displayPrice: '$0.4/Run'\n    },\n    Rodin3D_Detail: {\n      displayPrice: '$0.4/Run'\n    },\n    Rodin3D_Smooth: {\n      displayPrice: '$0.4/Run'\n    },\n    Rodin3D_Sketch: {\n      displayPrice: '$0.4/Run'\n    },\n    // Tripo nodes - using actual node names from ComfyUI\n    TripoTextToModelNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const quadWidget = node.widgets?.find(\n          (w) => w.name === 'quad'\n        ) as IComboWidget\n        const styleWidget = node.widgets?.find(\n          (w) => w.name === 'style'\n        ) as IComboWidget\n        const textureWidget = node.widgets?.find(\n          (w) => w.name === 'texture'\n        ) as IComboWidget\n        const textureQualityWidget = node.widgets?.find(\n          (w) => w.name === 'texture_quality'\n        ) as IComboWidget\n\n        if (!quadWidget || !styleWidget || !textureWidget)\n          return '$0.1-0.4/Run (varies with quad, style, texture & quality)'\n\n        const quad = String(quadWidget.value).toLowerCase() === 'true'\n        const style = String(styleWidget.value).toLowerCase()\n        const texture = String(textureWidget.value).toLowerCase() === 'true'\n        const textureQuality = String(\n          textureQualityWidget?.value || 'standard'\n        ).toLowerCase()\n\n        // Pricing logic based on CSV data\n        if (style.includes('none')) {\n          if (!quad) {\n            if (!texture) return '$0.10/Run'\n            else return '$0.15/Run'\n          } else {\n            if (textureQuality.includes('detailed')) {\n              if (!texture) return '$0.30/Run'\n              else return '$0.35/Run'\n            } else {\n              if (!texture) return '$0.20/Run'\n              else return '$0.25/Run'\n            }\n          }\n        } else {\n          // any style\n          if (!quad) {\n            if (!texture) return '$0.15/Run'\n            else return '$0.20/Run'\n          } else {\n            if (textureQuality.includes('detailed')) {\n              if (!texture) return '$0.35/Run'\n              else return '$0.40/Run'\n            } else {\n              if (!texture) return '$0.25/Run'\n              else return '$0.30/Run'\n            }\n          }\n        }\n      }\n    },\n    TripoImageToModelNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const quadWidget = node.widgets?.find(\n          (w) => w.name === 'quad'\n        ) as IComboWidget\n        const styleWidget = node.widgets?.find(\n          (w) => w.name === 'style'\n        ) as IComboWidget\n        const textureWidget = node.widgets?.find(\n          (w) => w.name === 'texture'\n        ) as IComboWidget\n        const textureQualityWidget = node.widgets?.find(\n          (w) => w.name === 'texture_quality'\n        ) as IComboWidget\n\n        if (!quadWidget || !styleWidget || !textureWidget)\n          return '$0.2-0.5/Run (varies with quad, style, texture & quality)'\n\n        const quad = String(quadWidget.value).toLowerCase() === 'true'\n        const style = String(styleWidget.value).toLowerCase()\n        const texture = String(textureWidget.value).toLowerCase() === 'true'\n        const textureQuality = String(\n          textureQualityWidget?.value || 'standard'\n        ).toLowerCase()\n\n        // Pricing logic based on CSV data for Image to Model\n        if (style.includes('none')) {\n          if (!quad) {\n            if (!texture) return '$0.20/Run'\n            else return '$0.25/Run'\n          } else {\n            if (textureQuality.includes('detailed')) {\n              if (!texture) return '$0.40/Run'\n              else return '$0.45/Run'\n            } else {\n              if (!texture) return '$0.30/Run'\n              else return '$0.35/Run'\n            }\n          }\n        } else {\n          // any style\n          if (!quad) {\n            if (!texture) return '$0.25/Run'\n            else return '$0.30/Run'\n          } else {\n            if (textureQuality.includes('detailed')) {\n              if (!texture) return '$0.45/Run'\n              else return '$0.50/Run'\n            } else {\n              if (!texture) return '$0.35/Run'\n              else return '$0.40/Run'\n            }\n          }\n        }\n      }\n    },\n    TripoRefineNode: {\n      displayPrice: '$0.3/Run'\n    },\n    TripoTextureNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const textureQualityWidget = node.widgets?.find(\n          (w) => w.name === 'texture_quality'\n        ) as IComboWidget\n\n        if (!textureQualityWidget) return '$0.1-0.2/Run (varies with quality)'\n\n        const textureQuality = String(textureQualityWidget.value)\n        return textureQuality.includes('detailed') ? '$0.2/Run' : '$0.1/Run'\n      }\n    },\n    TripoConvertModelNode: {\n      displayPrice: '$0.10/Run'\n    },\n    TripoRetargetRiggedModelNode: {\n      displayPrice: '$0.10/Run'\n    },\n    TripoMultiviewToModelNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const quadWidget = node.widgets?.find(\n          (w) => w.name === 'quad'\n        ) as IComboWidget\n        const styleWidget = node.widgets?.find(\n          (w) => w.name === 'style'\n        ) as IComboWidget\n        const textureWidget = node.widgets?.find(\n          (w) => w.name === 'texture'\n        ) as IComboWidget\n        const textureQualityWidget = node.widgets?.find(\n          (w) => w.name === 'texture_quality'\n        ) as IComboWidget\n\n        if (!quadWidget || !styleWidget || !textureWidget)\n          return '$0.2-0.5/Run (varies with quad, style, texture & quality)'\n\n        const quad = String(quadWidget.value).toLowerCase() === 'true'\n        const style = String(styleWidget.value).toLowerCase()\n        const texture = String(textureWidget.value).toLowerCase() === 'true'\n        const textureQuality = String(\n          textureQualityWidget?.value || 'standard'\n        ).toLowerCase()\n\n        // Pricing logic based on CSV data for Multiview to Model (same as Image to Model)\n        if (style.includes('none')) {\n          if (!quad) {\n            if (!texture) return '$0.20/Run'\n            else return '$0.25/Run'\n          } else {\n            if (textureQuality.includes('detailed')) {\n              if (!texture) return '$0.40/Run'\n              else return '$0.45/Run'\n            } else {\n              if (!texture) return '$0.30/Run'\n              else return '$0.35/Run'\n            }\n          }\n        } else {\n          // any style\n          if (!quad) {\n            if (!texture) return '$0.25/Run'\n            else return '$0.30/Run'\n          } else {\n            if (textureQuality.includes('detailed')) {\n              if (!texture) return '$0.45/Run'\n              else return '$0.50/Run'\n            } else {\n              if (!texture) return '$0.35/Run'\n              else return '$0.40/Run'\n            }\n          }\n        }\n      }\n    },\n    // Google/Gemini nodes\n    GeminiNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const modelWidget = node.widgets?.find(\n          (w) => w.name === 'model'\n        ) as IComboWidget\n\n        if (!modelWidget) return 'Token-based'\n\n        const model = String(modelWidget.value)\n\n        // Google Veo video generation\n        if (model.includes('veo-2.0')) {\n          return '$0.5/second'\n        } else if (model.includes('gemini-2.5-flash-preview-04-17')) {\n          return '$0.0003/$0.0025 per 1K tokens'\n        } else if (model.includes('gemini-2.5-flash')) {\n          return '$0.0003/$0.0025 per 1K tokens'\n        } else if (model.includes('gemini-2.5-pro-preview-05-06')) {\n          return '$0.00125/$0.01 per 1K tokens'\n        } else if (model.includes('gemini-2.5-pro')) {\n          return '$0.00125/$0.01 per 1K tokens'\n        }\n        // For other Gemini models, show token-based pricing info\n        return 'Token-based'\n      }\n    },\n    GeminiImageNode: {\n      displayPrice: '$0.03 per 1K tokens'\n    },\n    LLMNode: {\n      displayPrice: '$0.00005/$0.0004 per 1K tokens'\n    },\n    // OpenAI nodes\n    OpenAIChatNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const modelWidget = node.widgets?.find(\n          (w) => w.name === 'model'\n        ) as IComboWidget\n\n        if (!modelWidget) return 'Token-based'\n\n        const model = String(modelWidget.value)\n\n        // Specific pricing for exposed models based on official pricing data (converted to per 1K tokens)\n        if (model.includes('o4-mini')) {\n          return '$0.0011/$0.0044 per 1K tokens'\n        } else if (model.includes('o1-pro')) {\n          return '$0.15/$0.60 per 1K tokens'\n        } else if (model.includes('o1')) {\n          return '$0.015/$0.06 per 1K tokens'\n        } else if (model.includes('o3-mini')) {\n          return '$0.0011/$0.0044 per 1K tokens'\n        } else if (model.includes('o3')) {\n          return '$0.01/$0.04 per 1K tokens'\n        } else if (model.includes('gpt-4o')) {\n          return '$0.0025/$0.01 per 1K tokens'\n        } else if (model.includes('gpt-4.1-nano')) {\n          return '$0.0001/$0.0004 per 1K tokens'\n        } else if (model.includes('gpt-4.1-mini')) {\n          return '$0.0004/$0.0016 per 1K tokens'\n        } else if (model.includes('gpt-4.1')) {\n          return '$0.002/$0.008 per 1K tokens'\n        } else if (model.includes('gpt-5-nano')) {\n          return '$0.00005/$0.0004 per 1K tokens'\n        } else if (model.includes('gpt-5-mini')) {\n          return '$0.00025/$0.002 per 1K tokens'\n        } else if (model.includes('gpt-5')) {\n          return '$0.00125/$0.01 per 1K tokens'\n        }\n        return 'Token-based'\n      }\n    },\n    ViduTextToVideoNode: {\n      displayPrice: '$0.4/Run'\n    },\n    ViduImageToVideoNode: {\n      displayPrice: '$0.4/Run'\n    },\n    ViduReferenceVideoNode: {\n      displayPrice: '$0.4/Run'\n    },\n    ViduStartEndToVideoNode: {\n      displayPrice: '$0.4/Run'\n    },\n    ByteDanceImageNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const modelWidget = node.widgets?.find(\n          (w) => w.name === 'model'\n        ) as IComboWidget\n\n        if (!modelWidget) return 'Token-based'\n\n        const model = String(modelWidget.value)\n\n        if (model.includes('seedream-3-0-t2i')) {\n          return '$0.03/Run'\n        }\n        return 'Token-based'\n      }\n    },\n    ByteDanceImageEditNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const modelWidget = node.widgets?.find(\n          (w) => w.name === 'model'\n        ) as IComboWidget\n\n        if (!modelWidget) return 'Token-based'\n\n        const model = String(modelWidget.value)\n\n        if (model.includes('seededit-3-0-i2i')) {\n          return '$0.03/Run'\n        }\n        return 'Token-based'\n      }\n    },\n    ByteDanceSeedreamNode: {\n      displayPrice: (node: LGraphNode): string => {\n        const sequentialGenerationWidget = node.widgets?.find(\n          (w) => w.name === 'sequential_image_generation'\n        ) as IComboWidget\n        const maxImagesWidget = node.widgets?.find(\n          (w) => w.name === 'max_images'\n        ) as IComboWidget\n\n        if (!sequentialGenerationWidget || !maxImagesWidget)\n          return '$0.03/Run ($0.03 for one output image)'\n\n        if (\n          String(sequentialGenerationWidget.value).toLowerCase() === 'disabled'\n        ) {\n          return '$0.03/Run'\n        }\n\n        const maxImages = Number(maxImagesWidget.value)\n        if (maxImages === 1) {\n          return '$0.03/Run'\n        }\n        const cost = (0.03 * maxImages).toFixed(2)\n        return `$${cost}/Run ($0.03 for one output image)`\n      }\n    },\n    ByteDanceTextToVideoNode: {\n      displayPrice: byteDanceVideoPricingCalculator\n    },\n    ByteDanceImageToVideoNode: {\n      displayPrice: byteDanceVideoPricingCalculator\n    },\n    ByteDanceFirstLastFrameNode: {\n      displayPrice: byteDanceVideoPricingCalculator\n    },\n    ByteDanceImageReferenceNode: {\n      displayPrice: byteDanceVideoPricingCalculator\n    },\n    WanTextToVideoApi: {\n      displayPrice: (node: LGraphNode): string => {\n        const durationWidget = node.widgets?.find(\n          (w) => w.name === 'duration'\n        ) as IComboWidget\n        const resolutionWidget = node.widgets?.find(\n          (w) => w.name === 'size'\n        ) as IComboWidget\n\n        if (!durationWidget || !resolutionWidget) return '$0.05-0.15/second'\n\n        const seconds = parseFloat(String(durationWidget.value))\n        const resolutionStr = String(resolutionWidget.value).toLowerCase()\n\n        const resKey = resolutionStr.includes('1080')\n          ? '1080p'\n          : resolutionStr.includes('720')\n            ? '720p'\n            : resolutionStr.includes('480')\n              ? '480p'\n              : (resolutionStr.match(/^\\s*(\\d{3,4}p)/)?.[1] ?? '')\n\n        const pricePerSecond: Record<string, number> = {\n          '480p': 0.05,\n          '720p': 0.1,\n          '1080p': 0.15\n        }\n\n        const pps = pricePerSecond[resKey]\n        if (isNaN(seconds) || !pps) return '$0.05-0.15/second'\n\n        const cost = (pps * seconds).toFixed(2)\n        return `$${cost}/Run`\n      }\n    },\n    WanImageToVideoApi: {\n      displayPrice: (node: LGraphNode): string => {\n        const durationWidget = node.widgets?.find(\n          (w) => w.name === 'duration'\n        ) as IComboWidget\n        const resolutionWidget = node.widgets?.find(\n          (w) => w.name === 'resolution'\n        ) as IComboWidget\n\n        if (!durationWidget || !resolutionWidget) return '$0.05-0.15/second'\n\n        const seconds = parseFloat(String(durationWidget.value))\n        const resolution = String(resolutionWidget.value).trim().toLowerCase()\n\n        const pricePerSecond: Record<string, number> = {\n          '480p': 0.05,\n          '720p': 0.1,\n          '1080p': 0.15\n        }\n\n        const pps = pricePerSecond[resolution]\n        if (isNaN(seconds) || !pps) return '$0.05-0.15/second'\n\n        const cost = (pps * seconds).toFixed(2)\n        return `$${cost}/Run`\n      }\n    },\n    WanTextToImageApi: {\n      displayPrice: '$0.03/Run'\n    },\n    WanImageToImageApi: {\n      displayPrice: '$0.03/Run'\n    },\n    LtxvApiTextToVideo: {\n      displayPrice: ltxvPricingCalculator\n    },\n    LtxvApiImageToVideo: {\n      displayPrice: ltxvPricingCalculator\n    }\n  }\n\n/**\n * Composable to get node pricing information for API nodes\n */\nexport const useNodePricing = () => {\n  /**\n   * Get the price display for a node\n   */\n  const getNodeDisplayPrice = (node: LGraphNode): string => {\n    if (!node.constructor?.nodeData?.api_node) return ''\n\n    const nodeName = node.constructor.nodeData.name\n    const priceConfig = apiNodeCosts[nodeName]\n\n    if (!priceConfig) return ''\n\n    // If it's a function, call it with the node to get dynamic pricing\n    if (typeof priceConfig.displayPrice === 'function') {\n      return safePricingExecution(priceConfig.displayPrice, node, '')\n    }\n\n    // Otherwise return the static price\n    return priceConfig.displayPrice\n  }\n\n  const getNodePricingConfig = (node: LGraphNode) =>\n    apiNodeCosts[node.constructor.nodeData?.name ?? '']\n\n  const getRelevantWidgetNames = (nodeType: string): string[] => {\n    const widgetMap: Record<string, string[]> = {\n      KlingTextToVideoNode: ['mode', 'model_name', 'duration'],\n      KlingImage2VideoNode: ['mode', 'model_name', 'duration'],\n      KlingImageGenerationNode: ['modality', 'model_name', 'n'],\n      KlingDualCharacterVideoEffectNode: ['mode', 'model_name', 'duration'],\n      KlingSingleImageVideoEffectNode: ['effect_scene'],\n      KlingStartEndFrameNode: ['mode', 'model_name', 'duration'],\n      MinimaxHailuoVideoNode: ['resolution', 'duration'],\n      OpenAIDalle3: ['size', 'quality'],\n      OpenAIDalle2: ['size', 'n'],\n      OpenAIVideoSora2: ['model', 'size', 'duration'],\n      OpenAIGPTImage1: ['quality', 'n'],\n      IdeogramV1: ['num_images', 'turbo'],\n      IdeogramV2: ['num_images', 'turbo'],\n      IdeogramV3: ['rendering_speed', 'num_images', 'character_image'],\n      FluxProKontextProNode: [],\n      FluxProKontextMaxNode: [],\n      VeoVideoGenerationNode: ['duration_seconds'],\n      Veo3VideoGenerationNode: ['model', 'generate_audio'],\n      LumaVideoNode: ['model', 'resolution', 'duration'],\n      LumaImageToVideoNode: ['model', 'resolution', 'duration'],\n      LumaImageNode: ['model', 'aspect_ratio'],\n      LumaImageModifyNode: ['model', 'aspect_ratio'],\n      PikaTextToVideoNode2_2: ['duration', 'resolution'],\n      PikaImageToVideoNode2_2: ['duration', 'resolution'],\n      PikaScenesV2_2: ['duration', 'resolution'],\n      PikaStartEndFrameNode2_2: ['duration', 'resolution'],\n      PixverseTextToVideoNode: ['duration_seconds', 'quality', 'motion_mode'],\n      PixverseTransitionVideoNode: [\n        'duration_seconds',\n        'motion_mode',\n        'quality'\n      ],\n      PixverseImageToVideoNode: ['duration_seconds', 'quality', 'motion_mode'],\n      StabilityStableImageSD_3_5Node: ['model'],\n      RecraftTextToImageNode: ['n'],\n      RecraftImageToImageNode: ['n'],\n      RecraftImageInpaintingNode: ['n'],\n      RecraftTextToVectorNode: ['n'],\n      RecraftVectorizeImageNode: ['n'],\n      RecraftGenerateColorFromImageNode: ['n'],\n      RecraftGenerateImageNode: ['n'],\n      RecraftGenerateVectorImageNode: ['n'],\n      MoonvalleyTxt2VideoNode: ['length'],\n      MoonvalleyImg2VideoNode: ['length'],\n      MoonvalleyVideo2VideoNode: ['length'],\n      // Runway nodes\n      RunwayImageToVideoNodeGen3a: ['duration'],\n      RunwayImageToVideoNodeGen4: ['duration'],\n      RunwayFirstLastFrameNode: ['duration'],\n      // Tripo nodes\n      TripoTextToModelNode: ['quad', 'style', 'texture', 'texture_quality'],\n      TripoImageToModelNode: ['quad', 'style', 'texture', 'texture_quality'],\n      TripoTextureNode: ['texture_quality'],\n      // Google/Gemini nodes\n      GeminiNode: ['model'],\n      // OpenAI nodes\n      OpenAIChatNode: ['model'],\n      // ByteDance\n      ByteDanceImageNode: ['model'],\n      ByteDanceImageEditNode: ['model'],\n      ByteDanceSeedreamNode: [\n        'model',\n        'sequential_image_generation',\n        'max_images'\n      ],\n      ByteDanceTextToVideoNode: ['model', 'duration', 'resolution'],\n      ByteDanceImageToVideoNode: ['model', 'duration', 'resolution'],\n      ByteDanceFirstLastFrameNode: ['model', 'duration', 'resolution'],\n      ByteDanceImageReferenceNode: ['model', 'duration', 'resolution'],\n      WanTextToVideoApi: ['duration', 'size'],\n      WanImageToVideoApi: ['duration', 'resolution'],\n      LtxvApiTextToVideo: ['model', 'duration', 'resolution'],\n      LtxvApiImageToVideo: ['model', 'duration', 'resolution']\n    }\n    return widgetMap[nodeType] || []\n  }\n\n  return {\n    getNodeDisplayPrice,\n    getNodePricingConfig,\n    getRelevantWidgetNames\n  }\n}\n","import type { LGraph, LGraphNode } from '@/lib/litegraph/src/litegraph'\nimport { LGraphBadge } from '@/lib/litegraph/src/litegraph'\n\nimport { useColorPaletteStore } from '@/stores/workspace/colorPaletteStore'\nimport { adjustColor } from '@/utils/colorUtil'\n\nexport const usePriceBadge = () => {\n  function updateSubgraphCredits(node: LGraphNode) {\n    if (!node.isSubgraphNode()) return\n    node.badges = node.badges.filter((b) => !isCreditsBadge(b))\n    const newBadges = collectCreditsBadges(node.subgraph)\n    if (newBadges.length > 1) {\n      node.badges.push(getCreditsBadge('Partner Nodes x ' + newBadges.length))\n    } else {\n      node.badges.push(...newBadges)\n    }\n  }\n  function collectCreditsBadges(\n    graph: LGraph,\n    visited: Set<string> = new Set()\n  ): (LGraphBadge | (() => LGraphBadge))[] {\n    if (visited.has(graph.id)) return []\n    visited.add(graph.id)\n    const badges = []\n    for (const node of graph.nodes) {\n      badges.push(\n        ...(node.isSubgraphNode()\n          ? collectCreditsBadges(node.subgraph, visited)\n          : node.badges.filter((b) => isCreditsBadge(b)))\n      )\n    }\n    return badges\n  }\n\n  function isCreditsBadge(badge: LGraphBadge | (() => LGraphBadge)): boolean {\n    return (\n      (typeof badge === 'function' ? badge() : badge).icon?.unicode === '\\ue96b'\n    )\n  }\n\n  const colorPaletteStore = useColorPaletteStore()\n  function getCreditsBadge(price: string): LGraphBadge {\n    const isLightTheme = colorPaletteStore.completedActivePalette.light_theme\n    return new LGraphBadge({\n      text: price,\n      iconOptions: {\n        unicode: '\\ue96b',\n        fontFamily: 'PrimeIcons',\n        color: isLightTheme\n          ? adjustColor('#FABC25', { lightness: 0.5 })\n          : '#FABC25',\n        bgColor: isLightTheme\n          ? adjustColor('#654020', { lightness: 0.5 })\n          : '#654020',\n        fontSize: 8\n      },\n      fgColor:\n        colorPaletteStore.completedActivePalette.colors.litegraph_base\n          .BADGE_FG_COLOR,\n      bgColor: isLightTheme\n        ? adjustColor('#8D6932', { lightness: 0.5 })\n        : '#8D6932'\n    })\n  }\n  return {\n    getCreditsBadge,\n    updateSubgraphCredits\n  }\n}\n","import { computedWithControl } from '@vueuse/core'\nimport { ref } from 'vue'\nimport type { ComputedRef } from 'vue'\n\nimport { useChainCallback } from '@/composables/functional/useChainCallback'\nimport type { LGraphNode } from '@/lib/litegraph/src/litegraph'\n\ninterface UseComputedWithWidgetWatchOptions {\n  /**\n   * Names of widgets to observe for changes.\n   * If not provided, all widgets will be observed.\n   */\n  widgetNames?: string[]\n\n  /**\n   * Whether to trigger a canvas redraw when widget values change.\n   * @default false\n   */\n  triggerCanvasRedraw?: boolean\n}\n\n/**\n * A composable that creates a computed that has a node's widget values as a dependencies.\n * Essentially `computedWithControl` (https://vueuse.org/shared/computedWithControl/) where\n * the explicitly defined extra dependencies are LGraphNode widgets.\n *\n * @param node - The LGraphNode whose widget values are to be watched\n * @param options - Configuration options for the watcher\n * @returns A function to create computed that responds to widget changes\n *\n * @example\n * ```ts\n * const computedWithWidgetWatch = useComputedWithWidgetWatch(node, {\n *   widgetNames: ['width', 'height'],\n *   triggerCanvasRedraw: true\n * })\n *\n * const dynamicPrice = computedWithWidgetWatch(() => {\n *   return calculatePrice(node)\n * })\n * ```\n */\nexport const useComputedWithWidgetWatch = (\n  node: LGraphNode,\n  options: UseComputedWithWidgetWatchOptions = {}\n) => {\n  const { widgetNames, triggerCanvasRedraw = false } = options\n\n  // Create a reactive trigger based on widget values\n  const widgetValues = ref<Record<string, any>>({})\n\n  // Initialize widget observers\n  if (node.widgets) {\n    const widgetsToObserve = widgetNames\n      ? node.widgets.filter((widget) => widgetNames.includes(widget.name))\n      : node.widgets\n\n    // Initialize current values\n    const currentValues: Record<string, any> = {}\n    widgetsToObserve.forEach((widget) => {\n      currentValues[widget.name] = widget.value\n    })\n    widgetValues.value = currentValues\n\n    widgetsToObserve.forEach((widget) => {\n      widget.callback = useChainCallback(widget.callback, () => {\n        // Update the reactive widget values\n        widgetValues.value = {\n          ...widgetValues.value,\n          [widget.name]: widget.value\n        }\n\n        // Optionally trigger a canvas redraw\n        if (triggerCanvasRedraw) {\n          node.graph?.setDirtyCanvas(true, true)\n        }\n      })\n    })\n    if (widgetNames && widgetNames.length > widgetsToObserve.length) {\n      //Inputs have been included\n      const indexesToObserve = widgetNames\n        .map((name) =>\n          widgetsToObserve.some((w) => w.name == name)\n            ? -1\n            : node.inputs.findIndex((i) => i.name == name)\n        )\n        .filter((i) => i >= 0)\n      node.onConnectionsChange = useChainCallback(\n        node.onConnectionsChange,\n        (_type: unknown, index: number, isConnected: boolean) => {\n          if (!indexesToObserve.includes(index)) return\n          widgetValues.value = {\n            ...widgetValues.value,\n            [indexesToObserve[index]]: isConnected\n          }\n          if (triggerCanvasRedraw) {\n            node.graph?.setDirtyCanvas(true, true)\n          }\n        }\n      )\n    }\n  }\n\n  // Returns a function that creates a computed that responds to widget changes.\n  // The computed will be re-evaluated whenever any observed widget changes.\n  return <T>(computeFn: () => T): ComputedRef<T> => {\n    return computedWithControl(widgetValues, computeFn)\n  }\n}\n","import _ from 'es-toolkit/compat'\nimport { computed, onMounted, watch } from 'vue'\n\nimport { useNodePricing } from '@/composables/node/useNodePricing'\nimport { usePriceBadge } from '@/composables/node/usePriceBadge'\nimport { useComputedWithWidgetWatch } from '@/composables/node/useWatchWidget'\nimport { BadgePosition, LGraphBadge } from '@/lib/litegraph/src/litegraph'\nimport type { LGraphNode } from '@/lib/litegraph/src/litegraph'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { app } from '@/scripts/app'\nimport { useExtensionStore } from '@/stores/extensionStore'\nimport type { ComfyNodeDefImpl } from '@/stores/nodeDefStore'\nimport { useNodeDefStore } from '@/stores/nodeDefStore'\nimport { useColorPaletteStore } from '@/stores/workspace/colorPaletteStore'\nimport { NodeBadgeMode } from '@/types/nodeSource'\n\n/**\n * Add LGraphBadge to LGraphNode based on settings.\n *\n * Following badges are added:\n * - Node ID badge\n * - Node source badge\n * - Node life cycle badge\n * - API node credits badge\n */\nexport const useNodeBadge = () => {\n  const settingStore = useSettingStore()\n  const extensionStore = useExtensionStore()\n  const colorPaletteStore = useColorPaletteStore()\n  const priceBadge = usePriceBadge()\n\n  const nodeSourceBadgeMode = computed(\n    () =>\n      settingStore.get('Comfy.NodeBadge.NodeSourceBadgeMode') as NodeBadgeMode\n  )\n  const nodeIdBadgeMode = computed(\n    () => settingStore.get('Comfy.NodeBadge.NodeIdBadgeMode') as NodeBadgeMode\n  )\n  const nodeLifeCycleBadgeMode = computed(\n    () =>\n      settingStore.get(\n        'Comfy.NodeBadge.NodeLifeCycleBadgeMode'\n      ) as NodeBadgeMode\n  )\n\n  const showApiPricingBadge = computed(() =>\n    settingStore.get('Comfy.NodeBadge.ShowApiPricing')\n  )\n\n  watch(\n    [\n      nodeSourceBadgeMode,\n      nodeIdBadgeMode,\n      nodeLifeCycleBadgeMode,\n      showApiPricingBadge\n    ],\n    () => {\n      app.graph?.setDirtyCanvas(true, true)\n    }\n  )\n\n  const nodeDefStore = useNodeDefStore()\n  function badgeTextVisible(\n    nodeDef: ComfyNodeDefImpl | null,\n    badgeMode: NodeBadgeMode\n  ): boolean {\n    return !(\n      badgeMode === NodeBadgeMode.None ||\n      (nodeDef?.isCoreNode && badgeMode === NodeBadgeMode.HideBuiltIn)\n    )\n  }\n\n  onMounted(() => {\n    const nodePricing = useNodePricing()\n\n    extensionStore.registerExtension({\n      name: 'Comfy.NodeBadge',\n      nodeCreated(node: LGraphNode) {\n        node.badgePosition = BadgePosition.TopRight\n\n        const badge = computed(() => {\n          const nodeDef = nodeDefStore.fromLGraphNode(node)\n          return new LGraphBadge({\n            text: _.truncate(\n              [\n                badgeTextVisible(nodeDef, nodeIdBadgeMode.value)\n                  ? `#${node.id}`\n                  : '',\n                badgeTextVisible(nodeDef, nodeLifeCycleBadgeMode.value)\n                  ? (nodeDef?.nodeLifeCycleBadgeText ?? '')\n                  : '',\n                badgeTextVisible(nodeDef, nodeSourceBadgeMode.value)\n                  ? (nodeDef?.nodeSource?.badgeText ?? '')\n                  : ''\n              ]\n                .filter((s) => s.length > 0)\n                .join(' '),\n              {\n                length: 31\n              }\n            ),\n            fgColor:\n              colorPaletteStore.completedActivePalette.colors.litegraph_base\n                .BADGE_FG_COLOR,\n            bgColor:\n              colorPaletteStore.completedActivePalette.colors.litegraph_base\n                .BADGE_BG_COLOR\n          })\n        })\n\n        node.badges.push(() => badge.value)\n\n        if (node.constructor.nodeData?.api_node && showApiPricingBadge.value) {\n          // Get the pricing function to determine if this node has dynamic pricing\n          const pricingConfig = nodePricing.getNodePricingConfig(node)\n          const hasDynamicPricing =\n            typeof pricingConfig?.displayPrice === 'function'\n\n          let creditsBadge\n          const createBadge = () => {\n            const price = nodePricing.getNodeDisplayPrice(node)\n            return priceBadge.getCreditsBadge(price)\n          }\n\n          if (hasDynamicPricing) {\n            // For dynamic pricing nodes, use computed that watches widget changes\n            const relevantWidgetNames = nodePricing.getRelevantWidgetNames(\n              node.constructor.nodeData?.name\n            )\n\n            const computedWithWidgetWatch = useComputedWithWidgetWatch(node, {\n              widgetNames: relevantWidgetNames,\n              triggerCanvasRedraw: true\n            })\n\n            creditsBadge = computedWithWidgetWatch(createBadge)\n          } else {\n            // For static pricing nodes, use regular computed\n            creditsBadge = computed(createBadge)\n          }\n\n          node.badges.push(() => creditsBadge.value)\n        }\n      },\n      init() {\n        app.canvas.canvas.addEventListener<'litegraph:set-graph'>(\n          'litegraph:set-graph',\n          () => {\n            for (const node of app.canvas.graph?.nodes ?? [])\n              priceBadge.updateSubgraphCredits(node)\n          }\n        )\n        app.canvas.canvas.addEventListener<'subgraph-converted'>(\n          'subgraph-converted',\n          (e) => priceBadge.updateSubgraphCredits(e.detail.subgraphNode)\n        )\n      },\n      afterConfigureGraph() {\n        for (const node of app.canvas.graph?.nodes ?? [])\n          priceBadge.updateSubgraphCredits(node)\n      }\n    })\n  })\n}\n","import type { Ref } from 'vue'\n\nimport { useSharedCanvasPositionConversion } from '@/composables/element/useCanvasPositionConversion'\nimport { usePragmaticDroppable } from '@/composables/usePragmaticDragAndDrop'\nimport type { LGraphNode } from '@/lib/litegraph/src/litegraph'\nimport { LiteGraph } from '@/lib/litegraph/src/litegraph'\nimport { useWorkflowService } from '@/platform/workflow/core/services/workflowService'\nimport { ComfyWorkflow } from '@/platform/workflow/management/stores/workflowStore'\nimport { app as comfyApp } from '@/scripts/app'\nimport { useLitegraphService } from '@/services/litegraphService'\nimport { ComfyModelDef } from '@/stores/modelStore'\nimport type { ModelNodeProvider } from '@/stores/modelToNodeStore'\nimport { useModelToNodeStore } from '@/stores/modelToNodeStore'\nimport { ComfyNodeDefImpl } from '@/stores/nodeDefStore'\nimport type { RenderedTreeExplorerNode } from '@/types/treeExplorerTypes'\n\nexport const useCanvasDrop = (canvasRef: Ref<HTMLCanvasElement | null>) => {\n  const modelToNodeStore = useModelToNodeStore()\n  const litegraphService = useLitegraphService()\n  const workflowService = useWorkflowService()\n\n  usePragmaticDroppable(() => canvasRef.value, {\n    getDropEffect: (args): Exclude<DataTransfer['dropEffect'], 'none'> =>\n      args.source.data.type === 'tree-explorer-node' ? 'copy' : 'move',\n    onDrop: async (event) => {\n      const loc = event.location.current.input\n      const dndData = event.source.data\n\n      if (dndData.type === 'tree-explorer-node') {\n        const node = dndData.data as RenderedTreeExplorerNode\n        const conv = useSharedCanvasPositionConversion()\n        const basePos = conv.clientPosToCanvasPos([loc.clientX, loc.clientY])\n\n        if (node.data instanceof ComfyNodeDefImpl) {\n          const nodeDef = node.data\n          const pos = [...basePos]\n          // Add an offset on y to make sure after adding the node, the cursor\n          // is on the node (top left corner)\n          pos[1] += LiteGraph.NODE_TITLE_HEIGHT\n          litegraphService.addNodeOnGraph(nodeDef, { pos })\n        } else if (node.data instanceof ComfyModelDef) {\n          const model = node.data\n          const pos = basePos\n          const nodeAtPos = comfyApp.graph.getNodeOnPos(pos[0], pos[1])\n          let targetProvider: ModelNodeProvider | null = null\n          let targetGraphNode: LGraphNode | null = null\n          if (nodeAtPos) {\n            const providers = modelToNodeStore.getAllNodeProviders(\n              model.directory\n            )\n            for (const provider of providers) {\n              if (provider.nodeDef.name === nodeAtPos.comfyClass) {\n                targetGraphNode = nodeAtPos\n                targetProvider = provider\n              }\n            }\n          }\n          if (!targetGraphNode) {\n            const provider = modelToNodeStore.getNodeProvider(model.directory)\n            if (provider) {\n              targetGraphNode = litegraphService.addNodeOnGraph(\n                provider.nodeDef,\n                {\n                  pos\n                }\n              )\n              targetProvider = provider\n            }\n          }\n          if (targetGraphNode) {\n            const widget = targetGraphNode.widgets?.find(\n              (widget) => widget.name === targetProvider?.key\n            )\n            if (widget) {\n              widget.value = model.file_name\n            }\n          }\n        } else if (node.data instanceof ComfyWorkflow) {\n          const workflow = node.data\n          await workflowService.insertWorkflow(workflow, { position: basePos })\n        }\n      }\n    }\n  })\n}\n","import { st, te } from '@/i18n'\nimport { legacyMenuCompat } from '@/lib/litegraph/src/contextMenuCompat'\nimport type {\n  IContextMenuOptions,\n  IContextMenuValue,\n  INodeInputSlot,\n  IWidget\n} from '@/lib/litegraph/src/litegraph'\nimport { LGraphCanvas, LiteGraph } from '@/lib/litegraph/src/litegraph'\nimport { app } from '@/scripts/app'\nimport { normalizeI18nKey } from '@/utils/formatUtil'\n\n/**\n * Add translation for litegraph context menu.\n */\nexport const useContextMenuTranslation = () => {\n  // Install compatibility layer BEFORE any extensions load\n  legacyMenuCompat.install(LGraphCanvas.prototype, 'getCanvasMenuOptions')\n\n  const { getCanvasMenuOptions } = LGraphCanvas.prototype\n  const getCanvasCenterMenuOptions = function (\n    this: LGraphCanvas,\n    ...args: Parameters<typeof getCanvasMenuOptions>\n  ) {\n    const res: IContextMenuValue[] = getCanvasMenuOptions.apply(this, args)\n\n    // Add items from new extension API\n    const newApiItems = app.collectCanvasMenuItems(this)\n    for (const item of newApiItems) {\n      res.push(item)\n    }\n\n    // Add legacy monkey-patched items\n    const legacyItems = legacyMenuCompat.extractLegacyItems(\n      'getCanvasMenuOptions',\n      this,\n      ...args\n    )\n    for (const item of legacyItems) {\n      res.push(item)\n    }\n\n    // Translate all items\n    for (const item of res) {\n      if (item?.content) {\n        item.content = st(`contextMenu.${item.content}`, item.content)\n      }\n    }\n    return res\n  }\n\n  LGraphCanvas.prototype.getCanvasMenuOptions = getCanvasCenterMenuOptions\n\n  legacyMenuCompat.registerWrapper(\n    'getCanvasMenuOptions',\n    getCanvasCenterMenuOptions,\n    getCanvasMenuOptions,\n    LGraphCanvas.prototype\n  )\n\n  // Wrap getNodeMenuOptions to add new API items\n  const nodeMenuFn = LGraphCanvas.prototype.getNodeMenuOptions\n  const getNodeMenuOptionsWithExtensions = function (\n    this: LGraphCanvas,\n    ...args: Parameters<typeof nodeMenuFn>\n  ) {\n    const res = nodeMenuFn.apply(this, args)\n\n    // Add items from new extension API\n    const node = args[0]\n    const newApiItems = app.collectNodeMenuItems(node)\n    for (const item of newApiItems) {\n      res.push(item)\n    }\n\n    return res\n  }\n\n  LGraphCanvas.prototype.getNodeMenuOptions = getNodeMenuOptionsWithExtensions\n\n  function translateMenus(\n    values: readonly (IContextMenuValue | string | null)[] | undefined,\n    options: IContextMenuOptions\n  ) {\n    if (!values) return\n    const reInput = /Convert (.*) to input/\n    const reWidget = /Convert (.*) to widget/\n    const cvt = st('contextMenu.Convert ', 'Convert ')\n    const tinp = st('contextMenu. to input', ' to input')\n    const twgt = st('contextMenu. to widget', ' to widget')\n    for (const value of values) {\n      if (typeof value === 'string') continue\n\n      translateMenus(value?.submenu?.options, options)\n      if (!value?.content) {\n        continue\n      }\n      if (te(`contextMenu.${value.content}`)) {\n        value.content = st(`contextMenu.${value.content}`, value.content)\n      }\n\n      // for capture translation text of input and widget\n      const extraInfo: any = options.extra || options.parentMenu?.options?.extra\n      // widgets and inputs\n      const matchInput = value.content?.match(reInput)\n      if (matchInput) {\n        let match = matchInput[1]\n        extraInfo?.inputs?.find((i: INodeInputSlot) => {\n          if (i.name != match) return false\n          match = i.label ? i.label : i.name\n        })\n        extraInfo?.widgets?.find((i: IWidget) => {\n          if (i.name != match) return false\n          match = i.label ? i.label : i.name\n        })\n        value.content = cvt + match + tinp\n        continue\n      }\n      const matchWidget = value.content?.match(reWidget)\n      if (matchWidget) {\n        let match = matchWidget[1]\n        extraInfo?.inputs?.find((i: INodeInputSlot) => {\n          if (i.name != match) return false\n          match = i.label ? i.label : i.name\n        })\n        extraInfo?.widgets?.find((i: IWidget) => {\n          if (i.name != match) return false\n          match = i.label ? i.label : i.name\n        })\n        value.content = cvt + match + twgt\n        continue\n      }\n    }\n  }\n\n  const OriginalContextMenu = LiteGraph.ContextMenu\n  function ContextMenu(\n    values: (IContextMenuValue | string)[],\n    options: IContextMenuOptions\n  ) {\n    if (options.title) {\n      options.title = st(\n        `nodeDefs.${normalizeI18nKey(options.title)}.display_name`,\n        options.title\n      )\n    }\n    translateMenus(values, options)\n    const ctx = new OriginalContextMenu(values, options)\n    return ctx\n  }\n\n  LiteGraph.ContextMenu = ContextMenu as unknown as typeof LiteGraph.ContextMenu\n  LiteGraph.ContextMenu.prototype = OriginalContextMenu.prototype\n}\n","/**\n * Utility functions for handling workbench events\n */\n\n/**\n * Used by clipboard handlers to determine if copy/paste events should be\n * intercepted for graph operations vs. allowing default browser behavior\n * for text inputs and other UI elements.\n *\n * @param target - The event target to check\n * @returns true if copy paste events will be handled by target\n */\nexport function shouldIgnoreCopyPaste(target: EventTarget | null): boolean {\n  return (\n    target instanceof HTMLTextAreaElement ||\n    (target instanceof HTMLInputElement &&\n      ![\n        'button',\n        'checkbox',\n        'file',\n        'hidden',\n        'image',\n        'radio',\n        'range',\n        'reset',\n        'search',\n        'submit'\n      ].includes(target.type))\n  )\n}\n","import { useEventListener } from '@vueuse/core'\n\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { shouldIgnoreCopyPaste } from '@/workbench/eventHelpers'\n\nconst clipboardHTMLWrapper = [\n  '<meta charset=\"utf-8\"><div><span data-metadata=\"',\n  '\"></span></div><span style=\"white-space:pre-wrap;\">Text</span>'\n]\n\n/**\n * Adds a handler on copy that serializes selected nodes to JSON\n */\nexport const useCopy = () => {\n  const canvasStore = useCanvasStore()\n\n  useEventListener(document, 'copy', (e) => {\n    if (shouldIgnoreCopyPaste(e.target)) {\n      // Default system copy\n      return\n    }\n    // copy nodes and clear clipboard\n    const canvas = canvasStore.canvas\n    if (canvas?.selectedItems) {\n      const serializedData = canvas.copyToClipboard()\n      // clearData doesn't remove images from clipboard\n      e.clipboardData?.setData(\n        'text/html',\n        clipboardHTMLWrapper.join(btoa(serializedData))\n      )\n      e.preventDefault()\n      e.stopImmediatePropagation()\n      return false\n    }\n  })\n}\n","import {\n  ContextMenu,\n  DragAndScale,\n  LGraph,\n  LGraphBadge,\n  LGraphCanvas,\n  LGraphGroup,\n  LGraphNode,\n  LLink,\n  LiteGraph\n} from '@/lib/litegraph/src/litegraph'\n\n/**\n * Assign all properties of LiteGraph to window to make it backward compatible.\n */\nexport const useGlobalLitegraph = () => {\n  // @ts-expect-error fixme ts strict error\n  window['LiteGraph'] = LiteGraph\n  // @ts-expect-error fixme ts strict error\n  window['LGraph'] = LGraph\n  // @ts-expect-error fixme ts strict error\n  window['LLink'] = LLink\n  // @ts-expect-error fixme ts strict error\n  window['LGraphNode'] = LGraphNode\n  // @ts-expect-error fixme ts strict error\n  window['LGraphGroup'] = LGraphGroup\n  // @ts-expect-error fixme ts strict error\n  window['DragAndScale'] = DragAndScale\n  // @ts-expect-error fixme ts strict error\n  window['LGraphCanvas'] = LGraphCanvas\n  // @ts-expect-error fixme ts strict error\n  window['ContextMenu'] = ContextMenu\n  // @ts-expect-error fixme ts strict error\n  window['LGraphBadge'] = LGraphBadge\n}\n","import { useEventListener } from '@vueuse/core'\n\nimport { LiteGraph } from '@/lib/litegraph/src/litegraph'\nimport type { LGraphNode } from '@/lib/litegraph/src/litegraph'\nimport type { ComfyWorkflowJSON } from '@/platform/workflow/validation/schemas/workflowSchema'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { app } from '@/scripts/app'\nimport { useWorkspaceStore } from '@/stores/workspaceStore'\nimport { isAudioNode, isImageNode, isVideoNode } from '@/utils/litegraphUtil'\nimport { shouldIgnoreCopyPaste } from '@/workbench/eventHelpers'\n\nfunction pasteClipboardItems(data: DataTransfer): boolean {\n  const rawData = data.getData('text/html')\n  const match = rawData.match(/data-metadata=\"([A-Za-z0-9+/=]+)\"/)?.[1]\n  if (!match) return false\n  try {\n    useCanvasStore()\n      .getCanvas()\n      ._deserializeItems(JSON.parse(atob(match)), {})\n    return true\n  } catch (err) {\n    console.error(err)\n  }\n  return false\n}\n\n/**\n * Adds a handler on paste that extracts and loads images or workflows from pasted JSON data\n */\nexport const usePaste = () => {\n  const workspaceStore = useWorkspaceStore()\n  const canvasStore = useCanvasStore()\n\n  const pasteItemsOnNode = (\n    items: DataTransferItemList,\n    node: LGraphNode | null,\n    contentType: string\n  ) => {\n    if (!node) return\n\n    const filteredItems = Array.from(items).filter((item) =>\n      item.type.startsWith(contentType)\n    )\n\n    const blob = filteredItems[0]?.getAsFile()\n    if (!blob) return\n\n    node.pasteFile?.(blob)\n    node.pasteFiles?.(\n      Array.from(filteredItems)\n        .map((i) => i.getAsFile())\n        .filter((f) => f !== null)\n    )\n  }\n\n  useEventListener(document, 'paste', async (e) => {\n    if (shouldIgnoreCopyPaste(e.target)) {\n      // Default system copy\n      return\n    }\n    // ctrl+shift+v is used to paste nodes with connections\n    // this is handled by litegraph\n    if (workspaceStore.shiftDown) return\n\n    const { canvas } = canvasStore\n    if (!canvas) return\n\n    const { graph } = canvas\n    let data: DataTransfer | string | null = e.clipboardData\n    if (!data) throw new Error('No clipboard data on clipboard event')\n\n    const { items } = data\n\n    const currentNode = canvas.current_node as LGraphNode\n    const isNodeSelected = currentNode?.is_selected\n\n    const isImageNodeSelected = isNodeSelected && isImageNode(currentNode)\n    const isVideoNodeSelected = isNodeSelected && isVideoNode(currentNode)\n    const isAudioNodeSelected = isNodeSelected && isAudioNode(currentNode)\n\n    let imageNode: LGraphNode | null = isImageNodeSelected ? currentNode : null\n    let audioNode: LGraphNode | null = isAudioNodeSelected ? currentNode : null\n    const videoNode: LGraphNode | null = isVideoNodeSelected\n      ? currentNode\n      : null\n\n    // Look for image paste data\n    for (const item of items) {\n      if (item.type.startsWith('image/')) {\n        if (!imageNode) {\n          // No image node selected: add a new one\n          const newNode = LiteGraph.createNode('LoadImage')\n          if (newNode) {\n            newNode.pos = [canvas.graph_mouse[0], canvas.graph_mouse[1]]\n            imageNode = graph?.add(newNode) ?? null\n          }\n          graph?.change()\n        }\n        pasteItemsOnNode(items, imageNode, 'image')\n        return\n      } else if (item.type.startsWith('video/')) {\n        if (!videoNode) {\n          // No video node selected: add a new one\n          // TODO: when video node exists\n        } else {\n          pasteItemsOnNode(items, videoNode, 'video')\n          return\n        }\n      } else if (item.type.startsWith('audio/')) {\n        if (!audioNode) {\n          // No audio node selected: add a new one\n          const newNode = LiteGraph.createNode('LoadAudio')\n          if (newNode) {\n            newNode.pos = [canvas.graph_mouse[0], canvas.graph_mouse[1]]\n            audioNode = graph?.add(newNode) ?? null\n          }\n          graph?.change()\n        }\n        pasteItemsOnNode(items, audioNode, 'audio')\n        return\n      }\n    }\n    if (pasteClipboardItems(data)) return\n\n    // No image found. Look for node data\n    data = data.getData('text/plain')\n    let workflow: ComfyWorkflowJSON | null = null\n    try {\n      data = data.slice(data.indexOf('{'))\n      workflow = JSON.parse(data)\n    } catch (err) {\n      try {\n        data = data.slice(data.indexOf('workflow\\n'))\n        data = data.slice(data.indexOf('{'))\n        workflow = JSON.parse(data)\n      } catch (error) {\n        workflow = null\n      }\n    }\n\n    if (workflow && workflow.version && workflow.nodes && workflow.extra) {\n      await app.loadGraphData(workflow)\n    } else {\n      if (\n        (e.target instanceof HTMLTextAreaElement &&\n          e.target.type === 'textarea') ||\n        (e.target instanceof HTMLInputElement && e.target.type === 'text')\n      ) {\n        return\n      }\n\n      // Litegraph default paste\n      canvas.pasteFromClipboard()\n    }\n  })\n}\n","import { watchEffect } from 'vue'\n\nimport {\n  CanvasPointer,\n  LGraphNode,\n  LiteGraph\n} from '@/lib/litegraph/src/litegraph'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\n\n/**\n * Watch for changes in the setting store and update the LiteGraph settings accordingly.\n */\nexport const useLitegraphSettings = () => {\n  const settingStore = useSettingStore()\n  const canvasStore = useCanvasStore()\n\n  watchEffect(() => {\n    const canvasInfoEnabled = settingStore.get('Comfy.Graph.CanvasInfo')\n    if (canvasStore.canvas) {\n      canvasStore.canvas.show_info = canvasInfoEnabled\n      canvasStore.canvas.draw(false, true)\n    }\n  })\n\n  watchEffect(() => {\n    const zoomSpeed = settingStore.get('Comfy.Graph.ZoomSpeed')\n    if (canvasStore.canvas) {\n      canvasStore.canvas.zoom_speed = zoomSpeed\n    }\n  })\n\n  watchEffect(() => {\n    LiteGraph.snaps_for_comfy = settingStore.get(\n      'Comfy.Node.AutoSnapLinkToSlot'\n    )\n  })\n\n  watchEffect(() => {\n    LiteGraph.snap_highlights_node = settingStore.get(\n      'Comfy.Node.SnapHighlightsNode'\n    )\n  })\n\n  watchEffect(() => {\n    LGraphNode.keepAllLinksOnBypass = settingStore.get(\n      'Comfy.Node.BypassAllLinksOnDelete'\n    )\n  })\n\n  watchEffect(() => {\n    LiteGraph.middle_click_slot_add_default_node = settingStore.get(\n      'Comfy.Node.MiddleClickRerouteNode'\n    )\n  })\n\n  watchEffect(() => {\n    const linkRenderMode = settingStore.get('Comfy.LinkRenderMode')\n    if (canvasStore.canvas) {\n      canvasStore.canvas.links_render_mode = linkRenderMode\n      canvasStore.canvas.setDirty(/* fg */ false, /* bg */ true)\n    }\n  })\n\n  watchEffect(() => {\n    const minFontSizeForLOD = settingStore.get(\n      'LiteGraph.Canvas.MinFontSizeForLOD'\n    )\n    if (canvasStore.canvas) {\n      canvasStore.canvas.min_font_size_for_lod = minFontSizeForLOD\n      canvasStore.canvas.setDirty(/* fg */ true, /* bg */ true)\n    }\n  })\n\n  watchEffect(() => {\n    const linkMarkerShape = settingStore.get('Comfy.Graph.LinkMarkers')\n    const { canvas } = canvasStore\n    if (canvas) {\n      canvas.linkMarkerShape = linkMarkerShape\n      canvas.setDirty(false, true)\n    }\n  })\n\n  watchEffect(() => {\n    const maximumFps = settingStore.get('LiteGraph.Canvas.MaximumFps')\n    const { canvas } = canvasStore\n    if (canvas) canvas.maximumFps = maximumFps\n  })\n\n  watchEffect(() => {\n    const dragZoomEnabled = settingStore.get('Comfy.Graph.CtrlShiftZoom')\n    const { canvas } = canvasStore\n    if (canvas) canvas.dragZoomEnabled = dragZoomEnabled\n  })\n\n  watchEffect(() => {\n    CanvasPointer.doubleClickTime = settingStore.get(\n      'Comfy.Pointer.DoubleClickTime'\n    )\n  })\n\n  watchEffect(() => {\n    CanvasPointer.bufferTime = settingStore.get('Comfy.Pointer.ClickBufferTime')\n  })\n\n  watchEffect(() => {\n    CanvasPointer.maxClickDrift = settingStore.get('Comfy.Pointer.ClickDrift')\n  })\n\n  watchEffect(() => {\n    LiteGraph.CANVAS_GRID_SIZE = settingStore.get('Comfy.SnapToGrid.GridSize')\n  })\n\n  watchEffect(() => {\n    LiteGraph.alwaysSnapToGrid = settingStore.get('pysssss.SnapToGrid')\n  })\n\n  watchEffect(() => {\n    LiteGraph.context_menu_scaling = settingStore.get(\n      'LiteGraph.ContextMenu.Scaling'\n    )\n  })\n\n  watchEffect(() => {\n    LiteGraph.Reroute.maxSplineOffset = settingStore.get(\n      'LiteGraph.Reroute.SplineOffset'\n    )\n  })\n\n  watchEffect(() => {\n    const navigationMode = settingStore.get('Comfy.Canvas.NavigationMode') as\n      | 'standard'\n      | 'legacy'\n      | 'custom'\n\n    LiteGraph.canvasNavigationMode = navigationMode\n    LiteGraph.macTrackpadGestures = navigationMode === 'standard'\n  })\n\n  watchEffect(() => {\n    const leftMouseBehavior = settingStore.get(\n      'Comfy.Canvas.LeftMouseClickBehavior'\n    ) as 'panning' | 'select'\n    LiteGraph.leftMouseClickBehavior = leftMouseBehavior\n  })\n\n  watchEffect(() => {\n    const mouseWheelScroll = settingStore.get(\n      'Comfy.Canvas.MouseWheelScroll'\n    ) as 'panning' | 'zoom'\n    LiteGraph.mouseWheelScroll = mouseWheelScroll\n  })\n\n  watchEffect(() => {\n    LiteGraph.saveViewportWithGraph = settingStore.get(\n      'Comfy.EnableWorkflowViewRestore'\n    )\n  })\n}\n","import { LinkMarkerShape, LiteGraph } from '@/lib/litegraph/src/litegraph'\nimport { isCloud } from '@/platform/distribution/types'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport type { SettingParams } from '@/platform/settings/types'\nimport type { ColorPalettes } from '@/schemas/colorPaletteSchema'\nimport type { Keybinding } from '@/schemas/keyBindingSchema'\nimport { NodeBadgeMode } from '@/types/nodeSource'\nimport { LinkReleaseTriggerAction } from '@/types/searchBoxTypes'\nimport { breakpointsTailwind } from '@vueuse/core'\n\n/**\n * Core settings are essential configuration parameters required for ComfyUI's basic functionality.\n * These settings must be present in the settings store and cannot be omitted.\n *\n * IMPORTANT: To prevent ID conflicts, settings should be marked as deprecated rather than removed\n * when they are no longer needed.\n */\nexport const CORE_SETTINGS: SettingParams[] = [\n  {\n    id: 'Comfy.Memory.AllowManualUnload',\n    name: 'Allow manual unload of models and execution cache via user command',\n    type: 'hidden',\n    defaultValue: isCloud ? false : true,\n    versionAdded: '1.18.0'\n  },\n  {\n    id: 'Comfy.Validation.Workflows',\n    name: 'Validate workflows',\n    type: 'boolean',\n    defaultValue: isCloud ? false : true\n  },\n  {\n    id: 'Comfy.NodeSearchBoxImpl',\n    category: ['Comfy', 'Node Search Box', 'Implementation'],\n    experimental: true,\n    name: 'Node search box implementation',\n    type: 'combo',\n    options: ['default', 'litegraph (legacy)'],\n    defaultValue: 'default'\n  },\n  {\n    id: 'Comfy.LinkRelease.Action',\n    category: ['LiteGraph', 'LinkRelease', 'Action'],\n    name: 'Action on link release (No modifier)',\n    type: 'combo',\n    options: Object.values(LinkReleaseTriggerAction),\n    defaultValue: LinkReleaseTriggerAction.CONTEXT_MENU,\n    defaultsByInstallVersion: {\n      '1.24.1': LinkReleaseTriggerAction.SEARCH_BOX\n    }\n  },\n  {\n    id: 'Comfy.LinkRelease.ActionShift',\n    category: ['LiteGraph', 'LinkRelease', 'ActionShift'],\n    name: 'Action on link release (Shift)',\n    type: 'combo',\n    options: Object.values(LinkReleaseTriggerAction),\n    defaultValue: LinkReleaseTriggerAction.SEARCH_BOX,\n    defaultsByInstallVersion: {\n      '1.24.1': LinkReleaseTriggerAction.CONTEXT_MENU\n    }\n  },\n  {\n    id: 'Comfy.NodeSearchBoxImpl.NodePreview',\n    category: ['Comfy', 'Node Search Box', 'NodePreview'],\n    name: 'Node preview',\n    tooltip: 'Only applies to the default implementation',\n    type: 'boolean',\n    defaultValue: true\n  },\n  {\n    id: 'Comfy.NodeSearchBoxImpl.ShowCategory',\n    category: ['Comfy', 'Node Search Box', 'ShowCategory'],\n    name: 'Show node category in search results',\n    tooltip: 'Only applies to the default implementation',\n    type: 'boolean',\n    defaultValue: true\n  },\n  {\n    id: 'Comfy.NodeSearchBoxImpl.ShowIdName',\n    category: ['Comfy', 'Node Search Box', 'ShowIdName'],\n    name: 'Show node id name in search results',\n    tooltip: 'Only applies to the default implementation',\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'Comfy.NodeSearchBoxImpl.ShowNodeFrequency',\n    category: ['Comfy', 'Node Search Box', 'ShowNodeFrequency'],\n    name: 'Show node frequency in search results',\n    tooltip: 'Only applies to the default implementation',\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'Comfy.Sidebar.Location',\n    category: ['Appearance', 'Sidebar', 'Location'],\n    name: 'Sidebar location',\n    type: 'combo',\n    options: ['left', 'right'],\n    defaultValue: 'left'\n  },\n  {\n    id: 'Comfy.Sidebar.Size',\n    category: ['Appearance', 'Sidebar', 'Size'],\n    name: 'Sidebar size',\n    type: 'combo',\n    options: ['normal', 'small'],\n    // Default to small if the window is less than 1536px(2xl) wide.\n    defaultValue: () => (window.innerWidth < 1536 ? 'small' : 'normal')\n  },\n  {\n    id: 'Comfy.Sidebar.UnifiedWidth',\n    category: ['Appearance', 'Sidebar', 'UnifiedWidth'],\n    name: 'Unified sidebar width',\n    type: 'boolean',\n    defaultValue: true,\n    versionAdded: '1.18.1'\n  },\n  {\n    id: 'Comfy.Sidebar.Style',\n    category: ['Appearance', 'Sidebar', 'Style'],\n    name: 'Sidebar style',\n    type: 'combo',\n    options: ['floating', 'connected'],\n    defaultValue: 'connected'\n  },\n  {\n    id: 'Comfy.TextareaWidget.FontSize',\n    category: ['Appearance', 'Node Widget', 'TextareaWidget', 'FontSize'],\n    name: 'Textarea widget font size',\n    type: 'slider',\n    defaultValue: 10,\n    attrs: {\n      min: 8,\n      max: 24\n    }\n  },\n  {\n    id: 'Comfy.TextareaWidget.Spellcheck',\n    category: ['Comfy', 'Node Widget', 'TextareaWidget', 'Spellcheck'],\n    name: 'Textarea widget spellcheck',\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'Comfy.Workflow.SortNodeIdOnSave',\n    name: 'Sort node IDs when saving workflow',\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'Comfy.Canvas.NavigationMode',\n    category: ['LiteGraph', 'Canvas Navigation', 'NavigationMode'],\n    name: 'Navigation Mode',\n    defaultValue: 'legacy',\n    type: 'combo',\n    sortOrder: 100,\n    options: [\n      { value: 'standard', text: 'Standard (New)' },\n      { value: 'legacy', text: 'Drag Navigation' },\n      { value: 'custom', text: 'Custom' }\n    ],\n    versionAdded: '1.25.0',\n    defaultsByInstallVersion: {\n      '1.25.0': 'legacy'\n    },\n    onChange: async (newValue: string, oldValue?: string) => {\n      if (!oldValue) return\n      const settingStore = useSettingStore()\n\n      if (newValue === 'standard') {\n        // Update related settings to match standard mode - select + panning\n        await settingStore.set('Comfy.Canvas.LeftMouseClickBehavior', 'select')\n        await settingStore.set('Comfy.Canvas.MouseWheelScroll', 'panning')\n      } else if (newValue === 'legacy') {\n        // Update related settings to match legacy mode - panning + zoom\n        await settingStore.set('Comfy.Canvas.LeftMouseClickBehavior', 'panning')\n        await settingStore.set('Comfy.Canvas.MouseWheelScroll', 'zoom')\n      }\n    }\n  },\n  {\n    id: 'Comfy.Canvas.LeftMouseClickBehavior',\n    category: ['LiteGraph', 'Canvas Navigation', 'LeftMouseClickBehavior'],\n    name: 'Left Mouse Click Behavior',\n    defaultValue: 'panning',\n    type: 'radio',\n    sortOrder: 50,\n    options: [\n      { value: 'panning', text: 'Panning' },\n      { value: 'select', text: 'Select' }\n    ],\n    versionAdded: '1.27.4',\n    onChange: async (newValue: string) => {\n      const settingStore = useSettingStore()\n\n      const navigationMode = settingStore.get('Comfy.Canvas.NavigationMode')\n\n      if (navigationMode !== 'custom') {\n        if (\n          (newValue === 'select' && navigationMode === 'standard') ||\n          (newValue === 'panning' && navigationMode === 'legacy')\n        ) {\n          return\n        }\n\n        // only set to custom if it doesn't match the preset modes\n        await settingStore.set('Comfy.Canvas.NavigationMode', 'custom')\n      }\n    }\n  },\n  {\n    id: 'Comfy.Canvas.MouseWheelScroll',\n    category: ['LiteGraph', 'Canvas Navigation', 'MouseWheelScroll'],\n    name: 'Mouse Wheel Scroll',\n    defaultValue: 'zoom',\n    type: 'radio',\n    options: [\n      { value: 'panning', text: 'Panning' },\n      { value: 'zoom', text: 'Zoom in/out' }\n    ],\n    versionAdded: '1.27.4',\n    onChange: async (newValue: string) => {\n      const settingStore = useSettingStore()\n\n      const navigationMode = settingStore.get('Comfy.Canvas.NavigationMode')\n\n      if (navigationMode !== 'custom') {\n        if (\n          (newValue === 'panning' && navigationMode === 'standard') ||\n          (newValue === 'zoom' && navigationMode === 'legacy')\n        ) {\n          return\n        }\n\n        // only set to custom if it doesn't match the preset modes\n        await settingStore.set('Comfy.Canvas.NavigationMode', 'custom')\n      }\n    }\n  },\n  {\n    id: 'Comfy.Graph.CanvasInfo',\n    category: ['LiteGraph', 'Canvas', 'CanvasInfo'],\n    name: 'Show canvas info on bottom left corner (fps, etc.)',\n    type: 'boolean',\n    defaultValue: true\n  },\n  {\n    id: 'Comfy.Node.ShowDeprecated',\n    name: 'Show deprecated nodes in search',\n    tooltip:\n      'Deprecated nodes are hidden by default in the UI, but remain functional in existing workflows that use them.',\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'Comfy.Node.ShowExperimental',\n    name: 'Show experimental nodes in search',\n    tooltip:\n      'Experimental nodes are marked as such in the UI and may be subject to significant changes or removal in future versions. Use with caution in production workflows',\n    type: 'boolean',\n    defaultValue: true\n  },\n  {\n    id: 'Comfy.Node.Opacity',\n    category: ['Appearance', 'Node', 'Opacity'],\n    name: 'Node opacity',\n    type: 'slider',\n    defaultValue: 1,\n    attrs: {\n      min: 0.01,\n      max: 1,\n      step: 0.01\n    }\n  },\n  {\n    id: 'Comfy.Workflow.ShowMissingNodesWarning',\n    name: 'Show missing nodes warning',\n    type: 'boolean',\n    defaultValue: true\n  },\n  {\n    id: 'Comfy.Workflow.ShowMissingModelsWarning',\n    name: 'Show missing models warning',\n    type: isCloud ? 'hidden' : 'boolean',\n    defaultValue: isCloud ? false : true,\n    experimental: true\n  },\n  {\n    id: 'Comfy.Workflow.WarnBlueprintOverwrite',\n    name: 'Require confirmation to overwrite an existing subgraph blueprint',\n    type: 'boolean',\n    defaultValue: true\n  },\n  {\n    id: 'Comfy.Graph.ZoomSpeed',\n    category: ['LiteGraph', 'Canvas', 'ZoomSpeed'],\n    name: 'Canvas zoom speed',\n    type: 'slider',\n    defaultValue: 1.1,\n    attrs: {\n      min: 1.01,\n      max: 2.5,\n      step: 0.01\n    }\n  },\n  // Bookmarks are stored in the settings store.\n  // Bookmarks are in format of category/display_name. e.g. \"conditioning/CLIPTextEncode\"\n  {\n    id: 'Comfy.NodeLibrary.Bookmarks',\n    name: 'Node library bookmarks with display name (deprecated)',\n    type: 'hidden',\n    defaultValue: [],\n    deprecated: true\n  },\n  {\n    id: 'Comfy.NodeLibrary.Bookmarks.V2',\n    name: 'Node library bookmarks v2 with unique name',\n    type: 'hidden',\n    defaultValue: []\n  },\n  // Stores mapping from bookmark folder name to its customization.\n  {\n    id: 'Comfy.NodeLibrary.BookmarksCustomization',\n    name: 'Node library bookmarks customization',\n    type: 'hidden',\n    defaultValue: {}\n  },\n  // Hidden setting used by the queue for how to fit images\n  {\n    id: 'Comfy.Queue.ImageFit',\n    name: 'Queue image fit',\n    type: 'hidden',\n    defaultValue: 'cover'\n  },\n  {\n    id: 'Comfy.GroupSelectedNodes.Padding',\n    category: ['LiteGraph', 'Group', 'Padding'],\n    name: 'Group selected nodes padding',\n    type: 'slider',\n    defaultValue: 10,\n    attrs: {\n      min: 0,\n      max: 100\n    }\n  },\n  {\n    id: 'Comfy.Node.DoubleClickTitleToEdit',\n    category: ['LiteGraph', 'Node', 'DoubleClickTitleToEdit'],\n    name: 'Double click node title to edit',\n    type: 'boolean',\n    defaultValue: true\n  },\n  {\n    id: 'Comfy.Node.AllowImageSizeDraw',\n    category: ['LiteGraph', 'Node Widget', 'AllowImageSizeDraw'],\n    name: 'Show width  height below the image preview',\n    type: 'boolean',\n    defaultValue: true\n  },\n  {\n    id: 'Comfy.Group.DoubleClickTitleToEdit',\n    category: ['LiteGraph', 'Group', 'DoubleClickTitleToEdit'],\n    name: 'Double click group title to edit',\n    type: 'boolean',\n    defaultValue: true\n  },\n  {\n    id: 'Comfy.Window.UnloadConfirmation',\n    name: 'Show confirmation when closing window',\n    type: 'boolean',\n    defaultValue: true,\n    versionModified: '1.7.12'\n  },\n  {\n    id: 'Comfy.TreeExplorer.ItemPadding',\n    category: ['Appearance', 'Tree Explorer', 'ItemPadding'],\n    name: 'Tree explorer item padding',\n    type: 'slider',\n    defaultValue: 2,\n    attrs: {\n      min: 0,\n      max: 8,\n      step: 1\n    }\n  },\n  {\n    id: 'Comfy.ModelLibrary.AutoLoadAll',\n    name: 'Automatically load all model folders',\n    tooltip:\n      'If true, all folders will load as soon as you open the model library (this may cause delays while it loads). If false, root level model folders will only load once you click on them.',\n    type: isCloud ? 'hidden' : 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'Comfy.ModelLibrary.NameFormat',\n    name: 'What name to display in the model library tree view',\n    tooltip:\n      'Select \"filename\" to render a simplified view of the raw filename (without directory or \".safetensors\" extension) in the model list. Select \"title\" to display the configurable model metadata title.',\n    type: 'combo',\n    options: ['filename', 'title'],\n    defaultValue: 'title'\n  },\n  {\n    id: 'Comfy.Locale',\n    name: 'Language',\n    type: 'combo',\n    options: [\n      { value: 'en', text: 'English' },\n      { value: 'zh', text: '' },\n      { value: 'zh-TW', text: '' },\n      { value: 'ru', text: '' },\n      { value: 'ja', text: '' },\n      { value: 'ko', text: '' },\n      { value: 'fr', text: 'Franais' },\n      { value: 'es', text: 'Espaol' },\n      { value: 'ar', text: '' },\n      { value: 'tr', text: 'Trke' }\n    ],\n    defaultValue: () => navigator.language.split('-')[0] || 'en'\n  },\n  {\n    id: 'Comfy.NodeBadge.NodeSourceBadgeMode',\n    category: ['LiteGraph', 'Node', 'NodeSourceBadgeMode'],\n    name: 'Node source badge mode',\n    type: 'combo',\n    options: Object.values(NodeBadgeMode),\n    defaultValue: NodeBadgeMode.HideBuiltIn\n  },\n  {\n    id: 'Comfy.NodeBadge.NodeIdBadgeMode',\n    category: ['LiteGraph', 'Node', 'NodeIdBadgeMode'],\n    name: 'Node ID badge mode',\n    type: 'combo',\n    options: [NodeBadgeMode.None, NodeBadgeMode.ShowAll],\n    defaultValue: NodeBadgeMode.None\n  },\n  {\n    id: 'Comfy.NodeBadge.NodeLifeCycleBadgeMode',\n    category: ['LiteGraph', 'Node', 'NodeLifeCycleBadgeMode'],\n    name: 'Node life cycle badge mode',\n    type: 'combo',\n    options: [NodeBadgeMode.None, NodeBadgeMode.ShowAll],\n    defaultValue: NodeBadgeMode.ShowAll\n  },\n  {\n    id: 'Comfy.NodeBadge.ShowApiPricing',\n    category: ['Comfy', 'API Nodes'],\n    name: 'Show API node pricing badge',\n    type: 'boolean',\n    defaultValue: true,\n    versionAdded: '1.20.3'\n  },\n  {\n    id: 'Comfy.Notification.ShowVersionUpdates',\n    category: ['Comfy', 'Notification Preferences'],\n    name: 'Show version updates',\n    tooltip: 'Show updates for new models, and major new features.',\n    type: 'boolean',\n    defaultValue: true\n  },\n  {\n    id: 'Comfy.ConfirmClear',\n    category: ['Comfy', 'Workflow', 'ConfirmClear'],\n    name: 'Require confirmation when clearing workflow',\n    type: 'boolean',\n    defaultValue: true\n  },\n  {\n    id: 'Comfy.PromptFilename',\n    category: ['Comfy', 'Workflow', 'PromptFilename'],\n    name: 'Prompt for filename when saving workflow',\n    type: 'boolean',\n    defaultValue: true\n  },\n  /**\n   * file format for preview\n   *\n   * format;quality\n   *\n   * ex)\n   * webp;50 -> webp, quality 50\n   * jpeg;80 -> rgb, jpeg, quality 80\n   *\n   * @type {string}\n   */\n  {\n    id: 'Comfy.PreviewFormat',\n    category: ['LiteGraph', 'Node Widget', 'PreviewFormat'],\n    name: 'Preview image format',\n    tooltip:\n      'When displaying a preview in the image widget, convert it to a lightweight image, e.g. webp, jpeg, webp;50, etc.',\n    type: 'text',\n    defaultValue: ''\n  },\n  {\n    id: 'Comfy.DisableSliders',\n    category: ['LiteGraph', 'Node Widget', 'DisableSliders'],\n    name: 'Disable node widget sliders',\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'Comfy.DisableFloatRounding',\n    category: ['LiteGraph', 'Node Widget', 'DisableFloatRounding'],\n    name: 'Disable default float widget rounding.',\n    tooltip:\n      '(requires page reload) Cannot disable round when round is set by the node in the backend.',\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'Comfy.FloatRoundingPrecision',\n    category: ['LiteGraph', 'Node Widget', 'FloatRoundingPrecision'],\n    name: 'Float widget rounding decimal places [0 = auto].',\n    tooltip: '(requires page reload)',\n    type: 'slider',\n    attrs: {\n      min: 0,\n      max: 6,\n      step: 1\n    },\n    defaultValue: 0\n  },\n  {\n    id: 'LiteGraph.Node.TooltipDelay',\n    name: 'Tooltip Delay',\n    type: 'number',\n    attrs: {\n      min: 100,\n      max: 3000,\n      step: 50\n    },\n    defaultValue: 500,\n    versionAdded: '1.9.0'\n  },\n  {\n    id: 'Comfy.EnableTooltips',\n    category: ['LiteGraph', 'Node', 'EnableTooltips'],\n    name: 'Enable Tooltips',\n    type: 'boolean',\n    defaultValue: true\n  },\n  {\n    id: 'Comfy.DevMode',\n    name: 'Enable dev mode options (API save, etc.)',\n    type: 'boolean',\n    defaultValue: false,\n    onChange: (value) => {\n      const element = document.getElementById('comfy-dev-save-api-button')\n      if (element) {\n        element.style.display = value ? 'flex' : 'none'\n      }\n    }\n  },\n  {\n    id: 'Comfy.UseNewMenu',\n    category: ['Comfy', 'Menu', 'UseNewMenu'],\n    defaultValue: 'Top',\n    name: 'Use new menu',\n    type: 'combo',\n    options: ['Disabled', 'Top'],\n    tooltip:\n      'Menu bar position. On mobile devices, the menu is always shown at the top.',\n    migrateDeprecatedValue: (value: string) => {\n      // Floating is now supported by dragging the docked actionbar off.\n      if (value === 'Floating') {\n        return 'Top'\n      } else if (value === 'Bottom') {\n        return 'Top'\n      }\n      return value\n    }\n  },\n  {\n    id: 'Comfy.Workflow.WorkflowTabsPosition',\n    name: 'Opened workflows position',\n    type: 'combo',\n    options: ['Sidebar', 'Topbar'],\n    defaultValue: 'Topbar',\n    migrateDeprecatedValue: (value: string) => {\n      if (value === 'Topbar (2nd-row)') {\n        return 'Topbar'\n      }\n      return value\n    }\n  },\n  {\n    id: 'Comfy.Graph.CanvasMenu',\n    category: ['LiteGraph', 'Canvas', 'CanvasMenu'],\n    name: 'Show graph canvas menu',\n    type: 'boolean',\n    defaultValue: true\n  },\n  {\n    id: 'Comfy.QueueButton.BatchCountLimit',\n    name: 'Batch count limit',\n    tooltip:\n      'The maximum number of tasks added to the queue at one button click',\n    type: 'number',\n    defaultValue: isCloud ? 4 : 100,\n    versionAdded: '1.3.5'\n  },\n  {\n    id: 'Comfy.Keybinding.UnsetBindings',\n    name: 'Keybindings unset by the user',\n    type: 'hidden',\n    defaultValue: [] as Keybinding[],\n    versionAdded: '1.3.7',\n    versionModified: '1.7.3',\n    migrateDeprecatedValue: (value: any[]) => {\n      return value.map((keybinding) => {\n        if (keybinding['targetSelector'] === '#graph-canvas') {\n          keybinding['targetElementId'] = 'graph-canvas-container'\n        }\n        return keybinding\n      })\n    }\n  },\n  {\n    id: 'Comfy.Keybinding.NewBindings',\n    name: 'Keybindings set by the user',\n    type: 'hidden',\n    defaultValue: [] as Keybinding[],\n    versionAdded: '1.3.7'\n  },\n  {\n    id: 'Comfy.Extension.Disabled',\n    name: 'Disabled extension names',\n    type: 'hidden',\n    defaultValue: [] as string[],\n    versionAdded: '1.3.11'\n  },\n  {\n    id: 'Comfy.LinkRenderMode',\n    category: ['LiteGraph', 'Graph', 'LinkRenderMode'],\n    name: 'Link Render Mode',\n    defaultValue: 2,\n    type: 'combo',\n    options: [\n      { value: LiteGraph.STRAIGHT_LINK, text: 'Straight' },\n      { value: LiteGraph.LINEAR_LINK, text: 'Linear' },\n      { value: LiteGraph.SPLINE_LINK, text: 'Spline' },\n      { value: LiteGraph.HIDDEN_LINK, text: 'Hidden' }\n    ]\n  },\n  {\n    id: 'Comfy.Node.AutoSnapLinkToSlot',\n    category: ['LiteGraph', 'Node', 'AutoSnapLinkToSlot'],\n    name: 'Auto snap link to node slot',\n    tooltip:\n      'When dragging a link over a node, the link automatically snap to a viable input slot on the node',\n    type: 'boolean',\n    defaultValue: true,\n    versionAdded: '1.3.29'\n  },\n  {\n    id: 'Comfy.Node.SnapHighlightsNode',\n    category: ['LiteGraph', 'Node', 'SnapHighlightsNode'],\n    name: 'Snap highlights node',\n    tooltip:\n      'When dragging a link over a node with viable input slot, highlight the node',\n    type: 'boolean',\n    defaultValue: true,\n    versionAdded: '1.3.29'\n  },\n  {\n    id: 'Comfy.Node.BypassAllLinksOnDelete',\n    category: ['LiteGraph', 'Node', 'BypassAllLinksOnDelete'],\n    name: 'Keep all links when deleting nodes',\n    tooltip:\n      'When deleting a node, attempt to reconnect all of its input and output links (bypassing the deleted node)',\n    type: 'boolean',\n    defaultValue: true,\n    versionAdded: '1.3.40'\n  },\n  {\n    id: 'Comfy.Node.MiddleClickRerouteNode',\n    category: ['LiteGraph', 'Node', 'MiddleClickRerouteNode'],\n    name: 'Middle-click creates a new Reroute node',\n    type: 'boolean',\n    defaultValue: true,\n    versionAdded: '1.3.42'\n  },\n  {\n    id: 'Comfy.Graph.LinkMarkers',\n    category: ['LiteGraph', 'Link', 'LinkMarkers'],\n    name: 'Link midpoint markers',\n    defaultValue: LinkMarkerShape.Circle,\n    type: 'combo',\n    options: [\n      { value: LinkMarkerShape.None, text: 'None' },\n      { value: LinkMarkerShape.Circle, text: 'Circle' },\n      { value: LinkMarkerShape.Arrow, text: 'Arrow' }\n    ],\n    versionAdded: '1.3.42'\n  },\n  {\n    id: 'Comfy.DOMClippingEnabled',\n    category: ['LiteGraph', 'Node', 'DOMClippingEnabled'],\n    name: 'Enable DOM element clipping (enabling may reduce performance)',\n    type: 'boolean',\n    defaultValue: true\n  },\n  {\n    id: 'Comfy.Graph.CtrlShiftZoom',\n    category: ['LiteGraph', 'Canvas', 'CtrlShiftZoom'],\n    name: 'Enable fast-zoom shortcut (Ctrl + Shift + Drag)',\n    type: 'boolean',\n    defaultValue: true,\n    versionAdded: '1.4.0'\n  },\n  {\n    id: 'Comfy.Pointer.ClickDrift',\n    category: ['LiteGraph', 'Pointer', 'ClickDrift'],\n    name: 'Pointer click drift (maximum distance)',\n    tooltip:\n      'If the pointer moves more than this distance while holding a button down, it is considered dragging (rather than clicking).\\n\\nHelps prevent objects from being unintentionally nudged if the pointer is moved whilst clicking.',\n    experimental: true,\n    type: 'slider',\n    attrs: {\n      min: 0,\n      max: 20,\n      step: 1\n    },\n    defaultValue: 6,\n    versionAdded: '1.4.3'\n  },\n  {\n    id: 'Comfy.Pointer.ClickBufferTime',\n    category: ['LiteGraph', 'Pointer', 'ClickBufferTime'],\n    name: 'Pointer click drift delay',\n    tooltip:\n      'After pressing a pointer button down, this is the maximum time (in milliseconds) that pointer movement can be ignored for.\\n\\nHelps prevent objects from being unintentionally nudged if the pointer is moved whilst clicking.',\n    experimental: true,\n    type: 'slider',\n    attrs: {\n      min: 0,\n      max: 1000,\n      step: 25\n    },\n    defaultValue: 150,\n    versionAdded: '1.4.3'\n  },\n  {\n    id: 'Comfy.Pointer.DoubleClickTime',\n    category: ['LiteGraph', 'Pointer', 'DoubleClickTime'],\n    name: 'Double click interval (maximum)',\n    tooltip:\n      'The maximum time in milliseconds between the two clicks of a double-click.  Increasing this value may assist if double-clicks are sometimes not registered.',\n    type: 'slider',\n    attrs: {\n      min: 100,\n      max: 1000,\n      step: 50\n    },\n    defaultValue: 300,\n    versionAdded: '1.4.3'\n  },\n  {\n    id: 'Comfy.SnapToGrid.GridSize',\n    category: ['LiteGraph', 'Canvas', 'GridSize'],\n    name: 'Snap to grid size',\n    type: 'slider',\n    attrs: {\n      min: 1,\n      max: 500\n    },\n    tooltip:\n      'When dragging and resizing nodes while holding shift they will be aligned to the grid, this controls the size of that grid.',\n    defaultValue: LiteGraph.CANVAS_GRID_SIZE\n  },\n  // Keep the 'pysssss.SnapToGrid' setting id so we don't need to migrate setting values.\n  // Using a new setting id can cause existing users to lose their existing settings.\n  {\n    id: 'pysssss.SnapToGrid',\n    category: ['LiteGraph', 'Canvas', 'AlwaysSnapToGrid'],\n    name: 'Always snap to grid',\n    type: 'boolean',\n    defaultValue: false,\n    versionAdded: '1.3.13'\n  },\n  {\n    id: 'Comfy.Server.ServerConfigValues',\n    name: 'Server config values for frontend display',\n    tooltip: 'Server config values used for frontend display only',\n    type: 'hidden',\n    // Mapping from server config id to value.\n    defaultValue: {} as Record<string, any>,\n    versionAdded: '1.4.8'\n  },\n  {\n    id: 'Comfy.Server.LaunchArgs',\n    name: 'Server launch arguments',\n    tooltip:\n      'These are the actual arguments that are passed to the server when it is launched.',\n    type: 'hidden',\n    defaultValue: {} as Record<string, string>,\n    versionAdded: '1.4.8'\n  },\n  {\n    id: 'Comfy.Queue.MaxHistoryItems',\n    name: 'Queue history size',\n    tooltip: 'The maximum number of tasks that show in the queue history.',\n    type: 'slider',\n    attrs: {\n      min: 2,\n      max: 256,\n      step: 2\n    },\n    defaultValue: 64,\n    versionAdded: '1.4.12'\n  },\n  {\n    id: 'LiteGraph.Canvas.MaximumFps',\n    name: 'Maximum FPS',\n    tooltip:\n      'The maximum frames per second that the canvas is allowed to render. Caps GPU usage at the cost of smoothness. If 0, the screen refresh rate is used. Default: 0',\n    type: 'slider',\n    attrs: {\n      min: 0,\n      max: 120\n    },\n    defaultValue: 0,\n    versionAdded: '1.5.1'\n  },\n  {\n    id: 'Comfy.EnableWorkflowViewRestore',\n    category: ['Comfy', 'Workflow', 'EnableWorkflowViewRestore'],\n    name: 'Save and restore canvas position and zoom level in workflows',\n    type: 'boolean',\n    defaultValue: true,\n    versionModified: '1.5.4'\n  },\n  {\n    id: 'Comfy.Workflow.ConfirmDelete',\n    name: 'Show confirmation when deleting workflows',\n    type: 'boolean',\n    defaultValue: true,\n    versionAdded: '1.5.6'\n  },\n  {\n    id: 'Comfy.ColorPalette',\n    name: 'The active color palette id',\n    type: 'hidden',\n    defaultValue: 'dark',\n    versionModified: '1.6.7',\n    migrateDeprecatedValue(value: string) {\n      // Legacy custom palettes were prefixed with 'custom_'\n      return value.startsWith('custom_') ? value.replace('custom_', '') : value\n    }\n  },\n  {\n    id: 'Comfy.CustomColorPalettes',\n    name: 'Custom color palettes',\n    type: 'hidden',\n    defaultValue: {} as ColorPalettes,\n    versionModified: '1.6.7'\n  },\n  {\n    id: 'Comfy.WidgetControlMode',\n    category: ['Comfy', 'Node Widget', 'WidgetControlMode'],\n    name: 'Widget control mode',\n    tooltip:\n      'Controls when widget values are updated (randomize/increment/decrement), either before the prompt is queued or after.',\n    type: 'combo',\n    defaultValue: 'after',\n    options: ['before', 'after'],\n    versionModified: '1.6.10'\n  },\n  {\n    id: 'Comfy.TutorialCompleted',\n    name: 'Tutorial completed',\n    type: 'hidden',\n    defaultValue: false,\n    versionAdded: '1.8.7'\n  },\n  {\n    id: 'Comfy.InstalledVersion',\n    name: 'The frontend version that was running when the user first installed ComfyUI',\n    type: 'hidden',\n    defaultValue: null,\n    versionAdded: '1.24.0'\n  },\n  {\n    id: 'LiteGraph.ContextMenu.Scaling',\n    name: 'Scale node combo widget menus (lists) when zoomed in',\n    defaultValue: false,\n    type: 'boolean',\n    versionAdded: '1.8.8'\n  },\n\n  {\n    id: 'LiteGraph.Canvas.LowQualityRenderingZoomThreshold',\n    type: 'hidden',\n    deprecated: true,\n    name: 'Low quality rendering zoom threshold (deprecated)',\n    tooltip:\n      'Zoom level threshold for performance mode. Lower values (0.1) = quality at all zoom levels. Higher values (1.0) = performance mode even when zoomed in. Performance mode simplifies rendering by hiding text labels, shadows, and details.',\n    attrs: {\n      min: 0.1,\n      max: 1,\n      step: 0.01\n    },\n    defaultValue: 0.6,\n    versionAdded: '1.9.1',\n    versionModified: '1.26.7'\n  },\n  {\n    id: 'LiteGraph.Canvas.MinFontSizeForLOD',\n    name: 'Zoom Node Level of Detail - font size threshold',\n    tooltip:\n      'Controls when the nodes switch to low quality LOD rendering. Uses font size in pixels to determine when to switch. Set to 0 to disable. Values 1-24 set the minimum font size threshold for LOD - higher values (24px) = switch nodes to simplified rendering sooner when zooming out, lower values (1px) = maintain full node quality longer.',\n    type: 'slider',\n    attrs: {\n      min: 0,\n      max: 24,\n      step: 1\n    },\n    defaultValue: 8,\n    versionAdded: '1.26.7'\n  },\n  {\n    id: 'Comfy.Canvas.SelectionToolbox',\n    category: ['LiteGraph', 'Canvas', 'SelectionToolbox'],\n    name: 'Show selection toolbox',\n    type: 'boolean',\n    defaultValue: true,\n    versionAdded: '1.10.5'\n  },\n  {\n    id: 'LiteGraph.Reroute.SplineOffset',\n    name: 'Reroute spline offset',\n    tooltip: 'The bezier control point offset from the reroute centre point',\n    type: 'slider',\n    defaultValue: 20,\n    attrs: {\n      min: 0,\n      max: 400\n    },\n    versionAdded: '1.15.7'\n  },\n  {\n    id: 'Comfy.Toast.DisableReconnectingToast',\n    name: 'Disable toasts when reconnecting or reconnected',\n    type: 'hidden',\n    defaultValue: false,\n    versionAdded: '1.15.12'\n  },\n  {\n    id: 'Comfy.Minimap.Visible',\n    name: 'Display minimap on canvas',\n    type: 'hidden',\n    defaultValue: window.innerWidth >= breakpointsTailwind.lg,\n    versionAdded: '1.25.0'\n  },\n  {\n    id: 'Comfy.Minimap.NodeColors',\n    name: 'Display node with its original color on minimap',\n    type: 'hidden',\n    defaultValue: false,\n    versionAdded: '1.26.0'\n  },\n  {\n    id: 'Comfy.Minimap.ShowLinks',\n    name: 'Display links on minimap',\n    type: 'hidden',\n    defaultValue: true,\n    versionAdded: '1.26.0'\n  },\n  {\n    id: 'Comfy.Minimap.ShowGroups',\n    name: 'Display node groups on minimap',\n    type: 'hidden',\n    defaultValue: true,\n    versionAdded: '1.26.0'\n  },\n  {\n    id: 'Comfy.Minimap.RenderBypassState',\n    name: 'Render bypass state on minimap',\n    type: 'hidden',\n    defaultValue: true,\n    versionAdded: '1.26.0'\n  },\n  {\n    id: 'Comfy.Minimap.RenderErrorState',\n    name: 'Render error state on minimap',\n    type: 'hidden',\n    defaultValue: true,\n    versionAdded: '1.26.0'\n  },\n  {\n    id: 'Comfy.Workflow.AutoSaveDelay',\n    name: 'Auto Save Delay (ms)',\n    defaultValue: 1000,\n    type: 'number',\n    tooltip: 'Only applies if Auto Save is set to \"after delay\".',\n    versionAdded: '1.16.0'\n  },\n  {\n    id: 'Comfy.Workflow.AutoSave',\n    name: 'Auto Save',\n    type: 'combo',\n    options: ['off', 'after delay'], // Room for other options like on focus change, tab change, window change\n    defaultValue: 'off', // Popular request by users (https://github.com/Comfy-Org/ComfyUI_frontend/issues/1584#issuecomment-2536610154)\n    versionAdded: '1.16.0'\n  },\n  {\n    id: 'Comfy.Workflow.Persist',\n    name: 'Persist workflow state and restore on page (re)load',\n    type: 'boolean',\n    defaultValue: true,\n    versionAdded: '1.16.1'\n  },\n  {\n    id: 'LiteGraph.Node.DefaultPadding',\n    name: 'Always shrink new nodes',\n    tooltip:\n      'Resize nodes to the smallest possible size when created. When disabled, a newly added node will be widened slightly to show widget values.',\n    type: 'boolean',\n    defaultValue: false,\n    versionAdded: '1.18.0'\n  },\n  {\n    id: 'Comfy.Canvas.BackgroundImage',\n    category: ['Appearance', 'Canvas', 'Background'],\n    name: 'Canvas background image',\n    type: 'backgroundImage',\n    tooltip:\n      'Image URL for the canvas background. You can right-click an image in the outputs panel and select \"Set as Background\" to use it, or upload your own image using the upload button.',\n    defaultValue: '',\n    versionAdded: '1.20.4',\n    versionModified: '1.20.5'\n  },\n  // Release data stored in settings\n  {\n    id: 'Comfy.Release.Version',\n    name: 'Last seen release version',\n    type: 'hidden',\n    defaultValue: ''\n  },\n  {\n    id: 'Comfy.Release.Status',\n    name: 'Release status',\n    type: 'hidden',\n    defaultValue: 'skipped'\n  },\n  {\n    id: 'Comfy.Release.Timestamp',\n    name: 'Release seen timestamp',\n    type: 'hidden',\n    defaultValue: 0\n  },\n\n  /**\n   * Template Library Filter Settings\n   */\n  {\n    id: 'Comfy.Templates.SelectedModels',\n    name: 'Template library - Selected model filters',\n    type: 'hidden',\n    defaultValue: []\n  },\n  {\n    id: 'Comfy.Templates.SelectedUseCases',\n    name: 'Template library - Selected use case filters',\n    type: 'hidden',\n    defaultValue: []\n  },\n  {\n    id: 'Comfy.Templates.SelectedRunsOn',\n    name: 'Template library - Selected runs on filters',\n    type: 'hidden',\n    defaultValue: []\n  },\n  {\n    id: 'Comfy.Templates.SortBy',\n    name: 'Template library - Sort preference',\n    type: 'hidden',\n    defaultValue: 'newest'\n  },\n\n  /**\n   * Vue Node System Settings\n   */\n  {\n    id: 'Comfy.VueNodes.Enabled',\n    name: 'Modern Node Design (Vue Nodes)',\n    type: 'boolean',\n    tooltip:\n      'Modern: DOM-based rendering with enhanced interactivity, native browser features, and updated visual design. Classic: Traditional canvas rendering.',\n    defaultValue: false,\n    experimental: true,\n    versionAdded: '1.27.1'\n  },\n  {\n    id: 'Comfy.VueNodes.AutoScaleLayout',\n    name: 'Auto-scale layout (Vue nodes)',\n    tooltip:\n      'Automatically scale node positions when switching to Vue rendering to prevent overlap',\n    type: 'boolean',\n    experimental: true,\n    defaultValue: true,\n    versionAdded: '1.30.3'\n  },\n  {\n    id: 'Comfy.Assets.UseAssetAPI',\n    name: 'Use Asset API for model library',\n    type: 'hidden',\n    tooltip: 'Use new Asset API for model browsing',\n    defaultValue: isCloud ? true : false,\n    experimental: true\n  }\n]\n","import { computed, onUnmounted, watch } from 'vue'\n\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useWorkflowService } from '@/platform/workflow/core/services/workflowService'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { api } from '@/scripts/api'\n\nexport function useWorkflowAutoSave() {\n  const workflowStore = useWorkflowStore()\n  const settingStore = useSettingStore()\n  const workflowService = useWorkflowService()\n\n  // Use computed refs to cache autosave settings\n  const autoSaveSetting = computed(() =>\n    settingStore.get('Comfy.Workflow.AutoSave')\n  )\n  const autoSaveDelay = computed(() =>\n    settingStore.get('Comfy.Workflow.AutoSaveDelay')\n  )\n\n  let autoSaveTimeout: NodeJS.Timeout | null = null\n  let isSaving = false\n  let needsAutoSave = false\n\n  const scheduleAutoSave = () => {\n    // Clear any existing timeout\n    if (autoSaveTimeout) {\n      clearTimeout(autoSaveTimeout)\n      autoSaveTimeout = null\n    }\n\n    // If autosave is enabled\n    if (autoSaveSetting.value === 'after delay') {\n      // If a save is in progress, mark that we need an autosave after saving\n      if (isSaving) {\n        needsAutoSave = true\n        return\n      }\n      const delay = autoSaveDelay.value\n      autoSaveTimeout = setTimeout(async () => {\n        const activeWorkflow = workflowStore.activeWorkflow\n        if (activeWorkflow?.isModified && activeWorkflow.isPersisted) {\n          try {\n            isSaving = true\n            await workflowService.saveWorkflow(activeWorkflow)\n          } catch (err) {\n            console.error('Auto save failed:', err)\n          } finally {\n            isSaving = false\n            if (needsAutoSave) {\n              needsAutoSave = false\n              scheduleAutoSave()\n            }\n          }\n        }\n      }, delay)\n    }\n  }\n\n  // Watch for autosave setting changes\n  watch(\n    autoSaveSetting,\n    (newSetting) => {\n      // Clear any existing timeout when settings change\n      if (autoSaveTimeout) {\n        clearTimeout(autoSaveTimeout)\n        autoSaveTimeout = null\n      }\n\n      // If there's an active modified workflow and autosave is enabled, schedule a save\n      if (\n        newSetting === 'after delay' &&\n        workflowStore.activeWorkflow?.isModified\n      ) {\n        scheduleAutoSave()\n      }\n    },\n    { immediate: true }\n  )\n\n  // Listen for graph changes and schedule autosave when they occur\n  const onGraphChanged = () => {\n    scheduleAutoSave()\n  }\n\n  api.addEventListener('graphChanged', onGraphChanged)\n\n  onUnmounted(() => {\n    if (autoSaveTimeout) {\n      clearTimeout(autoSaveTimeout)\n      autoSaveTimeout = null\n    }\n    api.removeEventListener('graphChanged', onGraphChanged)\n  })\n}\n","import { useToast } from 'primevue/usetoast'\nimport { useI18n } from 'vue-i18n'\nimport { useRoute, useRouter } from 'vue-router'\n\nimport { clearPreservedQuery } from '@/platform/navigation/preservedQueryManager'\nimport { PRESERVED_QUERY_NAMESPACES } from '@/platform/navigation/preservedQueryNamespaces'\n\nimport { useTemplateWorkflows } from './useTemplateWorkflows'\n\n/**\n * Composable for loading templates from URL query parameters\n *\n * Supports URLs like:\n * - /?template=flux_simple (loads with default source)\n * - /?template=flux_simple&source=custom (loads from custom source)\n *\n * Input validation:\n * - Template and source parameters must match: ^[a-zA-Z0-9_-]+$\n * - Invalid formats are rejected with console warnings\n */\nexport function useTemplateUrlLoader() {\n  const route = useRoute()\n  const router = useRouter()\n  const { t } = useI18n()\n  const toast = useToast()\n  const templateWorkflows = useTemplateWorkflows()\n  const TEMPLATE_NAMESPACE = PRESERVED_QUERY_NAMESPACES.TEMPLATE\n\n  /**\n   * Validates parameter format to prevent path traversal and injection attacks\n   */\n  const isValidParameter = (param: string): boolean => {\n    return /^[a-zA-Z0-9_-]+$/.test(param)\n  }\n\n  /**\n   * Removes template and source parameters from URL\n   */\n  const cleanupUrlParams = () => {\n    const newQuery = { ...route.query }\n    delete newQuery.template\n    delete newQuery.source\n    void router.replace({ query: newQuery })\n  }\n\n  /**\n   * Loads template from URL query parameters if present\n   * Handles errors internally and shows appropriate user feedback\n   */\n  const loadTemplateFromUrl = async () => {\n    const templateParam = route.query.template\n\n    if (!templateParam || typeof templateParam !== 'string') {\n      return\n    }\n\n    if (!isValidParameter(templateParam)) {\n      console.warn(\n        `[useTemplateUrlLoader] Invalid template parameter format: ${templateParam}`\n      )\n      return\n    }\n\n    const sourceParam = (route.query.source as string | undefined) || 'default'\n\n    if (!isValidParameter(sourceParam)) {\n      console.warn(\n        `[useTemplateUrlLoader] Invalid source parameter format: ${sourceParam}`\n      )\n      return\n    }\n\n    try {\n      await templateWorkflows.loadTemplates()\n\n      const success = await templateWorkflows.loadWorkflowTemplate(\n        templateParam,\n        sourceParam\n      )\n\n      if (!success) {\n        toast.add({\n          severity: 'error',\n          summary: t('g.error'),\n          detail: t('templateWorkflows.error.templateNotFound', {\n            templateName: templateParam\n          }),\n          life: 3000\n        })\n      }\n    } catch (error) {\n      console.error(\n        '[useTemplateUrlLoader] Failed to load template from URL:',\n        error\n      )\n      toast.add({\n        severity: 'error',\n        summary: t('g.error'),\n        detail: t('g.errorLoadingTemplate'),\n        life: 3000\n      })\n    } finally {\n      cleanupUrlParams()\n      clearPreservedQuery(TEMPLATE_NAMESPACE)\n    }\n  }\n\n  return {\n    loadTemplateFromUrl\n  }\n}\n","import { tryOnScopeDispose } from '@vueuse/core'\nimport { computed, watch } from 'vue'\nimport { useRoute, useRouter } from 'vue-router'\n\nimport {\n  hydratePreservedQuery,\n  mergePreservedQueryIntoQuery\n} from '@/platform/navigation/preservedQueryManager'\nimport { PRESERVED_QUERY_NAMESPACES } from '@/platform/navigation/preservedQueryNamespaces'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useWorkflowService } from '@/platform/workflow/core/services/workflowService'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { useTemplateUrlLoader } from '@/platform/workflow/templates/composables/useTemplateUrlLoader'\nimport { api } from '@/scripts/api'\nimport { app as comfyApp } from '@/scripts/app'\nimport { getStorageValue, setStorageValue } from '@/scripts/utils'\nimport { useCommandStore } from '@/stores/commandStore'\n\nexport function useWorkflowPersistence() {\n  const workflowStore = useWorkflowStore()\n  const settingStore = useSettingStore()\n  const route = useRoute()\n  const router = useRouter()\n  const templateUrlLoader = useTemplateUrlLoader()\n  const TEMPLATE_NAMESPACE = PRESERVED_QUERY_NAMESPACES.TEMPLATE\n\n  const ensureTemplateQueryFromIntent = async () => {\n    hydratePreservedQuery(TEMPLATE_NAMESPACE)\n    const mergedQuery = mergePreservedQueryIntoQuery(\n      TEMPLATE_NAMESPACE,\n      route.query\n    )\n\n    if (mergedQuery) {\n      await router.replace({ query: mergedQuery })\n    }\n\n    return mergedQuery ?? route.query\n  }\n\n  const workflowPersistenceEnabled = computed(() =>\n    settingStore.get('Comfy.Workflow.Persist')\n  )\n\n  const persistCurrentWorkflow = () => {\n    if (!workflowPersistenceEnabled.value) return\n    const workflow = JSON.stringify(comfyApp.graph.serialize())\n\n    try {\n      localStorage.setItem('workflow', workflow)\n      if (api.clientId) {\n        sessionStorage.setItem(`workflow:${api.clientId}`, workflow)\n      }\n    } catch (error) {\n      // Only log our own keys and aggregate stats\n      const ourKeys = Object.keys(sessionStorage).filter(\n        (key) => key.startsWith('workflow:') || key === 'workflow'\n      )\n      console.error('QuotaExceededError details:', {\n        workflowSizeKB: Math.round(workflow.length / 1024),\n        totalStorageItems: Object.keys(sessionStorage).length,\n        ourWorkflowKeys: ourKeys.length,\n        ourWorkflowSizes: ourKeys.map((key) => ({\n          key,\n          sizeKB: Math.round(sessionStorage[key].length / 1024)\n        })),\n        error: error instanceof Error ? error.message : String(error)\n      })\n      throw error\n    }\n  }\n\n  const loadWorkflowFromStorage = async (\n    json: string | null,\n    workflowName: string | null\n  ) => {\n    if (!json) return false\n    const workflow = JSON.parse(json)\n    await comfyApp.loadGraphData(workflow, true, true, workflowName)\n    return true\n  }\n\n  const loadPreviousWorkflowFromStorage = async () => {\n    const workflowName = getStorageValue('Comfy.PreviousWorkflow')\n    const clientId = api.initialClientId ?? api.clientId\n\n    // Try loading from session storage first\n    if (clientId) {\n      const sessionWorkflow = sessionStorage.getItem(`workflow:${clientId}`)\n      if (await loadWorkflowFromStorage(sessionWorkflow, workflowName)) {\n        return true\n      }\n    }\n\n    // Fall back to local storage\n    const localWorkflow = localStorage.getItem('workflow')\n    return await loadWorkflowFromStorage(localWorkflow, workflowName)\n  }\n\n  const loadDefaultWorkflow = async () => {\n    if (!settingStore.get('Comfy.TutorialCompleted')) {\n      await settingStore.set('Comfy.TutorialCompleted', true)\n      await useWorkflowService().loadBlankWorkflow()\n      await useCommandStore().execute('Comfy.BrowseTemplates')\n    } else {\n      await comfyApp.loadGraphData()\n    }\n  }\n\n  const initializeWorkflow = async () => {\n    if (!workflowPersistenceEnabled.value) return\n\n    try {\n      const restored = await loadPreviousWorkflowFromStorage()\n      if (!restored) {\n        await loadDefaultWorkflow()\n      }\n    } catch (err) {\n      console.error('Error loading previous workflow', err)\n      await loadDefaultWorkflow()\n    }\n  }\n\n  const loadTemplateFromUrlIfPresent = async () => {\n    const query = await ensureTemplateQueryFromIntent()\n    const hasTemplateUrl = query.template && typeof query.template === 'string'\n\n    if (hasTemplateUrl) {\n      await templateUrlLoader.loadTemplateFromUrl()\n    }\n  }\n\n  // Setup watchers\n  watch(\n    () => workflowStore.activeWorkflow?.key,\n    (activeWorkflowKey) => {\n      if (!activeWorkflowKey) return\n      setStorageValue('Comfy.PreviousWorkflow', activeWorkflowKey)\n      // When the activeWorkflow changes, the graph has already been loaded.\n      // Saving the current state of the graph to the localStorage.\n      persistCurrentWorkflow()\n    }\n  )\n  api.addEventListener('graphChanged', persistCurrentWorkflow)\n\n  // Clean up event listener when component unmounts\n  tryOnScopeDispose(() => {\n    api.removeEventListener('graphChanged', persistCurrentWorkflow)\n  })\n\n  // Restore workflow tabs states\n  const openWorkflows = computed(() => workflowStore.openWorkflows)\n  const activeWorkflow = computed(() => workflowStore.activeWorkflow)\n  const restoreState = computed<{ paths: string[]; activeIndex: number }>(\n    () => {\n      if (!openWorkflows.value || !activeWorkflow.value) {\n        return { paths: [], activeIndex: -1 }\n      }\n\n      const paths = openWorkflows.value\n        .filter((workflow) => workflow?.isPersisted)\n        .map((workflow) => workflow.path)\n      const activeIndex = openWorkflows.value.findIndex(\n        (workflow) => workflow.path === activeWorkflow.value?.path\n      )\n\n      return { paths, activeIndex }\n    }\n  )\n\n  // Get storage values before setting watchers\n  const storedWorkflows = JSON.parse(\n    getStorageValue('Comfy.OpenWorkflowsPaths') || '[]'\n  )\n  const storedActiveIndex = JSON.parse(\n    getStorageValue('Comfy.ActiveWorkflowIndex') || '-1'\n  )\n\n  watch(restoreState, ({ paths, activeIndex }) => {\n    if (workflowPersistenceEnabled.value) {\n      setStorageValue('Comfy.OpenWorkflowsPaths', JSON.stringify(paths))\n      setStorageValue('Comfy.ActiveWorkflowIndex', JSON.stringify(activeIndex))\n    }\n  })\n\n  const restoreWorkflowTabsState = () => {\n    if (!workflowPersistenceEnabled.value) return\n    const isRestorable = storedWorkflows?.length > 0 && storedActiveIndex >= 0\n    if (isRestorable) {\n      workflowStore.openWorkflowsInBackground({\n        left: storedWorkflows.slice(0, storedActiveIndex),\n        right: storedWorkflows.slice(storedActiveIndex)\n      })\n    }\n  }\n\n  return {\n    initializeWorkflow,\n    loadTemplateFromUrlIfPresent,\n    restoreWorkflowTabsState\n  }\n}\n","import type { InjectionKey } from 'vue'\n\nimport type { useTransformState } from '@/renderer/core/layout/transform/useTransformState'\n\n/**\n * Lightweight, injectable transform state used by layout-aware components.\n *\n * Consumers use this interface to convert coordinates between LiteGraph's\n * canvas space and the DOM's screen space, access the current pan/zoom\n * (camera), and perform basic viewport culling checks.\n *\n * Coordinate mapping:\n * - screen = (canvas + offset) * scale\n * - canvas = screen / scale - offset\n *\n * The full implementation and additional helpers live in\n * `useTransformState()`. This interface deliberately exposes only the\n * minimal surface needed outside that composable.\n *\n * @example\n * const state = inject(TransformStateKey)!\n * const screen = state.canvasToScreen({ x: 100, y: 50 })\n */\nexport interface TransformState\n  extends Pick<\n    ReturnType<typeof useTransformState>,\n    'screenToCanvas' | 'canvasToScreen' | 'camera' | 'isNodeInViewport'\n  > {}\n\nexport const TransformStateKey: InjectionKey<TransformState> =\n  Symbol('transformState')\n","import { useDebounceFn, useEventListener } from '@vueuse/core'\nimport { ref } from 'vue'\nimport type { MaybeRefOrGetter } from 'vue'\n\ninterface TransformSettlingOptions {\n  /**\n   * Delay in ms before transform is considered \"settled\" after last interaction\n   * @default 200\n   */\n  settleDelay?: number\n  /**\n   * Whether to use passive event listeners (better performance but can't preventDefault)\n   * @default true\n   */\n  passive?: boolean\n}\n\n/**\n * Tracks when canvas zoom transforms are actively changing vs settled.\n *\n * This composable helps optimize rendering quality during zoom transformations.\n * When the user is actively zooming, we can reduce rendering quality\n * for better performance. Once the transform \"settles\" (stops changing), we can\n * trigger high-quality re-rasterization.\n *\n * The settling concept prevents constant quality switching during interactions\n * by waiting for a period of inactivity before considering the transform complete.\n *\n * Uses VueUse's useEventListener for automatic cleanup and useDebounceFn for\n * efficient settle detection.\n *\n * @example\n * ```ts\n * const { isTransforming } = useTransformSettling(canvasRef, {\n *   settleDelay: 200\n * })\n *\n * // Use in CSS classes or rendering logic\n * const cssClass = computed(() => ({\n *   'low-quality': isTransforming.value,\n *   'high-quality': !isTransforming.value\n * }))\n * ```\n */\nexport function useTransformSettling(\n  target: MaybeRefOrGetter<HTMLElement | null | undefined>,\n  options: TransformSettlingOptions = {}\n) {\n  const { settleDelay = 200, passive = true } = options\n\n  const isTransforming = ref(false)\n\n  /**\n   * Mark transform as active\n   */\n  const markTransformActive = () => {\n    isTransforming.value = true\n  }\n\n  /**\n   * Mark transform as settled (debounced)\n   */\n  const markTransformSettled = useDebounceFn(() => {\n    isTransforming.value = false\n  }, settleDelay)\n\n  /**\n   * Handle zoom transform event - mark active then queue settle\n   */\n  const handleWheel = () => {\n    markTransformActive()\n    void markTransformSettled()\n  }\n\n  // Register wheel event listener with auto-cleanup\n  useEventListener(target, 'wheel', handleWheel, {\n    capture: true,\n    passive\n  })\n\n  return {\n    isTransforming\n  }\n}\n","/**\n * Composable for managing transform state synchronized with LiteGraph canvas\n *\n * This composable is a critical part of the hybrid rendering architecture that\n * allows Vue components to render in perfect alignment with LiteGraph's canvas.\n *\n * ## Core Concept\n *\n * LiteGraph uses a canvas for rendering connections, grid, and handling interactions.\n * Vue components need to render nodes on top of this canvas. The challenge is\n * synchronizing the coordinate systems:\n *\n * - LiteGraph: Uses canvas coordinates with its own transform matrix\n * - Vue/DOM: Uses screen coordinates with CSS transforms\n *\n * ## Solution: Transform Container Pattern\n *\n * Instead of transforming individual nodes (O(n) complexity), we:\n * 1. Mirror LiteGraph's transform matrix to a single CSS container\n * 2. Place all Vue nodes as children with simple absolute positioning\n * 3. Achieve O(1) transform updates regardless of node count\n *\n * ## Coordinate Systems\n *\n * - **Canvas coordinates**: LiteGraph's internal coordinate system\n * - **Screen coordinates**: Browser's viewport coordinate system\n * - **Transform sync**: camera.x/y/z mirrors canvas.ds.offset/scale\n *\n * ## Performance Benefits\n *\n * - GPU acceleration via CSS transforms\n * - No layout thrashing (only transform changes)\n * - Efficient viewport culling calculations\n * - Scales to 1000+ nodes while maintaining 60 FPS\n *\n * @example\n * ```typescript\n * const { camera, transformStyle, canvasToScreen } = useTransformState()\n *\n * // In template\n * <div :style=\"transformStyle\">\n *   <NodeComponent\n *     v-for=\"node in nodes\"\n *     :style=\"{ left: node.x + 'px', top: node.y + 'px' }\"\n *   />\n * </div>\n *\n * // Convert coordinates\n * const screenPos = canvasToScreen({ x: nodeX, y: nodeY })\n * ```\n */\nimport { computed, reactive, readonly } from 'vue'\n\nimport type { LGraphCanvas } from '@/lib/litegraph/src/litegraph'\n\ninterface Point {\n  x: number\n  y: number\n}\n\ninterface Camera {\n  x: number\n  y: number\n  z: number // scale/zoom\n}\n\nexport const useTransformState = () => {\n  // Reactive state mirroring LiteGraph's canvas transform\n  const camera = reactive<Camera>({\n    x: 0,\n    y: 0,\n    z: 1\n  })\n\n  // Computed transform string for CSS\n  const transformStyle = computed(() => ({\n    // Match LiteGraph DragAndScale.toCanvasContext():\n    // ctx.scale(scale); ctx.translate(offset)\n    // CSS applies right-to-left, so \"scale() translate()\" -> translate first, then scale\n    // Effective mapping: screen = (canvas + offset) * scale\n    transform: `scale(${camera.z}) translate(${camera.x}px, ${camera.y}px)`,\n    transformOrigin: '0 0'\n  }))\n\n  /**\n   * Synchronizes Vue's reactive camera state with LiteGraph's canvas transform\n   *\n   * Called every frame via RAF to ensure Vue components stay aligned with canvas.\n   * This is the heart of the hybrid rendering system - it bridges the gap between\n   * LiteGraph's canvas transforms and Vue's reactive system.\n   *\n   * @param canvas - LiteGraph canvas instance with DragAndScale (ds) transform state\n   */\n  const syncWithCanvas = (canvas: LGraphCanvas) => {\n    if (!canvas || !canvas.ds) return\n\n    // Mirror LiteGraph's transform state to Vue's reactive state\n    // ds.offset = pan offset, ds.scale = zoom level\n    camera.x = canvas.ds.offset[0]\n    camera.y = canvas.ds.offset[1]\n    camera.z = canvas.ds.scale || 1\n  }\n\n  /**\n   * Converts canvas coordinates to screen coordinates\n   *\n   * Applies the same transform that LiteGraph uses for rendering.\n   * Essential for positioning Vue components to align with canvas elements.\n   *\n   * Formula: screen = (canvas + offset) * scale\n   *\n   * @param point - Point in canvas coordinate system\n   * @returns Point in screen coordinate system\n   */\n  const canvasToScreen = (point: Point): Point => {\n    return {\n      x: (point.x + camera.x) * camera.z,\n      y: (point.y + camera.y) * camera.z\n    }\n  }\n\n  /**\n   * Converts screen coordinates to canvas coordinates\n   *\n   * Inverse of canvasToScreen. Useful for hit testing and converting\n   * mouse events back to canvas space.\n   *\n   * Formula: canvas = screen / scale - offset\n   *\n   * @param point - Point in screen coordinate system\n   * @returns Point in canvas coordinate system\n   */\n  const screenToCanvas = (point: Point): Point => {\n    return {\n      x: point.x / camera.z - camera.x,\n      y: point.y / camera.z - camera.y\n    }\n  }\n\n  // Get node's screen bounds for culling\n  const getNodeScreenBounds = (\n    pos: ArrayLike<number>,\n    size: ArrayLike<number>\n  ): DOMRect => {\n    const topLeft = canvasToScreen({ x: pos[0], y: pos[1] })\n    const width = size[0] * camera.z\n    const height = size[1] * camera.z\n\n    return new DOMRect(topLeft.x, topLeft.y, width, height)\n  }\n\n  // Helper: Calculate zoom-adjusted margin for viewport culling\n  const calculateAdjustedMargin = (baseMargin: number): number => {\n    if (camera.z < 0.1) return Math.min(baseMargin * 5, 2.0)\n    if (camera.z > 3.0) return Math.max(baseMargin * 0.5, 0.05)\n    return baseMargin\n  }\n\n  // Helper: Check if node is too small to be visible at current zoom\n  const isNodeTooSmall = (nodeSize: ArrayLike<number>): boolean => {\n    const nodeScreenSize = Math.max(nodeSize[0], nodeSize[1]) * camera.z\n    return nodeScreenSize < 4\n  }\n\n  // Helper: Calculate expanded viewport bounds with margin\n  const getExpandedViewportBounds = (\n    viewport: { width: number; height: number },\n    margin: number\n  ) => {\n    const marginX = viewport.width * margin\n    const marginY = viewport.height * margin\n    return {\n      left: -marginX,\n      right: viewport.width + marginX,\n      top: -marginY,\n      bottom: viewport.height + marginY\n    }\n  }\n\n  // Helper: Test if node intersects with viewport bounds\n  const testViewportIntersection = (\n    screenPos: { x: number; y: number },\n    nodeSize: ArrayLike<number>,\n    bounds: { left: number; right: number; top: number; bottom: number }\n  ): boolean => {\n    const nodeRight = screenPos.x + nodeSize[0] * camera.z\n    const nodeBottom = screenPos.y + nodeSize[1] * camera.z\n\n    return !(\n      nodeRight < bounds.left ||\n      screenPos.x > bounds.right ||\n      nodeBottom < bounds.top ||\n      screenPos.y > bounds.bottom\n    )\n  }\n\n  // Check if node is within viewport with frustum and size-based culling\n  const isNodeInViewport = (\n    nodePos: ArrayLike<number>,\n    nodeSize: ArrayLike<number>,\n    viewport: { width: number; height: number },\n    margin: number = 0.2\n  ): boolean => {\n    // Early exit for tiny nodes\n    if (isNodeTooSmall(nodeSize)) return false\n\n    const screenPos = canvasToScreen({ x: nodePos[0], y: nodePos[1] })\n    const adjustedMargin = calculateAdjustedMargin(margin)\n    const bounds = getExpandedViewportBounds(viewport, adjustedMargin)\n\n    return testViewportIntersection(screenPos, nodeSize, bounds)\n  }\n\n  // Get viewport bounds in canvas coordinates (for spatial index queries)\n  const getViewportBounds = (\n    viewport: { width: number; height: number },\n    margin: number = 0.2\n  ) => {\n    const marginX = viewport.width * margin\n    const marginY = viewport.height * margin\n\n    const topLeft = screenToCanvas({ x: -marginX, y: -marginY })\n    const bottomRight = screenToCanvas({\n      x: viewport.width + marginX,\n      y: viewport.height + marginY\n    })\n\n    return {\n      x: topLeft.x,\n      y: topLeft.y,\n      width: bottomRight.x - topLeft.x,\n      height: bottomRight.y - topLeft.y\n    }\n  }\n\n  return {\n    camera: readonly(camera),\n    transformStyle,\n    syncWithCanvas,\n    canvasToScreen,\n    screenToCanvas,\n    getNodeScreenBounds,\n    isNodeInViewport,\n    getViewportBounds\n  }\n}\n","/**\n * Level of Detail (LOD) composable for Vue-based node rendering\n *\n * Provides dynamic quality adjustment based on zoom level to maintain\n * performance with large node graphs. Uses zoom threshold based on DPR\n * to determine how much detail to render for each node component.\n * Default minFontSize = 8px\n * Default zoomThreshold = 0.57 (On a DPR = 1 monitor)\n **/\nimport { useDevicePixelRatio } from '@vueuse/core'\nimport { computed } from 'vue'\n\nimport { useSettingStore } from '@/platform/settings/settingStore'\n\ninterface Camera {\n  z: number // zoom level\n}\n\nexport function useLOD(camera: Camera) {\n  const isLOD = computed(() => {\n    const { pixelRatio } = useDevicePixelRatio()\n    const baseFontSize = 14\n    const dprAdjustment = Math.sqrt(pixelRatio.value)\n\n    const settingStore = useSettingStore()\n    const minFontSize = settingStore.get('LiteGraph.Canvas.MinFontSizeForLOD') //default 8\n    const threshold =\n      Math.round((minFontSize / (baseFontSize * dprAdjustment)) * 100) / 100 //round to 2 decimal places i.e 0.86\n\n    return camera.z < threshold\n  })\n\n  return { isLOD }\n}\n","<template>\n  <div\n    data-testid=\"transform-pane\"\n    :class=\"\n      cn(\n        'absolute inset-0 w-full h-full pointer-events-none',\n        isInteracting ? 'transform-pane--interacting' : 'will-change-auto',\n        isLOD && 'isLOD'\n      )\n    \"\n    :style=\"transformStyle\"\n  >\n    <!-- Vue nodes will be rendered here -->\n    <slot />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useRafFn } from '@vueuse/core'\nimport { computed, provide } from 'vue'\n\nimport type { LGraphCanvas } from '@/lib/litegraph/src/litegraph'\nimport { TransformStateKey } from '@/renderer/core/layout/injectionKeys'\nimport { useTransformSettling } from '@/renderer/core/layout/transform/useTransformSettling'\nimport { useTransformState } from '@/renderer/core/layout/transform/useTransformState'\nimport { useLOD } from '@/renderer/extensions/vueNodes/lod/useLOD'\nimport { cn } from '@/utils/tailwindUtil'\n\ninterface TransformPaneProps {\n  canvas?: LGraphCanvas\n}\n\nconst props = defineProps<TransformPaneProps>()\n\nconst {\n  camera,\n  transformStyle,\n  syncWithCanvas,\n  canvasToScreen,\n  screenToCanvas,\n  isNodeInViewport\n} = useTransformState()\n\nconst { isLOD } = useLOD(camera)\n\nconst canvasElement = computed(() => props.canvas?.canvas)\nconst { isTransforming: isInteracting } = useTransformSettling(canvasElement, {\n  settleDelay: 512\n})\n\nprovide(TransformStateKey, {\n  camera,\n  canvasToScreen,\n  screenToCanvas,\n  isNodeInViewport\n})\n\nconst emit = defineEmits<{\n  transformUpdate: []\n}>()\n\nuseRafFn(\n  () => {\n    if (!props.canvas) {\n      return\n    }\n    syncWithCanvas(props.canvas)\n    emit('transformUpdate')\n  },\n  { immediate: true }\n)\n</script>\n\n<style scoped>\n.transform-pane--interacting {\n  will-change: transform;\n}\n</style>\n","<template>\n  <div\n    v-if=\"visible && initialized\"\n    ref=\"minimapRef\"\n    class=\"minimap-main-container absolute right-0 bottom-[54px] z-1000 flex\"\n  >\n    <MiniMapPanel\n      v-if=\"showOptionsPanel\"\n      :panel-styles=\"panelStyles\"\n      :node-colors=\"nodeColors\"\n      :show-links=\"showLinks\"\n      :show-groups=\"showGroups\"\n      :render-bypass=\"renderBypass\"\n      :render-error=\"renderError\"\n      @update-option=\"updateOption\"\n    />\n\n    <div\n      ref=\"containerRef\"\n      class=\"litegraph-minimap relative border border-interface-stroke bg-comfy-menu-bg shadow-interface\"\n      :style=\"containerStyles\"\n    >\n      <Button\n        class=\"absolute top-1 left-1 z-10 hover:bg-interface-button-hover-surface!\"\n        size=\"small\"\n        text\n        severity=\"secondary\"\n        @click.stop=\"toggleOptionsPanel\"\n      >\n        <template #icon>\n          <i class=\"icon-[lucide--settings-2]\" />\n        </template>\n      </Button>\n      <Button\n        class=\"absolute top-1 right-1 z-10 hover:bg-interface-button-hover-surface!\"\n        size=\"small\"\n        text\n        severity=\"secondary\"\n        data-testid=\"close-minmap-button\"\n        @click.stop=\"() => commandStore.execute('Comfy.Canvas.ToggleMinimap')\"\n      >\n        <template #icon>\n          <i class=\"icon-[lucide--x]\" />\n        </template>\n      </Button>\n\n      <hr\n        class=\"absolute top-7 h-px border-0 bg-node-component-border\"\n        :style=\"{\n          width: containerStyles.width\n        }\"\n      />\n\n      <canvas\n        ref=\"canvasRef\"\n        :width=\"width\"\n        :height=\"height\"\n        class=\"minimap-canvas\"\n      />\n\n      <div class=\"minimap-viewport\" :style=\"viewportStyles\" />\n\n      <div\n        class=\"absolute inset-0 touch-none\"\n        @pointerdown=\"handlePointerDown\"\n        @pointermove=\"handlePointerMove\"\n        @pointerup=\"handlePointerUp\"\n        @pointerleave=\"handlePointerUp\"\n        @pointercancel=\"handlePointerCancel\"\n        @wheel=\"handleWheel\"\n      />\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport Button from 'primevue/button'\nimport { onMounted, onUnmounted, ref } from 'vue'\n\nimport { useMinimap } from '@/renderer/extensions/minimap/composables/useMinimap'\nimport { useCommandStore } from '@/stores/commandStore'\n\nimport MiniMapPanel from './MiniMapPanel.vue'\n\nconst commandStore = useCommandStore()\n\nconst minimapRef = ref<HTMLDivElement>()\n\nconst {\n  initialized,\n  visible,\n  containerRef,\n  canvasRef,\n  containerStyles,\n  viewportStyles,\n  width,\n  height,\n  panelStyles,\n  nodeColors,\n  showLinks,\n  showGroups,\n  renderBypass,\n  renderError,\n  updateOption,\n  destroy,\n  handlePointerDown,\n  handlePointerMove,\n  handlePointerUp,\n  handlePointerCancel,\n  handleWheel,\n  setMinimapRef\n} = useMinimap()\n\nconst showOptionsPanel = ref(false)\n\nconst toggleOptionsPanel = () => {\n  showOptionsPanel.value = !showOptionsPanel.value\n}\n\nonMounted(() => {\n  if (minimapRef.value) {\n    setMinimapRef(minimapRef.value)\n  }\n})\n\nonUnmounted(() => {\n  destroy()\n})\n</script>\n\n<style scoped>\n.litegraph-minimap {\n  overflow: hidden;\n}\n\n.minimap-canvas {\n  display: block;\n  width: 100%;\n  height: 100%;\n  pointer-events: none;\n}\n\n.minimap-viewport {\n  position: absolute;\n  top: 0;\n  left: 0;\n  pointer-events: none;\n}\n</style>\n","/**\n * Node Z-Index Management Composable\n *\n * Provides focused functionality for managing node layering through z-index.\n * Integrates with the layout system to ensure proper visual ordering.\n */\nimport type { NodeId } from '@/platform/workflow/validation/schemas/workflowSchema'\nimport { useLayoutMutations } from '@/renderer/core/layout/operations/layoutMutations'\nimport { LayoutSource } from '@/renderer/core/layout/types'\n\ninterface NodeZIndexOptions {\n  /**\n   * Layout source for z-index mutations\n   * @default LayoutSource.Vue\n   */\n  layoutSource?: LayoutSource\n}\n\nexport function useNodeZIndex(options: NodeZIndexOptions = {}) {\n  const { layoutSource = LayoutSource.Vue } = options\n  const layoutMutations = useLayoutMutations()\n\n  /**\n   * Bring node to front (highest z-index)\n   * @param nodeId - The node to bring to front\n   * @param source - Optional source override\n   */\n  function bringNodeToFront(nodeId: NodeId, source?: LayoutSource) {\n    layoutMutations.setSource(source ?? layoutSource)\n    layoutMutations.bringNodeToFront(nodeId)\n  }\n\n  return {\n    bringNodeToFront\n  }\n}\n","/**\n * Node Event Handlers Composable\n *\n * Handles all Vue node interaction events including:\n * - Node selection with multi-select support\n * - Node collapse/expand state management\n * - Node title editing and updates\n * - Layout mutations for visual feedback\n * - Integration with LiteGraph canvas selection system\n */\nimport { createSharedComposable } from '@vueuse/core'\n\nimport type { VueNodeData } from '@/composables/graph/useGraphNodeManager'\nimport { useVueNodeLifecycle } from '@/composables/graph/useVueNodeLifecycle'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useCanvasInteractions } from '@/renderer/core/canvas/useCanvasInteractions'\nimport { useNodeZIndex } from '@/renderer/extensions/vueNodes/composables/useNodeZIndex'\nimport { isLGraphNode } from '@/utils/litegraphUtil'\n\n/**\n * Check if multiple nodes are selected\n * Optimized to return early when 2+ nodes found\n */\nfunction hasMultipleNodesSelected(selectedItems: unknown[]): boolean {\n  let count = 0\n  for (let i = 0; i < selectedItems.length; i++) {\n    if (isLGraphNode(selectedItems[i])) {\n      count++\n      if (count >= 2) {\n        return true\n      }\n    }\n  }\n  return false\n}\n\nfunction useNodeEventHandlersIndividual() {\n  const canvasStore = useCanvasStore()\n  const { nodeManager } = useVueNodeLifecycle()\n  const { bringNodeToFront } = useNodeZIndex()\n  const { shouldHandleNodePointerEvents } = useCanvasInteractions()\n\n  /**\n   * Handle node selection events\n   * Supports single selection and multi-select with Ctrl/Cmd\n   */\n  const handleNodeSelect = (event: PointerEvent, nodeData: VueNodeData) => {\n    if (!shouldHandleNodePointerEvents.value) return\n\n    if (!canvasStore.canvas || !nodeManager.value) return\n\n    const node = nodeManager.value.getNode(nodeData.id)\n    if (!node) return\n\n    const isMultiSelect = event.ctrlKey || event.metaKey || event.shiftKey\n\n    if (isMultiSelect) {\n      // Ctrl/Cmd+click -> toggle selection\n      if (node.selected) {\n        canvasStore.canvas.deselect(node)\n      } else {\n        canvasStore.canvas.select(node)\n      }\n    } else {\n      const selectedMultipleNodes = hasMultipleNodesSelected(\n        canvasStore.selectedItems\n      )\n      if (!selectedMultipleNodes) {\n        // Single-select the node\n        canvasStore.canvas.deselectAll()\n        canvasStore.canvas.select(node)\n      }\n    }\n\n    // Bring node to front when clicked (similar to LiteGraph behavior)\n    // Skip if node is pinned to avoid unwanted movement\n    if (!node.flags?.pinned) {\n      bringNodeToFront(nodeData.id)\n    }\n\n    // Update canvas selection tracking\n    canvasStore.updateSelectedItems()\n  }\n\n  /**\n   * Handle node collapse/expand state changes\n   * Uses LiteGraph's native collapse method for proper state management\n   */\n  const handleNodeCollapse = (nodeId: string, collapsed: boolean) => {\n    if (!shouldHandleNodePointerEvents.value) return\n\n    if (!nodeManager.value) return\n\n    const node = nodeManager.value.getNode(nodeId)\n    if (!node) return\n\n    // Use LiteGraph's collapse method if the state needs to change\n    const currentCollapsed = node.flags?.collapsed ?? false\n    if (currentCollapsed !== collapsed) {\n      node.collapse()\n    }\n  }\n\n  /**\n   * Handle node title updates\n   * Updates the title in LiteGraph for persistence across sessions\n   */\n  const handleNodeTitleUpdate = (nodeId: string, newTitle: string) => {\n    if (!shouldHandleNodePointerEvents.value) return\n\n    if (!nodeManager.value) return\n\n    const node = nodeManager.value.getNode(nodeId)\n    if (!node) return\n\n    // Update the node title in LiteGraph for persistence\n    node.title = newTitle\n  }\n\n  /**\n   * Handle node double-click events\n   * Can be used for custom actions like opening node editor\n   */\n  const handleNodeDoubleClick = (\n    event: PointerEvent,\n    nodeData: VueNodeData\n  ) => {\n    if (!shouldHandleNodePointerEvents.value) return\n\n    if (!canvasStore.canvas || !nodeManager.value) return\n\n    const node = nodeManager.value.getNode(nodeData.id)\n    if (!node) return\n\n    // Prevent default browser behavior\n    event.preventDefault()\n\n    // TODO: add custom double-click behavior here\n    // For now, ensure node is selected\n    if (!node.selected) {\n      handleNodeSelect(event, nodeData)\n    }\n  }\n\n  /**\n   * Handle node right-click context menu events\n   * Integrates with LiteGraph's context menu system\n   */\n  const handleNodeRightClick = (event: PointerEvent, nodeData: VueNodeData) => {\n    if (!shouldHandleNodePointerEvents.value) return\n\n    if (!canvasStore.canvas || !nodeManager.value) return\n\n    const node = nodeManager.value.getNode(nodeData.id)\n    if (!node) return\n\n    // Prevent default context menu\n    event.preventDefault()\n\n    // Select the node if not already selected\n    if (!node.selected) {\n      handleNodeSelect(event, nodeData)\n    }\n\n    // Let LiteGraph handle the context menu\n    // The canvas will handle showing the appropriate context menu\n  }\n\n  /**\n   * Handle node drag start events\n   * Prepares node for dragging and sets appropriate visual state\n   */\n  const handleNodeDragStart = (event: DragEvent, nodeData: VueNodeData) => {\n    if (!shouldHandleNodePointerEvents.value) return\n\n    if (!canvasStore.canvas || !nodeManager.value) return\n\n    const node = nodeManager.value.getNode(nodeData.id)\n    if (!node) return\n\n    // Ensure node is selected before dragging\n    if (!node.selected) {\n      // Create a synthetic pointer event for selection\n      const syntheticEvent = new PointerEvent('pointerdown', {\n        ctrlKey: event.ctrlKey,\n        metaKey: event.metaKey,\n        bubbles: true\n      })\n      handleNodeSelect(syntheticEvent, nodeData)\n    }\n\n    // Set drag data for potential drop operations\n    if (event.dataTransfer) {\n      event.dataTransfer.setData('application/comfy-node-id', nodeData.id)\n      event.dataTransfer.effectAllowed = 'move'\n    }\n  }\n\n  /**\n   * Batch select multiple nodes\n   * Useful for selection toolbox or area selection\n   */\n  const selectNodes = (nodeIds: string[], addToSelection = false) => {\n    if (!shouldHandleNodePointerEvents.value) return\n\n    if (!canvasStore.canvas || !nodeManager.value) return\n\n    if (!addToSelection) {\n      canvasStore.canvas.deselectAll()\n    }\n\n    nodeIds.forEach((nodeId) => {\n      const node = nodeManager.value?.getNode(nodeId)\n      if (node && canvasStore.canvas) {\n        canvasStore.canvas.select(node)\n      }\n    })\n\n    canvasStore.updateSelectedItems()\n  }\n\n  /**\n   * Deselect specific nodes\n   */\n  const deselectNodes = (nodeIds: string[]) => {\n    if (!shouldHandleNodePointerEvents.value) return\n\n    if (!canvasStore.canvas || !nodeManager.value) return\n\n    nodeIds.forEach((nodeId) => {\n      const node = nodeManager.value?.getNode(nodeId)\n      if (node) {\n        node.selected = false\n      }\n    })\n\n    canvasStore.updateSelectedItems()\n  }\n\n  return {\n    // Core event handlers\n    handleNodeSelect,\n    handleNodeCollapse,\n    handleNodeTitleUpdate,\n    handleNodeDoubleClick,\n    handleNodeRightClick,\n    handleNodeDragStart,\n\n    // Batch operations\n    selectNodes,\n    deselectNodes\n  }\n}\n\nexport const useNodeEventHandlers = createSharedComposable(\n  useNodeEventHandlersIndividual\n)\n","import { computed } from 'vue'\n\nimport { snapPoint } from '@/lib/litegraph/src/measure'\nimport { useSettingStore } from '@/platform/settings/settingStore'\n\n/**\n * Composable for node snap-to-grid functionality\n *\n * Provides reactive access to snap settings and utilities for applying\n * snap-to-grid behavior to Vue nodes during drag and resize operations.\n */\nexport function useNodeSnap() {\n  const settingStore = useSettingStore()\n\n  // Reactive snap settings\n  const gridSize = computed(() => settingStore.get('Comfy.SnapToGrid.GridSize'))\n  const alwaysSnap = computed(() => settingStore.get('pysssss.SnapToGrid'))\n\n  /**\n   * Determines if snap-to-grid should be applied based on shift key and settings\n   * @param event - The pointer event to check for shift key\n   * @returns true if snapping should be applied\n   */\n  function shouldSnap(event: PointerEvent): boolean {\n    return event.shiftKey || alwaysSnap.value\n  }\n\n  /**\n   * Applies snap-to-grid to a position\n   * @param position - Position object with x, y coordinates\n   * @returns The snapped position as a new object\n   */\n  function applySnapToPosition(position: { x: number; y: number }): {\n    x: number\n    y: number\n  } {\n    const size = gridSize.value\n    if (!size) return { ...position }\n\n    const posArray: [number, number] = [position.x, position.y]\n    if (snapPoint(posArray, size)) {\n      return { x: posArray[0], y: posArray[1] }\n    }\n    return { ...position }\n  }\n\n  /**\n   * Applies snap-to-grid to a size (width/height)\n   * @param size - Size object with width, height\n   * @returns The snapped size as a new object\n   */\n  function applySnapToSize(size: { width: number; height: number }): {\n    width: number\n    height: number\n  } {\n    const gridSizeValue = gridSize.value\n    if (!gridSizeValue) return { ...size }\n\n    const sizeArray: [number, number] = [size.width, size.height]\n    if (snapPoint(sizeArray, gridSizeValue)) {\n      return { width: sizeArray[0], height: sizeArray[1] }\n    }\n    return { ...size }\n  }\n\n  return {\n    gridSize,\n    alwaysSnap,\n    shouldSnap,\n    applySnapToPosition,\n    applySnapToSize\n  }\n}\n","import { tryOnScopeDispose, useEventListener } from '@vueuse/core'\nimport { shallowRef } from 'vue'\n\nimport { app } from '@/scripts/app'\n\n/**\n * Composable for synchronizing shift key state from Vue nodes to LiteGraph canvas.\n *\n * Enables snap-to-grid preview rendering in LiteGraph during Vue node drag/resize operations\n * by dispatching synthetic keyboard events to the canvas element.\n *\n * @returns Object containing trackShiftKey function for shift state synchronization lifecycle\n *\n * @example\n * ```ts\n * const { trackShiftKey } = useShiftKeySync()\n *\n * function startDrag(event: PointerEvent) {\n *   const stopTracking = trackShiftKey(event)\n *   // ... drag logic\n *   // Call stopTracking() on pointerup to cleanup listeners\n * }\n * ```\n */\nexport function useShiftKeySync() {\n  const shiftKeyState = shallowRef(false)\n  let canvasEl: HTMLCanvasElement | null = null\n\n  /**\n   * Synchronizes shift key state to LiteGraph canvas by dispatching synthetic keyboard events.\n   *\n   * Only dispatches events when shift state actually changes to minimize overhead.\n   * Canvas reference is lazily initialized on first sync.\n   *\n   * @param isShiftPressed - Current shift key state to synchronize\n   */\n  function syncShiftState(isShiftPressed: boolean) {\n    if (isShiftPressed === shiftKeyState.value) return\n\n    // Lazy-initialize canvas reference on first use\n    if (!canvasEl) {\n      canvasEl = app.canvas?.canvas ?? null\n      if (!canvasEl) return // Canvas not ready yet\n    }\n\n    shiftKeyState.value = isShiftPressed\n    canvasEl.dispatchEvent(\n      new KeyboardEvent(isShiftPressed ? 'keydown' : 'keyup', {\n        key: 'Shift',\n        shiftKey: isShiftPressed,\n        bubbles: true\n      })\n    )\n  }\n\n  /**\n   * Tracks shift key state during drag/resize operations and synchronizes to canvas.\n   *\n   * Attaches window-level keyboard event listeners for the duration of the operation.\n   * Listeners are automatically cleaned up when the returned function is called.\n   *\n   * @param initialEvent - Initial pointer event containing shift key state at drag/resize start\n   * @returns Cleanup function that removes event listeners - must be called when operation ends\n   *\n   * @example\n   * ```ts\n   * function startDrag(event: PointerEvent) {\n   *   const stopTracking = trackShiftKey(event)\n   *\n   *   const handlePointerUp = () => {\n   *     stopTracking() // Cleanup listeners\n   *   }\n   * }\n   * ```\n   */\n  function trackShiftKey(initialEvent: PointerEvent): () => void {\n    // Sync initial shift state\n    syncShiftState(initialEvent.shiftKey)\n\n    // Listen for shift key press/release during the operation\n    const handleKeyEvent = (e: KeyboardEvent) => {\n      if (e.key !== 'Shift') return\n      syncShiftState(e.shiftKey)\n    }\n\n    const stopKeydown = useEventListener(window, 'keydown', handleKeyEvent, {\n      passive: true\n    })\n    const stopKeyup = useEventListener(window, 'keyup', handleKeyEvent, {\n      passive: true\n    })\n\n    // Return cleanup function that stops both listeners\n    return () => {\n      stopKeydown()\n      stopKeyup()\n    }\n  }\n\n  // Cleanup on component unmount\n  tryOnScopeDispose(() => {\n    shiftKeyState.value = false\n    canvasEl = null\n  })\n\n  return { trackShiftKey }\n}\n","import { storeToRefs } from 'pinia'\nimport { computed, inject, ref, toValue } from 'vue'\nimport type { CSSProperties, MaybeRefOrGetter } from 'vue'\n\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { TransformStateKey } from '@/renderer/core/layout/injectionKeys'\nimport { useLayoutMutations } from '@/renderer/core/layout/operations/layoutMutations'\nimport { layoutStore } from '@/renderer/core/layout/store/layoutStore'\nimport { LayoutSource } from '@/renderer/core/layout/types'\nimport type { NodeBoundsUpdate, Point } from '@/renderer/core/layout/types'\nimport { useNodeSnap } from '@/renderer/extensions/vueNodes/composables/useNodeSnap'\nimport { useShiftKeySync } from '@/renderer/extensions/vueNodes/composables/useShiftKeySync'\n\n/**\n * Composable for individual Vue node components\n * Uses customRef for shared write access with Canvas renderer\n */\nexport function useNodeLayout(nodeIdMaybe: MaybeRefOrGetter<string>) {\n  const nodeId = toValue(nodeIdMaybe)\n  const mutations = useLayoutMutations()\n  const { selectedNodeIds } = storeToRefs(useCanvasStore())\n\n  // Get transform utilities from TransformPane if available\n  const transformState = inject(TransformStateKey)\n\n  // Snap-to-grid functionality\n  const { shouldSnap, applySnapToPosition } = useNodeSnap()\n\n  // Shift key sync for LiteGraph canvas preview\n  const { trackShiftKey } = useShiftKeySync()\n\n  // Get the customRef for this node (shared write access)\n  const layoutRef = layoutStore.getNodeLayoutRef(nodeId)\n\n  // Computed properties for easy access\n  const position = computed(() => {\n    const layout = layoutRef.value\n    const pos = layout?.position ?? { x: 0, y: 0 }\n    return pos\n  })\n  const size = computed(\n    () => layoutRef.value?.size ?? { width: 200, height: 100 }\n  )\n  const bounds = computed(\n    () =>\n      layoutRef.value?.bounds ?? {\n        x: position.value.x,\n        y: position.value.y,\n        width: size.value.width,\n        height: size.value.height\n      }\n  )\n  const isVisible = computed(() => layoutRef.value?.visible ?? true)\n  const zIndex = computed(() => layoutRef.value?.zIndex ?? 0)\n\n  // Drag state\n  const isDragging = ref(false)\n  let dragStartPos: Point | null = null\n  let dragStartMouse: Point | null = null\n  let otherSelectedNodesStartPositions: Map<string, Point> | null = null\n  let rafId: number | null = null\n  let stopShiftSync: (() => void) | null = null\n\n  /**\n   * Start dragging the node\n   */\n  function startDrag(event: PointerEvent) {\n    if (!layoutRef.value || !transformState) return\n\n    // Track shift key state and sync to canvas for snap preview\n    stopShiftSync = trackShiftKey(event)\n\n    isDragging.value = true\n    dragStartPos = { ...position.value }\n    dragStartMouse = { x: event.clientX, y: event.clientY }\n\n    // capture the starting positions of all other selected nodes\n    if (selectedNodeIds?.value?.has(nodeId) && selectedNodeIds.value.size > 1) {\n      otherSelectedNodesStartPositions = new Map()\n\n      // Iterate through all selected node IDs\n      for (const id of selectedNodeIds.value) {\n        // Skip the current node being dragged\n        if (id === nodeId) continue\n\n        const nodeLayout = layoutStore.getNodeLayoutRef(id).value\n        if (nodeLayout) {\n          otherSelectedNodesStartPositions.set(id, { ...nodeLayout.position })\n        }\n      }\n    } else {\n      otherSelectedNodesStartPositions = null\n    }\n\n    // Set mutation source\n    mutations.setSource(LayoutSource.Vue)\n\n    // Capture pointer\n    if (!(event.target instanceof HTMLElement)) return\n    event.target.setPointerCapture(event.pointerId)\n  }\n\n  /**\n   * Handle drag movement\n   */\n  const handleDrag = (event: PointerEvent) => {\n    if (\n      !isDragging.value ||\n      !dragStartPos ||\n      !dragStartMouse ||\n      !transformState\n    ) {\n      return\n    }\n\n    // Throttle position updates using requestAnimationFrame for better performance\n    if (rafId !== null) return // Skip if frame already scheduled\n\n    rafId = requestAnimationFrame(() => {\n      rafId = null\n\n      if (!dragStartPos || !dragStartMouse || !transformState) return\n\n      // Calculate mouse delta in screen coordinates\n      const mouseDelta = {\n        x: event.clientX - dragStartMouse.x,\n        y: event.clientY - dragStartMouse.y\n      }\n\n      // Convert to canvas coordinates\n      const canvasOrigin = transformState.screenToCanvas({ x: 0, y: 0 })\n      const canvasWithDelta = transformState.screenToCanvas(mouseDelta)\n      const canvasDelta = {\n        x: canvasWithDelta.x - canvasOrigin.x,\n        y: canvasWithDelta.y - canvasOrigin.y\n      }\n\n      // Calculate new position for the current node\n      const newPosition = {\n        x: dragStartPos.x + canvasDelta.x,\n        y: dragStartPos.y + canvasDelta.y\n      }\n\n      // Apply mutation through the layout system (Vue batches DOM updates automatically)\n      mutations.moveNode(nodeId, newPosition)\n\n      // If we're dragging multiple selected nodes, move them all together\n      if (\n        otherSelectedNodesStartPositions &&\n        otherSelectedNodesStartPositions.size > 0\n      ) {\n        for (const [\n          otherNodeId,\n          startPos\n        ] of otherSelectedNodesStartPositions) {\n          const newOtherPosition = {\n            x: startPos.x + canvasDelta.x,\n            y: startPos.y + canvasDelta.y\n          }\n          mutations.moveNode(otherNodeId, newOtherPosition)\n        }\n      }\n    })\n  }\n\n  /**\n   * End dragging\n   */\n  function endDrag(event: PointerEvent) {\n    if (!isDragging.value) return\n\n    // Apply snap to final position if snap was active (matches LiteGraph behavior)\n    if (shouldSnap(event)) {\n      const boundsUpdates: NodeBoundsUpdate[] = []\n\n      // Snap main node\n      const currentLayout = layoutStore.getNodeLayoutRef(nodeId).value\n      if (currentLayout) {\n        const currentPos = currentLayout.position\n        const snappedPos = applySnapToPosition({ ...currentPos })\n\n        // Only add update if position actually changed\n        if (snappedPos.x !== currentPos.x || snappedPos.y !== currentPos.y) {\n          boundsUpdates.push({\n            nodeId,\n            bounds: {\n              x: snappedPos.x,\n              y: snappedPos.y,\n              width: currentLayout.size.width,\n              height: currentLayout.size.height\n            }\n          })\n        }\n      }\n\n      // Also snap other selected nodes\n      // Capture all positions at the start to ensure consistent state\n      if (\n        otherSelectedNodesStartPositions &&\n        otherSelectedNodesStartPositions.size > 0\n      ) {\n        for (const otherNodeId of otherSelectedNodesStartPositions.keys()) {\n          const nodeLayout = layoutStore.getNodeLayoutRef(otherNodeId).value\n          if (nodeLayout) {\n            const currentPos = { ...nodeLayout.position }\n            const snappedPos = applySnapToPosition(currentPos)\n\n            // Only add update if position actually changed\n            if (\n              snappedPos.x !== currentPos.x ||\n              snappedPos.y !== currentPos.y\n            ) {\n              boundsUpdates.push({\n                nodeId: otherNodeId,\n                bounds: {\n                  x: snappedPos.x,\n                  y: snappedPos.y,\n                  width: nodeLayout.size.width,\n                  height: nodeLayout.size.height\n                }\n              })\n            }\n          }\n        }\n      }\n\n      // Apply all snap updates in a single batched transaction\n      if (boundsUpdates.length > 0) {\n        layoutStore.batchUpdateNodeBounds(boundsUpdates)\n      }\n    }\n\n    isDragging.value = false\n    dragStartPos = null\n    dragStartMouse = null\n    otherSelectedNodesStartPositions = null\n\n    // Stop tracking shift key state\n    stopShiftSync?.()\n    stopShiftSync = null\n\n    // Cancel any pending animation frame\n    if (rafId !== null) {\n      cancelAnimationFrame(rafId)\n      rafId = null\n    }\n\n    // Release pointer\n    if (!(event.target instanceof HTMLElement)) return\n    event.target.releasePointerCapture(event.pointerId)\n  }\n\n  /**\n   * Update node position directly (without drag)\n   */\n  function moveNodeTo(position: Point) {\n    mutations.setSource(LayoutSource.Vue)\n    mutations.moveNode(nodeId, position)\n  }\n\n  return {\n    // Reactive state (via customRef)\n    layoutRef,\n    position,\n    size,\n    bounds,\n    isVisible,\n    zIndex,\n    isDragging,\n\n    // Mutations\n    moveNodeTo,\n\n    // Drag handlers\n    startDrag,\n    handleDrag,\n    endDrag,\n\n    // Computed styles for Vue templates\n    nodeStyle: computed(\n      (): CSSProperties => ({\n        position: 'absolute' as const,\n        left: `${position.value.x}px`,\n        top: `${position.value.y}px`,\n        width: `${size.value.width}px`,\n        height: `${size.value.height}px`,\n        zIndex: zIndex.value,\n        cursor: isDragging.value ? 'grabbing' : 'grab'\n      })\n    )\n  }\n}\n","import { computed, onUnmounted, ref, toValue } from 'vue'\nimport type { MaybeRefOrGetter } from 'vue'\n\nimport { isMiddlePointerInput } from '@/base/pointerUtils'\nimport type { VueNodeData } from '@/composables/graph/useGraphNodeManager'\nimport { useCanvasInteractions } from '@/renderer/core/canvas/useCanvasInteractions'\nimport { layoutStore } from '@/renderer/core/layout/store/layoutStore'\nimport { useNodeLayout } from '@/renderer/extensions/vueNodes/layout/useNodeLayout'\n\nexport function useNodePointerInteractions(\n  nodeDataMaybe: MaybeRefOrGetter<VueNodeData | null>,\n  onNodeSelect: (event: PointerEvent, nodeData: VueNodeData) => void\n) {\n  const nodeData = computed(() => {\n    const value = toValue(nodeDataMaybe)\n    if (!value) {\n      console.warn(\n        'useNodePointerInteractions: nodeDataMaybe resolved to null/undefined'\n      )\n      return null\n    }\n    return value\n  })\n\n  // Avoid potential null access during component initialization\n  const nodeIdComputed = computed(() => nodeData.value?.id ?? '')\n  const { startDrag, endDrag, handleDrag } = useNodeLayout(nodeIdComputed)\n  // Use canvas interactions for proper wheel event handling and pointer event capture control\n  const { forwardEventToCanvas, shouldHandleNodePointerEvents } =\n    useCanvasInteractions()\n\n  const forwardMiddlePointerIfNeeded = (event: PointerEvent) => {\n    if (!isMiddlePointerInput(event)) return false\n    forwardEventToCanvas(event)\n    return true\n  }\n\n  // Drag state for styling\n  const isDragging = ref(false)\n  const dragStyle = computed(() => {\n    if (nodeData.value?.flags?.pinned) {\n      return { cursor: 'default' }\n    }\n    return { cursor: isDragging.value ? 'grabbing' : 'grab' }\n  })\n  const startPosition = ref({ x: 0, y: 0 })\n\n  const handlePointerDown = (event: PointerEvent) => {\n    if (!nodeData.value) {\n      console.warn(\n        'LGraphNode: nodeData is null/undefined in handlePointerDown'\n      )\n      return\n    }\n\n    if (forwardMiddlePointerIfNeeded(event)) return\n\n    // Only start drag on left-click (button 0)\n    if (event.button !== 0) {\n      return\n    }\n\n    // Don't handle pointer events when canvas is in panning mode - forward to canvas instead\n    if (!shouldHandleNodePointerEvents.value) {\n      forwardEventToCanvas(event)\n      return\n    }\n\n    // Record position for drag threshold calculation\n    startPosition.value = { x: event.clientX, y: event.clientY }\n\n    onNodeSelect(event, nodeData.value)\n\n    if (nodeData.value.flags?.pinned) {\n      return\n    }\n\n    // Start drag using layout system\n    isDragging.value = true\n\n    // Set Vue node dragging state for selection toolbox\n    layoutStore.isDraggingVueNodes.value = true\n\n    startDrag(event)\n  }\n\n  const handlePointerMove = (event: PointerEvent) => {\n    if (forwardMiddlePointerIfNeeded(event)) return\n\n    if (isDragging.value) {\n      void handleDrag(event)\n    }\n  }\n\n  /**\n   * Centralized cleanup function for drag state\n   * Ensures consistent cleanup across all drag termination scenarios\n   */\n  const cleanupDragState = () => {\n    isDragging.value = false\n    layoutStore.isDraggingVueNodes.value = false\n  }\n\n  /**\n   * Safely ends drag operation with proper error handling\n   * @param event - PointerEvent to end the drag with\n   */\n  const safeDragEnd = async (event: PointerEvent): Promise<void> => {\n    try {\n      await endDrag(event)\n    } catch (error) {\n      console.error('Error during endDrag:', error)\n    } finally {\n      cleanupDragState()\n    }\n  }\n\n  /**\n   * Common drag termination handler with fallback cleanup\n   */\n  const handleDragTermination = (event: PointerEvent, errorContext: string) => {\n    safeDragEnd(event).catch((error) => {\n      console.error(`Failed to complete ${errorContext}:`, error)\n      cleanupDragState() // Fallback cleanup\n    })\n  }\n\n  const handlePointerUp = (event: PointerEvent) => {\n    if (forwardMiddlePointerIfNeeded(event)) return\n\n    if (isDragging.value) {\n      handleDragTermination(event, 'drag end')\n    }\n\n    // Don't handle pointer events when canvas is in panning mode - forward to canvas instead\n    if (!shouldHandleNodePointerEvents.value) {\n      forwardEventToCanvas(event)\n      return\n    }\n  }\n\n  /**\n   * Handles pointer cancellation events (e.g., touch cancelled by browser)\n   * Ensures drag state is properly cleaned up when pointer interaction is interrupted\n   */\n  const handlePointerCancel = (event: PointerEvent) => {\n    if (!isDragging.value) return\n    handleDragTermination(event, 'drag cancellation')\n  }\n\n  /**\n   * Handles right-click during drag operations\n   * Cancels the current drag to prevent context menu from appearing while dragging\n   */\n  const handleContextMenu = (event: MouseEvent) => {\n    if (!isDragging.value) return\n\n    event.preventDefault()\n    // Simply cleanup state without calling endDrag to avoid synthetic event creation\n    cleanupDragState()\n  }\n\n  // Cleanup on unmount to prevent resource leaks\n  onUnmounted(() => {\n    if (!isDragging.value) return\n    cleanupDragState()\n  })\n\n  const pointerHandlers = {\n    onPointerdown: handlePointerDown,\n    onPointermove: handlePointerMove,\n    onPointerup: handlePointerUp,\n    onPointercancel: handlePointerCancel,\n    onContextmenu: handleContextMenu\n  }\n\n  return {\n    isDragging,\n    dragStyle,\n    pointerHandlers\n  }\n}\n","/**\n * Generic Vue Element Tracking System\n *\n * Automatically tracks DOM size and position changes for Vue-rendered elements\n * and syncs them to the layout store. Uses a single shared ResizeObserver for\n * performance, with elements identified by configurable data attributes.\n *\n * Supports different element types (nodes, slots, widgets, etc.) with\n * customizable data attributes and update handlers.\n */\nimport { getCurrentInstance, onMounted, onUnmounted, toValue } from 'vue'\nimport type { MaybeRefOrGetter } from 'vue'\n\nimport { useSharedCanvasPositionConversion } from '@/composables/element/useCanvasPositionConversion'\nimport { LiteGraph } from '@/lib/litegraph/src/litegraph'\nimport { layoutStore } from '@/renderer/core/layout/store/layoutStore'\nimport type { Bounds, NodeId } from '@/renderer/core/layout/types'\nimport { LayoutSource } from '@/renderer/core/layout/types'\n\nimport { syncNodeSlotLayoutsFromDOM } from './useSlotElementTracking'\n\n/**\n * Generic update item for element bounds tracking\n */\ninterface ElementBoundsUpdate {\n  /** Element identifier (could be nodeId, widgetId, slotId, etc.) */\n  id: string\n  /** Updated bounds */\n  bounds: Bounds\n}\n\n/**\n * Configuration for different types of tracked elements\n */\ninterface ElementTrackingConfig {\n  /** Data attribute name (e.g., 'nodeId') */\n  dataAttribute: string\n  /** Handler for processing bounds updates */\n  updateHandler: (updates: ElementBoundsUpdate[]) => void\n}\n\n/**\n * Registry of tracking configurations by element type\n */\nconst trackingConfigs: Map<string, ElementTrackingConfig> = new Map([\n  [\n    'node',\n    {\n      dataAttribute: 'nodeId',\n      updateHandler: (updates) => {\n        const nodeUpdates = updates.map(({ id, bounds }) => ({\n          nodeId: id as NodeId,\n          bounds\n        }))\n        layoutStore.batchUpdateNodeBounds(nodeUpdates)\n      }\n    }\n  ]\n])\n\n// Single ResizeObserver instance for all Vue elements\nconst resizeObserver = new ResizeObserver((entries) => {\n  // Canvas is ready when this code runs; no defensive guards needed.\n  const conv = useSharedCanvasPositionConversion()\n  // Group updates by type, then flush via each config's handler\n  const updatesByType = new Map<string, ElementBoundsUpdate[]>()\n  // Track nodes whose slots should be resynced after node size changes\n  const nodesNeedingSlotResync = new Set<string>()\n\n  for (const entry of entries) {\n    if (!(entry.target instanceof HTMLElement)) continue\n    const element = entry.target\n\n    // Find which type this element belongs to\n    let elementType: string | undefined\n    let elementId: string | undefined\n\n    for (const [type, config] of trackingConfigs) {\n      const id = element.dataset[config.dataAttribute]\n      if (id) {\n        elementType = type\n        elementId = id\n        break\n      }\n    }\n\n    if (!elementType || !elementId) continue\n\n    // Use borderBoxSize when available; fall back to contentRect for older engines/tests\n    // Border box is the border included FULL wxh DOM value.\n    const borderBox = Array.isArray(entry.borderBoxSize)\n      ? entry.borderBoxSize[0]\n      : {\n          inlineSize: entry.contentRect.width,\n          blockSize: entry.contentRect.height\n        }\n    const width = borderBox.inlineSize\n    const height = borderBox.blockSize\n\n    // Screen-space rect\n    const rect = element.getBoundingClientRect()\n    const [cx, cy] = conv.clientPosToCanvasPos([rect.left, rect.top])\n    const topLeftCanvas = { x: cx, y: cy }\n    const bounds: Bounds = {\n      x: topLeftCanvas.x,\n      y: topLeftCanvas.y + LiteGraph.NODE_TITLE_HEIGHT,\n      width: Math.max(0, width),\n      height: Math.max(0, height - LiteGraph.NODE_TITLE_HEIGHT)\n    }\n\n    let updates = updatesByType.get(elementType)\n    if (!updates) {\n      updates = []\n      updatesByType.set(elementType, updates)\n    }\n    updates.push({ id: elementId, bounds })\n\n    // If this entry is a node, mark it for slot layout resync\n    if (elementType === 'node' && elementId) {\n      nodesNeedingSlotResync.add(elementId)\n    }\n  }\n\n  // Set source to Vue before processing DOM-driven updates\n  layoutStore.setSource(LayoutSource.Vue)\n\n  // Flush per-type\n  for (const [type, updates] of updatesByType) {\n    const config = trackingConfigs.get(type)\n    if (config && updates.length) config.updateHandler(updates)\n  }\n\n  // After node bounds are updated, refresh slot cached offsets and layouts\n  if (nodesNeedingSlotResync.size > 0) {\n    for (const nodeId of nodesNeedingSlotResync) {\n      syncNodeSlotLayoutsFromDOM(nodeId)\n    }\n  }\n})\n\n/**\n * Tracks DOM element size/position changes for a Vue component and syncs to layout store\n *\n * Sets up automatic ResizeObserver tracking when the component mounts and cleans up\n * when unmounted. The tracked element is identified by a data attribute set on the\n * component's root DOM element.\n *\n * @param appIdentifier - Application-level identifier for this tracked element (not a DOM ID)\n *                       Example: node ID like 'node-123', widget ID like 'widget-456'\n * @param trackingType - Type of element being tracked, determines which tracking config to use\n *                      Example: 'node' for Vue nodes, 'widget' for UI widgets\n *\n * @example\n * ```ts\n * // Track a Vue node component with ID 'my-node-123'\n * useVueElementTracking('my-node-123', 'node')\n *\n * // Would set data-node-id=\"my-node-123\" on the component's root element\n * // and sync size changes to layoutStore.batchUpdateNodeBounds()\n * ```\n */\nexport function useVueElementTracking(\n  appIdentifierMaybe: MaybeRefOrGetter<string>,\n  trackingType: string\n) {\n  const appIdentifier = toValue(appIdentifierMaybe)\n  onMounted(() => {\n    const element = getCurrentInstance()?.proxy?.$el\n    if (!(element instanceof HTMLElement) || !appIdentifier) return\n\n    const config = trackingConfigs.get(trackingType)\n    if (!config) return\n\n    // Set the data attribute expected by the RO pipeline for this type\n    element.dataset[config.dataAttribute] = appIdentifier\n    resizeObserver.observe(element)\n  })\n\n  onUnmounted(() => {\n    const element = getCurrentInstance()?.proxy?.$el\n    if (!(element instanceof HTMLElement)) return\n\n    const config = trackingConfigs.get(trackingType)\n    if (!config) return\n\n    // Remove the data attribute and observer\n    delete element.dataset[config.dataAttribute]\n    resizeObserver.unobserve(element)\n  })\n}\n","import { storeToRefs } from 'pinia'\nimport { computed, toValue } from 'vue'\nimport type { MaybeRefOrGetter } from 'vue'\n\nimport { useExecutionStore } from '@/stores/executionStore'\n\n/**\n * Composable for managing execution state of Vue-based nodes\n *\n * Provides reactive access to execution state and progress for a specific node\n * by injecting execution data from the parent GraphCanvas provider.\n *\n * @param nodeLocatorIdMaybe - Locator ID (root or subgraph scoped) of the node to track\n * @returns Object containing reactive execution state and progress\n */\nexport const useNodeExecutionState = (\n  nodeLocatorIdMaybe: MaybeRefOrGetter<string | undefined>\n) => {\n  const locatorId = computed(() => toValue(nodeLocatorIdMaybe) ?? '')\n  const { nodeLocationProgressStates, isIdle } =\n    storeToRefs(useExecutionStore())\n\n  const progressState = computed(() => {\n    const id = locatorId.value\n    return id ? nodeLocationProgressStates.value[id] : undefined\n  })\n\n  const executing = computed(\n    () => !isIdle.value && progressState.value?.state === 'running'\n  )\n\n  const progress = computed(() => {\n    const state = progressState.value\n    return state && state.max > 0 ? state.value / state.max : undefined\n  })\n\n  const progressPercentage = computed(() => {\n    const prog = progress.value\n    return prog !== undefined ? Math.round(prog * 100) : undefined\n  })\n\n  const executionState = computed(() => {\n    const state = progressState.value\n    if (!state) return 'idle'\n    return state.state\n  })\n\n  return {\n    executing,\n    progress,\n    progressPercentage,\n    progressState,\n    executionState\n  }\n}\n","import { storeToRefs } from 'pinia'\nimport { computed, toValue } from 'vue'\nimport type { MaybeRefOrGetter, Ref } from 'vue'\n\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { useNodeOutputStore } from '@/stores/imagePreviewStore'\n\nexport const useNodePreviewState = (\n  nodeIdMaybe: MaybeRefOrGetter<string>,\n  options?: {\n    isCollapsed?: Ref<boolean>\n  }\n) => {\n  const nodeId = toValue(nodeIdMaybe)\n  const workflowStore = useWorkflowStore()\n  const { nodePreviewImages } = storeToRefs(useNodeOutputStore())\n\n  const locatorId = computed(() => workflowStore.nodeIdToNodeLocatorId(nodeId))\n\n  const previewUrls = computed(() => {\n    const key = locatorId.value\n    if (!key) return undefined\n    const urls = nodePreviewImages.value[key]\n    return urls?.length ? urls : undefined\n  })\n\n  const hasPreview = computed(() => !!previewUrls.value?.length)\n\n  const latestPreviewUrl = computed(() => {\n    const urls = previewUrls.value\n    return urls?.length ? urls.at(-1) : ''\n  })\n\n  const shouldShowPreviewImg = computed(() => {\n    if (!options?.isCollapsed) {\n      return hasPreview.value\n    }\n    return !options.isCollapsed.value && hasPreview.value\n  })\n\n  return {\n    locatorId,\n    previewUrls,\n    hasPreview,\n    latestPreviewUrl,\n    shouldShowPreviewImg\n  }\n}\n","import type { Point, Size } from '@/renderer/core/layout/types'\n\nexport type ResizeHandleDirection = {\n  horizontal: 'left' | 'right'\n  vertical: 'top' | 'bottom'\n}\n\nfunction applyHandleDelta(\n  startSize: Size,\n  delta: Point,\n  handle: ResizeHandleDirection\n): Size {\n  const horizontalMultiplier = handle.horizontal === 'right' ? 1 : -1\n  const verticalMultiplier = handle.vertical === 'bottom' ? 1 : -1\n\n  return {\n    width: startSize.width + delta.x * horizontalMultiplier,\n    height: startSize.height + delta.y * verticalMultiplier\n  }\n}\n\nfunction computeAdjustedPosition(\n  startPosition: Point,\n  startSize: Size,\n  nextSize: Size,\n  handle: ResizeHandleDirection\n): Point {\n  const widthDelta = startSize.width - nextSize.width\n  const heightDelta = startSize.height - nextSize.height\n\n  return {\n    x:\n      handle.horizontal === 'left'\n        ? startPosition.x + widthDelta\n        : startPosition.x,\n    y:\n      handle.vertical === 'top'\n        ? startPosition.y + heightDelta\n        : startPosition.y\n  }\n}\n\n/**\n * Computes the resulting size and position of a node given pointer movement\n * and handle orientation.\n */\nexport function computeResizeOutcome({\n  startSize,\n  startPosition,\n  delta,\n  handle,\n  snapFn\n}: {\n  startSize: Size\n  startPosition: Point\n  delta: Point\n  handle: ResizeHandleDirection\n  snapFn?: (size: Size) => Size\n}): { size: Size; position: Point } {\n  const resized = applyHandleDelta(startSize, delta, handle)\n  const snapped = snapFn?.(resized) ?? resized\n  const position = computeAdjustedPosition(\n    startPosition,\n    startSize,\n    snapped,\n    handle\n  )\n\n  return {\n    size: snapped,\n    position\n  }\n}\n\nexport function createResizeSession(config: {\n  startSize: Size\n  startPosition: Point\n  handle: ResizeHandleDirection\n}) {\n  const startSize = { ...config.startSize }\n  const startPosition = { ...config.startPosition }\n  const handle = config.handle\n\n  return (delta: Point, snapFn?: (size: Size) => Size) =>\n    computeResizeOutcome({\n      startSize,\n      startPosition,\n      handle,\n      delta,\n      snapFn\n    })\n}\n\nexport function toCanvasDelta(\n  startPointer: Point,\n  currentPointer: Point,\n  scale: number\n): Point {\n  const safeScale = scale === 0 ? 1 : scale\n  return {\n    x: (currentPointer.x - startPointer.x) / safeScale,\n    y: (currentPointer.y - startPointer.y) / safeScale\n  }\n}\n","import { useEventListener } from '@vueuse/core'\nimport { ref } from 'vue'\n\nimport type { TransformState } from '@/renderer/core/layout/injectionKeys'\nimport type { Point, Size } from '@/renderer/core/layout/types'\nimport { useNodeSnap } from '@/renderer/extensions/vueNodes/composables/useNodeSnap'\nimport { useShiftKeySync } from '@/renderer/extensions/vueNodes/composables/useShiftKeySync'\n\nimport type { ResizeHandleDirection } from './resizeMath'\nimport { createResizeSession, toCanvasDelta } from './resizeMath'\n\ninterface UseNodeResizeOptions {\n  /** Transform state for coordinate conversion */\n  transformState: TransformState\n}\n\ninterface ResizeCallbackPayload {\n  size: Size\n  position: Point\n}\n\n/**\n * Composable for node resizing functionality\n *\n * Provides resize handle interaction that integrates with the layout system.\n * Handles pointer capture, coordinate calculations, and size constraints.\n */\nexport function useNodeResize(\n  resizeCallback: (\n    payload: ResizeCallbackPayload,\n    element: HTMLElement\n  ) => void,\n  options: UseNodeResizeOptions\n) {\n  const { transformState } = options\n\n  const isResizing = ref(false)\n  const resizeStartPointer = ref<Point | null>(null)\n  const resizeSession = ref<\n    | ((\n        delta: Point,\n        snapFn?: (size: Size) => Size\n      ) => {\n        size: Size\n        position: Point\n      })\n    | null\n  >(null)\n\n  // Snap-to-grid functionality\n  const { shouldSnap, applySnapToSize } = useNodeSnap()\n\n  // Shift key sync for LiteGraph canvas preview\n  const { trackShiftKey } = useShiftKeySync()\n\n  const startResize = (\n    event: PointerEvent,\n    handle: ResizeHandleDirection,\n    startPosition: Point\n  ) => {\n    event.preventDefault()\n    event.stopPropagation()\n\n    const target = event.currentTarget\n    if (!(target instanceof HTMLElement)) return\n\n    const nodeElement = target.closest('[data-node-id]')\n    if (!(nodeElement instanceof HTMLElement)) return\n\n    const rect = nodeElement.getBoundingClientRect()\n    const scale = transformState.camera.z\n\n    const startSize: Size = {\n      width: rect.width / scale,\n      height: rect.height / scale\n    }\n\n    // Track shift key state and sync to canvas for snap preview\n    const stopShiftSync = trackShiftKey(event)\n\n    // Capture pointer to ensure we get all move/up events\n    target.setPointerCapture(event.pointerId)\n\n    isResizing.value = true\n    resizeStartPointer.value = { x: event.clientX, y: event.clientY }\n    resizeSession.value = createResizeSession({\n      startSize,\n      startPosition: { ...startPosition },\n      handle\n    })\n\n    const handlePointerMove = (moveEvent: PointerEvent) => {\n      if (\n        !isResizing.value ||\n        !resizeStartPointer.value ||\n        !resizeSession.value\n      )\n        return\n\n      const startPointer = resizeStartPointer.value\n      const session = resizeSession.value\n\n      const delta = toCanvasDelta(\n        startPointer,\n        { x: moveEvent.clientX, y: moveEvent.clientY },\n        transformState.camera.z\n      )\n\n      const nodeElement = target.closest('[data-node-id]')\n      if (nodeElement instanceof HTMLElement) {\n        const outcome = session(\n          delta,\n          shouldSnap(moveEvent) ? applySnapToSize : undefined\n        )\n\n        resizeCallback(outcome, nodeElement)\n      }\n    }\n\n    const handlePointerUp = (upEvent: PointerEvent) => {\n      if (isResizing.value) {\n        isResizing.value = false\n        resizeStartPointer.value = null\n        resizeSession.value = null\n\n        // Stop tracking shift key state\n        stopShiftSync()\n\n        target.releasePointerCapture(upEvent.pointerId)\n        stopMoveListen()\n        stopUpListen()\n      }\n    }\n\n    const stopMoveListen = useEventListener('pointermove', handlePointerMove)\n    const stopUpListen = useEventListener('pointerup', handlePointerUp)\n  }\n\n  return {\n    startResize,\n    isResizing\n  }\n}\n","<template>\n  <div v-if=\"imageUrl\" class=\"flex h-full min-h-16 w-full min-w-16 flex-col\">\n    <!-- Image Container -->\n    <div\n      class=\"relative h-88 w-full grow overflow-hidden rounded-[5px] bg-node-component-surface\"\n    >\n      <!-- Error State -->\n      <div\n        v-if=\"imageError\"\n        class=\"text-pure-white flex h-full w-full flex-col items-center justify-center text-center\"\n      >\n        <i-lucide:image-off class=\"mb-1 size-8 text-smoke-500\" />\n        <p class=\"text-xs text-smoke-400\">{{ $t('g.imageFailedToLoad') }}</p>\n      </div>\n\n      <!-- Main Image -->\n      <img\n        v-else\n        :src=\"imageUrl\"\n        :alt=\"$t('g.liveSamplingPreview')\"\n        class=\"pointer-events-none h-full w-full object-contain object-center\"\n        @load=\"handleImageLoad\"\n        @error=\"handleImageError\"\n      />\n    </div>\n\n    <!-- Image Dimensions -->\n    <div class=\"text-node-component-header-text mt-1 text-center text-xs\">\n      {{\n        imageError\n          ? $t('g.errorLoadingImage')\n          : actualDimensions || $t('g.calculatingDimensions')\n      }}\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ref, watch } from 'vue'\n\ninterface LivePreviewProps {\n  /** Image URL to display */\n  imageUrl: string | null\n}\n\nconst props = defineProps<LivePreviewProps>()\n\nconst actualDimensions = ref<string | null>(null)\nconst imageError = ref(false)\n\nwatch(\n  () => props.imageUrl,\n  () => {\n    // Reset states when URL changes\n    actualDimensions.value = null\n    imageError.value = false\n  }\n)\n\nconst handleImageLoad = (event: Event) => {\n  if (!event.target || !(event.target instanceof HTMLImageElement)) return\n  const img = event.target\n  imageError.value = false\n  if (img.naturalWidth && img.naturalHeight) {\n    actualDimensions.value = `${img.naturalWidth} x ${img.naturalHeight}`\n  }\n}\n\nconst handleImageError = () => {\n  imageError.value = true\n  actualDimensions.value = null\n}\n</script>\n","<template>\n  <div v-if=\"renderError\" class=\"node-error p-2 text-sm text-red-500\">\n    {{ st('nodeErrors.render', 'Node Render Error') }}\n  </div>\n  <div\n    v-else\n    ref=\"nodeContainerRef\"\n    :data-node-id=\"nodeData.id\"\n    :class=\"\n      cn(\n        'bg-component-node-background lg-node absolute',\n        'h-min w-min contain-style contain-layout min-h-(--node-height) min-w-(--node-width)',\n        'rounded-2xl touch-none flex flex-col',\n        'border-1 border-solid border-component-node-border',\n        // hover (only when node should handle events)\n        shouldHandleNodePointerEvents &&\n          'hover:ring-7 ring-node-component-ring',\n        'outline-transparent outline-2',\n        borderClass,\n        outlineClass,\n        {\n          'before:rounded-2xl before:pointer-events-none before:absolute before:bg-bypass/60 before:inset-0':\n            bypassed,\n          'before:rounded-2xl before:pointer-events-none before:absolute before:inset-0':\n            muted,\n          'will-change-transform': isDragging,\n          'ring-4 ring-primary-500 bg-primary-500/10': isDraggingOver\n        },\n\n        shouldHandleNodePointerEvents\n          ? 'pointer-events-auto'\n          : 'pointer-events-none'\n      )\n    \"\n    :style=\"[\n      {\n        transform: `translate(${position.x ?? 0}px, ${(position.y ?? 0) - LiteGraph.NODE_TITLE_HEIGHT}px)`,\n        zIndex: zIndex,\n        opacity: nodeOpacity,\n        '--component-node-background': nodeBodyBackgroundColor\n      },\n      dragStyle\n    ]\"\n    v-bind=\"pointerHandlers\"\n    @wheel=\"handleWheel\"\n    @contextmenu=\"handleContextMenu\"\n    @dragover.prevent=\"handleDragOver\"\n    @dragleave=\"handleDragLeave\"\n    @drop.stop.prevent=\"handleDrop\"\n  >\n    <div class=\"flex flex-col justify-center items-center relative\">\n      <template v-if=\"isCollapsed\">\n        <SlotConnectionDot\n          v-if=\"hasInputs\"\n          multi\n          class=\"absolute left-0 -translate-x-1/2\"\n        />\n        <SlotConnectionDot\n          v-if=\"hasOutputs\"\n          multi\n          class=\"absolute right-0 translate-x-1/2\"\n        />\n        <NodeSlots :node-data=\"nodeData\" unified />\n      </template>\n      <NodeHeader\n        :node-data=\"nodeData\"\n        :collapsed=\"isCollapsed\"\n        @collapse=\"handleCollapse\"\n        @update:title=\"handleHeaderTitleUpdate\"\n        @enter-subgraph=\"handleEnterSubgraph\"\n      />\n    </div>\n\n    <div\n      v-if=\"isCollapsed && executing && progress !== undefined\"\n      :class=\"\n        cn(\n          'absolute inset-x-4 -bottom-[1px] translate-y-1/2 rounded-full',\n          progressClasses\n        )\n      \"\n      :style=\"{ width: `${Math.min(progress * 100, 100)}%` }\"\n    />\n\n    <template v-if=\"!isCollapsed\">\n      <div class=\"relative mb-1\">\n        <!-- Progress bar for executing state -->\n        <div\n          v-if=\"executing && progress !== undefined\"\n          :class=\"\n            cn(\n              'absolute inset-x-0 top-1/2 -translate-y-1/2',\n              !!(progress < 1) && 'rounded-r-full',\n              progressClasses\n            )\n          \"\n          :style=\"{ width: `${Math.min(progress * 100, 100)}%` }\"\n        />\n      </div>\n\n      <!-- Node Body - rendered based on LOD level and collapsed state -->\n      <div\n        class=\"flex min-h-min min-w-min flex-1 flex-col gap-1 pb-2\"\n        :data-testid=\"`node-body-${nodeData.id}`\"\n      >\n        <!-- Slots only rendered at full detail -->\n        <NodeSlots :node-data=\"nodeData\" />\n\n        <!-- Widgets rendered at reduced+ detail -->\n        <NodeWidgets v-if=\"nodeData.widgets?.length\" :node-data=\"nodeData\" />\n\n        <!-- Custom content at reduced+ detail -->\n        <div v-if=\"hasCustomContent\" class=\"min-h-0 flex-1 flex\">\n          <NodeContent :node-data=\"nodeData\" :media=\"nodeMedia\" />\n        </div>\n        <!-- Live mid-execution preview images -->\n        <div v-if=\"shouldShowPreviewImg\" class=\"min-h-0 flex-1 px-4\">\n          <LivePreview :image-url=\"latestPreviewUrl || null\" />\n        </div>\n      </div>\n    </template>\n\n    <!-- Resize handles -->\n    <template v-if=\"!isCollapsed\">\n      <div\n        v-for=\"handle in cornerResizeHandles\"\n        :key=\"handle.id\"\n        role=\"button\"\n        :aria-label=\"handle.ariaLabel\"\n        :class=\"cn(baseResizeHandleClasses, handle.classes)\"\n        @pointerdown.stop=\"handleResizePointerDown(handle.direction)($event)\"\n      />\n    </template>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { storeToRefs } from 'pinia'\nimport { computed, inject, onErrorCaptured, onMounted, ref, watch } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport type { VueNodeData } from '@/composables/graph/useGraphNodeManager'\nimport { toggleNodeOptions } from '@/composables/graph/useMoreOptionsMenu'\nimport { useErrorHandling } from '@/composables/useErrorHandling'\nimport { st } from '@/i18n'\nimport { LGraphEventMode, LiteGraph } from '@/lib/litegraph/src/litegraph'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useCanvasInteractions } from '@/renderer/core/canvas/useCanvasInteractions'\nimport { TransformStateKey } from '@/renderer/core/layout/injectionKeys'\nimport SlotConnectionDot from '@/renderer/extensions/vueNodes/components/SlotConnectionDot.vue'\nimport { useNodeEventHandlers } from '@/renderer/extensions/vueNodes/composables/useNodeEventHandlers'\nimport { useNodePointerInteractions } from '@/renderer/extensions/vueNodes/composables/useNodePointerInteractions'\nimport { useVueElementTracking } from '@/renderer/extensions/vueNodes/composables/useVueNodeResizeTracking'\nimport { useNodeExecutionState } from '@/renderer/extensions/vueNodes/execution/useNodeExecutionState'\nimport { useNodeLayout } from '@/renderer/extensions/vueNodes/layout/useNodeLayout'\nimport { useNodePreviewState } from '@/renderer/extensions/vueNodes/preview/useNodePreviewState'\nimport { nonWidgetedInputs } from '@/renderer/extensions/vueNodes/utils/nodeDataUtils'\nimport { applyLightThemeColor } from '@/renderer/extensions/vueNodes/utils/nodeStyleUtils'\nimport { app } from '@/scripts/app'\nimport { useExecutionStore } from '@/stores/executionStore'\nimport { useNodeOutputStore } from '@/stores/imagePreviewStore'\nimport { useColorPaletteStore } from '@/stores/workspace/colorPaletteStore'\nimport {\n  getLocatorIdFromNodeData,\n  getNodeByLocatorId\n} from '@/utils/graphTraversalUtil'\nimport { cn } from '@/utils/tailwindUtil'\n\nimport type { ResizeHandleDirection } from '../interactions/resize/resizeMath'\nimport { useNodeResize } from '../interactions/resize/useNodeResize'\nimport LivePreview from './LivePreview.vue'\nimport NodeContent from './NodeContent.vue'\nimport NodeHeader from './NodeHeader.vue'\nimport NodeSlots from './NodeSlots.vue'\nimport NodeWidgets from './NodeWidgets.vue'\n\n// Extended props for main node component\ninterface LGraphNodeProps {\n  nodeData: VueNodeData\n  error?: string | null\n  zoomLevel?: number\n}\n\nconst { nodeData, error = null } = defineProps<LGraphNodeProps>()\n\nconst { t } = useI18n()\n\nconst {\n  handleNodeCollapse,\n  handleNodeTitleUpdate,\n  handleNodeSelect,\n  handleNodeRightClick\n} = useNodeEventHandlers()\n\nuseVueElementTracking(() => nodeData.id, 'node')\n\nconst transformState = inject(TransformStateKey)\nif (!transformState) {\n  throw new Error(\n    'TransformState must be provided for node resize functionality'\n  )\n}\n\nconst { selectedNodeIds } = storeToRefs(useCanvasStore())\nconst isSelected = computed(() => {\n  return selectedNodeIds.value.has(nodeData.id)\n})\n\nconst nodeLocatorId = computed(() => getLocatorIdFromNodeData(nodeData))\nconst { executing, progress } = useNodeExecutionState(nodeLocatorId)\nconst executionStore = useExecutionStore()\nconst hasExecutionError = computed(\n  () => executionStore.lastExecutionErrorNodeId === nodeData.id\n)\n\nconst hasAnyError = computed((): boolean => {\n  return !!(\n    hasExecutionError.value ||\n    nodeData.hasErrors ||\n    error ||\n    (executionStore.lastNodeErrors?.[nodeData.id]?.errors.length ?? 0) > 0\n  )\n})\n\nconst isCollapsed = computed(() => nodeData.flags?.collapsed ?? false)\nconst bypassed = computed(\n  (): boolean => nodeData.mode === LGraphEventMode.BYPASS\n)\nconst muted = computed((): boolean => nodeData.mode === LGraphEventMode.NEVER)\n\nconst nodeBodyBackgroundColor = computed(() => {\n  const colorPaletteStore = useColorPaletteStore()\n\n  if (!nodeData.bgcolor) {\n    return ''\n  }\n\n  return applyLightThemeColor(\n    nodeData.bgcolor,\n    Boolean(colorPaletteStore.completedActivePalette.light_theme)\n  )\n})\n\nconst nodeOpacity = computed(() => {\n  const globalOpacity = useSettingStore().get('Comfy.Node.Opacity') ?? 1\n\n  // For muted/bypassed nodes, apply the 0.5 multiplier on top of global opacity\n  if (bypassed.value || muted.value) {\n    return globalOpacity * 0.5\n  }\n\n  return globalOpacity\n})\n\nconst hasInputs = computed(() => nonWidgetedInputs(nodeData).length > 0)\nconst hasOutputs = computed((): boolean => !!nodeData.outputs?.length)\n\n// Use canvas interactions for proper wheel event handling and pointer event capture control\nconst { handleWheel, shouldHandleNodePointerEvents } = useCanvasInteractions()\n\n// Error boundary implementation\nconst renderError = ref<string | null>(null)\nconst { toastErrorHandler } = useErrorHandling()\n\nonErrorCaptured((error) => {\n  renderError.value = error.message\n  toastErrorHandler(error)\n  return false // Prevent error propagation\n})\n\nconst { position, size, zIndex, moveNodeTo } = useNodeLayout(() => nodeData.id)\nconst { pointerHandlers, isDragging, dragStyle } = useNodePointerInteractions(\n  () => nodeData,\n  handleNodeSelect\n)\n\n// Handle right-click context menu\nconst handleContextMenu = (event: MouseEvent) => {\n  event.preventDefault()\n  event.stopPropagation()\n\n  // First handle the standard right-click behavior (selection)\n  handleNodeRightClick(event as PointerEvent, nodeData)\n\n  // Show the node options menu at the cursor position\n  const targetElement = event.currentTarget as HTMLElement\n  if (targetElement) {\n    toggleNodeOptions(event, targetElement, false)\n  }\n}\n\nonMounted(() => {\n  // Set initial DOM size from layout store, but respect intrinsic content minimum\n  if (size.value && nodeContainerRef.value) {\n    nodeContainerRef.value.style.setProperty(\n      '--node-width',\n      `${size.value.width}px`\n    )\n    nodeContainerRef.value.style.setProperty(\n      '--node-height',\n      `${size.value.height}px`\n    )\n  }\n})\n\nconst baseResizeHandleClasses =\n  'absolute h-3 w-3 opacity-0 pointer-events-auto focus-visible:outline focus-visible:outline-2 focus-visible:outline-white/40'\nconst POSITION_EPSILON = 0.01\n\ntype CornerResizeHandle = {\n  id: string\n  direction: ResizeHandleDirection\n  classes: string\n  ariaLabel: string\n}\n\nconst cornerResizeHandles: CornerResizeHandle[] = [\n  {\n    id: 'se',\n    direction: { horizontal: 'right', vertical: 'bottom' },\n    classes: 'right-0 bottom-0 cursor-se-resize',\n    ariaLabel: t('g.resizeFromBottomRight')\n  },\n  {\n    id: 'ne',\n    direction: { horizontal: 'right', vertical: 'top' },\n    classes: 'right-0 top-0 cursor-ne-resize',\n    ariaLabel: t('g.resizeFromTopRight')\n  },\n  {\n    id: 'sw',\n    direction: { horizontal: 'left', vertical: 'bottom' },\n    classes: 'left-0 bottom-0 cursor-sw-resize',\n    ariaLabel: t('g.resizeFromBottomLeft')\n  },\n  {\n    id: 'nw',\n    direction: { horizontal: 'left', vertical: 'top' },\n    classes: 'left-0 top-0 cursor-nw-resize',\n    ariaLabel: t('g.resizeFromTopLeft')\n  }\n]\n\nconst { startResize } = useNodeResize(\n  (result, element) => {\n    if (isCollapsed.value) return\n\n    // Apply size directly to DOM element - ResizeObserver will pick this up\n    element.style.setProperty('--node-width', `${result.size.width}px`)\n    element.style.setProperty('--node-height', `${result.size.height}px`)\n\n    const currentPosition = position.value\n    const deltaX = Math.abs(result.position.x - currentPosition.x)\n    const deltaY = Math.abs(result.position.y - currentPosition.y)\n\n    if (deltaX > POSITION_EPSILON || deltaY > POSITION_EPSILON) {\n      moveNodeTo(result.position)\n    }\n  },\n  {\n    transformState\n  }\n)\n\nconst handleResizePointerDown = (direction: ResizeHandleDirection) => {\n  return (event: PointerEvent) => {\n    if (nodeData.flags?.pinned) return\n\n    startResize(event, direction, { ...position.value })\n  }\n}\n\nwatch(isCollapsed, (collapsed) => {\n  const element = nodeContainerRef.value\n  if (!element) return\n  const [from, to] = collapsed ? ['', '-x'] : ['-x', '']\n  const currentWidth = element.style.getPropertyValue(`--node-width${from}`)\n  element.style.setProperty(`--node-width${to}`, currentWidth)\n  element.style.setProperty(`--node-width${from}`, '')\n\n  const currentHeight = element.style.getPropertyValue(`--node-height${from}`)\n  element.style.setProperty(`--node-height${to}`, currentHeight)\n  element.style.setProperty(`--node-height${from}`, '')\n})\n\n// Check if node has custom content (like image/video outputs)\nconst hasCustomContent = computed(() => {\n  // Show custom content if node has media outputs\n  return !!nodeMedia.value && nodeMedia.value.urls.length > 0\n})\n\n// Computed classes and conditions for better reusability\nconst progressClasses = 'h-2 bg-primary-500 transition-all duration-300'\n\nconst { latestPreviewUrl, shouldShowPreviewImg } = useNodePreviewState(\n  () => nodeData.id,\n  {\n    isCollapsed\n  }\n)\n\nconst borderClass = computed(() => {\n  if (hasAnyError.value) return 'border-node-stroke-error'\n  if (executing.value) return 'border-node-stroke-executing'\n  return 'border-node-stroke'\n})\n\nconst outlineClass = computed(() => {\n  return cn(\n    isSelected.value &&\n      ((hasAnyError.value && 'outline-error ') ||\n        (executing.value && 'outline-node-executing') ||\n        'outline-node-component-outline')\n  )\n})\n\n// Event handlers\nconst handleCollapse = () => {\n  handleNodeCollapse(nodeData.id, !isCollapsed.value)\n}\n\nconst handleHeaderTitleUpdate = (newTitle: string) => {\n  handleNodeTitleUpdate(nodeData.id, newTitle)\n}\n\nconst handleEnterSubgraph = () => {\n  useTelemetry()?.trackUiButtonClicked({\n    button_id: 'graph_node_open_subgraph_clicked'\n  })\n  const graph = app.graph?.rootGraph || app.graph\n  if (!graph) {\n    console.warn('LGraphNode: No graph available for subgraph navigation')\n    return\n  }\n\n  const locatorId = getLocatorIdFromNodeData(nodeData)\n\n  const litegraphNode = getNodeByLocatorId(graph, locatorId)\n\n  if (!litegraphNode?.isSubgraphNode() || !('subgraph' in litegraphNode)) {\n    console.warn('LGraphNode: Node is not a valid subgraph node', litegraphNode)\n    return\n  }\n\n  const canvas = app.canvas\n  if (!canvas || typeof canvas.openSubgraph !== 'function') {\n    console.warn('LGraphNode: Canvas or openSubgraph method not available')\n    return\n  }\n\n  canvas.openSubgraph(litegraphNode.subgraph, litegraphNode)\n}\n\nconst nodeOutputs = useNodeOutputStore()\n\nconst nodeOutputLocatorId = computed(() =>\n  nodeData.subgraphId ? `${nodeData.subgraphId}:${nodeData.id}` : nodeData.id\n)\n\nconst lgraphNode = computed(() => {\n  const locatorId = getLocatorIdFromNodeData(nodeData)\n  const rootGraph = app.graph?.rootGraph || app.graph\n  if (!rootGraph) return null\n  return getNodeByLocatorId(rootGraph, locatorId)\n})\n\nconst nodeMedia = computed(() => {\n  const newOutputs = nodeOutputs.nodeOutputs[nodeOutputLocatorId.value]\n  const node = lgraphNode.value\n\n  if (!node || !newOutputs?.images?.length) return undefined\n\n  const urls = nodeOutputs.getNodeImageUrls(node)\n  if (!urls?.length) return undefined\n\n  // Determine media type from previewMediaType or fallback to input slot types\n  // Note: Despite the field name \"images\", videos are also included in outputs\n  // TODO: fix the backend to return videos using the videos key instead of the images key\n  const hasVideoInput = node.inputs?.some((input) => input.type === 'VIDEO')\n  const type =\n    node.previewMediaType === 'video' ||\n    (!node.previewMediaType && hasVideoInput)\n      ? 'video'\n      : 'image'\n\n  return { type, urls } as const\n})\n\nconst nodeContainerRef = ref<HTMLDivElement>()\n\n// Drag and drop support\nconst isDraggingOver = ref(false)\n\nfunction handleDragOver(event: DragEvent) {\n  const node = lgraphNode.value\n  if (!node || !node.onDragOver) {\n    isDraggingOver.value = false\n    return\n  }\n\n  // Call the litegraph node's onDragOver callback to check if files are valid\n  const canDrop = node.onDragOver(event)\n  isDraggingOver.value = canDrop\n}\n\nfunction handleDragLeave() {\n  isDraggingOver.value = false\n}\n\nasync function handleDrop(event: DragEvent) {\n  isDraggingOver.value = false\n\n  const node = lgraphNode.value\n  if (!node || !node.onDragDrop) {\n    return\n  }\n\n  // Forward the drop event to the litegraph node's onDragDrop callback\n  await node.onDragDrop(event)\n}\n</script>\n","import type { useSettingStore } from '@/platform/settings/settingStore'\n\nlet pendingCallbacks: Array<() => Promise<void>> = []\nlet isNewUserDetermined = false\nlet isNewUserCached: boolean | null = null\n\nexport const newUserService = () => {\n  function checkIsNewUser(\n    settingStore: ReturnType<typeof useSettingStore>\n  ): boolean {\n    const isNewUserSettings =\n      Object.keys(settingStore.settingValues).length === 0 ||\n      !settingStore.get('Comfy.TutorialCompleted')\n    const hasNoWorkflow = !localStorage.getItem('workflow')\n    const hasNoPreviousWorkflow = !localStorage.getItem(\n      'Comfy.PreviousWorkflow'\n    )\n\n    return isNewUserSettings && hasNoWorkflow && hasNoPreviousWorkflow\n  }\n\n  async function registerInitCallback(callback: () => Promise<void>) {\n    if (isNewUserDetermined) {\n      if (isNewUserCached) {\n        try {\n          await callback()\n        } catch (error) {\n          console.error('New user initialization callback failed:', error)\n        }\n      }\n    } else {\n      pendingCallbacks.push(callback)\n    }\n  }\n\n  async function initializeIfNewUser(\n    settingStore: ReturnType<typeof useSettingStore>\n  ) {\n    if (isNewUserDetermined) return\n\n    isNewUserCached = checkIsNewUser(settingStore)\n    isNewUserDetermined = true\n\n    if (!isNewUserCached) {\n      pendingCallbacks = []\n      return\n    }\n\n    await settingStore.set(\n      'Comfy.InstalledVersion',\n      __COMFYUI_FRONTEND_VERSION__\n    )\n\n    for (const callback of pendingCallbacks) {\n      try {\n        await callback()\n      } catch (error) {\n        console.error('New user initialization callback failed:', error)\n      }\n    }\n\n    pendingCallbacks = []\n  }\n\n  function isNewUser(): boolean | null {\n    return isNewUserDetermined ? isNewUserCached : null\n  }\n\n  return {\n    registerInitCallback,\n    initializeIfNewUser,\n    isNewUser\n  }\n}\n","<template>\n  <div\n    v-if=\"showVueNodesBanner\"\n    class=\"pointer-events-auto relative w-full h-10 bg-gradient-to-r from-blue-600 to-blue-700 flex items-center justify-center px-4\"\n  >\n    <div class=\"flex items-center\">\n      <i class=\"icon-[lucide--rocket]\"></i>\n      <span class=\"pl-2 text-sm\">{{ $t('vueNodesBanner.message') }}</span>\n      <Button\n        class=\"cursor-pointer bg-transparent rounded h-7 px-3 border border-white text-white ml-4 text-xs\"\n        @click=\"handleTryItOut\"\n      >\n        {{ $t('vueNodesBanner.tryItOut') }}\n      </Button>\n    </div>\n    <Button\n      class=\"cursor-pointer bg-transparent border-0 outline-0 grid place-items-center absolute right-4\"\n      unstyled\n      @click=\"handleDismiss\"\n    >\n      <i class=\"w-5 h-5 icon-[lucide--x]\"></i>\n    </Button>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useLocalStorage } from '@vueuse/core'\nimport Button from 'primevue/button'\nimport { computed } from 'vue'\n\nimport { useSettingStore } from '@/platform/settings/settingStore'\n\nconst STORAGE_KEY = 'vueNodesBannerDismissed'\n\nconst settingStore = useSettingStore()\nconst bannerDismissed = useLocalStorage(STORAGE_KEY, false)\n\nconst vueNodesEnabled = computed(() => {\n  try {\n    return settingStore.get('Comfy.VueNodes.Enabled') ?? false\n  } catch {\n    return false\n  }\n})\n\nconst showVueNodesBanner = computed(() => {\n  if (vueNodesEnabled.value) {\n    return false\n  }\n\n  if (bannerDismissed.value) {\n    return false\n  }\n\n  return true\n})\n\nconst handleDismiss = (): void => {\n  bannerDismissed.value = true\n}\n\nconst handleTryItOut = async (): Promise<void> => {\n  try {\n    await settingStore.set('Comfy.VueNodes.Enabled', true)\n  } catch (error) {\n    console.error('Failed to enable Vue nodes:', error)\n  } finally {\n    handleDismiss()\n  }\n}\n</script>\n","<template>\n  <!-- Load splitter overlay only after comfyApp is ready. -->\n  <!-- If load immediately, the top-level splitter stateKey won't be correctly\n  synced with the stateStorage (localStorage). -->\n  <LiteGraphCanvasSplitterOverlay v-if=\"comfyAppReady\">\n    <template v-if=\"showUI\" #workflow-tabs>\n      <TryVueNodeBanner />\n      <div\n        v-if=\"workflowTabsPosition === 'Topbar'\"\n        class=\"workflow-tabs-container pointer-events-auto relative h-9.5 w-full\"\n      >\n        <!-- Native drag area for Electron -->\n        <div\n          v-if=\"isNativeWindow() && workflowTabsPosition !== 'Topbar'\"\n          class=\"app-drag fixed top-0 left-0 z-10 h-[var(--comfy-topbar-height)] w-full\"\n        />\n        <div class=\"flex h-full items-center\">\n          <WorkflowTabs />\n          <TopbarBadges />\n        </div>\n      </div>\n    </template>\n    <template v-if=\"showUI\" #side-toolbar>\n      <SideToolbar />\n    </template>\n    <template v-if=\"showUI\" #side-bar-panel>\n      <div\n        class=\"sidebar-content-container h-full w-full overflow-x-hidden overflow-y-auto\"\n      >\n        <ExtensionSlot v-if=\"activeSidebarTab\" :extension=\"activeSidebarTab\" />\n      </div>\n    </template>\n    <template v-if=\"showUI\" #topmenu>\n      <TopMenuSection />\n    </template>\n    <template v-if=\"showUI\" #bottom-panel>\n      <BottomPanel />\n    </template>\n    <template #graph-canvas-panel>\n      <GraphCanvasMenu v-if=\"canvasMenuEnabled\" class=\"pointer-events-auto\" />\n      <MiniMap\n        v-if=\"comfyAppReady && minimapEnabled && showUI\"\n        class=\"pointer-events-auto\"\n      />\n    </template>\n  </LiteGraphCanvasSplitterOverlay>\n  <canvas\n    id=\"graph-canvas\"\n    ref=\"canvasRef\"\n    tabindex=\"1\"\n    class=\"absolute inset-0 size-full touch-none\"\n  />\n\n  <!-- TransformPane for Vue node rendering -->\n  <TransformPane\n    v-if=\"shouldRenderVueNodes && comfyApp.canvas && comfyAppReady\"\n    :canvas=\"comfyApp.canvas\"\n    @transform-update=\"handleTransformUpdate\"\n    @wheel.capture=\"canvasInteractions.forwardEventToCanvas\"\n  >\n    <!-- Vue nodes rendered based on graph nodes -->\n    <LGraphNode\n      v-for=\"nodeData in allNodes\"\n      :key=\"nodeData.id\"\n      :node-data=\"nodeData\"\n      :error=\"\n        executionStore.lastExecutionError?.node_id === nodeData.id\n          ? 'Execution error'\n          : null\n      \"\n      :zoom-level=\"canvasStore.canvas?.ds?.scale || 1\"\n      :data-node-id=\"nodeData.id\"\n    />\n  </TransformPane>\n\n  <NodeTooltip v-if=\"tooltipEnabled\" />\n  <NodeSearchboxPopover ref=\"nodeSearchboxPopoverRef\" />\n\n  <!-- Initialize components after comfyApp is ready. useAbsolutePosition requires\n  canvasStore.canvas to be initialized. -->\n  <template v-if=\"comfyAppReady\">\n    <TitleEditor />\n    <SelectionToolbox v-if=\"selectionToolboxEnabled\" />\n    <NodeOptions />\n    <!-- Render legacy DOM widgets only when Vue nodes are disabled -->\n    <DomWidgets v-if=\"!shouldRenderVueNodes\" />\n  </template>\n</template>\n\n<script setup lang=\"ts\">\nimport { useEventListener, whenever } from '@vueuse/core'\nimport {\n  computed,\n  nextTick,\n  onMounted,\n  onUnmounted,\n  ref,\n  shallowRef,\n  watch,\n  watchEffect\n} from 'vue'\n\nimport LiteGraphCanvasSplitterOverlay from '@/components/LiteGraphCanvasSplitterOverlay.vue'\nimport TopMenuSection from '@/components/TopMenuSection.vue'\nimport BottomPanel from '@/components/bottomPanel/BottomPanel.vue'\nimport ExtensionSlot from '@/components/common/ExtensionSlot.vue'\nimport DomWidgets from '@/components/graph/DomWidgets.vue'\nimport GraphCanvasMenu from '@/components/graph/GraphCanvasMenu.vue'\nimport NodeTooltip from '@/components/graph/NodeTooltip.vue'\nimport SelectionToolbox from '@/components/graph/SelectionToolbox.vue'\nimport TitleEditor from '@/components/graph/TitleEditor.vue'\nimport NodeOptions from '@/components/graph/selectionToolbox/NodeOptions.vue'\nimport NodeSearchboxPopover from '@/components/searchbox/NodeSearchBoxPopover.vue'\nimport SideToolbar from '@/components/sidebar/SideToolbar.vue'\nimport TopbarBadges from '@/components/topbar/TopbarBadges.vue'\nimport WorkflowTabs from '@/components/topbar/WorkflowTabs.vue'\nimport { useChainCallback } from '@/composables/functional/useChainCallback'\nimport type { VueNodeData } from '@/composables/graph/useGraphNodeManager'\nimport { useViewportCulling } from '@/composables/graph/useViewportCulling'\nimport { useVueNodeLifecycle } from '@/composables/graph/useVueNodeLifecycle'\nimport { useNodeBadge } from '@/composables/node/useNodeBadge'\nimport { useCanvasDrop } from '@/composables/useCanvasDrop'\nimport { useContextMenuTranslation } from '@/composables/useContextMenuTranslation'\nimport { useCopy } from '@/composables/useCopy'\nimport { useGlobalLitegraph } from '@/composables/useGlobalLitegraph'\nimport { usePaste } from '@/composables/usePaste'\nimport { useVueFeatureFlags } from '@/composables/useVueFeatureFlags'\nimport { i18n, t } from '@/i18n'\nimport { LiteGraph } from '@/lib/litegraph/src/litegraph'\nimport { useLitegraphSettings } from '@/platform/settings/composables/useLitegraphSettings'\nimport { CORE_SETTINGS } from '@/platform/settings/constants/coreSettings'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useToastStore } from '@/platform/updates/common/toastStore'\nimport { useWorkflowService } from '@/platform/workflow/core/services/workflowService'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { useWorkflowAutoSave } from '@/platform/workflow/persistence/composables/useWorkflowAutoSave'\nimport { useWorkflowPersistence } from '@/platform/workflow/persistence/composables/useWorkflowPersistence'\nimport { useCanvasStore } from '@/renderer/core/canvas/canvasStore'\nimport { useCanvasInteractions } from '@/renderer/core/canvas/useCanvasInteractions'\nimport TransformPane from '@/renderer/core/layout/transform/TransformPane.vue'\nimport MiniMap from '@/renderer/extensions/minimap/MiniMap.vue'\nimport LGraphNode from '@/renderer/extensions/vueNodes/components/LGraphNode.vue'\nimport { UnauthorizedError, api } from '@/scripts/api'\nimport { app as comfyApp } from '@/scripts/app'\nimport { ChangeTracker } from '@/scripts/changeTracker'\nimport { IS_CONTROL_WIDGET, updateControlWidgetLabel } from '@/scripts/widgets'\nimport { useColorPaletteService } from '@/services/colorPaletteService'\nimport { newUserService } from '@/services/newUserService'\nimport { useCommandStore } from '@/stores/commandStore'\nimport { useExecutionStore } from '@/stores/executionStore'\nimport { useNodeDefStore } from '@/stores/nodeDefStore'\nimport { useColorPaletteStore } from '@/stores/workspace/colorPaletteStore'\nimport { useSearchBoxStore } from '@/stores/workspace/searchBoxStore'\nimport { useWorkspaceStore } from '@/stores/workspaceStore'\nimport { isNativeWindow } from '@/utils/envUtil'\n\nimport TryVueNodeBanner from '../topbar/TryVueNodeBanner.vue'\n\nconst emit = defineEmits<{\n  ready: []\n}>()\nconst canvasRef = ref<HTMLCanvasElement | null>(null)\nconst nodeSearchboxPopoverRef = shallowRef<InstanceType<\n  typeof NodeSearchboxPopover\n> | null>(null)\nconst settingStore = useSettingStore()\nconst nodeDefStore = useNodeDefStore()\nconst workspaceStore = useWorkspaceStore()\nconst canvasStore = useCanvasStore()\nconst executionStore = useExecutionStore()\nconst toastStore = useToastStore()\nconst colorPaletteStore = useColorPaletteStore()\nconst colorPaletteService = useColorPaletteService()\nconst canvasInteractions = useCanvasInteractions()\n\nconst betaMenuEnabled = computed(\n  () => settingStore.get('Comfy.UseNewMenu') !== 'Disabled'\n)\nconst workflowTabsPosition = computed(() =>\n  settingStore.get('Comfy.Workflow.WorkflowTabsPosition')\n)\nconst canvasMenuEnabled = computed(() =>\n  settingStore.get('Comfy.Graph.CanvasMenu')\n)\nconst tooltipEnabled = computed(() => settingStore.get('Comfy.EnableTooltips'))\nconst selectionToolboxEnabled = computed(() =>\n  settingStore.get('Comfy.Canvas.SelectionToolbox')\n)\nconst activeSidebarTab = computed(() => {\n  return workspaceStore.sidebarTab.activeSidebarTab\n})\nconst showUI = computed(\n  () => !workspaceStore.focusMode && betaMenuEnabled.value\n)\n\nconst minimapEnabled = computed(() => settingStore.get('Comfy.Minimap.Visible'))\n\n// Feature flags\nconst { shouldRenderVueNodes } = useVueFeatureFlags()\n\n// Vue node system\nconst vueNodeLifecycle = useVueNodeLifecycle()\nconst { handleTransformUpdate } = useViewportCulling()\n\nconst handleVueNodeLifecycleReset = async () => {\n  if (shouldRenderVueNodes.value) {\n    vueNodeLifecycle.disposeNodeManagerAndSyncs()\n    await nextTick()\n    vueNodeLifecycle.initializeNodeManager()\n  }\n}\n\nwatch(() => canvasStore.currentGraph, handleVueNodeLifecycleReset)\n\nwatch(\n  () => canvasStore.isInSubgraph,\n  async (newValue, oldValue) => {\n    if (oldValue && !newValue) {\n      useWorkflowStore().updateActiveGraph()\n    }\n    await handleVueNodeLifecycleReset()\n  }\n)\n\nconst allNodes = computed((): VueNodeData[] =>\n  Array.from(vueNodeLifecycle.nodeManager.value?.vueNodeData?.values() ?? [])\n)\n\nwatchEffect(() => {\n  LiteGraph.nodeOpacity = settingStore.get('Comfy.Node.Opacity')\n})\nwatchEffect(() => {\n  LiteGraph.nodeLightness = colorPaletteStore.completedActivePalette.light_theme\n    ? 0.5\n    : undefined\n})\n\nwatchEffect(() => {\n  nodeDefStore.showDeprecated = settingStore.get('Comfy.Node.ShowDeprecated')\n})\n\nwatchEffect(() => {\n  nodeDefStore.showExperimental = settingStore.get(\n    'Comfy.Node.ShowExperimental'\n  )\n})\n\nwatchEffect(() => {\n  const spellcheckEnabled = settingStore.get('Comfy.TextareaWidget.Spellcheck')\n  const textareas = document.querySelectorAll<HTMLTextAreaElement>(\n    'textarea.comfy-multiline-input'\n  )\n\n  textareas.forEach((textarea: HTMLTextAreaElement) => {\n    textarea.spellcheck = spellcheckEnabled\n    // Force recheck to ensure visual update\n    textarea.focus()\n    textarea.blur()\n  })\n})\n\nwatch(\n  () => settingStore.get('Comfy.WidgetControlMode'),\n  () => {\n    if (!canvasStore.canvas) return\n\n    for (const n of comfyApp.graph.nodes) {\n      if (!n.widgets) continue\n      for (const w of n.widgets) {\n        if (w[IS_CONTROL_WIDGET]) {\n          updateControlWidgetLabel(w)\n          if (w.linkedWidgets) {\n            for (const l of w.linkedWidgets) {\n              updateControlWidgetLabel(l)\n            }\n          }\n        }\n      }\n    }\n    comfyApp.graph.setDirtyCanvas(true)\n  }\n)\n\nwatch(\n  [() => canvasStore.canvas, () => settingStore.get('Comfy.ColorPalette')],\n  async ([canvas, currentPaletteId]) => {\n    if (!canvas) return\n\n    await colorPaletteService.loadColorPalette(currentPaletteId)\n  }\n)\n\nwatch(\n  () => settingStore.get('Comfy.Canvas.BackgroundImage'),\n  async () => {\n    if (!canvasStore.canvas) return\n    const currentPaletteId = colorPaletteStore.activePaletteId\n    if (!currentPaletteId) return\n\n    // Reload color palette to apply background image\n    await colorPaletteService.loadColorPalette(currentPaletteId)\n    // Mark background canvas as dirty\n    canvasStore.canvas.setDirty(false, true)\n  }\n)\nwatch(\n  () => colorPaletteStore.activePaletteId,\n  async (newValue) => {\n    await settingStore.set('Comfy.ColorPalette', newValue)\n  }\n)\n\n// Update the progress of executing nodes\nwatch(\n  () =>\n    [executionStore.nodeLocationProgressStates, canvasStore.canvas] as const,\n  ([nodeLocationProgressStates, canvas]) => {\n    if (!canvas?.graph) return\n    for (const node of canvas.graph.nodes) {\n      const nodeLocatorId = useWorkflowStore().nodeIdToNodeLocatorId(node.id)\n      const progressState = nodeLocationProgressStates[nodeLocatorId]\n      if (progressState && progressState.state === 'running') {\n        node.progress = progressState.value / progressState.max\n      } else {\n        node.progress = undefined\n      }\n    }\n\n    // Force canvas redraw to ensure progress updates are visible\n    canvas.graph.setDirtyCanvas(true, false)\n  },\n  { deep: true }\n)\n\n// Update node slot errors for LiteGraph nodes\n// (Vue nodes read from store directly)\nwatch(\n  () => executionStore.lastNodeErrors,\n  (lastNodeErrors) => {\n    if (!comfyApp.graph) return\n\n    for (const node of comfyApp.graph.nodes) {\n      // Clear existing errors\n      for (const slot of node.inputs) {\n        delete slot.hasErrors\n      }\n      for (const slot of node.outputs) {\n        delete slot.hasErrors\n      }\n\n      const nodeErrors = lastNodeErrors?.[node.id]\n      if (!nodeErrors) continue\n\n      const validErrors = nodeErrors.errors.filter(\n        (error) => error.extra_info?.input_name !== undefined\n      )\n\n      validErrors.forEach((error) => {\n        const inputName = error.extra_info!.input_name!\n        const inputIndex = node.findInputSlot(inputName)\n        if (inputIndex !== -1) {\n          node.inputs[inputIndex].hasErrors = true\n        }\n      })\n    }\n\n    comfyApp.canvas.draw(true, true)\n  }\n)\n\nuseEventListener(\n  canvasRef,\n  'litegraph:no-items-selected',\n  () => {\n    toastStore.add({\n      severity: 'warn',\n      summary: t('toastMessages.nothingSelected'),\n      life: 2000\n    })\n  },\n  { passive: true }\n)\n\nconst loadCustomNodesI18n = async () => {\n  try {\n    const i18nData = await api.getCustomNodesI18n()\n    Object.entries(i18nData).forEach(([locale, message]) => {\n      i18n.global.mergeLocaleMessage(locale, message)\n    })\n  } catch (error) {\n    console.error('Failed to load custom nodes i18n', error)\n  }\n}\n\nconst comfyAppReady = ref(false)\nconst workflowPersistence = useWorkflowPersistence()\nuseCanvasDrop(canvasRef)\nuseLitegraphSettings()\nuseNodeBadge()\n\nonMounted(async () => {\n  useGlobalLitegraph()\n  useContextMenuTranslation()\n  useCopy()\n  usePaste()\n  useWorkflowAutoSave()\n  useVueFeatureFlags()\n\n  comfyApp.vueAppReady = true\n\n  workspaceStore.spinner = true\n  // ChangeTracker needs to be initialized before setup, as it will overwrite\n  // some listeners of litegraph canvas.\n  ChangeTracker.init()\n  await loadCustomNodesI18n()\n  try {\n    await settingStore.loadSettingValues()\n  } catch (error) {\n    if (error instanceof UnauthorizedError) {\n      localStorage.removeItem('Comfy.userId')\n      localStorage.removeItem('Comfy.userName')\n      window.location.reload()\n    } else {\n      throw error\n    }\n  }\n  CORE_SETTINGS.forEach(settingStore.addSetting)\n\n  await newUserService().initializeIfNewUser(settingStore)\n\n  // @ts-expect-error fixme ts strict error\n  await comfyApp.setup(canvasRef.value)\n  canvasStore.canvas = comfyApp.canvas\n  canvasStore.canvas.render_canvas_border = false\n  workspaceStore.spinner = false\n  useSearchBoxStore().setPopoverRef(nodeSearchboxPopoverRef.value)\n\n  window.app = comfyApp\n  window.graph = comfyApp.graph\n\n  comfyAppReady.value = true\n\n  vueNodeLifecycle.setupEmptyGraphListener()\n\n  comfyApp.canvas.onSelectionChange = useChainCallback(\n    comfyApp.canvas.onSelectionChange,\n    () => canvasStore.updateSelectedItems()\n  )\n\n  // Load color palette\n  colorPaletteStore.customPalettes = settingStore.get(\n    'Comfy.CustomColorPalettes'\n  )\n\n  // Restore saved workflow and workflow tabs state\n  await workflowPersistence.initializeWorkflow()\n  workflowPersistence.restoreWorkflowTabsState()\n\n  // Load template from URL if present\n  await workflowPersistence.loadTemplateFromUrlIfPresent()\n\n  // Initialize release store to fetch releases from comfy-api (fire-and-forget)\n  const { useReleaseStore } = await import(\n    '@/platform/updates/common/releaseStore'\n  )\n  const releaseStore = useReleaseStore()\n  void releaseStore.initialize()\n\n  // Start watching for locale change after the initial value is loaded.\n  watch(\n    () => settingStore.get('Comfy.Locale'),\n    async () => {\n      await useCommandStore().execute('Comfy.RefreshNodeDefinitions')\n      await useWorkflowService().reloadCurrentWorkflow()\n    }\n  )\n\n  whenever(\n    () => useCanvasStore().canvas,\n    (canvas) => {\n      useEventListener(canvas.canvas, 'litegraph:set-graph', () => {\n        useWorkflowStore().updateActiveGraph()\n      })\n    },\n    { immediate: true }\n  )\n\n  emit('ready')\n})\n\nonUnmounted(() => {\n  vueNodeLifecycle.cleanup()\n})\n</script>\n","<template>\n  <Toast group=\"reroute-migration\">\n    <template #message>\n      <div class=\"flex flex-auto flex-col items-start\">\n        <div class=\"my-4 text-lg font-medium\">\n          {{ t('toastMessages.migrateToLitegraphReroute') }}\n        </div>\n        <Button\n          class=\"self-end\"\n          size=\"small\"\n          :label=\"t('g.migrate')\"\n          severity=\"warn\"\n          @click=\"migrateToLitegraphReroute\"\n        />\n      </div>\n    </template>\n  </Toast>\n</template>\n\n<script setup lang=\"ts\">\nimport { useToast } from 'primevue'\nimport Button from 'primevue/button'\nimport Toast from 'primevue/toast'\nimport { useI18n } from 'vue-i18n'\n\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport type { WorkflowJSON04 } from '@/platform/workflow/validation/schemas/workflowSchema'\nimport { app } from '@/scripts/app'\nimport { migrateLegacyRerouteNodes } from '@/utils/migration/migrateReroute'\n\nconst { t } = useI18n()\nconst toast = useToast()\n\nconst workflowStore = useWorkflowStore()\nconst migrateToLitegraphReroute = async () => {\n  const workflowJSON = app.graph.serialize() as unknown as WorkflowJSON04\n  const migratedWorkflowJSON = migrateLegacyRerouteNodes(workflowJSON)\n  await app.loadGraphData(\n    migratedWorkflowJSON,\n    false,\n    false,\n    workflowStore.activeWorkflow\n  )\n  toast.removeGroup('reroute-migration')\n}\n</script>\n","<template>\n  <Toast\n    group=\"vue-nodes-migration\"\n    position=\"bottom-center\"\n    class=\"w-auto\"\n    @close=\"handleClose\"\n  >\n    <template #message>\n      <div class=\"flex flex-auto items-center justify-between gap-4\">\n        <span class=\"whitespace-nowrap\">{{\n          t('vueNodesMigration.message')\n        }}</span>\n        <Button\n          class=\"whitespace-nowrap\"\n          size=\"small\"\n          :label=\"t('vueNodesMigration.button')\"\n          text\n          @click=\"switchBack\"\n        />\n      </div>\n    </template>\n  </Toast>\n  <Toast\n    group=\"vue-nodes-check-main-menu\"\n    position=\"bottom-center\"\n    class=\"w-auto\"\n  >\n    <template #message>\n      <div class=\"flex flex-auto items-center justify-between gap-4\">\n        <span class=\"whitespace-nowrap\">{{\n          t('vueNodesMigrationMainMenu.message')\n        }}</span>\n      </div>\n    </template>\n  </Toast>\n</template>\n\n<script setup lang=\"ts\">\nimport { useToast } from 'primevue'\nimport Button from 'primevue/button'\nimport Toast from 'primevue/toast'\nimport { useI18n } from 'vue-i18n'\n\nimport { useVueNodesMigrationDismissed } from '@/composables/useVueNodesMigrationDismissed'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useToastStore } from '@/platform/updates/common/toastStore'\n\nconst { t } = useI18n()\nconst toast = useToast()\nconst isDismissed = useVueNodesMigrationDismissed()\n\nconst switchBack = async () => {\n  await disableVueNodes()\n  toast.removeGroup('vue-nodes-migration')\n  isDismissed.value = true\n  showMainMenuToast()\n}\n\nconst handleClose = () => {\n  isDismissed.value = true\n  showMainMenuToast()\n}\n\nconst disableVueNodes = async () => {\n  await useSettingStore().set('Comfy.VueNodes.Enabled', false)\n  useTelemetry()?.trackUiButtonClicked({\n    button_id: `vue_nodes_migration_toast_switch_back_clicked`\n  })\n}\n\nconst showMainMenuToast = () => {\n  useToastStore().add({\n    group: 'vue-nodes-check-main-menu',\n    severity: 'info',\n    life: 5000\n  })\n}\n</script>\n","import { useTitle } from '@vueuse/core'\nimport { computed } from 'vue'\n\nimport { t } from '@/i18n'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { useExecutionStore } from '@/stores/executionStore'\nimport { useWorkspaceStore } from '@/stores/workspaceStore'\n\nconst DEFAULT_TITLE = 'ComfyUI'\nconst TITLE_SUFFIX = ' - ComfyUI'\n\nexport const useBrowserTabTitle = () => {\n  const executionStore = useExecutionStore()\n  const settingStore = useSettingStore()\n  const workflowStore = useWorkflowStore()\n  const workspaceStore = useWorkspaceStore()\n\n  const executionText = computed(() =>\n    executionStore.isIdle\n      ? ''\n      : `[${Math.round(executionStore.executionProgress * 100)}%]`\n  )\n\n  const newMenuEnabled = computed(\n    () => settingStore.get('Comfy.UseNewMenu') !== 'Disabled'\n  )\n\n  const isAutoSaveEnabled = computed(\n    () => settingStore.get('Comfy.Workflow.AutoSave') === 'after delay'\n  )\n\n  const isActiveWorkflowModified = computed(\n    () => !!workflowStore.activeWorkflow?.isModified\n  )\n  const isActiveWorkflowPersisted = computed(\n    () => !!workflowStore.activeWorkflow?.isPersisted\n  )\n\n  const shouldShowUnsavedIndicator = computed(() => {\n    if (workspaceStore.shiftDown) return false\n    if (isAutoSaveEnabled.value) return false\n    if (!isActiveWorkflowPersisted.value) return true\n    if (isActiveWorkflowModified.value) return true\n    return false\n  })\n\n  const isUnsavedText = computed(() =>\n    shouldShowUnsavedIndicator.value ? ' *' : ''\n  )\n  const workflowNameText = computed(() => {\n    const workflowName = workflowStore.activeWorkflow?.filename\n    return workflowName\n      ? isUnsavedText.value + workflowName + TITLE_SUFFIX\n      : DEFAULT_TITLE\n  })\n\n  const nodeExecutionTitle = computed(() => {\n    // Check if any nodes are in progress\n    const nodeProgressEntries = Object.entries(\n      executionStore.nodeProgressStates\n    )\n    const runningNodes = nodeProgressEntries.filter(\n      ([_, state]) => state.state === 'running'\n    )\n\n    if (runningNodes.length === 0) {\n      return ''\n    }\n\n    // If multiple nodes are running\n    if (runningNodes.length > 1) {\n      return `${executionText.value}[${runningNodes.length} ${t('g.nodesRunning', 'nodes running')}]`\n    }\n\n    // If only one node is running\n    const [nodeId, state] = runningNodes[0]\n    const progress = Math.round((state.value / state.max) * 100)\n    const nodeType =\n      executionStore.activePrompt?.workflow?.changeTracker?.activeState.nodes.find(\n        (n) => String(n.id) === nodeId\n      )?.type || 'Node'\n\n    return `${executionText.value}[${progress}%] ${nodeType}`\n  })\n\n  const workflowTitle = computed(\n    () =>\n      executionText.value +\n      (newMenuEnabled.value ? workflowNameText.value : DEFAULT_TITLE)\n  )\n\n  const title = computed(() => nodeExecutionTitle.value || workflowTitle.value)\n  useTitle(title)\n}\n","<template>\n  <div class=\"size-full bg-modal-panel-background pr-6 pb-8 pl-4\">\n    <slot></slot>\n  </div>\n</template>\n","<template>\n  <BaseModalLayout :content-title=\"$t('assetBrowser.checkpoints')\">\n    <template #leftPanel>\n      <LeftSidePanel v-model=\"selectedNavItem\" :nav-items=\"tempNavigation\">\n        <template #header-icon>\n          <i class=\"text-neutral icon-[lucide--puzzle]\" />\n        </template>\n        <template #header-title>\n          <span class=\"text-neutral text-base\">{{ $t('g.title') }}</span>\n        </template>\n      </LeftSidePanel>\n    </template>\n\n    <template #header>\n      <SearchBox v-model=\"searchQuery\" size=\"lg\" class=\"max-w-[384px]\" />\n    </template>\n\n    <template #header-right-area>\n      <div class=\"flex gap-2\">\n        <IconTextButton\n          type=\"primary\"\n          :label=\"$t('g.upload')\"\n          @click=\"() => {}\"\n        >\n          <template #icon>\n            <i class=\"icon-[lucide--upload]\" />\n          </template>\n        </IconTextButton>\n        <MoreButton>\n          <template #default=\"{ close }\">\n            <IconTextButton\n              type=\"secondary\"\n              label=\"Settings\"\n              @click=\"\n                () => {\n                  close()\n                }\n              \"\n            >\n              <template #icon>\n                <i class=\"icon-[lucide--download]\" />\n              </template>\n            </IconTextButton>\n            <IconTextButton\n              type=\"primary\"\n              label=\"Profile\"\n              @click=\"\n                () => {\n                  close()\n                }\n              \"\n            >\n              <template #icon>\n                <i class=\"icon-[lucide--scroll]\" />\n              </template>\n            </IconTextButton>\n          </template>\n        </MoreButton>\n      </div>\n    </template>\n\n    <template #contentFilter>\n      <div class=\"relative flex gap-2 px-6 pb-4\">\n        <MultiSelect\n          v-model=\"selectedFrameworks\"\n          v-model:search-query=\"searchText\"\n          class=\"w-[250px]\"\n          label=\"Select Frameworks\"\n          :options=\"frameworkOptions\"\n          :show-search-box=\"true\"\n          :show-selected-count=\"true\"\n          :show-clear-button=\"true\"\n        />\n        <MultiSelect\n          v-model=\"selectedProjects\"\n          label=\"Select Projects\"\n          :options=\"projectOptions\"\n        />\n        <SingleSelect\n          v-model=\"selectedSort\"\n          label=\"Sorting Type\"\n          :options=\"sortOptions\"\n          class=\"w-[135px]\"\n        >\n          <template #icon>\n            <i class=\"icon-[lucide--filter]\" />\n          </template>\n        </SingleSelect>\n      </div>\n    </template>\n\n    <template #content>\n      <!-- Card Examples -->\n      <div :style=\"gridStyle\">\n        <CardContainer v-for=\"i in 100\" :key=\"i\" size=\"regular\">\n          <template #top>\n            <CardTop ratio=\"landscape\">\n              <template #default>\n                <div class=\"h-full w-full bg-blue-500\"></div>\n              </template>\n              <template #top-right>\n                <IconButton\n                  class=\"!bg-white !text-neutral-900\"\n                  @click=\"() => {}\"\n                >\n                  <i class=\"icon-[lucide--info]\" />\n                </IconButton>\n              </template>\n              <template #bottom-right>\n                <SquareChip label=\"png\" />\n                <SquareChip label=\"1.2 MB\" />\n                <SquareChip label=\"LoRA\">\n                  <template #icon>\n                    <i class=\"icon-[lucide--folder]\" />\n                  </template>\n                </SquareChip>\n              </template>\n            </CardTop>\n          </template>\n          <template #bottom>\n            <CardBottom></CardBottom>\n          </template>\n        </CardContainer>\n      </div>\n    </template>\n\n    <template #rightPanel>\n      <RightSidePanel></RightSidePanel>\n    </template>\n  </BaseModalLayout>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, provide, ref } from 'vue'\n\nimport IconButton from '@/components/button/IconButton.vue'\nimport IconTextButton from '@/components/button/IconTextButton.vue'\nimport MoreButton from '@/components/button/MoreButton.vue'\nimport CardBottom from '@/components/card/CardBottom.vue'\nimport CardContainer from '@/components/card/CardContainer.vue'\nimport CardTop from '@/components/card/CardTop.vue'\nimport SquareChip from '@/components/chip/SquareChip.vue'\nimport MultiSelect from '@/components/input/MultiSelect.vue'\nimport SearchBox from '@/components/input/SearchBox.vue'\nimport SingleSelect from '@/components/input/SingleSelect.vue'\nimport BaseModalLayout from '@/components/widget/layout/BaseModalLayout.vue'\nimport LeftSidePanel from '@/components/widget/panel/LeftSidePanel.vue'\nimport RightSidePanel from '@/components/widget/panel/RightSidePanel.vue'\nimport type { NavGroupData, NavItemData } from '@/types/navTypes'\nimport { OnCloseKey } from '@/types/widgetTypes'\nimport { createGridStyle } from '@/utils/gridUtil'\n\nconst frameworkOptions = ref([\n  { name: 'Vue', value: 'vue' },\n  { name: 'React', value: 'react' },\n  { name: 'Angular', value: 'angular' },\n  { name: 'Svelte', value: 'svelte' }\n])\n\nconst projectOptions = ref([\n  { name: 'Project A', value: 'proj-a' },\n  { name: 'Project B', value: 'proj-b' },\n  { name: 'Project C', value: 'proj-c' }\n])\n\nconst sortOptions = ref([\n  { name: 'Popular', value: 'popular' },\n  { name: 'Latest', value: 'latest' },\n  { name: 'A  Z', value: 'az' }\n])\n\nconst tempNavigation = ref<(NavItemData | NavGroupData)[]>([\n  { id: 'installed', label: 'Installed', icon: 'icon-[lucide--download]' },\n  {\n    title: 'TAGS',\n    items: [\n      { id: 'tag-sd15', label: 'SD 1.5', icon: 'icon-[lucide--tag]' },\n      { id: 'tag-sdxl', label: 'SDXL', icon: 'icon-[lucide--tag]' },\n      { id: 'tag-utility', label: 'Utility', icon: 'icon-[lucide--tag]' }\n    ]\n  },\n  {\n    title: 'CATEGORIES',\n    items: [\n      { id: 'cat-models', label: 'Models', icon: 'icon-[lucide--layers]' },\n      { id: 'cat-nodes', label: 'Nodes', icon: 'icon-[lucide--grid-3x3]' }\n    ]\n  }\n])\n\nconst { onClose } = defineProps<{\n  onClose: () => void\n}>()\n\nprovide(OnCloseKey, onClose)\n\nconst searchQuery = ref<string>('')\nconst searchText = ref<string>('')\nconst selectedFrameworks = ref([])\nconst selectedProjects = ref([])\nconst selectedSort = ref<string>('popular')\n\nconst selectedNavItem = ref<string | null>('installed')\n\nconst gridStyle = computed(() => createGridStyle())\n</script>\n","import SampleModelSelector from '@/components/widget/SampleModelSelector.vue'\nimport { useDialogService } from '@/services/dialogService'\nimport { useDialogStore } from '@/stores/dialogStore'\n\nconst DIALOG_KEY = 'global-model-selector'\n\nexport const useModelSelectorDialog = () => {\n  const dialogService = useDialogService()\n  const dialogStore = useDialogStore()\n\n  function hide() {\n    dialogStore.closeDialog({ key: DIALOG_KEY })\n  }\n\n  function show() {\n    dialogService.showLayoutDialog({\n      key: DIALOG_KEY,\n      component: SampleModelSelector,\n      props: {\n        onClose: hide\n      }\n    })\n  }\n\n  return {\n    show,\n    hide\n  }\n}\n","import { LiteGraph } from '@/lib/litegraph/src/litegraph'\nimport type { LGraphNode, Point } from '@/lib/litegraph/src/litegraph'\nimport { assetItemSchema } from '@/platform/assets/schemas/assetSchema'\nimport type { AssetItem } from '@/platform/assets/schemas/assetSchema'\nimport {\n  MISSING_TAG,\n  MODELS_TAG\n} from '@/platform/assets/services/assetService'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { app } from '@/scripts/app'\nimport { useLitegraphService } from '@/services/litegraphService'\nimport { useModelToNodeStore } from '@/stores/modelToNodeStore'\n\ninterface CreateNodeOptions {\n  position?: Point\n}\n\ntype NodeCreationErrorCode =\n  | 'INVALID_ASSET'\n  | 'NO_PROVIDER'\n  | 'NODE_CREATION_FAILED'\n  | 'MISSING_WIDGET'\n  | 'NO_GRAPH'\n\ninterface NodeCreationError {\n  code: NodeCreationErrorCode\n  message: string\n  assetId: string\n  details?: Record<string, unknown>\n}\n\ntype Result<T, E> = { success: true; value: T } | { success: false; error: E }\n\n/**\n * Creates a LiteGraph node from an asset item.\n *\n * **Boundary Function**: Bridges Vue reactive domain with LiteGraph canvas domain.\n *\n * @param asset - Asset item to create node from (Vue domain)\n * @param options - Optional position and configuration\n * @returns Result with LiteGraph node (Canvas domain) or error details\n *\n * @remarks\n * This function performs side effects on the canvas graph. Validation failures\n * return error results rather than throwing to allow graceful degradation in UI contexts.\n * Widget validation occurs before graph mutation to prevent orphaned nodes.\n */\nexport function createModelNodeFromAsset(\n  asset: AssetItem,\n  options?: CreateNodeOptions\n): Result<LGraphNode, NodeCreationError> {\n  const validatedAsset = assetItemSchema.safeParse(asset)\n\n  if (!validatedAsset.success) {\n    const errorMessage = validatedAsset.error.errors\n      .map((e) => `${e.path.join('.')}: ${e.message}`)\n      .join(', ')\n    console.error('Invalid asset item:', errorMessage)\n    return {\n      success: false,\n      error: {\n        code: 'INVALID_ASSET',\n        message: 'Asset schema validation failed',\n        assetId: asset.id,\n        details: { validationErrors: errorMessage }\n      }\n    }\n  }\n\n  const validAsset = validatedAsset.data\n\n  const userMetadata = validAsset.user_metadata\n  if (!userMetadata) {\n    console.error(`Asset ${validAsset.id} missing required user_metadata`)\n    return {\n      success: false,\n      error: {\n        code: 'INVALID_ASSET',\n        message: 'Asset missing required user_metadata',\n        assetId: validAsset.id\n      }\n    }\n  }\n\n  const filename = userMetadata.filename\n  if (typeof filename !== 'string' || filename.length === 0) {\n    console.error(\n      `Asset ${validAsset.id} has invalid user_metadata.filename (expected non-empty string, got ${typeof filename})`\n    )\n    return {\n      success: false,\n      error: {\n        code: 'INVALID_ASSET',\n        message: `Invalid filename (expected non-empty string, got ${typeof filename})`,\n        assetId: validAsset.id\n      }\n    }\n  }\n\n  if (validAsset.tags.length === 0) {\n    console.error(\n      `Asset ${validAsset.id} has no tags defined (expected at least one category tag)`\n    )\n    return {\n      success: false,\n      error: {\n        code: 'INVALID_ASSET',\n        message: 'Asset has no tags defined',\n        assetId: validAsset.id\n      }\n    }\n  }\n\n  const category = validAsset.tags.find(\n    (tag) => tag !== MODELS_TAG && tag !== MISSING_TAG\n  )\n  if (!category) {\n    console.error(\n      `Asset ${validAsset.id} has no valid category tag. Available tags: ${validAsset.tags.join(', ')} (expected tag other than '${MODELS_TAG}' or '${MISSING_TAG}')`\n    )\n    return {\n      success: false,\n      error: {\n        code: 'INVALID_ASSET',\n        message: 'Asset has no valid category tag',\n        assetId: validAsset.id,\n        details: { availableTags: validAsset.tags }\n      }\n    }\n  }\n\n  const modelToNodeStore = useModelToNodeStore()\n  const provider = modelToNodeStore.getNodeProvider(category)\n  if (!provider) {\n    console.error(`No node provider registered for category: ${category}`)\n    return {\n      success: false,\n      error: {\n        code: 'NO_PROVIDER',\n        message: `No node provider registered for category: ${category}`,\n        assetId: validAsset.id,\n        details: { category }\n      }\n    }\n  }\n\n  const litegraphService = useLitegraphService()\n  const pos = options?.position ?? litegraphService.getCanvasCenter()\n\n  const node = LiteGraph.createNode(\n    provider.nodeDef.name,\n    provider.nodeDef.display_name,\n    { pos }\n  )\n\n  if (!node) {\n    console.error(`Failed to create node for type: ${provider.nodeDef.name}`)\n    return {\n      success: false,\n      error: {\n        code: 'NODE_CREATION_FAILED',\n        message: `Failed to create node for type: ${provider.nodeDef.name}`,\n        assetId: validAsset.id,\n        details: { nodeType: provider.nodeDef.name }\n      }\n    }\n  }\n\n  const workflowStore = useWorkflowStore()\n  const targetGraph = workflowStore.isSubgraphActive\n    ? workflowStore.activeSubgraph\n    : app.canvas.graph\n\n  if (!targetGraph) {\n    console.error('No active graph available')\n    return {\n      success: false,\n      error: {\n        code: 'NO_GRAPH',\n        message: 'No active graph available',\n        assetId: validAsset.id\n      }\n    }\n  }\n\n  const widget = node.widgets?.find((w) => w.name === provider.key)\n  if (!widget) {\n    console.error(\n      `Widget ${provider.key} not found on node ${provider.nodeDef.name}`\n    )\n    return {\n      success: false,\n      error: {\n        code: 'MISSING_WIDGET',\n        message: `Widget ${provider.key} not found on node ${provider.nodeDef.name}`,\n        assetId: validAsset.id,\n        details: { widgetName: provider.key, nodeType: provider.nodeDef.name }\n      }\n    }\n  }\n\n  targetGraph.add(node)\n  widget.value = filename\n\n  return { success: true, value: node }\n}\n","import { isCloud } from '@/platform/distribution/types'\n\n/**\n * Zendesk ticket form field IDs.\n */\nconst ZENDESK_FIELDS = {\n  /** Distribution tag (cloud vs OSS) */\n  DISTRIBUTION: 'tf_42243568391700',\n  /** User email (anonymous requester) */\n  ANONYMOUS_EMAIL: 'tf_anonymous_requester_email',\n  /** User email (authenticated) */\n  EMAIL: 'tf_40029135130388',\n  /** User ID */\n  USER_ID: 'tf_42515251051412'\n} as const\n\nconst SUPPORT_BASE_URL = 'https://support.comfy.org/hc/en-us/requests/new'\n\n/**\n * Builds the support URL with optional user information for pre-filling.\n * Users without login information will still get a valid support URL without pre-fill.\n *\n * @param params - User information to pre-fill in the support form\n * @returns Complete Zendesk support URL with query parameters\n */\nexport function buildSupportUrl(params?: {\n  userEmail?: string | null\n  userId?: string | null\n}): string {\n  const searchParams = new URLSearchParams({\n    [ZENDESK_FIELDS.DISTRIBUTION]: isCloud ? 'ccloud' : 'oss'\n  })\n\n  if (params?.userEmail) {\n    searchParams.append(ZENDESK_FIELDS.ANONYMOUS_EMAIL, params.userEmail)\n    searchParams.append(ZENDESK_FIELDS.EMAIL, params.userEmail)\n  }\n  if (params?.userId) {\n    searchParams.append(ZENDESK_FIELDS.USER_ID, params.userId)\n  }\n\n  return `${SUPPORT_BASE_URL}?${searchParams.toString()}`\n}\n","import { useCurrentUser } from '@/composables/auth/useCurrentUser'\nimport { useFirebaseAuthActions } from '@/composables/auth/useFirebaseAuthActions'\nimport { useSelectedLiteGraphItems } from '@/composables/canvas/useSelectedLiteGraphItems'\nimport { useExternalLink } from '@/composables/useExternalLink'\nimport { useModelSelectorDialog } from '@/composables/useModelSelectorDialog'\nimport {\n  DEFAULT_DARK_COLOR_PALETTE,\n  DEFAULT_LIGHT_COLOR_PALETTE\n} from '@/constants/coreColorPalettes'\nimport { tryToggleWidgetPromotion } from '@/core/graph/subgraph/proxyWidgetUtils'\nimport { showSubgraphNodeDialog } from '@/core/graph/subgraph/useSubgraphNodeDialog'\nimport { t } from '@/i18n'\nimport {\n  LGraphEventMode,\n  LGraphGroup,\n  LGraphNode,\n  LiteGraph,\n  SubgraphNode\n} from '@/lib/litegraph/src/litegraph'\nimport type { Point } from '@/lib/litegraph/src/litegraph'\nimport { useAssetBrowserDialog } from '@/platform/assets/composables/useAssetBrowserDialog'\nimport { createModelNodeFromAsset } from '@/platform/assets/utils/createModelNodeFromAsset'\nimport { useSubscription } from '@/platform/cloud/subscription/composables/useSubscription'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { buildSupportUrl } from '@/platform/support/config'\nimport { useTelemetry } from '@/platform/telemetry'\nimport type { ExecutionTriggerSource } from '@/platform/telemetry/types'\nimport { useToastStore } from '@/platform/updates/common/toastStore'\nimport { useWorkflowService } from '@/platform/workflow/core/services/workflowService'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport type { ComfyWorkflow } from '@/platform/workflow/management/stores/workflowStore'\nimport {\n  useCanvasStore,\n  useTitleEditorStore\n} from '@/renderer/core/canvas/canvasStore'\nimport { layoutStore } from '@/renderer/core/layout/store/layoutStore'\nimport { selectionBounds } from '@/renderer/core/layout/utils/layoutMath'\nimport { api } from '@/scripts/api'\nimport { app } from '@/scripts/app'\nimport { useDialogService } from '@/services/dialogService'\nimport { useLitegraphService } from '@/services/litegraphService'\nimport type { ComfyCommand } from '@/stores/commandStore'\nimport { useExecutionStore } from '@/stores/executionStore'\nimport { useHelpCenterStore } from '@/stores/helpCenterStore'\nimport { useNodeOutputStore } from '@/stores/imagePreviewStore'\nimport { useQueueSettingsStore, useQueueStore } from '@/stores/queueStore'\nimport { useSubgraphNavigationStore } from '@/stores/subgraphNavigationStore'\nimport { useSubgraphStore } from '@/stores/subgraphStore'\nimport { useBottomPanelStore } from '@/stores/workspace/bottomPanelStore'\nimport { useColorPaletteStore } from '@/stores/workspace/colorPaletteStore'\nimport { useSearchBoxStore } from '@/stores/workspace/searchBoxStore'\nimport { useWorkspaceStore } from '@/stores/workspaceStore'\nimport {\n  getAllNonIoNodesInSubgraph,\n  getExecutionIdsForSelectedNodes\n} from '@/utils/graphTraversalUtil'\nimport { filterOutputNodes } from '@/utils/nodeFilterUtil'\nimport {\n  ManagerUIState,\n  useManagerState\n} from '@/workbench/extensions/manager/composables/useManagerState'\nimport { ManagerTab } from '@/workbench/extensions/manager/types/comfyManagerTypes'\n\nimport { useWorkflowTemplateSelectorDialog } from './useWorkflowTemplateSelectorDialog'\n\nconst { isActiveSubscription, showSubscriptionDialog } = useSubscription()\n\nconst moveSelectedNodesVersionAdded = '1.22.2'\n\nexport function useCoreCommands(): ComfyCommand[] {\n  const workflowService = useWorkflowService()\n  const workflowStore = useWorkflowStore()\n  const dialogService = useDialogService()\n  const colorPaletteStore = useColorPaletteStore()\n  const firebaseAuthActions = useFirebaseAuthActions()\n  const toastStore = useToastStore()\n  const canvasStore = useCanvasStore()\n  const executionStore = useExecutionStore()\n  const telemetry = useTelemetry()\n  const { staticUrls, buildDocsUrl } = useExternalLink()\n\n  const bottomPanelStore = useBottomPanelStore()\n\n  const { getSelectedNodes, toggleSelectedNodesMode } =\n    useSelectedLiteGraphItems()\n  const getTracker = () => workflowStore.activeWorkflow?.changeTracker\n\n  const moveSelectedNodes = (\n    positionUpdater: (pos: Point, gridSize: number) => Point\n  ) => {\n    const selectedNodes = getSelectedNodes()\n    if (selectedNodes.length === 0) return\n\n    const gridSize = useSettingStore().get('Comfy.SnapToGrid.GridSize')\n    selectedNodes.forEach((node) => {\n      node.pos = positionUpdater(node.pos, gridSize)\n    })\n    app.canvas.state.selectionChanged = true\n    app.canvas.setDirty(true, true)\n  }\n\n  const commands = [\n    {\n      id: 'Comfy.NewBlankWorkflow',\n      icon: 'pi pi-plus',\n      label: 'New Blank Workflow',\n      menubarLabel: 'New',\n      category: 'essentials' as const,\n      function: async () => {\n        const previousWorkflowHadNodes = app.graph._nodes.length > 0\n        await workflowService.loadBlankWorkflow()\n        telemetry?.trackWorkflowCreated({\n          workflow_type: 'blank',\n          previous_workflow_had_nodes: previousWorkflowHadNodes\n        })\n      }\n    },\n    {\n      id: 'Comfy.OpenWorkflow',\n      icon: 'pi pi-folder-open',\n      label: 'Open Workflow',\n      menubarLabel: 'Open',\n      category: 'essentials' as const,\n      function: () => {\n        app.ui.loadFile()\n      }\n    },\n    {\n      id: 'Comfy.LoadDefaultWorkflow',\n      icon: 'pi pi-code',\n      label: 'Load Default Workflow',\n      function: async () => {\n        const previousWorkflowHadNodes = app.graph._nodes.length > 0\n        await workflowService.loadDefaultWorkflow()\n        telemetry?.trackWorkflowCreated({\n          workflow_type: 'default',\n          previous_workflow_had_nodes: previousWorkflowHadNodes\n        })\n      }\n    },\n    {\n      id: 'Comfy.SaveWorkflow',\n      icon: 'pi pi-save',\n      label: 'Save Workflow',\n      menubarLabel: 'Save',\n      category: 'essentials' as const,\n      function: async () => {\n        const workflow = useWorkflowStore().activeWorkflow as ComfyWorkflow\n        if (!workflow) return\n\n        await workflowService.saveWorkflow(workflow)\n      }\n    },\n    {\n      id: 'Comfy.PublishSubgraph',\n      icon: 'pi pi-save',\n      label: 'Publish Subgraph',\n      menubarLabel: 'Publish',\n      function: async () => {\n        await useSubgraphStore().publishSubgraph()\n      }\n    },\n    {\n      id: 'Comfy.SaveWorkflowAs',\n      icon: 'pi pi-save',\n      label: 'Save Workflow As',\n      menubarLabel: 'Save As',\n      category: 'essentials' as const,\n      function: async () => {\n        const workflow = useWorkflowStore().activeWorkflow as ComfyWorkflow\n        if (!workflow) return\n\n        await workflowService.saveWorkflowAs(workflow)\n      }\n    },\n    {\n      id: 'Comfy.ExportWorkflow',\n      icon: 'pi pi-download',\n      label: 'Export Workflow',\n      menubarLabel: 'Export',\n      category: 'essentials' as const,\n      function: async () => {\n        await workflowService.exportWorkflow('workflow', 'workflow')\n      }\n    },\n    {\n      id: 'Comfy.ExportWorkflowAPI',\n      icon: 'pi pi-download',\n      label: 'Export Workflow (API Format)',\n      menubarLabel: 'Export (API)',\n      function: async () => {\n        await workflowService.exportWorkflow('workflow_api', 'output')\n      }\n    },\n    {\n      id: 'Comfy.Undo',\n      icon: 'pi pi-undo',\n      label: 'Undo',\n      category: 'essentials' as const,\n      function: async () => {\n        await getTracker()?.undo?.()\n      }\n    },\n    {\n      id: 'Comfy.Redo',\n      icon: 'pi pi-refresh',\n      label: 'Redo',\n      category: 'essentials' as const,\n      function: async () => {\n        await getTracker()?.redo?.()\n      }\n    },\n    {\n      id: 'Comfy.ClearWorkflow',\n      icon: 'pi pi-trash',\n      label: 'Clear Workflow',\n      category: 'essentials' as const,\n      function: () => {\n        const settingStore = useSettingStore()\n        if (\n          !settingStore.get('Comfy.ConfirmClear') ||\n          confirm('Clear workflow?')\n        ) {\n          app.clean()\n          if (app.canvas.subgraph) {\n            // `clear` is not implemented on subgraphs and the parent class's\n            // (`LGraph`) `clear` breaks the subgraph structure. For subgraphs,\n            // just clear the nodes but preserve input/output nodes and structure\n            const subgraph = app.canvas.subgraph\n            const nonIoNodes = getAllNonIoNodesInSubgraph(subgraph)\n            nonIoNodes.forEach((node) => subgraph.remove(node))\n          }\n          api.dispatchCustomEvent('graphCleared')\n        }\n      }\n    },\n    {\n      id: 'Comfy.Canvas.ResetView',\n      icon: 'pi pi-expand',\n      label: 'Reset View',\n      function: () => {\n        useLitegraphService().resetView()\n      }\n    },\n    {\n      id: 'Comfy.OpenClipspace',\n      icon: 'pi pi-clipboard',\n      label: 'Clipspace',\n      function: () => {\n        app.openClipspace()\n      }\n    },\n    {\n      id: 'Comfy.RefreshNodeDefinitions',\n      icon: 'pi pi-refresh',\n      label: 'Refresh Node Definitions',\n      category: 'essentials' as const,\n      function: async () => {\n        await app.refreshComboInNodes()\n      }\n    },\n    {\n      id: 'Comfy.Interrupt',\n      icon: 'pi pi-stop',\n      label: 'Interrupt',\n      category: 'essentials' as const,\n      function: async () => {\n        await api.interrupt(executionStore.activePromptId)\n        toastStore.add({\n          severity: 'info',\n          summary: t('g.interrupted'),\n          detail: t('toastMessages.interrupted'),\n          life: 1000\n        })\n      }\n    },\n    {\n      id: 'Comfy.ClearPendingTasks',\n      icon: 'pi pi-stop',\n      label: 'Clear Pending Tasks',\n      category: 'essentials' as const,\n      function: async () => {\n        await useQueueStore().clear(['queue'])\n        toastStore.add({\n          severity: 'info',\n          summary: t('g.confirmed'),\n          detail: t('toastMessages.pendingTasksDeleted'),\n          life: 3000\n        })\n      }\n    },\n    {\n      id: 'Comfy.BrowseTemplates',\n      icon: 'pi pi-folder-open',\n      label: 'Browse Templates',\n      function: () => {\n        useWorkflowTemplateSelectorDialog().show()\n      }\n    },\n    {\n      id: 'Comfy.Canvas.ZoomIn',\n      icon: 'pi pi-plus',\n      label: 'Zoom In',\n      category: 'view-controls' as const,\n      function: () => {\n        const ds = app.canvas.ds\n        ds.changeScale(\n          ds.scale * 1.1,\n          ds.element ? [ds.element.width / 2, ds.element.height / 2] : undefined\n        )\n        app.canvas.setDirty(true, true)\n      }\n    },\n    {\n      id: 'Comfy.Canvas.ZoomOut',\n      icon: 'pi pi-minus',\n      label: 'Zoom Out',\n      category: 'view-controls' as const,\n      function: () => {\n        const ds = app.canvas.ds\n        ds.changeScale(\n          ds.scale / 1.1,\n          ds.element ? [ds.element.width / 2, ds.element.height / 2] : undefined\n        )\n        app.canvas.setDirty(true, true)\n      }\n    },\n    {\n      id: 'Experimental.ToggleVueNodes',\n      label: () =>\n        `Experimental: ${\n          useSettingStore().get('Comfy.VueNodes.Enabled') ? 'Disable' : 'Enable'\n        } Vue Nodes`,\n      function: async () => {\n        const settingStore = useSettingStore()\n        const current = settingStore.get('Comfy.VueNodes.Enabled') ?? false\n        await settingStore.set('Comfy.VueNodes.Enabled', !current)\n      }\n    },\n    {\n      id: 'Comfy.Canvas.FitView',\n      icon: 'pi pi-expand',\n      label: 'Fit view to selected nodes',\n      menubarLabel: 'Zoom to fit',\n      category: 'view-controls' as const,\n      function: () => {\n        const vueNodesEnabled = useSettingStore().get('Comfy.VueNodes.Enabled')\n\n        if (vueNodesEnabled) {\n          // Get nodes from Vue stores\n          const canvasStore = useCanvasStore()\n          const selectedNodeIds = canvasStore.selectedNodeIds\n          const allNodes = layoutStore.getAllNodes().value\n\n          // Get nodes to fit - selected if any, otherwise all\n          const nodesToFit =\n            selectedNodeIds.size > 0\n              ? Array.from(selectedNodeIds)\n                  .map((id) => allNodes.get(id))\n                  .filter((node) => node != null)\n              : Array.from(allNodes.values())\n\n          // Use Vue nodes bounds calculation\n          const bounds = selectionBounds(nodesToFit)\n          if (!bounds) {\n            toastStore.add({\n              severity: 'error',\n              summary: t('toastMessages.emptyCanvas'),\n              life: 3000\n            })\n            return\n          }\n\n          // Convert to LiteGraph format and animate\n          const lgBounds = [\n            bounds.x,\n            bounds.y,\n            bounds.width,\n            bounds.height\n          ] as const\n          const setDirty = () => app.canvas.setDirty(true, true)\n          app.canvas.ds.animateToBounds(lgBounds, setDirty)\n        } else {\n          if (app.canvas.empty) {\n            toastStore.add({\n              severity: 'error',\n              summary: t('toastMessages.emptyCanvas'),\n              life: 3000\n            })\n            return\n          }\n          app.canvas.fitViewToSelectionAnimated()\n        }\n      }\n    },\n    {\n      id: 'Comfy.Canvas.ToggleLock',\n      icon: 'pi pi-lock',\n      label: 'Canvas Toggle Lock',\n      category: 'view-controls' as const,\n      function: () => {\n        app.canvas.state.readOnly = !app.canvas.state.readOnly\n      }\n    },\n    {\n      id: 'Comfy.Canvas.Lock',\n      icon: 'pi pi-lock',\n      label: 'Lock Canvas',\n      category: 'view-controls' as const,\n      function: () => {\n        app.canvas.state.readOnly = true\n      }\n    },\n    {\n      id: 'Comfy.Canvas.Unlock',\n      icon: 'pi pi-lock-open',\n      label: 'Unlock Canvas',\n      function: () => {\n        app.canvas.state.readOnly = false\n      }\n    },\n    {\n      id: 'Comfy.Canvas.ToggleLinkVisibility',\n      icon: 'pi pi-eye',\n      label: 'Canvas Toggle Link Visibility',\n      menubarLabel: 'Node Links',\n      versionAdded: '1.3.6',\n\n      function: (() => {\n        const settingStore = useSettingStore()\n        let lastLinksRenderMode = LiteGraph.SPLINE_LINK\n\n        return async () => {\n          const currentMode = settingStore.get('Comfy.LinkRenderMode')\n\n          if (currentMode === LiteGraph.HIDDEN_LINK) {\n            // If links are hidden, restore the last positive value or default to spline mode\n            await settingStore.set('Comfy.LinkRenderMode', lastLinksRenderMode)\n          } else {\n            // If links are visible, store the current mode and hide links\n            lastLinksRenderMode = currentMode\n            await settingStore.set(\n              'Comfy.LinkRenderMode',\n              LiteGraph.HIDDEN_LINK\n            )\n          }\n        }\n      })(),\n      active: () =>\n        useSettingStore().get('Comfy.LinkRenderMode') !== LiteGraph.HIDDEN_LINK\n    },\n    {\n      id: 'Comfy.Canvas.ToggleMinimap',\n      icon: 'pi pi-map',\n      label: 'Canvas Toggle Minimap',\n      menubarLabel: 'Minimap',\n      versionAdded: '1.24.1',\n      function: async () => {\n        const settingStore = useSettingStore()\n        await settingStore.set(\n          'Comfy.Minimap.Visible',\n          !settingStore.get('Comfy.Minimap.Visible')\n        )\n      },\n      active: () => useSettingStore().get('Comfy.Minimap.Visible')\n    },\n    {\n      id: 'Comfy.QueuePrompt',\n      icon: 'pi pi-play',\n      label: 'Queue Prompt',\n      versionAdded: '1.3.7',\n      category: 'essentials' as const,\n      function: async (metadata?: {\n        subscribe_to_run?: boolean\n        trigger_source?: ExecutionTriggerSource\n      }) => {\n        useTelemetry()?.trackRunButton(metadata)\n        if (!isActiveSubscription.value) {\n          showSubscriptionDialog()\n          return\n        }\n\n        const batchCount = useQueueSettingsStore().batchCount\n\n        useTelemetry()?.trackWorkflowExecution()\n\n        await app.queuePrompt(0, batchCount)\n      }\n    },\n    {\n      id: 'Comfy.QueuePromptFront',\n      icon: 'pi pi-play',\n      label: 'Queue Prompt (Front)',\n      versionAdded: '1.3.7',\n      category: 'essentials' as const,\n      function: async (metadata?: {\n        subscribe_to_run?: boolean\n        trigger_source?: ExecutionTriggerSource\n      }) => {\n        useTelemetry()?.trackRunButton(metadata)\n        if (!isActiveSubscription.value) {\n          showSubscriptionDialog()\n          return\n        }\n\n        const batchCount = useQueueSettingsStore().batchCount\n\n        useTelemetry()?.trackWorkflowExecution()\n\n        await app.queuePrompt(-1, batchCount)\n      }\n    },\n    {\n      id: 'Comfy.QueueSelectedOutputNodes',\n      icon: 'pi pi-play',\n      label: 'Queue Selected Output Nodes',\n      versionAdded: '1.19.6',\n      function: async (metadata?: {\n        subscribe_to_run?: boolean\n        trigger_source?: ExecutionTriggerSource\n      }) => {\n        useTelemetry()?.trackRunButton(metadata)\n        if (!isActiveSubscription.value) {\n          showSubscriptionDialog()\n          return\n        }\n\n        const batchCount = useQueueSettingsStore().batchCount\n        const selectedNodes = getSelectedNodes()\n        const selectedOutputNodes = filterOutputNodes(selectedNodes)\n\n        if (selectedOutputNodes.length === 0) {\n          toastStore.add({\n            severity: 'error',\n            summary: t('toastMessages.nothingToQueue'),\n            detail: t('toastMessages.pleaseSelectOutputNodes'),\n            life: 3000\n          })\n          return\n        }\n\n        // Get execution IDs for all selected output nodes and their descendants\n        const executionIds =\n          getExecutionIdsForSelectedNodes(selectedOutputNodes)\n\n        if (executionIds.length === 0) {\n          toastStore.add({\n            severity: 'error',\n            summary: t('toastMessages.failedToQueue'),\n            detail: t('toastMessages.failedExecutionPathResolution'),\n            life: 3000\n          })\n          return\n        }\n        useTelemetry()?.trackWorkflowExecution()\n        await app.queuePrompt(0, batchCount, executionIds)\n      }\n    },\n    {\n      id: 'Comfy.ShowSettingsDialog',\n      icon: 'pi pi-cog',\n      label: 'Show Settings Dialog',\n      versionAdded: '1.3.7',\n      category: 'view-controls' as const,\n      function: () => {\n        dialogService.showSettingsDialog()\n      }\n    },\n    {\n      id: 'Comfy.Graph.GroupSelectedNodes',\n      icon: 'pi pi-sitemap',\n      label: 'Group Selected Nodes',\n      versionAdded: '1.3.7',\n      category: 'essentials' as const,\n      function: () => {\n        const { canvas } = app\n        if (!canvas.selectedItems?.size) {\n          toastStore.add({\n            severity: 'error',\n            summary: t('toastMessages.nothingToGroup'),\n            detail: t('toastMessages.pleaseSelectNodesToGroup'),\n            life: 3000\n          })\n          return\n        }\n        const group = new LGraphGroup()\n        const padding = useSettingStore().get(\n          'Comfy.GroupSelectedNodes.Padding'\n        )\n        group.resizeTo(canvas.selectedItems, padding)\n        canvas.graph?.add(group)\n\n        group.recomputeInsideNodes()\n\n        useTitleEditorStore().titleEditorTarget = group\n      }\n    },\n    {\n      id: 'Workspace.NextOpenedWorkflow',\n      icon: 'pi pi-step-forward',\n      label: 'Next Opened Workflow',\n      versionAdded: '1.3.9',\n      function: async () => {\n        await workflowService.loadNextOpenedWorkflow()\n      }\n    },\n    {\n      id: 'Workspace.PreviousOpenedWorkflow',\n      icon: 'pi pi-step-backward',\n      label: 'Previous Opened Workflow',\n      versionAdded: '1.3.9',\n      function: async () => {\n        await workflowService.loadPreviousOpenedWorkflow()\n      }\n    },\n    {\n      id: 'Comfy.Canvas.ToggleSelectedNodes.Mute',\n      icon: 'pi pi-volume-off',\n      label: 'Mute/Unmute Selected Nodes',\n      versionAdded: '1.3.11',\n      category: 'essentials' as const,\n      function: () => {\n        toggleSelectedNodesMode(LGraphEventMode.NEVER)\n        app.canvas.setDirty(true, true)\n      }\n    },\n    {\n      id: 'Comfy.Canvas.ToggleSelectedNodes.Bypass',\n      icon: 'pi pi-shield',\n      label: 'Bypass/Unbypass Selected Nodes',\n      versionAdded: '1.3.11',\n      category: 'essentials' as const,\n      function: () => {\n        toggleSelectedNodesMode(LGraphEventMode.BYPASS)\n        app.canvas.setDirty(true, true)\n      }\n    },\n    {\n      id: 'Comfy.Canvas.ToggleSelectedNodes.Pin',\n      icon: 'pi pi-pin',\n      label: 'Pin/Unpin Selected Nodes',\n      versionAdded: '1.3.11',\n      category: 'essentials' as const,\n      function: () => {\n        getSelectedNodes().forEach((node) => {\n          node.pin(!node.pinned)\n        })\n        app.canvas.setDirty(true, true)\n      }\n    },\n    {\n      id: 'Comfy.Canvas.ToggleSelected.Pin',\n      icon: 'pi pi-pin',\n      label: 'Pin/Unpin Selected Items',\n      versionAdded: '1.3.33',\n      function: () => {\n        for (const item of app.canvas.selectedItems) {\n          if (item instanceof LGraphNode || item instanceof LGraphGroup) {\n            item.pin(!item.pinned)\n          }\n        }\n        app.canvas.setDirty(true, true)\n      }\n    },\n    {\n      id: 'Comfy.Canvas.Resize',\n      icon: 'pi pi-minus',\n      label: 'Resize Selected Nodes',\n      versionAdded: '',\n      function: () => {\n        getSelectedNodes().forEach((node) => {\n          const optimalSize = node.computeSize()\n          node.setSize([optimalSize[0], optimalSize[1]])\n        })\n        app.canvas.setDirty(true, true)\n      }\n    },\n    {\n      id: 'Comfy.Canvas.ToggleSelectedNodes.Collapse',\n      icon: 'pi pi-minus',\n      label: 'Collapse/Expand Selected Nodes',\n      versionAdded: '1.3.11',\n      function: () => {\n        getSelectedNodes().forEach((node) => {\n          node.collapse()\n        })\n        app.canvas.setDirty(true, true)\n      }\n    },\n    {\n      id: 'Comfy.ToggleTheme',\n      icon: 'pi pi-moon',\n      label: 'Toggle Theme (Dark/Light)',\n      versionAdded: '1.3.12',\n      function: (() => {\n        let previousDarkTheme: string = DEFAULT_DARK_COLOR_PALETTE.id\n        let previousLightTheme: string = DEFAULT_LIGHT_COLOR_PALETTE.id\n\n        return async () => {\n          const settingStore = useSettingStore()\n          const theme = colorPaletteStore.completedActivePalette\n          if (theme.light_theme) {\n            previousLightTheme = theme.id\n            await settingStore.set('Comfy.ColorPalette', previousDarkTheme)\n          } else {\n            previousDarkTheme = theme.id\n            await settingStore.set('Comfy.ColorPalette', previousLightTheme)\n          }\n        }\n      })()\n    },\n    {\n      id: 'Workspace.ToggleBottomPanel',\n      icon: 'pi pi-list',\n      label: 'Toggle Bottom Panel',\n      menubarLabel: 'Bottom Panel',\n      versionAdded: '1.3.22',\n      category: 'view-controls' as const,\n      function: () => {\n        bottomPanelStore.toggleBottomPanel()\n      },\n      active: () => bottomPanelStore.bottomPanelVisible\n    },\n    {\n      id: 'Workspace.ToggleFocusMode',\n      icon: 'pi pi-eye',\n      label: 'Toggle Focus Mode',\n      menubarLabel: 'Focus Mode',\n      versionAdded: '1.3.27',\n      category: 'view-controls' as const,\n      function: () => {\n        useWorkspaceStore().toggleFocusMode()\n      },\n      active: () => useWorkspaceStore().focusMode\n    },\n    {\n      id: 'Comfy.Graph.FitGroupToContents',\n      icon: 'pi pi-expand',\n      label: 'Fit Group To Contents',\n      versionAdded: '1.4.9',\n      function: () => {\n        for (const group of app.canvas.selectedItems) {\n          if (group instanceof LGraphGroup) {\n            group.recomputeInsideNodes()\n            const padding = useSettingStore().get(\n              'Comfy.GroupSelectedNodes.Padding'\n            )\n            group.resizeTo(group.children, padding)\n            app.graph.change()\n          }\n        }\n      }\n    },\n    {\n      id: 'Comfy.Help.OpenComfyUIIssues',\n      icon: 'pi pi-github',\n      label: 'Open ComfyUI Issues',\n      menubarLabel: 'ComfyUI Issues',\n      versionAdded: '1.5.5',\n      function: () => {\n        telemetry?.trackHelpResourceClicked({\n          resource_type: 'github',\n          is_external: true,\n          source: 'menu'\n        })\n        window.open(staticUrls.githubIssues, '_blank')\n      }\n    },\n    {\n      id: 'Comfy.Help.OpenComfyUIDocs',\n      icon: 'pi pi-info-circle',\n      label: 'Open ComfyUI Docs',\n      menubarLabel: 'ComfyUI Docs',\n      versionAdded: '1.5.5',\n      function: () => {\n        telemetry?.trackHelpResourceClicked({\n          resource_type: 'docs',\n          is_external: true,\n          source: 'menu'\n        })\n        window.open(buildDocsUrl('/', { includeLocale: true }), '_blank')\n      }\n    },\n    {\n      id: 'Comfy.Help.OpenComfyOrgDiscord',\n      icon: 'pi pi-discord',\n      label: 'Open Comfy-Org Discord',\n      menubarLabel: 'Comfy-Org Discord',\n      versionAdded: '1.5.5',\n      function: () => {\n        telemetry?.trackHelpResourceClicked({\n          resource_type: 'discord',\n          is_external: true,\n          source: 'menu'\n        })\n        window.open(staticUrls.discord, '_blank')\n      }\n    },\n    {\n      id: 'Workspace.SearchBox.Toggle',\n      icon: 'pi pi-search',\n      label: 'Toggle Search Box',\n      versionAdded: '1.5.7',\n      function: () => {\n        useSearchBoxStore().toggleVisible()\n      }\n    },\n    {\n      id: 'Comfy.Help.AboutComfyUI',\n      icon: 'pi pi-info-circle',\n      label: 'Open About ComfyUI',\n      menubarLabel: 'About ComfyUI',\n      versionAdded: '1.6.4',\n      function: () => {\n        dialogService.showSettingsDialog('about')\n      }\n    },\n    {\n      id: 'Comfy.DuplicateWorkflow',\n      icon: 'pi pi-clone',\n      label: 'Duplicate Current Workflow',\n      versionAdded: '1.6.15',\n      function: async () => {\n        await workflowService.duplicateWorkflow(workflowStore.activeWorkflow!)\n      }\n    },\n    {\n      id: 'Workspace.CloseWorkflow',\n      icon: 'pi pi-times',\n      label: 'Close Current Workflow',\n      versionAdded: '1.7.3',\n      function: async () => {\n        if (workflowStore.activeWorkflow)\n          await workflowService.closeWorkflow(workflowStore.activeWorkflow)\n      }\n    },\n    {\n      id: 'Comfy.ContactSupport',\n      icon: 'pi pi-question',\n      label: 'Contact Support',\n      versionAdded: '1.17.8',\n      function: () => {\n        const { userEmail, resolvedUserInfo } = useCurrentUser()\n        const supportUrl = buildSupportUrl({\n          userEmail: userEmail.value,\n          userId: resolvedUserInfo.value?.id\n        })\n        window.open(supportUrl, '_blank')\n      }\n    },\n    {\n      id: 'Comfy.Help.OpenComfyUIForum',\n      icon: 'pi pi-comments',\n      label: 'Open ComfyUI Forum',\n      menubarLabel: 'ComfyUI Forum',\n      versionAdded: '1.8.2',\n      function: () => {\n        telemetry?.trackHelpResourceClicked({\n          resource_type: 'help_feedback',\n          is_external: true,\n          source: 'menu'\n        })\n        window.open(staticUrls.forum, '_blank')\n      }\n    },\n    {\n      id: 'Comfy.Canvas.DeleteSelectedItems',\n      icon: 'pi pi-trash',\n      label: 'Delete Selected Items',\n      versionAdded: '1.10.5',\n      function: () => {\n        app.canvas.deleteSelected()\n        app.canvas.setDirty(true, true)\n      }\n    },\n    {\n      id: 'Comfy.Manager.CustomNodesManager.ShowCustomNodesMenu',\n      icon: 'pi pi-puzzle',\n      label: 'Custom Nodes Manager',\n      versionAdded: '1.12.10',\n      function: async () => {\n        await useManagerState().openManager({\n          showToastOnLegacyError: true\n        })\n      }\n    },\n    {\n      id: 'Comfy.Manager.ShowUpdateAvailablePacks',\n      icon: 'pi pi-sync',\n      label: 'Check for Custom Node Updates',\n      versionAdded: '1.17.0',\n      function: async () => {\n        const managerState = useManagerState()\n        const state = managerState.managerUIState.value\n\n        // For DISABLED state, show error toast instead of opening settings\n        if (state === ManagerUIState.DISABLED) {\n          toastStore.add({\n            severity: 'error',\n            summary: t('g.error'),\n            detail: t('manager.notAvailable'),\n            life: 3000\n          })\n          return\n        }\n\n        await managerState.openManager({\n          initialTab: ManagerTab.UpdateAvailable,\n          showToastOnLegacyError: false\n        })\n      }\n    },\n    {\n      id: 'Comfy.Manager.ShowMissingPacks',\n      icon: 'pi pi-exclamation-circle',\n      label: 'Install Missing Custom Nodes',\n      versionAdded: '1.17.0',\n      function: async () => {\n        await useManagerState().openManager({\n          initialTab: ManagerTab.Missing,\n          showToastOnLegacyError: false\n        })\n      }\n    },\n    {\n      id: 'Comfy.Manager.ToggleManagerProgressDialog',\n      icon: 'pi pi-spinner',\n      label: 'Toggle the Custom Nodes Manager Progress Bar',\n      versionAdded: '1.13.9',\n      function: () => {\n        dialogService.toggleManagerProgressDialog()\n      }\n    },\n    {\n      id: 'Comfy.User.OpenSignInDialog',\n      icon: 'pi pi-user',\n      label: 'Open Sign In Dialog',\n      versionAdded: '1.17.6',\n      function: async () => {\n        await dialogService.showSignInDialog()\n      }\n    },\n    {\n      id: 'Comfy.User.SignOut',\n      icon: 'pi pi-sign-out',\n      label: 'Sign Out',\n      versionAdded: '1.18.1',\n      function: async () => {\n        await firebaseAuthActions.logout()\n      }\n    },\n    {\n      id: 'Comfy.Canvas.MoveSelectedNodes.Up',\n      icon: 'pi pi-arrow-up',\n      label: 'Move Selected Nodes Up',\n      versionAdded: moveSelectedNodesVersionAdded,\n      function: () => moveSelectedNodes(([x, y], gridSize) => [x, y - gridSize])\n    },\n    {\n      id: 'Comfy.Canvas.MoveSelectedNodes.Down',\n      icon: 'pi pi-arrow-down',\n      label: 'Move Selected Nodes Down',\n      versionAdded: moveSelectedNodesVersionAdded,\n      function: () => moveSelectedNodes(([x, y], gridSize) => [x, y + gridSize])\n    },\n    {\n      id: 'Comfy.Canvas.MoveSelectedNodes.Left',\n      icon: 'pi pi-arrow-left',\n      label: 'Move Selected Nodes Left',\n      versionAdded: moveSelectedNodesVersionAdded,\n      function: () => moveSelectedNodes(([x, y], gridSize) => [x - gridSize, y])\n    },\n    {\n      id: 'Comfy.Canvas.MoveSelectedNodes.Right',\n      icon: 'pi pi-arrow-right',\n      label: 'Move Selected Nodes Right',\n      versionAdded: moveSelectedNodesVersionAdded,\n      function: () => moveSelectedNodes(([x, y], gridSize) => [x + gridSize, y])\n    },\n    {\n      id: 'Comfy.Graph.ConvertToSubgraph',\n      icon: 'icon-[lucide--shrink]',\n      label: 'Convert Selection to Subgraph',\n      versionAdded: '1.20.1',\n      category: 'essentials' as const,\n      function: () => {\n        const canvas = canvasStore.getCanvas()\n        const graph = canvas.subgraph ?? canvas.graph\n        if (!graph) throw new TypeError('Canvas has no graph or subgraph set.')\n\n        const res = graph.convertToSubgraph(canvas.selectedItems)\n        if (!res) {\n          toastStore.add({\n            severity: 'error',\n            summary: t('toastMessages.cannotCreateSubgraph'),\n            detail: t('toastMessages.failedToConvertToSubgraph'),\n            life: 3000\n          })\n          return\n        }\n\n        const { node } = res\n        canvas.select(node)\n        canvasStore.updateSelectedItems()\n      }\n    },\n    {\n      id: 'Comfy.Graph.UnpackSubgraph',\n      icon: 'icon-[lucide--expand]',\n      label: 'Unpack the selected Subgraph',\n      versionAdded: '1.26.3',\n      function: () => {\n        const canvas = canvasStore.getCanvas()\n        const graph = canvas.subgraph ?? canvas.graph\n        if (!graph) throw new TypeError('Canvas has no graph or subgraph set.')\n\n        const subgraphNode = app.canvas.selectedItems.values().next().value\n        if (!(subgraphNode instanceof SubgraphNode)) return\n        useNodeOutputStore().revokeSubgraphPreviews(subgraphNode)\n        graph.unpackSubgraph(subgraphNode)\n      }\n    },\n    {\n      id: 'Comfy.Graph.EditSubgraphWidgets',\n      label: 'Edit Subgraph Widgets',\n      icon: 'icon-[lucide--settings-2]',\n      versionAdded: '1.28.5',\n      function: showSubgraphNodeDialog\n    },\n    {\n      id: 'Comfy.Graph.ToggleWidgetPromotion',\n      icon: 'icon-[lucide--arrow-left-right]',\n      label: 'Toggle promotion of hovered widget',\n      versionAdded: '1.30.1',\n      function: tryToggleWidgetPromotion\n    },\n    {\n      id: 'Comfy.OpenManagerDialog',\n      icon: 'mdi mdi-puzzle-outline',\n      label: 'Manager',\n      function: async () => {\n        await useManagerState().openManager({\n          initialTab: ManagerTab.All,\n          showToastOnLegacyError: false\n        })\n      }\n    },\n    {\n      id: 'Comfy.ToggleHelpCenter',\n      icon: 'pi pi-question-circle',\n      label: 'Help Center',\n      function: () => {\n        useHelpCenterStore().toggle()\n      },\n      active: () => useHelpCenterStore().isVisible\n    },\n    {\n      id: 'Comfy.ToggleCanvasInfo',\n      icon: 'pi pi-info-circle',\n      label: 'Canvas Performance',\n      function: async () => {\n        const settingStore = useSettingStore()\n        const currentValue = settingStore.get('Comfy.Graph.CanvasInfo')\n        await settingStore.set('Comfy.Graph.CanvasInfo', !currentValue)\n      },\n      active: () => useSettingStore().get('Comfy.Graph.CanvasInfo')\n    },\n    {\n      id: 'Workspace.ToggleBottomPanel.Shortcuts',\n      icon: 'pi pi-key',\n      label: 'Show Keybindings Dialog',\n      versionAdded: '1.24.1',\n      category: 'view-controls' as const,\n      function: () => {\n        bottomPanelStore.togglePanel('shortcuts')\n      }\n    },\n    {\n      id: 'Comfy.Graph.ExitSubgraph',\n      icon: 'pi pi-arrow-up',\n      label: 'Exit Subgraph',\n      versionAdded: '1.20.1',\n      function: () => {\n        const canvas = useCanvasStore().getCanvas()\n        const navigationStore = useSubgraphNavigationStore()\n        if (!canvas.graph) return\n\n        canvas.setGraph(\n          navigationStore.navigationStack.at(-2) ?? canvas.graph.rootGraph\n        )\n      }\n    },\n    {\n      id: 'Comfy.Dev.ShowModelSelector',\n      icon: 'pi pi-box',\n      label: 'Show Model Selector (Dev)',\n      versionAdded: '1.26.2',\n      category: 'view-controls' as const,\n      function: () => {\n        const modelSelectorDialog = useModelSelectorDialog()\n        modelSelectorDialog.show()\n      }\n    },\n    {\n      id: 'Comfy.Manager.CustomNodesManager.ShowLegacyCustomNodesMenu',\n      icon: 'pi pi-bars',\n      label: 'Custom Nodes (Legacy)',\n      versionAdded: '1.16.4',\n      function: async () => {\n        await useManagerState().openManager({\n          legacyCommand: 'Comfy.Manager.CustomNodesManager.ToggleVisibility',\n          showToastOnLegacyError: true,\n          isLegacyOnly: true\n        })\n      }\n    },\n    {\n      id: 'Comfy.Manager.ShowLegacyManagerMenu',\n      icon: 'mdi mdi-puzzle',\n      label: 'Manager Menu (Legacy)',\n      versionAdded: '1.16.4',\n      function: async () => {\n        await useManagerState().openManager({\n          showToastOnLegacyError: true,\n          isLegacyOnly: true\n        })\n      }\n    },\n    {\n      id: 'Comfy.Memory.UnloadModels',\n      icon: 'mdi mdi-vacuum-outline',\n      label: 'Unload Models',\n      versionAdded: '1.16.4',\n      function: async () => {\n        if (!useSettingStore().get('Comfy.Memory.AllowManualUnload')) {\n          useToastStore().add({\n            severity: 'error',\n            summary: t('g.error'),\n            detail: t('g.commandProhibited', {\n              command: 'Comfy.Memory.UnloadModels'\n            }),\n            life: 3000\n          })\n          return\n        }\n        await api.freeMemory({ freeExecutionCache: false })\n      }\n    },\n    {\n      id: 'Comfy.Memory.UnloadModelsAndExecutionCache',\n      icon: 'mdi mdi-vacuum-outline',\n      label: 'Unload Models and Execution Cache',\n      versionAdded: '1.16.4',\n      function: async () => {\n        if (!useSettingStore().get('Comfy.Memory.AllowManualUnload')) {\n          useToastStore().add({\n            severity: 'error',\n            summary: t('g.error'),\n            detail: t('g.commandProhibited', {\n              command: 'Comfy.Memory.UnloadModelsAndExecutionCache'\n            }),\n            life: 3000\n          })\n          return\n        }\n        await api.freeMemory({ freeExecutionCache: true })\n      }\n    },\n    {\n      id: 'Comfy.BrowseModelAssets',\n      icon: 'pi pi-folder-open',\n      label: 'Experimental: Browse Model Assets',\n      versionAdded: '1.28.3',\n      function: async () => {\n        if (!useSettingStore().get('Comfy.Assets.UseAssetAPI')) {\n          const confirmed = await dialogService.confirm({\n            title: 'Enable Asset API',\n            message:\n              'The Asset API is currently disabled. Would you like to enable it?',\n            type: 'default'\n          })\n\n          if (!confirmed) return\n\n          const settingStore = useSettingStore()\n          await settingStore.set('Comfy.Assets.UseAssetAPI', true)\n          await workflowService.reloadCurrentWorkflow()\n        }\n        const assetBrowserDialog = useAssetBrowserDialog()\n        await assetBrowserDialog.browse({\n          assetType: 'models',\n          title: t('sideToolbar.modelLibrary'),\n          onAssetSelected: (asset) => {\n            const result = createModelNodeFromAsset(asset)\n            if (!result.success) {\n              toastStore.add({\n                severity: 'error',\n                summary: t('g.error'),\n                detail: t('assetBrowser.failedToCreateNode')\n              })\n              console.error('Node creation failed:', result.error)\n            }\n          }\n        })\n      }\n    },\n    {\n      id: 'Comfy.ToggleAssetAPI',\n      icon: 'pi pi-database',\n      label: () =>\n        `Experimental: ${\n          useSettingStore().get('Comfy.Assets.UseAssetAPI')\n            ? 'Disable'\n            : 'Enable'\n        } AssetAPI`,\n      function: async () => {\n        const settingStore = useSettingStore()\n        const current = settingStore.get('Comfy.Assets.UseAssetAPI') ?? false\n        await settingStore.set('Comfy.Assets.UseAssetAPI', !current)\n        await useWorkflowService().reloadCurrentWorkflow() // ensure changes take effect immediately\n      }\n    }\n  ]\n\n  return commands.map((command) => ({ ...command, source: 'System' }))\n}\n","import { useFavicon } from '@vueuse/core'\nimport { watch } from 'vue'\n\nimport { useExecutionStore } from '@/stores/executionStore'\n\nexport const useProgressFavicon = () => {\n  const defaultFavicon = '/assets/images/favicon_progress_16x16/frame_9.png'\n  const favicon = useFavicon(defaultFavicon)\n  const executionStore = useExecutionStore()\n  const totalFrames = 10\n\n  watch(\n    [() => executionStore.executionProgress, () => executionStore.isIdle],\n    ([progress, isIdle]) => {\n      if (isIdle) {\n        favicon.value = defaultFavicon\n      } else {\n        const frame = Math.min(\n          Math.max(0, Math.floor(progress * totalFrames)),\n          totalFrames - 1\n        )\n        favicon.value = `/assets/images/favicon_progress_16x16/frame_${frame}.png`\n      }\n    }\n  )\n}\n","export enum LatentPreviewMethod {\n  NoPreviews = 'none',\n  Auto = 'auto',\n  Latent2RGB = 'latent2rgb',\n  TAESD = 'taesd'\n}\n\nexport enum LogLevel {\n  DEBUG = 'DEBUG',\n  INFO = 'INFO',\n  WARNING = 'WARNING',\n  ERROR = 'ERROR',\n  CRITICAL = 'CRITICAL'\n}\n\nexport enum HashFunction {\n  MD5 = 'md5',\n  SHA1 = 'sha1',\n  SHA256 = 'sha256',\n  SHA512 = 'sha512'\n}\n\nexport enum CudaMalloc {\n  // Let server decide whether to use CUDA malloc based on the current environment\n  Auto = 'auto',\n  // Disable CUDA malloc\n  Disable = 'disable',\n  // Enable CUDA malloc\n  Enable = 'enable'\n}\n\nexport enum FloatingPointPrecision {\n  AUTO = 'auto',\n  FP64 = 'fp64',\n  FP32 = 'fp32',\n  FP16 = 'fp16',\n  BF16 = 'bf16',\n  FP8E4M3FN = 'fp8_e4m3fn',\n  FP8E5M2 = 'fp8_e5m2'\n}\n\nexport enum CrossAttentionMethod {\n  Auto = 'auto',\n  Split = 'split',\n  Quad = 'quad',\n  Pytorch = 'pytorch'\n}\n\nexport enum VramManagement {\n  Auto = 'auto',\n  GPUOnly = 'gpu-only',\n  HighVram = 'highvram',\n  NormalVram = 'normalvram',\n  LowVram = 'lowvram',\n  NoVram = 'novram',\n  CPU = 'cpu'\n}\n","import type { FormItem } from '@/platform/settings/types'\nimport {\n  CrossAttentionMethod,\n  CudaMalloc,\n  FloatingPointPrecision,\n  HashFunction,\n  LatentPreviewMethod,\n  LogLevel,\n  VramManagement\n} from '@/types/serverArgs'\n\nexport type ServerConfigValue = string | number | true | null | undefined\n\nexport interface ServerConfig<T> extends FormItem {\n  id: string\n  defaultValue: T\n  category?: string[]\n  // Override the default value getter with a custom function.\n  getValue?: (value: T) => Record<string, ServerConfigValue>\n}\n\nexport const SERVER_CONFIG_ITEMS: ServerConfig<any>[] = [\n  // Network settings\n  {\n    id: 'listen',\n    name: 'Host: The IP address to listen on',\n    category: ['Network'],\n    type: 'text',\n    defaultValue: '127.0.0.1'\n  },\n  {\n    id: 'port',\n    name: 'Port: The port to listen on',\n    category: ['Network'],\n    type: 'number',\n    // The default launch port for desktop app is 8000 instead of 8188.\n    defaultValue: 8000\n  },\n  {\n    id: 'tls-keyfile',\n    name: 'TLS Key File: Path to TLS key file for HTTPS',\n    category: ['Network'],\n    type: 'text',\n    defaultValue: ''\n  },\n  {\n    id: 'tls-certfile',\n    name: 'TLS Certificate File: Path to TLS certificate file for HTTPS',\n    category: ['Network'],\n    type: 'text',\n    defaultValue: ''\n  },\n  {\n    id: 'enable-cors-header',\n    name: 'Enable CORS header: Use \"*\" for all origins or specify domain',\n    category: ['Network'],\n    type: 'text',\n    defaultValue: ''\n  },\n  {\n    id: 'max-upload-size',\n    name: 'Maximum upload size (MB)',\n    category: ['Network'],\n    type: 'number',\n    defaultValue: 100\n  },\n\n  // CUDA settings\n  {\n    id: 'cuda-device',\n    name: 'CUDA device index to use',\n    category: ['CUDA'],\n    type: 'number',\n    defaultValue: null\n  },\n  {\n    id: 'cuda-malloc',\n    name: 'Use CUDA malloc for memory allocation',\n    category: ['CUDA'],\n    type: 'combo',\n    options: Object.values(CudaMalloc),\n    defaultValue: CudaMalloc.Auto,\n    getValue: (value: CudaMalloc) => {\n      switch (value) {\n        case CudaMalloc.Auto:\n          return {}\n        case CudaMalloc.Enable:\n          return {\n            ['cuda-malloc']: true\n          }\n        case CudaMalloc.Disable:\n          return {\n            ['disable-cuda-malloc']: true\n          }\n      }\n    }\n  },\n\n  // Precision settings\n  {\n    id: 'global-precision',\n    name: 'Global floating point precision',\n    category: ['Inference'],\n    type: 'combo',\n    options: [\n      FloatingPointPrecision.AUTO,\n      FloatingPointPrecision.FP32,\n      FloatingPointPrecision.FP16\n    ],\n    defaultValue: FloatingPointPrecision.AUTO,\n    tooltip: 'Global floating point precision',\n    getValue: (value: FloatingPointPrecision) => {\n      switch (value) {\n        case FloatingPointPrecision.AUTO:\n          return {}\n        case FloatingPointPrecision.FP32:\n          return {\n            ['force-fp32']: true\n          }\n        case FloatingPointPrecision.FP16:\n          return {\n            ['force-fp16']: true\n          }\n        default:\n          return {}\n      }\n    }\n  },\n\n  // UNET precision\n  {\n    id: 'unet-precision',\n    name: 'UNET precision',\n    category: ['Inference'],\n    type: 'combo',\n    options: [\n      FloatingPointPrecision.AUTO,\n      FloatingPointPrecision.FP64,\n      FloatingPointPrecision.FP32,\n      FloatingPointPrecision.FP16,\n      FloatingPointPrecision.BF16,\n      FloatingPointPrecision.FP8E4M3FN,\n      FloatingPointPrecision.FP8E5M2\n    ],\n    defaultValue: FloatingPointPrecision.AUTO,\n    tooltip: 'UNET precision',\n    getValue: (value: FloatingPointPrecision) => {\n      switch (value) {\n        case FloatingPointPrecision.AUTO:\n          return {}\n        default:\n          return {\n            [`${value.toLowerCase()}-unet`]: true\n          }\n      }\n    }\n  },\n\n  // VAE settings\n  {\n    id: 'vae-precision',\n    name: 'VAE precision',\n    category: ['Inference'],\n    type: 'combo',\n    options: [\n      FloatingPointPrecision.AUTO,\n      FloatingPointPrecision.FP16,\n      FloatingPointPrecision.FP32,\n      FloatingPointPrecision.BF16\n    ],\n    defaultValue: FloatingPointPrecision.AUTO,\n    tooltip: 'VAE precision',\n    getValue: (value: FloatingPointPrecision) => {\n      switch (value) {\n        case FloatingPointPrecision.AUTO:\n          return {}\n        default:\n          return {\n            [`${value.toLowerCase()}-vae`]: true\n          }\n      }\n    }\n  },\n  {\n    id: 'cpu-vae',\n    name: 'Run VAE on CPU',\n    category: ['Inference'],\n    type: 'boolean',\n    defaultValue: false\n  },\n\n  // Text Encoder settings\n  {\n    id: 'text-encoder-precision',\n    name: 'Text Encoder precision',\n    category: ['Inference'],\n    type: 'combo',\n    options: [\n      FloatingPointPrecision.AUTO,\n      FloatingPointPrecision.FP8E4M3FN,\n      FloatingPointPrecision.FP8E5M2,\n      FloatingPointPrecision.FP16,\n      FloatingPointPrecision.FP32\n    ],\n    defaultValue: FloatingPointPrecision.AUTO,\n    tooltip: 'Text Encoder precision',\n    getValue: (value: FloatingPointPrecision) => {\n      switch (value) {\n        case FloatingPointPrecision.AUTO:\n          return {}\n        default:\n          return {\n            [`${value.toLowerCase()}-text-enc`]: true\n          }\n      }\n    }\n  },\n\n  // Memory and performance settings\n  {\n    id: 'force-channels-last',\n    name: 'Force channels-last memory format',\n    category: ['Memory'],\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'directml',\n    name: 'DirectML device index',\n    category: ['Memory'],\n    type: 'number',\n    defaultValue: null\n  },\n  {\n    id: 'disable-ipex-optimize',\n    name: 'Disable IPEX optimization',\n    category: ['Memory'],\n    type: 'boolean',\n    defaultValue: false\n  },\n\n  // Preview settings\n  {\n    id: 'preview-method',\n    name: 'Method used for latent previews',\n    category: ['Preview'],\n    type: 'combo',\n    options: Object.values(LatentPreviewMethod),\n    defaultValue: LatentPreviewMethod.NoPreviews\n  },\n  {\n    id: 'preview-size',\n    name: 'Size of preview images',\n    category: ['Preview'],\n    type: 'slider',\n    defaultValue: 512,\n    attrs: {\n      min: 128,\n      max: 2048,\n      step: 128\n    }\n  },\n\n  // Cache settings\n  {\n    id: 'cache-classic',\n    name: 'Use classic cache system',\n    category: ['Cache'],\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'cache-lru',\n    name: 'Use LRU caching with a maximum of N node results cached.',\n    category: ['Cache'],\n    type: 'number',\n    defaultValue: null,\n    tooltip: 'May use more RAM/VRAM.'\n  },\n\n  // Attention settings\n  {\n    id: 'cross-attention-method',\n    name: 'Cross attention method',\n    category: ['Attention'],\n    type: 'combo',\n    options: Object.values(CrossAttentionMethod),\n    defaultValue: CrossAttentionMethod.Auto,\n    getValue: (value: CrossAttentionMethod) => {\n      switch (value) {\n        case CrossAttentionMethod.Auto:\n          return {}\n        default:\n          return {\n            [`use-${value.toLowerCase()}-cross-attention`]: true\n          }\n      }\n    }\n  },\n  {\n    id: 'disable-xformers',\n    name: 'Disable xFormers optimization',\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'force-upcast-attention',\n    name: 'Force attention upcast',\n    category: ['Attention'],\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'dont-upcast-attention',\n    name: 'Prevent attention upcast',\n    category: ['Attention'],\n    type: 'boolean',\n    defaultValue: false\n  },\n\n  // VRAM management\n  {\n    id: 'vram-management',\n    name: 'VRAM management mode',\n    category: ['Memory'],\n    type: 'combo',\n    options: Object.values(VramManagement),\n    defaultValue: VramManagement.Auto,\n    getValue: (value: VramManagement) => {\n      switch (value) {\n        case VramManagement.Auto:\n          return {}\n        default:\n          return {\n            [value]: true\n          }\n      }\n    }\n  },\n  {\n    id: 'reserve-vram',\n    name: 'Reserved VRAM (GB)',\n    category: ['Memory'],\n    type: 'number',\n    defaultValue: null,\n    tooltip:\n      'Set the amount of vram in GB you want to reserve for use by your OS/other software. By default some amount is reserved depending on your OS.'\n  },\n\n  // Misc settings\n  {\n    id: 'default-hashing-function',\n    name: 'Default hashing function for model files',\n    type: 'combo',\n    options: Object.values(HashFunction),\n    defaultValue: HashFunction.SHA256\n  },\n  {\n    id: 'disable-smart-memory',\n    name: 'Disable smart memory management',\n    tooltip:\n      'Force ComfyUI to aggressively offload to regular ram instead of keeping models in vram when it can.',\n    category: ['Memory'],\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'deterministic',\n    name: 'Make pytorch use slower deterministic algorithms when it can.',\n    type: 'boolean',\n    defaultValue: false,\n    tooltip: 'Note that this might not make images deterministic in all cases.'\n  },\n  {\n    id: 'fast',\n    name: 'Enable some untested and potentially quality deteriorating optimizations.',\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'dont-print-server',\n    name: \"Don't print server output to console.\",\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'disable-metadata',\n    name: 'Disable saving prompt metadata in files.',\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'disable-all-custom-nodes',\n    name: 'Disable loading all custom nodes.',\n    type: 'boolean',\n    defaultValue: false\n  },\n  {\n    id: 'log-level',\n    name: 'Logging verbosity level',\n    type: 'combo',\n    options: Object.values(LogLevel),\n    defaultValue: LogLevel.INFO,\n    getValue: (value: LogLevel) => {\n      return {\n        verbose: value\n      }\n    }\n  },\n  // Directories\n  {\n    id: 'input-directory',\n    name: 'Input directory',\n    category: ['Directories'],\n    type: 'text',\n    defaultValue: ''\n  },\n  {\n    id: 'output-directory',\n    name: 'Output directory',\n    category: ['Directories'],\n    type: 'text',\n    defaultValue: ''\n  }\n]\n","import { until, useStorage } from '@vueuse/core'\nimport { defineStore } from 'pinia'\nimport { gt, valid } from 'semver'\nimport { computed } from 'vue'\n\nimport config from '@/config'\nimport { useSystemStatsStore } from '@/stores/systemStatsStore'\n\nconst DISMISSAL_DURATION_MS = 7 * 24 * 60 * 60 * 1000 // 7 days\n\nexport const useVersionCompatibilityStore = defineStore(\n  'versionCompatibility',\n  () => {\n    const systemStatsStore = useSystemStatsStore()\n\n    const frontendVersion = computed(() => config.app_version)\n    const backendVersion = computed(\n      () => systemStatsStore.systemStats?.system?.comfyui_version ?? ''\n    )\n    const requiredFrontendVersion = computed(\n      () =>\n        systemStatsStore.systemStats?.system?.required_frontend_version ?? ''\n    )\n\n    const isFrontendOutdated = computed(() => {\n      if (\n        !frontendVersion.value ||\n        !requiredFrontendVersion.value ||\n        !valid(frontendVersion.value) ||\n        !valid(requiredFrontendVersion.value)\n      ) {\n        return false\n      }\n      // Returns true if required version is greater than frontend version\n      return gt(requiredFrontendVersion.value, frontendVersion.value)\n    })\n\n    const isFrontendNewer = computed(() => {\n      // We don't warn about frontend being newer than backend\n      // Only warn when frontend is outdated (behind required version)\n      return false\n    })\n\n    const hasVersionMismatch = computed(() => {\n      return isFrontendOutdated.value\n    })\n\n    const versionKey = computed(() => {\n      if (\n        !frontendVersion.value ||\n        !backendVersion.value ||\n        !requiredFrontendVersion.value\n      ) {\n        return null\n      }\n      return `${frontendVersion.value}-${backendVersion.value}-${requiredFrontendVersion.value}`\n    })\n\n    // Use reactive storage for dismissals - creates a reactive ref that syncs with localStorage\n    // All version mismatch dismissals are stored in a single object for clean localStorage organization\n    const dismissalStorage = useStorage(\n      'comfy.versionMismatch.dismissals',\n      {} as Record<string, number>,\n      localStorage,\n      {\n        serializer: {\n          read: (value: string) => {\n            try {\n              return JSON.parse(value)\n            } catch {\n              return {}\n            }\n          },\n          write: (value: Record<string, number>) => JSON.stringify(value)\n        }\n      }\n    )\n\n    const isDismissed = computed(() => {\n      if (!versionKey.value) return false\n\n      const dismissedUntil = dismissalStorage.value[versionKey.value]\n      if (!dismissedUntil) return false\n\n      // Check if dismissal has expired\n      return Date.now() < dismissedUntil\n    })\n\n    const shouldShowWarning = computed(() => {\n      return hasVersionMismatch.value && !isDismissed.value\n    })\n\n    const warningMessage = computed(() => {\n      if (isFrontendOutdated.value) {\n        return {\n          type: 'outdated' as const,\n          frontendVersion: frontendVersion.value,\n          requiredVersion: requiredFrontendVersion.value\n        }\n      }\n      return null\n    })\n\n    async function checkVersionCompatibility() {\n      if (!systemStatsStore.systemStats) {\n        await until(systemStatsStore.isInitialized)\n      }\n    }\n\n    function dismissWarning() {\n      if (!versionKey.value) return\n\n      const dismissUntil = Date.now() + DISMISSAL_DURATION_MS\n      dismissalStorage.value = {\n        ...dismissalStorage.value,\n        [versionKey.value]: dismissUntil\n      }\n    }\n\n    async function initialize() {\n      await checkVersionCompatibility()\n    }\n\n    return {\n      frontendVersion,\n      backendVersion,\n      requiredFrontendVersion,\n      hasVersionMismatch,\n      shouldShowWarning,\n      warningMessage,\n      isFrontendOutdated,\n      isFrontendNewer,\n      checkVersionCompatibility,\n      dismissWarning,\n      initialize\n    }\n  }\n)\n","import { whenever } from '@vueuse/core'\nimport { computed, onMounted } from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport { useToastStore } from './toastStore'\nimport { useVersionCompatibilityStore } from './versionCompatibilityStore'\n\ninterface UseFrontendVersionMismatchWarningOptions {\n  immediate?: boolean\n}\n\n/**\n * Composable for handling frontend version mismatch warnings.\n *\n * Displays toast notifications when the frontend version is incompatible with the backend,\n * either because the frontend is outdated or newer than the backend expects.\n * Automatically dismisses warnings when shown and persists dismissal state for 7 days.\n *\n * @param options - Configuration options\n * @param options.immediate - If true, automatically shows warning when version mismatch is detected\n * @returns Object with methods and computed properties for managing version warnings\n *\n * @example\n * ```ts\n * // Show warning immediately when mismatch detected\n * const { showWarning, shouldShowWarning } = useFrontendVersionMismatchWarning({ immediate: true })\n *\n * // Manual control\n * const { showWarning } = useFrontendVersionMismatchWarning()\n * showWarning() // Call when needed\n * ```\n */\nexport function useFrontendVersionMismatchWarning(\n  options: UseFrontendVersionMismatchWarningOptions = {}\n) {\n  const { immediate = false } = options\n  const { t } = useI18n()\n  const toastStore = useToastStore()\n  const versionCompatibilityStore = useVersionCompatibilityStore()\n\n  // Track if we've already shown the warning\n  let hasShownWarning = false\n\n  const showWarning = () => {\n    // Prevent showing the warning multiple times\n    if (hasShownWarning) return\n\n    const message = versionCompatibilityStore.warningMessage\n    if (!message) return\n\n    const detailMessage = t('g.frontendOutdated', {\n      frontendVersion: message.frontendVersion,\n      requiredVersion: message.requiredVersion\n    })\n\n    const fullMessage = t('g.versionMismatchWarningMessage', {\n      warning: t('g.versionMismatchWarning'),\n      detail: detailMessage\n    })\n\n    toastStore.addAlert(fullMessage)\n    hasShownWarning = true\n\n    // Automatically dismiss the warning so it won't show again for 7 days\n    versionCompatibilityStore.dismissWarning()\n  }\n\n  onMounted(() => {\n    // Only set up the watcher if immediate is true\n    if (immediate) {\n      whenever(\n        () => versionCompatibilityStore.shouldShowWarning,\n        () => {\n          showWarning()\n        },\n        {\n          immediate: true,\n          once: true\n        }\n      )\n    }\n  })\n\n  return {\n    showWarning,\n    shouldShowWarning: computed(\n      () => versionCompatibilityStore.shouldShowWarning\n    ),\n    dismissWarning: versionCompatibilityStore.dismissWarning,\n    hasVersionMismatch: computed(\n      () => versionCompatibilityStore.hasVersionMismatch\n    )\n  }\n}\n","import { api } from '@/scripts/api'\nimport { app } from '@/scripts/app'\nimport {\n  useQueuePendingTaskCountStore,\n  useQueueSettingsStore\n} from '@/stores/queueStore'\n\nexport function setupAutoQueueHandler() {\n  const queueCountStore = useQueuePendingTaskCountStore()\n  const queueSettingsStore = useQueueSettingsStore()\n\n  let graphHasChanged = false\n  let internalCount = 0 // Use an internal counter here so it is instantly updated when re-queuing\n  api.addEventListener('graphChanged', () => {\n    if (queueSettingsStore.mode === 'change') {\n      if (internalCount) {\n        graphHasChanged = true\n      } else {\n        graphHasChanged = false\n        // Queue the prompt in the background\n        void app.queuePrompt(0, queueSettingsStore.batchCount)\n        internalCount++\n      }\n    }\n  })\n\n  queueCountStore.$subscribe(\n    async () => {\n      internalCount = queueCountStore.count\n      if (!internalCount && !app.lastExecutionError) {\n        if (\n          queueSettingsStore.mode === 'instant' ||\n          (queueSettingsStore.mode === 'change' && graphHasChanged)\n        ) {\n          graphHasChanged = false\n          await app.queuePrompt(0, queueSettingsStore.batchCount)\n        }\n      }\n    },\n    { detached: true }\n  )\n}\n","<template>\n  <div class=\"comfyui-body grid h-full w-full overflow-hidden\">\n    <div id=\"comfyui-body-top\" class=\"comfyui-body-top\" />\n    <div id=\"comfyui-body-bottom\" class=\"comfyui-body-bottom\" />\n    <div id=\"comfyui-body-left\" class=\"comfyui-body-left\" />\n    <div id=\"comfyui-body-right\" class=\"comfyui-body-right\" />\n    <div\n      id=\"graph-canvas-container\"\n      ref=\"graphCanvasContainerRef\"\n      class=\"graph-canvas-container\"\n    >\n      <GraphCanvas @ready=\"onGraphReady\" />\n    </div>\n  </div>\n\n  <GlobalToast />\n  <RerouteMigrationToast />\n  <VueNodesMigrationToast />\n  <UnloadWindowConfirmDialog v-if=\"!isElectron()\" />\n  <MenuHamburger />\n</template>\n\n<script setup lang=\"ts\">\nimport { useEventListener } from '@vueuse/core'\nimport type { ToastMessageOptions } from 'primevue/toast'\nimport { useToast } from 'primevue/usetoast'\nimport {\n  computed,\n  nextTick,\n  onBeforeUnmount,\n  onMounted,\n  ref,\n  watch,\n  watchEffect\n} from 'vue'\nimport { useI18n } from 'vue-i18n'\n\nimport { runWhenGlobalIdle } from '@/base/common/async'\nimport MenuHamburger from '@/components/MenuHamburger.vue'\nimport UnloadWindowConfirmDialog from '@/components/dialog/UnloadWindowConfirmDialog.vue'\nimport GraphCanvas from '@/components/graph/GraphCanvas.vue'\nimport GlobalToast from '@/components/toast/GlobalToast.vue'\nimport RerouteMigrationToast from '@/components/toast/RerouteMigrationToast.vue'\nimport VueNodesMigrationToast from '@/components/toast/VueNodesMigrationToast.vue'\nimport { useBrowserTabTitle } from '@/composables/useBrowserTabTitle'\nimport { useCoreCommands } from '@/composables/useCoreCommands'\nimport { useErrorHandling } from '@/composables/useErrorHandling'\nimport { useProgressFavicon } from '@/composables/useProgressFavicon'\nimport { SERVER_CONFIG_ITEMS } from '@/constants/serverConfig'\nimport { i18n, loadLocale } from '@/i18n'\nimport { isCloud } from '@/platform/distribution/types'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { useTelemetry } from '@/platform/telemetry'\nimport { useFrontendVersionMismatchWarning } from '@/platform/updates/common/useFrontendVersionMismatchWarning'\nimport { useVersionCompatibilityStore } from '@/platform/updates/common/versionCompatibilityStore'\nimport type { StatusWsMessageStatus } from '@/schemas/apiSchema'\nimport { api } from '@/scripts/api'\nimport { app } from '@/scripts/app'\nimport { setupAutoQueueHandler } from '@/services/autoQueueService'\nimport { useKeybindingService } from '@/services/keybindingService'\nimport { useAssetsStore } from '@/stores/assetsStore'\nimport { useCommandStore } from '@/stores/commandStore'\nimport { useExecutionStore } from '@/stores/executionStore'\nimport { useFirebaseAuthStore } from '@/stores/firebaseAuthStore'\nimport { useMenuItemStore } from '@/stores/menuItemStore'\nimport { useModelStore } from '@/stores/modelStore'\nimport { useNodeDefStore, useNodeFrequencyStore } from '@/stores/nodeDefStore'\nimport {\n  useQueuePendingTaskCountStore,\n  useQueueStore\n} from '@/stores/queueStore'\nimport { useServerConfigStore } from '@/stores/serverConfigStore'\nimport { useBottomPanelStore } from '@/stores/workspace/bottomPanelStore'\nimport { useColorPaletteStore } from '@/stores/workspace/colorPaletteStore'\nimport { useSidebarTabStore } from '@/stores/workspace/sidebarTabStore'\nimport { useWorkspaceStore } from '@/stores/workspaceStore'\nimport { electronAPI, isElectron } from '@/utils/envUtil'\n\nsetupAutoQueueHandler()\nuseProgressFavicon()\nuseBrowserTabTitle()\n\nconst { t } = useI18n()\nconst toast = useToast()\nconst settingStore = useSettingStore()\nconst executionStore = useExecutionStore()\nconst colorPaletteStore = useColorPaletteStore()\nconst queueStore = useQueueStore()\nconst assetsStore = useAssetsStore()\nconst versionCompatibilityStore = useVersionCompatibilityStore()\nconst graphCanvasContainerRef = ref<HTMLDivElement | null>(null)\n\nconst telemetry = useTelemetry()\nconst firebaseAuthStore = useFirebaseAuthStore()\nlet hasTrackedLogin = false\nlet visibilityListener: (() => void) | null = null\nlet tabCountInterval: number | null = null\nlet tabCountChannel: BroadcastChannel | null = null\n\nwatch(\n  () => colorPaletteStore.completedActivePalette,\n  (newTheme) => {\n    const DARK_THEME_CLASS = 'dark-theme'\n    if (newTheme.light_theme) {\n      document.body.classList.remove(DARK_THEME_CLASS)\n    } else {\n      document.body.classList.add(DARK_THEME_CLASS)\n    }\n\n    if (isElectron()) {\n      electronAPI().changeTheme({\n        color: 'rgba(0, 0, 0, 0)',\n        symbolColor: newTheme.colors.comfy_base['input-text']\n      })\n    }\n  },\n  { immediate: true }\n)\n\nif (isElectron()) {\n  watch(\n    () => queueStore.tasks,\n    (newTasks, oldTasks) => {\n      // Report tasks that previously running but are now completed (i.e. in history)\n      const oldRunningTaskIds = new Set(\n        oldTasks.filter((task) => task.isRunning).map((task) => task.promptId)\n      )\n      newTasks\n        .filter(\n          (task) => oldRunningTaskIds.has(task.promptId) && task.isHistory\n        )\n        .forEach((task) => {\n          electronAPI().Events.incrementUserProperty(\n            `execution:${task.displayStatus.toLowerCase()}`,\n            1\n          )\n          electronAPI().Events.trackEvent('execution', {\n            status: task.displayStatus.toLowerCase()\n          })\n        })\n    },\n    { deep: true }\n  )\n}\n\nwatchEffect(() => {\n  const fontSize = settingStore.get('Comfy.TextareaWidget.FontSize')\n  document.documentElement.style.setProperty(\n    '--comfy-textarea-font-size',\n    `${fontSize}px`\n  )\n})\n\nwatchEffect(() => {\n  const padding = settingStore.get('Comfy.TreeExplorer.ItemPadding')\n  document.documentElement.style.setProperty(\n    '--comfy-tree-explorer-item-padding',\n    `${padding}px`\n  )\n})\n\nwatchEffect(async () => {\n  const locale = settingStore.get('Comfy.Locale')\n  if (locale) {\n    // Load the locale dynamically if not already loaded\n    try {\n      await loadLocale(locale)\n      // Type assertion is safe here as loadLocale validates the locale exists\n      i18n.global.locale.value = locale as typeof i18n.global.locale.value\n    } catch (error) {\n      console.error(`Failed to switch to locale \"${locale}\":`, error)\n    }\n  }\n})\n\nconst useNewMenu = computed(() => {\n  return settingStore.get('Comfy.UseNewMenu')\n})\nwatchEffect(() => {\n  if (useNewMenu.value === 'Disabled') {\n    app.ui.menuContainer.style.setProperty('display', 'block')\n    app.ui.restoreMenuPosition()\n  } else {\n    app.ui.menuContainer.style.setProperty('display', 'none')\n  }\n})\n\nwatchEffect(() => {\n  queueStore.maxHistoryItems = settingStore.get('Comfy.Queue.MaxHistoryItems')\n})\n\nconst init = () => {\n  const coreCommands = useCoreCommands()\n  useCommandStore().registerCommands(coreCommands)\n  useMenuItemStore().registerCoreMenuCommands()\n  useKeybindingService().registerCoreKeybindings()\n  useSidebarTabStore().registerCoreSidebarTabs()\n  useBottomPanelStore().registerCoreBottomPanelTabs()\n  app.extensionManager = useWorkspaceStore()\n}\n\nconst queuePendingTaskCountStore = useQueuePendingTaskCountStore()\nconst onStatus = async (e: CustomEvent<StatusWsMessageStatus>) => {\n  queuePendingTaskCountStore.update(e)\n  await Promise.all([\n    queueStore.update(),\n    assetsStore.updateHistory() // Update history assets when status changes\n  ])\n}\n\nconst onExecutionSuccess = async () => {\n  await Promise.all([\n    queueStore.update(),\n    assetsStore.updateHistory() // Update history assets on execution success\n  ])\n}\n\nconst reconnectingMessage: ToastMessageOptions = {\n  severity: 'error',\n  summary: t('g.reconnecting')\n}\n\nconst onReconnecting = () => {\n  if (!settingStore.get('Comfy.Toast.DisableReconnectingToast')) {\n    toast.remove(reconnectingMessage)\n    toast.add(reconnectingMessage)\n  }\n}\n\nconst onReconnected = () => {\n  if (!settingStore.get('Comfy.Toast.DisableReconnectingToast')) {\n    toast.remove(reconnectingMessage)\n    toast.add({\n      severity: 'success',\n      summary: t('g.reconnected'),\n      life: 2000\n    })\n  }\n}\n\nonMounted(() => {\n  api.addEventListener('status', onStatus)\n  api.addEventListener('execution_success', onExecutionSuccess)\n  api.addEventListener('reconnecting', onReconnecting)\n  api.addEventListener('reconnected', onReconnected)\n  executionStore.bindExecutionEvents()\n\n  try {\n    init()\n    // Relocate the legacy menu container to the graph canvas container so it is below other elements\n    graphCanvasContainerRef.value?.prepend(app.ui.menuContainer)\n  } catch (e) {\n    console.error('Failed to init ComfyUI frontend', e)\n  }\n})\n\nonBeforeUnmount(() => {\n  api.removeEventListener('status', onStatus)\n  api.removeEventListener('execution_success', onExecutionSuccess)\n  api.removeEventListener('reconnecting', onReconnecting)\n  api.removeEventListener('reconnected', onReconnected)\n  executionStore.unbindExecutionEvents()\n\n  // Clean up page visibility listener\n  if (visibilityListener) {\n    document.removeEventListener('visibilitychange', visibilityListener)\n    visibilityListener = null\n  }\n\n  // Clean up tab count tracking\n  if (tabCountInterval) {\n    window.clearInterval(tabCountInterval)\n    tabCountInterval = null\n  }\n  if (tabCountChannel) {\n    tabCountChannel.close()\n    tabCountChannel = null\n  }\n})\n\nuseEventListener(window, 'keydown', useKeybindingService().keybindHandler)\n\nconst { wrapWithErrorHandling, wrapWithErrorHandlingAsync } = useErrorHandling()\n\n// Initialize version mismatch warning in setup context\n// It will be triggered automatically when the store is ready\nuseFrontendVersionMismatchWarning({ immediate: true })\n\nvoid nextTick(() => {\n  versionCompatibilityStore.initialize().catch((error) => {\n    console.warn('Version compatibility check failed:', error)\n  })\n})\n\nconst onGraphReady = () => {\n  runWhenGlobalIdle(() => {\n    // Track user login when app is ready in graph view (cloud only)\n    if (isCloud && firebaseAuthStore.isAuthenticated && !hasTrackedLogin) {\n      telemetry?.trackUserLoggedIn()\n      hasTrackedLogin = true\n    }\n\n    // Set up page visibility tracking (cloud only)\n    if (isCloud && telemetry && !visibilityListener) {\n      visibilityListener = () => {\n        telemetry.trackPageVisibilityChanged({\n          visibility_state: document.visibilityState as 'visible' | 'hidden'\n        })\n      }\n      document.addEventListener('visibilitychange', visibilityListener)\n    }\n\n    // Set up tab count tracking (cloud only)\n    if (isCloud && telemetry && !tabCountInterval) {\n      tabCountChannel = new BroadcastChannel('comfyui-tab-count')\n      const activeTabs = new Map<string, number>()\n      const currentTabId = crypto.randomUUID()\n\n      // Listen for heartbeats from other tabs\n      tabCountChannel.onmessage = (event) => {\n        if (\n          event.data.type === 'heartbeat' &&\n          event.data.tabId !== currentTabId\n        ) {\n          activeTabs.set(event.data.tabId, Date.now())\n        }\n      }\n\n      // 5-minute heartbeat interval\n      tabCountInterval = window.setInterval(() => {\n        const now = Date.now()\n\n        // Clean up stale tabs (no heartbeat for 45 seconds)\n        activeTabs.forEach((lastHeartbeat, tabId) => {\n          if (now - lastHeartbeat > 45000) {\n            activeTabs.delete(tabId)\n          }\n        })\n\n        // Broadcast our heartbeat\n        tabCountChannel?.postMessage({ type: 'heartbeat', tabId: currentTabId })\n\n        // Track tab count (include current tab)\n        const tabCount = activeTabs.size + 1\n        telemetry.trackTabCount({ tab_count: tabCount })\n      }, 60000 * 5)\n\n      // Send initial heartbeat\n      tabCountChannel.postMessage({ type: 'heartbeat', tabId: currentTabId })\n    }\n\n    // Setting values now available after comfyApp.setup.\n    // Load keybindings.\n    wrapWithErrorHandling(useKeybindingService().registerUserKeybindings)()\n\n    // Load server config\n    wrapWithErrorHandling(useServerConfigStore().loadServerConfig)(\n      SERVER_CONFIG_ITEMS,\n      settingStore.get('Comfy.Server.ServerConfigValues')\n    )\n\n    // Load model folders\n    void wrapWithErrorHandlingAsync(useModelStore().loadModelFolders)()\n\n    // Non-blocking load of node frequencies\n    void wrapWithErrorHandlingAsync(\n      useNodeFrequencyStore().loadNodeFrequencies\n    )()\n\n    // Node defs now available after comfyApp.setup.\n    // Explicitly initialize nodeSearchService to avoid indexing delay when\n    // node search is triggered\n    useNodeDefStore().nodeSearchService.searchNode('')\n  }, 1000)\n}\n</script>\n\n<style scoped>\n.comfyui-body {\n  grid-template-columns: auto 1fr auto;\n  grid-template-rows: auto 1fr auto;\n}\n\n/**\n  +------------------+------------------+------------------+\n  |                                                        |\n  |  .comfyui-body-                                        |\n  |       top                                              |\n  | (spans all cols)                                       |\n  |                                                        |\n  +------------------+------------------+------------------+\n  |                  |                  |                  |\n  | .comfyui-body-   |   #graph-canvas  | .comfyui-body-   |\n  |      left        |                  |      right       |\n  |                  |                  |                  |\n  |                  |                  |                  |\n  +------------------+------------------+------------------+\n  |                                                        |\n  |  .comfyui-body-                                        |\n  |      bottom                                            |\n  | (spans all cols)                                       |\n  |                                                        |\n  +------------------+------------------+------------------+\n*/\n\n.comfyui-body-top {\n  order: -5;\n  /* Span across all columns */\n  grid-column: 1/-1;\n  /* Position at the first row */\n  grid-row: 1;\n  /* Top menu bar dropdown needs to be above of graph canvas splitter overlay which is z-index: 999 */\n  /* Top menu bar z-index needs to be higher than bottom menu bar z-index as by default\n  pysssss's image feed is located at body-bottom, and it can overlap with the queue button, which\n  is located in body-top. */\n  z-index: 1001;\n  display: flex;\n  flex-direction: column;\n}\n\n.comfyui-body-left {\n  order: -4;\n  /* Position in the first column */\n  grid-column: 1;\n  /* Position below the top element */\n  grid-row: 2;\n  z-index: 10;\n  display: flex;\n}\n\n.graph-canvas-container {\n  width: 100%;\n  height: 100%;\n  order: -3;\n  grid-column: 2;\n  grid-row: 2;\n  position: relative;\n  overflow: clip;\n}\n\n.comfyui-body-right {\n  order: -2;\n  z-index: 10;\n  grid-column: 3;\n  grid-row: 2;\n}\n\n.comfyui-body-bottom {\n  order: 4;\n  /* Span across all columns */\n  grid-column: 1/-1;\n  grid-row: 3;\n  /* Bottom menu bar dropdown needs to be above of graph canvas splitter overlay which is z-index: 999 */\n  z-index: 1000;\n  display: flex;\n  flex-direction: column;\n}\n</style>\n"],"file":"assets/GraphView-CTP7SxlW.js"}