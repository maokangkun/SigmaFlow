{"version":3,"file":"index-BzO9u1rn.js","sources":["../../../../../../ComfyUI_frontend/src/extensions/core/clipspace.ts","../../../../../../ComfyUI_frontend/src/extensions/core/contextMenuFilter.ts","../../../../../../ComfyUI_frontend/src/extensions/core/dynamicPrompts.ts","../../../../../../ComfyUI_frontend/src/extensions/core/editAttention.ts","../../../../../../ComfyUI_frontend/src/constants/uvMirrors.ts","../../../../../../ComfyUI_frontend/src/utils/electronMirrorCheck.ts","../../../../../../ComfyUI_frontend/src/extensions/core/electronAdapter.ts","../../../../../../ComfyUI_frontend/src/utils/executableGroupNodeChildDTO.ts","../../../../../../ComfyUI_frontend/src/extensions/core/groupNodeManage.ts","../../../../../../ComfyUI_frontend/src/utils/nodeDefUtil.ts","../../../../../../ComfyUI_frontend/src/renderer/utils/nodeTypeGuards.ts","../../../../../../ComfyUI_frontend/src/extensions/core/widgetInputs.ts","../../../../../../ComfyUI_frontend/src/extensions/core/groupNode.ts","../../../../../../ComfyUI_frontend/src/extensions/core/groupOptions.ts","../../../../../../ComfyUI_frontend/src/extensions/core/load3d/exportMenuHelper.ts","../../../../../../ComfyUI_frontend/src/extensions/core/load3d/Load3DConfiguration.ts","../../../../../../ComfyUI_frontend/src/extensions/core/load3d.ts","../../../../../../ComfyUI_frontend/src/extensions/core/maskeditor/types.ts","../../../../../../ComfyUI_frontend/src/composables/maskeditor/useCanvasHistory.ts","../../../../../../ComfyUI_frontend/src/stores/maskEditorStore.ts","../../../../../../ComfyUI_frontend/src/stores/maskEditorDataStore.ts","../../../../../../ComfyUI_frontend/src/composables/maskeditor/useCanvasManager.ts","../../../../../../ComfyUI_frontend/src/composables/maskeditor/useImageLoader.ts","../../../../../../ComfyUI_frontend/src/composables/maskeditor/useKeyboard.ts","../../../../../../ComfyUI_frontend/src/composables/maskeditor/useMaskEditorLoader.ts","../../../../../../ComfyUI_frontend/src/composables/maskeditor/usePanAndZoom.ts","../../../../../../ComfyUI_frontend/src/composables/maskeditor/useCoordinateTransform.ts","../../../../../../ComfyUI_frontend/src/composables/maskeditor/useBrushDrawing.ts","../../../../../../ComfyUI_frontend/src/composables/maskeditor/useCanvasTools.ts","../../../../../../ComfyUI_frontend/src/composables/maskeditor/useToolManager.ts","../../../../../../ComfyUI_frontend/src/components/maskeditor/BrushCursor.vue","../../../../../../ComfyUI_frontend/src/components/maskeditor/PointerZone.vue","../../../../../../ComfyUI_frontend/src/components/maskeditor/controls/SliderControl.vue","../../../../../../ComfyUI_frontend/src/components/maskeditor/ImageLayerSettingsPanel.vue","../../../../../../ComfyUI_frontend/src/components/maskeditor/BrushSettingsPanel.vue","../../../../../../ComfyUI_frontend/src/components/maskeditor/controls/DropdownControl.vue","../../../../../../ComfyUI_frontend/src/components/maskeditor/controls/ToggleControl.vue","../../../../../../ComfyUI_frontend/src/components/maskeditor/ColorSelectSettingsPanel.vue","../../../../../../ComfyUI_frontend/src/components/maskeditor/PaintBucketSettingsPanel.vue","../../../../../../ComfyUI_frontend/src/components/maskeditor/SettingsPanelContainer.vue","../../../../../../ComfyUI_frontend/src/extensions/core/maskeditor/constants.ts","../../../../../../ComfyUI_frontend/src/components/maskeditor/ToolPanel.vue","../../../../../../ComfyUI_frontend/src/components/maskeditor/MaskEditorContent.vue","../../../../../../ComfyUI_frontend/src/composables/maskeditor/useMaskEditorSaver.ts","../../../../../../ComfyUI_frontend/src/components/maskeditor/dialog/TopBarHeader.vue","../../../../../../ComfyUI_frontend/src/extensions/core/maskEditorOld.ts","../../../../../../ComfyUI_frontend/src/extensions/core/maskeditor.ts","../../../../../../ComfyUI_frontend/src/extensions/core/matchType.ts","../../../../../../ComfyUI_frontend/src/extensions/core/nodeTemplates.ts","../../../../../../ComfyUI_frontend/src/extensions/core/noteNode.ts","../../../../../../ComfyUI_frontend/src/extensions/core/previewAny.ts","../../../../../../ComfyUI_frontend/src/extensions/core/rerouteNode.ts","../../../../../../ComfyUI_frontend/src/extensions/core/saveImageExtraOutput.ts","../../../../../../ComfyUI_frontend/src/extensions/core/saveMesh.ts","../../../../../../ComfyUI_frontend/src/extensions/core/selectionBorder.ts","../../../../../../ComfyUI_frontend/src/extensions/core/simpleTouchSupport.ts","../../../../../../ComfyUI_frontend/src/extensions/core/slotDefaults.ts","../../../../../../ComfyUI_frontend/src/extensions/core/uploadAudio.ts","../../../../../../ComfyUI_frontend/src/extensions/core/uploadImage.ts","../../../../../../ComfyUI_frontend/src/extensions/core/webcamCapture.ts","../../../../../../ComfyUI_frontend/src/extensions/core/LLMNodePreview.ts"],"sourcesContent":["import { app } from '../../scripts/app'\nimport { ComfyApp } from '../../scripts/app'\nimport { $el, ComfyDialog } from '../../scripts/ui'\n\nexport class ClipspaceDialog extends ComfyDialog {\n  static items: Array<\n    HTMLButtonElement & {\n      contextPredicate?: () => boolean\n    }\n  > = []\n  static instance: ClipspaceDialog | null = null\n\n  static registerButton(\n    name: string,\n    contextPredicate: () => boolean,\n    callback: () => void\n  ) {\n    const item = $el('button', {\n      type: 'button',\n      textContent: name,\n      contextPredicate: contextPredicate,\n      onclick: callback\n    })\n\n    ClipspaceDialog.items.push(item)\n  }\n\n  static invalidatePreview() {\n    if (\n      ComfyApp.clipspace &&\n      ComfyApp.clipspace.imgs &&\n      ComfyApp.clipspace.imgs.length > 0\n    ) {\n      const img_preview = document.getElementById(\n        'clipspace_preview'\n      ) as HTMLImageElement\n      if (img_preview) {\n        img_preview.src =\n          ComfyApp.clipspace.imgs[ComfyApp.clipspace['selectedIndex']].src\n        img_preview.style.maxHeight = '100%'\n        img_preview.style.maxWidth = '100%'\n      }\n    }\n  }\n\n  static invalidate() {\n    if (ClipspaceDialog.instance) {\n      const self = ClipspaceDialog.instance\n      // allow reconstruct controls when copying from non-image to image content.\n      const children = $el('div.comfy-modal-content', [\n        self.createImgSettings(),\n        ...self.createButtons()\n      ])\n\n      if (self.element) {\n        // update\n        if (self.element.firstChild) {\n          self.element.removeChild(self.element.firstChild)\n        }\n        self.element.appendChild(children)\n      } else {\n        // new\n        self.element = $el('div.comfy-modal', { parent: document.body }, [\n          children\n        ])\n      }\n\n      if (self.element.children[0].children.length <= 1) {\n        self.element.children[0].appendChild(\n          $el('p', {}, [\n            'Unable to find the features to edit content of a format stored in the current Clipspace.'\n          ])\n        )\n      }\n\n      ClipspaceDialog.invalidatePreview()\n    }\n  }\n\n  constructor() {\n    super()\n  }\n\n  override createButtons() {\n    const buttons = []\n\n    for (let idx in ClipspaceDialog.items) {\n      const item = ClipspaceDialog.items[idx]\n      if (!item.contextPredicate || item.contextPredicate())\n        buttons.push(ClipspaceDialog.items[idx])\n    }\n\n    buttons.push(\n      $el('button', {\n        type: 'button',\n        textContent: 'Close',\n        onclick: () => {\n          this.close()\n        }\n      })\n    )\n\n    return buttons\n  }\n\n  createImgSettings() {\n    if (ComfyApp.clipspace?.imgs) {\n      const combo_items = []\n      const imgs = ComfyApp.clipspace.imgs\n\n      for (let i = 0; i < imgs.length; i++) {\n        combo_items.push($el('option', { value: i }, [`${i}`]))\n      }\n\n      const combo1 = $el(\n        'select',\n        {\n          id: 'clipspace_img_selector',\n          onchange: (event: Event) => {\n            if (event.target && ComfyApp.clipspace) {\n              ComfyApp.clipspace['selectedIndex'] = (\n                event.target as HTMLSelectElement\n              ).selectedIndex\n              ClipspaceDialog.invalidatePreview()\n            }\n          }\n        },\n        combo_items\n      )\n\n      const row1 = $el('tr', {}, [\n        $el('td', {}, [$el('font', { color: 'white' }, ['Select Image'])]),\n        $el('td', {}, [combo1])\n      ])\n\n      const combo2 = $el(\n        'select',\n        {\n          id: 'clipspace_img_paste_mode',\n          onchange: (event: Event) => {\n            if (event.target && ComfyApp.clipspace) {\n              ComfyApp.clipspace['img_paste_mode'] = (\n                event.target as HTMLSelectElement\n              ).value\n            }\n          }\n        },\n        [\n          $el('option', { value: 'selected' }, 'selected'),\n          $el('option', { value: 'all' }, 'all')\n        ]\n      ) as HTMLSelectElement\n      combo2.value = ComfyApp.clipspace['img_paste_mode']\n\n      const row2 = $el('tr', {}, [\n        $el('td', {}, [$el('font', { color: 'white' }, ['Paste Mode'])]),\n        $el('td', {}, [combo2])\n      ])\n\n      const td = $el(\n        'td',\n        { align: 'center', width: '100px', height: '100px', colSpan: '2' },\n        [$el('img', { id: 'clipspace_preview', ondragstart: () => false }, [])]\n      )\n\n      const row3 = $el('tr', {}, [td])\n\n      return $el('table', {}, [row1, row2, row3])\n    } else {\n      return []\n    }\n  }\n\n  createImgPreview() {\n    if (ComfyApp.clipspace?.imgs) {\n      return $el('img', { id: 'clipspace_preview', ondragstart: () => false })\n    } else return []\n  }\n\n  override show() {\n    ClipspaceDialog.invalidate()\n\n    this.element.style.display = 'block'\n  }\n}\n\napp.registerExtension({\n  name: 'Comfy.Clipspace',\n  init(app) {\n    app.openClipspace = function () {\n      if (!ClipspaceDialog.instance) {\n        ClipspaceDialog.instance = new ClipspaceDialog()\n        ComfyApp.clipspace_invalidate_handler = ClipspaceDialog.invalidate\n      }\n\n      if (ComfyApp.clipspace) {\n        ClipspaceDialog.instance.show()\n      } else app.ui.dialog.show('Clipspace is Empty!')\n    }\n  }\n})\n","import {\n  LGraphCanvas,\n  LiteGraph,\n  isComboWidget\n} from '@/lib/litegraph/src/litegraph'\n\nimport { app } from '../../scripts/app'\n\n// Adds filtering to combo context menus\n\nconst ext = {\n  name: 'Comfy.ContextMenuFilter',\n  init() {\n    const ctxMenu = LiteGraph.ContextMenu\n\n    // @ts-expect-error TODO Very hacky way to modify Litegraph behaviour. Fix ctx later.\n    LiteGraph.ContextMenu = function (values, options) {\n      const ctx = new ctxMenu(values, options)\n\n      // If we are a dark menu (only used for combo boxes) then add a filter input\n      if (options?.className === 'dark' && values?.length > 4) {\n        const filter = document.createElement('input')\n        filter.classList.add('comfy-context-menu-filter')\n        filter.placeholder = 'Filter list'\n\n        ctx.root.prepend(filter)\n\n        const items = Array.from(\n          ctx.root.querySelectorAll('.litemenu-entry')\n        ) as HTMLElement[]\n        let displayedItems = [...items]\n        let itemCount = displayedItems.length\n\n        // We must request an animation frame for the current node of the active canvas to update.\n        requestAnimationFrame(() => {\n          const currentNode = LGraphCanvas.active_canvas.current_node\n          const clickedComboValue = currentNode?.widgets\n            ?.filter(\n              (w) =>\n                isComboWidget(w) && w.options.values?.length === values.length\n            )\n            .find((w) =>\n              // @ts-expect-error Poorly typed; filter above \"should\" mitigate exceptions\n              w.options.values?.every((v, i) => v === values[i])\n            )?.value\n\n          let selectedIndex = clickedComboValue\n            ? values.findIndex((v: string) => v === clickedComboValue)\n            : 0\n          if (selectedIndex < 0) {\n            selectedIndex = 0\n          }\n          let selectedItem = displayedItems[selectedIndex]\n          updateSelected()\n\n          // Apply highlighting to the selected item\n          function updateSelected() {\n            selectedItem?.style.setProperty('background-color', '')\n            selectedItem?.style.setProperty('color', '')\n            selectedItem = displayedItems[selectedIndex]\n            selectedItem?.style.setProperty(\n              'background-color',\n              '#ccc',\n              'important'\n            )\n            selectedItem?.style.setProperty('color', '#000', 'important')\n          }\n\n          const positionList = () => {\n            const rect = ctx.root.getBoundingClientRect()\n\n            // If the top is off-screen then shift the element with scaling applied\n            if (rect.top < 0) {\n              const scale =\n                1 -\n                ctx.root.getBoundingClientRect().height / ctx.root.clientHeight\n\n              const shift = (ctx.root.clientHeight * scale) / 2\n\n              ctx.root.style.top = -shift + 'px'\n            }\n          }\n\n          // Arrow up/down to select items\n          filter.addEventListener('keydown', (event) => {\n            switch (event.key) {\n              case 'ArrowUp':\n                event.preventDefault()\n                if (selectedIndex === 0) {\n                  selectedIndex = itemCount - 1\n                } else {\n                  selectedIndex--\n                }\n                updateSelected()\n                break\n              case 'ArrowRight':\n                event.preventDefault()\n                selectedIndex = itemCount - 1\n                updateSelected()\n                break\n              case 'ArrowDown':\n                event.preventDefault()\n                if (selectedIndex === itemCount - 1) {\n                  selectedIndex = 0\n                } else {\n                  selectedIndex++\n                }\n                updateSelected()\n                break\n              case 'ArrowLeft':\n                event.preventDefault()\n                selectedIndex = 0\n                updateSelected()\n                break\n              case 'Enter':\n                selectedItem?.click()\n                break\n              case 'Escape':\n                ctx.close()\n                break\n            }\n          })\n\n          filter.addEventListener('input', () => {\n            // Hide all items that don't match our filter\n            const term = filter.value.toLocaleLowerCase()\n            // When filtering, recompute which items are visible for arrow up/down and maintain selection.\n            displayedItems = items.filter((item) => {\n              const isVisible =\n                !term || item.textContent?.toLocaleLowerCase().includes(term)\n              item.style.display = isVisible ? 'block' : 'none'\n              return isVisible\n            })\n\n            selectedIndex = 0\n            if (displayedItems.includes(selectedItem)) {\n              selectedIndex = displayedItems.findIndex(\n                (d) => d === selectedItem\n              )\n            }\n            itemCount = displayedItems.length\n\n            updateSelected()\n\n            // If we have an event then we can try and position the list under the source\n            if (options.event) {\n              let top = options.event.clientY - 10\n\n              const bodyRect = document.body.getBoundingClientRect()\n\n              const rootRect = ctx.root.getBoundingClientRect()\n              if (\n                bodyRect.height &&\n                top > bodyRect.height - rootRect.height - 10\n              ) {\n                top = Math.max(0, bodyRect.height - rootRect.height - 10)\n              }\n\n              ctx.root.style.top = top + 'px'\n              positionList()\n            }\n          })\n\n          requestAnimationFrame(() => {\n            // Focus the filter box when opening\n            filter.focus()\n\n            positionList()\n          })\n        })\n      }\n\n      return ctx\n    }\n\n    LiteGraph.ContextMenu.prototype = ctxMenu.prototype\n  }\n}\n\napp.registerExtension(ext)\n","import { useExtensionService } from '@/services/extensionService'\nimport { processDynamicPrompt } from '@/utils/formatUtil'\n\n// Allows for simple dynamic prompt replacement\n// Inputs in the format {a|b} will have a random value of a or b chosen when the prompt is queued.\n\nuseExtensionService().registerExtension({\n  name: 'Comfy.DynamicPrompts',\n  nodeCreated(node) {\n    if (node.widgets) {\n      // Locate dynamic prompt text widgets\n      // Include any widgets with dynamicPrompts set to true, and customtext\n      const widgets = node.widgets.filter((w) => w.dynamicPrompts)\n      for (const widget of widgets) {\n        // Override the serialization of the value to resolve dynamic prompts for all widgets supporting it in this node\n        widget.serializeValue = (workflowNode, widgetIndex) => {\n          if (typeof widget.value !== 'string') return widget.value\n\n          const prompt = processDynamicPrompt(widget.value)\n\n          // Overwrite the value in the serialized workflow pnginfo\n          if (workflowNode?.widgets_values)\n            workflowNode.widgets_values[widgetIndex] = prompt\n\n          return prompt\n        }\n      }\n    }\n  }\n})\n","import { app } from '../../scripts/app'\n\n// Allows you to edit the attention weight by holding ctrl (or cmd) and using the up/down arrow keys\n\napp.registerExtension({\n  name: 'Comfy.EditAttention',\n  init() {\n    const editAttentionDelta = app.ui.settings.addSetting({\n      id: 'Comfy.EditAttention.Delta',\n      category: ['Comfy', 'EditTokenWeight', 'Delta'],\n      name: 'Ctrl+up/down precision',\n      type: 'slider',\n      attrs: {\n        min: 0.01,\n        max: 0.5,\n        step: 0.01\n      },\n      defaultValue: 0.05\n    })\n\n    function incrementWeight(weight: string, delta: number): string {\n      const floatWeight = parseFloat(weight)\n      if (isNaN(floatWeight)) return weight\n      const newWeight = floatWeight + delta\n      return String(Number(newWeight.toFixed(10)))\n    }\n\n    type Enclosure = {\n      start: number\n      end: number\n    }\n\n    function findNearestEnclosure(\n      text: string,\n      cursorPos: number\n    ): Enclosure | null {\n      let start = cursorPos,\n        end = cursorPos\n      let openCount = 0,\n        closeCount = 0\n\n      // Find opening parenthesis before cursor\n      while (start >= 0) {\n        start--\n        if (text[start] === '(' && openCount === closeCount) break\n        if (text[start] === '(') openCount++\n        if (text[start] === ')') closeCount++\n      }\n      if (start < 0) return null\n\n      openCount = 0\n      closeCount = 0\n\n      // Find closing parenthesis after cursor\n      while (end < text.length) {\n        if (text[end] === ')' && openCount === closeCount) break\n        if (text[end] === '(') openCount++\n        if (text[end] === ')') closeCount++\n        end++\n      }\n      if (end === text.length) return null\n\n      return { start: start + 1, end: end }\n    }\n\n    function addWeightToParentheses(text: string): string {\n      const parenRegex = /^\\((.*)\\)$/\n      const parenMatch = text.match(parenRegex)\n\n      const floatRegex = /:([+-]?(\\d*\\.)?\\d+([eE][+-]?\\d+)?)/\n      const floatMatch = text.match(floatRegex)\n\n      if (parenMatch && !floatMatch) {\n        return `(${parenMatch[1]}:1.0)`\n      } else {\n        return text\n      }\n    }\n\n    function editAttention(event: KeyboardEvent) {\n      // @ts-expect-error Runtime narrowing not impl.\n      const inputField: HTMLTextAreaElement = event.composedPath()[0]\n      const delta = parseFloat(editAttentionDelta.value)\n\n      if (inputField.tagName !== 'TEXTAREA') return\n      if (!(event.key === 'ArrowUp' || event.key === 'ArrowDown')) return\n      if (!event.ctrlKey && !event.metaKey) return\n\n      event.preventDefault()\n\n      let start = inputField.selectionStart\n      let end = inputField.selectionEnd\n      let selectedText = inputField.value.substring(start, end)\n\n      // If there is no selection, attempt to find the nearest enclosure, or select the current word\n      if (!selectedText) {\n        const nearestEnclosure = findNearestEnclosure(inputField.value, start)\n        if (nearestEnclosure) {\n          start = nearestEnclosure.start\n          end = nearestEnclosure.end\n          selectedText = inputField.value.substring(start, end)\n        } else {\n          // Select the current word, find the start and end of the word\n          const delimiters = ' .,\\\\/!?%^*;:{}=-_`~()\\r\\n\\t'\n\n          while (\n            !delimiters.includes(inputField.value[start - 1]) &&\n            start > 0\n          ) {\n            start--\n          }\n\n          while (\n            !delimiters.includes(inputField.value[end]) &&\n            end < inputField.value.length\n          ) {\n            end++\n          }\n\n          selectedText = inputField.value.substring(start, end)\n          if (!selectedText) return\n        }\n      }\n\n      // If the selection ends with a space, remove it\n      if (selectedText[selectedText.length - 1] === ' ') {\n        selectedText = selectedText.substring(0, selectedText.length - 1)\n        end -= 1\n      }\n\n      // If there are parentheses left and right of the selection, select them\n      if (\n        inputField.value[start - 1] === '(' &&\n        inputField.value[end] === ')'\n      ) {\n        start -= 1\n        end += 1\n        selectedText = inputField.value.substring(start, end)\n      }\n\n      // If the selection is not enclosed in parentheses, add them\n      if (\n        selectedText[0] !== '(' ||\n        selectedText[selectedText.length - 1] !== ')'\n      ) {\n        selectedText = `(${selectedText})`\n      }\n\n      // If the selection does not have a weight, add a weight of 1.0\n      selectedText = addWeightToParentheses(selectedText)\n\n      // Increment the weight\n      const weightDelta = event.key === 'ArrowUp' ? delta : -delta\n      const updatedText = selectedText.replace(\n        /\\((.*):([+-]?\\d+(?:\\.\\d+)?)\\)/,\n        (_, text, weight) => {\n          weight = incrementWeight(weight, weightDelta)\n          if (weight == 1) {\n            return text\n          } else {\n            return `(${text}:${weight})`\n          }\n        }\n      )\n\n      inputField.setSelectionRange(start, end)\n      // Intentional use of deprecated: https://developer.mozilla.org/docs/Web/API/Document/execCommand#using_inserttext\n      document.execCommand('insertText', false, updatedText)\n      inputField.setSelectionRange(start, start + updatedText.length)\n    }\n    window.addEventListener('keydown', editAttention)\n  }\n})\n","interface UVMirror {\n  /**\n   * The setting id defined for the mirror.\n   */\n  settingId: string\n  /**\n   * The default mirror to use.\n   */\n  mirror: string\n  /**\n   * The fallback mirror to use.\n   */\n  fallbackMirror: string\n  /**\n   * The path suffix to validate the mirror is reachable.\n   */\n  validationPathSuffix?: string\n}\n\nexport const PYTHON_MIRROR: UVMirror = {\n  settingId: 'Comfy-Desktop.UV.PythonInstallMirror',\n  mirror:\n    'https://github.com/astral-sh/python-build-standalone/releases/download',\n  fallbackMirror:\n    'https://python-standalone.org/mirror/astral-sh/python-build-standalone',\n  validationPathSuffix:\n    '/20250115/cpython-3.10.16+20250115-aarch64-apple-darwin-debug-full.tar.zst.sha256'\n}\n","import { electronAPI } from '@/utils/envUtil'\nimport { isValidUrl } from '@/utils/formatUtil'\n\n/**\n * Check if a mirror is reachable from the electron App.\n * @param mirror - The mirror to check.\n * @returns True if the mirror is reachable, false otherwise.\n */\nexport const checkMirrorReachable = async (mirror: string) => {\n  return (\n    isValidUrl(mirror) && (await electronAPI().NetWork.canAccessUrl(mirror))\n  )\n}\n","import log from 'loglevel'\n\nimport { useExternalLink } from '@/composables/useExternalLink'\nimport { PYTHON_MIRROR } from '@/constants/uvMirrors'\nimport { t } from '@/i18n'\nimport { useToastStore } from '@/platform/updates/common/toastStore'\nimport { useWorkflowStore } from '@/platform/workflow/management/stores/workflowStore'\nimport { app } from '@/scripts/app'\nimport { useDialogService } from '@/services/dialogService'\nimport { checkMirrorReachable } from '@/utils/electronMirrorCheck'\nimport { electronAPI as getElectronAPI, isElectron } from '@/utils/envUtil'\n;(async () => {\n  if (!isElectron()) return\n\n  const electronAPI = getElectronAPI()\n  const desktopAppVersion = await electronAPI.getElectronVersion()\n  const workflowStore = useWorkflowStore()\n  const toastStore = useToastStore()\n  const { staticUrls, buildDocsUrl } = useExternalLink()\n\n  const onChangeRestartApp = (newValue: string, oldValue: string) => {\n    // Add a delay to allow changes to take effect before restarting.\n    if (oldValue !== undefined && newValue !== oldValue) {\n      electronAPI.restartApp('Restart ComfyUI to apply changes.', 1500)\n    }\n  }\n\n  app.registerExtension({\n    name: 'Comfy.ElectronAdapter',\n    settings: [\n      {\n        id: 'Comfy-Desktop.AutoUpdate',\n        category: ['Comfy-Desktop', 'General', 'AutoUpdate'],\n        name: 'Automatically check for updates',\n        type: 'boolean',\n        defaultValue: true,\n        onChange: onChangeRestartApp\n      },\n      {\n        id: 'Comfy-Desktop.SendStatistics',\n        category: ['Comfy-Desktop', 'General', 'Send Statistics'],\n        name: 'Send anonymous usage metrics',\n        type: 'boolean',\n        defaultValue: true,\n        onChange: onChangeRestartApp\n      },\n      {\n        id: 'Comfy-Desktop.WindowStyle',\n        category: ['Comfy-Desktop', 'General', 'Window Style'],\n        name: 'Window Style',\n        tooltip: \"Custom: Replace the system title bar with ComfyUI's Top menu\",\n        type: 'combo',\n        experimental: true,\n        defaultValue: 'default',\n        options: ['default', 'custom'],\n        onChange: (\n          newValue: 'default' | 'custom',\n          oldValue?: 'default' | 'custom'\n        ) => {\n          if (!oldValue) return\n\n          electronAPI.Config.setWindowStyle(newValue)\n        }\n      },\n      {\n        id: 'Comfy-Desktop.UV.PythonInstallMirror',\n        name: 'Python Install Mirror',\n        tooltip: `Managed Python installations are downloaded from the Astral python-build-standalone project. This variable can be set to a mirror URL to use a different source for Python installations. The provided URL will replace https://github.com/astral-sh/python-build-standalone/releases/download in, e.g., https://github.com/astral-sh/python-build-standalone/releases/download/20240713/cpython-3.12.4%2B20240713-aarch64-apple-darwin-install_only.tar.gz. Distributions can be read from a local directory by using the file:// URL scheme.`,\n        type: 'url',\n        defaultValue: '',\n        attrs: {\n          validateUrlFn(mirror: string) {\n            return checkMirrorReachable(\n              mirror + PYTHON_MIRROR.validationPathSuffix\n            )\n          }\n        }\n      },\n      {\n        id: 'Comfy-Desktop.UV.PypiInstallMirror',\n        name: 'Pypi Install Mirror',\n        tooltip: `Default pip install mirror`,\n        type: 'url',\n        defaultValue: '',\n        attrs: {\n          validateUrlFn: checkMirrorReachable\n        }\n      },\n      {\n        id: 'Comfy-Desktop.UV.TorchInstallMirror',\n        name: 'Torch Install Mirror',\n        tooltip: `Pip install mirror for pytorch`,\n        type: 'url',\n        defaultValue: '',\n        attrs: {\n          validateUrlFn: checkMirrorReachable\n        }\n      }\n    ],\n\n    commands: [\n      {\n        id: 'Comfy-Desktop.Folders.OpenLogsFolder',\n        label: 'Open Logs Folder',\n        icon: 'pi pi-folder-open',\n        function() {\n          electronAPI.openLogsFolder()\n        }\n      },\n      {\n        id: 'Comfy-Desktop.Folders.OpenModelsFolder',\n        label: 'Open Models Folder',\n        icon: 'pi pi-folder-open',\n        function() {\n          electronAPI.openModelsFolder()\n        }\n      },\n      {\n        id: 'Comfy-Desktop.Folders.OpenOutputsFolder',\n        label: 'Open Outputs Folder',\n        icon: 'pi pi-folder-open',\n        function() {\n          electronAPI.openOutputsFolder()\n        }\n      },\n      {\n        id: 'Comfy-Desktop.Folders.OpenInputsFolder',\n        label: 'Open Inputs Folder',\n        icon: 'pi pi-folder-open',\n        function() {\n          electronAPI.openInputsFolder()\n        }\n      },\n      {\n        id: 'Comfy-Desktop.Folders.OpenCustomNodesFolder',\n        label: 'Open Custom Nodes Folder',\n        icon: 'pi pi-folder-open',\n        function() {\n          electronAPI.openCustomNodesFolder()\n        }\n      },\n      {\n        id: 'Comfy-Desktop.Folders.OpenModelConfig',\n        label: 'Open extra_model_paths.yaml',\n        icon: 'pi pi-file',\n        function() {\n          electronAPI.openModelConfig()\n        }\n      },\n      {\n        id: 'Comfy-Desktop.OpenDevTools',\n        label: 'Open DevTools',\n        icon: 'pi pi-code',\n        function() {\n          electronAPI.openDevTools()\n        }\n      },\n      {\n        id: 'Comfy-Desktop.OpenUserGuide',\n        label: 'Desktop User Guide',\n        icon: 'pi pi-book',\n        function() {\n          window.open(\n            buildDocsUrl('/installation/desktop', {\n              includeLocale: true,\n              platform: true\n            }),\n            '_blank'\n          )\n        }\n      },\n      {\n        id: 'Comfy-Desktop.CheckForUpdates',\n        label: 'Check for Updates',\n        icon: 'pi pi-sync',\n        async function() {\n          try {\n            const updateInfo = await electronAPI.checkForUpdates({\n              disableUpdateReadyAction: true\n            })\n\n            if (!updateInfo.isUpdateAvailable) {\n              toastStore.add({\n                severity: 'info',\n                summary: t('desktopUpdate.noUpdateFound'),\n                life: 5_000\n              })\n              return\n            }\n\n            const proceed = await useDialogService().confirm({\n              title: t('desktopUpdate.updateFoundTitle', {\n                version: updateInfo.version\n              }),\n              message: t('desktopUpdate.updateAvailableMessage'),\n              type: 'default'\n            })\n            if (proceed) {\n              try {\n                electronAPI.restartAndInstall()\n              } catch (error) {\n                log.error('Error installing update:', error)\n                toastStore.add({\n                  severity: 'error',\n                  summary: t('g.error'),\n                  detail: t('desktopUpdate.errorInstallingUpdate'),\n                  life: 10_000\n                })\n              }\n            }\n          } catch (error) {\n            log.error('Error checking for updates:', error)\n            toastStore.add({\n              severity: 'error',\n              summary: t('g.error'),\n              detail: t('desktopUpdate.errorCheckingUpdate'),\n              life: 10_000\n            })\n          }\n        }\n      },\n      {\n        id: 'Comfy-Desktop.Reinstall',\n        label: 'Reinstall',\n        icon: 'pi pi-refresh',\n        async function() {\n          const proceed = await useDialogService().confirm({\n            message: t('desktopMenu.confirmReinstall'),\n            title: t('desktopMenu.reinstall'),\n            type: 'reinstall'\n          })\n\n          if (proceed) electronAPI.reinstall()\n        }\n      },\n      {\n        id: 'Comfy-Desktop.Restart',\n        label: 'Restart',\n        icon: 'pi pi-refresh',\n        function() {\n          electronAPI.restartApp()\n        }\n      },\n      {\n        id: 'Comfy-Desktop.Quit',\n        label: 'Quit',\n        icon: 'pi pi-sign-out',\n        async function() {\n          // Confirm if unsaved workflows are open\n          if (workflowStore.modifiedWorkflows.length > 0) {\n            const confirmed = await useDialogService().confirm({\n              message: t('desktopMenu.confirmQuit'),\n              title: t('desktopMenu.quit'),\n              type: 'default'\n            })\n\n            if (!confirmed) return\n          }\n\n          electronAPI.quit()\n        }\n      }\n    ],\n\n    menuCommands: [\n      {\n        path: ['Help'],\n        commands: ['Comfy-Desktop.OpenUserGuide']\n      },\n      {\n        path: ['Help'],\n        commands: ['Comfy-Desktop.OpenDevTools']\n      },\n      {\n        path: ['Help', 'Open Folder'],\n        commands: [\n          'Comfy-Desktop.Folders.OpenLogsFolder',\n          'Comfy-Desktop.Folders.OpenModelsFolder',\n          'Comfy-Desktop.Folders.OpenOutputsFolder',\n          'Comfy-Desktop.Folders.OpenInputsFolder',\n          'Comfy-Desktop.Folders.OpenCustomNodesFolder',\n          'Comfy-Desktop.Folders.OpenModelConfig'\n        ]\n      },\n      {\n        path: ['Help'],\n        commands: ['Comfy-Desktop.CheckForUpdates', 'Comfy-Desktop.Reinstall']\n      }\n    ],\n\n    keybindings: [\n      {\n        commandId: 'Workspace.CloseWorkflow',\n        combo: {\n          key: 'w',\n          ctrl: true\n        }\n      }\n    ],\n\n    aboutPageBadges: [\n      {\n        label: 'ComfyUI_desktop v' + desktopAppVersion,\n        url: staticUrls.githubElectron,\n        icon: 'pi pi-github'\n      }\n    ]\n  })\n})()\n","import type { GroupNodeHandler } from '@/extensions/core/groupNode'\nimport { ExecutableNodeDTO } from '@/lib/litegraph/src/litegraph'\nimport type {\n  ExecutableLGraphNode,\n  ExecutionId,\n  LGraphNode,\n  NodeId,\n  SubgraphNode\n} from '@/lib/litegraph/src/litegraph'\n\nexport class ExecutableGroupNodeChildDTO extends ExecutableNodeDTO {\n  groupNodeHandler?: GroupNodeHandler\n\n  constructor(\n    /** The actual node that this DTO wraps. */\n    node: LGraphNode | SubgraphNode,\n    /** A list of subgraph instance node IDs from the root graph to the containing instance. @see {@link id} */\n    subgraphNodePath: readonly NodeId[],\n    /** A flattened map of all DTOs in this node network. Subgraph instances have been expanded into their inner nodes. */\n    nodesByExecutionId: Map<ExecutionId, ExecutableLGraphNode>,\n    /** The actual subgraph instance that contains this node, otherwise undefined. */\n    subgraphNode?: SubgraphNode | undefined,\n    groupNodeHandler?: GroupNodeHandler\n  ) {\n    super(node, subgraphNodePath, nodesByExecutionId, subgraphNode)\n    this.groupNodeHandler = groupNodeHandler\n  }\n\n  override resolveInput(slot: number) {\n    // Check if this group node is inside a subgraph (unsupported)\n    if (this.id.split(':').length > 2) {\n      throw new Error(\n        'Group nodes inside subgraphs are not supported. Please convert the group node to a subgraph instead.'\n      )\n    }\n\n    const inputNode = this.node.getInputNode(slot)\n    if (!inputNode) return\n\n    const link = this.node.getInputLink(slot)\n    if (!link) throw new Error('Failed to get input link')\n\n    const inputNodeId = String(inputNode.id)\n\n    // Try to find the node using the full ID first (for nodes outside the group)\n    let inputNodeDto = this.nodesByExecutionId?.get(inputNodeId)\n\n    // If not found, try with just the last part of the ID (for nodes inside the group)\n    if (!inputNodeDto) {\n      const id = inputNodeId.split(':').at(-1)\n      if (id !== undefined) {\n        inputNodeDto = this.nodesByExecutionId?.get(id)\n      }\n    }\n\n    if (!inputNodeDto) {\n      throw new Error(\n        `Failed to get input node ${inputNodeId} for group node child ${this.id} with slot ${slot}`\n      )\n    }\n\n    return {\n      node: inputNodeDto,\n      origin_id: inputNodeId,\n      origin_slot: link.origin_slot\n    }\n  }\n}\n","import { PREFIX, SEPARATOR } from '@/constants/groupNodeConstants'\nimport {\n  type LGraphNode,\n  type LGraphNodeConstructor,\n  LiteGraph\n} from '@/lib/litegraph/src/litegraph'\nimport { useToastStore } from '@/platform/updates/common/toastStore'\n\nimport { type ComfyApp, app } from '../../scripts/app'\nimport { $el } from '../../scripts/ui'\nimport { ComfyDialog } from '../../scripts/ui/dialog'\nimport { DraggableList } from '../../scripts/ui/draggableList'\nimport { GroupNodeConfig, GroupNodeHandler } from './groupNode'\nimport './groupNodeManage.css'\n\nconst ORDER: symbol = Symbol()\n\n// @ts-expect-error fixme ts strict error\nfunction merge(target, source) {\n  if (typeof target === 'object' && typeof source === 'object') {\n    for (const key in source) {\n      const sv = source[key]\n      if (typeof sv === 'object') {\n        let tv = target[key]\n        if (!tv) tv = target[key] = {}\n        merge(tv, source[key])\n      } else {\n        target[key] = sv\n      }\n    }\n  }\n\n  return target\n}\n\nexport class ManageGroupDialog extends ComfyDialog<HTMLDialogElement> {\n  // @ts-expect-error fixme ts strict error\n  tabs: Record<\n    'Inputs' | 'Outputs' | 'Widgets',\n    { tab: HTMLAnchorElement; page: HTMLElement }\n  >\n  selectedNodeIndex: number | null | undefined\n  selectedTab: keyof ManageGroupDialog['tabs'] = 'Inputs'\n  selectedGroup: string | undefined\n  modifications: Record<\n    string,\n    Record<\n      string,\n      Record<\n        string,\n        { name?: string | undefined; visible?: boolean | undefined }\n      >\n    >\n  > = {}\n  // @ts-expect-error fixme ts strict error\n  nodeItems: any[]\n  app: ComfyApp\n  // @ts-expect-error fixme ts strict error\n  groupNodeType: LGraphNodeConstructor<LGraphNode>\n  groupNodeDef: any\n  groupData: any\n\n  // @ts-expect-error fixme ts strict error\n  innerNodesList: HTMLUListElement\n  // @ts-expect-error fixme ts strict error\n  widgetsPage: HTMLElement\n  // @ts-expect-error fixme ts strict error\n  inputsPage: HTMLElement\n  // @ts-expect-error fixme ts strict error\n  outputsPage: HTMLElement\n  draggable: any\n\n  get selectedNodeInnerIndex() {\n    // @ts-expect-error fixme ts strict error\n    return +this.nodeItems[this.selectedNodeIndex].dataset.nodeindex\n  }\n\n  // @ts-expect-error fixme ts strict error\n  constructor(app) {\n    super()\n    this.app = app\n    this.element = $el('dialog.comfy-group-manage', {\n      parent: document.body\n    }) as HTMLDialogElement\n  }\n\n  // @ts-expect-error fixme ts strict error\n  changeTab(tab) {\n    this.tabs[this.selectedTab].tab.classList.remove('active')\n    this.tabs[this.selectedTab].page.classList.remove('active')\n    // @ts-expect-error fixme ts strict error\n    this.tabs[tab].tab.classList.add('active')\n    // @ts-expect-error fixme ts strict error\n    this.tabs[tab].page.classList.add('active')\n    this.selectedTab = tab\n  }\n\n  // @ts-expect-error fixme ts strict error\n  changeNode(index, force?) {\n    if (!force && this.selectedNodeIndex === index) return\n\n    if (this.selectedNodeIndex != null) {\n      this.nodeItems[this.selectedNodeIndex].classList.remove('selected')\n    }\n    this.nodeItems[index].classList.add('selected')\n    this.selectedNodeIndex = index\n\n    if (!this.buildInputsPage() && this.selectedTab === 'Inputs') {\n      this.changeTab('Widgets')\n    }\n    if (!this.buildWidgetsPage() && this.selectedTab === 'Widgets') {\n      this.changeTab('Outputs')\n    }\n    if (!this.buildOutputsPage() && this.selectedTab === 'Outputs') {\n      this.changeTab('Inputs')\n    }\n\n    this.changeTab(this.selectedTab)\n  }\n\n  getGroupData() {\n    this.groupNodeType = LiteGraph.registered_node_types[\n      `${PREFIX}${SEPARATOR}` + this.selectedGroup\n    ] as unknown as LGraphNodeConstructor<LGraphNode>\n    this.groupNodeDef = this.groupNodeType.nodeData\n    this.groupData = GroupNodeHandler.getGroupData(this.groupNodeType)\n  }\n\n  // @ts-expect-error fixme ts strict error\n  changeGroup(group, reset = true) {\n    this.selectedGroup = group\n    this.getGroupData()\n\n    const nodes = this.groupData.nodeData.nodes\n    // @ts-expect-error fixme ts strict error\n    this.nodeItems = nodes.map((n, i) =>\n      $el(\n        'li.draggable-item',\n        {\n          dataset: {\n            nodeindex: n.index + ''\n          },\n          onclick: () => {\n            this.changeNode(i)\n          }\n        },\n        [\n          $el('span.drag-handle'),\n          $el(\n            'div',\n            {\n              textContent: n.title ?? n.type\n            },\n            n.title\n              ? $el('span', {\n                  textContent: n.type\n                })\n              : []\n          )\n        ]\n      )\n    )\n\n    this.innerNodesList.replaceChildren(...this.nodeItems)\n\n    if (reset) {\n      this.selectedNodeIndex = null\n      this.changeNode(0)\n    } else {\n      const items = this.draggable.getAllItems()\n      // @ts-expect-error fixme ts strict error\n      let index = items.findIndex((item) => item.classList.contains('selected'))\n      if (index === -1) index = this.selectedNodeIndex\n      this.changeNode(index, true)\n    }\n\n    const ordered = [...nodes]\n    this.draggable?.dispose()\n    this.draggable = new DraggableList(this.innerNodesList, 'li')\n    this.draggable.addEventListener(\n      'dragend',\n      // @ts-expect-error fixme ts strict error\n      ({ detail: { oldPosition, newPosition } }) => {\n        if (oldPosition === newPosition) return\n        ordered.splice(newPosition, 0, ordered.splice(oldPosition, 1)[0])\n        for (let i = 0; i < ordered.length; i++) {\n          this.storeModification({\n            nodeIndex: ordered[i].index,\n            section: ORDER,\n            prop: 'order',\n            value: i\n          })\n        }\n      }\n    )\n  }\n\n  storeModification(props: {\n    nodeIndex?: number\n    section: symbol\n    prop: string\n    value: any\n  }) {\n    const { nodeIndex, section, prop, value } = props\n    // @ts-expect-error fixme ts strict error\n    const groupMod = (this.modifications[this.selectedGroup] ??= {})\n    const nodesMod = (groupMod.nodes ??= {})\n    const nodeMod = (nodesMod[nodeIndex ?? this.selectedNodeInnerIndex] ??= {})\n    const typeMod = (nodeMod[section] ??= {})\n    if (typeof value === 'object') {\n      const objMod = (typeMod[prop] ??= {})\n      Object.assign(objMod, value)\n    } else {\n      typeMod[prop] = value\n    }\n  }\n\n  // @ts-expect-error fixme ts strict error\n  getEditElement(section, prop, value, placeholder, checked, checkable = true) {\n    if (value === placeholder) value = ''\n\n    const mods =\n      // @ts-expect-error fixme ts strict error\n      this.modifications[this.selectedGroup]?.nodes?.[\n        this.selectedNodeInnerIndex\n      ]?.[section]?.[prop]\n    if (mods) {\n      if (mods.name != null) {\n        value = mods.name\n      }\n      if (mods.visible != null) {\n        checked = mods.visible\n      }\n    }\n\n    return $el('div', [\n      $el('input', {\n        value,\n        placeholder,\n        type: 'text',\n        // @ts-expect-error fixme ts strict error\n        onchange: (e) => {\n          this.storeModification({\n            section,\n            prop,\n            value: { name: e.target.value }\n          })\n        }\n      }),\n      $el('label', { textContent: 'Visible' }, [\n        $el('input', {\n          type: 'checkbox',\n          checked,\n          disabled: !checkable,\n          // @ts-expect-error fixme ts strict error\n          onchange: (e) => {\n            this.storeModification({\n              section,\n              prop,\n              value: { visible: !!e.target.checked }\n            })\n          }\n        })\n      ])\n    ])\n  }\n\n  buildWidgetsPage() {\n    const widgets =\n      this.groupData.oldToNewWidgetMap[this.selectedNodeInnerIndex]\n    const items = Object.keys(widgets ?? {})\n    // @ts-expect-error fixme ts strict error\n    const type = app.graph.extra.groupNodes[this.selectedGroup]\n    const config = type.config?.[this.selectedNodeInnerIndex]?.input\n    this.widgetsPage.replaceChildren(\n      ...items.map((oldName) => {\n        return this.getEditElement(\n          'input',\n          oldName,\n          widgets[oldName],\n          oldName,\n          config?.[oldName]?.visible !== false\n        )\n      })\n    )\n    return !!items.length\n  }\n\n  buildInputsPage() {\n    const inputs = this.groupData.nodeInputs[this.selectedNodeInnerIndex]\n    const items = Object.keys(inputs ?? {})\n    // @ts-expect-error fixme ts strict error\n    const type = app.graph.extra.groupNodes[this.selectedGroup]\n    const config = type.config?.[this.selectedNodeInnerIndex]?.input\n    this.inputsPage.replaceChildren(\n      // @ts-expect-error fixme ts strict error\n      ...items\n        .map((oldName) => {\n          let value = inputs[oldName]\n          if (!value) {\n            return\n          }\n\n          return this.getEditElement(\n            'input',\n            oldName,\n            value,\n            oldName,\n            config?.[oldName]?.visible !== false\n          )\n        })\n        .filter(Boolean)\n    )\n    return !!items.length\n  }\n\n  buildOutputsPage() {\n    const nodes = this.groupData.nodeData.nodes\n    const innerNodeDef = this.groupData.getNodeDef(\n      nodes[this.selectedNodeInnerIndex]\n    )\n    const outputs = innerNodeDef?.output ?? []\n    const groupOutputs =\n      this.groupData.oldToNewOutputMap[this.selectedNodeInnerIndex]\n\n    // @ts-expect-error fixme ts strict error\n    const type = app.graph.extra.groupNodes[this.selectedGroup]\n    const config = type.config?.[this.selectedNodeInnerIndex]?.output\n    const node = this.groupData.nodeData.nodes[this.selectedNodeInnerIndex]\n    const checkable = node.type !== 'PrimitiveNode'\n    this.outputsPage.replaceChildren(\n      ...outputs\n        // @ts-expect-error fixme ts strict error\n        .map((type, slot) => {\n          const groupOutputIndex = groupOutputs?.[slot]\n          const oldName = innerNodeDef.output_name?.[slot] ?? type\n          let value = config?.[slot]?.name\n          const visible = config?.[slot]?.visible || groupOutputIndex != null\n          if (!value || value === oldName) {\n            value = ''\n          }\n          return this.getEditElement(\n            'output',\n            slot,\n            value,\n            oldName,\n            visible,\n            checkable\n          )\n        })\n        .filter(Boolean)\n    )\n    return !!outputs.length\n  }\n\n  // @ts-expect-error fixme ts strict error\n  show(type?) {\n    const groupNodes = Object.keys(app.graph.extra?.groupNodes ?? {}).sort(\n      (a, b) => a.localeCompare(b)\n    )\n\n    this.innerNodesList = $el(\n      'ul.comfy-group-manage-list-items'\n    ) as HTMLUListElement\n    this.widgetsPage = $el('section.comfy-group-manage-node-page')\n    this.inputsPage = $el('section.comfy-group-manage-node-page')\n    this.outputsPage = $el('section.comfy-group-manage-node-page')\n    const pages = $el('div', [\n      this.widgetsPage,\n      this.inputsPage,\n      this.outputsPage\n    ])\n\n    this.tabs = [\n      ['Inputs', this.inputsPage],\n      ['Widgets', this.widgetsPage],\n      ['Outputs', this.outputsPage]\n      // @ts-expect-error fixme ts strict error\n    ].reduce((p, [name, page]: [string, HTMLElement]) => {\n      // @ts-expect-error fixme ts strict error\n      p[name] = {\n        tab: $el('a', {\n          onclick: () => {\n            this.changeTab(name)\n          },\n          textContent: name\n        }),\n        page\n      }\n      return p\n    }, {}) as any\n\n    const outer = $el('div.comfy-group-manage-outer', [\n      $el('header', [\n        $el('h2', 'Group Nodes'),\n        $el(\n          'select',\n          {\n            // @ts-expect-error fixme ts strict error\n            onchange: (e) => {\n              this.changeGroup(e.target.value)\n            }\n          },\n          groupNodes.map((g) =>\n            $el('option', {\n              textContent: g,\n              selected: `${PREFIX}${SEPARATOR}${g}` === type,\n              value: g\n            })\n          )\n        )\n      ]),\n      $el('main', [\n        $el('section.comfy-group-manage-list', this.innerNodesList),\n        $el('section.comfy-group-manage-node', [\n          $el(\n            'header',\n            Object.values(this.tabs).map((t) => t.tab)\n          ),\n          pages\n        ])\n      ]),\n      $el('footer', [\n        $el(\n          'button.comfy-btn',\n          {\n            onclick: () => {\n              const node = app.graph.nodes.find(\n                (n) => n.type === `${PREFIX}${SEPARATOR}` + this.selectedGroup\n              )\n              if (node) {\n                useToastStore().addAlert(\n                  'This group node is in use in the current workflow, please first remove these.'\n                )\n                return\n              }\n              if (\n                confirm(\n                  `Are you sure you want to remove the node: \"${this.selectedGroup}\"`\n                )\n              ) {\n                // @ts-expect-error fixme ts strict error\n                delete app.graph.extra.groupNodes[this.selectedGroup]\n                LiteGraph.unregisterNodeType(\n                  `${PREFIX}${SEPARATOR}` + this.selectedGroup\n                )\n              }\n              this.show()\n            }\n          },\n          'Delete Group Node'\n        ),\n        $el(\n          'button.comfy-btn',\n          {\n            onclick: async () => {\n              let nodesByType\n              let recreateNodes = []\n              const types = {}\n              for (const g in this.modifications) {\n                // @ts-expect-error fixme ts strict error\n                const type = app.graph.extra.groupNodes[g]\n                let config = (type.config ??= {})\n\n                let nodeMods = this.modifications[g]?.nodes\n                if (nodeMods) {\n                  const keys = Object.keys(nodeMods)\n                  // @ts-expect-error fixme ts strict error\n                  if (nodeMods[keys[0]][ORDER]) {\n                    // If any node is reordered, they will all need sequencing\n                    const orderedNodes = []\n                    const orderedMods = {}\n                    const orderedConfig = {}\n\n                    for (const n of keys) {\n                      // @ts-expect-error fixme ts strict error\n                      const order = nodeMods[n][ORDER].order\n                      orderedNodes[order] = type.nodes[+n]\n                      // @ts-expect-error fixme ts strict error\n                      orderedMods[order] = nodeMods[n]\n                      orderedNodes[order].index = order\n                    }\n\n                    // Rewrite links\n                    for (const l of type.links) {\n                      if (l[0] != null) l[0] = type.nodes[l[0]].index\n                      if (l[2] != null) l[2] = type.nodes[l[2]].index\n                    }\n\n                    // Rewrite externals\n                    if (type.external) {\n                      for (const ext of type.external) {\n                        ext[0] = type.nodes[ext[0]]\n                      }\n                    }\n\n                    // Rewrite modifications\n                    for (const id of keys) {\n                      if (config[id]) {\n                        // @ts-expect-error fixme ts strict error\n                        orderedConfig[type.nodes[id].index] = config[id]\n                      }\n                      delete config[id]\n                    }\n\n                    type.nodes = orderedNodes\n                    nodeMods = orderedMods\n                    type.config = config = orderedConfig\n                  }\n\n                  merge(config, nodeMods)\n                }\n\n                // @ts-expect-error fixme ts strict error\n                types[g] = type\n\n                if (!nodesByType) {\n                  nodesByType = app.graph.nodes.reduce((p, n) => {\n                    // @ts-expect-error fixme ts strict error\n                    p[n.type] ??= []\n                    // @ts-expect-error fixme ts strict error\n                    p[n.type].push(n)\n                    return p\n                  }, {})\n                }\n\n                // @ts-expect-error fixme ts strict error\n                const nodes = nodesByType[`${PREFIX}${SEPARATOR}` + g]\n                if (nodes) recreateNodes.push(...nodes)\n              }\n\n              await GroupNodeConfig.registerFromWorkflow(types, {})\n\n              for (const node of recreateNodes) {\n                node.recreate()\n              }\n\n              this.modifications = {}\n              this.app.graph.setDirtyCanvas(true, true)\n              this.changeGroup(this.selectedGroup, false)\n            }\n          },\n          'Save'\n        ),\n        $el(\n          'button.comfy-btn',\n          { onclick: () => this.element.close() },\n          'Close'\n        )\n      ])\n    ])\n\n    this.element.replaceChildren(outer)\n    this.changeGroup(\n      type\n        ? (groupNodes.find((g) => `${PREFIX}${SEPARATOR}${g}` === type) ??\n            groupNodes[0])\n        : groupNodes[0]\n    )\n    this.element.showModal()\n\n    this.element.addEventListener('close', () => {\n      this.draggable?.dispose()\n      this.element.remove()\n    })\n  }\n}\n","import _ from 'es-toolkit/compat'\n\nimport type {\n  ComboInputSpec,\n  ComboInputSpecV2,\n  FloatInputSpec,\n  InputSpec,\n  IntInputSpec,\n  NumericInputOptions\n} from '@/schemas/nodeDefSchema'\nimport {\n  getComboSpecComboOptions,\n  getInputSpecType,\n  isComboInputSpec,\n  isFloatInputSpec,\n  isIntInputSpec\n} from '@/schemas/nodeDefSchema'\n\nimport { lcm } from './mathUtil'\n\nconst IGNORE_KEYS = new Set<string>([\n  'default',\n  'forceInput',\n  'defaultInput',\n  'control_after_generate',\n  'multiline',\n  'tooltip',\n  'dynamicPrompts'\n])\n\nconst getRange = (options: NumericInputOptions) => {\n  const min = options.min ?? -Infinity\n  const max = options.max ?? Infinity\n  return { min, max }\n}\n\nconst mergeNumericInputSpec = <T extends IntInputSpec | FloatInputSpec>(\n  spec1: T,\n  spec2: T\n): T | null => {\n  const type = spec1[0]\n  const options1 = spec1[1] ?? {}\n  const options2 = spec2[1] ?? {}\n\n  const range1 = getRange(options1)\n  const range2 = getRange(options2)\n\n  // If the ranges do not overlap, return null\n  if (range1.min > range2.max || range1.max < range2.min) {\n    return null\n  }\n\n  const step1 = options1.step ?? 1\n  const step2 = options2.step ?? 1\n\n  const mergedOptions = {\n    // Take intersection of ranges\n    min: Math.max(range1.min, range2.min),\n    max: Math.min(range1.max, range2.max),\n    step: lcm(step1, step2)\n  }\n\n  return mergeCommonInputSpec(\n    [type, { ...options1, ...mergedOptions }] as T,\n    [type, { ...options2, ...mergedOptions }] as T\n  )\n}\n\nconst mergeComboInputSpec = <T extends ComboInputSpec | ComboInputSpecV2>(\n  spec1: T,\n  spec2: T\n): T | null => {\n  const options1 = spec1[1] ?? {}\n  const options2 = spec2[1] ?? {}\n\n  const comboOptions1 = getComboSpecComboOptions(spec1)\n  const comboOptions2 = getComboSpecComboOptions(spec2)\n\n  const intersection = _.intersection(comboOptions1, comboOptions2)\n\n  // If the intersection is empty, return null\n  if (intersection.length === 0) {\n    return null\n  }\n\n  return mergeCommonInputSpec(\n    ['COMBO', { ...options1, options: intersection }] as T,\n    ['COMBO', { ...options2, options: intersection }] as T\n  )\n}\n\nconst mergeCommonInputSpec = <T extends InputSpec>(\n  spec1: T,\n  spec2: T\n): T | null => {\n  const type = getInputSpecType(spec1)\n  const options1 = spec1[1] ?? {}\n  const options2 = spec2[1] ?? {}\n\n  const compareKeys = _.union(_.keys(options1), _.keys(options2)).filter(\n    (key) => !IGNORE_KEYS.has(key)\n  )\n\n  const mergeIsValid = compareKeys.every((key) => {\n    const value1 = options1[key]\n    const value2 = options2[key]\n    return value1 === value2 || (_.isNil(value1) && _.isNil(value2))\n  })\n\n  return mergeIsValid ? ([type, { ...options1, ...options2 }] as T) : null\n}\n\n/**\n * Merges two input specs.\n *\n * @param spec1 - The first input spec.\n * @param spec2 - The second input spec.\n * @returns The merged input spec, or null if the specs are not mergeable.\n */\nexport const mergeInputSpec = (\n  spec1: InputSpec,\n  spec2: InputSpec\n): InputSpec | null => {\n  const type1 = getInputSpecType(spec1)\n  const type2 = getInputSpecType(spec2)\n\n  if (type1 !== type2) {\n    return null\n  }\n\n  if (isIntInputSpec(spec1) || isFloatInputSpec(spec1)) {\n    return mergeNumericInputSpec(spec1, spec2 as typeof spec1)\n  }\n\n  if (isComboInputSpec(spec1)) {\n    return mergeComboInputSpec(spec1, spec2 as typeof spec1)\n  }\n\n  return mergeCommonInputSpec(spec1, spec2)\n}\n","import type { PrimitiveNode } from '@/extensions/core/widgetInputs'\nimport type { LGraphNode } from '@/lib/litegraph/src/litegraph'\n\nexport const isPrimitiveNode = (\n  node: LGraphNode\n): node is PrimitiveNode & LGraphNode => node.type === 'PrimitiveNode'\n","import {\n  type CallbackParams,\n  useChainCallback\n} from '@/composables/functional/useChainCallback'\nimport { LGraphNode, LiteGraph } from '@/lib/litegraph/src/litegraph'\nimport type {\n  INodeInputSlot,\n  INodeOutputSlot,\n  ISlotType,\n  LLink,\n  Point\n} from '@/lib/litegraph/src/litegraph'\nimport type { CanvasPointerEvent } from '@/lib/litegraph/src/types/events'\nimport type { IBaseWidget } from '@/lib/litegraph/src/types/widgets'\nimport type { InputSpec } from '@/schemas/nodeDefSchema'\nimport { app } from '@/scripts/app'\nimport { ComfyWidgets, addValueControlWidgets } from '@/scripts/widgets'\nimport { CONFIG, GET_CONFIG } from '@/services/litegraphService'\nimport { mergeInputSpec } from '@/utils/nodeDefUtil'\nimport { applyTextReplacements } from '@/utils/searchAndReplace'\nimport { isPrimitiveNode } from '@/renderer/utils/nodeTypeGuards'\n\nconst replacePropertyName = 'Run widget replace on values'\nexport class PrimitiveNode extends LGraphNode {\n  controlValues?: any[]\n  lastType?: string\n  static override category: string\n  constructor(title: string) {\n    super(title)\n    this.addOutput('connect to widget input', '*')\n    this.serialize_widgets = true\n    this.isVirtualNode = true\n\n    if (!this.properties || !(replacePropertyName in this.properties)) {\n      this.addProperty(replacePropertyName, false, 'boolean')\n    }\n  }\n\n  override applyToGraph(extraLinks: LLink[] = []) {\n    if (!this.outputs[0].links?.length) return\n\n    const links = [\n      ...this.outputs[0].links.map((l) => app.graph.links[l]),\n      ...extraLinks\n    ]\n    let v = this.widgets?.[0].value\n    if (v && this.properties[replacePropertyName]) {\n      v = applyTextReplacements(app.graph, v as string)\n    }\n\n    // For each output link copy our value over the original widget value\n    for (const linkInfo of links) {\n      const node = this.graph?.getNodeById(linkInfo.target_id)\n      const input = node?.inputs[linkInfo.target_slot]\n      if (!input) {\n        console.warn('Unable to resolve node or input for link', linkInfo)\n        continue\n      }\n\n      const widgetName = input.widget?.name\n      if (!widgetName) {\n        console.warn('Invalid widget or widget name', input.widget)\n        continue\n      }\n\n      const widget = node.widgets?.find((w) => w.name === widgetName)\n      if (!widget) {\n        console.warn(\n          `Unable to find widget \"${widgetName}\" on node [${node.id}]`\n        )\n        continue\n      }\n\n      widget.value = v\n      widget.callback?.(\n        widget.value,\n        app.canvas,\n        node,\n        app.canvas.graph_mouse,\n        {} as CanvasPointerEvent\n      )\n    }\n  }\n\n  override refreshComboInNode() {\n    const widget = this.widgets?.[0]\n    if (widget?.type === 'combo') {\n      // @ts-expect-error fixme ts strict error\n      widget.options.values = this.outputs[0].widget[GET_CONFIG]()[0]\n\n      // @ts-expect-error fixme ts strict error\n      if (!widget.options.values.includes(widget.value as string)) {\n        // @ts-expect-error fixme ts strict error\n        widget.value = widget.options.values[0]\n        ;(widget.callback as Function)(widget.value)\n      }\n    }\n  }\n\n  override onAfterGraphConfigured() {\n    if (this.outputs[0].links?.length && !this.widgets?.length) {\n      this.#onFirstConnection()\n\n      // Populate widget values from config data\n      if (this.widgets && this.widgets_values) {\n        for (let i = 0; i < this.widgets_values.length; i++) {\n          const w = this.widgets[i]\n          if (w) {\n            w.value = this.widgets_values[i] as any\n          }\n        }\n      }\n\n      // Merge values if required\n      this.#mergeWidgetConfig()\n    }\n  }\n\n  override onConnectionsChange(\n    _type: ISlotType,\n    _index: number,\n    connected: boolean\n  ) {\n    if (app.configuringGraph) {\n      // Dont run while the graph is still setting up\n      return\n    }\n\n    const links = this.outputs[0].links\n    if (connected) {\n      if (links?.length && !this.widgets?.length) {\n        this.#onFirstConnection()\n      }\n    } else {\n      // We may have removed a link that caused the constraints to change\n      this.#mergeWidgetConfig()\n\n      if (!links?.length) {\n        this.onLastDisconnect()\n      }\n    }\n  }\n\n  override onConnectOutput(\n    slot: number,\n    _type: string,\n    input: INodeInputSlot,\n    target_node: LGraphNode,\n    target_slot: number\n  ) {\n    // Fires before the link is made allowing us to reject it if it isn't valid\n    // No widget, we can't connect\n    if (!input.widget && !(input.type in ComfyWidgets)) {\n      return false\n    }\n\n    if (this.outputs[slot].links?.length) {\n      const valid = this.#isValidConnection(input)\n      if (valid) {\n        // On connect of additional outputs, copy our value to their widget\n        this.applyToGraph([{ target_id: target_node.id, target_slot } as LLink])\n      }\n      return valid\n    }\n\n    return true\n  }\n\n  #onFirstConnection(recreating?: boolean) {\n    // First connection can fire before the graph is ready on initial load so random things can be missing\n    if (!this.outputs[0].links || !this.graph) {\n      this.onLastDisconnect()\n      return\n    }\n    const linkId = this.outputs[0].links[0]\n    const link = this.graph.links[linkId]\n    if (!link) return\n\n    const theirNode = this.graph.getNodeById(link.target_id)\n    if (!theirNode || !theirNode.inputs) return\n\n    const input = theirNode.inputs[link.target_slot]\n    if (!input) return\n\n    let widget\n    if (!input.widget) {\n      if (!(input.type in ComfyWidgets)) return\n      widget = { name: input.name, [GET_CONFIG]: () => [input.type, {}] } //fake widget\n    } else {\n      widget = input.widget\n    }\n\n    // @ts-expect-error fixme ts strict error\n    const config = widget[GET_CONFIG]?.()\n    if (!config) return\n\n    const { type } = getWidgetType(config)\n    // Update our output to restrict to the widget type\n    this.outputs[0].type = type\n    this.outputs[0].name = type\n    this.outputs[0].widget = widget\n\n    this.#createWidget(\n      widget[CONFIG] ?? config,\n      theirNode,\n      widget.name,\n      // @ts-expect-error fixme ts strict error\n      recreating\n    )\n  }\n\n  #createWidget(\n    inputData: InputSpec,\n    node: LGraphNode,\n    widgetName: string,\n    recreating: boolean\n  ) {\n    let type = inputData[0]\n\n    if (type instanceof Array) {\n      type = 'COMBO'\n    }\n\n    // Store current size as addWidget resizes the node\n    const [oldWidth, oldHeight] = this.size\n    let widget: IBaseWidget | undefined\n    if (type in ComfyWidgets) {\n      widget = (ComfyWidgets[type](this, 'value', inputData, app) || {}).widget\n    } else {\n      // @ts-expect-error InputSpec is not typed correctly\n      widget = this.addWidget(type, 'value', null, () => {}, {})\n    }\n\n    if (node?.widgets && widget) {\n      const theirWidget = node.widgets.find((w) => w.name === widgetName)\n      if (theirWidget) {\n        widget.value = theirWidget.value\n      }\n    }\n\n    if (\n      !inputData?.[1]?.control_after_generate &&\n      (widget.type === 'number' || widget.type === 'combo')\n    ) {\n      let control_value = this.widgets_values?.[1]\n      if (!control_value) {\n        control_value = 'fixed'\n      }\n      addValueControlWidgets(\n        this,\n        widget,\n        control_value as string,\n        undefined,\n        inputData\n      )\n      let filter = this.widgets_values?.[2]\n      if (filter && this.widgets && this.widgets.length === 3) {\n        this.widgets[2].value = filter\n      }\n    }\n\n    // Restore any saved control values\n    const controlValues = this.controlValues\n    if (\n      this.widgets &&\n      this.lastType === this.widgets[0]?.type &&\n      controlValues?.length === this.widgets.length - 1\n    ) {\n      for (let i = 0; i < controlValues.length; i++) {\n        this.widgets[i + 1].value = controlValues[i]\n      }\n    }\n\n    // When our value changes, update other widgets to reflect our changes\n    // e.g. so LoadImage shows correct image\n    widget.callback = useChainCallback(widget.callback, () => {\n      this.applyToGraph()\n    })\n\n    // Use the biggest dimensions in case the widgets caused the node to grow\n    this.setSize([\n      Math.max(this.size[0], oldWidth),\n      Math.max(this.size[1], oldHeight)\n    ])\n\n    if (!recreating) {\n      // Grow our node more if required\n      const sz = this.computeSize()\n      if (this.size[0] < sz[0]) {\n        this.size[0] = sz[0]\n      }\n      if (this.size[1] < sz[1]) {\n        this.size[1] = sz[1]\n      }\n\n      requestAnimationFrame(() => {\n        this.onResize?.(this.size)\n      })\n    }\n  }\n\n  recreateWidget() {\n    const values = this.widgets?.map((w) => w.value)\n    this.#removeWidgets()\n    this.#onFirstConnection(true)\n    if (values?.length && this.widgets) {\n      for (let i = 0; i < this.widgets.length; i++)\n        this.widgets[i].value = values[i]\n    }\n    return this.widgets?.[0]\n  }\n\n  #mergeWidgetConfig() {\n    // Merge widget configs if the node has multiple outputs\n    const output = this.outputs[0]\n    const links = output.links ?? []\n\n    const hasConfig = !!output.widget?.[CONFIG]\n    if (hasConfig) {\n      delete output.widget?.[CONFIG]\n    }\n\n    if (links?.length < 2 && hasConfig) {\n      // Copy the widget options from the source\n      if (links.length) {\n        this.recreateWidget()\n      }\n\n      return\n    }\n    const config1 = (output.widget?.[GET_CONFIG] as () => InputSpec)?.()\n    if (!config1) return\n    const isNumber = config1[0] === 'INT' || config1[0] === 'FLOAT'\n    if (!isNumber) return\n\n    for (const linkId of links) {\n      const link = app.graph.links[linkId]\n      if (!link) continue // Can be null when removing a node\n\n      const theirNode = app.graph.getNodeById(link.target_id)\n      if (!theirNode) continue\n      const theirInput = theirNode.inputs[link.target_slot]\n\n      // Call is valid connection so it can merge the configs when validating\n      this.#isValidConnection(theirInput, hasConfig)\n    }\n  }\n\n  #isValidConnection(input: INodeInputSlot, forceUpdate?: boolean) {\n    // Only allow connections where the configs match\n    const output = this.outputs?.[0]\n    const config2 = (input.widget?.[GET_CONFIG] as () => InputSpec)?.()\n    if (!config2) return false\n\n    return !!mergeIfValid.call(\n      this,\n      output,\n      config2,\n      forceUpdate,\n      this.recreateWidget\n    )\n  }\n\n  #removeWidgets() {\n    if (this.widgets) {\n      // Allow widgets to cleanup\n      for (const w of this.widgets) {\n        if (w.onRemove) {\n          w.onRemove()\n        }\n      }\n\n      // Temporarily store the current values in case the node is being recreated\n      // e.g. by group node conversion\n      this.controlValues = []\n      this.lastType = this.widgets[0]?.type\n      for (let i = 1; i < this.widgets.length; i++) {\n        this.controlValues.push(this.widgets[i].value)\n      }\n      setTimeout(() => {\n        delete this.lastType\n        delete this.controlValues\n      }, 15)\n      this.widgets.length = 0\n    }\n  }\n\n  onLastDisconnect() {\n    // We can't remove + re-add the output here as if you drag a link over the same link\n    // it removes, then re-adds, causing it to break\n    this.outputs[0].type = '*'\n    this.outputs[0].name = 'connect to widget input'\n    delete this.outputs[0].widget\n\n    this.#removeWidgets()\n  }\n}\n\nexport function getWidgetConfig(\n  slot: INodeInputSlot | INodeOutputSlot\n): InputSpec {\n  return (slot.widget?.[CONFIG] ??\n    (slot.widget?.[GET_CONFIG] as () => InputSpec)?.() ?? [\n      '*',\n      {}\n    ]) as InputSpec\n}\n\nfunction getConfig(this: LGraphNode, widgetName: string) {\n  const { nodeData } = this.constructor\n  return (\n    nodeData?.input?.required?.[widgetName] ??\n    nodeData?.input?.optional?.[widgetName]\n  )\n}\n\n/**\n * Convert a widget to an input slot.\n * @deprecated Widget to socket conversion is no longer necessary, as they co-exist now.\n * @param node The node to convert the widget to an input slot for.\n * @param widget The widget to convert to an input slot.\n * @returns The input slot that was converted from the widget or undefined if the widget is not found.\n * @knipIgnoreUnusedButUsedByCustomNodes\n */\nexport function convertToInput(\n  node: LGraphNode,\n  widget: IBaseWidget\n): INodeInputSlot | undefined {\n  console.warn(\n    'Please remove call to convertToInput. Widget to socket conversion is no longer necessary, as they co-exist now.'\n  )\n  return node.inputs.find((slot) => slot.widget?.name === widget.name)\n}\n\nfunction getWidgetType(config: InputSpec) {\n  // Special handling for COMBO so we restrict links based on the entries\n  let type = config[0]\n  if (type instanceof Array) {\n    type = 'COMBO'\n  }\n  return { type }\n}\n\nexport function setWidgetConfig(\n  slot: INodeInputSlot | INodeOutputSlot,\n  config?: InputSpec\n) {\n  if (!slot.widget) return\n  if (config) {\n    slot.widget[GET_CONFIG] = () => config\n  } else {\n    delete slot.widget\n  }\n\n  if ('link' in slot) {\n    const link = app.graph.links[slot.link ?? -1]\n    if (link) {\n      const originNode = app.graph.getNodeById(link.origin_id)\n      if (originNode && isPrimitiveNode(originNode)) {\n        if (config) {\n          originNode.recreateWidget()\n        } else if (!app.configuringGraph) {\n          originNode.disconnectOutput(0)\n          originNode.onLastDisconnect()\n        }\n      }\n    }\n  }\n}\n\nexport function mergeIfValid(\n  output: INodeOutputSlot | INodeInputSlot,\n  config2: InputSpec,\n  forceUpdate?: boolean,\n  recreateWidget?: () => void,\n  config1?: InputSpec\n): { customConfig: InputSpec[1] } {\n  if (!config1) {\n    config1 = getWidgetConfig(output)\n  }\n\n  const customSpec = mergeInputSpec(config1, config2)\n\n  if (customSpec || forceUpdate) {\n    if (customSpec) {\n      // @ts-expect-error fixme ts strict error\n      output.widget[CONFIG] = customSpec\n    }\n\n    // @ts-expect-error fixme ts strict error\n    const widget = recreateWidget?.call(this)\n    // When deleting a node this can be null\n    if (widget) {\n      // @ts-expect-error fixme ts strict error\n      const min = widget.options.min\n      // @ts-expect-error fixme ts strict error\n      const max = widget.options.max\n      // @ts-expect-error fixme ts strict error\n      if (min != null && widget.value < min) widget.value = min\n      // @ts-expect-error fixme ts strict error\n      if (max != null && widget.value > max) widget.value = max\n      // @ts-expect-error fixme ts strict error\n      widget.callback(widget.value)\n    }\n  }\n\n  return { customConfig: customSpec?.[1] ?? {} }\n}\n\napp.registerExtension({\n  name: 'Comfy.WidgetInputs',\n  async beforeRegisterNodeDef(nodeType, _nodeData, app) {\n    // @ts-expect-error adding extra property\n    nodeType.prototype.convertWidgetToInput = function (this: LGraphNode) {\n      console.warn(\n        'Please remove call to convertWidgetToInput. Widget to socket conversion is no longer necessary, as they co-exist now.'\n      )\n      return false\n    }\n\n    nodeType.prototype.onGraphConfigured = useChainCallback(\n      nodeType.prototype.onGraphConfigured,\n      function (this: LGraphNode) {\n        if (!this.inputs) return\n        this.widgets ??= []\n\n        for (const input of this.inputs) {\n          if (input.widget) {\n            const name = input.widget.name\n            if (!input.widget[GET_CONFIG]) {\n              input.widget[GET_CONFIG] = () => getConfig.call(this, name)\n            }\n\n            const w = this.widgets?.find((w) => w.name === name)\n            if (!w) {\n              this.removeInput(this.inputs.findIndex((i) => i === input))\n            }\n          }\n        }\n      }\n    )\n\n    nodeType.prototype.onConfigure = useChainCallback(\n      nodeType.prototype.onConfigure,\n      function (this: LGraphNode) {\n        if (!app.configuringGraph && this.inputs) {\n          // On copy + paste of nodes, ensure that widget configs are set up\n          for (const input of this.inputs) {\n            if (input.widget && !input.widget[GET_CONFIG]) {\n              const name = input.widget.name\n              input.widget[GET_CONFIG] = () => getConfig.call(this, name)\n            }\n          }\n        }\n      }\n    )\n\n    function isNodeAtPos(pos: Point) {\n      for (const n of app.graph.nodes) {\n        if (n.pos[0] === pos[0] && n.pos[1] === pos[1]) {\n          return true\n        }\n      }\n      return false\n    }\n\n    // Double click a widget input to automatically attach a primitive\n    const origOnInputDblClick = nodeType.prototype.onInputDblClick\n    nodeType.prototype.onInputDblClick = function (\n      this: LGraphNode,\n      ...[slot, ...args]: CallbackParams<typeof origOnInputDblClick>\n    ) {\n      const r = origOnInputDblClick?.apply(this, [slot, ...args])\n\n      const input = this.inputs[slot]\n      if (!input.widget) {\n        // Not a widget input or already handled input\n        if (\n          !(input.type in ComfyWidgets) &&\n          !(\n            (\n              input.widget?.[GET_CONFIG] as (() => InputSpec) | undefined\n            )?.()?.[0] instanceof Array\n          )\n        ) {\n          return r //also Not a ComfyWidgets input or combo (do nothing)\n        }\n      }\n\n      // Create a primitive node\n      const node = LiteGraph.createNode('PrimitiveNode')\n      if (!node) return r\n\n      this.graph?.add(node)\n\n      // Calculate a position that won't directly overlap another node\n      const pos: [number, number] = [\n        this.pos[0] - node.size[0] - 30,\n        this.pos[1]\n      ]\n      while (isNodeAtPos(pos)) {\n        pos[1] += LiteGraph.NODE_TITLE_HEIGHT\n      }\n\n      node.pos = pos\n      node.connect(0, this, slot)\n      node.title = input.name\n\n      return r\n    }\n  },\n  registerCustomNodes() {\n    LiteGraph.registerNodeType(\n      'PrimitiveNode',\n      Object.assign(PrimitiveNode, {\n        title: 'Primitive'\n      })\n    )\n    PrimitiveNode.category = 'utils'\n  }\n})\n","import { PREFIX, SEPARATOR } from '@/constants/groupNodeConstants'\nimport { t } from '@/i18n'\nimport { type NodeId } from '@/lib/litegraph/src/LGraphNode'\nimport type { IContextMenuValue } from '@/lib/litegraph/src/interfaces'\nimport {\n  type ExecutableLGraphNode,\n  type ExecutionId,\n  LGraphNode,\n  LiteGraph,\n  SubgraphNode\n} from '@/lib/litegraph/src/litegraph'\nimport { useToastStore } from '@/platform/updates/common/toastStore'\nimport {\n  type ComfyLink,\n  type ComfyNode,\n  type ComfyWorkflowJSON\n} from '@/platform/workflow/validation/schemas/workflowSchema'\nimport type { ComfyNodeDef } from '@/schemas/nodeDefSchema'\nimport { useDialogService } from '@/services/dialogService'\nimport { useExecutionStore } from '@/stores/executionStore'\nimport { useNodeDefStore } from '@/stores/nodeDefStore'\nimport { useWidgetStore } from '@/stores/widgetStore'\nimport { type ComfyExtension } from '@/types/comfy'\nimport { ExecutableGroupNodeChildDTO } from '@/utils/executableGroupNodeChildDTO'\nimport { GROUP } from '@/utils/executableGroupNodeDto'\nimport { deserialiseAndCreate, serialise } from '@/utils/vintageClipboard'\n\nimport { api } from '../../scripts/api'\nimport { app } from '../../scripts/app'\nimport { ManageGroupDialog } from './groupNodeManage'\nimport { mergeIfValid } from './widgetInputs'\n\ntype GroupNodeWorkflowData = {\n  external: ComfyLink[]\n  links: ComfyLink[]\n  nodes: ComfyNode[]\n}\n\nconst Workflow = {\n  InUse: {\n    Free: 0,\n    Registered: 1,\n    InWorkflow: 2\n  },\n  // @ts-expect-error fixme ts strict error\n  isInUseGroupNode(name) {\n    const id = `${PREFIX}${SEPARATOR}${name}`\n    // Check if lready registered/in use in this workflow\n    // @ts-expect-error fixme ts strict error\n    if (app.graph.extra?.groupNodes?.[name]) {\n      if (app.graph.nodes.find((n) => n.type === id)) {\n        return Workflow.InUse.InWorkflow\n      } else {\n        return Workflow.InUse.Registered\n      }\n    }\n    return Workflow.InUse.Free\n  },\n  storeGroupNode(name: string, data: GroupNodeWorkflowData) {\n    let extra = app.graph.extra\n    if (!extra) app.graph.extra = extra = {}\n    let groupNodes = extra.groupNodes\n    if (!groupNodes) extra.groupNodes = groupNodes = {}\n    // @ts-expect-error fixme ts strict error\n    groupNodes[name] = data\n  }\n}\n\nclass GroupNodeBuilder {\n  nodes: LGraphNode[]\n  // @ts-expect-error fixme ts strict error\n  nodeData: GroupNodeWorkflowData\n\n  constructor(nodes: LGraphNode[]) {\n    this.nodes = nodes\n  }\n\n  async build() {\n    const name = await this.getName()\n    if (!name) return\n\n    // Sort the nodes so they are in execution order\n    // this allows for widgets to be in the correct order when reconstructing\n    this.sortNodes()\n\n    this.nodeData = this.getNodeData()\n    Workflow.storeGroupNode(name, this.nodeData)\n\n    return { name, nodeData: this.nodeData }\n  }\n\n  async getName() {\n    const name = await useDialogService().prompt({\n      title: t('groupNode.create'),\n      message: t('groupNode.enterName'),\n      defaultValue: ''\n    })\n    if (!name) return\n    const used = Workflow.isInUseGroupNode(name)\n    switch (used) {\n      case Workflow.InUse.InWorkflow:\n        useToastStore().addAlert(\n          'An in use group node with this name already exists embedded in this workflow, please remove any instances or use a new name.'\n        )\n        return\n      case Workflow.InUse.Registered:\n        if (\n          !confirm(\n            'A group node with this name already exists embedded in this workflow, are you sure you want to overwrite it?'\n          )\n        ) {\n          return\n        }\n        break\n    }\n    return name\n  }\n\n  sortNodes() {\n    // Gets the builders nodes in graph execution order\n    const nodesInOrder = app.graph.computeExecutionOrder(false)\n    this.nodes = this.nodes\n      .map((node) => ({ index: nodesInOrder.indexOf(node), node }))\n      // @ts-expect-error id might be string\n      .sort((a, b) => a.index - b.index || a.node.id - b.node.id)\n      .map(({ node }) => node)\n  }\n\n  getNodeData() {\n    // @ts-expect-error fixme ts strict error\n    const storeLinkTypes = (config) => {\n      // Store link types for dynamically typed nodes e.g. reroutes\n      for (const link of config.links) {\n        const origin = app.graph.getNodeById(link[4])\n        // @ts-expect-error fixme ts strict error\n        const type = origin.outputs[link[1]].type\n        link.push(type)\n      }\n    }\n\n    // @ts-expect-error fixme ts strict error\n    const storeExternalLinks = (config) => {\n      // Store any external links to the group in the config so when rebuilding we add extra slots\n      config.external = []\n      for (let i = 0; i < this.nodes.length; i++) {\n        const node = this.nodes[i]\n        if (!node.outputs?.length) continue\n        for (let slot = 0; slot < node.outputs.length; slot++) {\n          let hasExternal = false\n          const output = node.outputs[slot]\n          let type = output.type\n          if (!output.links?.length) continue\n          for (const l of output.links) {\n            const link = app.graph.links[l]\n            if (!link) continue\n            if (type === '*') type = link.type\n\n            if (!app.canvas.selected_nodes[link.target_id]) {\n              hasExternal = true\n              break\n            }\n          }\n          if (hasExternal) {\n            config.external.push([i, slot, type])\n          }\n        }\n      }\n    }\n\n    // Use the built in copyToClipboard function to generate the node data we need\n    try {\n      // @ts-expect-error fixme ts strict error\n      const serialised = serialise(this.nodes, app.canvas?.graph)\n      const config = JSON.parse(serialised)\n\n      storeLinkTypes(config)\n      storeExternalLinks(config)\n\n      return config\n    } finally {\n    }\n  }\n}\n\nexport class GroupNodeConfig {\n  name: string\n  nodeData: any\n  inputCount: number\n  oldToNewOutputMap: {}\n  newToOldOutputMap: {}\n  oldToNewInputMap: {}\n  oldToNewWidgetMap: {}\n  newToOldWidgetMap: {}\n  primitiveDefs: {}\n  widgetToPrimitive: {}\n  primitiveToWidget: {}\n  nodeInputs: {}\n  outputVisibility: any[]\n  // @ts-expect-error fixme ts strict error\n  nodeDef: ComfyNodeDef\n  // @ts-expect-error fixme ts strict error\n  inputs: any[]\n  // @ts-expect-error fixme ts strict error\n  linksFrom: {}\n  // @ts-expect-error fixme ts strict error\n  linksTo: {}\n  // @ts-expect-error fixme ts strict error\n  externalFrom: {}\n\n  // @ts-expect-error fixme ts strict error\n  constructor(name, nodeData) {\n    this.name = name\n    this.nodeData = nodeData\n    this.getLinks()\n\n    this.inputCount = 0\n    this.oldToNewOutputMap = {}\n    this.newToOldOutputMap = {}\n    this.oldToNewInputMap = {}\n    this.oldToNewWidgetMap = {}\n    this.newToOldWidgetMap = {}\n    this.primitiveDefs = {}\n    this.widgetToPrimitive = {}\n    this.primitiveToWidget = {}\n    this.nodeInputs = {}\n    this.outputVisibility = []\n  }\n\n  async registerType(source = PREFIX) {\n    this.nodeDef = {\n      output: [],\n      output_name: [],\n      output_is_list: [],\n      // @ts-expect-error Unused, doesn't exist\n      output_is_hidden: [],\n      name: source + SEPARATOR + this.name,\n      display_name: this.name,\n      category: 'group nodes' + (SEPARATOR + source),\n      input: { required: {} },\n      description: `Group node combining ${this.nodeData.nodes\n        // @ts-expect-error fixme ts strict error\n        .map((n) => n.type)\n        .join(', ')}`,\n      python_module: 'custom_nodes.' + this.name,\n\n      [GROUP]: this\n    }\n\n    this.inputs = []\n    const seenInputs = {}\n    const seenOutputs = {}\n    for (let i = 0; i < this.nodeData.nodes.length; i++) {\n      const node = this.nodeData.nodes[i]\n      node.index = i\n      this.processNode(node, seenInputs, seenOutputs)\n    }\n\n    for (const p of this.#convertedToProcess) {\n      // @ts-expect-error fixme ts strict error\n      p()\n    }\n    // @ts-expect-error fixme ts strict error\n    this.#convertedToProcess = null\n    await app.registerNodeDef(`${PREFIX}${SEPARATOR}` + this.name, this.nodeDef)\n    useNodeDefStore().addNodeDef(this.nodeDef)\n  }\n\n  getLinks() {\n    this.linksFrom = {}\n    this.linksTo = {}\n    this.externalFrom = {}\n\n    // Extract links for easy lookup\n    for (const l of this.nodeData.links) {\n      const [sourceNodeId, sourceNodeSlot, targetNodeId, targetNodeSlot] = l\n\n      // Skip links outside the copy config\n      if (sourceNodeId == null) continue\n\n      // @ts-expect-error fixme ts strict error\n      if (!this.linksFrom[sourceNodeId]) {\n        // @ts-expect-error fixme ts strict error\n        this.linksFrom[sourceNodeId] = {}\n      }\n      // @ts-expect-error fixme ts strict error\n      if (!this.linksFrom[sourceNodeId][sourceNodeSlot]) {\n        // @ts-expect-error fixme ts strict error\n        this.linksFrom[sourceNodeId][sourceNodeSlot] = []\n      }\n      // @ts-expect-error fixme ts strict error\n      this.linksFrom[sourceNodeId][sourceNodeSlot].push(l)\n\n      // @ts-expect-error fixme ts strict error\n      if (!this.linksTo[targetNodeId]) {\n        // @ts-expect-error fixme ts strict error\n        this.linksTo[targetNodeId] = {}\n      }\n      // @ts-expect-error fixme ts strict error\n      this.linksTo[targetNodeId][targetNodeSlot] = l\n    }\n\n    if (this.nodeData.external) {\n      for (const ext of this.nodeData.external) {\n        // @ts-expect-error fixme ts strict error\n        if (!this.externalFrom[ext[0]]) {\n          // @ts-expect-error fixme ts strict error\n          this.externalFrom[ext[0]] = { [ext[1]]: ext[2] }\n        } else {\n          // @ts-expect-error fixme ts strict error\n          this.externalFrom[ext[0]][ext[1]] = ext[2]\n        }\n      }\n    }\n  }\n\n  // @ts-expect-error fixme ts strict error\n  processNode(node, seenInputs, seenOutputs) {\n    const def = this.getNodeDef(node)\n    if (!def) return\n\n    const inputs = { ...def.input?.required, ...def.input?.optional }\n\n    this.inputs.push(this.processNodeInputs(node, seenInputs, inputs))\n    if (def.output?.length) this.processNodeOutputs(node, seenOutputs, def)\n  }\n\n  // @ts-expect-error fixme ts strict error\n  getNodeDef(node) {\n    // @ts-expect-error fixme ts strict error\n    const def = globalDefs[node.type]\n    if (def) return def\n\n    // @ts-expect-error fixme ts strict error\n    const linksFrom = this.linksFrom[node.index]\n    if (node.type === 'PrimitiveNode') {\n      // Skip as its not linked\n      if (!linksFrom) return\n\n      let type = linksFrom['0'][0][5]\n      if (type === 'COMBO') {\n        // Use the array items\n        const source = node.outputs[0].widget.name\n        const fromTypeName = this.nodeData.nodes[linksFrom['0'][0][2]].type\n        // @ts-expect-error fixme ts strict error\n        const fromType = globalDefs[fromTypeName]\n        const input =\n          fromType.input.required[source] ?? fromType.input.optional[source]\n        type = input[0]\n      }\n\n      // @ts-expect-error fixme ts strict error\n      const def = (this.primitiveDefs[node.index] = {\n        input: {\n          required: {\n            value: [type, {}]\n          }\n        },\n        output: [type],\n        output_name: [],\n        output_is_list: []\n      })\n      return def\n    } else if (node.type === 'Reroute') {\n      // @ts-expect-error fixme ts strict error\n      const linksTo = this.linksTo[node.index]\n      // @ts-expect-error fixme ts strict error\n      if (linksTo && linksFrom && !this.externalFrom[node.index]?.[0]) {\n        // Being used internally\n        return null\n      }\n\n      let config = {}\n      let rerouteType = '*'\n      if (linksFrom) {\n        for (const [, , id, slot] of linksFrom['0']) {\n          const node = this.nodeData.nodes[id]\n          const input = node.inputs[slot]\n          if (rerouteType === '*') {\n            rerouteType = input.type\n          }\n          if (input.widget) {\n            // @ts-expect-error fixme ts strict error\n            const targetDef = globalDefs[node.type]\n            const targetWidget =\n              targetDef.input.required[input.widget.name] ??\n              targetDef.input.optional[input.widget.name]\n\n            const widget = [targetWidget[0], config]\n            const res = mergeIfValid(\n              {\n                // @ts-expect-error fixme ts strict error\n                widget\n              },\n              targetWidget,\n              false,\n              null,\n              widget\n            )\n            config = res?.customConfig ?? config\n          }\n        }\n      } else if (linksTo) {\n        const [id, slot] = linksTo['0']\n        rerouteType = this.nodeData.nodes[id].outputs[slot].type\n      } else {\n        // Reroute used as a pipe\n        for (const l of this.nodeData.links) {\n          if (l[2] === node.index) {\n            rerouteType = l[5]\n            break\n          }\n        }\n        if (rerouteType === '*') {\n          // Check for an external link\n          // @ts-expect-error fixme ts strict error\n          const t = this.externalFrom[node.index]?.[0]\n          if (t) {\n            rerouteType = t\n          }\n        }\n      }\n\n      // @ts-expect-error\n      config.forceInput = true\n      return {\n        input: {\n          required: {\n            [rerouteType]: [rerouteType, config]\n          }\n        },\n        output: [rerouteType],\n        output_name: [],\n        output_is_list: []\n      }\n    }\n\n    console.warn(\n      'Skipping virtual node ' +\n        node.type +\n        ' when building group node ' +\n        this.name\n    )\n  }\n\n  // @ts-expect-error fixme ts strict error\n  getInputConfig(node, inputName, seenInputs, config, extra?) {\n    const customConfig = this.nodeData.config?.[node.index]?.input?.[inputName]\n    let name =\n      customConfig?.name ??\n      // @ts-expect-error fixme ts strict error\n      node.inputs?.find((inp) => inp.name === inputName)?.label ??\n      inputName\n    let key = name\n    let prefix = ''\n    // Special handling for primitive to include the title if it is set rather than just \"value\"\n    if ((node.type === 'PrimitiveNode' && node.title) || name in seenInputs) {\n      prefix = `${node.title ?? node.type} `\n      key = name = `${prefix}${inputName}`\n      if (name in seenInputs) {\n        name = `${prefix}${seenInputs[name]} ${inputName}`\n      }\n    }\n    seenInputs[key] = (seenInputs[key] ?? 1) + 1\n\n    if (inputName === 'seed' || inputName === 'noise_seed') {\n      if (!extra) extra = {}\n      extra.control_after_generate = `${prefix}control_after_generate`\n    }\n    if (config[0] === 'IMAGEUPLOAD') {\n      if (!extra) extra = {}\n      extra.widget =\n        // @ts-expect-error fixme ts strict error\n        this.oldToNewWidgetMap[node.index]?.[config[1]?.widget ?? 'image'] ??\n        'image'\n    }\n\n    if (extra) {\n      config = [config[0], { ...config[1], ...extra }]\n    }\n\n    return { name, config, customConfig }\n  }\n\n  // @ts-expect-error fixme ts strict error\n  processWidgetInputs(inputs, node, inputNames, seenInputs) {\n    const slots = []\n    const converted = new Map()\n    // @ts-expect-error fixme ts strict error\n    const widgetMap = (this.oldToNewWidgetMap[node.index] = {})\n    for (const inputName of inputNames) {\n      if (useWidgetStore().inputIsWidget(inputs[inputName])) {\n        const convertedIndex = node.inputs?.findIndex(\n          // @ts-expect-error fixme ts strict error\n          (inp) => inp.name === inputName && inp.widget?.name === inputName\n        )\n        if (convertedIndex > -1) {\n          // This widget has been converted to a widget\n          // We need to store this in the correct position so link ids line up\n          converted.set(convertedIndex, inputName)\n          // @ts-expect-error fixme ts strict error\n          widgetMap[inputName] = null\n        } else {\n          // Normal widget\n          const { name, config } = this.getInputConfig(\n            node,\n            inputName,\n            seenInputs,\n            inputs[inputName]\n          )\n          // @ts-expect-error fixme ts strict error\n          this.nodeDef.input.required[name] = config\n          // @ts-expect-error fixme ts strict error\n          widgetMap[inputName] = name\n          // @ts-expect-error fixme ts strict error\n          this.newToOldWidgetMap[name] = { node, inputName }\n        }\n      } else {\n        // Normal input\n        slots.push(inputName)\n      }\n    }\n    return { converted, slots }\n  }\n\n  // @ts-expect-error fixme ts strict error\n  checkPrimitiveConnection(link, inputName, inputs) {\n    const sourceNode = this.nodeData.nodes[link[0]]\n    if (sourceNode.type === 'PrimitiveNode') {\n      // Merge link configurations\n      const [sourceNodeId, _, targetNodeId, __] = link\n      // @ts-expect-error fixme ts strict error\n      const primitiveDef = this.primitiveDefs[sourceNodeId]\n      const targetWidget = inputs[inputName]\n      const primitiveConfig = primitiveDef.input.required.value\n      const output = { widget: primitiveConfig }\n      const config = mergeIfValid(\n        // @ts-expect-error invalid slot type\n        output,\n        targetWidget,\n        false,\n        null,\n        primitiveConfig\n      )\n      primitiveConfig[1] =\n        (config?.customConfig ?? inputs[inputName][1])\n          ? { ...inputs[inputName][1] }\n          : {}\n\n      // @ts-expect-error fixme ts strict error\n      let name = this.oldToNewWidgetMap[sourceNodeId]['value']\n      name = name.substr(0, name.length - 6)\n      primitiveConfig[1].control_after_generate = true\n      primitiveConfig[1].control_prefix = name\n\n      // @ts-expect-error fixme ts strict error\n      let toPrimitive = this.widgetToPrimitive[targetNodeId]\n      if (!toPrimitive) {\n        // @ts-expect-error fixme ts strict error\n        toPrimitive = this.widgetToPrimitive[targetNodeId] = {}\n      }\n      if (toPrimitive[inputName]) {\n        toPrimitive[inputName].push(sourceNodeId)\n      }\n      toPrimitive[inputName] = sourceNodeId\n\n      // @ts-expect-error fixme ts strict error\n      let toWidget = this.primitiveToWidget[sourceNodeId]\n      if (!toWidget) {\n        // @ts-expect-error fixme ts strict error\n        toWidget = this.primitiveToWidget[sourceNodeId] = []\n      }\n      toWidget.push({ nodeId: targetNodeId, inputName })\n    }\n  }\n\n  // @ts-expect-error fixme ts strict error\n  processInputSlots(inputs, node, slots, linksTo, inputMap, seenInputs) {\n    // @ts-expect-error fixme ts strict error\n    this.nodeInputs[node.index] = {}\n    for (let i = 0; i < slots.length; i++) {\n      const inputName = slots[i]\n      if (linksTo[i]) {\n        this.checkPrimitiveConnection(linksTo[i], inputName, inputs)\n        // This input is linked so we can skip it\n        continue\n      }\n\n      const { name, config, customConfig } = this.getInputConfig(\n        node,\n        inputName,\n        seenInputs,\n        inputs[inputName]\n      )\n\n      // @ts-expect-error fixme ts strict error\n      this.nodeInputs[node.index][inputName] = name\n      if (customConfig?.visible === false) continue\n\n      // @ts-expect-error fixme ts strict error\n      this.nodeDef.input.required[name] = config\n      inputMap[i] = this.inputCount++\n    }\n  }\n\n  processConvertedWidgets(\n    // @ts-expect-error fixme ts strict error\n    inputs,\n    // @ts-expect-error fixme ts strict error\n    node,\n    // @ts-expect-error fixme ts strict error\n    slots,\n    // @ts-expect-error fixme ts strict error\n    converted,\n    // @ts-expect-error fixme ts strict error\n    linksTo,\n    // @ts-expect-error fixme ts strict error\n    inputMap,\n    // @ts-expect-error fixme ts strict error\n    seenInputs\n  ) {\n    // Add converted widgets sorted into their index order (ordered as they were converted) so link ids match up\n    const convertedSlots = [...converted.keys()]\n      .sort()\n      .map((k) => converted.get(k))\n    for (let i = 0; i < convertedSlots.length; i++) {\n      const inputName = convertedSlots[i]\n      if (linksTo[slots.length + i]) {\n        this.checkPrimitiveConnection(\n          linksTo[slots.length + i],\n          inputName,\n          inputs\n        )\n        // This input is linked so we can skip it\n        continue\n      }\n\n      const { name, config } = this.getInputConfig(\n        node,\n        inputName,\n        seenInputs,\n        inputs[inputName],\n        {\n          defaultInput: true\n        }\n      )\n\n      // @ts-expect-error fixme ts strict error\n      this.nodeDef.input.required[name] = config\n      // @ts-expect-error fixme ts strict error\n      this.newToOldWidgetMap[name] = { node, inputName }\n\n      // @ts-expect-error fixme ts strict error\n      if (!this.oldToNewWidgetMap[node.index]) {\n        // @ts-expect-error fixme ts strict error\n        this.oldToNewWidgetMap[node.index] = {}\n      }\n      // @ts-expect-error fixme ts strict error\n      this.oldToNewWidgetMap[node.index][inputName] = name\n\n      inputMap[slots.length + i] = this.inputCount++\n    }\n  }\n\n  #convertedToProcess = []\n  // @ts-expect-error fixme ts strict error\n  processNodeInputs(node, seenInputs, inputs) {\n    // @ts-expect-error fixme ts strict error\n    const inputMapping = []\n\n    const inputNames = Object.keys(inputs)\n    if (!inputNames.length) return\n\n    const { converted, slots } = this.processWidgetInputs(\n      inputs,\n      node,\n      inputNames,\n      seenInputs\n    )\n    // @ts-expect-error fixme ts strict error\n    const linksTo = this.linksTo[node.index] ?? {}\n    // @ts-expect-error fixme ts strict error\n    const inputMap = (this.oldToNewInputMap[node.index] = {})\n    this.processInputSlots(inputs, node, slots, linksTo, inputMap, seenInputs)\n\n    // Converted inputs have to be processed after all other nodes as they'll be at the end of the list\n    // @ts-expect-error fixme ts strict error\n    this.#convertedToProcess.push(() =>\n      this.processConvertedWidgets(\n        inputs,\n        node,\n        slots,\n        converted,\n        linksTo,\n        inputMap,\n        seenInputs\n      )\n    )\n\n    // @ts-expect-error fixme ts strict error\n    return inputMapping\n  }\n\n  // @ts-expect-error fixme ts strict error\n  processNodeOutputs(node, seenOutputs, def) {\n    // @ts-expect-error fixme ts strict error\n    const oldToNew = (this.oldToNewOutputMap[node.index] = {})\n\n    // Add outputs\n    for (let outputId = 0; outputId < def.output.length; outputId++) {\n      // @ts-expect-error fixme ts strict error\n      const linksFrom = this.linksFrom[node.index]\n      // If this output is linked internally we flag it to hide\n      const hasLink =\n        // @ts-expect-error fixme ts strict error\n        linksFrom?.[outputId] && !this.externalFrom[node.index]?.[outputId]\n      const customConfig =\n        this.nodeData.config?.[node.index]?.output?.[outputId]\n      const visible = customConfig?.visible ?? !hasLink\n      this.outputVisibility.push(visible)\n      if (!visible) {\n        continue\n      }\n\n      // @ts-expect-error fixme ts strict error\n      oldToNew[outputId] = this.nodeDef.output.length\n      // @ts-expect-error fixme ts strict error\n      this.newToOldOutputMap[this.nodeDef.output.length] = {\n        node,\n        slot: outputId\n      }\n      // @ts-expect-error fixme ts strict error\n      this.nodeDef.output.push(def.output[outputId])\n      // @ts-expect-error fixme ts strict error\n      this.nodeDef.output_is_list.push(def.output_is_list[outputId])\n\n      let label = customConfig?.name\n      if (!label) {\n        label = def.output_name?.[outputId] ?? def.output[outputId]\n        // @ts-expect-error fixme ts strict error\n        const output = node.outputs.find((o) => o.name === label)\n        if (output?.label) {\n          label = output.label\n        }\n      }\n\n      let name = label\n      if (name in seenOutputs) {\n        const prefix = `${node.title ?? node.type} `\n        name = `${prefix}${label}`\n        if (name in seenOutputs) {\n          name = `${prefix}${node.index} ${label}`\n        }\n      }\n      seenOutputs[name] = 1\n\n      // @ts-expect-error fixme ts strict error\n      this.nodeDef.output_name.push(name)\n    }\n  }\n\n  // @ts-expect-error fixme ts strict error\n  static async registerFromWorkflow(groupNodes, missingNodeTypes) {\n    for (const g in groupNodes) {\n      const groupData = groupNodes[g]\n\n      let hasMissing = false\n      for (const n of groupData.nodes) {\n        // Find missing node types\n        if (!(n.type in LiteGraph.registered_node_types)) {\n          missingNodeTypes.push({\n            type: n.type,\n            hint: ` (In group node '${PREFIX}${SEPARATOR}${g}')`\n          })\n\n          missingNodeTypes.push({\n            type: `${PREFIX}${SEPARATOR}` + g,\n            action: {\n              text: 'Remove from workflow',\n              // @ts-expect-error fixme ts strict error\n              callback: (e) => {\n                delete groupNodes[g]\n                e.target.textContent = 'Removed'\n                e.target.style.pointerEvents = 'none'\n                e.target.style.opacity = 0.7\n              }\n            }\n          })\n\n          hasMissing = true\n        }\n      }\n\n      if (hasMissing) continue\n\n      const config = new GroupNodeConfig(g, groupData)\n      await config.registerType()\n    }\n  }\n}\n\nexport class GroupNodeHandler {\n  node: LGraphNode\n  groupData: any\n  innerNodes: any\n\n  constructor(node: LGraphNode) {\n    this.node = node\n    this.groupData = node.constructor?.nodeData?.[GROUP]\n\n    this.node.setInnerNodes = (innerNodes) => {\n      this.innerNodes = innerNodes\n\n      for (\n        let innerNodeIndex = 0;\n        innerNodeIndex < this.innerNodes.length;\n        innerNodeIndex++\n      ) {\n        const innerNode = this.innerNodes[innerNodeIndex]\n        innerNode.graph ??= this.node.graph\n\n        for (const w of innerNode.widgets ?? []) {\n          if (w.type === 'converted-widget') {\n            w.serializeValue = w.origSerializeValue\n          }\n        }\n\n        innerNode.index = innerNodeIndex\n        // @ts-expect-error fixme ts strict error\n        innerNode.getInputNode = (slot) => {\n          // Check if this input is internal or external\n          const externalSlot =\n            this.groupData.oldToNewInputMap[innerNode.index]?.[slot]\n          if (externalSlot != null) {\n            return this.node.getInputNode(externalSlot)\n          }\n\n          // Internal link\n          const innerLink = this.groupData.linksTo[innerNode.index]?.[slot]\n          if (!innerLink) return null\n\n          const inputNode = innerNodes[innerLink[0]]\n          // Primitives will already apply their values\n          if (inputNode.type === 'PrimitiveNode') return null\n\n          return inputNode\n        }\n\n        // @ts-expect-error fixme ts strict error\n        innerNode.getInputLink = (slot) => {\n          const externalSlot =\n            this.groupData.oldToNewInputMap[innerNode.index]?.[slot]\n          if (externalSlot != null) {\n            // The inner node is connected via the group node inputs\n            const linkId = this.node.inputs[externalSlot].link\n            // @ts-expect-error fixme ts strict error\n            let link = app.graph.links[linkId]\n\n            // Use the outer link, but update the target to the inner node\n            link = {\n              ...link,\n              target_id: innerNode.id,\n              target_slot: +slot\n            }\n            return link\n          }\n\n          let link = this.groupData.linksTo[innerNode.index]?.[slot]\n          if (!link) return null\n          // Use the inner link, but update the origin node to be inner node id\n          link = {\n            origin_id: innerNodes[link[0]].id,\n            origin_slot: link[1],\n            target_id: innerNode.id,\n            target_slot: +slot\n          }\n          return link\n        }\n      }\n    }\n\n    this.node.updateLink = (link) => {\n      // Replace the group node reference with the internal node\n      // @ts-expect-error Can this be removed?  Or replaced with: LLink.create(link.asSerialisable())\n      link = { ...link }\n      const output = this.groupData.newToOldOutputMap[link.origin_slot]\n      let innerNode = this.innerNodes[output.node.index]\n      let l\n      while (innerNode?.type === 'Reroute') {\n        l = innerNode.getInputLink(0)\n        innerNode = innerNode.getInputNode(0)\n      }\n\n      if (!innerNode) {\n        return null\n      }\n\n      if (l && GroupNodeHandler.isGroupNode(innerNode)) {\n        return innerNode.updateLink(l)\n      }\n\n      link.origin_id = innerNode.id\n      link.origin_slot = l?.origin_slot ?? output.slot\n      return link\n    }\n\n    /** @internal Used to flatten the subgraph before execution. Recursive; call with no args. */\n    this.node.getInnerNodes = (\n      computedNodeDtos: Map<ExecutionId, ExecutableLGraphNode>,\n      /** The path of subgraph node IDs. */\n      subgraphNodePath: readonly NodeId[] = [],\n      /** The list of nodes to add to. */\n      nodes: ExecutableLGraphNode[] = [],\n      /** The set of visited nodes. */\n      visited = new Set<LGraphNode>()\n    ): ExecutableLGraphNode[] => {\n      if (visited.has(this.node))\n        throw new Error('RecursionError: while flattening subgraph')\n      visited.add(this.node)\n\n      if (!this.innerNodes) {\n        // @ts-expect-error fixme ts strict error\n        this.node.setInnerNodes(\n          // @ts-expect-error fixme ts strict error\n          this.groupData.nodeData.nodes.map((n, i) => {\n            const innerNode = LiteGraph.createNode(n.type)\n            // @ts-expect-error fixme ts strict error\n            innerNode.configure(n)\n            // @ts-expect-error fixme ts strict error\n            innerNode.id = `${this.node.id}:${i}`\n            // @ts-expect-error fixme ts strict error\n            innerNode.graph = this.node.graph\n            return innerNode\n          })\n        )\n      }\n\n      this.updateInnerWidgets()\n\n      const subgraphInstanceIdPath = [...subgraphNodePath, this.node.id]\n\n      // Assertion: Deprecated, does not matter.\n      const subgraphNode = (this.node.graph?.getNodeById(\n        subgraphNodePath.at(-1)\n      ) ?? undefined) as SubgraphNode | undefined\n\n      for (const node of this.innerNodes) {\n        node.graph ??= this.node.graph\n\n        // Create minimal DTOs rather than cloning the node\n        const currentId = String(node.id)\n        node.id = currentId.split(':').at(-1)\n        const aVeryRealNode = new ExecutableGroupNodeChildDTO(\n          node,\n          subgraphInstanceIdPath,\n          computedNodeDtos,\n          subgraphNode\n        )\n        node.id = currentId\n        aVeryRealNode.groupNodeHandler = this\n\n        nodes.push(aVeryRealNode)\n      }\n      return nodes\n    }\n\n    // @ts-expect-error fixme ts strict error\n    this.node.recreate = async () => {\n      const id = this.node.id\n      const sz = this.node.size\n      // @ts-expect-error fixme ts strict error\n      const nodes = this.node.convertToNodes()\n\n      const groupNode = LiteGraph.createNode(this.node.type)\n      // @ts-expect-error fixme ts strict error\n      groupNode.id = id\n\n      // Reuse the existing nodes for this instance\n      // @ts-expect-error fixme ts strict error\n      groupNode.setInnerNodes(nodes)\n      // @ts-expect-error fixme ts strict error\n      groupNode[GROUP].populateWidgets()\n      // @ts-expect-error fixme ts strict error\n      app.graph.add(groupNode)\n      // @ts-expect-error fixme ts strict error\n      groupNode.setSize([\n        // @ts-expect-error fixme ts strict error\n        Math.max(groupNode.size[0], sz[0]),\n        // @ts-expect-error fixme ts strict error\n        Math.max(groupNode.size[1], sz[1])\n      ])\n\n      // Remove all converted nodes and relink them\n      const builder = new GroupNodeBuilder(nodes)\n      const nodeData = builder.getNodeData()\n      // @ts-expect-error fixme ts strict error\n      groupNode[GROUP].groupData.nodeData.links = nodeData.links\n      // @ts-expect-error fixme ts strict error\n      groupNode[GROUP].replaceNodes(nodes)\n      return groupNode\n    }\n\n    // @ts-expect-error fixme ts strict error\n    this.node.convertToNodes = () => {\n      const addInnerNodes = () => {\n        // Clone the node data so we dont mutate it for other nodes\n        const c = { ...this.groupData.nodeData }\n        c.nodes = [...c.nodes]\n        // @ts-expect-error fixme ts strict error\n        const innerNodes = this.node.getInnerNodes()\n        let ids = []\n        for (let i = 0; i < c.nodes.length; i++) {\n          let id = innerNodes?.[i]?.id\n          // Use existing IDs if they are set on the inner nodes\n          // @ts-expect-error id can be string or number\n          if (id == null || isNaN(id)) {\n            // @ts-expect-error fixme ts strict error\n            id = undefined\n          } else {\n            ids.push(id)\n          }\n          c.nodes[i] = { ...c.nodes[i], id }\n        }\n        deserialiseAndCreate(JSON.stringify(c), app.canvas)\n\n        const [x, y] = this.node.pos\n        let top\n        let left\n        // Configure nodes with current widget data\n        const selectedIds = ids.length\n          ? ids\n          : Object.keys(app.canvas.selected_nodes)\n        const newNodes = []\n        for (let i = 0; i < selectedIds.length; i++) {\n          const id = selectedIds[i]\n          const newNode = app.graph.getNodeById(id)\n          const innerNode = innerNodes[i]\n          newNodes.push(newNode)\n\n          // @ts-expect-error fixme ts strict error\n          if (left == null || newNode.pos[0] < left) {\n            // @ts-expect-error fixme ts strict error\n            left = newNode.pos[0]\n          }\n          // @ts-expect-error fixme ts strict error\n          if (top == null || newNode.pos[1] < top) {\n            // @ts-expect-error fixme ts strict error\n            top = newNode.pos[1]\n          }\n\n          // @ts-expect-error fixme ts strict error\n          if (!newNode.widgets) continue\n\n          // @ts-expect-error fixme ts strict error\n          const map = this.groupData.oldToNewWidgetMap[innerNode.index]\n          if (map) {\n            const widgets = Object.keys(map)\n\n            for (const oldName of widgets) {\n              const newName = map[oldName]\n              if (!newName) continue\n\n              // @ts-expect-error fixme ts strict error\n              const widgetIndex = this.node.widgets.findIndex(\n                (w) => w.name === newName\n              )\n              if (widgetIndex === -1) continue\n\n              // Populate the main and any linked widgets\n              if (innerNode.type === 'PrimitiveNode') {\n                // @ts-expect-error fixme ts strict error\n                for (let i = 0; i < newNode.widgets.length; i++) {\n                  // @ts-expect-error fixme ts strict error\n                  newNode.widgets[i].value =\n                    // @ts-expect-error fixme ts strict error\n                    this.node.widgets[widgetIndex + i].value\n                }\n              } else {\n                // @ts-expect-error fixme ts strict error\n                const outerWidget = this.node.widgets[widgetIndex]\n                // @ts-expect-error fixme ts strict error\n                const newWidget = newNode.widgets.find(\n                  (w) => w.name === oldName\n                )\n                if (!newWidget) continue\n\n                newWidget.value = outerWidget.value\n                // @ts-expect-error fixme ts strict error\n                for (let w = 0; w < outerWidget.linkedWidgets?.length; w++) {\n                  // @ts-expect-error fixme ts strict error\n                  newWidget.linkedWidgets[w].value =\n                    // @ts-expect-error fixme ts strict error\n                    outerWidget.linkedWidgets[w].value\n                }\n              }\n            }\n          }\n        }\n\n        // Shift each node\n        for (const newNode of newNodes) {\n          // @ts-expect-error fixme ts strict error\n          newNode.pos[0] -= left - x\n          // @ts-expect-error fixme ts strict error\n          newNode.pos[1] -= top - y\n        }\n\n        return { newNodes, selectedIds }\n      }\n\n      // @ts-expect-error fixme ts strict error\n      const reconnectInputs = (selectedIds) => {\n        for (const innerNodeIndex in this.groupData.oldToNewInputMap) {\n          const id = selectedIds[innerNodeIndex]\n          const newNode = app.graph.getNodeById(id)\n          const map = this.groupData.oldToNewInputMap[innerNodeIndex]\n          for (const innerInputId in map) {\n            const groupSlotId = map[innerInputId]\n            if (groupSlotId == null) continue\n            const slot = node.inputs[groupSlotId]\n            if (slot.link == null) continue\n            const link = app.graph.links[slot.link]\n            if (!link) continue\n            //  connect this node output to the input of another node\n            const originNode = app.graph.getNodeById(link.origin_id)\n            // @ts-expect-error fixme ts strict error\n            originNode.connect(link.origin_slot, newNode, +innerInputId)\n          }\n        }\n      }\n\n      // @ts-expect-error fixme ts strict error\n      const reconnectOutputs = (selectedIds) => {\n        for (\n          let groupOutputId = 0;\n          groupOutputId < node.outputs?.length;\n          groupOutputId++\n        ) {\n          const output = node.outputs[groupOutputId]\n          if (!output.links) continue\n          const links = [...output.links]\n          for (const l of links) {\n            const slot = this.groupData.newToOldOutputMap[groupOutputId]\n            const link = app.graph.links[l]\n            const targetNode = app.graph.getNodeById(link.target_id)\n            const newNode = app.graph.getNodeById(selectedIds[slot.node.index])\n            // @ts-expect-error fixme ts strict error\n            newNode.connect(slot.slot, targetNode, link.target_slot)\n          }\n        }\n      }\n\n      app.canvas.emitBeforeChange()\n\n      try {\n        const { newNodes, selectedIds } = addInnerNodes()\n        reconnectInputs(selectedIds)\n        reconnectOutputs(selectedIds)\n        app.graph.remove(this.node)\n\n        return newNodes\n      } finally {\n        app.canvas.emitAfterChange()\n      }\n    }\n\n    const getExtraMenuOptions = this.node.getExtraMenuOptions\n    // @ts-expect-error Should pass patched return value getExtraMenuOptions\n    this.node.getExtraMenuOptions = function (_, options) {\n      // @ts-expect-error fixme ts strict error\n      getExtraMenuOptions?.apply(this, arguments)\n\n      let optionIndex = options.findIndex((o) => o?.content === 'Outputs')\n      if (optionIndex === -1) optionIndex = options.length\n      else optionIndex++\n      options.splice(\n        optionIndex,\n        0,\n        null,\n        {\n          content: 'Convert to nodes',\n          // @ts-expect-error\n          callback: () => {\n            // @ts-expect-error fixme ts strict error\n            return this.convertToNodes()\n          }\n        },\n        {\n          content: 'Manage Group Node',\n          callback: () => manageGroupNodes(this.type)\n        }\n      )\n    }\n\n    // Draw custom collapse icon to identity this as a group\n    const onDrawTitleBox = this.node.onDrawTitleBox\n    this.node.onDrawTitleBox = function (ctx, height) {\n      // @ts-expect-error fixme ts strict error\n      onDrawTitleBox?.apply(this, arguments)\n\n      const fill = ctx.fillStyle\n      ctx.beginPath()\n      ctx.rect(11, -height + 11, 2, 2)\n      ctx.rect(14, -height + 11, 2, 2)\n      ctx.rect(17, -height + 11, 2, 2)\n      ctx.rect(11, -height + 14, 2, 2)\n      ctx.rect(14, -height + 14, 2, 2)\n      ctx.rect(17, -height + 14, 2, 2)\n      ctx.rect(11, -height + 17, 2, 2)\n      ctx.rect(14, -height + 17, 2, 2)\n      ctx.rect(17, -height + 17, 2, 2)\n\n      ctx.fillStyle = this.boxcolor || LiteGraph.NODE_DEFAULT_BOXCOLOR\n      ctx.fill()\n      ctx.fillStyle = fill\n    }\n\n    // Draw progress label\n    const onDrawForeground = node.onDrawForeground\n    const groupData = this.groupData.nodeData\n    node.onDrawForeground = function (ctx) {\n      // @ts-expect-error fixme ts strict error\n      onDrawForeground?.apply?.(this, arguments)\n      const progressState = useExecutionStore().nodeProgressStates[this.id]\n      if (\n        progressState &&\n        progressState.state === 'running' &&\n        this.runningInternalNodeId !== null\n      ) {\n        // @ts-expect-error fixme ts strict error\n        const n = groupData.nodes[this.runningInternalNodeId]\n        if (!n) return\n        const message = `Running ${n.title || n.type} (${this.runningInternalNodeId}/${groupData.nodes.length})`\n        ctx.save()\n        ctx.font = '12px sans-serif'\n        const sz = ctx.measureText(message)\n        ctx.fillStyle = node.boxcolor || LiteGraph.NODE_DEFAULT_BOXCOLOR\n        ctx.beginPath()\n        ctx.roundRect(\n          0,\n          -LiteGraph.NODE_TITLE_HEIGHT - 20,\n          sz.width + 12,\n          20,\n          5\n        )\n        ctx.fill()\n\n        ctx.fillStyle = '#fff'\n        ctx.fillText(message, 6, -LiteGraph.NODE_TITLE_HEIGHT - 6)\n        ctx.restore()\n      }\n    }\n\n    // Flag this node as needing to be reset\n    const onExecutionStart = this.node.onExecutionStart\n    this.node.onExecutionStart = function () {\n      // @ts-expect-error fixme ts strict error\n      this.resetExecution = true\n      // @ts-expect-error fixme ts strict error\n      return onExecutionStart?.apply(this, arguments)\n    }\n\n    const self = this\n    const onNodeCreated = this.node.onNodeCreated\n    this.node.onNodeCreated = function () {\n      if (!this.widgets) {\n        return\n      }\n      const config = self.groupData.nodeData.config\n      if (config) {\n        for (const n in config) {\n          const inputs = config[n]?.input\n          for (const w in inputs) {\n            if (inputs[w].visible !== false) continue\n            const widgetName = self.groupData.oldToNewWidgetMap[n][w]\n            const widget = this.widgets.find((w) => w.name === widgetName)\n            if (widget) {\n              widget.type = 'hidden'\n              widget.computeSize = () => [0, -4]\n            }\n          }\n        }\n      }\n\n      // @ts-expect-error fixme ts strict error\n      return onNodeCreated?.apply(this, arguments)\n    }\n\n    // @ts-expect-error fixme ts strict error\n    function handleEvent(type, getId, getEvent) {\n      // @ts-expect-error fixme ts strict error\n      const handler = ({ detail }) => {\n        const id = getId(detail)\n        if (!id) return\n        const node = app.graph.getNodeById(id)\n        if (node) return\n\n        // @ts-expect-error fixme ts strict error\n        const innerNodeIndex = this.innerNodes?.findIndex((n) => n.id == id)\n        if (innerNodeIndex > -1) {\n          // @ts-expect-error fixme ts strict error\n          this.node.runningInternalNodeId = innerNodeIndex\n          api.dispatchCustomEvent(\n            type,\n            // @ts-expect-error fixme ts strict error\n            getEvent(detail, `${this.node.id}`, this.node)\n          )\n        }\n      }\n      api.addEventListener(type, handler)\n      return handler\n    }\n\n    const executing = handleEvent.call(\n      this,\n      'executing',\n      // @ts-expect-error fixme ts strict error\n      (d) => d,\n      // @ts-expect-error fixme ts strict error\n      (_, id) => id\n    )\n\n    const executed = handleEvent.call(\n      this,\n      'executed',\n      // @ts-expect-error fixme ts strict error\n      (d) => d?.display_node || d?.node,\n      // @ts-expect-error fixme ts strict error\n      (d, id, node) => ({\n        ...d,\n        node: id,\n        display_node: id,\n        merge: !node.resetExecution\n      })\n    )\n\n    const onRemoved = node.onRemoved\n    this.node.onRemoved = function () {\n      // @ts-expect-error fixme ts strict error\n      onRemoved?.apply(this, arguments)\n      // api.removeEventListener('progress_state', progress_state)\n      api.removeEventListener('executing', executing)\n      api.removeEventListener('executed', executed)\n    }\n\n    this.node.refreshComboInNode = (defs) => {\n      // Update combo widget options\n      for (const widgetName in this.groupData.newToOldWidgetMap) {\n        // @ts-expect-error fixme ts strict error\n        const widget = this.node.widgets.find((w) => w.name === widgetName)\n        if (widget?.type === 'combo') {\n          const old = this.groupData.newToOldWidgetMap[widgetName]\n          const def = defs[old.node.type]\n          const input =\n            def?.input?.required?.[old.inputName] ??\n            def?.input?.optional?.[old.inputName]\n          if (!input) continue\n\n          widget.options.values = input[0]\n\n          if (\n            old.inputName !== 'image' &&\n            // @ts-expect-error Widget values\n            !widget.options.values.includes(widget.value)\n          ) {\n            // @ts-expect-error fixme ts strict error\n            widget.value = widget.options.values[0]\n            // @ts-expect-error fixme ts strict error\n            widget.callback(widget.value)\n          }\n        }\n      }\n    }\n  }\n\n  updateInnerWidgets() {\n    for (const newWidgetName in this.groupData.newToOldWidgetMap) {\n      // @ts-expect-error fixme ts strict error\n      const newWidget = this.node.widgets.find((w) => w.name === newWidgetName)\n      if (!newWidget) continue\n\n      const newValue = newWidget.value\n      const old = this.groupData.newToOldWidgetMap[newWidgetName]\n      let innerNode = this.innerNodes[old.node.index]\n\n      if (innerNode.type === 'PrimitiveNode') {\n        innerNode.primitiveValue = newValue\n        const primitiveLinked = this.groupData.primitiveToWidget[old.node.index]\n        for (const linked of primitiveLinked ?? []) {\n          const node = this.innerNodes[linked.nodeId]\n          // @ts-expect-error fixme ts strict error\n          const widget = node.widgets.find((w) => w.name === linked.inputName)\n\n          if (widget) {\n            widget.value = newValue\n          }\n        }\n        continue\n      } else if (innerNode.type === 'Reroute') {\n        const rerouteLinks = this.groupData.linksFrom[old.node.index]\n        if (rerouteLinks) {\n          for (const [_, , targetNodeId, targetSlot] of rerouteLinks['0']) {\n            const node = this.innerNodes[targetNodeId]\n            const input = node.inputs[targetSlot]\n            if (input.widget) {\n              const widget = node.widgets?.find(\n                // @ts-expect-error fixme ts strict error\n                (w) => w.name === input.widget.name\n              )\n              if (widget) {\n                widget.value = newValue\n              }\n            }\n          }\n        }\n      }\n\n      // @ts-expect-error fixme ts strict error\n      const widget = innerNode.widgets?.find((w) => w.name === old.inputName)\n      if (widget) {\n        widget.value = newValue\n      }\n    }\n  }\n\n  // @ts-expect-error fixme ts strict error\n  populatePrimitive(_node, nodeId, oldName) {\n    // Converted widget, populate primitive if linked\n    const primitiveId = this.groupData.widgetToPrimitive[nodeId]?.[oldName]\n    if (primitiveId == null) return\n    const targetWidgetName =\n      this.groupData.oldToNewWidgetMap[primitiveId]['value']\n    // @ts-expect-error fixme ts strict error\n    const targetWidgetIndex = this.node.widgets.findIndex(\n      (w) => w.name === targetWidgetName\n    )\n    if (targetWidgetIndex > -1) {\n      const primitiveNode = this.innerNodes[primitiveId]\n      let len = primitiveNode.widgets.length\n      if (\n        len - 1 !==\n        // @ts-expect-error fixme ts strict error\n        this.node.widgets[targetWidgetIndex].linkedWidgets?.length\n      ) {\n        // Fallback handling for if some reason the primitive has a different number of widgets\n        // we dont want to overwrite random widgets, better to leave blank\n        len = 1\n      }\n      for (let i = 0; i < len; i++) {\n        // @ts-expect-error fixme ts strict error\n        this.node.widgets[targetWidgetIndex + i].value =\n          primitiveNode.widgets[i].value\n      }\n    }\n    return true\n  }\n\n  // @ts-expect-error fixme ts strict error\n  populateReroute(node, nodeId, map) {\n    if (node.type !== 'Reroute') return\n\n    const link = this.groupData.linksFrom[nodeId]?.[0]?.[0]\n    if (!link) return\n    const [, , targetNodeId, targetNodeSlot] = link\n    const targetNode = this.groupData.nodeData.nodes[targetNodeId]\n    const inputs = targetNode.inputs\n    const targetWidget = inputs?.[targetNodeSlot]?.widget\n    if (!targetWidget) return\n\n    const offset = inputs.length - (targetNode.widgets_values?.length ?? 0)\n    const v = targetNode.widgets_values?.[targetNodeSlot - offset]\n    if (v == null) return\n\n    const widgetName = Object.values(map)[0]\n    // @ts-expect-error fixme ts strict error\n    const widget = this.node.widgets.find((w) => w.name === widgetName)\n    if (widget) {\n      widget.value = v\n    }\n  }\n\n  populateWidgets() {\n    if (!this.node.widgets) return\n\n    for (\n      let nodeId = 0;\n      nodeId < this.groupData.nodeData.nodes.length;\n      nodeId++\n    ) {\n      const node = this.groupData.nodeData.nodes[nodeId]\n      const map = this.groupData.oldToNewWidgetMap[nodeId] ?? {}\n      const widgets = Object.keys(map)\n\n      if (!node.widgets_values?.length) {\n        // special handling for populating values into reroutes\n        // this allows primitives connect to them to pick up the correct value\n        this.populateReroute(node, nodeId, map)\n        continue\n      }\n\n      let linkedShift = 0\n      for (let i = 0; i < widgets.length; i++) {\n        const oldName = widgets[i]\n        const newName = map[oldName]\n        const widgetIndex = this.node.widgets.findIndex(\n          (w) => w.name === newName\n        )\n        const mainWidget = this.node.widgets[widgetIndex]\n        if (\n          this.populatePrimitive(node, nodeId, oldName) ||\n          widgetIndex === -1\n        ) {\n          // Find the inner widget and shift by the number of linked widgets as they will have been removed too\n          const innerWidget = this.innerNodes[nodeId].widgets?.find(\n            // @ts-expect-error fixme ts strict error\n            (w) => w.name === oldName\n          )\n          linkedShift += innerWidget?.linkedWidgets?.length ?? 0\n        }\n        if (widgetIndex === -1) {\n          continue\n        }\n\n        // Populate the main and any linked widget\n        mainWidget.value = node.widgets_values[i + linkedShift]\n        // @ts-expect-error fixme ts strict error\n        for (let w = 0; w < mainWidget.linkedWidgets?.length; w++) {\n          this.node.widgets[widgetIndex + w + 1].value =\n            node.widgets_values[i + ++linkedShift]\n        }\n      }\n    }\n  }\n\n  // @ts-expect-error fixme ts strict error\n  replaceNodes(nodes) {\n    let top\n    let left\n\n    for (let i = 0; i < nodes.length; i++) {\n      const node = nodes[i]\n      if (left == null || node.pos[0] < left) {\n        left = node.pos[0]\n      }\n      if (top == null || node.pos[1] < top) {\n        top = node.pos[1]\n      }\n\n      this.linkOutputs(node, i)\n      app.graph.remove(node)\n\n      // Set internal ID to what is expected after workflow is reloaded\n      node.id = `${this.node.id}:${i}`\n    }\n\n    this.linkInputs()\n    this.node.pos = [left, top]\n  }\n\n  // @ts-expect-error fixme ts strict error\n  linkOutputs(originalNode, nodeId) {\n    if (!originalNode.outputs) return\n\n    for (const output of originalNode.outputs) {\n      if (!output.links) continue\n      // Clone the links as they'll be changed if we reconnect\n      const links = [...output.links]\n      for (const l of links) {\n        const link = app.graph.links[l]\n        if (!link) continue\n\n        const targetNode = app.graph.getNodeById(link.target_id)\n        const newSlot =\n          this.groupData.oldToNewOutputMap[nodeId]?.[link.origin_slot]\n        if (newSlot != null) {\n          // @ts-expect-error fixme ts strict error\n          this.node.connect(newSlot, targetNode, link.target_slot)\n        }\n      }\n    }\n  }\n\n  linkInputs() {\n    for (const link of this.groupData.nodeData.links ?? []) {\n      const [, originSlot, targetId, targetSlot, actualOriginId] = link\n      const originNode = app.graph.getNodeById(actualOriginId)\n      if (!originNode) continue // this node is in the group\n      originNode.connect(\n        originSlot,\n        // @ts-expect-error Valid - uses deprecated interface.  Required check: if (graph.getNodeById(this.node.id) !== this.node) report()\n        this.node.id,\n        this.groupData.oldToNewInputMap[targetId][targetSlot]\n      )\n    }\n  }\n\n  // @ts-expect-error fixme ts strict error\n  static getGroupData(node) {\n    return (node.nodeData ?? node.constructor?.nodeData)?.[GROUP]\n  }\n\n  static isGroupNode(node: LGraphNode) {\n    return !!node.constructor?.nodeData?.[GROUP]\n  }\n\n  static async fromNodes(nodes: LGraphNode[]) {\n    // Process the nodes into the stored workflow group node data\n    const builder = new GroupNodeBuilder(nodes)\n    const res = await builder.build()\n    if (!res) return\n\n    const { name, nodeData } = res\n\n    // Convert this data into a LG node definition and register it\n    const config = new GroupNodeConfig(name, nodeData)\n    await config.registerType()\n\n    const groupNode = LiteGraph.createNode(`${PREFIX}${SEPARATOR}${name}`)\n    // Reuse the existing nodes for this instance\n    // @ts-expect-error fixme ts strict error\n    groupNode.setInnerNodes(builder.nodes)\n    // @ts-expect-error fixme ts strict error\n    groupNode[GROUP].populateWidgets()\n    // @ts-expect-error fixme ts strict error\n    app.graph.add(groupNode)\n\n    // Remove all converted nodes and relink them\n    // @ts-expect-error fixme ts strict error\n    groupNode[GROUP].replaceNodes(builder.nodes)\n    return groupNode\n  }\n}\n\nconst replaceLegacySeparators = (nodes: ComfyNode[]): void => {\n  for (const node of nodes) {\n    if (typeof node.type === 'string' && node.type.startsWith('workflow/')) {\n      node.type = node.type.replace(/^workflow\\//, `${PREFIX}${SEPARATOR}`)\n    }\n  }\n}\n\n/**\n * Convert selected nodes to a group node\n * @throws {Error} if no nodes are selected\n * @throws {Error} if a group node is already selected\n * @throws {Error} if a group node is selected\n *\n * The context menu item should not be available if any of the above conditions are met.\n * The error is automatically handled by the commandStore when the command is executed.\n */\nasync function convertSelectedNodesToGroupNode() {\n  const nodes = Object.values(app.canvas.selected_nodes ?? {})\n  if (nodes.length === 0) {\n    throw new Error('No nodes selected')\n  }\n  if (nodes.length === 1) {\n    throw new Error('Please select multiple nodes to convert to group node')\n  }\n\n  for (const node of nodes) {\n    if (node instanceof SubgraphNode) {\n      throw new Error('Selected nodes contain a subgraph node')\n    }\n    if (GroupNodeHandler.isGroupNode(node)) {\n      throw new Error('Selected nodes contain a group node')\n    }\n  }\n  return await GroupNodeHandler.fromNodes(nodes)\n}\n\nconst convertDisabled = (selected: LGraphNode[]) =>\n  selected.length < 2 || !!selected.find((n) => GroupNodeHandler.isGroupNode(n))\n\nfunction ungroupSelectedGroupNodes() {\n  const nodes = Object.values(app.canvas.selected_nodes ?? {})\n  for (const node of nodes) {\n    if (GroupNodeHandler.isGroupNode(node)) {\n      node.convertToNodes?.()\n    }\n  }\n}\n\nfunction manageGroupNodes(type?: string) {\n  new ManageGroupDialog(app).show(type)\n}\n\nconst id = 'Comfy.GroupNode'\n// @ts-expect-error fixme ts strict error\nlet globalDefs\nconst ext: ComfyExtension = {\n  name: id,\n  commands: [\n    {\n      id: 'Comfy.GroupNode.ConvertSelectedNodesToGroupNode',\n      label: 'Convert selected nodes to group node',\n      icon: 'pi pi-sitemap',\n      versionAdded: '1.3.17',\n      function: () => convertSelectedNodesToGroupNode()\n    },\n    {\n      id: 'Comfy.GroupNode.UngroupSelectedGroupNodes',\n      label: 'Ungroup selected group nodes',\n      icon: 'pi pi-sitemap',\n      versionAdded: '1.3.17',\n      function: () => ungroupSelectedGroupNodes()\n    },\n    {\n      id: 'Comfy.GroupNode.ManageGroupNodes',\n      label: 'Manage group nodes',\n      icon: 'pi pi-cog',\n      versionAdded: '1.3.17',\n      function: (...args: unknown[]) =>\n        manageGroupNodes(args[0] as string | undefined)\n    }\n  ],\n  keybindings: [\n    {\n      commandId: 'Comfy.GroupNode.ConvertSelectedNodesToGroupNode',\n      combo: {\n        alt: true,\n        key: 'g'\n      }\n    },\n    {\n      commandId: 'Comfy.GroupNode.UngroupSelectedGroupNodes',\n      combo: {\n        alt: true,\n        shift: true,\n        key: 'G'\n      }\n    }\n  ],\n\n  getCanvasMenuItems(canvas): IContextMenuValue[] {\n    const items: IContextMenuValue[] = []\n    const selected = Object.values(canvas.selected_nodes ?? {})\n    const convertEnabled = !convertDisabled(selected)\n\n    items.push({\n      content: `Convert to Group Node (Deprecated)`,\n      disabled: !convertEnabled,\n      // @ts-expect-error fixme ts strict error - async callback\n      callback: () => convertSelectedNodesToGroupNode()\n    })\n\n    const groups = canvas.graph?.extra?.groupNodes\n    const manageDisabled = !groups || !Object.keys(groups).length\n    items.push({\n      content: `Manage Group Nodes`,\n      disabled: manageDisabled,\n      callback: () => manageGroupNodes()\n    })\n\n    return items\n  },\n\n  getNodeMenuItems(node): IContextMenuValue[] {\n    if (GroupNodeHandler.isGroupNode(node)) {\n      return []\n    }\n\n    const selected = Object.values(app.canvas.selected_nodes ?? {})\n    const convertEnabled = !convertDisabled(selected)\n\n    return [\n      {\n        content: `Convert to Group Node (Deprecated)`,\n        disabled: !convertEnabled,\n        // @ts-expect-error fixme ts strict error - async callback\n        callback: () => convertSelectedNodesToGroupNode()\n      }\n    ]\n  },\n  async beforeConfigureGraph(\n    graphData: ComfyWorkflowJSON,\n    missingNodeTypes: string[]\n  ) {\n    const nodes = graphData?.extra?.groupNodes\n    if (nodes) {\n      replaceLegacySeparators(graphData.nodes)\n      await GroupNodeConfig.registerFromWorkflow(nodes, missingNodeTypes)\n    }\n  },\n  addCustomNodeDefs(defs) {\n    // Store this so we can mutate it later with group nodes\n    globalDefs = defs\n  },\n  nodeCreated(node) {\n    if (GroupNodeHandler.isGroupNode(node)) {\n      // @ts-expect-error fixme ts strict error\n      node[GROUP] = new GroupNodeHandler(node)\n\n      // Ensure group nodes pasted from other workflows are stored\n      // @ts-expect-error fixme ts strict error\n      if (node.title && node[GROUP]?.groupData?.nodeData) {\n        // @ts-expect-error fixme ts strict error\n        Workflow.storeGroupNode(node.title, node[GROUP].groupData.nodeData)\n      }\n    }\n  },\n  // @ts-expect-error fixme ts strict error\n  async refreshComboInNodes(defs) {\n    // Re-register group nodes so new ones are created with the correct options\n    // @ts-expect-error fixme ts strict error\n    Object.assign(globalDefs, defs)\n    const nodes = app.graph.extra?.groupNodes\n    if (nodes) {\n      await GroupNodeConfig.registerFromWorkflow(nodes, {})\n    }\n  }\n}\n\napp.registerExtension(ext)\n","import type {\n  IContextMenuValue,\n  Positionable\n} from '@/lib/litegraph/src/interfaces'\nimport {\n  LGraphCanvas,\n  LGraphGroup,\n  type LGraphNode\n} from '@/lib/litegraph/src/litegraph'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport type { ComfyExtension } from '@/types/comfy'\n\nimport { app } from '../../scripts/app'\n\nfunction setNodeMode(node: LGraphNode, mode: number) {\n  node.mode = mode\n  node.graph?.change()\n}\n\nfunction addNodesToGroup(group: LGraphGroup, items: Iterable<Positionable>) {\n  const padding = useSettingStore().get('Comfy.GroupSelectedNodes.Padding')\n  group.resizeTo([...group.children, ...items], padding)\n}\n\nconst ext: ComfyExtension = {\n  name: 'Comfy.GroupOptions',\n\n  getCanvasMenuItems(canvas: LGraphCanvas): IContextMenuValue[] {\n    const items: IContextMenuValue[] = []\n\n    // @ts-expect-error fixme ts strict error\n    const group = canvas.graph.getGroupOnPos(\n      canvas.graph_mouse[0],\n      canvas.graph_mouse[1]\n    )\n\n    if (!group) {\n      if (canvas.selectedItems.size > 0) {\n        items.push({\n          content: 'Add Group For Selected Nodes',\n          callback: () => {\n            const group = new LGraphGroup()\n            addNodesToGroup(group, canvas.selectedItems)\n            // @ts-expect-error fixme ts strict error\n            canvas.graph.add(group)\n            // @ts-expect-error fixme ts strict error\n            canvas.graph.change()\n\n            group.recomputeInsideNodes()\n          }\n        })\n      }\n\n      return items\n    }\n\n    // Group nodes aren't recomputed until the group is moved, this ensures the nodes are up-to-date\n    group.recomputeInsideNodes()\n    const nodesInGroup = group.nodes\n\n    items.push({\n      content: 'Add Selected Nodes To Group',\n      disabled: !canvas.selectedItems?.size,\n      callback: () => {\n        addNodesToGroup(group, canvas.selectedItems)\n        // @ts-expect-error fixme ts strict error\n        canvas.graph.change()\n      }\n    })\n\n    // No nodes in group, return default options\n    if (nodesInGroup.length === 0) {\n      return items\n    } else {\n      // Add a separator between the default options and the group options\n      // @ts-expect-error fixme ts strict error\n      items.push(null)\n    }\n\n    // Check if all nodes are the same mode\n    let allNodesAreSameMode = true\n    for (let i = 1; i < nodesInGroup.length; i++) {\n      if (nodesInGroup[i].mode !== nodesInGroup[0].mode) {\n        allNodesAreSameMode = false\n        break\n      }\n    }\n\n    items.push({\n      content: 'Fit Group To Nodes',\n      callback: () => {\n        group.recomputeInsideNodes()\n        const padding = useSettingStore().get(\n          'Comfy.GroupSelectedNodes.Padding'\n        )\n        group.resizeTo(group.children, padding)\n        // @ts-expect-error fixme ts strict error\n        canvas.graph.change()\n      }\n    })\n\n    items.push({\n      content: 'Select Nodes',\n      callback: () => {\n        canvas.selectNodes(nodesInGroup)\n        // @ts-expect-error fixme ts strict error\n        canvas.graph.change()\n        canvas.canvas.focus()\n      }\n    })\n\n    // Modes\n    // 0: Always\n    // 1: On Event\n    // 2: Never\n    // 3: On Trigger\n    // 4: Bypass\n    // If all nodes are the same mode, add a menu option to change the mode\n    if (allNodesAreSameMode) {\n      const mode = nodesInGroup[0].mode\n      switch (mode) {\n        case 0:\n          // All nodes are always, option to disable, and bypass\n          items.push({\n            content: 'Set Group Nodes to Never',\n            callback: () => {\n              for (const node of nodesInGroup) {\n                setNodeMode(node, 2)\n              }\n            }\n          })\n          items.push({\n            content: 'Bypass Group Nodes',\n            callback: () => {\n              for (const node of nodesInGroup) {\n                setNodeMode(node, 4)\n              }\n            }\n          })\n          break\n        case 2:\n          // All nodes are never, option to enable, and bypass\n          items.push({\n            content: 'Set Group Nodes to Always',\n            callback: () => {\n              for (const node of nodesInGroup) {\n                setNodeMode(node, 0)\n              }\n            }\n          })\n          items.push({\n            content: 'Bypass Group Nodes',\n            callback: () => {\n              for (const node of nodesInGroup) {\n                setNodeMode(node, 4)\n              }\n            }\n          })\n          break\n        case 4:\n          // All nodes are bypass, option to enable, and disable\n          items.push({\n            content: 'Set Group Nodes to Always',\n            callback: () => {\n              for (const node of nodesInGroup) {\n                setNodeMode(node, 0)\n              }\n            }\n          })\n          items.push({\n            content: 'Set Group Nodes to Never',\n            callback: () => {\n              for (const node of nodesInGroup) {\n                setNodeMode(node, 2)\n              }\n            }\n          })\n          break\n        default:\n          // All nodes are On Trigger or On Event(Or other?), option to disable, set to always, or bypass\n          items.push({\n            content: 'Set Group Nodes to Always',\n            callback: () => {\n              for (const node of nodesInGroup) {\n                setNodeMode(node, 0)\n              }\n            }\n          })\n          items.push({\n            content: 'Set Group Nodes to Never',\n            callback: () => {\n              for (const node of nodesInGroup) {\n                setNodeMode(node, 2)\n              }\n            }\n          })\n          items.push({\n            content: 'Bypass Group Nodes',\n            callback: () => {\n              for (const node of nodesInGroup) {\n                setNodeMode(node, 4)\n              }\n            }\n          })\n          break\n      }\n    } else {\n      // Nodes are not all the same mode, add a menu option to change the mode to always, never, or bypass\n      items.push({\n        content: 'Set Group Nodes to Always',\n        callback: () => {\n          for (const node of nodesInGroup) {\n            setNodeMode(node, 0)\n          }\n        }\n      })\n      items.push({\n        content: 'Set Group Nodes to Never',\n        callback: () => {\n          for (const node of nodesInGroup) {\n            setNodeMode(node, 2)\n          }\n        }\n      })\n      items.push({\n        content: 'Bypass Group Nodes',\n        callback: () => {\n          for (const node of nodesInGroup) {\n            setNodeMode(node, 4)\n          }\n        }\n      })\n    }\n\n    return items\n  }\n}\n\napp.registerExtension(ext)\n","import { t } from '@/i18n'\nimport type { IContextMenuValue } from '@/lib/litegraph/src/interfaces'\nimport { useToastStore } from '@/platform/updates/common/toastStore'\nimport Load3d from '@/extensions/core/load3d/Load3d'\nimport { LiteGraph } from '@/lib/litegraph/src/litegraph'\n\nconst EXPORT_FORMATS = [\n  { label: 'GLB', value: 'glb' },\n  { label: 'OBJ', value: 'obj' },\n  { label: 'STL', value: 'stl' }\n] as const\n\n/**\n * Creates export menu items for a 3D node using the new extension API.\n * Returns an array of context menu items including a separator and export submenu.\n */\nexport function createExportMenuItems(\n  load3d: Load3d\n): (IContextMenuValue | null)[] {\n  return [\n    null, // Separator\n    {\n      content: 'Save',\n      has_submenu: true,\n      callback: (_value, _options, event, prev_menu) => {\n        const submenuOptions: IContextMenuValue[] = EXPORT_FORMATS.map(\n          (format) => ({\n            content: format.label,\n            callback: () => {\n              void (async () => {\n                try {\n                  await load3d.exportModel(format.value)\n                  useToastStore().add({\n                    severity: 'success',\n                    summary: t('toastMessages.exportSuccess', {\n                      format: format.label\n                    })\n                  })\n                } catch (error) {\n                  console.error('Export failed:', error)\n                  useToastStore().addAlert(\n                    t('toastMessages.failedToExportModel', {\n                      format: format.label\n                    })\n                  )\n                }\n              })()\n            }\n          })\n        )\n\n        new LiteGraph.ContextMenu(submenuOptions, {\n          event,\n          parentMenu: prev_menu\n        })\n      }\n    }\n  ]\n}\n","import Load3d from '@/extensions/core/load3d/Load3d'\nimport Load3dUtils from '@/extensions/core/load3d/Load3dUtils'\nimport type {\n  CameraConfig,\n  CameraState,\n  LightConfig,\n  ModelConfig,\n  SceneConfig\n} from '@/extensions/core/load3d/interfaces'\nimport type { Dictionary } from '@/lib/litegraph/src/interfaces'\nimport type { NodeProperty } from '@/lib/litegraph/src/LGraphNode'\nimport type { IBaseWidget } from '@/lib/litegraph/src/types/widgets'\nimport { useSettingStore } from '@/platform/settings/settingStore'\nimport { api } from '@/scripts/api'\n\ntype Load3DConfigurationSettings = {\n  loadFolder: string\n  modelWidget: IBaseWidget\n  cameraState?: CameraState\n  width?: IBaseWidget\n  height?: IBaseWidget\n  bgImagePath?: string\n}\n\nclass Load3DConfiguration {\n  constructor(\n    private load3d: Load3d,\n    private properties?: Dictionary<NodeProperty | undefined>\n  ) {}\n\n  configureForSaveMesh(loadFolder: 'input' | 'output', filePath: string) {\n    this.setupModelHandlingForSaveMesh(filePath, loadFolder)\n    this.setupDefaultProperties()\n  }\n\n  configure(setting: Load3DConfigurationSettings) {\n    this.setupModelHandling(\n      setting.modelWidget,\n      setting.loadFolder,\n      setting.cameraState\n    )\n    this.setupTargetSize(setting.width, setting.height)\n    this.setupDefaultProperties(setting.bgImagePath)\n  }\n\n  private setupTargetSize(width?: IBaseWidget, height?: IBaseWidget) {\n    if (width && height) {\n      this.load3d.setTargetSize(width.value as number, height.value as number)\n\n      width.callback = (value: number) => {\n        this.load3d.setTargetSize(value, height.value as number)\n      }\n\n      height.callback = (value: number) => {\n        this.load3d.setTargetSize(width.value as number, value)\n      }\n    }\n  }\n\n  private setupModelHandlingForSaveMesh(filePath: string, loadFolder: string) {\n    const onModelWidgetUpdate = this.createModelUpdateHandler(loadFolder)\n\n    if (filePath) {\n      onModelWidgetUpdate(filePath)\n    }\n  }\n\n  private setupModelHandling(\n    modelWidget: IBaseWidget,\n    loadFolder: string,\n    cameraState?: CameraState\n  ) {\n    const onModelWidgetUpdate = this.createModelUpdateHandler(\n      loadFolder,\n      cameraState\n    )\n    if (modelWidget.value) {\n      onModelWidgetUpdate(modelWidget.value)\n    }\n\n    const originalCallback = modelWidget.callback\n\n    let currentValue = modelWidget.value\n    Object.defineProperty(modelWidget, 'value', {\n      get() {\n        return currentValue\n      },\n      set(newValue) {\n        currentValue = newValue\n        if (modelWidget.callback && newValue !== undefined && newValue !== '') {\n          modelWidget.callback(newValue)\n        }\n      },\n      enumerable: true,\n      configurable: true\n    })\n\n    modelWidget.callback = (value: string | number | boolean | object) => {\n      onModelWidgetUpdate(value)\n\n      if (originalCallback) {\n        originalCallback(value)\n      }\n    }\n  }\n\n  private setupDefaultProperties(bgImagePath?: string) {\n    const sceneConfig = this.loadSceneConfig()\n    this.applySceneConfig(sceneConfig, bgImagePath)\n\n    const cameraConfig = this.loadCameraConfig()\n    this.applyCameraConfig(cameraConfig)\n\n    const lightConfig = this.loadLightConfig()\n    this.applyLightConfig(lightConfig)\n  }\n\n  private loadSceneConfig(): SceneConfig {\n    if (this.properties && 'Scene Config' in this.properties) {\n      return this.properties['Scene Config'] as SceneConfig\n    }\n\n    return {\n      showGrid: useSettingStore().get('Comfy.Load3D.ShowGrid'),\n      backgroundColor:\n        '#' + useSettingStore().get('Comfy.Load3D.BackgroundColor'),\n      backgroundImage: ''\n    } as SceneConfig\n  }\n\n  private loadCameraConfig(): CameraConfig {\n    if (this.properties && 'Camera Config' in this.properties) {\n      return this.properties['Camera Config'] as CameraConfig\n    }\n\n    return {\n      cameraType: useSettingStore().get('Comfy.Load3D.CameraType'),\n      fov: 35\n    } as CameraConfig\n  }\n\n  private loadLightConfig(): LightConfig {\n    if (this.properties && 'Light Config' in this.properties) {\n      return this.properties['Light Config'] as LightConfig\n    }\n\n    return {\n      intensity: useSettingStore().get('Comfy.Load3D.LightIntensity')\n    } as LightConfig\n  }\n\n  private loadModelConfig(): ModelConfig {\n    if (this.properties && 'Model Config' in this.properties) {\n      return this.properties['Model Config'] as ModelConfig\n    }\n\n    return {\n      upDirection: 'original',\n      materialMode: 'original'\n    } as ModelConfig\n  }\n\n  private applySceneConfig(config: SceneConfig, bgImagePath?: string) {\n    this.load3d.toggleGrid(config.showGrid)\n    this.load3d.setBackgroundColor(config.backgroundColor)\n    if (config.backgroundImage) {\n      if (bgImagePath && bgImagePath != config.backgroundImage) {\n        return\n      }\n\n      void this.load3d.setBackgroundImage(config.backgroundImage)\n\n      if (config.backgroundRenderMode) {\n        this.load3d.setBackgroundRenderMode(config.backgroundRenderMode)\n      }\n    }\n  }\n\n  private applyCameraConfig(config: CameraConfig) {\n    this.load3d.toggleCamera(config.cameraType)\n    this.load3d.setFOV(config.fov)\n\n    if (config.state) {\n      this.load3d.setCameraState(config.state)\n    }\n  }\n\n  private applyLightConfig(config: LightConfig) {\n    this.load3d.setLightIntensity(config.intensity)\n  }\n\n  private applyModelConfig(config: ModelConfig) {\n    this.load3d.setUpDirection(config.upDirection)\n    this.load3d.setMaterialMode(config.materialMode)\n  }\n\n  private createModelUpdateHandler(\n    loadFolder: string,\n    cameraState?: CameraState\n  ) {\n    let isFirstLoad = true\n    return async (value: string | number | boolean | object) => {\n      if (!value) return\n\n      const filename = value as string\n\n      this.setResourceFolder(filename)\n\n      const modelUrl = api.apiURL(\n        Load3dUtils.getResourceURL(\n          ...Load3dUtils.splitFilePath(filename),\n          loadFolder\n        )\n      )\n\n      await this.load3d.loadModel(modelUrl, filename)\n\n      const modelConfig = this.loadModelConfig()\n      this.applyModelConfig(modelConfig)\n\n      if (isFirstLoad && cameraState) {\n        try {\n          this.load3d.setCameraState(cameraState)\n        } catch (error) {\n          console.warn('Failed to restore camera state:', error)\n        }\n        isFirstLoad = false\n      }\n    }\n  }\n\n  private setResourceFolder(filename: string): void {\n    const pathParts = filename.split('/').filter((part) => part.trim())\n\n    if (pathParts.length <= 2) {\n      return\n    }\n\n    const subfolderParts = pathParts.slice(1, -1)\n    const subfolder = subfolderParts.join('/')\n\n    if (subfolder && this.properties) {\n      this.properties['Resource Folder'] = subfolder\n    }\n  }\n}\n\nexport default Load3DConfiguration\n","import { nextTick } from 'vue'\n\nimport Load3D from '@/components/load3d/Load3D.vue'\nimport Load3DViewerContent from '@/components/load3d/Load3dViewerContent.vue'\nimport { nodeToLoad3dMap, useLoad3d } from '@/composables/useLoad3d'\nimport { createExportMenuItems } from '@/extensions/core/load3d/exportMenuHelper'\nimport Load3DConfiguration from '@/extensions/core/load3d/Load3DConfiguration'\nimport Load3dUtils from '@/extensions/core/load3d/Load3dUtils'\nimport { t } from '@/i18n'\nimport type { LGraphNode } from '@/lib/litegraph/src/LGraphNode'\nimport type { IContextMenuValue } from '@/lib/litegraph/src/interfaces'\nimport type { IStringWidget } from '@/lib/litegraph/src/types/widgets'\nimport { useToastStore } from '@/platform/updates/common/toastStore'\nimport { type CustomInputSpec } from '@/schemas/nodeDef/nodeDefSchemaV2'\nimport { api } from '@/scripts/api'\nimport { ComfyApp, app } from '@/scripts/app'\nimport { ComponentWidgetImpl, addWidget } from '@/scripts/domWidget'\nimport { useExtensionService } from '@/services/extensionService'\nimport { useLoad3dService } from '@/services/load3dService'\nimport { useDialogStore } from '@/stores/dialogStore'\nimport { isLoad3dNode } from '@/utils/litegraphUtil'\n\nconst inputSpecLoad3D: CustomInputSpec = {\n  name: 'image',\n  type: 'Load3D',\n  isPreview: false\n}\n\nconst inputSpecPreview3D: CustomInputSpec = {\n  name: 'image',\n  type: 'Preview3D',\n  isPreview: true\n}\n\nasync function handleModelUpload(files: FileList, node: any) {\n  if (!files?.length) return\n\n  const modelWidget = node.widgets?.find(\n    (w: any) => w.name === 'model_file'\n  ) as IStringWidget\n\n  try {\n    const resourceFolder = (node.properties['Resource Folder'] as string) || ''\n\n    const subfolder = resourceFolder.trim()\n      ? `3d/${resourceFolder.trim()}`\n      : '3d'\n\n    const uploadPath = await Load3dUtils.uploadFile(files[0], subfolder)\n\n    if (!uploadPath) {\n      useToastStore().addAlert(t('toastMessages.fileUploadFailed'))\n      return\n    }\n\n    const modelUrl = api.apiURL(\n      Load3dUtils.getResourceURL(\n        ...Load3dUtils.splitFilePath(uploadPath),\n        'input'\n      )\n    )\n\n    useLoad3d(node).waitForLoad3d((load3d) => {\n      try {\n        load3d.loadModel(modelUrl)\n      } catch (error) {\n        useToastStore().addAlert(t('toastMessages.failedToLoadModel'))\n      }\n    })\n\n    if (uploadPath && modelWidget) {\n      if (!modelWidget.options?.values?.includes(uploadPath)) {\n        modelWidget.options?.values?.push(uploadPath)\n      }\n\n      modelWidget.value = uploadPath\n    }\n  } catch (error) {\n    console.error('Model upload failed:', error)\n    useToastStore().addAlert(t('toastMessages.fileUploadFailed'))\n  }\n}\n\nasync function handleResourcesUpload(files: FileList, node: any) {\n  if (!files?.length) return\n\n  try {\n    const resourceFolder = (node.properties['Resource Folder'] as string) || ''\n\n    const subfolder = resourceFolder.trim()\n      ? `3d/${resourceFolder.trim()}`\n      : '3d'\n\n    await Load3dUtils.uploadMultipleFiles(files, subfolder)\n  } catch (error) {\n    console.error('Extra resources upload failed:', error)\n    useToastStore().addAlert(t('toastMessages.extraResourcesUploadFailed'))\n  }\n}\n\nfunction createFileInput(\n  accept: string,\n  multiple: boolean = false\n): HTMLInputElement {\n  const input = document.createElement('input')\n  input.type = 'file'\n  input.accept = accept\n  input.multiple = multiple\n  input.style.display = 'none'\n  return input\n}\n\nuseExtensionService().registerExtension({\n  name: 'Comfy.Load3D',\n  settings: [\n    {\n      id: 'Comfy.Load3D.ShowGrid',\n      category: ['3D', 'Scene', 'Initial Grid Visibility'],\n      name: 'Initial Grid Visibility',\n      tooltip:\n        'Controls whether the grid is visible by default when a new 3D widget is created. This default can still be toggled individually for each widget after creation.',\n      type: 'boolean',\n      defaultValue: true,\n      experimental: true\n    },\n    {\n      id: 'Comfy.Load3D.BackgroundColor',\n      category: ['3D', 'Scene', 'Initial Background Color'],\n      name: 'Initial Background Color',\n      tooltip:\n        'Controls the default background color of the 3D scene. This setting determines the background appearance when a new 3D widget is created, but can be adjusted individually for each widget after creation.',\n      type: 'color',\n      defaultValue: '282828',\n      experimental: true\n    },\n    {\n      id: 'Comfy.Load3D.CameraType',\n      category: ['3D', 'Camera', 'Initial Camera Type'],\n      name: 'Initial Camera Type',\n      tooltip:\n        'Controls whether the camera is perspective or orthographic by default when a new 3D widget is created. This default can still be toggled individually for each widget after creation.',\n      type: 'combo',\n      options: ['perspective', 'orthographic'],\n      defaultValue: 'perspective',\n      experimental: true\n    },\n    {\n      id: 'Comfy.Load3D.LightIntensity',\n      category: ['3D', 'Light', 'Initial Light Intensity'],\n      name: 'Initial Light Intensity',\n      tooltip:\n        'Sets the default brightness level of lighting in the 3D scene. This value determines how intensely lights illuminate objects when a new 3D widget is created, but can be adjusted individually for each widget after creation.',\n      type: 'number',\n      defaultValue: 3,\n      experimental: true\n    },\n    {\n      id: 'Comfy.Load3D.LightIntensityMaximum',\n      category: ['3D', 'Light', 'Light Intensity Maximum'],\n      name: 'Light Intensity Maximum',\n      tooltip:\n        'Sets the maximum allowable light intensity value for 3D scenes. This defines the upper brightness limit that can be set when adjusting lighting in any 3D widget.',\n      type: 'number',\n      defaultValue: 10,\n      experimental: true\n    },\n    {\n      id: 'Comfy.Load3D.LightIntensityMinimum',\n      category: ['3D', 'Light', 'Light Intensity Minimum'],\n      name: 'Light Intensity Minimum',\n      tooltip:\n        'Sets the minimum allowable light intensity value for 3D scenes. This defines the lower brightness limit that can be set when adjusting lighting in any 3D widget.',\n      type: 'number',\n      defaultValue: 1,\n      experimental: true\n    },\n    {\n      id: 'Comfy.Load3D.LightAdjustmentIncrement',\n      category: ['3D', 'Light', 'Light Adjustment Increment'],\n      name: 'Light Adjustment Increment',\n      tooltip:\n        'Controls the increment size when adjusting light intensity in 3D scenes. A smaller step value allows for finer control over lighting adjustments, while a larger value results in more noticeable changes per adjustment.',\n      type: 'slider',\n      attrs: {\n        min: 0.1,\n        max: 1,\n        step: 0.1\n      },\n      defaultValue: 0.5,\n      experimental: true\n    },\n    {\n      id: 'Comfy.Load3D.3DViewerEnable',\n      category: ['3D', '3DViewer', 'Enable'],\n      name: 'Enable 3D Viewer (Beta)',\n      tooltip:\n        'Enables the 3D Viewer (Beta) for selected nodes. This feature allows you to visualize and interact with 3D models directly within the full size 3d viewer.',\n      type: 'boolean',\n      defaultValue: false,\n      experimental: true\n    }\n  ],\n  commands: [\n    {\n      id: 'Comfy.3DViewer.Open3DViewer',\n      icon: 'pi pi-pencil',\n      label: 'Open 3D Viewer (Beta) for Selected Node',\n      function: () => {\n        const selectedNodes = app.canvas.selected_nodes\n        if (!selectedNodes || Object.keys(selectedNodes).length !== 1) return\n\n        const selectedNode = selectedNodes[Object.keys(selectedNodes)[0]]\n\n        if (!isLoad3dNode(selectedNode)) return\n\n        ComfyApp.copyToClipspace(selectedNode)\n        // @ts-expect-error clipspace_return_node is an extension property added at runtime\n        ComfyApp.clipspace_return_node = selectedNode\n\n        const props = { node: selectedNode }\n\n        useDialogStore().showDialog({\n          key: 'global-load3d-viewer',\n          title: t('load3d.viewer.title'),\n          component: Load3DViewerContent,\n          props: props,\n          dialogComponentProps: {\n            style: 'width: 80vw; height: 80vh;',\n            maximizable: true,\n            onClose: async () => {\n              await useLoad3dService().handleViewerClose(props.node)\n            }\n          }\n        })\n      }\n    }\n  ],\n  getCustomWidgets() {\n    return {\n      LOAD_3D(node) {\n        const fileInput = createFileInput('.gltf,.glb,.obj,.fbx,.stl', false)\n\n        node.properties['Resource Folder'] = ''\n\n        fileInput.onchange = async () => {\n          await handleModelUpload(fileInput.files!, node)\n        }\n\n        node.addWidget('button', 'upload 3d model', 'upload3dmodel', () => {\n          fileInput.click()\n        })\n\n        const resourcesInput = createFileInput('*', true)\n\n        resourcesInput.onchange = async () => {\n          await handleResourcesUpload(resourcesInput.files!, node)\n          resourcesInput.value = ''\n        }\n\n        node.addWidget(\n          'button',\n          'upload extra resources',\n          'uploadExtraResources',\n          () => {\n            resourcesInput.click()\n          }\n        )\n\n        node.addWidget('button', 'clear', 'clear', () => {\n          useLoad3d(node).waitForLoad3d((load3d) => {\n            load3d.clearModel()\n          })\n\n          const modelWidget = node.widgets?.find((w) => w.name === 'model_file')\n          if (modelWidget) {\n            modelWidget.value = ''\n          }\n        })\n\n        const widget = new ComponentWidgetImpl({\n          node: node,\n          name: 'image',\n          component: Load3D,\n          inputSpec: inputSpecLoad3D,\n          options: {}\n        })\n\n        widget.type = 'load3D'\n\n        addWidget(node, widget)\n\n        return { widget }\n      }\n    }\n  },\n\n  getNodeMenuItems(node: LGraphNode): (IContextMenuValue | null)[] {\n    // Only show menu items for Load3D nodes\n    if (node.constructor.comfyClass !== 'Load3D') return []\n\n    const load3d = useLoad3dService().getLoad3d(node)\n    if (!load3d) return []\n\n    return createExportMenuItems(load3d)\n  },\n\n  async nodeCreated(node) {\n    if (node.constructor.comfyClass !== 'Load3D') return\n\n    const [oldWidth, oldHeight] = node.size\n\n    node.setSize([Math.max(oldWidth, 300), Math.max(oldHeight, 600)])\n\n    await nextTick()\n\n    useLoad3d(node).waitForLoad3d((load3d) => {\n      const cameraConfig = node.properties['Camera Config'] as any\n      const cameraState = cameraConfig?.state\n\n      const config = new Load3DConfiguration(load3d, node.properties)\n\n      const modelWidget = node.widgets?.find((w) => w.name === 'model_file')\n      const width = node.widgets?.find((w) => w.name === 'width')\n      const height = node.widgets?.find((w) => w.name === 'height')\n      const sceneWidget = node.widgets?.find((w) => w.name === 'image')\n\n      if (modelWidget && width && height && sceneWidget) {\n        const settings = {\n          loadFolder: 'input',\n          modelWidget: modelWidget,\n          cameraState: cameraState,\n          width: width,\n          height: height\n        }\n        config.configure(settings)\n\n        sceneWidget.serializeValue = async () => {\n          const currentLoad3d = nodeToLoad3dMap.get(node)\n          if (!currentLoad3d) {\n            console.error('No load3d instance found for node')\n            return null\n          }\n\n          const cameraConfig = (node.properties['Camera Config'] as any) || {\n            cameraType: currentLoad3d.getCurrentCameraType(),\n            fov: currentLoad3d.cameraManager.perspectiveCamera.fov\n          }\n          cameraConfig.state = currentLoad3d.getCameraState()\n          node.properties['Camera Config'] = cameraConfig\n\n          currentLoad3d.stopRecording()\n\n          const {\n            scene: imageData,\n            mask: maskData,\n            normal: normalData\n          } = await currentLoad3d.captureScene(\n            width.value as number,\n            height.value as number\n          )\n\n          const [data, dataMask, dataNormal] = await Promise.all([\n            Load3dUtils.uploadTempImage(imageData, 'scene'),\n            Load3dUtils.uploadTempImage(maskData, 'scene_mask'),\n            Load3dUtils.uploadTempImage(normalData, 'scene_normal')\n          ])\n\n          currentLoad3d.handleResize()\n\n          const returnVal = {\n            image: `threed/${data.name} [temp]`,\n            mask: `threed/${dataMask.name} [temp]`,\n            normal: `threed/${dataNormal.name} [temp]`,\n            camera_info:\n              (node.properties['Camera Config'] as any)?.state || null,\n            recording: ''\n          }\n\n          const recordingData = currentLoad3d.getRecordingData()\n\n          if (recordingData) {\n            const [recording] = await Promise.all([\n              Load3dUtils.uploadTempImage(recordingData, 'recording', 'mp4')\n            ])\n            returnVal['recording'] = `threed/${recording.name} [temp]`\n          }\n\n          return returnVal\n        }\n      }\n    })\n  }\n})\n\nuseExtensionService().registerExtension({\n  name: 'Comfy.Preview3D',\n\n  async beforeRegisterNodeDef(_nodeType, nodeData) {\n    if ('Preview3D' === nodeData.name) {\n      // @ts-expect-error InputSpec is not typed correctly\n      nodeData.input.required.image = ['PREVIEW_3D']\n    }\n  },\n\n  getNodeMenuItems(node: LGraphNode): (IContextMenuValue | null)[] {\n    // Only show menu items for Preview3D nodes\n    if (node.constructor.comfyClass !== 'Preview3D') return []\n\n    const load3d = useLoad3dService().getLoad3d(node)\n    if (!load3d) return []\n\n    return createExportMenuItems(load3d)\n  },\n\n  getCustomWidgets() {\n    return {\n      PREVIEW_3D(node) {\n        const widget = new ComponentWidgetImpl({\n          node,\n          name: inputSpecPreview3D.name,\n          component: Load3D,\n          inputSpec: inputSpecPreview3D,\n          options: {}\n        })\n\n        widget.type = 'load3D'\n\n        addWidget(node, widget)\n\n        return { widget }\n      }\n    }\n  },\n\n  async nodeCreated(node) {\n    if (node.constructor.comfyClass !== 'Preview3D') return\n\n    const [oldWidth, oldHeight] = node.size\n\n    node.setSize([Math.max(oldWidth, 400), Math.max(oldHeight, 550)])\n\n    await nextTick()\n\n    const onExecuted = node.onExecuted\n\n    useLoad3d(node).waitForLoad3d((load3d) => {\n      const config = new Load3DConfiguration(load3d, node.properties)\n\n      const modelWidget = node.widgets?.find((w) => w.name === 'model_file')\n\n      if (modelWidget) {\n        const lastTimeModelFile = node.properties['Last Time Model File']\n\n        if (lastTimeModelFile) {\n          modelWidget.value = lastTimeModelFile\n\n          const cameraConfig = node.properties['Camera Config'] as any\n          const cameraState = cameraConfig?.state\n\n          const settings = {\n            loadFolder: 'output',\n            modelWidget: modelWidget,\n            cameraState: cameraState\n          }\n\n          config.configure(settings)\n        }\n\n        node.onExecuted = function (message: any) {\n          onExecuted?.apply(this, arguments as any)\n\n          let filePath = message.result[0]\n\n          if (!filePath) {\n            const msg = t('toastMessages.unableToGetModelFilePath')\n            console.error(msg)\n            useToastStore().addAlert(msg)\n          }\n\n          let cameraState = message.result[1]\n          let bgImagePath = message.result[2]\n\n          modelWidget.value = filePath.replaceAll('\\\\', '/')\n\n          node.properties['Last Time Model File'] = modelWidget.value\n\n          const settings = {\n            loadFolder: 'output',\n            modelWidget: modelWidget,\n            cameraState: cameraState,\n            bgImagePath: bgImagePath\n          }\n\n          config.configure(settings)\n\n          if (bgImagePath) {\n            load3d.setBackgroundImage(bgImagePath)\n          }\n        }\n      }\n    })\n  }\n})\n","export enum BrushShape {\n  Arc = 'arc',\n  Rect = 'rect'\n}\n\nexport enum Tools {\n  MaskPen = 'pen',\n  PaintPen = 'rgbPaint',\n  Eraser = 'eraser',\n  MaskBucket = 'paintBucket',\n  MaskColorFill = 'colorSelect'\n}\n\nexport const allTools = [\n  Tools.MaskPen,\n  Tools.PaintPen,\n  Tools.Eraser,\n  Tools.MaskBucket,\n  Tools.MaskColorFill\n]\n\nconst allImageLayers = ['mask', 'rgb'] as const\n\nexport type ImageLayer = (typeof allImageLayers)[number]\n\nexport interface ToolInternalSettings {\n  container: HTMLElement\n  cursor?: string\n  newActiveLayerOnSet?: ImageLayer\n}\n\nexport enum CompositionOperation {\n  SourceOver = 'source-over',\n  DestinationOut = 'destination-out'\n}\n\nexport enum MaskBlendMode {\n  Black = 'black',\n  White = 'white',\n  Negative = 'negative'\n}\n\nexport enum ColorComparisonMethod {\n  Simple = 'simple',\n  HSL = 'hsl',\n  LAB = 'lab'\n}\n\nexport interface Point {\n  x: number\n  y: number\n}\n\nexport interface Offset {\n  x: number\n  y: number\n}\n\nexport interface Brush {\n  type: BrushShape\n  size: number\n  opacity: number\n  hardness: number\n  smoothingPrecision: number\n}\n","import { ref, computed } from 'vue'\nimport { useMaskEditorStore } from '@/stores/maskEditorStore'\n\nexport function useCanvasHistory(maxStates = 20) {\n  const store = useMaskEditorStore()\n\n  const states = ref<{ mask: ImageData; rgb: ImageData }[]>([])\n  const currentStateIndex = ref(-1)\n  const initialized = ref(false)\n\n  const canUndo = computed(\n    () => states.value.length > 1 && currentStateIndex.value > 0\n  )\n\n  const canRedo = computed(() => {\n    return (\n      states.value.length > 1 &&\n      currentStateIndex.value < states.value.length - 1\n    )\n  })\n\n  const saveInitialState = () => {\n    const maskCtx = store.maskCtx\n    const rgbCtx = store.rgbCtx\n    const maskCanvas = store.maskCanvas\n    const rgbCanvas = store.rgbCanvas\n\n    if (!maskCtx || !rgbCtx || !maskCanvas || !rgbCanvas) {\n      requestAnimationFrame(saveInitialState)\n      return\n    }\n\n    if (!maskCanvas.width || !rgbCanvas.width) {\n      requestAnimationFrame(saveInitialState)\n      return\n    }\n\n    states.value = []\n    const maskState = maskCtx.getImageData(\n      0,\n      0,\n      maskCanvas.width,\n      maskCanvas.height\n    )\n    const rgbState = rgbCtx.getImageData(\n      0,\n      0,\n      rgbCanvas.width,\n      rgbCanvas.height\n    )\n    states.value.push({ mask: maskState, rgb: rgbState })\n    currentStateIndex.value = 0\n    initialized.value = true\n  }\n\n  const saveState = () => {\n    const maskCtx = store.maskCtx\n    const rgbCtx = store.rgbCtx\n    const maskCanvas = store.maskCanvas\n    const rgbCanvas = store.rgbCanvas\n\n    if (!maskCtx || !rgbCtx || !maskCanvas || !rgbCanvas) return\n\n    if (!initialized.value || currentStateIndex.value === -1) {\n      saveInitialState()\n      return\n    }\n\n    states.value = states.value.slice(0, currentStateIndex.value + 1)\n\n    const maskState = maskCtx.getImageData(\n      0,\n      0,\n      maskCanvas.width,\n      maskCanvas.height\n    )\n    const rgbState = rgbCtx.getImageData(\n      0,\n      0,\n      rgbCanvas.width,\n      rgbCanvas.height\n    )\n    states.value.push({ mask: maskState, rgb: rgbState })\n    currentStateIndex.value++\n\n    if (states.value.length > maxStates) {\n      states.value.shift()\n      currentStateIndex.value--\n    }\n  }\n\n  const undo = () => {\n    if (!canUndo.value) {\n      alert('No more undo states available')\n      return\n    }\n\n    currentStateIndex.value--\n    restoreState(states.value[currentStateIndex.value])\n  }\n\n  const redo = () => {\n    if (!canRedo.value) {\n      alert('No more redo states available')\n      return\n    }\n\n    currentStateIndex.value++\n    restoreState(states.value[currentStateIndex.value])\n  }\n\n  const restoreState = (state: { mask: ImageData; rgb: ImageData }) => {\n    const maskCtx = store.maskCtx\n    const rgbCtx = store.rgbCtx\n    if (!maskCtx || !rgbCtx) return\n\n    maskCtx.putImageData(state.mask, 0, 0)\n    rgbCtx.putImageData(state.rgb, 0, 0)\n  }\n\n  const clearStates = () => {\n    states.value = []\n    currentStateIndex.value = -1\n    initialized.value = false\n  }\n\n  return {\n    canUndo,\n    canRedo,\n    saveInitialState,\n    saveState,\n    undo,\n    redo,\n    clearStates\n  }\n}\n","import { defineStore } from 'pinia'\nimport { computed, ref, watch } from 'vue'\nimport _ from 'es-toolkit/compat'\n\nimport {\n  BrushShape,\n  ColorComparisonMethod,\n  MaskBlendMode,\n  Tools\n} from '@/extensions/core/maskeditor/types'\nimport type {\n  Brush,\n  ImageLayer,\n  Offset,\n  Point\n} from '@/extensions/core/maskeditor/types'\nimport { useCanvasHistory } from '@/composables/maskeditor/useCanvasHistory'\n\nexport const useMaskEditorStore = defineStore('maskEditor', () => {\n  const brushSettings = ref<Brush>({\n    type: BrushShape.Arc,\n    size: 10,\n    opacity: 0.7,\n    hardness: 1,\n    smoothingPrecision: 10\n  })\n\n  const maskBlendMode = ref<MaskBlendMode>(MaskBlendMode.Black)\n  const activeLayer = ref<ImageLayer>('mask')\n  const rgbColor = ref<string>('#FF0000')\n\n  const currentTool = ref<Tools>(Tools.MaskPen)\n  const isAdjustingBrush = ref<boolean>(false)\n\n  const paintBucketTolerance = ref<number>(5)\n  const fillOpacity = ref<number>(100)\n\n  const colorSelectTolerance = ref<number>(20)\n  const colorSelectLivePreview = ref<boolean>(false)\n  const colorComparisonMethod = ref<ColorComparisonMethod>(\n    ColorComparisonMethod.Simple\n  )\n  const applyWholeImage = ref<boolean>(false)\n  const maskBoundary = ref<boolean>(false)\n  const maskTolerance = ref<number>(0)\n  const selectionOpacity = ref<number>(100)\n\n  const zoomRatio = ref<number>(1)\n  const displayZoomRatio = ref<number>(1)\n  const panOffset = ref<Offset>({ x: 0, y: 0 })\n  const cursorPoint = ref<Point>({ x: 0, y: 0 })\n  const resetZoomTrigger = ref<number>(0)\n\n  const maskCanvas = ref<HTMLCanvasElement | null>(null)\n  const maskCtx = ref<CanvasRenderingContext2D | null>(null)\n  const rgbCanvas = ref<HTMLCanvasElement | null>(null)\n  const rgbCtx = ref<CanvasRenderingContext2D | null>(null)\n  const imgCanvas = ref<HTMLCanvasElement | null>(null)\n  const imgCtx = ref<CanvasRenderingContext2D | null>(null)\n  const canvasContainer = ref<HTMLElement | null>(null)\n  const canvasBackground = ref<HTMLElement | null>(null)\n  const pointerZone = ref<HTMLElement | null>(null)\n  const image = ref<HTMLImageElement | null>(null)\n\n  const maskOpacity = ref<number>(0.8)\n\n  const brushVisible = ref<boolean>(true)\n  const isPanning = ref<boolean>(false)\n  const brushPreviewGradientVisible = ref<boolean>(false)\n\n  const canvasHistory = useCanvasHistory(20)\n\n  watch(maskCanvas, (canvas) => {\n    if (canvas) {\n      maskCtx.value = canvas.getContext('2d', { willReadFrequently: true })\n    }\n  })\n\n  watch(rgbCanvas, (canvas) => {\n    if (canvas) {\n      rgbCtx.value = canvas.getContext('2d', { willReadFrequently: true })\n    }\n  })\n\n  watch(imgCanvas, (canvas) => {\n    if (canvas) {\n      imgCtx.value = canvas.getContext('2d', { willReadFrequently: true })\n    }\n  })\n\n  const canUndo = computed(() => {\n    return canvasHistory.canUndo.value\n  })\n\n  const canRedo = computed(() => {\n    return canvasHistory.canRedo.value\n  })\n\n  const maskColor = computed(() => {\n    switch (maskBlendMode.value) {\n      case MaskBlendMode.Black:\n        return { r: 0, g: 0, b: 0 }\n      case MaskBlendMode.White:\n        return { r: 255, g: 255, b: 255 }\n      case MaskBlendMode.Negative:\n        return { r: 255, g: 255, b: 255 }\n      default:\n        return { r: 0, g: 0, b: 0 }\n    }\n  })\n\n  function setBrushSize(size: number): void {\n    brushSettings.value.size = _.clamp(size, 1, 100)\n  }\n\n  function setBrushOpacity(opacity: number): void {\n    brushSettings.value.opacity = _.clamp(opacity, 0, 1)\n  }\n\n  function setBrushHardness(hardness: number): void {\n    brushSettings.value.hardness = _.clamp(hardness, 0, 1)\n  }\n\n  function setBrushSmoothingPrecision(precision: number): void {\n    brushSettings.value.smoothingPrecision = _.clamp(precision, 1, 100)\n  }\n\n  function resetBrushToDefault(): void {\n    brushSettings.value.type = BrushShape.Arc\n    brushSettings.value.size = 20\n    brushSettings.value.opacity = 1\n    brushSettings.value.hardness = 1\n    brushSettings.value.smoothingPrecision = 60\n  }\n\n  function setPaintBucketTolerance(tolerance: number): void {\n    paintBucketTolerance.value = _.clamp(tolerance, 0, 255)\n  }\n\n  function setFillOpacity(opacity: number): void {\n    fillOpacity.value = _.clamp(opacity, 0, 100)\n  }\n\n  function setColorSelectTolerance(tolerance: number): void {\n    colorSelectTolerance.value = _.clamp(tolerance, 0, 255)\n  }\n\n  function setMaskTolerance(tolerance: number): void {\n    maskTolerance.value = _.clamp(tolerance, 0, 255)\n  }\n\n  function setSelectionOpacity(opacity: number): void {\n    selectionOpacity.value = _.clamp(opacity, 0, 100)\n  }\n\n  function setZoomRatio(ratio: number): void {\n    zoomRatio.value = Math.max(0.1, Math.min(10, ratio))\n  }\n\n  function setPanOffset(offset: Offset): void {\n    panOffset.value = { ...offset }\n  }\n\n  function setCursorPoint(point: Point): void {\n    cursorPoint.value = { ...point }\n  }\n\n  function resetZoom(): void {\n    resetZoomTrigger.value++\n  }\n\n  function setMaskOpacity(opacity: number): void {\n    maskOpacity.value = _.clamp(opacity, 0, 1)\n  }\n\n  function resetState(): void {\n    brushSettings.value = {\n      type: BrushShape.Arc,\n      size: 10,\n      opacity: 0.7,\n      hardness: 1,\n      smoothingPrecision: 10\n    }\n    maskBlendMode.value = MaskBlendMode.Black\n    activeLayer.value = 'mask'\n    rgbColor.value = '#FF0000'\n    currentTool.value = Tools.MaskPen\n    isAdjustingBrush.value = false\n    paintBucketTolerance.value = 5\n    fillOpacity.value = 100\n    colorSelectTolerance.value = 20\n    colorSelectLivePreview.value = false\n    colorComparisonMethod.value = ColorComparisonMethod.Simple\n    applyWholeImage.value = false\n    maskBoundary.value = false\n    maskTolerance.value = 0\n    selectionOpacity.value = 100\n    zoomRatio.value = 1\n    panOffset.value = { x: 0, y: 0 }\n    cursorPoint.value = { x: 0, y: 0 }\n    maskOpacity.value = 0.8\n  }\n\n  return {\n    brushSettings,\n    maskBlendMode,\n    activeLayer,\n    rgbColor,\n    currentTool,\n    isAdjustingBrush,\n    paintBucketTolerance,\n    fillOpacity,\n    colorSelectTolerance,\n    colorSelectLivePreview,\n    colorComparisonMethod,\n    applyWholeImage,\n    maskBoundary,\n    maskTolerance,\n    selectionOpacity,\n    zoomRatio,\n    displayZoomRatio,\n    panOffset,\n    cursorPoint,\n    resetZoomTrigger,\n    maskCanvas,\n    maskCtx,\n    rgbCanvas,\n    rgbCtx,\n    imgCanvas,\n    imgCtx,\n    canvasContainer,\n    canvasBackground,\n    pointerZone,\n    image,\n    maskOpacity,\n    canUndo,\n    canRedo,\n    maskColor,\n\n    brushVisible,\n    isPanning,\n    brushPreviewGradientVisible,\n\n    canvasHistory,\n\n    setBrushSize,\n    setBrushOpacity,\n    setBrushHardness,\n    setBrushSmoothingPrecision,\n    resetBrushToDefault,\n    setPaintBucketTolerance,\n    setFillOpacity,\n    setColorSelectTolerance,\n    setMaskTolerance,\n    setSelectionOpacity,\n    setZoomRatio,\n    setPanOffset,\n    setCursorPoint,\n    resetZoom,\n    setMaskOpacity,\n    resetState\n  }\n})\n","import { defineStore } from 'pinia'\nimport { ref, computed } from 'vue'\nimport type { LGraphNode, NodeId } from '@/lib/litegraph/src/litegraph'\n\nexport interface ImageRef {\n  filename: string\n  subfolder?: string\n  type?: string\n}\n\nexport interface ImageLayer {\n  image: HTMLImageElement\n  url: string\n}\n\ninterface EditorInputData {\n  baseLayer: ImageLayer\n  maskLayer: ImageLayer\n  paintLayer?: ImageLayer\n  sourceRef: ImageRef\n  nodeId: NodeId\n}\n\nexport interface EditorOutputLayer {\n  canvas: HTMLCanvasElement\n  blob: Blob\n  ref: ImageRef\n}\n\nexport interface EditorOutputData {\n  maskedImage: EditorOutputLayer\n  paintLayer: EditorOutputLayer\n  paintedImage: EditorOutputLayer\n  paintedMaskedImage: EditorOutputLayer\n}\n\nexport const useMaskEditorDataStore = defineStore('maskEditorData', () => {\n  const inputData = ref<EditorInputData | null>(null)\n  const outputData = ref<EditorOutputData | null>(null)\n  const sourceNode = ref<LGraphNode | null>(null)\n\n  const isLoading = ref(false)\n  const loadError = ref<string | null>(null)\n\n  const hasValidInput = computed(() => inputData.value !== null)\n\n  const hasValidOutput = computed(() => outputData.value !== null)\n\n  const isReady = computed(() => hasValidInput.value && !isLoading.value)\n\n  const reset = () => {\n    inputData.value = null\n    outputData.value = null\n    sourceNode.value = null\n    isLoading.value = false\n    loadError.value = null\n  }\n\n  const setLoading = (loading: boolean, error?: string) => {\n    isLoading.value = loading\n    if (error) {\n      loadError.value = error\n    }\n  }\n\n  return {\n    inputData,\n    outputData,\n    sourceNode,\n    isLoading,\n    loadError,\n\n    hasValidInput,\n    hasValidOutput,\n    isReady,\n\n    reset,\n    setLoading\n  }\n})\n","import { useMaskEditorStore } from '@/stores/maskEditorStore'\n\nimport { MaskBlendMode } from '@/extensions/core/maskeditor/types'\n\nexport function useCanvasManager() {\n  const store = useMaskEditorStore()\n\n  const prepareMask = async (\n    image: HTMLImageElement,\n    maskCanvasEl: HTMLCanvasElement,\n    maskContext: CanvasRenderingContext2D\n  ): Promise<void> => {\n    const maskColor = store.maskColor\n\n    maskContext.drawImage(image, 0, 0, maskCanvasEl.width, maskCanvasEl.height)\n\n    const maskData = maskContext.getImageData(\n      0,\n      0,\n      maskCanvasEl.width,\n      maskCanvasEl.height\n    )\n\n    for (let i = 0; i < maskData.data.length; i += 4) {\n      const alpha = maskData.data[i + 3]\n      maskData.data[i] = maskColor.r\n      maskData.data[i + 1] = maskColor.g\n      maskData.data[i + 2] = maskColor.b\n      maskData.data[i + 3] = 255 - alpha\n    }\n\n    maskContext.globalCompositeOperation = 'source-over'\n    maskContext.putImageData(maskData, 0, 0)\n  }\n\n  const invalidateCanvas = async (\n    origImage: HTMLImageElement,\n    maskImage: HTMLImageElement,\n    paintImage: HTMLImageElement | null\n  ): Promise<void> => {\n    const { imgCanvas, maskCanvas, rgbCanvas, imgCtx, maskCtx, rgbCtx } = store\n\n    if (\n      !imgCanvas ||\n      !maskCanvas ||\n      !rgbCanvas ||\n      !imgCtx ||\n      !maskCtx ||\n      !rgbCtx\n    ) {\n      throw new Error('Canvas elements or contexts not available')\n    }\n\n    imgCanvas.width = origImage.width\n    imgCanvas.height = origImage.height\n    maskCanvas.width = origImage.width\n    maskCanvas.height = origImage.height\n    rgbCanvas.width = origImage.width\n    rgbCanvas.height = origImage.height\n\n    imgCtx.drawImage(origImage, 0, 0, origImage.width, origImage.height)\n\n    if (paintImage) {\n      rgbCtx.drawImage(paintImage, 0, 0, paintImage.width, paintImage.height)\n    }\n\n    await prepareMask(maskImage, maskCanvas, maskCtx)\n  }\n\n  const setCanvasBackground = (): void => {\n    const canvasBackground = store.canvasBackground\n\n    if (!canvasBackground) return\n\n    if (store.maskBlendMode === MaskBlendMode.Black) {\n      canvasBackground.style.backgroundColor = 'rgba(0,0,0,1)'\n    } else if (store.maskBlendMode === MaskBlendMode.White) {\n      canvasBackground.style.backgroundColor = 'rgba(255,255,255,1)'\n    } else if (store.maskBlendMode === MaskBlendMode.Negative) {\n      canvasBackground.style.backgroundColor = 'rgba(255,255,255,1)'\n    }\n  }\n\n  const updateMaskColor = async (): Promise<void> => {\n    const { maskCanvas, maskCtx, maskColor, maskBlendMode, maskOpacity } = store\n\n    if (!maskCanvas || !maskCtx) return\n\n    if (maskBlendMode === MaskBlendMode.Negative) {\n      maskCanvas.style.mixBlendMode = 'difference'\n      maskCanvas.style.opacity = '1'\n    } else {\n      maskCanvas.style.mixBlendMode = 'initial'\n      maskCanvas.style.opacity = String(maskOpacity)\n    }\n\n    maskCtx.fillStyle = `rgb(${maskColor.r}, ${maskColor.g}, ${maskColor.b})`\n\n    setCanvasBackground()\n\n    const maskData = maskCtx.getImageData(\n      0,\n      0,\n      maskCanvas.width,\n      maskCanvas.height\n    )\n\n    for (let i = 0; i < maskData.data.length; i += 4) {\n      maskData.data[i] = maskColor.r\n      maskData.data[i + 1] = maskColor.g\n      maskData.data[i + 2] = maskColor.b\n    }\n\n    maskCtx.putImageData(maskData, 0, 0)\n  }\n\n  return {\n    invalidateCanvas,\n    updateMaskColor\n  }\n}\n","import { useMaskEditorStore } from '@/stores/maskEditorStore'\nimport { useMaskEditorDataStore } from '@/stores/maskEditorDataStore'\nimport { createSharedComposable } from '@vueuse/core'\nimport { useCanvasManager } from '@/composables/maskeditor/useCanvasManager'\n\nfunction useImageLoaderInternal() {\n  const store = useMaskEditorStore()\n  const dataStore = useMaskEditorDataStore()\n  const canvasManager = useCanvasManager()\n\n  const loadImages = async (): Promise<HTMLImageElement> => {\n    const inputData = dataStore.inputData\n\n    if (!inputData) {\n      throw new Error('No input data available in dataStore')\n    }\n\n    const { imgCanvas, maskCanvas, rgbCanvas, imgCtx, maskCtx } = store\n\n    if (!imgCanvas || !maskCanvas || !rgbCanvas || !imgCtx || !maskCtx) {\n      throw new Error('Canvas elements or contexts not available')\n    }\n\n    imgCtx.clearRect(0, 0, imgCanvas.width, imgCanvas.height)\n    maskCtx.clearRect(0, 0, maskCanvas.width, maskCanvas.height)\n\n    const baseImage = inputData.baseLayer.image\n    const maskImage = inputData.maskLayer.image\n    const paintImage = inputData.paintLayer?.image\n\n    maskCanvas.width = baseImage.width\n    maskCanvas.height = baseImage.height\n    rgbCanvas.width = baseImage.width\n    rgbCanvas.height = baseImage.height\n\n    store.image = baseImage\n\n    await canvasManager.invalidateCanvas(\n      baseImage,\n      maskImage,\n      paintImage || null\n    )\n\n    await canvasManager.updateMaskColor()\n\n    return baseImage\n  }\n\n  return {\n    loadImages\n  }\n}\n\nexport const useImageLoader = createSharedComposable(useImageLoaderInternal)\n","import { ref } from 'vue'\nimport { useMaskEditorStore } from '@/stores/maskEditorStore'\n\nexport function useKeyboard() {\n  const store = useMaskEditorStore()\n\n  const keysDown = ref<string[]>([])\n\n  const isKeyDown = (key: string): boolean => {\n    return keysDown.value.includes(key)\n  }\n\n  const clearKeys = (): void => {\n    keysDown.value = []\n  }\n\n  const handleKeyDown = (event: KeyboardEvent): void => {\n    if (!keysDown.value.includes(event.key)) {\n      keysDown.value.push(event.key)\n    }\n\n    if (event.key === ' ') {\n      event.preventDefault()\n      const activeElement = document.activeElement as HTMLElement\n      if (activeElement && activeElement.blur) {\n        activeElement.blur()\n      }\n    }\n\n    if ((event.ctrlKey || event.metaKey) && !event.altKey) {\n      const key = event.key.toUpperCase()\n\n      if ((key === 'Y' && !event.shiftKey) || (key === 'Z' && event.shiftKey)) {\n        store.canvasHistory.redo()\n      } else if (key === 'Z' && !event.shiftKey) {\n        store.canvasHistory.undo()\n      }\n    }\n  }\n\n  const handleKeyUp = (event: KeyboardEvent): void => {\n    keysDown.value = keysDown.value.filter((key) => key !== event.key)\n  }\n\n  const addListeners = (): void => {\n    document.addEventListener('keydown', handleKeyDown)\n    document.addEventListener('keyup', handleKeyUp)\n    window.addEventListener('blur', clearKeys)\n  }\n\n  const removeListeners = (): void => {\n    document.removeEventListener('keydown', handleKeyDown)\n    document.removeEventListener('keyup', handleKeyUp)\n    window.removeEventListener('blur', clearKeys)\n  }\n\n  return {\n    isKeyDown,\n    addListeners,\n    removeListeners\n  }\n}\n","import { useMaskEditorDataStore } from '@/stores/maskEditorDataStore'\nimport type { ImageRef, ImageLayer } from '@/stores/maskEditorDataStore'\nimport type { LGraphNode } from '@/lib/litegraph/src/litegraph'\nimport { useNodeOutputStore } from '@/stores/imagePreviewStore'\nimport { isCloud } from '@/platform/distribution/types'\nimport { api } from '@/scripts/api'\nimport { app } from '@/scripts/app'\n\n// Private image utility functions\ninterface ImageLayerFilenames {\n  maskedImage: string\n  paint: string\n  paintedImage: string\n  paintedMaskedImage: string\n}\n\ninterface MaskLayersResponse {\n  painted_masked?: string\n  painted?: string\n  paint?: string\n  mask?: string\n}\n\nconst paintedMaskedImagePrefix = 'clipspace-painted-masked-'\n\nfunction imageLayerFilenamesIfApplicable(\n  inputImageFilename: string\n): ImageLayerFilenames | undefined {\n  const isPaintedMaskedImageFilename = inputImageFilename.startsWith(\n    paintedMaskedImagePrefix\n  )\n  if (!isPaintedMaskedImageFilename) return undefined\n  const suffix = inputImageFilename.slice(paintedMaskedImagePrefix.length)\n  const timestamp = parseInt(suffix.split('.')[0], 10)\n  return {\n    maskedImage: `clipspace-mask-${timestamp}.png`,\n    paint: `clipspace-paint-${timestamp}.png`,\n    paintedImage: `clipspace-painted-${timestamp}.png`,\n    paintedMaskedImage: `${paintedMaskedImagePrefix}${timestamp}.png`\n  }\n}\n\nfunction toRef(filename: string): ImageRef {\n  return {\n    filename,\n    subfolder: 'clipspace',\n    type: 'input'\n  }\n}\n\nfunction mkFileUrl(props: { ref: ImageRef; preview?: boolean }): string {\n  const params = new URLSearchParams()\n  params.set('filename', props.ref.filename)\n  if (props.ref.subfolder) {\n    params.set('subfolder', props.ref.subfolder)\n  }\n  if (props.ref.type) {\n    params.set('type', props.ref.type)\n  }\n\n  const pathPlusQueryParams = api.apiURL(\n    '/view?' +\n      params.toString() +\n      app.getPreviewFormatParam() +\n      app.getRandParam()\n  )\n  const imageElement = new Image()\n  imageElement.crossOrigin = 'anonymous'\n  imageElement.src = pathPlusQueryParams\n  return imageElement.src\n}\n\nexport function useMaskEditorLoader() {\n  const dataStore = useMaskEditorDataStore()\n  const nodeOutputStore = useNodeOutputStore()\n\n  const loadFromNode = async (node: LGraphNode): Promise<void> => {\n    dataStore.setLoading(true)\n\n    try {\n      validateNode(node)\n\n      const nodeImageUrl = getNodeImageUrl(node)\n\n      const nodeImageRef = parseImageRef(nodeImageUrl)\n\n      let widgetFilename: string | undefined\n      if (node.widgets) {\n        const imageWidget = node.widgets.find((w) => w.name === 'image')\n        if (\n          imageWidget &&\n          typeof imageWidget.value === 'object' &&\n          imageWidget.value &&\n          'filename' in imageWidget.value &&\n          typeof imageWidget.value.filename === 'string'\n        ) {\n          widgetFilename = imageWidget.value.filename\n        }\n      }\n\n      const fileToQuery = widgetFilename || nodeImageRef.filename\n\n      let maskLayersFromApi: MaskLayersResponse | undefined\n      if (isCloud) {\n        try {\n          const response = await api.fetchApi(\n            `/files/mask-layers?filename=${fileToQuery}`\n          )\n          if (response.ok) {\n            maskLayersFromApi = await response.json()\n          }\n        } catch (error) {\n          // Fallback to pattern matching if API call fails\n        }\n      }\n\n      let imageLayerFilenames = imageLayerFilenamesIfApplicable(\n        nodeImageRef.filename\n      )\n\n      if (maskLayersFromApi) {\n        const baseFile =\n          maskLayersFromApi.painted_masked || maskLayersFromApi.painted\n\n        if (baseFile) {\n          imageLayerFilenames = {\n            maskedImage: baseFile,\n            paint: maskLayersFromApi.paint || '',\n            paintedImage: maskLayersFromApi.painted || '',\n            paintedMaskedImage: maskLayersFromApi.painted_masked || baseFile\n          }\n        }\n      }\n\n      const baseImageUrl = imageLayerFilenames?.maskedImage\n        ? mkFileUrl({ ref: toRef(imageLayerFilenames.maskedImage) })\n        : nodeImageUrl\n\n      const sourceRef = imageLayerFilenames?.maskedImage\n        ? parseImageRef(baseImageUrl)\n        : nodeImageRef\n\n      let paintLayerUrl: string | null = null\n      if (maskLayersFromApi?.paint) {\n        paintLayerUrl = mkFileUrl({ ref: toRef(maskLayersFromApi.paint) })\n      } else if (imageLayerFilenames?.paint) {\n        paintLayerUrl = mkFileUrl({ ref: toRef(imageLayerFilenames.paint) })\n      }\n\n      const [baseLayer, maskLayer, paintLayer] = await Promise.all([\n        loadImageLayer(baseImageUrl, 'rgb'),\n        loadImageLayer(baseImageUrl, 'a'),\n        paintLayerUrl\n          ? loadPaintLayer(paintLayerUrl)\n          : Promise.resolve(undefined)\n      ])\n\n      dataStore.inputData = {\n        baseLayer,\n        maskLayer,\n        paintLayer,\n        sourceRef,\n        nodeId: node.id\n      }\n\n      dataStore.sourceNode = node\n      dataStore.setLoading(false)\n    } catch (error) {\n      const errorMessage =\n        error instanceof Error ? error.message : 'Failed to load from node'\n      console.error('[MaskEditorLoader]', errorMessage, error)\n      dataStore.setLoading(false, errorMessage)\n      throw error\n    }\n  }\n\n  function validateNode(node: LGraphNode): void {\n    if (!node) {\n      throw new Error('Node is null or undefined')\n    }\n\n    const hasImages = node.imgs?.length || node.previewMediaType === 'image'\n    if (!hasImages) {\n      throw new Error('Node has no images')\n    }\n  }\n\n  function getNodeImageUrl(node: LGraphNode): string {\n    if (node.images?.[0]) {\n      const img = node.images[0]\n      const params = new URLSearchParams({\n        filename: img.filename,\n        type: img.type || 'output',\n        subfolder: img.subfolder || ''\n      })\n      return api.apiURL(`/view?${params.toString()}`)\n    }\n\n    const outputs = nodeOutputStore.getNodeOutputs(node)\n    if (outputs?.images?.[0]) {\n      const img = outputs.images[0]\n      if (!img.filename) {\n        throw new Error('nodeOutputStore image missing filename')\n      }\n\n      const params = new URLSearchParams()\n      params.set('filename', img.filename)\n      params.set('type', img.type || 'output')\n      params.set('subfolder', img.subfolder || '')\n      return api.apiURL(`/view?${params.toString()}`)\n    }\n\n    if (node.imgs?.length) {\n      const index = node.imageIndex ?? 0\n      const imgSrc = node.imgs[index].src\n\n      if (imgSrc && !imgSrc.startsWith('data:')) {\n        return imgSrc\n      }\n    }\n\n    throw new Error('Unable to get image URL from node')\n  }\n\n  function parseImageRef(url: string): ImageRef {\n    try {\n      const urlObj = new URL(url)\n      const filename = urlObj.searchParams.get('filename')\n\n      if (!filename) {\n        throw new Error('Image URL missing filename parameter')\n      }\n\n      return {\n        filename,\n        subfolder: urlObj.searchParams.get('subfolder') || undefined,\n        type: urlObj.searchParams.get('type') || undefined\n      }\n    } catch (error) {\n      try {\n        const urlObj = new URL(url, window.location.origin)\n        const filename = urlObj.searchParams.get('filename')\n\n        if (!filename) {\n          throw new Error('Image URL missing filename parameter')\n        }\n\n        return {\n          filename,\n          subfolder: urlObj.searchParams.get('subfolder') || undefined,\n          type: urlObj.searchParams.get('type') || undefined\n        }\n      } catch (e) {\n        throw new Error(`Invalid image URL: ${url}`)\n      }\n    }\n  }\n\n  async function loadImageLayer(\n    url: string,\n    channel?: 'rgb' | 'a'\n  ): Promise<ImageLayer> {\n    let urlObj: URL\n    try {\n      urlObj = new URL(url)\n    } catch {\n      urlObj = new URL(url, window.location.origin)\n    }\n\n    if (channel) {\n      urlObj.searchParams.delete('channel')\n      urlObj.searchParams.set('channel', channel)\n    }\n\n    const finalUrl = urlObj.toString()\n    const image = await loadImage(finalUrl)\n\n    return { image, url: finalUrl }\n  }\n\n  function loadImage(url: string): Promise<HTMLImageElement> {\n    return new Promise((resolve, reject) => {\n      const img = new Image()\n      img.crossOrigin = 'anonymous'\n\n      img.onload = () => resolve(img)\n      img.onerror = () => reject(new Error(`Failed to load image: ${url}`))\n\n      img.src = url\n    })\n  }\n\n  async function loadPaintLayer(url: string): Promise<ImageLayer> {\n    let urlObj: URL\n    try {\n      urlObj = new URL(url)\n    } catch {\n      urlObj = new URL(url, window.location.origin)\n    }\n\n    const finalUrl = urlObj.toString()\n    const image = await loadImage(finalUrl)\n\n    return { image, url: finalUrl }\n  }\n\n  return {\n    loadFromNode\n  }\n}\n","import { ref, watch } from 'vue'\nimport type { Offset, Point } from '@/extensions/core/maskeditor/types'\nimport { useMaskEditorStore } from '@/stores/maskEditorStore'\n\nexport function usePanAndZoom() {\n  const store = useMaskEditorStore()\n\n  const DOUBLE_TAP_DELAY = 300\n\n  const lastTwoFingerTap = ref(0)\n  const isTouchZooming = ref(false)\n  const lastTouchZoomDistance = ref(0)\n  const lastTouchMidPoint = ref<Point>({ x: 0, y: 0 })\n  const lastTouchPoint = ref<Point>({ x: 0, y: 0 })\n\n  const zoom_ratio = ref(1)\n  const interpolatedZoomRatio = ref(1)\n  const pan_offset = ref<Offset>({ x: 0, y: 0 })\n\n  const mouseDownPoint = ref<Point | null>(null)\n  const initialPan = ref<Offset>({ x: 0, y: 0 })\n\n  const canvasContainer = ref<HTMLElement | null>(null)\n  const maskCanvas = ref<HTMLCanvasElement | null>(null)\n  const rgbCanvas = ref<HTMLCanvasElement | null>(null)\n  const rootElement = ref<HTMLElement | null>(null)\n\n  const toolPanelElement = ref<HTMLElement | null>(null)\n  const sidePanelElement = ref<HTMLElement | null>(null)\n\n  const image = ref<HTMLImageElement | null>(null)\n  const imageRootWidth = ref(0)\n  const imageRootHeight = ref(0)\n\n  const cursorPoint = ref<Point>({ x: 0, y: 0 })\n  const penPointerIdList = ref<number[]>([])\n\n  const getTouchDistance = (touches: TouchList): number => {\n    const dx = touches[0].clientX - touches[1].clientX\n    const dy = touches[0].clientY - touches[1].clientY\n    return Math.sqrt(dx * dx + dy * dy)\n  }\n\n  const getTouchMidpoint = (touches: TouchList): Point => {\n    return {\n      x: (touches[0].clientX + touches[1].clientX) / 2,\n      y: (touches[0].clientY + touches[1].clientY) / 2\n    }\n  }\n\n  const updateCursorPosition = (clientPoint: Point): void => {\n    const cursorX = clientPoint.x - pan_offset.value.x\n    const cursorY = clientPoint.y - pan_offset.value.y\n    cursorPoint.value = { x: cursorX, y: cursorY }\n    store.setCursorPoint({ x: cursorX, y: cursorY })\n  }\n\n  const handleDoubleTap = (): void => {\n    store.canvasHistory.undo()\n  }\n\n  const invalidatePanZoom = async (): Promise<void> => {\n    // Single validation check upfront\n    if (\n      !image.value?.width ||\n      !image.value?.height ||\n      !pan_offset.value ||\n      !zoom_ratio.value\n    ) {\n      console.warn('Missing required properties for pan/zoom')\n      return\n    }\n\n    const raw_width = image.value.width * zoom_ratio.value\n    const raw_height = image.value.height * zoom_ratio.value\n\n    if (!canvasContainer.value) {\n      canvasContainer.value = store.canvasContainer\n    }\n    if (!canvasContainer.value) return\n\n    Object.assign(canvasContainer.value.style, {\n      width: `${raw_width}px`,\n      height: `${raw_height}px`,\n      left: `${pan_offset.value.x}px`,\n      top: `${pan_offset.value.y}px`\n    })\n\n    if (!rgbCanvas.value) {\n      rgbCanvas.value = store.rgbCanvas\n    }\n    if (rgbCanvas.value) {\n      if (\n        rgbCanvas.value.width !== image.value.width ||\n        rgbCanvas.value.height !== image.value.height\n      ) {\n        rgbCanvas.value.width = image.value.width\n        rgbCanvas.value.height = image.value.height\n      }\n\n      rgbCanvas.value.style.width = `${raw_width}px`\n      rgbCanvas.value.style.height = `${raw_height}px`\n    }\n\n    store.setPanOffset(pan_offset.value)\n    store.setZoomRatio(zoom_ratio.value)\n  }\n\n  const handlePanStart = (event: PointerEvent): void => {\n    mouseDownPoint.value = { x: event.clientX, y: event.clientY }\n\n    store.isPanning = true\n    initialPan.value = { ...pan_offset.value }\n  }\n\n  const handlePanMove = async (event: PointerEvent): Promise<void> => {\n    if (mouseDownPoint.value === null) {\n      throw new Error('mouseDownPoint is null')\n    }\n\n    const deltaX = mouseDownPoint.value.x - event.clientX\n    const deltaY = mouseDownPoint.value.y - event.clientY\n\n    const pan_x = initialPan.value.x - deltaX\n    const pan_y = initialPan.value.y - deltaY\n\n    pan_offset.value = { x: pan_x, y: pan_y }\n\n    await invalidatePanZoom()\n  }\n\n  const handleSingleTouchPan = async (touch: Touch): Promise<void> => {\n    if (lastTouchPoint.value === null) {\n      lastTouchPoint.value = { x: touch.clientX, y: touch.clientY }\n      return\n    }\n\n    const deltaX = touch.clientX - lastTouchPoint.value.x\n    const deltaY = touch.clientY - lastTouchPoint.value.y\n\n    pan_offset.value.x += deltaX\n    pan_offset.value.y += deltaY\n\n    await invalidatePanZoom()\n\n    lastTouchPoint.value = { x: touch.clientX, y: touch.clientY }\n  }\n\n  const handleTouchStart = (event: TouchEvent): void => {\n    event.preventDefault()\n\n    if (penPointerIdList.value.length > 0) return\n\n    store.brushVisible = false\n\n    if (event.touches.length === 2) {\n      const currentTime = new Date().getTime()\n      const tapTimeDiff = currentTime - lastTwoFingerTap.value\n\n      if (tapTimeDiff < DOUBLE_TAP_DELAY) {\n        handleDoubleTap()\n        lastTwoFingerTap.value = 0\n      } else {\n        lastTwoFingerTap.value = currentTime\n\n        isTouchZooming.value = true\n        lastTouchZoomDistance.value = getTouchDistance(event.touches)\n        lastTouchMidPoint.value = getTouchMidpoint(event.touches)\n      }\n    } else if (event.touches.length === 1) {\n      lastTouchPoint.value = {\n        x: event.touches[0].clientX,\n        y: event.touches[0].clientY\n      }\n    }\n  }\n\n  const handleTouchMove = async (event: TouchEvent): Promise<void> => {\n    event.preventDefault()\n\n    if (penPointerIdList.value.length > 0) return\n\n    lastTwoFingerTap.value = 0\n\n    if (isTouchZooming.value && event.touches.length === 2) {\n      const newDistance = getTouchDistance(event.touches)\n      const zoomFactor = newDistance / lastTouchZoomDistance.value\n      const oldZoom = zoom_ratio.value\n      zoom_ratio.value = Math.max(\n        0.2,\n        Math.min(10.0, zoom_ratio.value * zoomFactor)\n      )\n      const newZoom = zoom_ratio.value\n\n      const midpoint = getTouchMidpoint(event.touches)\n\n      if (lastTouchMidPoint.value) {\n        const deltaX = midpoint.x - lastTouchMidPoint.value.x\n        const deltaY = midpoint.y - lastTouchMidPoint.value.y\n\n        pan_offset.value.x += deltaX\n        pan_offset.value.y += deltaY\n      }\n\n      if (maskCanvas.value === null) {\n        maskCanvas.value = store.maskCanvas\n      }\n      if (!maskCanvas.value) return\n\n      const rect = maskCanvas.value.getBoundingClientRect()\n      const touchX = midpoint.x - rect.left\n      const touchY = midpoint.y - rect.top\n\n      const scaleFactor = newZoom / oldZoom\n      pan_offset.value.x += touchX - touchX * scaleFactor\n      pan_offset.value.y += touchY - touchY * scaleFactor\n\n      await invalidatePanZoom()\n      lastTouchZoomDistance.value = newDistance\n      lastTouchMidPoint.value = midpoint\n    } else if (event.touches.length === 1) {\n      await handleSingleTouchPan(event.touches[0])\n    }\n  }\n\n  const handleTouchEnd = (event: TouchEvent): void => {\n    event.preventDefault()\n\n    const lastTouch = event.touches[0]\n\n    if (lastTouch) {\n      lastTouchPoint.value = {\n        x: lastTouch.clientX,\n        y: lastTouch.clientY\n      }\n    } else {\n      isTouchZooming.value = false\n      lastTouchMidPoint.value = { x: 0, y: 0 }\n    }\n  }\n\n  const zoom = async (event: WheelEvent): Promise<void> => {\n    const cursorPosition = { x: event.clientX, y: event.clientY }\n\n    const oldZoom = zoom_ratio.value\n    const zoomFactor = event.deltaY < 0 ? 1.1 : 0.9\n    zoom_ratio.value = Math.max(\n      0.2,\n      Math.min(10.0, zoom_ratio.value * zoomFactor)\n    )\n    const newZoom = zoom_ratio.value\n\n    if (!maskCanvas.value) {\n      maskCanvas.value = store.maskCanvas\n    }\n    if (!maskCanvas.value) return\n\n    const rect = maskCanvas.value.getBoundingClientRect()\n    const mouseX = cursorPosition.x - rect.left\n    const mouseY = cursorPosition.y - rect.top\n\n    const scaleFactor = newZoom / oldZoom\n    pan_offset.value.x += mouseX - mouseX * scaleFactor\n    pan_offset.value.y += mouseY - mouseY * scaleFactor\n\n    await invalidatePanZoom()\n\n    const newImageWidth = maskCanvas.value.clientWidth\n\n    const zoomRatio = newImageWidth / imageRootWidth.value\n\n    interpolatedZoomRatio.value = zoomRatio\n    store.displayZoomRatio = zoomRatio\n\n    updateCursorPosition(cursorPosition)\n  }\n\n  const getPanelDimensions = (): {\n    sidePanelWidth: number\n    toolPanelWidth: number\n  } => {\n    const toolPanelWidth =\n      toolPanelElement.value?.getBoundingClientRect().width || 64\n    const sidePanelWidth =\n      sidePanelElement.value?.getBoundingClientRect().width || 220\n\n    return { sidePanelWidth, toolPanelWidth }\n  }\n\n  const smoothResetView = async (duration: number = 500): Promise<void> => {\n    if (!image.value || !rootElement.value) return\n\n    const startZoom = zoom_ratio.value\n    const startPan = { ...pan_offset.value }\n\n    const { sidePanelWidth, toolPanelWidth } = getPanelDimensions()\n\n    const availableWidth =\n      rootElement.value.clientWidth - sidePanelWidth - toolPanelWidth\n    const availableHeight = rootElement.value.clientHeight\n\n    // Calculate target zoom\n    const zoomRatioWidth = availableWidth / image.value.width\n    const zoomRatioHeight = availableHeight / image.value.height\n    const targetZoom = Math.min(zoomRatioWidth, zoomRatioHeight)\n\n    const aspectRatio = image.value.width / image.value.height\n    let finalWidth: number\n    let finalHeight: number\n\n    const targetPan = { x: toolPanelWidth, y: 0 }\n\n    if (zoomRatioHeight > zoomRatioWidth) {\n      finalWidth = availableWidth\n      finalHeight = finalWidth / aspectRatio\n      targetPan.y = (availableHeight - finalHeight) / 2\n    } else {\n      finalHeight = availableHeight\n      finalWidth = finalHeight * aspectRatio\n      targetPan.x = (availableWidth - finalWidth) / 2 + toolPanelWidth\n    }\n\n    const startTime = performance.now()\n    const animate = async (currentTime: number) => {\n      const elapsed = currentTime - startTime\n      const progress = Math.min(elapsed / duration, 1)\n      const eased = 1 - Math.pow(1 - progress, 3)\n\n      zoom_ratio.value = startZoom + (targetZoom - startZoom) * eased\n      pan_offset.value.x = startPan.x + (targetPan.x - startPan.x) * eased\n      pan_offset.value.y = startPan.y + (targetPan.y - startPan.y) * eased\n\n      await invalidatePanZoom()\n\n      const interpolatedRatio = startZoom + (1.0 - startZoom) * eased\n      store.displayZoomRatio = interpolatedRatio\n\n      if (progress < 1) {\n        requestAnimationFrame(animate)\n      }\n    }\n\n    requestAnimationFrame(animate)\n    interpolatedZoomRatio.value = 1.0\n  }\n\n  const initializeCanvasPanZoom = async (\n    img: HTMLImageElement,\n    root: HTMLElement,\n    toolPanel?: HTMLElement | null,\n    sidePanel?: HTMLElement | null\n  ): Promise<void> => {\n    rootElement.value = root\n    toolPanelElement.value = toolPanel || null\n    sidePanelElement.value = sidePanel || null\n\n    const { sidePanelWidth, toolPanelWidth } = getPanelDimensions()\n\n    const availableWidth = root.clientWidth - sidePanelWidth - toolPanelWidth\n    const availableHeight = root.clientHeight\n\n    const zoomRatioWidth = availableWidth / img.width\n    const zoomRatioHeight = availableHeight / img.height\n\n    const aspectRatio = img.width / img.height\n\n    let finalWidth: number\n    let finalHeight: number\n\n    const panOffset: Offset = { x: toolPanelWidth, y: 0 }\n\n    if (zoomRatioHeight > zoomRatioWidth) {\n      finalWidth = availableWidth\n      finalHeight = finalWidth / aspectRatio\n      panOffset.y = (availableHeight - finalHeight) / 2\n    } else {\n      finalHeight = availableHeight\n      finalWidth = finalHeight * aspectRatio\n      panOffset.x = (availableWidth - finalWidth) / 2 + toolPanelWidth\n    }\n\n    if (image.value === null) {\n      image.value = img\n    }\n\n    imageRootWidth.value = finalWidth\n    imageRootHeight.value = finalHeight\n\n    zoom_ratio.value = Math.min(zoomRatioWidth, zoomRatioHeight)\n    pan_offset.value = panOffset\n\n    penPointerIdList.value = []\n\n    await invalidatePanZoom()\n  }\n\n  watch(\n    () => store.resetZoomTrigger,\n    async () => {\n      if (interpolatedZoomRatio.value === 1) return\n      await smoothResetView()\n    }\n  )\n\n  return {\n    initializeCanvasPanZoom,\n    handlePanStart,\n    handlePanMove,\n    handleTouchStart,\n    handleTouchMove,\n    handleTouchEnd,\n    updateCursorPosition,\n    zoom,\n    invalidatePanZoom\n  }\n}\n","import { createSharedComposable } from '@vueuse/core'\nimport { unref } from 'vue'\nimport { useMaskEditorStore } from '@/stores/maskEditorStore'\n\ninterface Point {\n  x: number\n  y: number\n}\n\nfunction useCoordinateTransformInternal() {\n  const store = useMaskEditorStore()\n\n  const screenToCanvas = (clientPoint: Point): Point => {\n    const pointerZoneEl = unref(store.pointerZone)\n    const canvasContainerEl = unref(store.canvasContainer)\n    const canvasEl = unref(store.maskCanvas)\n\n    if (!pointerZoneEl || !canvasContainerEl || !canvasEl) {\n      console.warn('screenToCanvas called before elements are available')\n      return { x: 0, y: 0 }\n    }\n\n    const pointerZoneRect = pointerZoneEl.getBoundingClientRect()\n    const canvasContainerRect = canvasContainerEl.getBoundingClientRect()\n    const canvasRect = canvasEl.getBoundingClientRect()\n\n    const absoluteX = pointerZoneRect.left + clientPoint.x\n    const absoluteY = pointerZoneRect.top + clientPoint.y\n\n    const canvasX = absoluteX - canvasContainerRect.left\n    const canvasY = absoluteY - canvasContainerRect.top\n\n    const scaleX = canvasEl.width / canvasRect.width\n    const scaleY = canvasEl.height / canvasRect.height\n\n    const x = canvasX * scaleX\n    const y = canvasY * scaleY\n\n    return { x, y }\n  }\n\n  const canvasToScreen = (canvasPoint: Point): Point => {\n    const pointerZoneEl = unref(store.pointerZone)\n    const canvasContainerEl = unref(store.canvasContainer)\n    const canvasEl = unref(store.maskCanvas)\n\n    if (!pointerZoneEl || !canvasContainerEl || !canvasEl) {\n      console.warn('canvasToScreen called before elements are available')\n      return { x: 0, y: 0 }\n    }\n\n    const pointerZoneRect = pointerZoneEl.getBoundingClientRect()\n    const canvasContainerRect = canvasContainerEl.getBoundingClientRect()\n    const canvasRect = canvasEl.getBoundingClientRect()\n\n    const scaleX = canvasRect.width / canvasEl.width\n    const scaleY = canvasRect.height / canvasEl.height\n\n    const displayX = canvasPoint.x * scaleX\n    const displayY = canvasPoint.y * scaleY\n\n    const absoluteX = canvasContainerRect.left + displayX\n    const absoluteY = canvasContainerRect.top + displayY\n\n    const x = absoluteX - pointerZoneRect.left\n    const y = absoluteY - pointerZoneRect.top\n\n    return { x, y }\n  }\n\n  return {\n    screenToCanvas,\n    canvasToScreen\n  }\n}\n\nexport const useCoordinateTransform = createSharedComposable(\n  useCoordinateTransformInternal\n)\n","import { ref } from 'vue'\nimport QuickLRU from '@alloc/quick-lru'\nimport { debounce } from 'es-toolkit/compat'\nimport { hexToRgb, parseToRgb } from '@/utils/colorUtil'\nimport { getStorageValue, setStorageValue } from '@/scripts/utils'\nimport {\n  Tools,\n  BrushShape,\n  CompositionOperation\n} from '@/extensions/core/maskeditor/types'\nimport type { Brush, Point } from '@/extensions/core/maskeditor/types'\nimport { useMaskEditorStore } from '@/stores/maskEditorStore'\nimport { useCoordinateTransform } from './useCoordinateTransform'\n\nconst saveBrushToCache = debounce(function (key: string, brush: Brush): void {\n  try {\n    const brushString = JSON.stringify(brush)\n    setStorageValue(key, brushString)\n  } catch (error) {\n    console.error('Failed to save brush to cache:', error)\n  }\n}, 300)\n\nfunction loadBrushFromCache(key: string): Brush | null {\n  try {\n    const brushString = getStorageValue(key)\n    if (brushString) {\n      return JSON.parse(brushString) as Brush\n    } else {\n      return null\n    }\n  } catch (error) {\n    console.error('Failed to load brush from cache:', error)\n    return null\n  }\n}\n\nexport function useBrushDrawing(initialSettings?: {\n  useDominantAxis?: boolean\n  brushAdjustmentSpeed?: number\n}) {\n  const store = useMaskEditorStore()\n\n  const coordinateTransform = useCoordinateTransform()\n\n  const brushTextureCache = new QuickLRU<string, HTMLCanvasElement>({\n    maxSize: 8\n  })\n\n  const SMOOTHING_MAX_STEPS = 30\n  const SMOOTHING_MIN_STEPS = 2\n\n  const isDrawing = ref(false)\n  const isDrawingLine = ref(false)\n  const lineStartPoint = ref<Point | null>(null)\n  const smoothingCordsArray = ref<Point[]>([])\n  const smoothingLastDrawTime = ref(new Date())\n  const initialDraw = ref(true)\n\n  const brushStrokeCanvas = ref<HTMLCanvasElement | null>(null)\n  const brushStrokeCtx = ref<CanvasRenderingContext2D | null>(null)\n\n  const initialPoint = ref<Point | null>(null)\n  const useDominantAxis = ref(initialSettings?.useDominantAxis ?? false)\n  const brushAdjustmentSpeed = ref(initialSettings?.brushAdjustmentSpeed ?? 1.0)\n\n  const cachedBrushSettings = loadBrushFromCache('maskeditor_brush_settings')\n  if (cachedBrushSettings) {\n    store.setBrushSize(cachedBrushSettings.size)\n    store.setBrushOpacity(cachedBrushSettings.opacity)\n    store.setBrushHardness(cachedBrushSettings.hardness)\n    store.brushSettings.type = cachedBrushSettings.type\n    store.setBrushSmoothingPrecision(cachedBrushSettings.smoothingPrecision)\n  }\n\n  const createBrushStrokeCanvas = async (): Promise<void> => {\n    if (brushStrokeCanvas.value !== null) {\n      return\n    }\n\n    const maskCanvas = store.maskCanvas\n    if (!maskCanvas) {\n      throw new Error('Mask canvas not initialized')\n    }\n\n    const canvas = document.createElement('canvas')\n    canvas.width = maskCanvas.width\n    canvas.height = maskCanvas.height\n\n    brushStrokeCanvas.value = canvas\n    brushStrokeCtx.value = canvas.getContext('2d')!\n  }\n\n  const initShape = (compositionOperation: CompositionOperation) => {\n    const blendMode = store.maskBlendMode\n    const mask_ctx = store.maskCtx\n    const rgb_ctx = store.rgbCtx\n\n    if (!mask_ctx || !rgb_ctx) {\n      throw new Error('Canvas contexts are required')\n    }\n\n    mask_ctx.beginPath()\n    rgb_ctx.beginPath()\n\n    if (compositionOperation === CompositionOperation.SourceOver) {\n      mask_ctx.fillStyle = blendMode\n      mask_ctx.globalCompositeOperation = CompositionOperation.SourceOver\n      rgb_ctx.globalCompositeOperation = CompositionOperation.SourceOver\n    } else if (compositionOperation === CompositionOperation.DestinationOut) {\n      mask_ctx.globalCompositeOperation = CompositionOperation.DestinationOut\n      rgb_ctx.globalCompositeOperation = CompositionOperation.DestinationOut\n    }\n  }\n\n  const formatRgba = (hex: string, alpha: number): string => {\n    const { r, g, b } = hexToRgb(hex)\n    return `rgba(${r}, ${g}, ${b}, ${alpha})`\n  }\n\n  const getCachedBrushTexture = (\n    radius: number,\n    hardness: number,\n    color: string,\n    opacity: number\n  ): HTMLCanvasElement => {\n    const cacheKey = `${radius}_${hardness}_${color}_${opacity}`\n\n    if (brushTextureCache.has(cacheKey)) {\n      return brushTextureCache.get(cacheKey)!\n    }\n\n    const tempCanvas = document.createElement('canvas')\n    const tempCtx = tempCanvas.getContext('2d')!\n    const size = radius * 2\n    tempCanvas.width = size\n    tempCanvas.height = size\n\n    const centerX = size / 2\n    const centerY = size / 2\n    const hardRadius = radius * hardness\n\n    const imageData = tempCtx.createImageData(size, size)\n    const data = imageData.data\n    const { r, g, b } = parseToRgb(color)\n\n    const fadeRange = radius - hardRadius\n\n    for (let y = 0; y < size; y++) {\n      const dy = y - centerY\n      for (let x = 0; x < size; x++) {\n        const dx = x - centerX\n        const index = (y * size + x) * 4\n\n        // Calculate square distance (Chebyshev distance)\n        const distFromEdge = Math.max(Math.abs(dx), Math.abs(dy))\n\n        let pixelOpacity = 0\n        if (distFromEdge <= hardRadius) {\n          pixelOpacity = opacity\n        } else if (distFromEdge <= radius) {\n          const fadeProgress = (distFromEdge - hardRadius) / fadeRange\n          pixelOpacity = opacity * (1 - fadeProgress)\n        }\n\n        data[index] = r\n        data[index + 1] = g\n        data[index + 2] = b\n        data[index + 3] = pixelOpacity * 255\n      }\n    }\n\n    tempCtx.putImageData(imageData, 0, 0)\n    brushTextureCache.set(cacheKey, tempCanvas)\n\n    return tempCanvas\n  }\n\n  const createBrushGradient = (\n    ctx: CanvasRenderingContext2D,\n    x: number,\n    y: number,\n    radius: number,\n    hardness: number,\n    color: string,\n    opacity: number,\n    isErasing: boolean\n  ): CanvasGradient => {\n    const gradient = ctx.createRadialGradient(x, y, 0, x, y, radius)\n\n    if (isErasing) {\n      gradient.addColorStop(0, `rgba(255, 255, 255, ${opacity})`)\n      gradient.addColorStop(hardness, `rgba(255, 255, 255, ${opacity * 0.5})`)\n      gradient.addColorStop(1, `rgba(255, 255, 255, 0)`)\n    } else {\n      const { r, g, b } = parseToRgb(color)\n      gradient.addColorStop(0, `rgba(${r}, ${g}, ${b}, ${opacity})`)\n      gradient.addColorStop(\n        hardness,\n        `rgba(${r}, ${g}, ${b}, ${opacity * 0.5})`\n      )\n      gradient.addColorStop(1, `rgba(${r}, ${g}, ${b}, 0)`)\n    }\n\n    return gradient\n  }\n\n  const drawShapeOnContext = (\n    ctx: CanvasRenderingContext2D,\n    brushType: BrushShape,\n    x: number,\n    y: number,\n    radius: number\n  ): void => {\n    ctx.beginPath()\n    if (brushType === BrushShape.Rect) {\n      ctx.rect(x - radius, y - radius, radius * 2, radius * 2)\n    } else {\n      ctx.arc(x, y, radius, 0, Math.PI * 2, false)\n    }\n    ctx.fill()\n  }\n\n  const drawRgbShape = (\n    ctx: CanvasRenderingContext2D,\n    point: Point,\n    brushType: BrushShape,\n    brushRadius: number,\n    hardness: number,\n    opacity: number\n  ): void => {\n    const { x, y } = point\n    const rgbColor = store.rgbColor\n\n    if (brushType === BrushShape.Rect && hardness < 1) {\n      const rgbaColor = formatRgba(rgbColor, opacity)\n      const brushTexture = getCachedBrushTexture(\n        brushRadius,\n        hardness,\n        rgbaColor,\n        opacity\n      )\n      ctx.drawImage(brushTexture, x - brushRadius, y - brushRadius)\n      return\n    }\n\n    if (hardness === 1) {\n      const rgbaColor = formatRgba(rgbColor, opacity)\n      ctx.fillStyle = rgbaColor\n      drawShapeOnContext(ctx, brushType, x, y, brushRadius)\n      return\n    }\n\n    const gradient = createBrushGradient(\n      ctx,\n      x,\n      y,\n      brushRadius,\n      hardness,\n      rgbColor,\n      opacity,\n      false\n    )\n    ctx.fillStyle = gradient\n    drawShapeOnContext(ctx, brushType, x, y, brushRadius)\n  }\n\n  const drawMaskShape = (\n    ctx: CanvasRenderingContext2D,\n    point: Point,\n    brushType: BrushShape,\n    brushRadius: number,\n    hardness: number,\n    opacity: number,\n    isErasing: boolean\n  ): void => {\n    const { x, y } = point\n    const maskColor = store.maskColor\n\n    if (brushType === BrushShape.Rect && hardness < 1) {\n      const baseColor = isErasing\n        ? `rgba(255, 255, 255, ${opacity})`\n        : `rgba(${maskColor.r}, ${maskColor.g}, ${maskColor.b}, ${opacity})`\n\n      const brushTexture = getCachedBrushTexture(\n        brushRadius,\n        hardness,\n        baseColor,\n        opacity\n      )\n      ctx.drawImage(brushTexture, x - brushRadius, y - brushRadius)\n      return\n    }\n\n    if (hardness === 1) {\n      ctx.fillStyle = isErasing\n        ? `rgba(255, 255, 255, ${opacity})`\n        : `rgba(${maskColor.r}, ${maskColor.g}, ${maskColor.b}, ${opacity})`\n      drawShapeOnContext(ctx, brushType, x, y, brushRadius)\n      return\n    }\n\n    const maskColorHex = `rgb(${maskColor.r}, ${maskColor.g}, ${maskColor.b})`\n    const gradient = createBrushGradient(\n      ctx,\n      x,\n      y,\n      brushRadius,\n      hardness,\n      maskColorHex,\n      opacity,\n      isErasing\n    )\n    ctx.fillStyle = gradient\n    drawShapeOnContext(ctx, brushType, x, y, brushRadius)\n  }\n\n  const drawShape = (point: Point, overrideOpacity?: number) => {\n    const brush = store.brushSettings\n    const mask_ctx = store.maskCtx\n    const rgb_ctx = store.rgbCtx\n\n    if (!mask_ctx || !rgb_ctx) {\n      throw new Error('Canvas contexts are required')\n    }\n\n    const brushType = brush.type\n    const brushRadius = brush.size\n    const hardness = brush.hardness\n    const opacity = overrideOpacity ?? brush.opacity\n\n    const isErasing = mask_ctx.globalCompositeOperation === 'destination-out'\n    const currentTool = store.currentTool\n    const isRgbLayer = store.activeLayer === 'rgb'\n\n    if (\n      isRgbLayer &&\n      currentTool &&\n      (currentTool === Tools.Eraser || currentTool === Tools.PaintPen)\n    ) {\n      drawRgbShape(rgb_ctx, point, brushType, brushRadius, hardness, opacity)\n      return\n    }\n\n    drawMaskShape(\n      mask_ctx,\n      point,\n      brushType,\n      brushRadius,\n      hardness,\n      opacity,\n      isErasing\n    )\n  }\n\n  const clampSmoothingPrecision = (value: number): number => {\n    return Math.min(Math.max(value, 1), 100)\n  }\n\n  const generateEquidistantPoints = (\n    points: Point[],\n    distance: number\n  ): Point[] => {\n    const result: Point[] = []\n    const cumulativeDistances: number[] = [0]\n\n    for (let i = 1; i < points.length; i++) {\n      const dx = points[i].x - points[i - 1].x\n      const dy = points[i].y - points[i - 1].y\n      const dist = Math.hypot(dx, dy)\n      cumulativeDistances[i] = cumulativeDistances[i - 1] + dist\n    }\n\n    const totalLength = cumulativeDistances[cumulativeDistances.length - 1]\n    const numPoints = Math.floor(totalLength / distance)\n\n    for (let i = 0; i <= numPoints; i++) {\n      const targetDistance = i * distance\n      let idx = 0\n\n      while (\n        idx < cumulativeDistances.length - 1 &&\n        cumulativeDistances[idx + 1] < targetDistance\n      ) {\n        idx++\n      }\n\n      if (idx >= points.length - 1) {\n        result.push(points[points.length - 1])\n        continue\n      }\n\n      const d0 = cumulativeDistances[idx]\n      const d1 = cumulativeDistances[idx + 1]\n      const t = (targetDistance - d0) / (d1 - d0)\n\n      const x = points[idx].x + t * (points[idx + 1].x - points[idx].x)\n      const y = points[idx].y + t * (points[idx + 1].y - points[idx].y)\n\n      result.push({ x, y })\n    }\n\n    return result\n  }\n\n  const drawWithBetterSmoothing = (point: Point): void => {\n    if (!smoothingCordsArray.value) {\n      smoothingCordsArray.value = []\n    }\n\n    const opacityConstant = 1 / (1 + Math.exp(3))\n    const interpolatedOpacity =\n      1 / (1 + Math.exp(-6 * (store.brushSettings.opacity - 0.5))) -\n      opacityConstant\n\n    smoothingCordsArray.value.push(point)\n\n    const POINTS_NR = 5\n    if (smoothingCordsArray.value.length < POINTS_NR) {\n      return\n    }\n\n    let totalLength = 0\n    const points = smoothingCordsArray.value\n    const len = points.length - 1\n\n    let dx, dy\n    for (let i = 0; i < len; i++) {\n      dx = points[i + 1].x - points[i].x\n      dy = points[i + 1].y - points[i].y\n      totalLength += Math.sqrt(dx * dx + dy * dy)\n    }\n\n    const maxSteps = SMOOTHING_MAX_STEPS\n    const minSteps = SMOOTHING_MIN_STEPS\n\n    const smoothing = clampSmoothingPrecision(\n      store.brushSettings.smoothingPrecision\n    )\n    const normalizedSmoothing = (smoothing - 1) / 99\n\n    const stepNr = Math.round(\n      Math.round(minSteps + (maxSteps - minSteps) * normalizedSmoothing)\n    )\n\n    const distanceBetweenPoints = totalLength / stepNr\n\n    let interpolatedPoints = points\n\n    if (stepNr > 0) {\n      interpolatedPoints = generateEquidistantPoints(\n        smoothingCordsArray.value,\n        distanceBetweenPoints\n      )\n    }\n\n    if (!initialDraw.value) {\n      const spliceIndex = interpolatedPoints.findIndex(\n        (p) =>\n          p.x === smoothingCordsArray.value[2].x &&\n          p.y === smoothingCordsArray.value[2].y\n      )\n\n      if (spliceIndex !== -1) {\n        interpolatedPoints = interpolatedPoints.slice(spliceIndex + 1)\n      }\n    }\n\n    for (const p of interpolatedPoints) {\n      drawShape(p, interpolatedOpacity)\n    }\n\n    if (!initialDraw.value) {\n      smoothingCordsArray.value = smoothingCordsArray.value.slice(2)\n    } else {\n      initialDraw.value = false\n    }\n  }\n\n  const drawLine = async (\n    p1: Point,\n    p2: Point,\n    compositionOp: CompositionOperation\n  ): Promise<void> => {\n    try {\n      const brush_size = store.brushSettings.size\n      const distance = Math.sqrt((p2.x - p1.x) ** 2 + (p2.y - p1.y) ** 2)\n      const steps = Math.ceil(\n        distance / ((brush_size / store.brushSettings.smoothingPrecision) * 4)\n      )\n      const interpolatedOpacity =\n        1 / (1 + Math.exp(-6 * (store.brushSettings.opacity - 0.5))) -\n        1 / (1 + Math.exp(3))\n\n      initShape(compositionOp)\n\n      for (let i = 0; i <= steps; i++) {\n        const t = i / steps\n        const x = p1.x + (p2.x - p1.x) * t\n        const y = p1.y + (p2.y - p1.y) * t\n        const point = { x, y }\n\n        drawShape(point, interpolatedOpacity)\n      }\n    } catch (error) {\n      console.error('[useBrushDrawing] Failed to draw line:', error)\n      throw error\n    }\n  }\n\n  const startDrawing = async (event: PointerEvent): Promise<void> => {\n    isDrawing.value = true\n\n    try {\n      let compositionOp: CompositionOperation\n      const currentTool = store.currentTool\n      const coords = { x: event.offsetX, y: event.offsetY }\n      const coords_canvas = coordinateTransform.screenToCanvas(coords)\n\n      await createBrushStrokeCanvas()\n\n      if (currentTool === 'eraser' || event.buttons === 2) {\n        compositionOp = CompositionOperation.DestinationOut\n      } else {\n        compositionOp = CompositionOperation.SourceOver\n      }\n\n      if (event.shiftKey && lineStartPoint.value) {\n        isDrawingLine.value = true\n        await drawLine(lineStartPoint.value, coords_canvas, compositionOp)\n      } else {\n        isDrawingLine.value = false\n        initShape(compositionOp)\n        drawShape(coords_canvas)\n      }\n\n      lineStartPoint.value = coords_canvas\n      smoothingCordsArray.value = [coords_canvas]\n      smoothingLastDrawTime.value = new Date()\n    } catch (error) {\n      console.error('[useBrushDrawing] Failed to start drawing:', error)\n\n      isDrawing.value = false\n      isDrawingLine.value = false\n    }\n  }\n\n  const handleDrawing = async (event: PointerEvent): Promise<void> => {\n    const diff = performance.now() - smoothingLastDrawTime.value.getTime()\n    const coords = { x: event.offsetX, y: event.offsetY }\n    const coords_canvas = coordinateTransform.screenToCanvas(coords)\n    const currentTool = store.currentTool\n\n    if (diff > 20 && !isDrawing.value) {\n      requestAnimationFrame(() => {\n        try {\n          initShape(CompositionOperation.SourceOver)\n          drawShape(coords_canvas)\n          smoothingCordsArray.value.push(coords_canvas)\n        } catch (error) {\n          console.error('[useBrushDrawing] Drawing error:', error)\n        }\n      })\n    } else {\n      requestAnimationFrame(() => {\n        try {\n          if (currentTool === 'eraser' || event.buttons === 2) {\n            initShape(CompositionOperation.DestinationOut)\n          } else {\n            initShape(CompositionOperation.SourceOver)\n          }\n\n          drawWithBetterSmoothing(coords_canvas)\n        } catch (error) {\n          console.error('[useBrushDrawing] Drawing error:', error)\n        }\n      })\n    }\n\n    smoothingLastDrawTime.value = new Date()\n  }\n\n  const drawEnd = async (event: PointerEvent): Promise<void> => {\n    const coords = { x: event.offsetX, y: event.offsetY }\n    const coords_canvas = coordinateTransform.screenToCanvas(coords)\n\n    if (isDrawing.value) {\n      isDrawing.value = false\n      store.canvasHistory.saveState()\n      lineStartPoint.value = coords_canvas\n      initialDraw.value = true\n    }\n  }\n\n  const startBrushAdjustment = async (event: PointerEvent): Promise<void> => {\n    event.preventDefault()\n\n    const coords = { x: event.offsetX, y: event.offsetY }\n    const coords_canvas = coordinateTransform.screenToCanvas(coords)\n\n    store.brushPreviewGradientVisible = true\n    initialPoint.value = coords_canvas\n  }\n\n  const handleBrushAdjustment = async (event: PointerEvent): Promise<void> => {\n    if (!initialPoint.value) {\n      return\n    }\n\n    const coords = { x: event.offsetX, y: event.offsetY }\n    const brushDeadZone = 5\n    const coords_canvas = coordinateTransform.screenToCanvas(coords)\n\n    const delta_x = coords_canvas.x - initialPoint.value.x\n    const delta_y = coords_canvas.y - initialPoint.value.y\n\n    const effectiveDeltaX = Math.abs(delta_x) < brushDeadZone ? 0 : delta_x\n    const effectiveDeltaY = Math.abs(delta_y) < brushDeadZone ? 0 : delta_y\n\n    let finalDeltaX = effectiveDeltaX\n    let finalDeltaY = effectiveDeltaY\n\n    if (useDominantAxis.value) {\n      const ratio = Math.abs(effectiveDeltaX) / Math.abs(effectiveDeltaY)\n      const threshold = 2.0\n\n      if (ratio > threshold) {\n        finalDeltaY = 0\n      } else if (ratio < 1 / threshold) {\n        finalDeltaX = 0\n      }\n    }\n\n    const cappedDeltaX = Math.max(-100, Math.min(100, finalDeltaX))\n    const cappedDeltaY = Math.max(-100, Math.min(100, finalDeltaY))\n\n    const newSize = Math.max(\n      1,\n      Math.min(\n        100,\n        store.brushSettings.size +\n          (cappedDeltaX / 35) * brushAdjustmentSpeed.value\n      )\n    )\n\n    const newHardness = Math.max(\n      0,\n      Math.min(\n        1,\n        store.brushSettings.hardness -\n          (cappedDeltaY / 4000) * brushAdjustmentSpeed.value\n      )\n    )\n\n    store.setBrushSize(newSize)\n    store.setBrushHardness(newHardness)\n  }\n\n  const saveBrushSettings = (): void => {\n    saveBrushToCache('maskeditor_brush_settings', store.brushSettings)\n  }\n\n  return {\n    startDrawing,\n    handleDrawing,\n    drawEnd,\n    startBrushAdjustment,\n    handleBrushAdjustment,\n    saveBrushSettings\n  }\n}\n","import { ref, watch } from 'vue'\nimport { useMaskEditorStore } from '@/stores/maskEditorStore'\nimport { ColorComparisonMethod } from '@/extensions/core/maskeditor/types'\nimport type { Point } from '@/extensions/core/maskeditor/types'\n\nconst getPixelAlpha = (\n  data: Uint8ClampedArray,\n  x: number,\n  y: number,\n  width: number\n): number => {\n  return data[(y * width + x) * 4 + 3]\n}\n\nconst getPixelColor = (\n  data: Uint8ClampedArray,\n  x: number,\n  y: number,\n  width: number\n): { r: number; g: number; b: number } => {\n  const index = (y * width + x) * 4\n  return {\n    r: data[index],\n    g: data[index + 1],\n    b: data[index + 2]\n  }\n}\n\nconst setPixel = (\n  data: Uint8ClampedArray,\n  x: number,\n  y: number,\n  width: number,\n  alpha: number,\n  color: { r: number; g: number; b: number }\n): void => {\n  const index = (y * width + x) * 4\n  data[index] = color.r\n  data[index + 1] = color.g\n  data[index + 2] = color.b\n  data[index + 3] = alpha\n}\n\n// Color comparison utilities\nconst rgbToHSL = (\n  r: number,\n  g: number,\n  b: number\n): { h: number; s: number; l: number } => {\n  r /= 255\n  g /= 255\n  b /= 255\n\n  const max = Math.max(r, g, b)\n  const min = Math.min(r, g, b)\n  let h = 0\n  let s = 0\n  const l = (max + min) / 2\n\n  if (max !== min) {\n    const d = max - min\n    s = l > 0.5 ? d / (2 - max - min) : d / (max + min)\n\n    switch (max) {\n      case r:\n        h = (g - b) / d + (g < b ? 6 : 0)\n        break\n      case g:\n        h = (b - r) / d + 2\n        break\n      case b:\n        h = (r - g) / d + 4\n        break\n    }\n    h /= 6\n  }\n\n  return {\n    h: h * 360,\n    s: s * 100,\n    l: l * 100\n  }\n}\n\nconst rgbToLab = (rgb: {\n  r: number\n  g: number\n  b: number\n}): {\n  l: number\n  a: number\n  b: number\n} => {\n  let r = rgb.r / 255\n  let g = rgb.g / 255\n  let b = rgb.b / 255\n\n  r = r > 0.04045 ? Math.pow((r + 0.055) / 1.055, 2.4) : r / 12.92\n  g = g > 0.04045 ? Math.pow((g + 0.055) / 1.055, 2.4) : g / 12.92\n  b = b > 0.04045 ? Math.pow((b + 0.055) / 1.055, 2.4) : b / 12.92\n\n  r *= 100\n  g *= 100\n  b *= 100\n\n  const x = r * 0.4124 + g * 0.3576 + b * 0.1805\n  const y = r * 0.2126 + g * 0.7152 + b * 0.0722\n  const z = r * 0.0193 + g * 0.1192 + b * 0.9505\n\n  const xn = 95.047\n  const yn = 100.0\n  const zn = 108.883\n\n  const xyz = [x / xn, y / yn, z / zn]\n  for (let i = 0; i < xyz.length; i++) {\n    xyz[i] =\n      xyz[i] > 0.008856 ? Math.pow(xyz[i], 1 / 3) : 7.787 * xyz[i] + 16 / 116\n  }\n\n  return {\n    l: 116 * xyz[1] - 16,\n    a: 500 * (xyz[0] - xyz[1]),\n    b: 200 * (xyz[1] - xyz[2])\n  }\n}\n\nconst isPixelInRangeSimple = (\n  pixel: { r: number; g: number; b: number },\n  target: { r: number; g: number; b: number },\n  tolerance: number\n): boolean => {\n  const distance = Math.sqrt(\n    Math.pow(pixel.r - target.r, 2) +\n      Math.pow(pixel.g - target.g, 2) +\n      Math.pow(pixel.b - target.b, 2)\n  )\n  return distance <= tolerance\n}\n\nconst isPixelInRangeHSL = (\n  pixel: { r: number; g: number; b: number },\n  target: { r: number; g: number; b: number },\n  tolerance: number\n): boolean => {\n  const pixelHSL = rgbToHSL(pixel.r, pixel.g, pixel.b)\n  const targetHSL = rgbToHSL(target.r, target.g, target.b)\n\n  const hueDiff = Math.abs(pixelHSL.h - targetHSL.h)\n  const satDiff = Math.abs(pixelHSL.s - targetHSL.s)\n  const lightDiff = Math.abs(pixelHSL.l - targetHSL.l)\n\n  const distance = Math.sqrt(\n    Math.pow((hueDiff / 360) * 255, 2) +\n      Math.pow((satDiff / 100) * 255, 2) +\n      Math.pow((lightDiff / 100) * 255, 2)\n  )\n  return distance <= tolerance\n}\n\nconst isPixelInRangeLab = (\n  pixel: { r: number; g: number; b: number },\n  target: { r: number; g: number; b: number },\n  tolerance: number\n): boolean => {\n  const pixelLab = rgbToLab(pixel)\n  const targetLab = rgbToLab(target)\n\n  const deltaE = Math.sqrt(\n    Math.pow(pixelLab.l - targetLab.l, 2) +\n      Math.pow(pixelLab.a - targetLab.a, 2) +\n      Math.pow(pixelLab.b - targetLab.b, 2)\n  )\n\n  const normalizedDeltaE = (deltaE / 100) * 255\n  return normalizedDeltaE <= tolerance\n}\n\nconst isPixelInRange = (\n  pixel: { r: number; g: number; b: number },\n  target: { r: number; g: number; b: number },\n  tolerance: number,\n  method: ColorComparisonMethod\n): boolean => {\n  switch (method) {\n    case ColorComparisonMethod.Simple:\n      return isPixelInRangeSimple(pixel, target, tolerance)\n    case ColorComparisonMethod.HSL:\n      return isPixelInRangeHSL(pixel, target, tolerance)\n    case ColorComparisonMethod.LAB:\n      return isPixelInRangeLab(pixel, target, tolerance)\n    default:\n      return isPixelInRangeSimple(pixel, target, tolerance)\n  }\n}\n\nexport function useCanvasTools() {\n  const store = useMaskEditorStore()\n  const lastColorSelectPoint = ref<Point | null>(null)\n\n  const paintBucketFill = (point: Point): void => {\n    const ctx = store.maskCtx\n    const canvas = store.maskCanvas\n    if (!ctx || !canvas) return\n\n    const startX = Math.floor(point.x)\n    const startY = Math.floor(point.y)\n    const width = canvas.width\n    const height = canvas.height\n\n    if (startX < 0 || startX >= width || startY < 0 || startY >= height) {\n      return\n    }\n\n    const imageData = ctx.getImageData(0, 0, width, height)\n    const data = imageData.data\n\n    const targetAlpha = getPixelAlpha(data, startX, startY, width)\n    const isFillMode = targetAlpha !== 255\n\n    if (targetAlpha === -1) return\n\n    const maskColor = store.maskColor\n    const tolerance = store.paintBucketTolerance\n    const fillOpacity = Math.floor((store.fillOpacity / 100) * 255)\n\n    const stack: Array<[number, number]> = []\n    const visited = new Uint8Array(width * height)\n\n    const shouldProcessPixel = (\n      currentAlpha: number,\n      targetAlpha: number,\n      tolerance: number,\n      isFillMode: boolean\n    ): boolean => {\n      if (currentAlpha === -1) return false\n\n      if (isFillMode) {\n        return (\n          currentAlpha !== 255 &&\n          Math.abs(currentAlpha - targetAlpha) <= tolerance\n        )\n      } else {\n        return (\n          currentAlpha === 255 ||\n          Math.abs(currentAlpha - targetAlpha) <= tolerance\n        )\n      }\n    }\n\n    if (shouldProcessPixel(targetAlpha, targetAlpha, tolerance, isFillMode)) {\n      stack.push([startX, startY])\n    }\n\n    while (stack.length > 0) {\n      const [x, y] = stack.pop()!\n      const visitedIndex = y * width + x\n\n      if (visited[visitedIndex]) continue\n\n      const currentAlpha = getPixelAlpha(data, x, y, width)\n      if (\n        !shouldProcessPixel(currentAlpha, targetAlpha, tolerance, isFillMode)\n      ) {\n        continue\n      }\n\n      visited[visitedIndex] = 1\n      setPixel(data, x, y, width, isFillMode ? fillOpacity : 0, maskColor)\n\n      const checkNeighbor = (nx: number, ny: number) => {\n        if (nx < 0 || nx >= width || ny < 0 || ny >= height) return\n        if (!visited[ny * width + nx]) {\n          const alpha = getPixelAlpha(data, nx, ny, width)\n          if (shouldProcessPixel(alpha, targetAlpha, tolerance, isFillMode)) {\n            stack.push([nx, ny])\n          }\n        }\n      }\n\n      checkNeighbor(x - 1, y)\n      checkNeighbor(x + 1, y)\n      checkNeighbor(x, y - 1)\n      checkNeighbor(x, y + 1)\n    }\n\n    ctx.putImageData(imageData, 0, 0)\n    store.canvasHistory.saveState()\n  }\n\n  const colorSelectFill = async (point: Point): Promise<void> => {\n    const maskCtx = store.maskCtx\n    const imgCtx = store.imgCtx\n    const imgCanvas = store.imgCanvas\n\n    if (!maskCtx || !imgCtx || !imgCanvas) return\n\n    const width = imgCanvas.width\n    const height = imgCanvas.height\n    lastColorSelectPoint.value = point\n\n    const maskData = maskCtx.getImageData(0, 0, width, height)\n    const maskDataArray = maskData.data\n    const imageDataArray = imgCtx.getImageData(0, 0, width, height).data\n\n    const tolerance = store.colorSelectTolerance\n    const method = store.colorComparisonMethod\n    const maskColor = store.maskColor\n    const selectOpacity = Math.floor((store.selectionOpacity / 100) * 255)\n    const applyWholeImage = store.applyWholeImage\n    const maskBoundary = store.maskBoundary\n    const maskTolerance = store.maskTolerance\n\n    if (applyWholeImage) {\n      const targetPixel = getPixelColor(\n        imageDataArray,\n        Math.floor(point.x),\n        Math.floor(point.y),\n        width\n      )\n\n      const CHUNK_SIZE = 10000\n      for (let i = 0; i < width * height; i += CHUNK_SIZE) {\n        const endIndex = Math.min(i + CHUNK_SIZE, width * height)\n        for (let pixelIndex = i; pixelIndex < endIndex; pixelIndex++) {\n          const x = pixelIndex % width\n          const y = Math.floor(pixelIndex / width)\n          if (\n            isPixelInRange(\n              getPixelColor(imageDataArray, x, y, width),\n              targetPixel,\n              tolerance,\n              method\n            )\n          ) {\n            setPixel(maskDataArray, x, y, width, selectOpacity, maskColor)\n          }\n        }\n        await new Promise((resolve) => setTimeout(resolve, 0))\n      }\n    } else {\n      const startX = Math.floor(point.x)\n      const startY = Math.floor(point.y)\n\n      if (startX < 0 || startX >= width || startY < 0 || startY >= height) {\n        return\n      }\n\n      const targetPixel = getPixelColor(imageDataArray, startX, startY, width)\n      const stack: Array<[number, number]> = []\n      const visited = new Uint8Array(width * height)\n\n      stack.push([startX, startY])\n\n      while (stack.length > 0) {\n        const [x, y] = stack.pop()!\n        const visitedIndex = y * width + x\n\n        if (\n          visited[visitedIndex] ||\n          !isPixelInRange(\n            getPixelColor(imageDataArray, x, y, width),\n            targetPixel,\n            tolerance,\n            method\n          )\n        ) {\n          continue\n        }\n\n        visited[visitedIndex] = 1\n        setPixel(maskDataArray, x, y, width, selectOpacity, maskColor)\n\n        const checkNeighbor = (nx: number, ny: number) => {\n          if (nx < 0 || nx >= width || ny < 0 || ny >= height) return\n          if (visited[ny * width + nx]) return\n          if (\n            !isPixelInRange(\n              getPixelColor(imageDataArray, nx, ny, width),\n              targetPixel,\n              tolerance,\n              method\n            )\n          )\n            return\n          if (\n            maskBoundary &&\n            255 - getPixelAlpha(maskDataArray, nx, ny, width) <= maskTolerance\n          )\n            return\n\n          stack.push([nx, ny])\n        }\n\n        checkNeighbor(x - 1, y)\n        checkNeighbor(x + 1, y)\n        checkNeighbor(x, y - 1)\n        checkNeighbor(x, y + 1)\n      }\n    }\n\n    maskCtx.putImageData(maskData, 0, 0)\n    store.canvasHistory.saveState()\n  }\n\n  const invertMask = (): void => {\n    const ctx = store.maskCtx\n    const canvas = store.maskCanvas\n    if (!ctx || !canvas) return\n\n    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height)\n    const data = imageData.data\n\n    let maskR = 0,\n      maskG = 0,\n      maskB = 0\n    for (let i = 0; i < data.length; i += 4) {\n      if (data[i + 3] > 0) {\n        maskR = data[i]\n        maskG = data[i + 1]\n        maskB = data[i + 2]\n        break\n      }\n    }\n\n    for (let i = 0; i < data.length; i += 4) {\n      const alpha = data[i + 3]\n      data[i + 3] = 255 - alpha\n\n      if (alpha === 0) {\n        data[i] = maskR\n        data[i + 1] = maskG\n        data[i + 2] = maskB\n      }\n    }\n\n    ctx.putImageData(imageData, 0, 0)\n    store.canvasHistory.saveState()\n  }\n\n  const clearMask = (): void => {\n    const maskCtx = store.maskCtx\n    const maskCanvas = store.maskCanvas\n    const rgbCtx = store.rgbCtx\n    const rgbCanvas = store.rgbCanvas\n\n    if (maskCtx && maskCanvas) {\n      maskCtx.clearRect(0, 0, maskCanvas.width, maskCanvas.height)\n    }\n    if (rgbCtx && rgbCanvas) {\n      rgbCtx.clearRect(0, 0, rgbCanvas.width, rgbCanvas.height)\n    }\n    store.canvasHistory.saveState()\n  }\n\n  const clearLastColorSelectPoint = () => {\n    lastColorSelectPoint.value = null\n  }\n\n  watch(\n    [\n      () => store.colorSelectTolerance,\n      () => store.colorComparisonMethod,\n      () => store.selectionOpacity\n    ],\n    async () => {\n      if (\n        lastColorSelectPoint.value &&\n        store.colorSelectLivePreview &&\n        store.canUndo\n      ) {\n        store.canvasHistory.undo()\n        await colorSelectFill(lastColorSelectPoint.value)\n      }\n    }\n  )\n\n  return {\n    paintBucketFill,\n\n    colorSelectFill,\n    clearLastColorSelectPoint,\n\n    invertMask,\n    clearMask\n  }\n}\n","import { ref, watch } from 'vue'\nimport type {\n  Point,\n  ImageLayer,\n  ToolInternalSettings\n} from '@/extensions/core/maskeditor/types'\nimport { Tools } from '@/extensions/core/maskeditor/types'\nimport { useMaskEditorStore } from '@/stores/maskEditorStore'\nimport { useBrushDrawing } from './useBrushDrawing'\nimport { useCanvasTools } from './useCanvasTools'\nimport { useCoordinateTransform } from './useCoordinateTransform'\nimport type { useKeyboard } from './useKeyboard'\nimport type { usePanAndZoom } from './usePanAndZoom'\nimport { app } from '@/scripts/app'\n\nexport function useToolManager(\n  keyboard: ReturnType<typeof useKeyboard>,\n  panZoom: ReturnType<typeof usePanAndZoom>\n) {\n  const store = useMaskEditorStore()\n\n  const coordinateTransform = useCoordinateTransform()\n\n  const brushDrawing = useBrushDrawing({\n    useDominantAxis: app.extensionManager.setting.get(\n      'Comfy.MaskEditor.UseDominantAxis'\n    ),\n    brushAdjustmentSpeed: app.extensionManager.setting.get(\n      'Comfy.MaskEditor.BrushAdjustmentSpeed'\n    )\n  })\n  const canvasTools = useCanvasTools()\n\n  const mouseDownPoint = ref<Point | null>(null)\n\n  const toolSettings: Record<Tools, Partial<ToolInternalSettings>> = {\n    [Tools.MaskPen]: {\n      newActiveLayerOnSet: 'mask'\n    },\n    [Tools.Eraser]: {},\n    [Tools.PaintPen]: {\n      newActiveLayerOnSet: 'rgb'\n    },\n    [Tools.MaskBucket]: {\n      cursor: \"url('/cursor/paintBucket.png') 30 25, auto\",\n      newActiveLayerOnSet: 'mask'\n    },\n    [Tools.MaskColorFill]: {\n      cursor: \"url('/cursor/colorSelect.png') 15 25, auto\",\n      newActiveLayerOnSet: 'mask'\n    }\n  }\n\n  const setActiveLayer = (layer: ImageLayer) => {\n    store.activeLayer = layer\n    const currentTool = store.currentTool\n\n    const maskOnlyTools = [Tools.MaskPen, Tools.MaskBucket, Tools.MaskColorFill]\n    if (maskOnlyTools.includes(currentTool) && layer === 'rgb') {\n      switchTool(Tools.PaintPen)\n    }\n\n    if (currentTool === Tools.PaintPen && layer === 'mask') {\n      switchTool(Tools.MaskPen)\n    }\n  }\n\n  const switchTool = (tool: Tools) => {\n    store.currentTool = tool\n\n    const newActiveLayer = toolSettings[tool].newActiveLayerOnSet\n    if (newActiveLayer) {\n      store.activeLayer = newActiveLayer\n    }\n\n    const cursor = toolSettings[tool].cursor\n    const pointerZone = store.pointerZone\n\n    if (cursor && pointerZone) {\n      store.brushVisible = false\n      pointerZone.style.cursor = cursor\n    } else if (pointerZone) {\n      store.brushVisible = true\n      pointerZone.style.cursor = 'none'\n    }\n  }\n\n  const updateCursor = () => {\n    const currentTool = store.currentTool\n    const cursor = toolSettings[currentTool].cursor\n    const pointerZone = store.pointerZone\n\n    if (cursor && pointerZone) {\n      store.brushVisible = false\n      pointerZone.style.cursor = cursor\n    } else if (pointerZone) {\n      store.brushVisible = true\n      pointerZone.style.cursor = 'none'\n    }\n\n    store.brushPreviewGradientVisible = false\n  }\n\n  watch(\n    () => store.currentTool,\n    (newTool) => {\n      if (newTool !== Tools.MaskColorFill) {\n        canvasTools.clearLastColorSelectPoint()\n      }\n    }\n  )\n\n  const handlePointerDown = async (event: PointerEvent): Promise<void> => {\n    event.preventDefault()\n    if (event.pointerType === 'touch') return\n\n    const isSpacePressed = keyboard.isKeyDown(' ')\n\n    if (event.buttons === 4 || (event.buttons === 1 && isSpacePressed)) {\n      panZoom.handlePanStart(event)\n\n      store.brushVisible = false\n      return\n    }\n\n    if (store.currentTool === Tools.PaintPen && event.button === 0) {\n      await brushDrawing.startDrawing(event)\n\n      return\n    }\n\n    if (store.currentTool === Tools.PaintPen && event.buttons === 1) {\n      await brushDrawing.handleDrawing(event)\n      return\n    }\n\n    if (store.currentTool === Tools.MaskBucket && event.button === 0) {\n      const offset = { x: event.offsetX, y: event.offsetY }\n      const coords_canvas = coordinateTransform.screenToCanvas(offset)\n      canvasTools.paintBucketFill(coords_canvas)\n      return\n    }\n\n    if (store.currentTool === Tools.MaskColorFill && event.button === 0) {\n      const offset = { x: event.offsetX, y: event.offsetY }\n      const coords_canvas = coordinateTransform.screenToCanvas(offset)\n      await canvasTools.colorSelectFill(coords_canvas)\n      return\n    }\n\n    if (event.altKey && event.button === 2) {\n      store.isAdjustingBrush = true\n      await brushDrawing.startBrushAdjustment(event)\n      return\n    }\n\n    const isDrawingTool = [\n      Tools.MaskPen,\n      Tools.Eraser,\n      Tools.PaintPen\n    ].includes(store.currentTool)\n\n    if ([0, 2].includes(event.button) && isDrawingTool) {\n      await brushDrawing.startDrawing(event)\n      return\n    }\n  }\n\n  const handlePointerMove = async (event: PointerEvent): Promise<void> => {\n    event.preventDefault()\n    if (event.pointerType === 'touch') return\n\n    const newCursorPoint = { x: event.clientX, y: event.clientY }\n    panZoom.updateCursorPosition(newCursorPoint)\n\n    const isSpacePressed = keyboard.isKeyDown(' ')\n\n    if (event.buttons === 4 || (event.buttons === 1 && isSpacePressed)) {\n      await panZoom.handlePanMove(event)\n      return\n    }\n\n    const isDrawingTool = [\n      Tools.MaskPen,\n      Tools.Eraser,\n      Tools.PaintPen\n    ].includes(store.currentTool)\n    if (!isDrawingTool) return\n\n    if (\n      store.isAdjustingBrush &&\n      (store.currentTool === Tools.MaskPen ||\n        store.currentTool === Tools.Eraser) &&\n      event.altKey &&\n      event.buttons === 2\n    ) {\n      await brushDrawing.handleBrushAdjustment(event)\n      return\n    }\n\n    if (event.buttons === 1 || event.buttons === 2) {\n      await brushDrawing.handleDrawing(event)\n      return\n    }\n  }\n\n  const handlePointerUp = async (event: PointerEvent): Promise<void> => {\n    store.isPanning = false\n    store.brushVisible = true\n    if (event.pointerType === 'touch') return\n    updateCursor()\n    store.isAdjustingBrush = false\n    await brushDrawing.drawEnd(event)\n    mouseDownPoint.value = null\n  }\n\n  return {\n    switchTool,\n    setActiveLayer,\n    updateCursor,\n\n    handlePointerDown,\n    handlePointerMove,\n    handlePointerUp,\n\n    brushDrawing\n  }\n}\n","<template>\n  <div\n    id=\"maskEditor_brush\"\n    :style=\"{\n      position: 'absolute',\n      opacity: brushOpacity,\n      width: `${brushSize}px`,\n      height: `${brushSize}px`,\n      left: `${brushLeft}px`,\n      top: `${brushTop}px`,\n      borderRadius: borderRadius,\n      pointerEvents: 'none',\n      zIndex: 1000\n    }\"\n  >\n    <div\n      id=\"maskEditor_brushPreviewGradient\"\n      :style=\"{\n        display: gradientVisible ? 'block' : 'none',\n        background: gradientBackground\n      }\"\n    ></div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\n\nimport { BrushShape } from '@/extensions/core/maskeditor/types'\nimport { useMaskEditorStore } from '@/stores/maskEditorStore'\n\nconst { containerRef } = defineProps<{\n  containerRef?: HTMLElement\n}>()\n\nconst store = useMaskEditorStore()\n\nconst brushOpacity = computed(() => {\n  return store.brushVisible ? '1' : '0'\n})\n\nconst brushRadius = computed(() => {\n  return store.brushSettings.size * store.zoomRatio\n})\n\nconst brushSize = computed(() => {\n  return brushRadius.value * 2\n})\n\nconst brushLeft = computed(() => {\n  const dialogRect = containerRef?.getBoundingClientRect()\n  const dialogOffsetLeft = dialogRect?.left || 0\n  return (\n    store.cursorPoint.x +\n    store.panOffset.x -\n    brushRadius.value -\n    dialogOffsetLeft\n  )\n})\n\nconst brushTop = computed(() => {\n  const dialogRect = containerRef?.getBoundingClientRect()\n  const dialogOffsetTop = dialogRect?.top || 0\n  return (\n    store.cursorPoint.y +\n    store.panOffset.y -\n    brushRadius.value -\n    dialogOffsetTop\n  )\n})\n\nconst borderRadius = computed(() => {\n  return store.brushSettings.type === BrushShape.Rect ? '0%' : '50%'\n})\n\nconst gradientVisible = computed(() => {\n  return store.brushPreviewGradientVisible\n})\n\nconst gradientBackground = computed(() => {\n  const hardness = store.brushSettings.hardness\n\n  if (hardness === 1) {\n    return 'rgba(255, 0, 0, 0.5)'\n  }\n\n  const midStop = hardness * 100\n  const outerStop = 100\n\n  return `radial-gradient(\n    circle,\n    rgba(255, 0, 0, 0.5) 0%,\n    rgba(255, 0, 0, 0.25) ${midStop}%,\n    rgba(255, 0, 0, 0) ${outerStop}%\n  )`\n})\n</script>\n","<template>\n  <div\n    ref=\"pointerZoneRef\"\n    class=\"w-[calc(100%-4rem-220px)] h-full\"\n    @pointerdown=\"handlePointerDown\"\n    @pointermove=\"handlePointerMove\"\n    @pointerup=\"handlePointerUp\"\n    @pointerleave=\"handlePointerLeave\"\n    @pointerenter=\"handlePointerEnter\"\n    @touchstart=\"handleTouchStart\"\n    @touchmove=\"handleTouchMove\"\n    @touchend=\"handleTouchEnd\"\n    @wheel=\"handleWheel\"\n    @contextmenu.prevent\n  />\n</template>\n\n<script setup lang=\"ts\">\nimport { onMounted, ref, watch } from 'vue'\n\nimport type { usePanAndZoom } from '@/composables/maskeditor/usePanAndZoom'\nimport type { useToolManager } from '@/composables/maskeditor/useToolManager'\nimport { useMaskEditorStore } from '@/stores/maskEditorStore'\n\nconst { toolManager, panZoom } = defineProps<{\n  toolManager: ReturnType<typeof useToolManager>\n  panZoom: ReturnType<typeof usePanAndZoom>\n}>()\n\nconst store = useMaskEditorStore()\nconst pointerZoneRef = ref<HTMLDivElement>()\n\nonMounted(() => {\n  if (!pointerZoneRef.value) {\n    console.error('[PointerZone] Pointer zone ref not initialized')\n    return\n  }\n\n  store.pointerZone = pointerZoneRef.value\n})\n\nwatch(\n  () => store.isPanning,\n  (isPanning) => {\n    if (!pointerZoneRef.value) return\n\n    if (isPanning) {\n      pointerZoneRef.value.style.cursor = 'grabbing'\n    } else {\n      toolManager.updateCursor()\n    }\n  }\n)\n\nconst handlePointerDown = async (event: PointerEvent) => {\n  await toolManager.handlePointerDown(event)\n}\n\nconst handlePointerMove = async (event: PointerEvent) => {\n  await toolManager.handlePointerMove(event)\n}\n\nconst handlePointerUp = (event: PointerEvent) => {\n  void toolManager.handlePointerUp(event)\n}\n\nconst handlePointerLeave = () => {\n  store.brushVisible = false\n  if (pointerZoneRef.value) {\n    pointerZoneRef.value.style.cursor = ''\n  }\n}\n\nconst handlePointerEnter = () => {\n  toolManager.updateCursor()\n}\n\nconst handleTouchStart = (event: TouchEvent) => {\n  panZoom.handleTouchStart(event)\n}\n\nconst handleTouchMove = async (event: TouchEvent) => {\n  await panZoom.handleTouchMove(event)\n}\n\nconst handleTouchEnd = (event: TouchEvent) => {\n  panZoom.handleTouchEnd(event)\n}\n\nconst handleWheel = async (event: WheelEvent) => {\n  await panZoom.zoom(event)\n  const newCursorPoint = { x: event.clientX, y: event.clientY }\n  panZoom.updateCursorPosition(newCursorPoint)\n}\n</script>\n","<template>\n  <div class=\"flex flex-col gap-3 pb-3\">\n    <span class=\"text-left text-xs font-sans text-[var(--descrip-text)]\">{{\n      label\n    }}</span>\n    <input\n      type=\"range\"\n      class=\"maskEditor_sidePanelBrushRange\"\n      :min=\"min\"\n      :max=\"max\"\n      :step=\"step\"\n      :value=\"modelValue\"\n      @input=\"onInput\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\ninterface Props {\n  label: string\n  min: number\n  max: number\n  step?: number\n  modelValue: number\n}\n\nwithDefaults(defineProps<Props>(), {\n  step: 1\n})\n\nconst emit = defineEmits<{\n  'update:modelValue': [value: number]\n}>()\n\nconst onInput = (event: Event) => {\n  const value = Number((event.target as HTMLInputElement).value)\n  emit('update:modelValue', value)\n}\n</script>\n","<template>\n  <div class=\"flex flex-col gap-3 pb-3\">\n    <h3\n      class=\"text-center text-[15px] font-sans text-[var(--descrip-text)] mt-2.5\"\n    >\n      {{ t('maskEditor.layers') }}\n    </h3>\n\n    <SliderControl\n      :label=\"t('maskEditor.maskOpacity')\"\n      :min=\"0\"\n      :max=\"1\"\n      :step=\"0.01\"\n      :model-value=\"store.maskOpacity\"\n      @update:model-value=\"onMaskOpacityChange\"\n    />\n\n    <span class=\"text-left text-xs font-sans text-[var(--descrip-text)]\">{{\n      t('maskEditor.maskBlendingOptions')\n    }}</span>\n\n    <div\n      class=\"flex flex-row gap-2.5 items-center min-h-6 relative h-[50px] w-full rounded-[10px] -mt-2 -mb-1.5\"\n    >\n      <select\n        class=\"maskEditor_sidePanelDropdown\"\n        :value=\"store.maskBlendMode\"\n        @change=\"onBlendModeChange\"\n      >\n        <option value=\"black\">{{ t('maskEditor.black') }}</option>\n        <option value=\"white\">{{ t('maskEditor.white') }}</option>\n        <option value=\"negative\">{{ t('maskEditor.negative') }}</option>\n      </select>\n    </div>\n\n    <span class=\"text-left text-xs font-sans text-[var(--descrip-text)]\">{{\n      t('maskEditor.maskLayer')\n    }}</span>\n    <div\n      class=\"flex flex-row gap-2.5 items-center min-h-6 relative h-[50px] w-full rounded-[10px] bg-secondary-background-hover\"\n      :style=\"{\n        border: store.activeLayer === 'mask' ? '2px solid #007acc' : 'none'\n      }\"\n    >\n      <input\n        type=\"checkbox\"\n        class=\"maskEditor_sidePanelLayerCheckbox\"\n        :checked=\"maskLayerVisible\"\n        @change=\"onMaskLayerVisibilityChange\"\n      />\n      <div class=\"maskEditor_sidePanelLayerPreviewContainer\">\n        <svg viewBox=\"0 0 20 20\" style=\"\">\n          <path\n            class=\"cls-1\"\n            d=\"M1.31,5.32v9.36c0,.55.45,1,1,1h15.38c.55,0,1-.45,1-1V5.32c0-.55-.45-1-1-1H2.31c-.55,0-1,.45-1,1ZM11.19,13.44c-2.91.94-5.57-1.72-4.63-4.63.34-1.05,1.19-1.9,2.24-2.24,2.91-.94,5.57,1.72,4.63,4.63-.34,1.05-1.19-1.9-2.24,2.24Z\"\n          />\n        </svg>\n      </div>\n      <button\n        style=\"font-size: 12px\"\n        :style=\"{ opacity: store.activeLayer === 'mask' ? '0.5' : '1' }\"\n        :disabled=\"store.activeLayer === 'mask'\"\n        @click=\"setActiveLayer('mask')\"\n      >\n        {{ t('maskEditor.activateLayer') }}\n      </button>\n    </div>\n\n    <span class=\"text-left text-xs font-sans text-[var(--descrip-text)]\">{{\n      t('maskEditor.paintLayer')\n    }}</span>\n    <div\n      class=\"flex flex-row gap-2.5 items-center min-h-6 relative h-[50px] w-full rounded-[10px] bg-secondary-background-hover\"\n      :style=\"{\n        border: store.activeLayer === 'rgb' ? '2px solid #007acc' : 'none'\n      }\"\n    >\n      <input\n        type=\"checkbox\"\n        class=\"maskEditor_sidePanelLayerCheckbox\"\n        :checked=\"paintLayerVisible\"\n        @change=\"onPaintLayerVisibilityChange\"\n      />\n      <div class=\"maskEditor_sidePanelLayerPreviewContainer\">\n        <svg viewBox=\"0 0 20 20\">\n          <path\n            class=\"cls-1\"\n            d=\"M 17 6.965 c 0 0.235 -0.095 0.47 -0.275 0.655 l -6.51 6.52 c -0.045 0.035 -0.09 0.075 -0.135 0.11 c -0.035 -0.695 -0.605 -1.24 -1.305 -1.245 c 0.035 -0.06 0.08 -0.12 0.135 -0.17 l 6.52 -6.52 c 0.36 -0.36 0.945 -0.36 1.3 0 c 0.175 0.175 0.275 0.415 0.275 0.65 Z\"\n          />\n          <path\n            class=\"cls-1\"\n            d=\"M 9.82 14.515 c 0 2.23 -3.23 1.59 -4.82 0 c 1.65 -0.235 2.375 -1.29 3.53 -1.29 c 0.715 0 1.29 0.58 1.29 1.29 Z\"\n          />\n        </svg>\n      </div>\n      <button\n        style=\"font-size: 12px\"\n        :style=\"{\n          opacity: store.activeLayer === 'rgb' ? '0.5' : '1',\n          display: showLayerButtons ? 'block' : 'none'\n        }\"\n        :disabled=\"store.activeLayer === 'rgb'\"\n        @click=\"setActiveLayer('rgb')\"\n      >\n        {{ t('maskEditor.activateLayer') }}\n      </button>\n    </div>\n\n    <span class=\"text-left text-xs font-sans text-[var(--descrip-text)]\">{{\n      t('maskEditor.baseImageLayer')\n    }}</span>\n    <div\n      class=\"flex flex-row gap-2.5 items-center min-h-6 relative h-[50px] w-full rounded-[10px] bg-secondary-background-hover\"\n    >\n      <input\n        type=\"checkbox\"\n        class=\"maskEditor_sidePanelLayerCheckbox\"\n        :checked=\"baseImageLayerVisible\"\n        @change=\"onBaseImageLayerVisibilityChange\"\n      />\n      <div class=\"maskEditor_sidePanelLayerPreviewContainer\">\n        <img\n          class=\"maskEditor_sidePanelImageLayerImage\"\n          :src=\"baseImageSrc\"\n          :alt=\"t('maskEditor.baseLayerPreview')\"\n        />\n      </div>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, ref } from 'vue'\n\nimport { useCanvasManager } from '@/composables/maskeditor/useCanvasManager'\nimport type { useToolManager } from '@/composables/maskeditor/useToolManager'\nimport type { ImageLayer } from '@/extensions/core/maskeditor/types'\nimport { MaskBlendMode, Tools } from '@/extensions/core/maskeditor/types'\nimport { t } from '@/i18n'\nimport { useMaskEditorStore } from '@/stores/maskEditorStore'\n\nimport SliderControl from './controls/SliderControl.vue'\n\nconst { toolManager } = defineProps<{\n  toolManager?: ReturnType<typeof useToolManager>\n}>()\n\nconst store = useMaskEditorStore()\nconst canvasManager = useCanvasManager()\n\nconst maskLayerVisible = ref(true)\nconst paintLayerVisible = ref(true)\nconst baseImageLayerVisible = ref(true)\n\nconst baseImageSrc = computed(() => {\n  return store.image?.src ?? ''\n})\n\nconst showLayerButtons = computed(() => {\n  return store.currentTool === Tools.Eraser\n})\n\nconst onMaskLayerVisibilityChange = (event: Event) => {\n  const checked = (event.target as HTMLInputElement).checked\n  maskLayerVisible.value = checked\n\n  const maskCanvas = store.maskCanvas\n  if (maskCanvas) {\n    maskCanvas.style.opacity = checked ? String(store.maskOpacity) : '0'\n  }\n}\n\nconst onPaintLayerVisibilityChange = (event: Event) => {\n  const checked = (event.target as HTMLInputElement).checked\n  paintLayerVisible.value = checked\n\n  const rgbCanvas = store.rgbCanvas\n  if (rgbCanvas) {\n    rgbCanvas.style.opacity = checked ? '1' : '0'\n  }\n}\n\nconst onBaseImageLayerVisibilityChange = (event: Event) => {\n  const checked = (event.target as HTMLInputElement).checked\n  baseImageLayerVisible.value = checked\n\n  const imgCanvas = store.imgCanvas\n  if (imgCanvas) {\n    imgCanvas.style.opacity = checked ? '1' : '0'\n  }\n}\n\nconst onMaskOpacityChange = (value: number) => {\n  store.setMaskOpacity(value)\n\n  const maskCanvas = store.maskCanvas\n  if (maskCanvas) {\n    maskCanvas.style.opacity = String(value)\n  }\n\n  maskLayerVisible.value = value !== 0\n}\n\nconst onBlendModeChange = async (event: Event) => {\n  const value = (event.target as HTMLSelectElement).value\n  let blendMode: MaskBlendMode\n\n  switch (value) {\n    case 'white':\n      blendMode = MaskBlendMode.White\n      break\n    case 'negative':\n      blendMode = MaskBlendMode.Negative\n      break\n    default:\n      blendMode = MaskBlendMode.Black\n  }\n\n  store.maskBlendMode = blendMode\n\n  await canvasManager.updateMaskColor()\n}\n\nconst setActiveLayer = (layer: ImageLayer) => {\n  toolManager?.setActiveLayer(layer)\n}\n</script>\n","<template>\n  <div class=\"flex flex-col gap-3 pb-3\">\n    <h3\n      class=\"text-center text-[15px] font-sans text-[var(--descrip-text)] mt-2.5\"\n    >\n      {{ t('maskEditor.brushSettings') }}\n    </h3>\n\n    <button\n      class=\"w-45 h-7.5 border-none bg-black/20 border border-[var(--border-color)] text-[var(--input-text)] font-sans text-[15px] pointer-events-auto transition-colors duration-100 hover:bg-[var(--p-overlaybadge-outline-color)] hover:border-none\"\n      @click=\"resetToDefault\"\n    >\n      {{ t('maskEditor.resetToDefault') }}\n    </button>\n\n    <div class=\"flex flex-col gap-3 pb-3\">\n      <span class=\"text-left text-xs font-sans text-[var(--descrip-text)]\">{{\n        t('maskEditor.brushShape')\n      }}</span>\n      <div\n        class=\"flex flex-row gap-2.5 items-center min-h-6 relative h-[50px] w-full rounded-[10px] bg-secondary-background-hover\"\n      >\n        <div\n          class=\"maskEditor_sidePanelBrushShapeCircle bg-transparent hover:bg-comfy-menu-bg\"\n          :class=\"{ active: store.brushSettings.type === BrushShape.Arc }\"\n          :style=\"{\n            background:\n              store.brushSettings.type === BrushShape.Arc\n                ? 'var(--p-button-text-primary-color)'\n                : ''\n          }\"\n          @click=\"setBrushShape(BrushShape.Arc)\"\n        ></div>\n        <div\n          class=\"maskEditor_sidePanelBrushShapeSquare bg-transparent hover:bg-comfy-menu-bg\"\n          :class=\"{ active: store.brushSettings.type === BrushShape.Rect }\"\n          :style=\"{\n            background:\n              store.brushSettings.type === BrushShape.Rect\n                ? 'var(--p-button-text-primary-color)'\n                : ''\n          }\"\n          @click=\"setBrushShape(BrushShape.Rect)\"\n        ></div>\n      </div>\n    </div>\n\n    <div class=\"flex flex-col gap-3 pb-3\">\n      <span class=\"text-left text-xs font-sans text-[var(--descrip-text)]\">{{\n        t('maskEditor.colorSelector')\n      }}</span>\n      <input type=\"color\" :value=\"store.rgbColor\" @input=\"onColorChange\" />\n    </div>\n\n    <SliderControl\n      :label=\"t('maskEditor.thickness')\"\n      :min=\"1\"\n      :max=\"100\"\n      :step=\"1\"\n      :model-value=\"store.brushSettings.size\"\n      @update:model-value=\"onThicknessChange\"\n    />\n\n    <SliderControl\n      :label=\"t('maskEditor.opacity')\"\n      :min=\"0\"\n      :max=\"1\"\n      :step=\"0.01\"\n      :model-value=\"store.brushSettings.opacity\"\n      @update:model-value=\"onOpacityChange\"\n    />\n\n    <SliderControl\n      :label=\"t('maskEditor.hardness')\"\n      :min=\"0\"\n      :max=\"1\"\n      :step=\"0.01\"\n      :model-value=\"store.brushSettings.hardness\"\n      @update:model-value=\"onHardnessChange\"\n    />\n\n    <SliderControl\n      :label=\"t('maskEditor.smoothingPrecision')\"\n      :min=\"1\"\n      :max=\"100\"\n      :step=\"1\"\n      :model-value=\"store.brushSettings.smoothingPrecision\"\n      @update:model-value=\"onSmoothingPrecisionChange\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { BrushShape } from '@/extensions/core/maskeditor/types'\nimport { t } from '@/i18n'\nimport { useMaskEditorStore } from '@/stores/maskEditorStore'\n\nimport SliderControl from './controls/SliderControl.vue'\n\nconst store = useMaskEditorStore()\n\nconst setBrushShape = (shape: BrushShape) => {\n  store.brushSettings.type = shape\n}\n\nconst onColorChange = (event: Event) => {\n  store.rgbColor = (event.target as HTMLInputElement).value\n}\n\nconst onThicknessChange = (value: number) => {\n  store.setBrushSize(value)\n}\n\nconst onOpacityChange = (value: number) => {\n  store.setBrushOpacity(value)\n}\n\nconst onHardnessChange = (value: number) => {\n  store.setBrushHardness(value)\n}\n\nconst onSmoothingPrecisionChange = (value: number) => {\n  store.setBrushSmoothingPrecision(value)\n}\n\nconst resetToDefault = () => {\n  store.resetBrushToDefault()\n}\n</script>\n","<template>\n  <div class=\"flex flex-row gap-2.5 items-center min-h-6 relative\">\n    <span class=\"text-left text-xs font-sans text-[var(--descrip-text)]\">{{\n      label\n    }}</span>\n    <select\n      class=\"absolute right-0 h-6 px-1.5 rounded-md border border-border-default transition-colors duration-100 bg-secondary-background focus:outline focus:outline-node-component-border\"\n      :value=\"modelValue\"\n      @change=\"onChange\"\n    >\n      <option\n        v-for=\"option in normalizedOptions\"\n        :key=\"option.value\"\n        :value=\"option.value\"\n      >\n        {{ option.label }}\n      </option>\n    </select>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\n\ninterface DropdownOption {\n  label: string\n  value: string | number\n}\n\ninterface Props {\n  label: string\n  options: string[] | DropdownOption[]\n  modelValue: string | number\n}\n\nconst props = defineProps<Props>()\n\nconst emit = defineEmits<{\n  'update:modelValue': [value: string | number]\n}>()\n\nconst normalizedOptions = computed((): DropdownOption[] => {\n  return props.options.map((option) => {\n    if (typeof option === 'string') {\n      return { label: option, value: option }\n    }\n    return option\n  })\n})\n\nconst onChange = (event: Event) => {\n  const value = (event.target as HTMLSelectElement).value\n  emit('update:modelValue', value)\n}\n</script>\n","<template>\n  <div class=\"flex flex-row gap-2.5 items-center min-h-6 relative\">\n    <span class=\"text-left text-xs font-sans text-[var(--descrip-text)]\">{{\n      label\n    }}</span>\n    <label class=\"maskEditor_sidePanelToggleContainer\">\n      <input\n        type=\"checkbox\"\n        class=\"maskEditor_sidePanelToggleCheckbox\"\n        :checked=\"modelValue\"\n        @change=\"onChange\"\n      />\n      <div class=\"maskEditor_sidePanelToggleSwitch\"></div>\n    </label>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\ninterface Props {\n  label: string\n  modelValue: boolean\n}\n\ndefineProps<Props>()\n\nconst emit = defineEmits<{\n  'update:modelValue': [value: boolean]\n}>()\n\nconst onChange = (event: Event) => {\n  const checked = (event.target as HTMLInputElement).checked\n  emit('update:modelValue', checked)\n}\n</script>\n","<template>\n  <div class=\"flex flex-col gap-3 pb-3\">\n    <h3\n      class=\"text-center text-[15px] font-sans text-[var(--descrip-text)] mt-2.5\"\n    >\n      {{ t('maskEditor.colorSelectSettings') }}\n    </h3>\n\n    <SliderControl\n      :label=\"t('maskEditor.tolerance')\"\n      :min=\"0\"\n      :max=\"255\"\n      :step=\"1\"\n      :model-value=\"store.colorSelectTolerance\"\n      @update:model-value=\"onToleranceChange\"\n    />\n\n    <SliderControl\n      :label=\"t('maskEditor.selectionOpacity')\"\n      :min=\"0\"\n      :max=\"100\"\n      :step=\"1\"\n      :model-value=\"store.selectionOpacity\"\n      @update:model-value=\"onSelectionOpacityChange\"\n    />\n\n    <ToggleControl\n      :label=\"t('maskEditor.livePreview')\"\n      :model-value=\"store.colorSelectLivePreview\"\n      @update:model-value=\"onLivePreviewChange\"\n    />\n\n    <ToggleControl\n      :label=\"t('maskEditor.applyToWholeImage')\"\n      :model-value=\"store.applyWholeImage\"\n      @update:model-value=\"onWholeImageChange\"\n    />\n\n    <DropdownControl\n      :label=\"t('maskEditor.method')\"\n      :options=\"methodOptions\"\n      :model-value=\"store.colorComparisonMethod\"\n      @update:model-value=\"onMethodChange\"\n    />\n\n    <ToggleControl\n      :label=\"t('maskEditor.stopAtMask')\"\n      :model-value=\"store.maskBoundary\"\n      @update:model-value=\"onMaskBoundaryChange\"\n    />\n\n    <SliderControl\n      :label=\"t('maskEditor.maskTolerance')\"\n      :min=\"0\"\n      :max=\"255\"\n      :step=\"1\"\n      :model-value=\"store.maskTolerance\"\n      @update:model-value=\"onMaskToleranceChange\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { ColorComparisonMethod } from '@/extensions/core/maskeditor/types'\nimport { t } from '@/i18n'\nimport { useMaskEditorStore } from '@/stores/maskEditorStore'\n\nimport DropdownControl from './controls/DropdownControl.vue'\nimport SliderControl from './controls/SliderControl.vue'\nimport ToggleControl from './controls/ToggleControl.vue'\n\nconst store = useMaskEditorStore()\n\nconst methodOptions = Object.values(ColorComparisonMethod)\n\nconst onToleranceChange = (value: number) => {\n  store.setColorSelectTolerance(value)\n}\n\nconst onSelectionOpacityChange = (value: number) => {\n  store.setSelectionOpacity(value)\n}\n\nconst onLivePreviewChange = (value: boolean) => {\n  store.colorSelectLivePreview = value\n}\n\nconst onWholeImageChange = (value: boolean) => {\n  store.applyWholeImage = value\n}\n\nconst onMethodChange = (value: string | number) => {\n  store.colorComparisonMethod = value as ColorComparisonMethod\n}\n\nconst onMaskBoundaryChange = (value: boolean) => {\n  store.maskBoundary = value\n}\n\nconst onMaskToleranceChange = (value: number) => {\n  store.setMaskTolerance(value)\n}\n</script>\n","<template>\n  <div class=\"flex flex-col gap-3 pb-3\">\n    <h3\n      class=\"text-center text-[15px] font-sans text-[var(--descrip-text)] mt-2.5\"\n    >\n      {{ t('maskEditor.paintBucketSettings') }}\n    </h3>\n\n    <SliderControl\n      :label=\"t('maskEditor.tolerance')\"\n      :min=\"0\"\n      :max=\"255\"\n      :step=\"1\"\n      :model-value=\"store.paintBucketTolerance\"\n      @update:model-value=\"onToleranceChange\"\n    />\n\n    <SliderControl\n      :label=\"t('maskEditor.fillOpacity')\"\n      :min=\"0\"\n      :max=\"100\"\n      :step=\"1\"\n      :model-value=\"store.fillOpacity\"\n      @update:model-value=\"onFillOpacityChange\"\n    />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { t } from '@/i18n'\nimport { useMaskEditorStore } from '@/stores/maskEditorStore'\n\nimport SliderControl from './controls/SliderControl.vue'\n\nconst store = useMaskEditorStore()\n\nconst onToleranceChange = (value: number) => {\n  store.setPaintBucketTolerance(value)\n}\n\nconst onFillOpacityChange = (value: number) => {\n  store.setFillOpacity(value)\n}\n</script>\n","<template>\n  <div class=\"maskEditor_sidePanel\">\n    <div class=\"maskEditor_sidePanelContainer\">\n      <component :is=\"currentPanelComponent\" />\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\nimport type { Component } from 'vue'\n\nimport { Tools } from '@/extensions/core/maskeditor/types'\nimport { useMaskEditorStore } from '@/stores/maskEditorStore'\n\nimport BrushSettingsPanel from './BrushSettingsPanel.vue'\nimport ColorSelectSettingsPanel from './ColorSelectSettingsPanel.vue'\nimport PaintBucketSettingsPanel from './PaintBucketSettingsPanel.vue'\n\nconst currentPanelComponent = computed<Component>(() => {\n  const tool = useMaskEditorStore().currentTool\n\n  if (tool === Tools.MaskBucket) {\n    return PaintBucketSettingsPanel\n  } else if (tool === Tools.MaskColorFill) {\n    return ColorSelectSettingsPanel\n  } else {\n    return BrushSettingsPanel\n  }\n})\n</script>\n","import { Tools } from './types'\n\nexport const iconsHtml: Record<Tools, string> = {\n  [Tools.MaskPen]: `\n    <svg viewBox=\"0 0 44 44\">\n      <path class=\"cls-1\" d=\"M10.97,15.98v14.04c0,.825.675,1.5,1.5,1.5h23.07c.825,0,1.5-.675,1.5-1.5V15.98c0-.825-.675-1.5-1.5-1.5H12.47c-.825,0-1.5.675-1.5,1.5ZM25.79,28.16c-4.365,1.41-8.355-2.58-6.945-6.945.51-1.575,1.785-2.85,3.36-3.36,4.365-1.41,8.355,2.58,6.945,6.945-.51,1.575-1.785,2.85-3.36,3.36Z\"/>\n    </svg>\n  `,\n  [Tools.Eraser]: `\n    <svg viewBox=\"0 0 44 44\">\n      <g>\n        <rect class=\"cls-2\" x=\"16.68\" y=\"10\" width=\"10.63\" height=\"24\" rx=\"1.16\" ry=\"1.16\" transform=\"translate(22 -9.11) rotate(45)\"/>\n        <path class=\"cls-1\" d=\"M17.27,34.27c-.42,0-.85-.16-1.17-.48l-5.88-5.88c-.31-.31-.48-.73-.48-1.17s.17-.86.48-1.17l15.34-15.34c.62-.62,1.72-.62,2.34,0l5.88,5.88c.65.65.65,1.7,0,2.34l-15.34,15.34c-.32.32-.75.48-1.17.48ZM26.73,10.73c-.18,0-.34.07-.46.19l-15.34,15.34c-.12.12-.19.29-.19.46s.07.34.19.46l5.88,5.88c.26.26.67.26.93,0l15.34-15.34c.26-.26.26-.67,0-.93l-5.88-5.88c-.12-.12-.29-.19-.46-.19Z\"/>\n      </g>\n      <path class=\"cls-3\" d=\"M20.33,11.03h8.32c.64,0,1.16.52,1.16,1.16v15.79h-10.63v-15.79c0-.64.52-1.16,1.16-1.16Z\" transform=\"translate(20.97 -11.61) rotate(45)\"/>\n    </svg>\n  `,\n  [Tools.MaskBucket]: `\n    <svg viewBox=\"0 0 44 44\">\n      <path class=\"cls-1\" d=\"M33.4,21.76l-11.42,11.41-.04.05c-.61.61-1.6.61-2.21,0l-8.91-8.91c-.61-.61-.61-1.6,0-2.21l.04-.05.3-.29h22.24Z\"/>\n      <path class=\"cls-1\" d=\"M20.83,34.17c-.55,0-1.07-.21-1.46-.6l-8.91-8.91c-.8-.8-.8-2.11,0-2.92l11.31-11.31c.8-.8,2.11-.8,2.92,0l8.91,8.91c.39.39.6.91.6,1.46s-.21,1.07-.6,1.46l-11.31,11.31c-.39.39-.91.6-1.46.6ZM23.24,10.83c-.27,0-.54.1-.75.31l-11.31,11.31c-.41.41-.41,1.09,0,1.5l8.91,8.91c.4.4,1.1.4,1.5,0l11.31-11.31c.2-.2.31-.47.31-.75s-.11-.55-.31-.75l-8.91-8.91c-.21-.21-.48-.31-.75-.31Z\"/>\n      <path class=\"cls-1\" d=\"M34.28,26.85c0,.84-.68,1.52-1.52,1.52s-1.52-.68-1.52-1.52,1.52-2.86,1.52-2.86c0,0,1.52,2.02,1.52,2.86Z\"/>\n    </svg>\n  `,\n  [Tools.MaskColorFill]: `\n    <svg viewBox=\"0 0 44 44\">\n      <path class=\"cls-1\" d=\"M30.29,13.72c-1.09-1.1-2.85-1.09-3.94,0l-2.88,2.88-.75-.75c-.2-.19-.51-.19-.71,0-.19.2-.19.51,0,.71l1.4,1.4-9.59,9.59c-.35.36-.54.82-.54,1.32,0,.14,0,.28.05.41-.05.04-.1.08-.15.13-.39.39-.39,1.01,0,1.4.38.39,1.01.39,1.4,0,.04-.04.08-.09.11-.13.14.04.3.06.45.06.5,0,.97-.19,1.32-.55l9.59-9.59,1.38,1.38c.1.09.22.14.35.14s.26-.05.35-.14c.2-.2.2-.52,0-.71l-.71-.72,2.88-2.89c1.08-1.08,1.08-2.85-.01-3.94ZM19.43,25.82h-2.46l7.15-7.15,1.23,1.23-5.92,5.92Z\"/>\n    </svg>\n  `,\n  [Tools.PaintPen]: `\n    <svg viewBox=\"0 0 44 44\">\n      <path class=\"cls-1\" d=\"M34,13.93c0,.47-.19.94-.55,1.31l-13.02,13.04c-.09.07-.18.15-.27.22-.07-1.39-1.21-2.48-2.61-2.49.07-.12.16-.24.27-.34l13.04-13.04c.72-.72,1.89-.72,2.6,0,.35.35.55.83.55,1.3Z\"/>\n      <path class=\"cls-1\" d=\"M19.64,29.03c0,4.46-6.46,3.18-9.64,0,3.3-.47,4.75-2.58,7.06-2.58,1.43,0,2.58,1.16,2.58,2.58Z\"/>\n    </svg>\n  `\n}\n","<template>\n  <div class=\"h-full z-[8888] flex flex-col justify-between bg-comfy-menu-bg\">\n    <div class=\"flex flex-col\">\n      <div\n        v-for=\"tool in allTools\"\n        :key=\"tool\"\n        :class=\"[\n          'maskEditor_toolPanelContainer hover:bg-secondary-background-hover',\n          { maskEditor_toolPanelContainerSelected: currentTool === tool }\n        ]\"\n        @click=\"onToolSelect(tool)\"\n      >\n        <div\n          class=\"flex items-center justify-center\"\n          v-html=\"iconsHtml[tool]\"\n        ></div>\n        <div class=\"maskEditor_toolPanelIndicator\"></div>\n      </div>\n    </div>\n\n    <div\n      class=\"flex flex-col items-center cursor-pointer rounded-md mb-2 transition-colors duration-200 hover:bg-secondary-background-hover\"\n      :title=\"t('maskEditor.clickToResetZoom')\"\n      @click=\"onResetZoom\"\n    >\n      <span class=\"text-sm text-text-secondary\">{{ zoomText }}</span>\n      <span class=\"text-xs text-text-secondary\">{{ dimensionsText }}</span>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed } from 'vue'\n\nimport type { useToolManager } from '@/composables/maskeditor/useToolManager'\nimport { iconsHtml } from '@/extensions/core/maskeditor/constants'\nimport type { Tools } from '@/extensions/core/maskeditor/types'\nimport { allTools } from '@/extensions/core/maskeditor/types'\nimport { t } from '@/i18n'\nimport { useMaskEditorStore } from '@/stores/maskEditorStore'\n\nconst { toolManager } = defineProps<{\n  toolManager: ReturnType<typeof useToolManager>\n}>()\n\nconst store = useMaskEditorStore()\n\nconst onToolSelect = (tool: Tools) => {\n  toolManager.switchTool(tool)\n}\n\nconst currentTool = computed(() => store.currentTool)\n\nconst zoomText = computed(() => `${Math.round(store.displayZoomRatio * 100)}%`)\nconst dimensionsText = computed(() => {\n  const img = store.image\n  return img ? `${img.width}x${img.height}` : ' '\n})\n\nconst onResetZoom = () => {\n  store.resetZoom()\n}\n</script>\n","<template>\n  <div\n    ref=\"containerRef\"\n    class=\"maskEditor-dialog-root flex h-full w-full flex-col\"\n    @contextmenu.prevent\n    @dragstart=\"handleDragStart\"\n  >\n    <div\n      id=\"maskEditorCanvasContainer\"\n      ref=\"canvasContainerRef\"\n      @contextmenu.prevent\n    >\n      <canvas\n        ref=\"imgCanvasRef\"\n        class=\"absolute top-0 left-0 w-full h-full\"\n        @contextmenu.prevent\n      />\n      <canvas\n        ref=\"rgbCanvasRef\"\n        class=\"absolute top-0 left-0 w-full h-full\"\n        @contextmenu.prevent\n      />\n      <canvas\n        ref=\"maskCanvasRef\"\n        class=\"absolute top-0 left-0 w-full h-full\"\n        @contextmenu.prevent\n      />\n      <div ref=\"canvasBackgroundRef\" class=\"bg-white w-full h-full\" />\n    </div>\n\n    <div class=\"maskEditor-ui-container flex min-h-0 flex-1 flex-col\">\n      <div class=\"flex min-h-0 flex-1 overflow-hidden\">\n        <ToolPanel\n          v-if=\"initialized\"\n          ref=\"toolPanelRef\"\n          :tool-manager=\"toolManager!\"\n        />\n\n        <PointerZone\n          v-if=\"initialized\"\n          :tool-manager=\"toolManager!\"\n          :pan-zoom=\"panZoom!\"\n        />\n\n        <SidePanel\n          v-if=\"initialized\"\n          ref=\"sidePanelRef\"\n          :tool-manager=\"toolManager!\"\n        />\n      </div>\n    </div>\n\n    <BrushCursor v-if=\"initialized\" :container-ref=\"containerRef\" />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { onBeforeUnmount, onMounted, ref } from 'vue'\n\nimport { useImageLoader } from '@/composables/maskeditor/useImageLoader'\nimport { useKeyboard } from '@/composables/maskeditor/useKeyboard'\nimport { useMaskEditorLoader } from '@/composables/maskeditor/useMaskEditorLoader'\nimport { usePanAndZoom } from '@/composables/maskeditor/usePanAndZoom'\nimport { useToolManager } from '@/composables/maskeditor/useToolManager'\nimport type { LGraphNode } from '@/lib/litegraph/src/litegraph'\nimport { useDialogStore } from '@/stores/dialogStore'\nimport { useMaskEditorDataStore } from '@/stores/maskEditorDataStore'\nimport { useMaskEditorStore } from '@/stores/maskEditorStore'\n\nimport BrushCursor from './BrushCursor.vue'\nimport PointerZone from './PointerZone.vue'\nimport SidePanel from './SidePanel.vue'\nimport ToolPanel from './ToolPanel.vue'\n\nconst { node } = defineProps<{\n  node: LGraphNode\n}>()\n\nconst store = useMaskEditorStore()\nconst dataStore = useMaskEditorDataStore()\nconst dialogStore = useDialogStore()\n\nconst loader = useMaskEditorLoader()\n\nconst containerRef = ref<HTMLElement>()\nconst canvasContainerRef = ref<HTMLDivElement>()\nconst imgCanvasRef = ref<HTMLCanvasElement>()\nconst maskCanvasRef = ref<HTMLCanvasElement>()\nconst rgbCanvasRef = ref<HTMLCanvasElement>()\nconst canvasBackgroundRef = ref<HTMLDivElement>()\n\nconst toolPanelRef = ref<InstanceType<typeof ToolPanel>>()\nconst sidePanelRef = ref<InstanceType<typeof SidePanel>>()\n\nconst initialized = ref(false)\n\nconst keyboard = useKeyboard()\nconst panZoom = usePanAndZoom()\n\nlet toolManager: ReturnType<typeof useToolManager> | null = null\n\nlet resizeObserver: ResizeObserver | null = null\n\nconst handleDragStart = (event: DragEvent) => {\n  if (event.ctrlKey) {\n    event.preventDefault()\n  }\n}\n\nconst initUI = async () => {\n  if (!containerRef.value) {\n    console.error(\n      '[MaskEditorContent] Cannot initialize - missing required refs'\n    )\n    return\n  }\n\n  if (\n    !imgCanvasRef.value ||\n    !maskCanvasRef.value ||\n    !rgbCanvasRef.value ||\n    !canvasContainerRef.value ||\n    !canvasBackgroundRef.value\n  ) {\n    console.error('[MaskEditorContent] Cannot initialize - missing canvas refs')\n    return\n  }\n\n  store.maskCanvas = maskCanvasRef.value\n  store.rgbCanvas = rgbCanvasRef.value\n  store.imgCanvas = imgCanvasRef.value\n  store.canvasContainer = canvasContainerRef.value\n  store.canvasBackground = canvasBackgroundRef.value\n\n  try {\n    await loader.loadFromNode(node)\n\n    toolManager = useToolManager(keyboard, panZoom)\n\n    const imageLoader = useImageLoader()\n    const image = await imageLoader.loadImages()\n\n    await panZoom.initializeCanvasPanZoom(\n      image,\n      containerRef.value,\n      toolPanelRef.value?.$el as HTMLElement | undefined,\n      sidePanelRef.value?.$el as HTMLElement | undefined\n    )\n\n    store.canvasHistory.saveInitialState()\n\n    initialized.value = true\n  } catch (error) {\n    console.error('[MaskEditorContent] Initialization failed:', error)\n    dialogStore.closeDialog()\n  }\n}\n\nonMounted(() => {\n  keyboard.addListeners()\n\n  if (containerRef.value) {\n    resizeObserver = new ResizeObserver(async () => {\n      if (panZoom) {\n        await panZoom.invalidatePanZoom()\n      }\n    })\n    resizeObserver.observe(containerRef.value)\n  }\n\n  void initUI()\n})\n\nonBeforeUnmount(() => {\n  toolManager?.brushDrawing.saveBrushSettings()\n\n  keyboard?.removeListeners()\n\n  if (resizeObserver) {\n    resizeObserver.disconnect()\n    resizeObserver = null\n  }\n\n  store.canvasHistory.clearStates()\n  store.resetState()\n  dataStore.reset()\n})\n</script>\n\n<style scoped>\n.maskEditor-dialog-root {\n  position: relative;\n  overflow: hidden;\n}\n\n.maskEditor-ui-container {\n  position: relative;\n  z-index: 1;\n}\n\n:deep(#maskEditorCanvasContainer) {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  z-index: 0;\n}\n</style>\n","import { useMaskEditorDataStore } from '@/stores/maskEditorDataStore'\nimport { useMaskEditorStore } from '@/stores/maskEditorStore'\nimport { useNodeOutputStore } from '@/stores/imagePreviewStore'\nimport type {\n  EditorOutputData,\n  EditorOutputLayer,\n  ImageRef\n} from '@/stores/maskEditorDataStore'\nimport { isCloud } from '@/platform/distribution/types'\nimport { api } from '@/scripts/api'\nimport { app } from '@/scripts/app'\nimport type { LGraphNode } from '@/lib/litegraph/src/litegraph'\n\n// Private layer filename functions\ninterface ImageLayerFilenames {\n  maskedImage: string\n  paint: string\n  paintedImage: string\n  paintedMaskedImage: string\n}\n\nfunction imageLayerFilenamesByTimestamp(\n  timestamp: number\n): ImageLayerFilenames {\n  return {\n    maskedImage: `clipspace-mask-${timestamp}.png`,\n    paint: `clipspace-paint-${timestamp}.png`,\n    paintedImage: `clipspace-painted-${timestamp}.png`,\n    paintedMaskedImage: `clipspace-painted-masked-${timestamp}.png`\n  }\n}\n\nexport function useMaskEditorSaver() {\n  const dataStore = useMaskEditorDataStore()\n  const editorStore = useMaskEditorStore()\n  const nodeOutputStore = useNodeOutputStore()\n\n  const save = async (): Promise<void> => {\n    const sourceNode = dataStore.sourceNode as LGraphNode\n    if (!sourceNode || !dataStore.inputData) {\n      throw new Error('No source node or input data')\n    }\n\n    try {\n      const outputData = await prepareOutputData()\n      dataStore.outputData = outputData\n\n      await updateNodePreview(sourceNode, outputData)\n\n      await uploadAllLayers(outputData)\n\n      updateNodeWithServerReferences(sourceNode, outputData)\n\n      app.graph.setDirtyCanvas(true)\n    } catch (error) {\n      console.error('[MaskEditorSaver] Save failed:', error)\n      throw error\n    }\n  }\n\n  async function prepareOutputData(): Promise<EditorOutputData> {\n    const maskCanvas = editorStore.maskCanvas\n    const paintCanvas = editorStore.rgbCanvas\n    const imgCanvas = editorStore.imgCanvas\n\n    if (!maskCanvas || !paintCanvas || !imgCanvas) {\n      throw new Error('Canvas not initialized')\n    }\n\n    const timestamp = Date.now()\n    const filenames = imageLayerFilenamesByTimestamp(timestamp)\n\n    const [maskedImage, paintLayer, paintedImage, paintedMaskedImage] =\n      await Promise.all([\n        createMaskedImage(imgCanvas, maskCanvas, filenames.maskedImage),\n        createPaintLayer(paintCanvas, filenames.paint),\n        createPaintedImage(imgCanvas, paintCanvas, filenames.paintedImage),\n        createPaintedMaskedImage(\n          imgCanvas,\n          paintCanvas,\n          maskCanvas,\n          filenames.paintedMaskedImage\n        )\n      ])\n\n    return {\n      maskedImage,\n      paintLayer,\n      paintedImage,\n      paintedMaskedImage\n    }\n  }\n\n  async function createMaskedImage(\n    imgCanvas: HTMLCanvasElement,\n    maskCanvas: HTMLCanvasElement,\n    filename: string\n  ): Promise<EditorOutputLayer> {\n    const canvas = document.createElement('canvas')\n    canvas.width = imgCanvas.width\n    canvas.height = imgCanvas.height\n    const ctx = canvas.getContext('2d')!\n\n    ctx.drawImage(imgCanvas, 0, 0)\n\n    const maskCtx = maskCanvas.getContext('2d')!\n    const maskData = maskCtx.getImageData(\n      0,\n      0,\n      maskCanvas.width,\n      maskCanvas.height\n    )\n\n    const refinedMaskData = new Uint8ClampedArray(maskData.data.length)\n    for (let i = 0; i < maskData.data.length; i += 4) {\n      refinedMaskData[i] = 0\n      refinedMaskData[i + 1] = 0\n      refinedMaskData[i + 2] = 0\n      refinedMaskData[i + 3] = 255 - maskData.data[i + 3]\n    }\n\n    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height)\n    for (let i = 0; i < imageData.data.length; i += 4) {\n      imageData.data[i + 3] = refinedMaskData[i + 3]\n    }\n    ctx.putImageData(imageData, 0, 0)\n\n    const blob = await canvasToBlob(canvas)\n    const ref = createFileRef(filename)\n\n    return { canvas, blob, ref }\n  }\n\n  async function createPaintLayer(\n    paintCanvas: HTMLCanvasElement,\n    filename: string\n  ): Promise<EditorOutputLayer> {\n    const canvas = cloneCanvas(paintCanvas)\n    const blob = await canvasToBlob(canvas)\n    const ref = createFileRef(filename)\n\n    return { canvas, blob, ref }\n  }\n\n  async function createPaintedImage(\n    imgCanvas: HTMLCanvasElement,\n    paintCanvas: HTMLCanvasElement,\n    filename: string\n  ): Promise<EditorOutputLayer> {\n    const canvas = document.createElement('canvas')\n    canvas.width = imgCanvas.width\n    canvas.height = imgCanvas.height\n    const ctx = canvas.getContext('2d')!\n\n    ctx.drawImage(imgCanvas, 0, 0)\n\n    ctx.globalCompositeOperation = 'source-over'\n    ctx.drawImage(paintCanvas, 0, 0)\n\n    const blob = await canvasToBlob(canvas)\n    const ref = createFileRef(filename)\n\n    return { canvas, blob, ref }\n  }\n\n  async function createPaintedMaskedImage(\n    imgCanvas: HTMLCanvasElement,\n    paintCanvas: HTMLCanvasElement,\n    maskCanvas: HTMLCanvasElement,\n    filename: string\n  ): Promise<EditorOutputLayer> {\n    const canvas = document.createElement('canvas')\n    canvas.width = imgCanvas.width\n    canvas.height = imgCanvas.height\n    const ctx = canvas.getContext('2d')!\n\n    ctx.drawImage(imgCanvas, 0, 0)\n\n    ctx.globalCompositeOperation = 'source-over'\n    ctx.drawImage(paintCanvas, 0, 0)\n\n    const maskCtx = maskCanvas.getContext('2d')!\n    const maskData = maskCtx.getImageData(\n      0,\n      0,\n      maskCanvas.width,\n      maskCanvas.height\n    )\n\n    const refinedMaskData = new Uint8ClampedArray(maskData.data.length)\n    for (let i = 0; i < maskData.data.length; i += 4) {\n      refinedMaskData[i] = 0\n      refinedMaskData[i + 1] = 0\n      refinedMaskData[i + 2] = 0\n      refinedMaskData[i + 3] = 255 - maskData.data[i + 3]\n    }\n\n    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height)\n    for (let i = 0; i < imageData.data.length; i += 4) {\n      imageData.data[i + 3] = refinedMaskData[i + 3]\n    }\n    ctx.putImageData(imageData, 0, 0)\n\n    const blob = await canvasToBlob(canvas)\n    const ref = createFileRef(filename)\n\n    return { canvas, blob, ref }\n  }\n\n  async function uploadAllLayers(outputData: EditorOutputData): Promise<void> {\n    const sourceRef = dataStore.inputData!.sourceRef\n\n    const actualMaskedRef = await uploadMask(outputData.maskedImage, sourceRef)\n    const actualPaintRef = await uploadImage(outputData.paintLayer, sourceRef)\n    const actualPaintedRef = await uploadImage(\n      outputData.paintedImage,\n      sourceRef\n    )\n\n    const actualPaintedMaskedRef = await uploadMask(\n      outputData.paintedMaskedImage,\n      actualPaintedRef\n    )\n\n    outputData.maskedImage.ref = actualMaskedRef\n    outputData.paintLayer.ref = actualPaintRef\n    outputData.paintedImage.ref = actualPaintedRef\n    outputData.paintedMaskedImage.ref = actualPaintedMaskedRef\n  }\n\n  async function uploadMask(\n    layer: EditorOutputLayer,\n    originalRef: ImageRef\n  ): Promise<ImageRef> {\n    const formData = new FormData()\n    formData.append('image', layer.blob, layer.ref.filename)\n    formData.append('original_ref', JSON.stringify(originalRef))\n    formData.append('type', 'input')\n    formData.append('subfolder', 'clipspace')\n\n    const response = await api.fetchApi('/upload/mask', {\n      method: 'POST',\n      body: formData\n    })\n\n    if (!response.ok) {\n      throw new Error(`Failed to upload mask: ${layer.ref.filename}`)\n    }\n\n    try {\n      const data = await response.json()\n      if (data?.name) {\n        return {\n          filename: data.name,\n          subfolder: data.subfolder || layer.ref.subfolder,\n          type: data.type || layer.ref.type\n        }\n      }\n    } catch (error) {\n      console.warn('[MaskEditorSaver] Failed to parse upload response:', error)\n    }\n\n    return layer.ref\n  }\n\n  async function uploadImage(\n    layer: EditorOutputLayer,\n    originalRef: ImageRef\n  ): Promise<ImageRef> {\n    const formData = new FormData()\n    formData.append('image', layer.blob, layer.ref.filename)\n    formData.append('original_ref', JSON.stringify(originalRef))\n    formData.append('type', 'input')\n    formData.append('subfolder', 'clipspace')\n\n    const response = await api.fetchApi('/upload/image', {\n      method: 'POST',\n      body: formData\n    })\n\n    if (!response.ok) {\n      throw new Error(`Failed to upload image: ${layer.ref.filename}`)\n    }\n\n    try {\n      const data = await response.json()\n      if (data?.name) {\n        return {\n          filename: data.name,\n          subfolder: data.subfolder || layer.ref.subfolder,\n          type: data.type || layer.ref.type\n        }\n      }\n    } catch (error) {\n      console.warn('[MaskEditorSaver] Failed to parse upload response:', error)\n    }\n\n    return layer.ref\n  }\n\n  async function updateNodePreview(\n    node: LGraphNode,\n    outputData: EditorOutputData\n  ): Promise<void> {\n    const canvas = outputData.paintedMaskedImage.canvas\n    const dataUrl = canvas.toDataURL('image/png')\n\n    const mainImg = await loadImageFromUrl(dataUrl)\n    node.imgs = [mainImg]\n\n    app.graph.setDirtyCanvas(true)\n  }\n\n  function updateNodeWithServerReferences(\n    node: LGraphNode,\n    outputData: EditorOutputData\n  ): void {\n    const mainRef = outputData.paintedMaskedImage.ref\n\n    node.images = [mainRef]\n\n    const imageWidget = node.widgets?.find((w) => w.name === 'image')\n    if (imageWidget) {\n      // Widget value format differs between Cloud and OSS:\n      // - Cloud: JUST the filename (subfolder handled by backend)\n      // - OSS: subfolder/filename (traditional format)\n      let widgetValue: string\n      if (isCloud) {\n        widgetValue =\n          mainRef.filename + (mainRef.type ? ` [${mainRef.type}]` : '')\n      } else {\n        widgetValue =\n          (mainRef.subfolder ? mainRef.subfolder + '/' : '') +\n          mainRef.filename +\n          (mainRef.type ? ` [${mainRef.type}]` : '')\n      }\n\n      imageWidget.value = widgetValue\n\n      if (node.properties) {\n        node.properties['image'] = widgetValue\n      }\n\n      if (node.widgets_values && node.widgets) {\n        const widgetIndex = node.widgets.indexOf(imageWidget)\n        if (widgetIndex >= 0) {\n          node.widgets_values[widgetIndex] = widgetValue\n        }\n      }\n\n      imageWidget.callback?.(widgetValue)\n    }\n\n    nodeOutputStore.updateNodeImages(node)\n  }\n\n  function loadImageFromUrl(url: string): Promise<HTMLImageElement> {\n    return new Promise((resolve, reject) => {\n      const img = new Image()\n      img.crossOrigin = 'anonymous'\n\n      img.onload = () => resolve(img)\n      img.onerror = (error) => {\n        console.error('[MaskEditorSaver] Failed to load image:', url, error)\n        reject(new Error(`Failed to load image: ${url}`))\n      }\n\n      img.src = url\n    })\n  }\n\n  function cloneCanvas(source: HTMLCanvasElement): HTMLCanvasElement {\n    const canvas = document.createElement('canvas')\n    canvas.width = source.width\n    canvas.height = source.height\n    const ctx = canvas.getContext('2d')!\n    ctx.drawImage(source, 0, 0)\n    return canvas\n  }\n\n  function canvasToBlob(canvas: HTMLCanvasElement): Promise<Blob> {\n    return new Promise((resolve, reject) => {\n      canvas.toBlob((blob) => {\n        if (blob) resolve(blob)\n        else reject(new Error('Failed to create blob from canvas'))\n      }, 'image/png')\n    })\n  }\n\n  function createFileRef(filename: string): ImageRef {\n    return {\n      filename,\n      subfolder: 'clipspace',\n      type: 'input'\n    }\n  }\n\n  return {\n    save\n  }\n}\n","<template>\n  <div class=\"flex w-full items-center justify-between gap-3\">\n    <div class=\"flex items-center gap-3\">\n      <h3 class=\"m-0 text-lg font-semibold\">{{ t('maskEditor.title') }}</h3>\n\n      <div class=\"flex items-center gap-4\">\n        <button\n          :class=\"iconButtonClass\"\n          :title=\"t('maskEditor.undo')\"\n          @click=\"onUndo\"\n        >\n          <svg\n            viewBox=\"0 0 15 15\"\n            class=\"h-6.25 w-6.25 pointer-events-none fill-[var(--input-text)]\"\n          >\n            <path\n              d=\"M8.77,12.18c-.25,0-.46-.2-.46-.46s.2-.46.46-.46c1.47,0,2.67-1.2,2.67-2.67,0-1.57-1.34-2.67-3.26-2.67h-3.98l1.43,1.43c.18.18.18.47,0,.64-.18.18-.47.18-.64,0l-2.21-2.21c-.18-.18-.18-.47,0-.64l2.21-2.21c.18-.18.47-.18.64,0,.18.18.18.47,0,.64l-1.43,1.43h3.98c2.45,0,4.17,1.47,4.17,3.58,0,1.97-1.61,3.58-3.58,3.58Z\"\n            />\n          </svg>\n        </button>\n\n        <button\n          :class=\"iconButtonClass\"\n          :title=\"t('maskEditor.redo')\"\n          @click=\"onRedo\"\n        >\n          <svg\n            viewBox=\"0 0 15 15\"\n            class=\"h-6.25 w-6.25 pointer-events-none fill-[var(--input-text)]\"\n          >\n            <path\n              class=\"cls-1\"\n              d=\"M6.23,12.18c-1.97,0-3.58-1.61-3.58-3.58,0-2.11,1.71-3.58,4.17-3.58h3.98l-1.43-1.43c-.18-.18-.18-.47,0-.64.18-.18.46-.18.64,0l2.21,2.21c.09.09.13.2.13.32s-.05.24-.13.32l-2.21,2.21c-.18.18-.47.18-.64,0-.18-.18-.18-.47,0-.64l1.43-1.43h-3.98c-1.92,0-3.26,1.1-3.26,2.67,0,1.47,1.2,2.67,2.67,2.67.25,0,.46.2.46.46s-.2.46-.46.46Z\"\n            />\n          </svg>\n        </button>\n\n        <button :class=\"textButtonClass\" @click=\"onInvert\">\n          {{ t('maskEditor.invert') }}\n        </button>\n\n        <button :class=\"textButtonClass\" @click=\"onClear\">\n          {{ t('maskEditor.clear') }}\n        </button>\n      </div>\n    </div>\n\n    <div class=\"flex gap-3\">\n      <Button\n        :label=\"saveButtonText\"\n        icon=\"pi pi-check\"\n        size=\"small\"\n        :disabled=\"!saveEnabled\"\n        @click=\"handleSave\"\n      />\n      <Button\n        :label=\"t('g.cancel')\"\n        icon=\"pi pi-times\"\n        size=\"small\"\n        severity=\"secondary\"\n        @click=\"handleCancel\"\n      />\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport Button from 'primevue/button'\nimport { ref } from 'vue'\n\nimport { useCanvasTools } from '@/composables/maskeditor/useCanvasTools'\nimport { useMaskEditorSaver } from '@/composables/maskeditor/useMaskEditorSaver'\nimport { t } from '@/i18n'\nimport { useDialogStore } from '@/stores/dialogStore'\nimport { useMaskEditorStore } from '@/stores/maskEditorStore'\n\nconst store = useMaskEditorStore()\nconst dialogStore = useDialogStore()\nconst canvasTools = useCanvasTools()\nconst saver = useMaskEditorSaver()\n\nconst saveButtonText = ref(t('g.save'))\nconst saveEnabled = ref(true)\n\nconst iconButtonClass =\n  'flex h-7.5 w-12.5 items-center justify-center rounded-[10px] border border-[var(--p-form-field-border-color)] pointer-events-auto transition-colors duration-100 bg-[var(--comfy-menu-bg)] hover:bg-secondary-background-hover'\n\nconst textButtonClass =\n  'h-7.5 w-15 rounded-[10px] border border-[var(--p-form-field-border-color)] text-[var(--input-text)] font-sans pointer-events-auto transition-colors duration-100 bg-[var(--comfy-menu-bg)] hover:bg-secondary-background-hover'\n\nconst onUndo = () => {\n  store.canvasHistory.undo()\n}\n\nconst onRedo = () => {\n  store.canvasHistory.redo()\n}\n\nconst onInvert = () => {\n  canvasTools.invertMask()\n}\n\nconst onClear = () => {\n  canvasTools.clearMask()\n}\n\nconst handleSave = async () => {\n  saveButtonText.value = t('g.saving')\n  saveEnabled.value = false\n\n  try {\n    store.brushVisible = false\n    await saver.save()\n    dialogStore.closeDialog()\n  } catch (error) {\n    console.error('[TopBarHeader] Save failed:', error)\n    store.brushVisible = true\n    saveButtonText.value = t('g.save')\n    saveEnabled.value = true\n  }\n}\n\nconst handleCancel = () => {\n  dialogStore.closeDialog({ key: 'global-mask-editor' })\n}\n</script>\n","import { api } from '../../scripts/api'\nimport { app } from '../../scripts/app'\nimport { ComfyApp } from '../../scripts/app'\nimport { $el, ComfyDialog } from '../../scripts/ui'\nimport { ClipspaceDialog } from './clipspace'\n\n// Helper function to convert a data URL to a Blob object\n// @ts-expect-error fixme ts strict error\nfunction dataURLToBlob(dataURL) {\n  const parts = dataURL.split(';base64,')\n  const contentType = parts[0].split(':')[1]\n  const byteString = atob(parts[1])\n  const arrayBuffer = new ArrayBuffer(byteString.length)\n  const uint8Array = new Uint8Array(arrayBuffer)\n  for (let i = 0; i < byteString.length; i++) {\n    uint8Array[i] = byteString.charCodeAt(i)\n  }\n  return new Blob([arrayBuffer], { type: contentType })\n}\n\n// @ts-expect-error fixme ts strict error\nfunction loadImage(imagePath) {\n  return new Promise((resolve) => {\n    const image = new Image()\n\n    image.onload = function () {\n      resolve(image)\n    }\n\n    image.src = imagePath\n  })\n}\n\n// @ts-expect-error fixme ts strict error\nasync function uploadMask(filepath, formData) {\n  await api\n    .fetchApi('/upload/mask', {\n      method: 'POST',\n      body: formData\n    })\n    .catch((error) => {\n      console.error('Error:', error)\n    })\n\n  // @ts-expect-error fixme ts strict error\n  ComfyApp.clipspace.imgs[ComfyApp.clipspace['selectedIndex']] = new Image()\n  // @ts-expect-error fixme ts strict error\n  ComfyApp.clipspace.imgs[ComfyApp.clipspace['selectedIndex']].src = api.apiURL(\n    '/view?' +\n      new URLSearchParams(filepath).toString() +\n      app.getPreviewFormatParam() +\n      app.getRandParam()\n  )\n\n  // @ts-expect-error fixme ts strict error\n  if (ComfyApp.clipspace.images)\n    // @ts-expect-error fixme ts strict error\n    ComfyApp.clipspace.images[ComfyApp.clipspace['selectedIndex']] = filepath\n\n  ClipspaceDialog.invalidatePreview()\n}\n\n// @ts-expect-error fixme ts strict error\nfunction prepare_mask(image, maskCanvas, maskCtx, maskColor) {\n  // paste mask data into alpha channel\n  maskCtx.drawImage(image, 0, 0, maskCanvas.width, maskCanvas.height)\n  const maskData = maskCtx.getImageData(\n    0,\n    0,\n    maskCanvas.width,\n    maskCanvas.height\n  )\n\n  // invert mask\n  for (let i = 0; i < maskData.data.length; i += 4) {\n    if (maskData.data[i + 3] == 255) maskData.data[i + 3] = 0\n    else maskData.data[i + 3] = 255\n\n    maskData.data[i] = maskColor.r\n    maskData.data[i + 1] = maskColor.g\n    maskData.data[i + 2] = maskColor.b\n  }\n\n  maskCtx.globalCompositeOperation = 'source-over'\n  maskCtx.putImageData(maskData, 0, 0)\n}\n\n// Define the PointerType enum\nenum PointerType {\n  Arc = 'arc',\n  Rect = 'rect'\n}\n\nenum CompositionOperation {\n  SourceOver = 'source-over',\n  DestinationOut = 'destination-out'\n}\n\nexport class MaskEditorDialogOld extends ComfyDialog {\n  static instance = null\n  static mousedown_x: number | null = null\n  static mousedown_y: number | null = null\n\n  // @ts-expect-error fixme ts strict error\n  brush: HTMLDivElement\n  maskCtx: any\n  // @ts-expect-error fixme ts strict error\n  maskCanvas: HTMLCanvasElement\n  // @ts-expect-error fixme ts strict error\n  brush_size_slider: HTMLDivElement\n  // @ts-expect-error fixme ts strict error\n  brush_opacity_slider: HTMLDivElement\n  // @ts-expect-error fixme ts strict error\n  colorButton: HTMLButtonElement\n  // @ts-expect-error fixme ts strict error\n  saveButton: HTMLButtonElement\n  // @ts-expect-error fixme ts strict error\n  zoom_ratio: number\n  // @ts-expect-error fixme ts strict error\n  pan_x: number\n  // @ts-expect-error fixme ts strict error\n  pan_y: number\n  // @ts-expect-error fixme ts strict error\n  imgCanvas: HTMLCanvasElement\n  // @ts-expect-error fixme ts strict error\n  last_display_style: string\n  // @ts-expect-error fixme ts strict error\n  is_visible: boolean\n  // @ts-expect-error fixme ts strict error\n  image: HTMLImageElement\n  // @ts-expect-error fixme ts strict error\n  handler_registered: boolean\n  // @ts-expect-error fixme ts strict error\n  brush_slider_input: HTMLInputElement\n  // @ts-expect-error fixme ts strict error\n  cursorX: number\n  // @ts-expect-error fixme ts strict error\n  cursorY: number\n  // @ts-expect-error fixme ts strict error\n  mousedown_pan_x: number\n  // @ts-expect-error fixme ts strict error\n  mousedown_pan_y: number\n  // @ts-expect-error fixme ts strict error\n  last_pressure: number\n  // @ts-expect-error fixme ts strict error\n  pointer_type: PointerType\n  // @ts-expect-error fixme ts strict error\n  brush_pointer_type_select: HTMLDivElement\n\n  static getInstance() {\n    if (!MaskEditorDialogOld.instance) {\n      // @ts-expect-error fixme ts strict error\n      MaskEditorDialogOld.instance = new MaskEditorDialogOld()\n    }\n\n    return MaskEditorDialogOld.instance\n  }\n\n  is_layout_created = false\n\n  constructor() {\n    super()\n    this.element = $el('div.comfy-modal', { parent: document.body }, [\n      $el('div.comfy-modal-content', [...this.createButtons()])\n    ])\n  }\n\n  override createButtons() {\n    return []\n  }\n\n  // @ts-expect-error fixme ts strict error\n  createButton(name, callback): HTMLButtonElement {\n    var button = document.createElement('button')\n    button.style.pointerEvents = 'auto'\n    button.innerText = name\n    button.addEventListener('click', callback)\n    return button\n  }\n\n  // @ts-expect-error fixme ts strict error\n  createLeftButton(name, callback) {\n    var button = this.createButton(name, callback)\n    button.style.cssFloat = 'left'\n    button.style.marginRight = '4px'\n    return button\n  }\n\n  // @ts-expect-error fixme ts strict error\n  createRightButton(name, callback) {\n    var button = this.createButton(name, callback)\n    button.style.cssFloat = 'right'\n    button.style.marginLeft = '4px'\n    return button\n  }\n\n  // @ts-expect-error fixme ts strict error\n  createLeftSlider(self, name, callback): HTMLDivElement {\n    const divElement = document.createElement('div')\n    divElement.id = 'maskeditor-slider'\n    divElement.style.cssFloat = 'left'\n    divElement.style.fontFamily = 'sans-serif'\n    divElement.style.marginRight = '4px'\n    divElement.style.color = 'var(--input-text)'\n    divElement.style.backgroundColor = 'var(--comfy-input-bg)'\n    divElement.style.borderRadius = '8px'\n    divElement.style.borderColor = 'var(--border-color)'\n    divElement.style.borderStyle = 'solid'\n    divElement.style.fontSize = '15px'\n    divElement.style.height = '25px'\n    divElement.style.padding = '1px 6px'\n    divElement.style.display = 'flex'\n    divElement.style.position = 'relative'\n    divElement.style.top = '2px'\n    divElement.style.pointerEvents = 'auto'\n    self.brush_slider_input = document.createElement('input')\n    self.brush_slider_input.setAttribute('type', 'range')\n    self.brush_slider_input.setAttribute('min', '1')\n    self.brush_slider_input.setAttribute('max', '100')\n    self.brush_slider_input.setAttribute('value', '10')\n    const labelElement = document.createElement('label')\n    labelElement.textContent = name\n\n    divElement.appendChild(labelElement)\n    divElement.appendChild(self.brush_slider_input)\n\n    self.brush_slider_input.addEventListener('change', callback)\n\n    return divElement\n  }\n\n  // @ts-expect-error fixme ts strict error\n  createOpacitySlider(self, name, callback): HTMLDivElement {\n    const divElement = document.createElement('div')\n    divElement.id = 'maskeditor-opacity-slider'\n    divElement.style.cssFloat = 'left'\n    divElement.style.fontFamily = 'sans-serif'\n    divElement.style.marginRight = '4px'\n    divElement.style.color = 'var(--input-text)'\n    divElement.style.backgroundColor = 'var(--comfy-input-bg)'\n    divElement.style.borderRadius = '8px'\n    divElement.style.borderColor = 'var(--border-color)'\n    divElement.style.borderStyle = 'solid'\n    divElement.style.fontSize = '15px'\n    divElement.style.height = '25px'\n    divElement.style.padding = '1px 6px'\n    divElement.style.display = 'flex'\n    divElement.style.position = 'relative'\n    divElement.style.top = '2px'\n    divElement.style.pointerEvents = 'auto'\n    self.opacity_slider_input = document.createElement('input')\n    self.opacity_slider_input.setAttribute('type', 'range')\n    self.opacity_slider_input.setAttribute('min', '0.1')\n    self.opacity_slider_input.setAttribute('max', '1.0')\n    self.opacity_slider_input.setAttribute('step', '0.01')\n    self.opacity_slider_input.setAttribute('value', '0.7')\n    const labelElement = document.createElement('label')\n    labelElement.textContent = name\n\n    divElement.appendChild(labelElement)\n    divElement.appendChild(self.opacity_slider_input)\n\n    self.opacity_slider_input.addEventListener('input', callback)\n\n    return divElement\n  }\n\n  createPointerTypeSelect(self: any): HTMLDivElement {\n    const divElement = document.createElement('div')\n    divElement.id = 'maskeditor-pointer-type'\n    divElement.style.cssFloat = 'left'\n    divElement.style.fontFamily = 'sans-serif'\n    divElement.style.marginRight = '4px'\n    divElement.style.color = 'var(--input-text)'\n    divElement.style.backgroundColor = 'var(--comfy-input-bg)'\n    divElement.style.borderRadius = '8px'\n    divElement.style.borderColor = 'var(--border-color)'\n    divElement.style.borderStyle = 'solid'\n    divElement.style.fontSize = '15px'\n    divElement.style.height = '25px'\n    divElement.style.padding = '1px 6px'\n    divElement.style.display = 'flex'\n    divElement.style.position = 'relative'\n    divElement.style.top = '2px'\n    divElement.style.pointerEvents = 'auto'\n\n    const labelElement = document.createElement('label')\n    labelElement.textContent = 'Pointer Type:'\n\n    const selectElement = document.createElement('select')\n    selectElement.style.borderRadius = '0'\n    selectElement.style.borderColor = 'transparent'\n    selectElement.style.borderStyle = 'unset'\n    selectElement.style.fontSize = '0.9em'\n\n    const optionArc = document.createElement('option')\n    optionArc.value = 'arc'\n    optionArc.text = 'Circle'\n    optionArc.selected = true // Fix for TypeScript, \"selected\" should be boolean\n\n    const optionRect = document.createElement('option')\n    optionRect.value = 'rect'\n    optionRect.text = 'Square'\n\n    selectElement.appendChild(optionArc)\n    selectElement.appendChild(optionRect)\n\n    selectElement.addEventListener('change', (event: Event) => {\n      const target = event.target as HTMLSelectElement\n      self.pointer_type = target.value\n      this.setBrushBorderRadius(self)\n    })\n\n    divElement.appendChild(labelElement)\n    divElement.appendChild(selectElement)\n\n    return divElement\n  }\n\n  setBrushBorderRadius(self: any): void {\n    if (self.pointer_type === PointerType.Rect) {\n      this.brush.style.borderRadius = '0%'\n      // @ts-expect-error\n      this.brush.style.MozBorderRadius = '0%'\n      // @ts-expect-error\n      this.brush.style.WebkitBorderRadius = '0%'\n    } else {\n      this.brush.style.borderRadius = '50%'\n      // @ts-expect-error\n      this.brush.style.MozBorderRadius = '50%'\n      // @ts-expect-error\n      this.brush.style.WebkitBorderRadius = '50%'\n    }\n  }\n\n  setlayout(imgCanvas: HTMLCanvasElement, maskCanvas: HTMLCanvasElement) {\n    const self = this\n    self.pointer_type = PointerType.Arc\n\n    // If it is specified as relative, using it only as a hidden placeholder for padding is recommended\n    // to prevent anomalies where it exceeds a certain size and goes outside of the window.\n    var bottom_panel = document.createElement('div')\n    bottom_panel.style.position = 'absolute'\n    bottom_panel.style.bottom = '0px'\n    bottom_panel.style.left = '20px'\n    bottom_panel.style.right = '20px'\n    bottom_panel.style.height = '50px'\n    bottom_panel.style.pointerEvents = 'none'\n\n    var brush = document.createElement('div')\n    brush.id = 'brush'\n    brush.style.backgroundColor = 'transparent'\n    brush.style.outline = '1px dashed black'\n    brush.style.boxShadow = '0 0 0 1px white'\n    brush.style.position = 'absolute'\n    brush.style.zIndex = '8889'\n    brush.style.pointerEvents = 'none'\n    this.brush = brush\n    this.setBrushBorderRadius(self)\n    this.element.appendChild(imgCanvas)\n    this.element.appendChild(maskCanvas)\n    this.element.appendChild(bottom_panel)\n    document.body.appendChild(brush)\n\n    var clearButton = this.createLeftButton('Clear', () => {\n      self.maskCtx.clearRect(\n        0,\n        0,\n        self.maskCanvas.width,\n        self.maskCanvas.height\n      )\n    })\n\n    this.brush_size_slider = this.createLeftSlider(\n      self,\n      'Thickness',\n      // @ts-expect-error fixme ts strict error\n      (event) => {\n        self.brush_size = event.target.value\n        self.updateBrushPreview(self)\n      }\n    )\n\n    this.brush_opacity_slider = this.createOpacitySlider(\n      self,\n      'Opacity',\n      // @ts-expect-error fixme ts strict error\n      (event) => {\n        self.brush_opacity = event.target.value\n        if (self.brush_color_mode !== 'negative') {\n          self.maskCanvas.style.opacity = self.brush_opacity.toString()\n        }\n      }\n    )\n\n    this.brush_pointer_type_select = this.createPointerTypeSelect(self)\n    this.colorButton = this.createLeftButton(this.getColorButtonText(), () => {\n      if (self.brush_color_mode === 'black') {\n        self.brush_color_mode = 'white'\n      } else if (self.brush_color_mode === 'white') {\n        self.brush_color_mode = 'negative'\n      } else {\n        self.brush_color_mode = 'black'\n      }\n\n      self.updateWhenBrushColorModeChanged()\n    })\n\n    var cancelButton = this.createRightButton('Cancel', () => {\n      document.removeEventListener('keydown', MaskEditorDialogOld.handleKeyDown)\n      self.close()\n    })\n\n    this.saveButton = this.createRightButton('Save', () => {\n      document.removeEventListener('keydown', MaskEditorDialogOld.handleKeyDown)\n      self.save()\n    })\n\n    this.element.appendChild(imgCanvas)\n    this.element.appendChild(maskCanvas)\n    this.element.appendChild(bottom_panel)\n\n    bottom_panel.appendChild(clearButton)\n    bottom_panel.appendChild(this.saveButton)\n    bottom_panel.appendChild(cancelButton)\n    bottom_panel.appendChild(this.brush_size_slider)\n    bottom_panel.appendChild(this.brush_opacity_slider)\n    bottom_panel.appendChild(this.brush_pointer_type_select)\n    bottom_panel.appendChild(this.colorButton)\n\n    imgCanvas.style.position = 'absolute'\n    maskCanvas.style.position = 'absolute'\n\n    imgCanvas.style.top = '200'\n    imgCanvas.style.left = '0'\n\n    maskCanvas.style.top = imgCanvas.style.top\n    maskCanvas.style.left = imgCanvas.style.left\n\n    const maskCanvasStyle = this.getMaskCanvasStyle()\n    maskCanvas.style.mixBlendMode = maskCanvasStyle.mixBlendMode\n    maskCanvas.style.opacity = maskCanvasStyle.opacity.toString()\n  }\n\n  override async show() {\n    this.zoom_ratio = 1.0\n    this.pan_x = 0\n    this.pan_y = 0\n\n    if (!this.is_layout_created) {\n      // layout\n      const imgCanvas = document.createElement('canvas')\n      const maskCanvas = document.createElement('canvas')\n\n      imgCanvas.id = 'imageCanvas'\n      maskCanvas.id = 'maskCanvas'\n\n      this.setlayout(imgCanvas, maskCanvas)\n\n      // prepare content\n      this.imgCanvas = imgCanvas\n      this.maskCanvas = maskCanvas\n      this.maskCtx = maskCanvas.getContext('2d', { willReadFrequently: true })\n\n      this.setEventHandler(maskCanvas)\n\n      this.is_layout_created = true\n\n      // replacement of onClose hook since close is not real close\n      const self = this\n      const observer = new MutationObserver(function (mutations) {\n        mutations.forEach(function (mutation) {\n          if (\n            mutation.type === 'attributes' &&\n            mutation.attributeName === 'style'\n          ) {\n            if (\n              self.last_display_style &&\n              self.last_display_style != 'none' &&\n              self.element.style.display == 'none'\n            ) {\n              self.brush.style.display = 'none'\n              ComfyApp.onClipspaceEditorClosed()\n            }\n\n            self.last_display_style = self.element.style.display\n          }\n        })\n      })\n\n      const config = { attributes: true }\n      observer.observe(this.element, config)\n    }\n\n    // The keydown event needs to be reconfigured when closing the dialog as it gets removed.\n    document.addEventListener('keydown', MaskEditorDialogOld.handleKeyDown)\n\n    if (ComfyApp.clipspace_return_node) {\n      this.saveButton.innerText = 'Save to node'\n    } else {\n      this.saveButton.innerText = 'Save'\n    }\n    this.saveButton.disabled = false\n\n    this.element.style.display = 'block'\n    this.element.style.width = '85%'\n    this.element.style.margin = '0 7.5%'\n    this.element.style.height = '100vh'\n    this.element.style.top = '50%'\n    this.element.style.left = '42%'\n    this.element.style.zIndex = '8888' // NOTE: alert dialog must be high priority.\n\n    await this.setImages(this.imgCanvas)\n\n    this.is_visible = true\n  }\n\n  isOpened() {\n    return this.element.style.display == 'block'\n  }\n\n  // @ts-expect-error fixme ts strict error\n  invalidateCanvas(orig_image, mask_image) {\n    this.imgCanvas.width = orig_image.width\n    this.imgCanvas.height = orig_image.height\n\n    this.maskCanvas.width = orig_image.width\n    this.maskCanvas.height = orig_image.height\n\n    let imgCtx = this.imgCanvas.getContext('2d', { willReadFrequently: true })\n    let maskCtx = this.maskCanvas.getContext('2d', {\n      willReadFrequently: true\n    })\n\n    // @ts-expect-error fixme ts strict error\n    imgCtx.drawImage(orig_image, 0, 0, orig_image.width, orig_image.height)\n    prepare_mask(mask_image, this.maskCanvas, maskCtx, this.getMaskColor())\n  }\n\n  // @ts-expect-error fixme ts strict error\n  async setImages(imgCanvas) {\n    let self = this\n\n    const imgCtx = imgCanvas.getContext('2d', { willReadFrequently: true })\n    const maskCtx = this.maskCtx\n    const maskCanvas = this.maskCanvas\n\n    imgCtx.clearRect(0, 0, this.imgCanvas.width, this.imgCanvas.height)\n    maskCtx.clearRect(0, 0, this.maskCanvas.width, this.maskCanvas.height)\n\n    // image load\n    const alpha_url = new URL(\n      // @ts-expect-error fixme ts strict error\n      ComfyApp.clipspace.imgs[ComfyApp.clipspace['selectedIndex']].src\n    )\n    alpha_url.searchParams.delete('channel')\n    alpha_url.searchParams.delete('preview')\n    alpha_url.searchParams.set('channel', 'a')\n    let mask_image = await loadImage(alpha_url)\n\n    // original image load\n    const rgb_url = new URL(\n      // @ts-expect-error fixme ts strict error\n      ComfyApp.clipspace.imgs[ComfyApp.clipspace['selectedIndex']].src\n    )\n    rgb_url.searchParams.delete('channel')\n    rgb_url.searchParams.set('channel', 'rgb')\n    this.image = new Image()\n    this.image.onload = function () {\n      maskCanvas.width = self.image.width\n      maskCanvas.height = self.image.height\n\n      self.invalidateCanvas(self.image, mask_image)\n      self.initializeCanvasPanZoom()\n    }\n    this.image.src = rgb_url.toString()\n  }\n\n  initializeCanvasPanZoom() {\n    // set initialize\n    let drawWidth = this.image.width\n    let drawHeight = this.image.height\n\n    let width = this.element.clientWidth\n    let height = this.element.clientHeight\n\n    if (this.image.width > width) {\n      drawWidth = width\n      drawHeight = (drawWidth / this.image.width) * this.image.height\n    }\n\n    if (drawHeight > height) {\n      drawHeight = height\n      drawWidth = (drawHeight / this.image.height) * this.image.width\n    }\n\n    this.zoom_ratio = drawWidth / this.image.width\n\n    const canvasX = (width - drawWidth) / 2\n    const canvasY = (height - drawHeight) / 2\n    this.pan_x = canvasX\n    this.pan_y = canvasY\n\n    this.invalidatePanZoom()\n  }\n\n  invalidatePanZoom() {\n    let raw_width = this.image.width * this.zoom_ratio\n    let raw_height = this.image.height * this.zoom_ratio\n\n    if (this.pan_x + raw_width < 10) {\n      this.pan_x = 10 - raw_width\n    }\n\n    if (this.pan_y + raw_height < 10) {\n      this.pan_y = 10 - raw_height\n    }\n\n    let width = `${raw_width}px`\n    let height = `${raw_height}px`\n\n    let left = `${this.pan_x}px`\n    let top = `${this.pan_y}px`\n\n    this.maskCanvas.style.width = width\n    this.maskCanvas.style.height = height\n    this.maskCanvas.style.left = left\n    this.maskCanvas.style.top = top\n\n    this.imgCanvas.style.width = width\n    this.imgCanvas.style.height = height\n    this.imgCanvas.style.left = left\n    this.imgCanvas.style.top = top\n  }\n\n  // @ts-expect-error fixme ts strict error\n  setEventHandler(maskCanvas) {\n    const self = this\n\n    if (!this.handler_registered) {\n      // @ts-expect-error fixme ts strict error\n      maskCanvas.addEventListener('contextmenu', (event) => {\n        event.preventDefault()\n      })\n\n      this.element.addEventListener('wheel', (event) =>\n        this.handleWheelEvent(self, event)\n      )\n      this.element.addEventListener('pointermove', (event) =>\n        this.pointMoveEvent(self, event)\n      )\n      this.element.addEventListener('touchmove', (event) =>\n        this.pointMoveEvent(self, event)\n      )\n\n      this.element.addEventListener('dragstart', (event) => {\n        if (event.ctrlKey) {\n          event.preventDefault()\n        }\n      })\n\n      // @ts-expect-error fixme ts strict error\n      maskCanvas.addEventListener('pointerdown', (event) =>\n        this.handlePointerDown(self, event)\n      )\n      // @ts-expect-error fixme ts strict error\n      maskCanvas.addEventListener('pointermove', (event) =>\n        this.draw_move(self, event)\n      )\n      // @ts-expect-error fixme ts strict error\n      maskCanvas.addEventListener('touchmove', (event) =>\n        this.draw_move(self, event)\n      )\n      maskCanvas.addEventListener('pointerover', () => {\n        this.brush.style.display = 'block'\n      })\n      maskCanvas.addEventListener('pointerleave', () => {\n        this.brush.style.display = 'none'\n      })\n\n      document.addEventListener(\n        'pointerup',\n        MaskEditorDialogOld.handlePointerUp\n      )\n\n      this.handler_registered = true\n    }\n  }\n\n  getMaskCanvasStyle() {\n    if (this.brush_color_mode === 'negative') {\n      return {\n        mixBlendMode: 'difference',\n        opacity: '1'\n      }\n    } else {\n      return {\n        mixBlendMode: 'initial',\n        opacity: this.brush_opacity\n      }\n    }\n  }\n\n  getMaskColor() {\n    if (this.brush_color_mode === 'black') {\n      return { r: 0, g: 0, b: 0 }\n    }\n    if (this.brush_color_mode === 'white') {\n      return { r: 255, g: 255, b: 255 }\n    }\n    if (this.brush_color_mode === 'negative') {\n      // negative effect only works with white color\n      return { r: 255, g: 255, b: 255 }\n    }\n\n    return { r: 0, g: 0, b: 0 }\n  }\n\n  getMaskFillStyle() {\n    const maskColor = this.getMaskColor()\n\n    return 'rgb(' + maskColor.r + ',' + maskColor.g + ',' + maskColor.b + ')'\n  }\n\n  getColorButtonText() {\n    let colorCaption = 'unknown'\n\n    if (this.brush_color_mode === 'black') {\n      colorCaption = 'black'\n    } else if (this.brush_color_mode === 'white') {\n      colorCaption = 'white'\n    } else if (this.brush_color_mode === 'negative') {\n      colorCaption = 'negative'\n    }\n\n    return 'Color: ' + colorCaption\n  }\n\n  updateWhenBrushColorModeChanged() {\n    this.colorButton.innerText = this.getColorButtonText()\n\n    // update mask canvas css styles\n\n    const maskCanvasStyle = this.getMaskCanvasStyle()\n    this.maskCanvas.style.mixBlendMode = maskCanvasStyle.mixBlendMode\n    this.maskCanvas.style.opacity = maskCanvasStyle.opacity.toString()\n\n    // update mask canvas rgb colors\n\n    const maskColor = this.getMaskColor()\n\n    const maskData = this.maskCtx.getImageData(\n      0,\n      0,\n      this.maskCanvas.width,\n      this.maskCanvas.height\n    )\n\n    for (let i = 0; i < maskData.data.length; i += 4) {\n      maskData.data[i] = maskColor.r\n      maskData.data[i + 1] = maskColor.g\n      maskData.data[i + 2] = maskColor.b\n    }\n\n    this.maskCtx.putImageData(maskData, 0, 0)\n  }\n\n  brush_opacity = 0.7\n  brush_size = 10\n  brush_color_mode = 'black'\n  drawing_mode = false\n  lastx = -1\n  lasty = -1\n  lasttime = 0\n\n  // @ts-expect-error fixme ts strict error\n  static handleKeyDown(event) {\n    const self = MaskEditorDialogOld.instance\n    if (event.key === ']') {\n      // @ts-expect-error fixme ts strict error\n      self.brush_size = Math.min(self.brush_size + 2, 100)\n      // @ts-expect-error fixme ts strict error\n      self.brush_slider_input.value = self.brush_size\n    } else if (event.key === '[') {\n      // @ts-expect-error fixme ts strict error\n      self.brush_size = Math.max(self.brush_size - 2, 1)\n      // @ts-expect-error fixme ts strict error\n      self.brush_slider_input.value = self.brush_size\n    } else if (event.key === 'Enter') {\n      // @ts-expect-error fixme ts strict error\n      self.save()\n    }\n\n    // @ts-expect-error fixme ts strict error\n    self.updateBrushPreview(self)\n  }\n\n  // @ts-expect-error fixme ts strict error\n  static handlePointerUp(event) {\n    event.preventDefault()\n\n    this.mousedown_x = null\n    this.mousedown_y = null\n\n    // @ts-expect-error fixme ts strict error\n    MaskEditorDialogOld.instance.drawing_mode = false\n  }\n\n  // @ts-expect-error fixme ts strict error\n  updateBrushPreview(self) {\n    const brush = self.brush\n\n    var centerX = self.cursorX\n    var centerY = self.cursorY\n\n    brush.style.width = self.brush_size * 2 * this.zoom_ratio + 'px'\n    brush.style.height = self.brush_size * 2 * this.zoom_ratio + 'px'\n    brush.style.left = centerX - self.brush_size * this.zoom_ratio + 'px'\n    brush.style.top = centerY - self.brush_size * this.zoom_ratio + 'px'\n  }\n\n  // @ts-expect-error fixme ts strict error\n  handleWheelEvent(_, event) {\n    event.preventDefault()\n\n    if (event.ctrlKey) {\n      // zoom canvas\n      if (event.deltaY < 0) {\n        this.zoom_ratio = Math.min(10.0, this.zoom_ratio + 0.2)\n      } else {\n        this.zoom_ratio = Math.max(0.2, this.zoom_ratio - 0.2)\n      }\n\n      this.invalidatePanZoom()\n    } else {\n      // adjust brush size\n      if (event.deltaY < 0) this.brush_size = Math.min(this.brush_size + 2, 100)\n      else this.brush_size = Math.max(this.brush_size - 2, 1)\n\n      this.brush_slider_input.value = this.brush_size.toString()\n\n      this.updateBrushPreview(this)\n    }\n  }\n\n  // @ts-expect-error fixme ts strict error\n  pointMoveEvent(self, event) {\n    this.cursorX = event.pageX\n    this.cursorY = event.pageY\n\n    self.updateBrushPreview(self)\n\n    if (event.ctrlKey) {\n      event.preventDefault()\n      self.pan_move(self, event)\n    }\n\n    let left_button_down =\n      (window.TouchEvent && event instanceof TouchEvent) || event.buttons == 1\n\n    if (event.shiftKey && left_button_down) {\n      self.drawing_mode = false\n\n      const y = event.clientY\n      let delta = (self.zoom_lasty - y) * 0.005\n      self.zoom_ratio = Math.max(\n        Math.min(10.0, self.last_zoom_ratio - delta),\n        0.2\n      )\n\n      this.invalidatePanZoom()\n      return\n    }\n  }\n\n  // @ts-expect-error fixme ts strict error\n  pan_move(self, event) {\n    if (event.buttons == 1) {\n      if (MaskEditorDialogOld.mousedown_x) {\n        let deltaX = MaskEditorDialogOld.mousedown_x - event.clientX\n        // @ts-expect-error fixme ts strict error\n        let deltaY = MaskEditorDialogOld.mousedown_y - event.clientY\n\n        self.pan_x = this.mousedown_pan_x - deltaX\n        self.pan_y = this.mousedown_pan_y - deltaY\n\n        self.invalidatePanZoom()\n      }\n    }\n  }\n\n  // @ts-expect-error fixme ts strict error\n  draw_move(self, event) {\n    if (event.ctrlKey || event.shiftKey) {\n      return\n    }\n\n    event.preventDefault()\n\n    this.cursorX = event.pageX\n    this.cursorY = event.pageY\n\n    self.updateBrushPreview(self)\n\n    let left_button_down =\n      (window.TouchEvent && event instanceof TouchEvent) || event.buttons == 1\n    let right_button_down = [2, 5, 32].includes(event.buttons)\n\n    if (!event.altKey && left_button_down) {\n      var diff = performance.now() - self.lasttime\n\n      const maskRect = self.maskCanvas.getBoundingClientRect()\n\n      var x = event.offsetX\n      var y = event.offsetY\n\n      if (event.offsetX == null) {\n        x = event.targetTouches[0].clientX - maskRect.left\n      }\n\n      if (event.offsetY == null) {\n        y = event.targetTouches[0].clientY - maskRect.top\n      }\n\n      x /= self.zoom_ratio\n      y /= self.zoom_ratio\n\n      var brush_size = this.brush_size\n      if (event instanceof PointerEvent && event.pointerType == 'pen') {\n        brush_size *= event.pressure\n        this.last_pressure = event.pressure\n      } else if (\n        window.TouchEvent &&\n        event instanceof TouchEvent &&\n        diff < 20\n      ) {\n        // The firing interval of PointerEvents in Pen is unreliable, so it is supplemented by TouchEvents.\n        brush_size *= this.last_pressure\n      } else {\n        brush_size = this.brush_size\n      }\n\n      if (diff > 20 && !this.drawing_mode)\n        requestAnimationFrame(() => {\n          self.init_shape(self, CompositionOperation.SourceOver)\n          self.draw_shape(self, x, y, brush_size)\n          self.lastx = x\n          self.lasty = y\n        })\n      else\n        requestAnimationFrame(() => {\n          self.init_shape(self, CompositionOperation.SourceOver)\n\n          var dx = x - self.lastx\n          var dy = y - self.lasty\n\n          var distance = Math.sqrt(dx * dx + dy * dy)\n          var directionX = dx / distance\n          var directionY = dy / distance\n\n          for (var i = 0; i < distance; i += 5) {\n            var px = self.lastx + directionX * i\n            var py = self.lasty + directionY * i\n            self.draw_shape(self, px, py, brush_size)\n          }\n          self.lastx = x\n          self.lasty = y\n        })\n\n      self.lasttime = performance.now()\n    } else if ((event.altKey && left_button_down) || right_button_down) {\n      const maskRect = self.maskCanvas.getBoundingClientRect()\n      const x =\n        (event.offsetX || event.targetTouches[0].clientX - maskRect.left) /\n        self.zoom_ratio\n      const y =\n        (event.offsetY || event.targetTouches[0].clientY - maskRect.top) /\n        self.zoom_ratio\n\n      var brush_size = this.brush_size\n      if (event instanceof PointerEvent && event.pointerType == 'pen') {\n        brush_size *= event.pressure\n        this.last_pressure = event.pressure\n      } else if (\n        window.TouchEvent &&\n        event instanceof TouchEvent &&\n        // @ts-expect-error fixme ts strict error\n        diff < 20\n      ) {\n        brush_size *= this.last_pressure\n      } else {\n        brush_size = this.brush_size\n      }\n\n      // @ts-expect-error fixme ts strict error\n      if (diff > 20 && !this.drawing_mode)\n        // cannot tracking drawing_mode for touch event\n        requestAnimationFrame(() => {\n          self.init_shape(self, CompositionOperation.DestinationOut)\n          self.draw_shape(self, x, y, brush_size)\n          self.lastx = x\n          self.lasty = y\n        })\n      else\n        requestAnimationFrame(() => {\n          self.init_shape(self, CompositionOperation.DestinationOut)\n\n          var dx = x - self.lastx\n          var dy = y - self.lasty\n\n          var distance = Math.sqrt(dx * dx + dy * dy)\n          var directionX = dx / distance\n          var directionY = dy / distance\n\n          for (var i = 0; i < distance; i += 5) {\n            var px = self.lastx + directionX * i\n            var py = self.lasty + directionY * i\n            self.draw_shape(self, px, py, brush_size)\n          }\n          self.lastx = x\n          self.lasty = y\n        })\n\n      self.lasttime = performance.now()\n    }\n  }\n\n  // @ts-expect-error fixme ts strict error\n  handlePointerDown(self, event) {\n    if (event.ctrlKey) {\n      if (event.buttons == 1) {\n        MaskEditorDialogOld.mousedown_x = event.clientX\n        MaskEditorDialogOld.mousedown_y = event.clientY\n\n        this.mousedown_pan_x = this.pan_x\n        this.mousedown_pan_y = this.pan_y\n      }\n      return\n    }\n\n    var brush_size = this.brush_size\n    if (event instanceof PointerEvent && event.pointerType == 'pen') {\n      brush_size *= event.pressure\n      this.last_pressure = event.pressure\n    }\n\n    if ([0, 2, 5].includes(event.button)) {\n      self.drawing_mode = true\n\n      event.preventDefault()\n\n      if (event.shiftKey) {\n        self.zoom_lasty = event.clientY\n        self.last_zoom_ratio = self.zoom_ratio\n        return\n      }\n\n      const maskRect = self.maskCanvas.getBoundingClientRect()\n      const x =\n        (event.offsetX || event.targetTouches[0].clientX - maskRect.left) /\n        self.zoom_ratio\n      const y =\n        (event.offsetY || event.targetTouches[0].clientY - maskRect.top) /\n        self.zoom_ratio\n\n      if (!event.altKey && event.button == 0) {\n        self.init_shape(self, CompositionOperation.SourceOver)\n      } else {\n        self.init_shape(self, CompositionOperation.DestinationOut)\n      }\n      self.draw_shape(self, x, y, brush_size)\n      self.lastx = x\n      self.lasty = y\n      self.lasttime = performance.now()\n    }\n  }\n\n  // @ts-expect-error fixme ts strict error\n  init_shape(self, compositionOperation) {\n    self.maskCtx.beginPath()\n    if (compositionOperation == CompositionOperation.SourceOver) {\n      self.maskCtx.fillStyle = this.getMaskFillStyle()\n      self.maskCtx.globalCompositeOperation = CompositionOperation.SourceOver\n    } else if (compositionOperation == CompositionOperation.DestinationOut) {\n      self.maskCtx.globalCompositeOperation =\n        CompositionOperation.DestinationOut\n    }\n  }\n\n  // @ts-expect-error fixme ts strict error\n  draw_shape(self, x, y, brush_size) {\n    if (self.pointer_type === PointerType.Rect) {\n      self.maskCtx.rect(\n        x - brush_size,\n        y - brush_size,\n        brush_size * 2,\n        brush_size * 2\n      )\n    } else {\n      self.maskCtx.arc(x, y, brush_size, 0, Math.PI * 2, false)\n    }\n    self.maskCtx.fill()\n  }\n\n  async save() {\n    const backupCanvas = document.createElement('canvas')\n    const backupCtx = backupCanvas.getContext('2d', {\n      willReadFrequently: true\n    })\n    backupCanvas.width = this.image.width\n    backupCanvas.height = this.image.height\n\n    // @ts-expect-error fixme ts strict error\n    backupCtx.clearRect(0, 0, backupCanvas.width, backupCanvas.height)\n    // @ts-expect-error fixme ts strict error\n    backupCtx.drawImage(\n      this.maskCanvas,\n      0,\n      0,\n      this.maskCanvas.width,\n      this.maskCanvas.height,\n      0,\n      0,\n      backupCanvas.width,\n      backupCanvas.height\n    )\n\n    // paste mask data into alpha channel\n    // @ts-expect-error fixme ts strict error\n    const backupData = backupCtx.getImageData(\n      0,\n      0,\n      backupCanvas.width,\n      backupCanvas.height\n    )\n\n    // refine mask image\n    for (let i = 0; i < backupData.data.length; i += 4) {\n      if (backupData.data[i + 3] == 255) backupData.data[i + 3] = 0\n      else backupData.data[i + 3] = 255\n\n      backupData.data[i] = 0\n      backupData.data[i + 1] = 0\n      backupData.data[i + 2] = 0\n    }\n\n    // @ts-expect-error fixme ts strict error\n    backupCtx.globalCompositeOperation = CompositionOperation.SourceOver\n    // @ts-expect-error fixme ts strict error\n    backupCtx.putImageData(backupData, 0, 0)\n\n    const formData = new FormData()\n    const filename = 'clipspace-mask-' + performance.now() + '.png'\n\n    const item = {\n      filename: filename,\n      subfolder: 'clipspace',\n      type: 'input'\n    }\n\n    // @ts-expect-error fixme ts strict error\n    if (ComfyApp.clipspace.images) ComfyApp.clipspace.images[0] = item\n\n    // @ts-expect-error fixme ts strict error\n    if (ComfyApp.clipspace.widgets) {\n      // @ts-expect-error fixme ts strict error\n      const index = ComfyApp.clipspace.widgets.findIndex(\n        (obj) => obj.name === 'image'\n      )\n\n      // @ts-expect-error fixme ts strict error\n      if (index >= 0) ComfyApp.clipspace.widgets[index].value = item\n    }\n\n    const dataURL = backupCanvas.toDataURL()\n    const blob = dataURLToBlob(dataURL)\n\n    let original_url = new URL(this.image.src)\n\n    type Ref = { filename: string; subfolder?: string; type?: string }\n\n    const original_ref: Ref = {\n      // @ts-expect-error fixme ts strict error\n      filename: original_url.searchParams.get('filename')\n    }\n\n    let original_subfolder = original_url.searchParams.get('subfolder')\n    if (original_subfolder) original_ref.subfolder = original_subfolder\n\n    let original_type = original_url.searchParams.get('type')\n    if (original_type) original_ref.type = original_type\n\n    formData.append('image', blob, filename)\n    formData.append('original_ref', JSON.stringify(original_ref))\n    formData.append('type', 'input')\n    formData.append('subfolder', 'clipspace')\n\n    this.saveButton.innerText = 'Saving...'\n    this.saveButton.disabled = true\n    await uploadMask(item, formData)\n    ComfyApp.onClipspaceEditorSave()\n    this.close()\n  }\n}\n","import _ from 'es-toolkit/compat'\nimport type { LGraphNode } from '@/lib/litegraph/src/litegraph'\n\nimport { app } from '@/scripts/app'\nimport { ComfyApp } from '@/scripts/app'\nimport { useMaskEditorStore } from '@/stores/maskEditorStore'\nimport { useDialogStore } from '@/stores/dialogStore'\nimport MaskEditorContent from '@/components/maskeditor/MaskEditorContent.vue'\nimport TopBarHeader from '@/components/maskeditor/dialog/TopBarHeader.vue'\nimport { MaskEditorDialogOld } from './maskEditorOld'\nimport { ClipspaceDialog } from './clipspace'\n\nfunction openMaskEditor(node: LGraphNode): void {\n  if (!node) {\n    console.error('[MaskEditor] No node provided')\n    return\n  }\n\n  if (!node.imgs?.length && node.previewMediaType !== 'image') {\n    console.error('[MaskEditor] Node has no images')\n    return\n  }\n\n  const useNewEditor = app.extensionManager.setting.get(\n    'Comfy.MaskEditor.UseNewEditor'\n  )\n\n  if (useNewEditor) {\n    // Use new refactored editor\n    useDialogStore().showDialog({\n      key: 'global-mask-editor',\n      headerComponent: TopBarHeader,\n      component: MaskEditorContent,\n      props: {\n        node\n      },\n      dialogComponentProps: {\n        style: 'width: 90vw; height: 90vh;',\n        modal: true,\n        maximizable: true,\n        closable: true,\n        pt: {\n          root: {\n            class: 'mask-editor-dialog flex flex-col'\n          },\n          content: {\n            class: 'flex flex-col min-h-0 flex-1 !p-0'\n          },\n          header: {\n            class: '!p-2'\n          }\n        }\n      }\n    })\n  } else {\n    // Use old editor\n    ComfyApp.copyToClipspace(node)\n    // @ts-expect-error clipspace_return_node is an extension property added at runtime\n    ComfyApp.clipspace_return_node = node\n    const dlg = MaskEditorDialogOld.getInstance() as any\n    if (dlg?.isOpened && !dlg.isOpened()) {\n      dlg.show()\n    }\n  }\n}\n\n// Check if the dialog is already opened\nfunction isOpened(): boolean {\n  const useNewEditor = app.extensionManager.setting.get(\n    'Comfy.MaskEditor.UseNewEditor'\n  )\n  if (useNewEditor) {\n    return useDialogStore().isDialogOpen('global-mask-editor')\n  } else {\n    return (MaskEditorDialogOld.instance as any)?.isOpened?.() ?? false\n  }\n}\n\napp.registerExtension({\n  name: 'Comfy.MaskEditor',\n  settings: [\n    {\n      id: 'Comfy.MaskEditor.UseNewEditor',\n      category: ['Mask Editor', 'NewEditor'],\n      name: 'Use new mask editor',\n      tooltip: 'Switch to the new mask editor interface',\n      type: 'boolean',\n      defaultValue: true,\n      experimental: true\n    },\n    {\n      id: 'Comfy.MaskEditor.BrushAdjustmentSpeed',\n      category: ['Mask Editor', 'BrushAdjustment', 'Sensitivity'],\n      name: 'Brush adjustment speed multiplier',\n      tooltip:\n        'Controls how quickly the brush size and hardness change when adjusting. Higher values mean faster changes.',\n      experimental: true,\n      type: 'slider',\n      attrs: {\n        min: 0.1,\n        max: 2.0,\n        step: 0.1\n      },\n      defaultValue: 1.0,\n      versionAdded: '1.0.0'\n    },\n    {\n      id: 'Comfy.MaskEditor.UseDominantAxis',\n      category: ['Mask Editor', 'BrushAdjustment', 'UseDominantAxis'],\n      name: 'Lock brush adjustment to dominant axis',\n      tooltip:\n        'When enabled, brush adjustments will only affect size OR hardness based on which direction you move more',\n      type: 'boolean',\n      defaultValue: true,\n      experimental: true\n    }\n  ],\n  commands: [\n    {\n      id: 'Comfy.MaskEditor.OpenMaskEditor',\n      icon: 'pi pi-pencil',\n      label: 'Open Mask Editor for Selected Node',\n      function: () => {\n        const selectedNodes = app.canvas.selected_nodes\n        if (!selectedNodes || Object.keys(selectedNodes).length !== 1) return\n\n        const selectedNode = selectedNodes[Object.keys(selectedNodes)[0]]\n        openMaskEditor(selectedNode)\n      }\n    },\n    {\n      id: 'Comfy.MaskEditor.BrushSize.Increase',\n      icon: 'pi pi-plus-circle',\n      label: 'Increase Brush Size in MaskEditor',\n      function: () => changeBrushSize((old) => _.clamp(old + 4, 1, 100))\n    },\n    {\n      id: 'Comfy.MaskEditor.BrushSize.Decrease',\n      icon: 'pi pi-minus-circle',\n      label: 'Decrease Brush Size in MaskEditor',\n      function: () => changeBrushSize((old) => _.clamp(old - 4, 1, 100))\n    }\n  ],\n  init() {\n    // Support for old editor clipspace integration\n    const openMaskEditorFromClipspace = () => {\n      const useNewEditor = app.extensionManager.setting.get(\n        'Comfy.MaskEditor.UseNewEditor'\n      )\n      if (!useNewEditor) {\n        const dlg = MaskEditorDialogOld.getInstance() as any\n        if (dlg?.isOpened && !dlg.isOpened()) {\n          dlg.show()\n        }\n      }\n    }\n\n    const context_predicate = (): boolean => {\n      return !!(\n        ComfyApp.clipspace &&\n        ComfyApp.clipspace.imgs &&\n        ComfyApp.clipspace.imgs.length > 0\n      )\n    }\n\n    ClipspaceDialog.registerButton(\n      'MaskEditor',\n      context_predicate,\n      openMaskEditorFromClipspace\n    )\n  }\n})\n\nconst changeBrushSize = async (sizeChanger: (oldSize: number) => number) => {\n  if (!isOpened()) return\n\n  const store = useMaskEditorStore()\n  const oldBrushSize = store.brushSettings.size\n  const newBrushSize = sizeChanger(oldBrushSize)\n  store.setBrushSize(newBrushSize)\n}\n","import { without } from 'es-toolkit'\n\nimport { useChainCallback } from '@/composables/functional/useChainCallback'\nimport type { LGraphNode } from '@/lib/litegraph/src/LGraphNode'\nimport { LiteGraph } from '@/lib/litegraph/src/litegraph'\nimport type { LLink } from '@/lib/litegraph/src/LLink'\nimport type { ISlotType } from '@/lib/litegraph/src/interfaces'\nimport { app } from '@/scripts/app'\n\nconst MATCH_TYPE = 'COMFY_MATCHTYPE_V3'\n\napp.registerExtension({\n  name: 'Comfy.MatchType',\n  beforeRegisterNodeDef(nodeType, nodeData) {\n    const inputs = {\n      ...nodeData.input?.required,\n      ...nodeData.input?.optional\n    }\n    if (!Object.values(inputs).some((w) => w[0] === MATCH_TYPE)) return\n    nodeType.prototype.onNodeCreated = useChainCallback(\n      nodeType.prototype.onNodeCreated,\n      function (this: LGraphNode) {\n        const inputGroups: Record<string, [string, ISlotType][]> = {}\n        const outputGroups: Record<string, number[]> = {}\n        for (const input of this.inputs) {\n          if (input.type !== MATCH_TYPE) continue\n          const template = inputs[input.name][1]?.template\n          if (!template) continue\n          input.type = template.allowed_types ?? '*'\n          inputGroups[template.template_id] ??= []\n          inputGroups[template.template_id].push([input.name, input.type])\n        }\n        this.outputs.forEach((output, i) => {\n          if (output.type !== MATCH_TYPE) return\n          const id = nodeData.output_matchtypes?.[i]\n          if (id == undefined) return\n          outputGroups[id] ??= []\n          outputGroups[id].push(i)\n        })\n        for (const groupId in inputGroups) {\n          addConnectionGroup(this, inputGroups[groupId], outputGroups[groupId])\n        }\n      }\n    )\n  }\n})\nfunction addConnectionGroup(\n  node: LGraphNode,\n  inputPairs: [string, ISlotType][],\n  outputs?: number[]\n) {\n  const connectedTypes: ISlotType[] = new Array(inputPairs.length).fill('*')\n  node.onConnectionsChange = useChainCallback(\n    node.onConnectionsChange,\n    function (\n      this: LGraphNode,\n      contype: ISlotType,\n      slot: number,\n      iscon: boolean,\n      linf: LLink | null | undefined\n    ) {\n      const input = this.inputs[slot]\n      if (contype !== LiteGraph.INPUT || !this.graph || !input) return\n      const pairIndex = inputPairs.findIndex(([name]) => name === input.name)\n      if (pairIndex == -1) return\n      connectedTypes[pairIndex] = inputPairs[pairIndex][1]\n      if (iscon && linf) {\n        const { output, subgraphInput } = linf.resolve(this.graph)\n        const connectingType = (output ?? subgraphInput)?.type\n        if (connectingType)\n          linf.type = connectedTypes[pairIndex] = connectingType\n      }\n      //An input slot can accept a connection that is\n      // - Compatible with original type\n      // - Compatible with all other input types\n      //An output slot can output\n      // - Only what every input can output\n      for (let i = 0; i < inputPairs.length; i++) {\n        //NOTE: This isn't great. Originally, I kept direct references to each\n        //input, but these were becoming orphaned\n        const input = this.inputs.find((inp) => inp.name === inputPairs[i][0])\n        if (!input) continue\n        const otherConnected = [...connectedTypes]\n        otherConnected.splice(i, 1)\n        const validType = combineTypes(...otherConnected, inputPairs[i][1])\n        if (!validType) throw new Error('invalid connection')\n        input.type = validType\n      }\n      if (outputs) {\n        const outputType = combineTypes(...connectedTypes)\n        if (!outputType) throw new Error('invalid connection')\n        changeOutputType(this, outputType, outputs)\n      }\n    }\n  )\n}\n\nfunction changeOutputType(\n  node: LGraphNode,\n  combinedType: ISlotType,\n  outputs: number[]\n) {\n  if (!node.graph) return\n  for (const index of outputs) {\n    if (node.outputs[index].type === combinedType) continue\n    node.outputs[index].type = combinedType\n\n    //check and potentially remove links\n    for (let link_id of node.outputs[index].links ?? []) {\n      let link = node.graph.links[link_id]\n      if (!link) continue\n      const { input, inputNode, subgraphOutput } = link.resolve(node.graph)\n      const inputType = (input ?? subgraphOutput)?.type\n      if (!inputType) continue\n      const keep = LiteGraph.isValidConnection(combinedType, inputType)\n      if (!keep && subgraphOutput) subgraphOutput.disconnect()\n      else if (!keep && inputNode) inputNode.disconnectInput(link.target_slot)\n      if (input && inputNode?.onConnectionsChange)\n        inputNode.onConnectionsChange(\n          LiteGraph.INPUT,\n          link.target_slot,\n          keep,\n          link,\n          input\n        )\n    }\n    app.canvas.setDirty(true, true)\n  }\n}\nfunction isStrings(types: ISlotType[]): types is string[] {\n  return !types.some((t) => typeof t !== 'string')\n}\n\nfunction combineTypes(...types: ISlotType[]): ISlotType | undefined {\n  if (!isStrings(types)) return undefined\n\n  const withoutWildcards = without(types, '*')\n  if (withoutWildcards.length === 0) return '*'\n\n  const typeLists: string[][] = withoutWildcards.map((type) => type.split(','))\n\n  const combinedTypes = intersection(...typeLists)\n  if (combinedTypes.length === 0) return undefined\n\n  return combinedTypes.join(',')\n}\nfunction intersection(...sets: string[][]): string[] {\n  const itemCounts: Record<string, number> = {}\n  for (const set of sets)\n    for (const item of new Set(set))\n      itemCounts[item] = (itemCounts[item] ?? 0) + 1\n  return Object.entries(itemCounts)\n    .filter(([, count]) => count == sets.length)\n    .map(([key]) => key)\n}\n","import { downloadBlob } from '@/base/common/downloadUtil'\nimport { t } from '@/i18n'\nimport type { IContextMenuValue } from '@/lib/litegraph/src/interfaces'\nimport type { LGraphCanvas } from '@/lib/litegraph/src/litegraph'\nimport { useToastStore } from '@/platform/updates/common/toastStore'\nimport { useDialogService } from '@/services/dialogService'\nimport type { ComfyExtension } from '@/types/comfy'\nimport { deserialiseAndCreate } from '@/utils/vintageClipboard'\n\nimport { api } from '../../scripts/api'\nimport { app } from '../../scripts/app'\nimport { $el, ComfyDialog } from '../../scripts/ui'\nimport { GroupNodeConfig, GroupNodeHandler } from './groupNode'\n\n// Adds the ability to save and add multiple nodes as a template\n// To save:\n// Select multiple nodes (ctrl + drag to select a region or ctrl+click individual nodes)\n// Right click the canvas\n// Save Node Template -> give it a name\n//\n// To add:\n// Right click the canvas\n// Node templates -> click the one to add\n//\n// To delete/rename:\n// Right click the canvas\n// Node templates -> Manage\n//\n// To rearrange:\n// Open the manage dialog and Drag and drop elements using the \"Name:\" label as handle\n\nconst id = 'Comfy.NodeTemplates'\nconst file = 'comfy.templates.json'\n\nclass ManageTemplates extends ComfyDialog {\n  // @ts-expect-error fixme ts strict error\n  templates: any[]\n  draggedEl: HTMLElement | null\n  saveVisualCue: number | null\n  emptyImg: HTMLImageElement\n  importInput: HTMLInputElement\n\n  constructor() {\n    super()\n    this.load().then((v) => {\n      this.templates = v\n    })\n\n    this.element.classList.add('comfy-manage-templates')\n    this.draggedEl = null\n    this.saveVisualCue = null\n    this.emptyImg = new Image()\n    this.emptyImg.src =\n      'data:image/gif;base64,R0lGODlhAQABAIAAAAUEBAAAACwAAAAAAQABAAACAkQBADs='\n\n    this.importInput = $el('input', {\n      type: 'file',\n      accept: '.json',\n      multiple: true,\n      style: { display: 'none' },\n      parent: document.body,\n      onchange: () => this.importAll()\n    }) as HTMLInputElement\n  }\n\n  override createButtons() {\n    const btns = super.createButtons()\n    btns[0].textContent = 'Close'\n    btns[0].onclick = () => {\n      // @ts-expect-error fixme ts strict error\n      clearTimeout(this.saveVisualCue)\n      this.close()\n    }\n    btns.unshift(\n      $el('button', {\n        type: 'button',\n        textContent: 'Export',\n        onclick: () => this.exportAll()\n      })\n    )\n    btns.unshift(\n      $el('button', {\n        type: 'button',\n        textContent: 'Import',\n        onclick: () => {\n          this.importInput.click()\n        }\n      })\n    )\n    return btns\n  }\n\n  async load() {\n    let templates = []\n    const res = await api.getUserData(file)\n    if (res.status === 200) {\n      try {\n        templates = await res.json()\n      } catch (error) {}\n    } else if (res.status !== 404) {\n      console.error(res.status + ' ' + res.statusText)\n    }\n    return templates ?? []\n  }\n\n  async store() {\n    const templates = JSON.stringify(this.templates, undefined, 4)\n    try {\n      await api.storeUserData(file, templates, { stringify: false })\n    } catch (error) {\n      console.error(error)\n      // @ts-expect-error fixme ts strict error\n      useToastStore().addAlert(error.message)\n    }\n  }\n\n  async importAll() {\n    // @ts-expect-error fixme ts strict error\n    for (const file of this.importInput.files) {\n      if (file.type === 'application/json' || file.name.endsWith('.json')) {\n        const reader = new FileReader()\n        reader.onload = async () => {\n          const importFile = JSON.parse(reader.result as string)\n          if (importFile?.templates) {\n            for (const template of importFile.templates) {\n              if (template?.name && template?.data) {\n                this.templates.push(template)\n              }\n            }\n            await this.store()\n          }\n        }\n        await reader.readAsText(file)\n      }\n    }\n\n    // @ts-expect-error fixme ts strict error\n    this.importInput.value = null\n\n    this.close()\n  }\n\n  exportAll() {\n    if (this.templates.length == 0) {\n      useToastStore().addAlert(t('toastMessages.noTemplatesToExport'))\n      return\n    }\n\n    const json = JSON.stringify({ templates: this.templates }, null, 2) // convert the data to a JSON string\n    const blob = new Blob([json], { type: 'application/json' })\n    downloadBlob('node_templates.json', blob)\n  }\n\n  override show() {\n    // Show list of template names + delete button\n    super.show(\n      $el(\n        'div',\n        {},\n        this.templates.flatMap((t, i) => {\n          // @ts-expect-error fixme ts strict error\n          let nameInput\n          return [\n            $el(\n              'div',\n              {\n                dataset: { id: i.toString() },\n                className: 'templateManagerRow',\n                style: {\n                  display: 'grid',\n                  gridTemplateColumns: '1fr auto',\n                  border: '1px dashed transparent',\n                  gap: '5px',\n                  backgroundColor: 'var(--comfy-menu-bg)'\n                },\n                // @ts-expect-error fixme ts strict error\n                ondragstart: (e) => {\n                  this.draggedEl = e.currentTarget\n                  e.currentTarget.style.opacity = '0.6'\n                  e.currentTarget.style.border = '1px dashed yellow'\n                  e.dataTransfer.effectAllowed = 'move'\n                  e.dataTransfer.setDragImage(this.emptyImg, 0, 0)\n                },\n                // @ts-expect-error fixme ts strict error\n                ondragend: (e) => {\n                  e.target.style.opacity = '1'\n                  e.currentTarget.style.border = '1px dashed transparent'\n                  e.currentTarget.removeAttribute('draggable')\n\n                  // rearrange the elements\n                  this.element\n                    .querySelectorAll('.templateManagerRow')\n                    // @ts-expect-error fixme ts strict error\n                    .forEach((el: HTMLElement, i) => {\n                      // @ts-expect-error fixme ts strict error\n                      var prev_i = Number.parseInt(el.dataset.id)\n\n                      if (el == this.draggedEl && prev_i != i) {\n                        this.templates.splice(\n                          i,\n                          0,\n                          this.templates.splice(prev_i, 1)[0]\n                        )\n                      }\n                      el.dataset.id = i.toString()\n                    })\n                  this.store()\n                },\n                // @ts-expect-error fixme ts strict error\n                ondragover: (e) => {\n                  e.preventDefault()\n                  if (e.currentTarget == this.draggedEl) return\n\n                  let rect = e.currentTarget.getBoundingClientRect()\n                  if (e.clientY > rect.top + rect.height / 2) {\n                    e.currentTarget.parentNode.insertBefore(\n                      this.draggedEl,\n                      e.currentTarget.nextSibling\n                    )\n                  } else {\n                    e.currentTarget.parentNode.insertBefore(\n                      this.draggedEl,\n                      e.currentTarget\n                    )\n                  }\n                }\n              },\n              [\n                $el(\n                  'label',\n                  {\n                    textContent: 'Name: ',\n                    style: {\n                      cursor: 'grab'\n                    },\n                    // @ts-expect-error fixme ts strict error\n                    onmousedown: (e) => {\n                      // enable dragging only from the label\n                      if (e.target.localName == 'label')\n                        e.currentTarget.parentNode.draggable = 'true'\n                    }\n                  },\n                  [\n                    $el('input', {\n                      value: t.name,\n                      dataset: { name: t.name },\n                      style: {\n                        transitionProperty: 'background-color',\n                        transitionDuration: '0s'\n                      },\n                      // @ts-expect-error fixme ts strict error\n                      onchange: (e) => {\n                        // @ts-expect-error fixme ts strict error\n                        clearTimeout(this.saveVisualCue)\n                        var el = e.target\n                        var row = el.parentNode.parentNode\n                        this.templates[row.dataset.id].name =\n                          el.value.trim() || 'untitled'\n                        this.store()\n                        el.style.backgroundColor = 'rgb(40, 95, 40)'\n                        el.style.transitionDuration = '0s'\n                        // @ts-expect-error\n                        // In browser env the return value is number.\n                        this.saveVisualCue = setTimeout(function () {\n                          el.style.transitionDuration = '.7s'\n                          el.style.backgroundColor = 'var(--comfy-input-bg)'\n                        }, 15)\n                      },\n                      // @ts-expect-error fixme ts strict error\n                      onkeypress: (e) => {\n                        var el = e.target\n                        // @ts-expect-error fixme ts strict error\n                        clearTimeout(this.saveVisualCue)\n                        el.style.transitionDuration = '0s'\n                        el.style.backgroundColor = 'var(--comfy-input-bg)'\n                      },\n                      $: (el) => (nameInput = el)\n                    })\n                  ]\n                ),\n                $el('div', {}, [\n                  $el('button', {\n                    textContent: 'Export',\n                    style: {\n                      fontSize: '12px',\n                      fontWeight: 'normal'\n                    },\n                    onclick: () => {\n                      const json = JSON.stringify({ templates: [t] }, null, 2) // convert the data to a JSON string\n                      const blob = new Blob([json], {\n                        type: 'application/json'\n                      })\n                      // @ts-expect-error fixme ts strict error\n                      const name = (nameInput.value || t.name) + '.json'\n                      downloadBlob(name, blob)\n                    }\n                  }),\n                  $el('button', {\n                    textContent: 'Delete',\n                    style: {\n                      fontSize: '12px',\n                      color: 'red',\n                      fontWeight: 'normal'\n                    },\n                    // @ts-expect-error fixme ts strict error\n                    onclick: (e) => {\n                      const item = e.target.parentNode.parentNode\n                      item.parentNode.removeChild(item)\n                      this.templates.splice(item.dataset.id * 1, 1)\n                      this.store()\n                      // update the rows index, setTimeout ensures that the list is updated\n                      var that = this\n                      setTimeout(function () {\n                        that.element\n                          .querySelectorAll('.templateManagerRow')\n                          // @ts-expect-error fixme ts strict error\n                          .forEach((el: HTMLElement, i) => {\n                            el.dataset.id = i.toString()\n                          })\n                      }, 0)\n                    }\n                  })\n                ])\n              ]\n            )\n          ]\n        })\n      )\n    )\n  }\n}\n\nconst manage = new ManageTemplates()\n\n// @ts-expect-error fixme ts strict error\nconst clipboardAction = async (cb) => {\n  // We use the clipboard functions but dont want to overwrite the current user clipboard\n  // Restore it after we've run our callback\n  const old = localStorage.getItem('litegrapheditor_clipboard')\n  await cb()\n  // @ts-expect-error fixme ts strict error\n  localStorage.setItem('litegrapheditor_clipboard', old)\n}\n\nconst ext: ComfyExtension = {\n  name: id,\n\n  getCanvasMenuItems(_canvas: LGraphCanvas): IContextMenuValue[] {\n    const items: IContextMenuValue[] = []\n\n    // @ts-expect-error fixme ts strict error\n    items.push(null)\n    items.push({\n      content: `Save Selected as Template`,\n      disabled: !Object.keys(app.canvas.selected_nodes || {}).length,\n      callback: async () => {\n        const name = await useDialogService().prompt({\n          title: t('nodeTemplates.saveAsTemplate'),\n          message: t('nodeTemplates.enterName'),\n          defaultValue: ''\n        })\n        if (!name?.trim()) return\n\n        clipboardAction(() => {\n          app.canvas.copyToClipboard()\n          let data = localStorage.getItem('litegrapheditor_clipboard')\n          data = JSON.parse(data || '{}')\n          const nodeIds = Object.keys(app.canvas.selected_nodes)\n          for (let i = 0; i < nodeIds.length; i++) {\n            const node = app.graph.getNodeById(nodeIds[i])\n            const nodeData = node?.constructor.nodeData\n\n            let groupData = GroupNodeHandler.getGroupData(node)\n            if (groupData) {\n              groupData = groupData.nodeData\n              // @ts-expect-error\n              if (!data.groupNodes) {\n                // @ts-expect-error\n                data.groupNodes = {}\n              }\n              if (nodeData == null) throw new TypeError('nodeData is not set')\n              // @ts-expect-error\n              data.groupNodes[nodeData.name] = groupData\n              // @ts-expect-error\n              data.nodes[i].type = nodeData.name\n            }\n          }\n\n          manage.templates.push({\n            name,\n            data: JSON.stringify(data)\n          })\n          manage.store()\n        })\n      }\n    })\n\n    // Map each template to a menu item\n    const subItems = manage.templates.map((t) => {\n      return {\n        content: t.name,\n        callback: () => {\n          clipboardAction(async () => {\n            const data = JSON.parse(t.data)\n            await GroupNodeConfig.registerFromWorkflow(data.groupNodes, {})\n\n            // Check for old clipboard format\n            if (!data.reroutes) {\n              deserialiseAndCreate(t.data, app.canvas)\n            } else {\n              localStorage.setItem('litegrapheditor_clipboard', t.data)\n              app.canvas.pasteFromClipboard()\n            }\n          })\n        }\n      }\n    })\n\n    // @ts-expect-error fixme ts strict error\n    subItems.push(null, {\n      content: 'Manage',\n      callback: () => manage.show()\n    })\n\n    items.push({\n      content: 'Node Templates',\n      submenu: {\n        options: subItems\n      }\n    })\n\n    return items\n  }\n}\n\napp.registerExtension(ext)\n","import { LGraphCanvas, LiteGraph } from '@/lib/litegraph/src/litegraph'\nimport { LGraphNode } from '@/lib/litegraph/src/litegraph'\n\nimport { app } from '../../scripts/app'\nimport { ComfyWidgets } from '../../scripts/widgets'\n\n// Node that add notes to your project\n\napp.registerExtension({\n  name: 'Comfy.NoteNode',\n  registerCustomNodes() {\n    class NoteNode extends LGraphNode {\n      static override category: string\n      static collapsable: boolean\n      static title_mode: number\n\n      override color = LGraphCanvas.node_colors.yellow.color\n      override bgcolor = LGraphCanvas.node_colors.yellow.bgcolor\n      groupcolor = LGraphCanvas.node_colors.yellow.groupcolor\n      override isVirtualNode: boolean\n\n      constructor(title: string) {\n        super(title)\n        if (!this.properties) {\n          this.properties = { text: '' }\n        }\n        ComfyWidgets.STRING(\n          this,\n          'text',\n          ['STRING', { default: this.properties.text, multiline: true }],\n          app\n        )\n\n        this.serialize_widgets = true\n        this.isVirtualNode = true\n      }\n    }\n\n    // Load default visibility\n\n    LiteGraph.registerNodeType(\n      'Note',\n      Object.assign(NoteNode, {\n        title_mode: LiteGraph.NORMAL_TITLE,\n        title: 'Note',\n        collapsable: true\n      })\n    )\n\n    NoteNode.category = 'utils'\n\n    /** Markdown variant of NoteNode */\n    class MarkdownNoteNode extends LGraphNode {\n      static override title = 'Markdown Note'\n\n      override color = LGraphCanvas.node_colors.yellow.color\n      override bgcolor = LGraphCanvas.node_colors.yellow.bgcolor\n      groupcolor = LGraphCanvas.node_colors.yellow.groupcolor\n\n      constructor(title: string) {\n        super(title)\n        if (!this.properties) {\n          this.properties = { text: '' }\n        }\n        ComfyWidgets.MARKDOWN(\n          this,\n          'text',\n          ['STRING', { default: this.properties.text }],\n          app\n        )\n\n        this.serialize_widgets = true\n        this.isVirtualNode = true\n      }\n    }\n\n    LiteGraph.registerNodeType('MarkdownNote', MarkdownNoteNode)\n    MarkdownNoteNode.category = 'utils'\n  }\n})\n","/*\nPreview Any - original implement from\nhttps://github.com/rgthree/rgthree-comfy/blob/main/py/display_any.py\nupstream requested in https://github.com/Kosinkadink/rfcs/blob/main/rfcs/0000-corenodes.md#preview-nodes\n */\nimport { app } from '@/scripts/app'\nimport { type DOMWidget } from '@/scripts/domWidget'\nimport { ComfyWidgets } from '@/scripts/widgets'\nimport { useExtensionService } from '@/services/extensionService'\n\nuseExtensionService().registerExtension({\n  name: 'Comfy.PreviewAny',\n  async beforeRegisterNodeDef(nodeType, nodeData) {\n    if (nodeData.name === 'PreviewAny') {\n      const onNodeCreated = nodeType.prototype.onNodeCreated\n\n      nodeType.prototype.onNodeCreated = function () {\n        onNodeCreated ? onNodeCreated.apply(this, []) : undefined\n\n        const showValueWidget = ComfyWidgets['STRING'](\n          this,\n          'preview',\n          ['STRING', { multiline: true }],\n          app\n        ).widget as DOMWidget<any, any>\n\n        showValueWidget.element.readOnly = true\n\n        showValueWidget.serialize = false\n      }\n\n      const onExecuted = nodeType.prototype.onExecuted\n\n      nodeType.prototype.onExecuted = function (message) {\n        onExecuted === null || onExecuted === void 0\n          ? void 0\n          : onExecuted.apply(this, [message])\n\n        const previewWidget = this.widgets?.find((w) => w.name === 'preview')\n\n        if (previewWidget) {\n          previewWidget.value = message.text[0]\n        }\n      }\n    }\n  }\n})\n","import type { IContextMenuValue } from '@/lib/litegraph/src/litegraph'\nimport {\n  LGraphCanvas,\n  LGraphNode,\n  LiteGraph\n} from '@/lib/litegraph/src/litegraph'\nimport type { ISlotType } from '@/lib/litegraph/src/interfaces'\n\nimport { app } from '../../scripts/app'\nimport { getWidgetConfig, mergeIfValid, setWidgetConfig } from './widgetInputs'\n\n// Node that allows you to redirect connections for cleaner graphs\n\napp.registerExtension({\n  name: 'Comfy.RerouteNode',\n  registerCustomNodes(app) {\n    interface RerouteNode extends LGraphNode {\n      __outputType?: string | number\n    }\n\n    class RerouteNode extends LGraphNode {\n      static override category: string | undefined\n      static defaultVisibility = false\n\n      constructor(title?: string) {\n        super(title ?? '')\n        if (!this.properties) {\n          this.properties = {}\n        }\n        this.properties.showOutputText = RerouteNode.defaultVisibility\n        this.properties.horizontal = false\n\n        this.addInput('', '*')\n        this.addOutput(this.properties.showOutputText ? '*' : '', '*')\n\n        // This node is purely frontend and does not impact the resulting prompt so should not be serialized\n        this.isVirtualNode = true\n      }\n      override onAfterGraphConfigured() {\n        requestAnimationFrame(() => {\n          this.onConnectionsChange(LiteGraph.INPUT, undefined, true)\n        })\n      }\n      override clone(): LGraphNode | null {\n        const cloned = super.clone()\n        if (!cloned) return cloned\n        cloned.removeOutput(0)\n        cloned.addOutput(this.properties.showOutputText ? '*' : '', '*')\n        cloned.setSize(cloned.computeSize())\n        return cloned\n      }\n      override onConnectionsChange(\n        type: ISlotType,\n        _index: number | undefined,\n        connected: boolean\n      ) {\n        const { graph } = this\n        if (!graph) return\n        if (app.configuringGraph) return\n\n        // Prevent multiple connections to different types when we have no input\n        if (connected && type === LiteGraph.OUTPUT) {\n          // Ignore wildcard nodes as these will be updated to real types\n          const types = new Set(\n            this.outputs[0].links\n              ?.map((l) => graph.links[l]?.type)\n              ?.filter((t) => t && t !== '*') ?? []\n          )\n          if (types.size > 1) {\n            const linksToDisconnect = []\n            for (const linkId of this.outputs[0].links ?? []) {\n              const link = graph.links[linkId]\n              linksToDisconnect.push(link)\n            }\n            linksToDisconnect.pop()\n            for (const link of linksToDisconnect) {\n              const node = graph.getNodeById(link.target_id)\n              node?.disconnectInput(link.target_slot)\n            }\n          }\n        }\n\n        // Find root input\n        let currentNode: RerouteNode | null = this\n        let updateNodes: RerouteNode[] = []\n        let inputType = null\n        let inputNode = null\n        while (currentNode) {\n          updateNodes.unshift(currentNode)\n          const linkId = currentNode.inputs[0].link\n          if (linkId !== null) {\n            const link = graph.links[linkId]\n            if (!link) return\n            const node = graph.getNodeById(link.origin_id)\n            if (!node) return\n            if (node instanceof RerouteNode) {\n              if (node === this) {\n                // We've found a circle\n                currentNode.disconnectInput(link.target_slot)\n                currentNode = null\n              } else {\n                // Move the previous node\n                currentNode = node\n              }\n            } else {\n              // We've found the end\n              inputNode = currentNode\n              inputType = node.outputs[link.origin_slot]?.type ?? null\n              break\n            }\n          } else {\n            // This path has no input node\n            currentNode = null\n            break\n          }\n        }\n\n        // Find all outputs\n        const nodes: RerouteNode[] = [this]\n        let outputType = null\n        while (nodes.length) {\n          currentNode = nodes.pop()!\n          const outputs = currentNode.outputs?.[0]?.links ?? []\n          for (const linkId of outputs) {\n            const link = graph.links[linkId]\n\n            // When disconnecting sometimes the link is still registered\n            if (!link) continue\n\n            const node = graph.getNodeById(link.target_id)\n            if (!node) continue\n            if (node instanceof RerouteNode) {\n              // Follow reroute nodes\n              nodes.push(node)\n              updateNodes.push(node)\n            } else {\n              // We've found an output\n              const nodeInput = node.inputs[link.target_slot]\n              const nodeOutType = nodeInput.type\n              const keep =\n                !inputType ||\n                !nodeOutType ||\n                LiteGraph.isValidConnection(inputType, nodeOutType)\n              if (!keep) {\n                // The output doesnt match our input so disconnect it\n                node.disconnectInput(link.target_slot)\n                continue\n              }\n              node.onConnectionsChange?.(\n                LiteGraph.INPUT,\n                link.target_slot,\n                keep,\n                link,\n                nodeInput\n              )\n              outputType = node.inputs[link.target_slot].type\n            }\n          }\n        }\n\n        const displayType = inputType || outputType || '*'\n        const color = LGraphCanvas.link_type_colors[displayType]\n\n        let widgetConfig\n        let widgetType\n        // Update the types of each node\n        for (const node of updateNodes) {\n          // If we dont have an input type we are always wildcard but we'll show the output type\n          // This lets you change the output link to a different type and all nodes will update\n          node.outputs[0].type = inputType || '*'\n          node.__outputType = displayType\n          node.outputs[0].name = node.properties.showOutputText\n            ? `${displayType}`\n            : ''\n          node.setSize(node.computeSize())\n\n          for (const l of node.outputs[0].links || []) {\n            const link = graph.links[l]\n            if (!link) continue\n            link.color = color\n\n            if (app.configuringGraph) continue\n            const targetNode = graph.getNodeById(link.target_id)\n            if (!targetNode) continue\n            const targetInput = targetNode.inputs?.[link.target_slot]\n            if (targetInput?.widget) {\n              const config = getWidgetConfig(targetInput)\n              if (!widgetConfig) {\n                widgetConfig = config[1] ?? {}\n                widgetType = config[0]\n              }\n\n              const merged = mergeIfValid(targetInput, [\n                config[0],\n                widgetConfig\n              ])\n              if (merged.customConfig) {\n                widgetConfig = merged.customConfig\n              }\n            }\n          }\n        }\n\n        for (const node of updateNodes) {\n          if (widgetConfig && outputType) {\n            node.inputs[0].widget = { name: 'value' }\n            setWidgetConfig(node.inputs[0], [\n              widgetType ?? `${displayType}`,\n              widgetConfig\n            ])\n          } else {\n            setWidgetConfig(node.inputs[0], undefined)\n          }\n        }\n\n        if (inputNode?.inputs?.[0]?.link) {\n          const link = graph.links[inputNode.inputs[0].link]\n          if (link) {\n            link.color = color\n          }\n        }\n      }\n\n      override getExtraMenuOptions(\n        _: unknown,\n        options: (IContextMenuValue | null)[]\n      ): IContextMenuValue[] {\n        options.unshift(\n          {\n            content:\n              (this.properties.showOutputText ? 'Hide' : 'Show') + ' Type',\n            callback: () => {\n              this.properties.showOutputText = !this.properties.showOutputText\n              if (this.properties.showOutputText) {\n                this.outputs[0].name = `${this.__outputType || this.outputs[0].type}`\n              } else {\n                this.outputs[0].name = ''\n              }\n              this.setSize(this.computeSize())\n              app.canvas.setDirty(true, true)\n            }\n          },\n          {\n            content:\n              (RerouteNode.defaultVisibility ? 'Hide' : 'Show') +\n              ' Type By Default',\n            callback: () => {\n              RerouteNode.setDefaultTextVisibility(\n                !RerouteNode.defaultVisibility\n              )\n            }\n          }\n        )\n        return []\n      }\n      override computeSize(): [number, number] {\n        return [\n          this.properties.showOutputText && this.outputs && this.outputs.length\n            ? Math.max(\n                75,\n                LiteGraph.NODE_TEXT_SIZE * this.outputs[0].name.length * 0.6 +\n                  40\n              )\n            : 75,\n          26\n        ]\n      }\n\n      static setDefaultTextVisibility(visible: boolean) {\n        RerouteNode.defaultVisibility = visible\n        if (visible) {\n          localStorage['Comfy.RerouteNode.DefaultVisibility'] = 'true'\n        } else {\n          delete localStorage['Comfy.RerouteNode.DefaultVisibility']\n        }\n      }\n    }\n\n    // Load default visibility\n    RerouteNode.setDefaultTextVisibility(\n      !!localStorage['Comfy.RerouteNode.DefaultVisibility']\n    )\n\n    LiteGraph.registerNodeType(\n      'Reroute',\n      Object.assign(RerouteNode, {\n        title_mode: LiteGraph.NO_TITLE,\n        title: 'Reroute',\n        collapsable: false\n      })\n    )\n\n    RerouteNode.category = 'utils'\n  }\n})\n","import { applyTextReplacements } from '@/utils/searchAndReplace'\n\nimport { app } from '../../scripts/app'\n\nconst saveNodeTypes = new Set([\n  'SaveImage',\n  'SaveVideo',\n  'SaveAnimatedWEBP',\n  'SaveWEBM',\n  'SaveAudio',\n  'SaveGLB',\n  'SaveAnimatedPNG',\n  'CLIPSave',\n  'VAESave',\n  'ModelSave',\n  'LoraSave',\n  'SaveLatent'\n])\n\n// Use widget values and dates in output filenames\n\napp.registerExtension({\n  name: 'Comfy.SaveImageExtraOutput',\n  async beforeRegisterNodeDef(nodeType, nodeData, app) {\n    if (saveNodeTypes.has(nodeData.name)) {\n      const onNodeCreated = nodeType.prototype.onNodeCreated\n      // When the SaveImage node is created we want to override the serialization of the output name widget to run our S&R\n      nodeType.prototype.onNodeCreated = function () {\n        const r = onNodeCreated\n          ? // @ts-expect-error fixme ts strict error\n            onNodeCreated.apply(this, arguments)\n          : undefined\n\n        // @ts-expect-error fixme ts strict error\n        const widget = this.widgets.find((w) => w.name === 'filename_prefix')\n        // @ts-expect-error fixme ts strict error\n        widget.serializeValue = () => {\n          // @ts-expect-error fixme ts strict error\n          return applyTextReplacements(app.graph, widget.value)\n        }\n\n        return r\n      }\n    } else {\n      // When any other node is created add a property to alias the node\n      const onNodeCreated = nodeType.prototype.onNodeCreated\n      nodeType.prototype.onNodeCreated = function () {\n        const r = onNodeCreated\n          ? // @ts-expect-error fixme ts strict error\n            onNodeCreated.apply(this, arguments)\n          : undefined\n\n        if (!this.properties || !('Node name for S&R' in this.properties)) {\n          this.addProperty('Node name for S&R', this.constructor.type, 'string')\n        }\n\n        return r\n      }\n    }\n  }\n})\n","import { nextTick } from 'vue'\n\nimport Load3D from '@/components/load3d/Load3D.vue'\nimport { useLoad3d } from '@/composables/useLoad3d'\nimport { createExportMenuItems } from '@/extensions/core/load3d/exportMenuHelper'\nimport Load3DConfiguration from '@/extensions/core/load3d/Load3DConfiguration'\nimport type { LGraphNode } from '@/lib/litegraph/src/LGraphNode'\nimport type { IContextMenuValue } from '@/lib/litegraph/src/interfaces'\nimport { type CustomInputSpec } from '@/schemas/nodeDef/nodeDefSchemaV2'\nimport { ComponentWidgetImpl, addWidget } from '@/scripts/domWidget'\nimport { useExtensionService } from '@/services/extensionService'\nimport { useLoad3dService } from '@/services/load3dService'\n\nconst inputSpec: CustomInputSpec = {\n  name: 'image',\n  type: 'Preview3D',\n  isPreview: true\n}\n\nuseExtensionService().registerExtension({\n  name: 'Comfy.SaveGLB',\n\n  async beforeRegisterNodeDef(_nodeType, nodeData) {\n    if ('SaveGLB' === nodeData.name) {\n      // @ts-expect-error InputSpec is not typed correctly\n      nodeData.input.required.image = ['PREVIEW_3D']\n    }\n  },\n\n  getCustomWidgets() {\n    return {\n      PREVIEW_3D(node) {\n        const widget = new ComponentWidgetImpl({\n          node,\n          name: inputSpec.name,\n          component: Load3D,\n          inputSpec,\n          options: {}\n        })\n\n        widget.type = 'load3D'\n\n        addWidget(node, widget)\n\n        return { widget }\n      }\n    }\n  },\n\n  getNodeMenuItems(node: LGraphNode): (IContextMenuValue | null)[] {\n    // Only show menu items for SaveGLB nodes\n    if (node.constructor.comfyClass !== 'SaveGLB') return []\n\n    const load3d = useLoad3dService().getLoad3d(node)\n    if (!load3d) return []\n\n    return createExportMenuItems(load3d)\n  },\n\n  async nodeCreated(node) {\n    if (node.constructor.comfyClass !== 'SaveGLB') return\n\n    const [oldWidth, oldHeight] = node.size\n\n    node.setSize([Math.max(oldWidth, 400), Math.max(oldHeight, 550)])\n\n    await nextTick()\n\n    const onExecuted = node.onExecuted\n\n    node.onExecuted = function (message: any) {\n      onExecuted?.apply(this, arguments as any)\n\n      const fileInfo = message['3d'][0]\n\n      useLoad3d(node).waitForLoad3d((load3d) => {\n        const modelWidget = node.widgets?.find((w) => w.name === 'image')\n\n        if (load3d && modelWidget) {\n          const filePath = fileInfo['subfolder'] + '/' + fileInfo['filename']\n\n          modelWidget.value = filePath\n\n          const config = new Load3DConfiguration(load3d, node.properties)\n\n          config.configureForSaveMesh(fileInfo['type'], filePath)\n        }\n      })\n    }\n  }\n})\n","import { type LGraphCanvas, createBounds } from '@/lib/litegraph/src/litegraph'\nimport { app } from '@/scripts/app'\n\n/**\n * Draws a dashed border around selected items that maintains constant pixel size\n * regardless of zoom level, similar to the DOM selection overlay.\n */\nfunction drawSelectionBorder(\n  ctx: CanvasRenderingContext2D,\n  canvas: LGraphCanvas\n) {\n  const selectedItems = canvas.selectedItems\n\n  // Only draw if multiple items selected\n  if (selectedItems.size <= 1) return\n\n  // Use the same bounds calculation as the toolbox\n  const bounds = createBounds(selectedItems, 10)\n  if (!bounds) return\n\n  const [x, y, width, height] = bounds\n\n  // Save context state\n  ctx.save()\n\n  // Set up dashed line style that doesn't scale with zoom\n  const borderWidth = 2 / canvas.ds.scale // Constant 2px regardless of zoom\n  ctx.lineWidth = borderWidth\n  ctx.strokeStyle =\n    getComputedStyle(document.documentElement)\n      .getPropertyValue('--border-color')\n      .trim() || '#ffffff66'\n\n  // Create dash pattern that maintains visual size\n  const dashSize = 5 / canvas.ds.scale\n  ctx.setLineDash([dashSize, dashSize])\n\n  // Draw the border using the bounds directly\n  ctx.beginPath()\n  ctx.roundRect(x, y, width, height, 8 / canvas.ds.scale)\n  ctx.stroke()\n\n  // Restore context\n  ctx.restore()\n}\n\n/**\n * Extension that adds a dashed selection border for multiple selected nodes\n */\nconst ext = {\n  name: 'Comfy.SelectionBorder',\n\n  async init() {\n    // Hook into the canvas drawing\n    const originalDrawForeground = app.canvas.onDrawForeground\n\n    app.canvas.onDrawForeground = function (\n      ctx: CanvasRenderingContext2D,\n      visibleArea: any\n    ) {\n      // Call original if it exists\n      originalDrawForeground?.call(this, ctx, visibleArea)\n\n      // Draw our selection border\n      drawSelectionBorder(ctx, app.canvas)\n    }\n  }\n}\n\napp.registerExtension(ext)\n","import { LGraphCanvas, LiteGraph } from '@/lib/litegraph/src/litegraph'\n\nimport { app } from '../../scripts/app'\n\nlet touchZooming = false\nlet touchCount = 0\n\napp.registerExtension({\n  name: 'Comfy.SimpleTouchSupport',\n  setup() {\n    let touchDist: number | null = null\n    let touchTime: Date | null = null\n    let lastTouch: { clientX: number; clientY: number } | null = null\n    let lastScale: number | null = null\n    function getMultiTouchPos(e: TouchEvent) {\n      return Math.hypot(\n        e.touches[0].clientX - e.touches[1].clientX,\n        e.touches[0].clientY - e.touches[1].clientY\n      )\n    }\n\n    function getMultiTouchCenter(e: TouchEvent) {\n      return {\n        clientX: (e.touches[0].clientX + e.touches[1].clientX) / 2,\n        clientY: (e.touches[0].clientY + e.touches[1].clientY) / 2\n      }\n    }\n\n    app.canvasEl.parentElement?.addEventListener(\n      'touchstart',\n      (e: TouchEvent) => {\n        touchCount += e.changedTouches.length\n\n        lastTouch = null\n        lastScale = null\n        if (e.touches?.length === 1) {\n          // Store start time for press+hold for context menu\n          touchTime = new Date()\n          lastTouch = e.touches[0]\n        } else {\n          touchTime = null\n          if (e.touches?.length === 2) {\n            // Store center pos for zoom\n            lastScale = app.canvas.ds.scale\n            lastTouch = getMultiTouchCenter(e)\n\n            touchDist = getMultiTouchPos(e)\n            app.canvas.pointer.isDown = false\n          }\n        }\n      },\n      true\n    )\n\n    app.canvasEl.parentElement?.addEventListener(\n      'touchend',\n      (e: TouchEvent) => {\n        touchCount -= e.changedTouches.length\n\n        if (e.touches?.length !== 1) touchZooming = false\n        if (touchTime && !e.touches?.length) {\n          if (new Date().getTime() - touchTime.getTime() > 600) {\n            if (e.target === app.canvasEl) {\n              const touch = {\n                button: 2, // Right click\n                clientX: e.changedTouches[0].clientX,\n                clientY: e.changedTouches[0].clientY,\n                pointerId: 1, // changedTouches' id is 0, set it to any number\n                isPrimary: true // changedTouches' isPrimary is false, so set it to true\n              }\n              // context menu info set in 'pointerdown' event\n              app.canvasEl.dispatchEvent(new PointerEvent('pointerdown', touch))\n              // then, context menu open after 'pointerup' event\n              setTimeout(() => {\n                app.canvasEl.dispatchEvent(new PointerEvent('pointerup', touch))\n              })\n              e.preventDefault()\n            }\n          }\n          touchTime = null\n        }\n      }\n    )\n\n    app.canvasEl.parentElement?.addEventListener(\n      'touchmove',\n      (e) => {\n        // make a threshold for touchmove to prevent clear touchTime for long press\n        if (touchTime && lastTouch && e.touches?.length === 1) {\n          const onlyTouch = e.touches[0]\n          const deltaX = onlyTouch.clientX - lastTouch.clientX\n          const deltaY = onlyTouch.clientY - lastTouch.clientY\n          if (deltaX * deltaX + deltaY * deltaY > 30) {\n            touchTime = null\n          }\n        }\n        if (e.touches?.length === 2 && lastTouch && !e.ctrlKey && !e.shiftKey) {\n          e.preventDefault() // Prevent browser from zooming when two textareas are touched\n          app.canvas.pointer.isDown = false\n          touchZooming = true\n\n          LiteGraph.closeAllContextMenus(window)\n          // @ts-expect-error\n          app.canvas.search_box?.close()\n          const newTouchDist = getMultiTouchPos(e)\n\n          const center = getMultiTouchCenter(e)\n\n          if (lastScale === null || touchDist === null) return\n          let scale = (lastScale * newTouchDist) / touchDist\n\n          const newX = (center.clientX - lastTouch.clientX) / scale\n          const newY = (center.clientY - lastTouch.clientY) / scale\n\n          // Code from LiteGraph\n          if (scale < app.canvas.ds.min_scale) {\n            scale = app.canvas.ds.min_scale\n          } else if (scale > app.canvas.ds.max_scale) {\n            scale = app.canvas.ds.max_scale\n          }\n\n          const oldScale = app.canvas.ds.scale\n\n          app.canvas.ds.scale = scale\n\n          // Code from LiteGraph\n          if (Math.abs(app.canvas.ds.scale - 1) < 0.01) {\n            app.canvas.ds.scale = 1\n          }\n\n          const newScale = app.canvas.ds.scale\n\n          const convertScaleToOffset = (scale: number) => [\n            center.clientX / scale - app.canvas.ds.offset[0],\n            center.clientY / scale - app.canvas.ds.offset[1]\n          ]\n          var oldCenter = convertScaleToOffset(oldScale)\n          var newCenter = convertScaleToOffset(newScale)\n\n          app.canvas.ds.offset[0] += newX + newCenter[0] - oldCenter[0]\n          app.canvas.ds.offset[1] += newY + newCenter[1] - oldCenter[1]\n\n          lastTouch.clientX = center.clientX\n          lastTouch.clientY = center.clientY\n\n          app.canvas.setDirty(true, true)\n        }\n      },\n      true\n    )\n  }\n})\n\nconst processMouseDown = LGraphCanvas.prototype.processMouseDown\nLGraphCanvas.prototype.processMouseDown = function (e: PointerEvent) {\n  if (touchZooming || touchCount) {\n    return\n  }\n  app.canvas.pointer.isDown = false // Prevent context menu from opening on second tap\n  return processMouseDown.apply(this, [e])\n}\n\nconst processMouseMove = LGraphCanvas.prototype.processMouseMove\nLGraphCanvas.prototype.processMouseMove = function (e: PointerEvent) {\n  if (touchZooming || touchCount > 1) {\n    return\n  }\n  return processMouseMove.apply(this, [e])\n}\n","import { LiteGraph } from '@/lib/litegraph/src/litegraph'\n\nimport { app } from '../../scripts/app'\nimport { ComfyWidgets } from '../../scripts/widgets'\n\n// Adds defaults for quickly adding nodes with middle click on the input/output\n\napp.registerExtension({\n  name: 'Comfy.SlotDefaults',\n  suggestionsNumber: null,\n  init() {\n    LiteGraph.search_filter_enabled = true\n    LiteGraph.middle_click_slot_add_default_node = true\n    this.suggestionsNumber = app.ui.settings.addSetting({\n      id: 'Comfy.NodeSuggestions.number',\n      category: ['Comfy', 'Node Search Box', 'NodeSuggestions'],\n      name: 'Number of nodes suggestions',\n      tooltip: 'Only for litegraph searchbox/context menu',\n      type: 'slider',\n      attrs: {\n        min: 1,\n        max: 100,\n        step: 1\n      },\n      defaultValue: 5,\n      onChange: (newVal) => {\n        this.setDefaults(newVal)\n      }\n    })\n  },\n  slot_types_default_out: {},\n  slot_types_default_in: {},\n  async beforeRegisterNodeDef(nodeType, nodeData) {\n    var nodeId = nodeData.name\n    const inputs = nodeData['input']?.['required'] //only show required inputs to reduce the mess also not logical to create node with optional inputs\n    for (const inputKey in inputs) {\n      var input = inputs[inputKey]\n      if (typeof input[0] !== 'string') continue\n\n      var type = input[0]\n      if (type in ComfyWidgets) {\n        var customProperties = input[1]\n        if (!customProperties?.forceInput) continue //ignore widgets that don't force input\n      }\n\n      if (!(type in this.slot_types_default_out)) {\n        this.slot_types_default_out[type] = ['Reroute']\n      }\n      if (this.slot_types_default_out[type].includes(nodeId)) continue\n      this.slot_types_default_out[type].push(nodeId)\n\n      // Input types have to be stored as lower case\n      // Store each node that can handle this input type\n      const lowerType = type.toLocaleLowerCase()\n      if (!(lowerType in LiteGraph.registered_slot_in_types)) {\n        LiteGraph.registered_slot_in_types[lowerType] = { nodes: [] }\n      }\n      LiteGraph.registered_slot_in_types[lowerType].nodes.push(\n        // @ts-expect-error ComfyNode\n        nodeType.comfyClass\n      )\n    }\n\n    var outputs = nodeData['output'] ?? []\n    for (const el of outputs) {\n      const type = el as string\n      if (!(type in this.slot_types_default_in)) {\n        this.slot_types_default_in[type] = ['Reroute']\n      }\n\n      if (this.slot_types_default_in[type].includes(nodeId)) continue\n      this.slot_types_default_in[type].push(nodeId)\n\n      // Store each node that can handle this output type\n      if (!(type in LiteGraph.registered_slot_out_types)) {\n        LiteGraph.registered_slot_out_types[type] = { nodes: [] }\n      }\n      // @ts-expect-error ComfyNode\n      LiteGraph.registered_slot_out_types[type].nodes.push(nodeType.comfyClass)\n\n      if (!LiteGraph.slot_types_out.includes(type)) {\n        LiteGraph.slot_types_out.push(type)\n      }\n    }\n\n    var maxNum = this.suggestionsNumber.value\n    this.setDefaults(maxNum)\n  },\n  setDefaults(maxNum?: number | null) {\n    LiteGraph.slot_types_default_out = {}\n    LiteGraph.slot_types_default_in = {}\n\n    for (const type in this.slot_types_default_out) {\n      LiteGraph.slot_types_default_out[type] = this.slot_types_default_out[\n        type\n      ].slice(0, maxNum)\n    }\n    for (const type in this.slot_types_default_in) {\n      LiteGraph.slot_types_default_in[type] = this.slot_types_default_in[\n        type\n      ].slice(0, maxNum)\n    }\n  }\n})\n","import { MediaRecorder as ExtendableMediaRecorder } from 'extendable-media-recorder'\n\nimport { useChainCallback } from '@/composables/functional/useChainCallback'\nimport { useNodeDragAndDrop } from '@/composables/node/useNodeDragAndDrop'\nimport { useNodeFileInput } from '@/composables/node/useNodeFileInput'\nimport { useNodePaste } from '@/composables/node/useNodePaste'\nimport { t } from '@/i18n'\nimport type { LGraphNode } from '@/lib/litegraph/src/litegraph'\nimport type {\n  IBaseWidget,\n  IStringWidget\n} from '@/lib/litegraph/src/types/widgets'\nimport { useToastStore } from '@/platform/updates/common/toastStore'\nimport {\n  getResourceURL,\n  splitFilePath\n} from '@/renderer/extensions/vueNodes/widgets/utils/audioUtils'\nimport type { ComfyNodeDef } from '@/schemas/nodeDefSchema'\nimport type { DOMWidget } from '@/scripts/domWidget'\nimport { useAudioService } from '@/services/audioService'\nimport { type NodeLocatorId } from '@/types'\nimport { getNodeByLocatorId } from '@/utils/graphTraversalUtil'\n\nimport { api } from '../../scripts/api'\nimport { app } from '../../scripts/app'\n\nasync function uploadFile(\n  audioWidget: IStringWidget,\n  audioUIWidget: DOMWidget<HTMLAudioElement, string>,\n  file: File,\n  updateNode: boolean,\n  pasted: boolean = false\n) {\n  try {\n    // Wrap file in formdata so it includes filename\n    const body = new FormData()\n    body.append('image', file)\n    if (pasted) body.append('subfolder', 'pasted')\n    const resp = await api.fetchApi('/upload/image', {\n      method: 'POST',\n      body\n    })\n\n    if (resp.status === 200) {\n      const data = await resp.json()\n      // Add the file to the dropdown list and update the widget value\n      let path = data.name\n      if (data.subfolder) path = data.subfolder + '/' + path\n\n      // @ts-expect-error fixme ts strict error\n      if (!audioWidget.options.values.includes(path)) {\n        // @ts-expect-error fixme ts strict error\n        audioWidget.options.values.push(path)\n      }\n\n      if (updateNode) {\n        audioUIWidget.element.src = api.apiURL(\n          getResourceURL(...splitFilePath(path))\n        )\n        audioWidget.value = path\n\n        // Manually trigger the callback to update VueNodes\n        audioWidget.callback?.(path)\n      }\n    } else {\n      useToastStore().addAlert(resp.status + ' - ' + resp.statusText)\n    }\n  } catch (error) {\n    // @ts-expect-error fixme ts strict error\n    useToastStore().addAlert(error)\n  }\n}\n\n// AudioWidget MUST be registered first, as AUDIOUPLOAD depends on AUDIO_UI to be\n// present.\napp.registerExtension({\n  name: 'Comfy.AudioWidget',\n  async beforeRegisterNodeDef(nodeType, nodeData) {\n    if (\n      [\n        'LoadAudio',\n        'SaveAudio',\n        'PreviewAudio',\n        'SaveAudioMP3',\n        'SaveAudioOpus'\n      ].includes(\n        // @ts-expect-error fixme ts strict error\n        nodeType.prototype.comfyClass\n      )\n    ) {\n      // @ts-expect-error fixme ts strict error\n      nodeData.input.required.audioUI = ['AUDIO_UI', {}]\n    }\n  },\n  getCustomWidgets() {\n    return {\n      AUDIO_UI(node: LGraphNode, inputName: string) {\n        const audio = document.createElement('audio')\n        audio.controls = true\n        audio.classList.add('comfy-audio')\n        audio.setAttribute('name', 'media')\n\n        const audioUIWidget: DOMWidget<HTMLAudioElement, string> =\n          node.addDOMWidget(inputName, /* name=*/ 'audioUI', audio)\n        audioUIWidget.serialize = false\n        const { nodeData } = node.constructor\n        if (nodeData == null) throw new TypeError('nodeData is null')\n\n        const isOutputNode = nodeData.output_node\n        if (isOutputNode) {\n          // Hide the audio widget when there is no audio initially.\n          audioUIWidget.element.classList.add('empty-audio-widget')\n          // Populate the audio widget UI on node execution.\n          const onExecuted = node.onExecuted\n          node.onExecuted = function (message: any) {\n            // @ts-expect-error fixme ts strict error\n            onExecuted?.apply(this, arguments)\n            const audios = message.audio\n            if (!audios) return\n            const audio = audios[0]\n            audioUIWidget.element.src = api.apiURL(\n              getResourceURL(audio.subfolder, audio.filename, audio.type)\n            )\n            audioUIWidget.element.classList.remove('empty-audio-widget')\n          }\n        }\n\n        audioUIWidget.onRemove = useChainCallback(\n          audioUIWidget.onRemove,\n          () => {\n            if (!audioUIWidget.element) return\n            audioUIWidget.element.pause()\n            audioUIWidget.element.src = ''\n            audioUIWidget.element.remove()\n          }\n        )\n\n        return { widget: audioUIWidget }\n      }\n    }\n  },\n  onNodeOutputsUpdated(nodeOutputs: Record<NodeLocatorId, any>) {\n    for (const [nodeLocatorId, output] of Object.entries(nodeOutputs)) {\n      if ('audio' in output) {\n        const node = getNodeByLocatorId(app.graph, nodeLocatorId)\n        if (!node) continue\n\n        // @ts-expect-error fixme ts strict error\n        const audioUIWidget = node.widgets.find(\n          (w) => w.name === 'audioUI'\n        ) as unknown as DOMWidget<HTMLAudioElement, string>\n        const audio = output.audio[0]\n        audioUIWidget.element.src = api.apiURL(\n          getResourceURL(audio.subfolder, audio.filename, audio.type)\n        )\n        audioUIWidget.element.classList.remove('empty-audio-widget')\n      }\n    }\n  }\n})\n\napp.registerExtension({\n  name: 'Comfy.UploadAudio',\n  async beforeRegisterNodeDef(_nodeType, nodeData: ComfyNodeDef) {\n    if (nodeData?.input?.required?.audio?.[1]?.audio_upload === true) {\n      nodeData.input.required.upload = ['AUDIOUPLOAD', {}]\n    }\n  },\n  getCustomWidgets() {\n    return {\n      AUDIOUPLOAD(node, inputName: string) {\n        // The widget that allows user to select file.\n        // @ts-expect-error fixme ts strict error\n        const audioWidget = node.widgets.find(\n          (w) => w.name === 'audio'\n        ) as IStringWidget\n        // @ts-expect-error fixme ts strict error\n        const audioUIWidget = node.widgets.find(\n          (w) => w.name === 'audioUI'\n        ) as unknown as DOMWidget<HTMLAudioElement, string>\n        audioUIWidget.options.canvasOnly = true\n\n        const onAudioWidgetUpdate = () => {\n          if (typeof audioWidget.value !== 'string') return\n          audioUIWidget.element.src = api.apiURL(\n            getResourceURL(...splitFilePath(audioWidget.value))\n          )\n        }\n        // Initially load default audio file to audioUIWidget.\n        if (audioWidget.value) {\n          onAudioWidgetUpdate()\n        }\n        audioWidget.callback = onAudioWidgetUpdate\n\n        // Load saved audio file widget values if restoring from workflow\n        const onGraphConfigured = node.onGraphConfigured\n        node.onGraphConfigured = function () {\n          // @ts-expect-error fixme ts strict error\n          onGraphConfigured?.apply(this, arguments)\n          if (audioWidget.value) {\n            onAudioWidgetUpdate()\n          }\n        }\n\n        const handleUpload = async (files: File[]) => {\n          if (files?.length) {\n            uploadFile(audioWidget, audioUIWidget, files[0], true)\n          }\n          return files\n        }\n\n        const isAudioFile = (file: File) => file.type.startsWith('audio/')\n\n        const { openFileSelection } = useNodeFileInput(node, {\n          accept: 'audio/*',\n          onSelect: handleUpload\n        })\n\n        // The widget to pop up the upload dialog.\n        const uploadWidget = node.addWidget(\n          'button',\n          inputName,\n          '',\n          openFileSelection,\n          { serialize: false, canvasOnly: true }\n        )\n        uploadWidget.label = t('g.choose_file_to_upload')\n\n        useNodeDragAndDrop(node, {\n          fileFilter: isAudioFile,\n          onDrop: handleUpload\n        })\n\n        useNodePaste(node, {\n          fileFilter: isAudioFile,\n          onPaste: handleUpload\n        })\n\n        node.previewMediaType = 'audio'\n\n        return { widget: uploadWidget }\n      }\n    }\n  }\n})\n\napp.registerExtension({\n  name: 'Comfy.RecordAudio',\n\n  getCustomWidgets() {\n    return {\n      AUDIO_RECORD(node, inputName: string) {\n        const audio = document.createElement('audio')\n        audio.controls = true\n        audio.classList.add('comfy-audio')\n        audio.setAttribute('name', 'media')\n        const audioUIWidget: DOMWidget<HTMLAudioElement, string> =\n          node.addDOMWidget(inputName, /* name=*/ 'audioUI', audio)\n        audioUIWidget.options.canvasOnly = false\n\n        let mediaRecorder: MediaRecorder | null = null\n        let isRecording = false\n        let audioChunks: Blob[] = []\n        let currentStream: MediaStream | null = null\n        let recordWidget: IBaseWidget | null = null\n\n        let stopPromise: Promise<void> | null = null\n        let stopResolve: (() => void) | null = null\n\n        audioUIWidget.serializeValue = async () => {\n          if (isRecording && mediaRecorder) {\n            stopPromise = new Promise((resolve) => {\n              stopResolve = resolve\n            })\n\n            mediaRecorder.stop()\n\n            await stopPromise\n          }\n\n          const audioSrc = audioUIWidget.element.src\n\n          if (!audioSrc) {\n            useToastStore().addAlert(t('g.noAudioRecorded'))\n            return ''\n          }\n\n          const blob = await fetch(audioSrc).then((r) => r.blob())\n\n          return await useAudioService().convertBlobToFileAndSubmit(blob)\n        }\n\n        recordWidget = node.addWidget(\n          'button',\n          inputName,\n          '',\n          async () => {\n            if (!isRecording) {\n              try {\n                currentStream = await navigator.mediaDevices.getUserMedia({\n                  audio: true\n                })\n\n                mediaRecorder = new ExtendableMediaRecorder(currentStream, {\n                  mimeType: 'audio/wav'\n                }) as unknown as MediaRecorder\n\n                audioChunks = []\n\n                mediaRecorder.ondataavailable = (event) => {\n                  audioChunks.push(event.data)\n                }\n\n                mediaRecorder.onstop = async () => {\n                  const audioBlob = new Blob(audioChunks, { type: 'audio/wav' })\n\n                  useAudioService().stopAllTracks(currentStream)\n\n                  if (\n                    audioUIWidget.element.src &&\n                    audioUIWidget.element.src.startsWith('blob:')\n                  ) {\n                    URL.revokeObjectURL(audioUIWidget.element.src)\n                  }\n\n                  audioUIWidget.element.src = URL.createObjectURL(audioBlob)\n\n                  isRecording = false\n\n                  if (recordWidget) {\n                    recordWidget.label = t('g.startRecording')\n                  }\n\n                  if (stopResolve) {\n                    stopResolve()\n                    stopResolve = null\n                    stopPromise = null\n                  }\n                }\n\n                mediaRecorder.onerror = (event) => {\n                  console.error('MediaRecorder error:', event)\n                  useAudioService().stopAllTracks(currentStream)\n                  isRecording = false\n\n                  if (recordWidget) {\n                    recordWidget.label = t('g.startRecording')\n                  }\n\n                  if (stopResolve) {\n                    stopResolve()\n                    stopResolve = null\n                    stopPromise = null\n                  }\n                }\n\n                mediaRecorder.start()\n                isRecording = true\n                if (recordWidget) {\n                  recordWidget.label = t('g.stopRecording')\n                }\n              } catch (err) {\n                console.error('Error accessing microphone:', err)\n                useToastStore().addAlert(t('g.micPermissionDenied'))\n\n                if (mediaRecorder) {\n                  try {\n                    mediaRecorder.stop()\n                  } catch {}\n                }\n                useAudioService().stopAllTracks(currentStream)\n                currentStream = null\n                isRecording = false\n                if (recordWidget) {\n                  recordWidget.label = t('g.startRecording')\n                }\n              }\n            } else if (mediaRecorder && isRecording) {\n              mediaRecorder.stop()\n            }\n          },\n          { serialize: false, canvasOnly: false }\n        )\n\n        recordWidget.label = t('g.startRecording')\n        // Override the type for Vue rendering while keeping 'button' for LiteGraph\n        recordWidget.type = 'audiorecord'\n\n        const originalOnRemoved = node.onRemoved\n        node.onRemoved = function () {\n          if (isRecording && mediaRecorder) {\n            mediaRecorder.stop()\n          }\n          useAudioService().stopAllTracks(currentStream)\n          if (audioUIWidget.element.src?.startsWith('blob:')) {\n            URL.revokeObjectURL(audioUIWidget.element.src)\n          }\n          originalOnRemoved?.call(this)\n        }\n\n        return { widget: recordWidget }\n      }\n    }\n  },\n\n  async nodeCreated(node) {\n    if (node.constructor.comfyClass !== 'RecordAudio') return\n\n    await useAudioService().registerWavEncoder()\n  }\n})\n","import {\n  type ComfyNodeDef,\n  type InputSpec,\n  isComboInputSpecV1\n} from '@/schemas/nodeDefSchema'\n\nimport { app } from '../../scripts/app'\n\n// Adds an upload button to the nodes\n\nconst isMediaUploadComboInput = (inputSpec: InputSpec) => {\n  const [inputName, inputOptions] = inputSpec\n  if (!inputOptions) return false\n\n  const isUploadInput =\n    inputOptions['image_upload'] === true ||\n    inputOptions['video_upload'] === true ||\n    inputOptions['animated_image_upload'] === true\n\n  return (\n    isUploadInput && (isComboInputSpecV1(inputSpec) || inputName === 'COMBO')\n  )\n}\n\nconst createUploadInput = (\n  imageInputName: string,\n  imageInputOptions: InputSpec\n): InputSpec => [\n  'IMAGEUPLOAD',\n  {\n    ...imageInputOptions[1],\n    imageInputName\n  }\n]\n\napp.registerExtension({\n  name: 'Comfy.UploadImage',\n  beforeRegisterNodeDef(_nodeType, nodeData: ComfyNodeDef) {\n    const { input } = nodeData ?? {}\n    const { required } = input ?? {}\n    if (!required) return\n\n    const found = Object.entries(required).find(([_, input]) =>\n      isMediaUploadComboInput(input)\n    )\n\n    // If media combo input found, attach upload input\n    if (found) {\n      const [inputName, inputSpec] = found\n      required.upload = createUploadInput(inputName, inputSpec)\n    }\n  }\n})\n","import { t } from '@/i18n'\nimport { useToastStore } from '@/platform/updates/common/toastStore'\n\nimport { api } from '../../scripts/api'\nimport { app } from '../../scripts/app'\n\nconst WEBCAM_READY = Symbol()\n\napp.registerExtension({\n  name: 'Comfy.WebcamCapture',\n  getCustomWidgets() {\n    return {\n      WEBCAM(node, inputName) {\n        // @ts-expect-error fixme ts strict error\n        let res\n        // @ts-expect-error fixme ts strict error\n        node[WEBCAM_READY] = new Promise((resolve) => (res = resolve))\n\n        const container = document.createElement('div')\n        container.style.background = 'rgba(0,0,0,0.25)'\n        container.style.textAlign = 'center'\n\n        const video = document.createElement('video')\n        video.style.height = video.style.width = '100%'\n\n        const loadVideo = async () => {\n          try {\n            const stream = await navigator.mediaDevices.getUserMedia({\n              video: true,\n              audio: false\n            })\n            container.replaceChildren(video)\n\n            // @ts-expect-error fixme ts strict error\n            setTimeout(() => res(video), 500) // Fallback as loadedmetadata doesnt fire sometimes?\n            // @ts-expect-error fixme ts strict error\n            video.addEventListener('loadedmetadata', () => res(video), false)\n            video.srcObject = stream\n            video.play()\n          } catch (error) {\n            const label = document.createElement('div')\n            label.style.color = 'red'\n            label.style.overflow = 'auto'\n            label.style.maxHeight = '100%'\n            label.style.whiteSpace = 'pre-wrap'\n\n            if (window.isSecureContext) {\n              label.textContent =\n                'Unable to load webcam, please ensure access is granted:\\n' +\n                // @ts-expect-error fixme ts strict error\n                error.message\n            } else {\n              label.textContent =\n                'Unable to load webcam. A secure context is required, if you are not accessing ComfyUI on localhost (127.0.0.1) you will have to enable TLS (https)\\n\\n' +\n                // @ts-expect-error fixme ts strict error\n                error.message\n            }\n\n            container.replaceChildren(label)\n          }\n        }\n\n        loadVideo()\n\n        return { widget: node.addDOMWidget(inputName, 'WEBCAM', container) }\n      }\n    }\n  },\n  nodeCreated(node) {\n    if ((node.type, node.constructor.comfyClass !== 'WebcamCapture')) return\n\n    // @ts-expect-error fixme ts strict error\n    let video\n    // @ts-expect-error fixme ts strict error\n    const camera = node.widgets.find((w) => w.name === 'image')\n    // @ts-expect-error fixme ts strict error\n    const w = node.widgets.find((w) => w.name === 'width')\n    // @ts-expect-error fixme ts strict error\n    const h = node.widgets.find((w) => w.name === 'height')\n    // @ts-expect-error fixme ts strict error\n    const captureOnQueue = node.widgets.find(\n      (w) => w.name === 'capture_on_queue'\n    )\n\n    const canvas = document.createElement('canvas')\n\n    const capture = () => {\n      // @ts-expect-error widget value type narrow down\n      canvas.width = w.value\n      // @ts-expect-error widget value type narrow down\n      canvas.height = h.value\n      const ctx = canvas.getContext('2d')\n      // @ts-expect-error widget value type narrow down\n      ctx.drawImage(video, 0, 0, w.value, h.value)\n      const data = canvas.toDataURL('image/png')\n\n      const img = new Image()\n      img.onload = () => {\n        node.imgs = [img]\n        app.graph.setDirtyCanvas(true)\n      }\n      img.src = data\n    }\n\n    const btn = node.addWidget(\n      'button',\n      'waiting for camera...',\n      'capture',\n      capture,\n      { canvasOnly: true }\n    )\n    btn.disabled = true\n    btn.serializeValue = () => undefined\n\n    // @ts-expect-error fixme ts strict error\n    camera.serializeValue = async () => {\n      // @ts-expect-error fixme ts strict error\n      if (captureOnQueue.value) {\n        capture()\n      } else if (!node.imgs?.length) {\n        const err = `No webcam image captured`\n        useToastStore().addAlert(err)\n        throw new Error(err)\n      }\n\n      // Upload image to temp storage\n      // @ts-expect-error fixme ts strict error\n      const blob = await new Promise<Blob>((r) => canvas.toBlob(r))\n      const name = `${+new Date()}.png`\n      const file = new File([blob], name)\n      const body = new FormData()\n      body.append('image', file)\n      body.append('subfolder', 'webcam')\n      body.append('type', 'temp')\n      const resp = await api.fetchApi('/upload/image', {\n        method: 'POST',\n        body\n      })\n      if (resp.status !== 200) {\n        const err = `Error uploading camera image: ${resp.status} - ${resp.statusText}`\n        useToastStore().addAlert(err)\n        throw new Error(err)\n      }\n      return `webcam/${name} [temp]`\n    }\n\n    // @ts-expect-error fixme ts strict error\n    node[WEBCAM_READY].then((v) => {\n      video = v\n      // If width isn't specified then use video output resolution\n      // @ts-expect-error fixme ts strict error\n      if (!w.value) {\n        // @ts-expect-error fixme ts strict error\n        w.value = video.videoWidth || 640\n        // @ts-expect-error fixme ts strict error\n        h.value = video.videoHeight || 480\n      }\n      btn.disabled = false\n      btn.label = t('g.capture')\n    })\n  }\n})\n","import { app } from '@/scripts/app'\nimport { type DOMWidget } from '@/scripts/domWidget'\nimport { ComfyWidgets } from '@/scripts/widgets'\nimport { useExtensionService } from '@/services/extensionService'\n\nuseExtensionService().registerExtension({\n  name: 'Comfy.LLMNodePreview',\n  async beforeRegisterNodeDef(nodeType, nodeData) {\n    if (nodeData.name === 'LLMNode') {\n      const onNodeCreated = nodeType.prototype.onNodeCreated\n\n      // 1.  onNodeCreated Widget\n      nodeType.prototype.onNodeCreated = function () {\n        //  onNodeCreated\n        onNodeCreated ? onNodeCreated.apply(this, []) : undefined\n\n        //  MARKDOWN  Widget \n        const showValueWidget = ComfyWidgets['MARKDOWN'](\n          this,\n          'preview', // \n          ['MARKDOWN', {}],\n          app\n        ).widget as DOMWidget<HTMLTextAreaElement, string>\n\n        showValueWidget.element.readOnly = true\n        // \n        showValueWidget.serialize = false\n      }\n\n      const onExecuted = nodeType.prototype.onExecuted\n\n      // 2.  onExecuted Widget\n      nodeType.prototype.onExecuted = function (message) {\n        //  onExecuted\n        onExecuted === null || onExecuted === void 0\n          ? void 0\n          : onExecuted.apply(this, [message])\n\n        //  Widget\n        const previewWidget = this.widgets?.find((w) => w.name === 'preview')\n\n        if (previewWidget && message.text && Array.isArray(message.text) && message.text.length > 0) {\n          previewWidget.value = message.text[0]\n        }\n      }\n    }\n  }\n})"],"names":["ClipspaceDialog","ComfyDialog","__name","name","contextPredicate","callback","item","$el","ComfyApp","img_preview","self","children","buttons","idx","combo_items","imgs","i","combo1","event","row1","combo2","row2","td","row3","app","ext","ctxMenu","LiteGraph","values","options","ctx","filter","items","displayedItems","itemCount","clickedComboValue","LGraphCanvas","w","isComboWidget","v","selectedIndex","selectedItem","updateSelected","positionList","scale","shift","term","isVisible","d","top","bodyRect","rootRect","useExtensionService","node","widgets","widget","workflowNode","widgetIndex","prompt","processDynamicPrompt","editAttentionDelta","incrementWeight","weight","delta","floatWeight","newWeight","findNearestEnclosure","text","cursorPos","start","end","openCount","closeCount","addWeightToParentheses","parenRegex","parenMatch","floatRegex","floatMatch","editAttention","inputField","selectedText","nearestEnclosure","delimiters","weightDelta","updatedText","_","PYTHON_MIRROR","checkMirrorReachable","mirror","isValidUrl","electronAPI","isElectron","getElectronAPI","desktopAppVersion","workflowStore","useWorkflowStore","toastStore","useToastStore","staticUrls","buildDocsUrl","useExternalLink","onChangeRestartApp","newValue","oldValue","updateInfo","t","useDialogService","error","log","ExecutableGroupNodeChildDTO","ExecutableNodeDTO","subgraphNodePath","nodesByExecutionId","subgraphNode","groupNodeHandler","slot","inputNode","link","inputNodeId","inputNodeDto","id","ORDER","merge","target","source","key","sv","tv","ManageGroupDialog","tab","index","force","PREFIX","SEPARATOR","GroupNodeHandler","group","reset","nodes","n","ordered","DraggableList","oldPosition","newPosition","props","nodeIndex","section","prop","value","groupMod","nodesMod","nodeMod","typeMod","objMod","placeholder","checked","checkable","mods","e","config","oldName","inputs","innerNodeDef","outputs","groupOutputs","type","groupOutputIndex","visible","groupNodes","b","pages","p","page","outer","g","nodesByType","recreateNodes","types","nodeMods","keys","orderedNodes","orderedMods","orderedConfig","order","l","GroupNodeConfig","IGNORE_KEYS","getRange","min","max","mergeNumericInputSpec","spec1","spec2","options1","options2","range1","range2","step1","step2","mergedOptions","lcm","mergeCommonInputSpec","mergeComboInputSpec","comboOptions1","getComboSpecComboOptions","comboOptions2","intersection","getInputSpecType","value1","value2","mergeInputSpec","type1","type2","isIntInputSpec","isFloatInputSpec","isComboInputSpec","isPrimitiveNode","replacePropertyName","PrimitiveNode","LGraphNode","title","extraLinks","links","applyTextReplacements","linkInfo","input","widgetName","GET_CONFIG","#onFirstConnection","#mergeWidgetConfig","_type","_index","connected","target_node","target_slot","ComfyWidgets","valid","#isValidConnection","recreating","linkId","theirNode","getWidgetType","#createWidget","CONFIG","inputData","oldWidth","oldHeight","theirWidget","control_value","addValueControlWidgets","controlValues","useChainCallback","sz","#removeWidgets","output","hasConfig","config1","theirInput","forceUpdate","config2","mergeIfValid","getWidgetConfig","getConfig","nodeData","convertToInput","setWidgetConfig","originNode","recreateWidget","customSpec","nodeType","_nodeData","isNodeAtPos","pos","origOnInputDblClick","args","Workflow","data","extra","GroupNodeBuilder","nodesInOrder","a","storeLinkTypes","storeExternalLinks","hasExternal","serialised","serialise","GROUP","seenInputs","seenOutputs","#convertedToProcess","useNodeDefStore","sourceNodeId","sourceNodeSlot","targetNodeId","targetNodeSlot","def","globalDefs","linksFrom","fromTypeName","fromType","linksTo","rerouteType","targetDef","targetWidget","inputName","customConfig","inp","prefix","inputNames","slots","converted","widgetMap","useWidgetStore","convertedIndex","__","primitiveDef","primitiveConfig","toPrimitive","toWidget","inputMap","convertedSlots","k","inputMapping","oldToNew","outputId","hasLink","label","o","missingNodeTypes","groupData","hasMissing","innerNodes","innerNodeIndex","innerNode","externalSlot","innerLink","computedNodeDtos","visited","subgraphInstanceIdPath","currentId","aVeryRealNode","groupNode","addInnerNodes","c","ids","deserialiseAndCreate","x","y","left","selectedIds","newNodes","newNode","map","newName","outerWidget","newWidget","reconnectInputs","innerInputId","groupSlotId","reconnectOutputs","groupOutputId","targetNode","getExtraMenuOptions","optionIndex","manageGroupNodes","onDrawTitleBox","height","fill","onDrawForeground","progressState","useExecutionStore","message","onExecutionStart","onNodeCreated","handleEvent","getId","getEvent","handler","detail","api","executing","executed","onRemoved","defs","old","newWidgetName","primitiveLinked","linked","rerouteLinks","targetSlot","_node","nodeId","primitiveId","targetWidgetName","targetWidgetIndex","primitiveNode","len","offset","linkedShift","mainWidget","innerWidget","originalNode","newSlot","originSlot","targetId","actualOriginId","builder","res","replaceLegacySeparators","convertSelectedNodesToGroupNode","SubgraphNode","convertDisabled","selected","ungroupSelectedGroupNodes","canvas","convertEnabled","groups","manageDisabled","graphData","setNodeMode","mode","addNodesToGroup","padding","useSettingStore","LGraphGroup","nodesInGroup","allNodesAreSameMode","EXPORT_FORMATS","createExportMenuItems","load3d","_value","_options","prev_menu","submenuOptions","format","Load3DConfiguration","properties","loadFolder","filePath","setting","width","onModelWidgetUpdate","modelWidget","cameraState","originalCallback","currentValue","bgImagePath","sceneConfig","cameraConfig","lightConfig","isFirstLoad","filename","modelUrl","Load3dUtils","modelConfig","pathParts","part","subfolder","inputSpecLoad3D","inputSpecPreview3D","handleModelUpload","files","resourceFolder","uploadPath","useLoad3d","handleResourcesUpload","createFileInput","accept","multiple","selectedNodes","selectedNode","isLoad3dNode","useDialogStore","Load3DViewerContent","useLoad3dService","fileInput","resourcesInput","ComponentWidgetImpl","Load3D","addWidget","nextTick","sceneWidget","settings","currentLoad3d","nodeToLoad3dMap","imageData","maskData","normalData","dataMask","dataNormal","returnVal","recordingData","recording","_nodeType","onExecuted","lastTimeModelFile","msg","BrushShape","Tools","allTools","CompositionOperation","MaskBlendMode","ColorComparisonMethod","useCanvasHistory","maxStates","store","useMaskEditorStore","states","ref","currentStateIndex","initialized","canUndo","computed","canRedo","saveInitialState","maskCtx","rgbCtx","maskCanvas","rgbCanvas","maskState","rgbState","saveState","undo","restoreState","redo","state","defineStore","brushSettings","maskBlendMode","activeLayer","rgbColor","currentTool","isAdjustingBrush","paintBucketTolerance","fillOpacity","colorSelectTolerance","colorSelectLivePreview","colorComparisonMethod","applyWholeImage","maskBoundary","maskTolerance","selectionOpacity","zoomRatio","displayZoomRatio","panOffset","cursorPoint","resetZoomTrigger","imgCanvas","imgCtx","canvasContainer","canvasBackground","pointerZone","image","maskOpacity","brushVisible","isPanning","brushPreviewGradientVisible","canvasHistory","watch","maskColor","setBrushSize","size","setBrushOpacity","opacity","setBrushHardness","hardness","setBrushSmoothingPrecision","precision","resetBrushToDefault","setPaintBucketTolerance","tolerance","setFillOpacity","setColorSelectTolerance","setMaskTolerance","setSelectionOpacity","setZoomRatio","ratio","setPanOffset","setCursorPoint","point","resetZoom","setMaskOpacity","resetState","useMaskEditorDataStore","outputData","sourceNode","isLoading","loadError","hasValidInput","hasValidOutput","isReady","loading","useCanvasManager","prepareMask","maskCanvasEl","maskContext","alpha","invalidateCanvas","origImage","maskImage","paintImage","setCanvasBackground","useImageLoaderInternal","dataStore","canvasManager","baseImage","useImageLoader","createSharedComposable","useKeyboard","keysDown","isKeyDown","clearKeys","handleKeyDown","activeElement","handleKeyUp","paintedMaskedImagePrefix","imageLayerFilenamesIfApplicable","inputImageFilename","suffix","timestamp","toRef","mkFileUrl","params","pathPlusQueryParams","imageElement","useMaskEditorLoader","nodeOutputStore","useNodeOutputStore","loadFromNode","validateNode","nodeImageUrl","getNodeImageUrl","nodeImageRef","parseImageRef","widgetFilename","imageWidget","fileToQuery","maskLayersFromApi","imageLayerFilenames","baseFile","baseImageUrl","sourceRef","paintLayerUrl","baseLayer","maskLayer","paintLayer","loadImageLayer","loadPaintLayer","errorMessage","img","imgSrc","url","urlObj","channel","finalUrl","loadImage","resolve","reject","usePanAndZoom","DOUBLE_TAP_DELAY","lastTwoFingerTap","isTouchZooming","lastTouchZoomDistance","lastTouchMidPoint","lastTouchPoint","zoom_ratio","interpolatedZoomRatio","pan_offset","mouseDownPoint","initialPan","rootElement","toolPanelElement","sidePanelElement","imageRootWidth","imageRootHeight","penPointerIdList","getTouchDistance","touches","dx","dy","getTouchMidpoint","updateCursorPosition","clientPoint","cursorX","cursorY","handleDoubleTap","invalidatePanZoom","raw_width","raw_height","handlePanStart","handlePanMove","deltaX","deltaY","pan_x","pan_y","handleSingleTouchPan","touch","handleTouchStart","currentTime","handleTouchMove","newDistance","zoomFactor","oldZoom","newZoom","midpoint","rect","touchX","touchY","scaleFactor","handleTouchEnd","lastTouch","zoom","cursorPosition","mouseX","mouseY","getPanelDimensions","toolPanelWidth","smoothResetView","duration","startZoom","startPan","sidePanelWidth","availableWidth","availableHeight","zoomRatioWidth","zoomRatioHeight","targetZoom","aspectRatio","finalWidth","finalHeight","targetPan","startTime","animate","elapsed","progress","eased","interpolatedRatio","initializeCanvasPanZoom","root","toolPanel","sidePanel","useCoordinateTransformInternal","pointerZoneEl","unref","canvasContainerEl","canvasEl","pointerZoneRect","canvasContainerRect","canvasRect","absoluteX","absoluteY","canvasX","canvasY","scaleX","scaleY","canvasPoint","displayX","displayY","useCoordinateTransform","saveBrushToCache","debounce","brush","brushString","setStorageValue","loadBrushFromCache","getStorageValue","useBrushDrawing","initialSettings","coordinateTransform","brushTextureCache","QuickLRU","SMOOTHING_MAX_STEPS","SMOOTHING_MIN_STEPS","isDrawing","isDrawingLine","lineStartPoint","smoothingCordsArray","smoothingLastDrawTime","initialDraw","brushStrokeCanvas","brushStrokeCtx","initialPoint","useDominantAxis","brushAdjustmentSpeed","cachedBrushSettings","createBrushStrokeCanvas","initShape","compositionOperation","blendMode","mask_ctx","rgb_ctx","formatRgba","hex","r","hexToRgb","getCachedBrushTexture","radius","color","cacheKey","tempCanvas","tempCtx","centerX","centerY","hardRadius","parseToRgb","fadeRange","distFromEdge","pixelOpacity","fadeProgress","createBrushGradient","isErasing","gradient","drawShapeOnContext","brushType","drawRgbShape","brushRadius","rgbaColor","brushTexture","drawMaskShape","baseColor","maskColorHex","drawShape","overrideOpacity","clampSmoothingPrecision","generateEquidistantPoints","points","distance","result","cumulativeDistances","dist","totalLength","numPoints","targetDistance","d0","d1","drawWithBetterSmoothing","opacityConstant","interpolatedOpacity","maxSteps","minSteps","normalizedSmoothing","stepNr","distanceBetweenPoints","interpolatedPoints","spliceIndex","drawLine","p1","p2","compositionOp","brush_size","steps","coords","coords_canvas","diff","brushDeadZone","delta_x","delta_y","effectiveDeltaX","effectiveDeltaY","finalDeltaX","finalDeltaY","threshold","cappedDeltaX","cappedDeltaY","newSize","newHardness","getPixelAlpha","getPixelColor","setPixel","rgbToHSL","h","s","rgbToLab","rgb","z","xyz","isPixelInRangeSimple","pixel","isPixelInRangeHSL","pixelHSL","targetHSL","hueDiff","satDiff","lightDiff","isPixelInRangeLab","pixelLab","targetLab","isPixelInRange","method","useCanvasTools","lastColorSelectPoint","paintBucketFill","startX","startY","targetAlpha","isFillMode","stack","shouldProcessPixel","currentAlpha","visitedIndex","checkNeighbor","nx","ny","colorSelectFill","maskDataArray","imageDataArray","selectOpacity","targetPixel","CHUNK_SIZE","endIndex","pixelIndex","invertMask","maskR","maskG","maskB","clearMask","clearLastColorSelectPoint","useToolManager","keyboard","panZoom","brushDrawing","canvasTools","toolSettings","setActiveLayer","layer","switchTool","tool","newActiveLayer","cursor","updateCursor","newTool","isSpacePressed","isDrawingTool","newCursorPoint","brushOpacity","brushSize","brushLeft","dialogOffsetLeft","__props","brushTop","dialogOffsetTop","borderRadius","gradientVisible","gradientBackground","pointerZoneRef","onMounted","handlePointerDown","handlePointerMove","handlePointerUp","handlePointerLeave","handlePointerEnter","handleWheel","emit","__emit","onInput","maskLayerVisible","paintLayerVisible","baseImageLayerVisible","baseImageSrc","showLayerButtons","onMaskLayerVisibilityChange","onPaintLayerVisibilityChange","onBaseImageLayerVisibilityChange","onMaskOpacityChange","onBlendModeChange","setBrushShape","shape","onColorChange","onThicknessChange","onOpacityChange","onHardnessChange","onSmoothingPrecisionChange","resetToDefault","normalizedOptions","option","onChange","methodOptions","onToleranceChange","onSelectionOpacityChange","onLivePreviewChange","onWholeImageChange","onMethodChange","onMaskBoundaryChange","onMaskToleranceChange","onFillOpacityChange","currentPanelComponent","PaintBucketSettingsPanel","ColorSelectSettingsPanel","BrushSettingsPanel","iconsHtml","onToolSelect","zoomText","dimensionsText","onResetZoom","dialogStore","loader","containerRef","canvasContainerRef","imgCanvasRef","maskCanvasRef","rgbCanvasRef","canvasBackgroundRef","toolPanelRef","sidePanelRef","toolManager","resizeObserver","handleDragStart","initUI","onBeforeUnmount","imageLayerFilenamesByTimestamp","useMaskEditorSaver","editorStore","save","prepareOutputData","updateNodePreview","uploadAllLayers","updateNodeWithServerReferences","paintCanvas","filenames","maskedImage","paintedImage","paintedMaskedImage","createMaskedImage","createPaintLayer","createPaintedImage","createPaintedMaskedImage","refinedMaskData","blob","canvasToBlob","createFileRef","cloneCanvas","actualMaskedRef","uploadMask","actualPaintRef","uploadImage","actualPaintedRef","actualPaintedMaskedRef","originalRef","formData","response","dataUrl","mainImg","loadImageFromUrl","mainRef","widgetValue","iconButtonClass","textButtonClass","saver","saveButtonText","saveEnabled","onUndo","onRedo","onInvert","onClear","handleSave","handleCancel","dataURLToBlob","dataURL","parts","contentType","byteString","arrayBuffer","uint8Array","imagePath","filepath","prepare_mask","MaskEditorDialogOld","button","divElement","labelElement","selectElement","optionArc","optionRect","bottom_panel","clearButton","cancelButton","maskCanvasStyle","observer","mutations","mutation","orig_image","mask_image","alpha_url","rgb_url","drawWidth","drawHeight","colorCaption","left_button_down","right_button_down","maskRect","directionX","directionY","px","py","backupCanvas","backupCtx","backupData","obj","original_url","original_ref","original_subfolder","original_type","openMaskEditor","TopBarHeader","MaskEditorContent","dlg","isOpened","changeBrushSize","openMaskEditorFromClipspace","context_predicate","sizeChanger","oldBrushSize","newBrushSize","MATCH_TYPE","inputGroups","outputGroups","template","groupId","addConnectionGroup","inputPairs","connectedTypes","contype","iscon","linf","pairIndex","subgraphInput","connectingType","otherConnected","validType","combineTypes","outputType","changeOutputType","combinedType","link_id","subgraphOutput","inputType","keep","isStrings","withoutWildcards","without","typeLists","combinedTypes","sets","itemCounts","set","count","file","ManageTemplates","btns","templates","reader","importFile","json","downloadBlob","nameInput","el","prev_i","row","that","manage","clipboardAction","cb","_canvas","nodeIds","subItems","NoteNode","MarkdownNoteNode","showValueWidget","previewWidget","RerouteNode","cloned","graph","linksToDisconnect","currentNode","updateNodes","nodeInput","nodeOutType","displayType","widgetConfig","widgetType","targetInput","merged","saveNodeTypes","inputSpec","fileInfo","drawSelectionBorder","selectedItems","bounds","createBounds","borderWidth","dashSize","originalDrawForeground","visibleArea","touchZooming","touchCount","touchDist","touchTime","lastScale","getMultiTouchPos","getMultiTouchCenter","onlyTouch","newTouchDist","center","newX","newY","oldScale","newScale","convertScaleToOffset","oldCenter","newCenter","processMouseDown","processMouseMove","newVal","inputKey","customProperties","lowerType","maxNum","uploadFile","audioWidget","audioUIWidget","updateNode","pasted","body","resp","path","getResourceURL","splitFilePath","audio","audios","nodeOutputs","nodeLocatorId","getNodeByLocatorId","onAudioWidgetUpdate","onGraphConfigured","handleUpload","isAudioFile","openFileSelection","useNodeFileInput","uploadWidget","useNodeDragAndDrop","useNodePaste","mediaRecorder","isRecording","audioChunks","currentStream","recordWidget","stopPromise","stopResolve","audioSrc","useAudioService","ExtendableMediaRecorder","audioBlob","err","originalOnRemoved","isMediaUploadComboInput","inputOptions","isComboInputSpecV1","createUploadInput","imageInputName","imageInputOptions","required","found","WEBCAM_READY","container","video","stream","camera","captureOnQueue","capture","btn"],"mappings":"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"}