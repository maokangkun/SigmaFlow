const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/ComfyQueueButton-Csldb7Iq.js","assets/vendor-vue-CrN17A9b.js","assets/vendor-other-_sromytg.js","assets/vendor-other-D8_IC5CT.css","assets/index-DKJFyUvH.js","assets/vendor-xterm-DV1MVhAx.js","assets/vendor-xterm-LZoznX6r.css","assets/vendor-three-zdhtZbSm.js","assets/vendor-tiptap-D1RRboMA.js","assets/index-DjfD1ly1.css","assets/ComfyQueueButton-CNpEk52R.css"])))=>i.map(i=>d[i]);
var Is=Object.defineProperty;var n=(e,t)=>Is(e,"name",{value:t,configurable:!0});import{shallowRef as rt,ref as R,computed as b,defineComponent as j,useSlots as Ms,inject as vn,watch as J,openBlock as y,createElementBlock as I,normalizeClass as K,unref as w,withDirectives as pe,createVNode as E,withCtx as W,createElementVNode as x,vShow as Fe,Transition as ba,renderSlot as Ne,createCommentVNode as V,createBlock as O,toDisplayString as H,Fragment as ue,renderList as $e,createTextVNode as Ye,reactive as gn,readonly as ko,mergeModels as wa,useModel as an,useAttrs as Rs,mergeProps as nt,createSlots as hn,normalizeStyle as me,withModifiers as Ee,toValue as bt,useId as sn,resolveDirective as Te,resolveDynamicComponent as Mt,withKeys as Rt,provide as Io,isRef as Yt,onErrorCaptured as Ca,onBeforeUnmount as dt,nextTick as De,watchEffect as ge,onMounted as Me,defineAsyncComponent as Ps,onUpdated as Sa,onUnmounted as at,toRaw as zn,markRaw as ka,Teleport as Bt,createStaticVNode as Ds,toRefs as xa,shallowReactive as As,getCurrentInstance as Un}from"vue";import{be as $a,bP as _a,b$ as Ta,c0 as Fn,c1 as Ls,aG as Na,aX as xo,c2 as Es,bE as zt,aT as xe,aI as _t,bj as Mo,c3 as Vs,bz as Ia,aU as Ma,aS as Ro,c4 as Ra,c5 as Jt,c6 as Ws,c7 as Os,bs as Bs,aE as Pa,aH as Ft,bl as Da,bQ as Aa,bn as zs,c8 as Us,bb as Po,c9 as Fs,aR as Gs,by as La,bh as Hs,ca as js,cb as qs,bZ as Ks,bK as Ys}from"./vendor-other-_sromytg.js";import{useToast as yn}from"primevue/usetoast";import{useI18n as he}from"vue-i18n";import ie from"primevue/button";import{s as ke,n as Ae,a as ve,i as bn,b as It,c as re,_ as Nt,d as we,e as Do,f as Qs,t as ae,u as Z,g as Zs,h as wn,j as Gt,k as Gn,l as eo,m as Dt,L as Ea,o as Cn,p as be,q as Va,r as F,v as Sn,w as kn,x as Xs,y as tt,z as Ge,A as Js,B as _e,C as $o,D as At,E as Wa,F as pt,G as Qe,H as Oa,I as ei,J as xn,K as Ba,M as ce,N as ti,O as $n,P as Lt,Q as to,R as za,S as oi,T as Oe,U as ni,V as Ht,W as ai,X as si,Y as Qt,Z as Le,$ as Ua,a0 as ii,a1 as Xe,a2 as li,a3 as ri,a4 as wt,a5 as le,a6 as st,a7 as ui,a8 as ci,a9 as Ue,aa as jt,ab as mo,ac as di,ad as Fa,ae as pi,af as fi,ag as ot,ah as Ga,ai as gt,aj as mi,ak as Ie,al as Ao,am as _o,an as Ha,ao as Ze,ap as ht,aq as Lo,ar as ao,as as vi,at as gi,au as ja,av as hi,aw as yi,ax as _n,ay as Hn,az as bi,aA as wi,aB as Ci,aC as Si,aD as ki,aE as Eo,aF as et,aG as vo,aH as go,aI as ho,aJ as yo,aK as qa,aL as Ka,aM as it,aN as xi,aO as $i,aP as qt,aQ as Ya,aR as _i,aS as Qa,aT as Ti,aU as Za,aV as Kt,aW as Tn,aX as Ni,aY as Ii,aZ as Xa,a_ as Mi,a$ as Ri,b0 as Ja,b1 as Pi,b2 as Di,b3 as Pt,b4 as Ai,b5 as Vo,b6 as jn,b7 as Nn,b8 as Li,b9 as Ke,ba as es,bb as Ei,bc as Vi,bd as Go,be as Wi,bf as Oi,bg as Bi,bh as zi,bi as Ui,bj as Fi,bk as Gi,bl as Ho,bm as so,bn as Hi,bo as ts,bp as jo,bq as qo,br as ji,bs as qi,bt as qn,bu as Ki,bv as Yi,bw as Ct,bx as Ko,by as Qi,bz as Zi,bA as Kn,bB as Yn,bC as Qn,bD as Xi,bE as Ji,bF as el,bG as Zn,bH as tl,bI as ol,bJ as nl,bK as al,bL as sl,bM as il,bN as Xn,bO as Jn,bP as ll,bQ as os,bR as rl,bS as bo,bT as ul,bU as cl,bV as dl,bW as pl,bX as fl,bY as ml,bZ as ns,b_ as vl,b$ as gl,c0 as hl,c1 as yl}from"./index-DKJFyUvH.js";import ea from"primevue/splitter";import Wt from"primevue/splitterpanel";import as from"primevue/panel";import"primevue/message";import"./vendor-xterm-DV1MVhAx.js";import bl from"primevue/progressspinner";import ss from"primevue/skeleton";import"primevue/card";import wl from"primevue/select";import"primevue/slider";import Ot from"primevue/checkbox";import"primevue/galleria";import ut from"primevue/popover";import"primevue/iconfield";import"primevue/inputicon";import Cl from"primevue/inputtext";import Sl from"primevue/badge";import kl from"primevue/chip";import"primevue/tabview";import"primevue/tabpanel";import"primevue/dropdown";import xl from"primevue/scrollpanel";import $l from"primevue/contextmenu";import"primevue/tree";import"primevue/toolbar";import"primevue/progressbar";import ta from"primevue/divider";import{useToast as Wo,InputNumber as _l}from"primevue";import is from"primevue/selectbutton";import Ut from"primevue/tag";import ls from"primevue/dialog";import"primevue/colorpicker";import"primevue/confirmpopup";import"primevue/useconfirm";import"primevue/confirmdialog";import"primevue/listbox";import"primevue/floatlabel";import"@primevue/forms";import"@primevue/forms/resolvers/zod";import"primevue/password";import"primevue/inputnumber";import"primevue/tabpanels";import Tl from"primevue/tabs";import Nl from"primevue/toggleswitch";import"primevue/radiobutton";import"primevue/knob";import"primevue/tabmenu";import Il from"primevue/tab";import Ml from"primevue/tablist";import Rl from"primevue/breadcrumb";import rs from"primevue/menu";import{d as St,s as ct,g as us,h as cs}from"./vendor-vue-CrN17A9b.js";import{_ as ds}from"./UserAvatar.vue_vue_type_script_setup_true_lang-7S3Z5ajP.js";import Pl from"primevue/buttongroup";import{f as In,i as Dl}from"./nodeFilterUtil-D49mCu4H.js";import{c as Al}from"./mathUtil-DlGw4Aca.js";import io from"primevue/autocomplete";import Ll from"primevue/tieredmenu";import El from"primevue/multiselect";import{_ as Vl,a as Zt,u as Wl}from"./LazyImage.vue_vue_type_script_setup_true_lang-g3Uhye0Z.js";import Ol from"primevue/overlaybadge";import To from"primevue/toast";import{u as Yo}from"./keybindingService-Z_fb-xAE.js";import{u as Bl}from"./serverConfigStore-LlFdzz5g.js";import"@primevue/themes";import"@primevue/themes/aura";import"primevue/config";import"primevue/confirmationservice";import"primevue/toastservice";import"primevue/tooltip";import"./vendor-three-zdhtZbSm.js";import"./vendor-tiptap-D1RRboMA.js";import"primevue/blockui";import"primevue/avatar";const Qo=n(e=>({all:"icon-[lucide--list]","getting-started":"icon-[lucide--graduation-cap]","generation-image":"icon-[lucide--image]",image:"icon-[lucide--image]","generation-video":"icon-[lucide--film]",video:"icon-[lucide--film]","generation-3d":"icon-[lucide--box]","3d":"icon-[lucide--box]","generation-audio":"icon-[lucide--volume-2]",audio:"icon-[lucide--volume-2]","generation-llm":"icon-[lucide--message-square-text]","api-nodes":"icon-[lucide--hand-coins]","closed-models":"icon-[lucide--hand-coins]",llm:"icon-[lucide--message-square-text]",llms:"icon-[lucide--message-square-text]","llm-api":"icon-[lucide--message-square-text]","small-models":"icon-[lucide--zap]",performance:"icon-[lucide--zap]","mac-compatible":"icon-[lucide--command]","runs-on-mac":"icon-[lucide--command]","lora-training":"icon-[lucide--dumbbell]",training:"icon-[lucide--dumbbell]",extensions:"icon-[lucide--puzzle]",tools:"icon-[lucide--wrench]",upscaling:"icon-[lucide--maximize-2]",controlnet:"icon-[lucide--sliders-horizontal]","area-composition":"icon-[lucide--layout-grid]"})[e.toLowerCase()]||"icon-[lucide--folder]","getCategoryIcon"),ps=St("workflowTemplates",()=>{const e=rt({}),t=rt([]),o=rt([]),s=R(!1),l=R(new Set),a=n(k=>c.value.find(T=>T.name===k),"getTemplateByName"),i=R(new Map),r=n((k,T)=>({...k,localizedTitle:ke(`templateWorkflows.template.${Ae(T)}.${Ae(k.name)}`,k.title??k.name),localizedDescription:ke(`templateWorkflows.templateDescription.${Ae(T)}.${Ae(k.name)}`,k.description)}),"addLocalizedFieldsToTemplate"),u=n((k,T)=>k.map(S=>r(S,T)),"localizeTemplateList"),d=n(k=>({...k,localizedTitle:ke(`templateWorkflows.category.${Ae(k.title)}`,k.title??k.moduleName),templates:u(k.templates,k.title)}),"localizeTemplateCategory"),p=n(()=>{const k=t.value.flatMap(S=>S.templates.map($=>({...r($,S.title),sourceModule:S.moduleName}))),T=Object.entries(e.value).flatMap(([S,$])=>$.map(_=>({name:_,mediaType:"image",mediaSubtype:"jpg",description:_,sourceModule:S})));return{moduleName:"all",title:"All",localizedTitle:ke("templateWorkflows.category.All","All Templates"),templates:[...k,...T]}},"createAllCategory"),g=b(()=>{const k=[...t.value.map(d),...Object.entries(e.value).map(([S,$])=>({moduleName:S,title:S,localizedTitle:ke(`templateWorkflows.category.${Ae(S)}`,S),templates:$.map(_=>({name:_,mediaType:"image",mediaSubtype:"jpg",description:_}))}))];return[{label:ke("templateWorkflows.category.ComfyUI Examples","ComfyUI Examples"),modules:[p(),...k.filter(S=>S.moduleName==="default")]},...Object.keys(e.value).length>0?[{label:ke("templateWorkflows.category.Custom Nodes","Custom Nodes"),modules:k.filter(S=>S.moduleName!=="default")}]:[]]}),c=b(()=>{const k=[];return t.value.forEach(S=>{S.templates.forEach($=>{const _={...$,sourceModule:S.moduleName,category:S.title,categoryType:S.type,categoryGroup:S.category,isEssential:S.isEssential,isPartnerNode:$.openSource===!1,searchableText:[$.title||$.name,$.description||"",S.title,...$.tags||[],...$.models||[]].join(" ")};k.push(_)})}),Object.entries(e.value).forEach(([S,$])=>{$.forEach(_=>{const P={name:_,title:_,description:_,mediaType:"image",mediaSubtype:"jpg",sourceModule:S,category:"Extensions",categoryType:"extension",searchableText:`${_} ${S} extension`};k.push(P)})}),k.filter(S=>!S.requiresCustomNodes?.length)}),f=b(()=>{const k={keys:[{name:"searchableText",weight:.4},{name:"title",weight:.3},{name:"name",weight:.2},{name:"tags",weight:.1}],threshold:.3,includeScore:!0};return new $a(c.value,k)}),v=n(k=>{if(k==="all")return c.value;if(k==="basics")return c.value.filter(S=>S.isEssential);if(k==="partner-nodes")return c.value.filter(S=>S.isPartnerNode);if(k.startsWith("extension-")){const S=k.replace("extension-","");return c.value.filter($=>$.sourceModule===S)}const T=i.value.get(k);return T?c.value.filter(S=>!(T.category&&S.category!==T.category||T.categoryGroup&&S.categoryGroup!==T.categoryGroup)):c.value},"filterTemplatesByCategory"),C=b(()=>{if(!s.value)return[];const k=[];i.value.clear(),k.push({id:"all",label:ke("templateWorkflows.category.All","All Templates"),icon:Qo("all")});let T="Getting Started";const S=t.value.find(L=>L.isEssential&&L.templates.length>0),$=!!S;S&&(T=S.title),$&&k.push({id:"basics",label:T,icon:"icon-[lucide--graduation-cap]"});const _=new Map;if(t.value.forEach(L=>{if(L.isEssential)return;const N=L.category,B=L.icon;if(N){_.has(N)||_.set(N,{title:N,items:[]});const D=_.get(N),z=`${N.toLowerCase().replace(/\s+/g,"-")}-${L.title.toLowerCase().replace(/\s+/g,"-")}`;i.value.set(z,{category:L.title,categoryGroup:N}),D.items.push({id:z,label:ke(`templateWorkflows.category.${Ae(L.title)}`,L.title),icon:B||Qo(L.type||"default")})}}),_.forEach((L,N)=>{L.items.length>0&&k.push({title:ke(`templateWorkflows.category.${Ae(N)}`,N.split(" ").map(B=>B.charAt(0).toUpperCase()+B.slice(1).toLowerCase()).join(" ")),items:L.items})}),c.value.filter(L=>L.isPartnerNode).length>0&&k.push({id:"partner-nodes",label:ke("templateWorkflows.category.Partner Nodes","Partner Nodes"),icon:"icon-[lucide--handshake]"}),c.value.filter(L=>L.sourceModule!=="default").length>0){const N=Array.from(new Set(c.value.filter(B=>B.sourceModule!=="default").map(B=>B.sourceModule))).sort().map(B=>({id:`extension-${B}`,label:ke(`templateWorkflows.category.${Ae(B)}`,B),icon:Qo("extensions")}));k.push({title:ke("templateWorkflows.category.Extensions","Extensions"),items:N,collapsible:!0})}return k});async function m(){try{if(!s.value){e.value=await ve.getWorkflowTemplates();const k=bn.global.locale.value,[T,S]=await Promise.all([ve.getCoreWorkflowTemplates(k),It&&k!=="en"?ve.getCoreWorkflowTemplates("en"):Promise.resolve([])]);t.value=T,o.value=S;const $=t.value.flatMap(P=>P.templates.map(M=>M.name)),_=Object.values(e.value).flat();l.value=new Set([...$,..._]),s.value=!0}}catch(k){console.error("Error fetching workflow templates:",k)}}n(m,"loadWorkflowTemplates");function h(k){if(o.value.length===0)return null;for(const T of o.value){const S=T.templates.find($=>$.name===k);if(S)return{tags:S.tags,category:T.title,useCase:S.useCase,models:S.models,license:S.license}}return null}return n(h,"getEnglishMetadata"),{groupedTemplates:g,navGroupedTemplates:C,enhancedTemplates:c,templateFuse:f,filterTemplatesByCategory:v,isLoaded:s,loadWorkflowTemplates:m,knownTemplateNames:l,getTemplateByName:a,getEnglishMetadata:h}}),Oo=Symbol(),zl={class:"flex h-full w-full"},Ul={class:"flex h-full w-full flex-col"},Fl={class:"flex flex-1 shrink-0 gap-2"},Gl={key:0,class:"icon-[lucide--panel-left] text-sm"},Hl={key:1,class:"icon-[lucide--panel-left-close] text-sm"},jl={class:"flex min-h-0 flex-1 flex-col"},ql={key:0,class:"text-xxl m-0 px-6 pt-2 pb-6 capitalize"},Kl=j({__name:"BaseModalLayout",props:{contentTitle:{}},setup(e){const t={md:880},o={width:"w-1/3",minWidth:"min-w-40",maxWidth:"max-w-56"},s=Ms(),l=vn(Oo,()=>{}),i=_a(t).greater("md"),r=R(!0),u=R(!1),d=R(!1),p=b(()=>!!s.rightPanel);J(i,_=>{_||(d.value=!1)});const g=b(()=>i.value?r.value:d.value),c=n(()=>{i.value?r.value=!r.value:d.value=!d.value},"toggleLeftPanel"),f=n(()=>{u.value=!u.value},"toggleRightPanel"),v=re("base-widget-layout","rounded-2xl overflow-hidden relative"),C=b(()=>re("absolute top-4 right-18 z-10","transition-opacity duration-200",{"opacity-0 pointer-events-none":u.value||!p.value})),m=re("absolute top-4 right-6 z-10","transition-opacity duration-200"),h=re("flex-1 flex bg-base-background"),k=re("w-full h-18 px-6","flex items-center justify-between gap-2"),T=b(()=>re("flex justify-end gap-2 w-0",p.value&&!u.value?"min-w-22":"min-w-10")),S=b(()=>re("min-h-0 px-6 pt-0 pb-10","overflow-y-auto scrollbar-hide")),$=b(()=>re("w-1/4 min-w-40 max-w-80"));return(_,P)=>(y(),I("div",{class:K(w(v))},[pe(E(Nt,{class:K(C.value),onClick:f},{default:W(()=>P[0]||(P[0]=[x("i",{class:"icon-[lucide--panel-right] text-sm"},null,-1)])),_:1},8,["class"]),[[Fe,!u.value&&p.value]]),E(Nt,{class:K(w(m)),onClick:w(l)},{default:W(()=>P[1]||(P[1]=[x("i",{class:"pi pi-times text-sm"},null,-1)])),_:1},8,["class","onClick"]),x("div",zl,[E(ba,{name:"slide-panel"},{default:W(()=>[_.$slots.leftPanel&&g.value?(y(),I("nav",{key:0,class:K([o.width,o.minWidth,o.maxWidth])},[Ne(_.$slots,"leftPanel",{},void 0,!0)],2)):V("",!0)]),_:3}),x("div",{class:K(w(h))},[x("div",Ul,[_.$slots.header?(y(),I("header",{key:0,class:K(w(k))},[x("div",Fl,[w(i)?V("",!0):(y(),O(Nt,{key:0,onClick:c},{default:W(()=>[g.value?(y(),I("i",Hl)):(y(),I("i",Gl))]),_:1})),Ne(_.$slots,"header",{},void 0,!0)]),Ne(_.$slots,"header-right-area",{},void 0,!0),x("div",{class:K(T.value)},[u.value&&p.value?(y(),O(Nt,{key:0,onClick:f},{default:W(()=>P[2]||(P[2]=[x("i",{class:"icon-[lucide--panel-right-close] text-sm"},null,-1)])),_:1})):V("",!0)],2)],2)):V("",!0),x("main",jl,[Ne(_.$slots,"contentFilter",{},void 0,!0),_.$slots.leftPanel?V("",!0):(y(),I("h2",ql,H(_.contentTitle),1)),x("div",{class:K(S.value)},[Ne(_.$slots,"content",{},void 0,!0)],2)])]),p.value&&u.value?(y(),I("aside",{key:0,class:K($.value)},[Ne(_.$slots,"rightPanel",{},void 0,!0)],2)):V("",!0)],2)])],2))}}),Mn=we(Kl,[["__scopeId","data-v-4ebc4d9c"]]),Yl=j({__name:"NavIcon",props:{icon:{}},setup(e){return(t,o)=>(y(),I("i",{class:K([t.icon,"text-neutral text-sm"])},null,2))}}),Ql={key:1,class:"text-neutral icon-[lucide--folder] text-xs"},Zl={class:"flex items-center"},oa=j({__name:"NavItem",props:{icon:{},active:{type:Boolean},onClick:{type:Function}},setup(e){return(t,o)=>(y(),I("div",{class:K(["flex cursor-pointer items-center gap-2 rounded-md px-4 py-3 text-sm transition-colors text-base-foreground",t.active?"bg-interface-menu-component-surface-selected":"hover:bg-interface-menu-component-surface-hovered"]),role:"button",onClick:o[0]||(o[0]=(...s)=>t.onClick&&t.onClick(...s))},[t.icon?(y(),O(Yl,{key:0,icon:t.icon},null,8,["icon"])):(y(),I("i",Ql)),x("span",Zl,[Ne(t.$slots,"default")])],2))}}),Xl={class:"text-xs font-bold text-text-secondary uppercase"},Jl=j({__name:"NavTitle",props:{title:{},modelValue:{type:Boolean,default:!1},collapsible:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:t}){const o=t,s=b({get:n(()=>e.modelValue,"get"),set:n(a=>o("update:modelValue",a),"set")}),l=n(()=>{s.value=!s.value},"toggleCollapse");return(a,i)=>(y(),I("div",{class:K(w(re)("flex items-center justify-between m-0 px-3 py-0 pt-5",a.collapsible&&"cursor-pointer select-none")),onClick:i[0]||(i[0]=r=>a.collapsible&&l())},[x("h3",Xl,H(a.title),1),a.collapsible?(y(),I("i",{key:0,class:K(w(re)("pi transition-transform duration-200 text-xs text-text-secondary ",s.value?"pi-chevron-right":"pi-chevron-down"))},null,2)):V("",!0)],2))}}),er={},tr={class:"flex h-16 items-center justify-between px-6"},or={class:"flex items-center gap-2 pl-1"},nr={class:"text-neutral text-base font-bold"};function ar(e,t){return y(),I("header",tr,[x("div",or,[Ne(e.$slots,"icon",{},()=>[t[0]||(t[0]=x("i",{class:"text-neutral icon-[lucide--puzzle] text-base"},null,-1))]),x("h2",nr,[Ne(e.$slots,"default")])])])}n(ar,"_sfc_render$2");const sr=we(er,[["render",ar]]),ir={class:"flex h-full w-full flex-col bg-modal-panel-background"},lr={class:"flex scrollbar-hide flex-1 flex-col gap-1 overflow-y-auto px-3 py-4"},rr={key:0,class:"flex flex-col gap-2"},ur={key:1,class:"flex flex-col gap-2"},Rn=j({__name:"LeftSidePanel",props:{navItems:{default:n(()=>[],"default")},modelValue:{}},emits:["update:modelValue"],setup(e,{emit:t}){const o=t,s=R({}),l=n(()=>{if(!e.navItems||e.navItems.length===0)return null;const i=e.navItems[0];return"items"in i&&i.items.length>0?i.items[0].id:"id"in i?i.id:null},"getFirstItemId"),a=b({get:n(()=>e.modelValue??l(),"get"),set:n(i=>o("update:modelValue",i),"set")});return(i,r)=>(y(),I("div",ir,[E(sr,null,{icon:W(()=>[Ne(i.$slots,"header-icon")]),default:W(()=>[Ne(i.$slots,"header-title")]),_:3}),x("nav",lr,[(y(!0),I(ue,null,$e(i.navItems,(u,d)=>(y(),I(ue,{key:d},["items"in u?(y(),I("div",rr,[E(Jl,{modelValue:s.value[u.title],"onUpdate:modelValue":n(p=>s.value[u.title]=p,"onUpdate:modelValue"),title:u.title,collapsible:u.collapsible},null,8,["modelValue","onUpdate:modelValue","title","collapsible"]),!u.collapsible||!s.value[u.title]?(y(!0),I(ue,{key:0},$e(u.items,p=>(y(),O(oa,{key:p.id,icon:p.icon,active:a.value===p.id,onClick:n(g=>a.value=p.id,"onClick")},{default:W(()=>[Ye(H(p.label),1)]),_:2},1032,["icon","active","onClick"]))),128)):V("",!0)])):(y(),I("div",ur,[E(oa,{icon:u.icon,active:a.value===u.id,onClick:n(p=>a.value=u.id,"onClick")},{default:W(()=>[Ye(H(u.label),1)]),_:2},1032,["icon","active","onClick"])]))],64))),128))])]))}});function cr(){const e=gn({get supportsPreviewMetadata(){return ve.getServerFeature("supports_preview_metadata")},get maxUploadSize(){return ve.getServerFeature("max_upload_size")},get supportsManagerV4(){return ve.getServerFeature("extension.manager.supports_v4")},get modelUploadButtonEnabled(){return ve.getServerFeature("model_upload_button_enabled",!1)}}),t=n((o,s)=>b(()=>ve.getServerFeature(o,s)),"featureFlag");return{flags:ko(e),featureFlag:t}}n(cr,"useFeatureFlags");function dr(e){return b(()=>{const{minWidth:t,maxWidth:o}=e,s={};return t&&(s.minWidth=t),o&&(s.maxWidth=o),s})}n(dr,"usePopoverSizing");const pr={class:"flex flex-col px-2 pt-2 pb-0"},fr={key:1,class:"mt-2 flex items-center justify-between"},mr={key:0,class:"px-1 text-sm text-base-foreground"},vr={class:"text-sm text-muted-foreground"},gr={key:0,class:"pointer-events-none absolute -top-2 -right-2 z-10 flex h-5 w-5 items-center justify-center rounded-full bg-primary-background text-xs font-semibold text-base-foreground"},hr={key:0,class:"text-bold icon-[lucide--check] text-xs text-white"},yt=j({inheritAttrs:!1,__name:"MultiSelect",props:wa({label:{},showSearchBox:{type:Boolean,default:!1},showSelectedCount:{type:Boolean,default:!1},showClearButton:{type:Boolean,default:!1},searchPlaceholder:{default:"Search..."},listMaxHeight:{default:"28rem"},popoverMinWidth:{},popoverMaxWidth:{}},{modelValue:{required:!0},modelModifiers:{},searchQuery:{default:""},searchQueryModifiers:{}}),emits:["update:modelValue","update:searchQuery"],setup(e){const t=an(e,"modelValue"),o=an(e,"searchQuery"),{t:s}=he(),l=b(()=>t.value.length),a=dr({minWidth:e.popoverMinWidth,maxWidth:e.popoverMaxWidth}),i=Rs(),r=b(()=>i.options||[]),u={fuseOptions:{keys:["name","value"],threshold:.3,includeScore:!1},matchAllWhenSearchEmpty:!0},{results:d}=Ta(o,r,u),p=b(()=>{if(!o.value||o.value.trim()==="")return r.value;const g=d.value.map(f=>f.item);return[...t.value.filter(f=>!g.some(v=>v.value===f.value)),...g]});return(g,c)=>(y(),O(w(El),nt({modelValue:t.value,"onUpdate:modelValue":c[2]||(c[2]=f=>t.value=f)},{...g.$attrs,options:p.value},{"option-label":"name",unstyled:"","max-selected-labels":0,pt:{root:n(({props:f})=>({class:w(re)("h-10 relative inline-flex cursor-pointer select-none","rounded-lg bg-base-background text-base-foreground","transition-all duration-200 ease-in-out","border-[2.5px] border-solid",l.value>0?"border-node-component-border":"border-transparent","focus-within:border-node-component-border",{"opacity-60 cursor-default":f.disabled})}),"root"),labelContainer:{class:"flex-1 flex items-center overflow-hidden whitespace-nowrap pl-4 py-2 "},label:{class:"p-0"},dropdown:{class:"flex shrink-0 cursor-pointer items-center justify-center px-3"},header:n(()=>({class:g.showSearchBox||g.showSelectedCount||g.showClearButton?"block":"hidden"}),"header"),overlay:{class:w(re)("mt-2 rounded-lg py-2 px-2","bg-base-background","text-base-foreground","border border-solid border-border-default")},listContainer:n(()=>({style:{maxHeight:`min(${g.listMaxHeight}, 50vh)`},class:"scrollbar-custom"}),"listContainer"),list:{class:"flex flex-col gap-0 p-0 m-0 list-none border-none text-sm"},option:n(({context:f})=>({class:w(re)("flex gap-2 items-center h-10 px-2 rounded-lg","hover:bg-secondary-background-hover",f?.focused&&"bg-secondary-background-selected hover:bg-secondary-background-selected")}),"option"),pcHeaderCheckbox:{root:{class:"hidden"},style:{display:"none"}},pcOptionCheckbox:{root:{class:"hidden"},style:{display:"none"}}},"aria-label":g.label||w(s)("g.multiSelectDropdown"),role:"combobox","aria-expanded":!1,"aria-haspopup":"listbox",tabindex:"0"}),hn({value:W(()=>[x("span",vr,H(g.label),1),l.value>0?(y(),I("span",gr,H(l.value),1)):V("",!0)]),dropdownicon:W(()=>[c[4]||(c[4]=x("i",{class:"icon-[lucide--chevron-down] text-lg text-neutral-400"},null,-1))]),option:W(f=>[x("div",{class:"flex items-center gap-2",style:me(w(a))},[x("div",{class:K(["flex h-4 w-4 shrink-0 items-center justify-center rounded p-0.5 transition-all duration-200",f.selected?"bg-primary-background":"bg-secondary-background"])},[f.selected?(y(),I("i",hr)):V("",!0)],2),E(w(ie),{class:"border-none bg-transparent text-left outline-none",unstyled:""},{default:W(()=>[Ye(H(f.option.name),1)]),_:2},1024)],4)]),_:2},[g.showSearchBox||g.showSelectedCount||g.showClearButton?{name:"header",fn:W(()=>[x("div",pr,[g.showSearchBox?(y(),O(Do,{key:0,modelValue:o.value,"onUpdate:modelValue":c[0]||(c[0]=f=>o.value=f),class:K(g.showSelectedCount||g.showClearButton?"mb-2":""),"show-order":!0,"show-border":!0,"place-holder":g.searchPlaceholder},null,8,["modelValue","class","place-holder"])):V("",!0),g.showSelectedCount||g.showClearButton?(y(),I("div",fr,[g.showSelectedCount?(y(),I("span",mr,H(l.value>0?g.$t("g.itemsSelected",{selectedCount:l.value}):g.$t("g.itemSelected",{selectedCount:l.value})),1)):V("",!0),g.showClearButton?(y(),O(Qs,{key:1,label:g.$t("g.clearAll"),type:"transparent",size:"fit-content",class:"text-sm text-text-primary",onClick:c[1]||(c[1]=Ee(f=>t.value=[],["stop"]))},null,8,["label"])):V("",!0)])):V("",!0),c[3]||(c[3]=x("div",{class:"my-4 h-px bg-border-default"},null,-1))])]),key:"0"}:void 0]),1040,["modelValue","pt","aria-label"]))}}),yr={class:"flex items-center gap-2 text-sm text-neutral-500"},br={key:0,class:"text-base-foreground"},wr={key:1,class:"text-base-foreground"},Cr={class:"truncate"},Sr={key:0,class:"icon-[lucide--check] text-base-foreground"},Pn=j({inheritAttrs:!1,__name:"SingleSelect",props:wa({label:{},options:{},listMaxHeight:{default:"28rem"},popoverMinWidth:{},popoverMaxWidth:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const t=an(e,"modelValue"),{t:o}=he(),s=n(a=>{if(a==null||!e.options)return e.label??"";const i=e.options.find(r=>r.value===a);return i?i.name:e.label??""},"getLabel"),l=b(()=>{if(!e.popoverMinWidth&&!e.popoverMaxWidth)return;const a=[];return e.popoverMinWidth&&a.push(`min-width: ${e.popoverMinWidth}`),e.popoverMaxWidth&&a.push(`max-width: ${e.popoverMaxWidth}`),a.join("; ")});return(a,i)=>(y(),O(w(wl),nt({modelValue:t.value,"onUpdate:modelValue":i[0]||(i[0]=r=>t.value=r)},a.$attrs,{options:a.options,"option-label":"name","option-value":"value",unstyled:"",pt:{root:n(({props:r})=>({class:["h-10 relative inline-flex cursor-pointer select-none items-center","rounded-lg","bg-base-background text-base-foreground","border-[2.5px] border-solid border-transparent","transition-all duration-200 ease-in-out","focus-within:border-node-component-border",{"opacity-60 cursor-default":r.disabled}]}),"root"),label:{class:"flex-1 flex items-center whitespace-nowrap pl-4 py-2 outline-hidden"},dropdown:{class:"flex shrink-0 items-center justify-center px-3 py-2"},overlay:{class:w(re)("mt-2 p-2 rounded-lg","bg-base-background text-base-foreground","border border-solid border-border-default")},listContainer:n(()=>({style:`max-height: min(${a.listMaxHeight}, 50vh)`,class:"scrollbar-custom"}),"listContainer"),list:{class:"flex flex-col gap-0 p-0 m-0 list-none border-none text-sm"},option:n(({context:r})=>({class:w(re)("flex items-center justify-between gap-3 px-2 py-3 rounded","hover:bg-secondary-background-hover",r.focused&&"bg-secondary-background-hover",r.selected&&"bg-secondary-background-selected hover:bg-secondary-background-selected")}),"option"),optionLabel:{class:"truncate"},optionGroupLabel:{class:"px-3 py-2 text-xs uppercase tracking-wide text-muted-foreground"},emptyMessage:{class:"px-3 py-2 text-sm text-muted-foreground"}},"aria-label":a.label||w(o)("g.singleSelectDropdown"),role:"combobox","aria-expanded":!1,"aria-haspopup":"listbox",tabindex:0}),{value:W(r=>[x("div",yr,[Ne(a.$slots,"icon"),r.value!==null&&r.value!==void 0?(y(),I("span",br,H(s(r.value)),1)):(y(),I("span",wr,H(a.label),1))])]),dropdownicon:W(()=>i[1]||(i[1]=[x("i",{class:"icon-[lucide--chevron-down] text-base text-neutral-500"},null,-1)])),option:W(({option:r,selected:u})=>[x("div",{class:"flex w-full items-center justify-between gap-3",style:me(l.value)},[x("span",Cr,H(r.name),1),u?(y(),I("i",Sr)):V("",!0)],4)]),_:3},16,["modelValue","options","pt","aria-label"]))}});function kr(e){const t=b(()=>{const l=bt(e).map(i=>{const r=i.name.split(".").pop();return r&&r!==i.name?r:null}).filter(i=>i!==null);return Fn(l,(i,r)=>i===r).sort().map(i=>({name:`.${i}`,value:i}))}),o=b(()=>{const l=bt(e).map(i=>i.user_metadata?.base_model).filter(i=>i!==void 0&&typeof i=="string");return Fn(l,(i,r)=>i===r).sort().map(i=>({name:i,value:i}))});return{availableFileFormats:t,availableBaseModels:o}}n(kr,"useAssetFilterOptions");const xr=j({__name:"AssetFilterBar",props:{assets:{default:n(()=>[],"default")}},emits:["filterChange"],setup(e,{emit:t}){const o=R([]),s=R([]),l=R("name-asc"),{availableFileFormats:a,availableBaseModels:i}=kr(e.assets),r=[{name:ae("assetBrowser.sortAZ"),value:"name-asc"},{name:ae("assetBrowser.sortZA"),value:"name-desc"},{name:ae("assetBrowser.sortRecent"),value:"recent"}],u=t,d=re("flex gap-4 items-center justify-between","px-6 pt-2 pb-6"),p=re("flex gap-4 items-center"),g=re("flex items-center"),c=re("min-w-32");function f(){u("filterChange",{fileFormats:o.value.map(v=>v.value),baseModels:s.value.map(v=>v.value),sortBy:l.value})}return n(f,"handleFilterChange"),(v,C)=>(y(),I("div",{class:K(w(d)),"data-component-id":"asset-filter-bar"},[x("div",{class:K(w(p)),"data-component-id":"asset-filter-bar-left"},[w(a).length>0?(y(),O(yt,{key:0,modelValue:o.value,"onUpdate:modelValue":[C[0]||(C[0]=m=>o.value=m),f],label:v.$t("assetBrowser.fileFormats"),options:w(a),class:K(w(c)),"data-component-id":"asset-filter-file-formats"},null,8,["modelValue","label","options","class"])):V("",!0),w(i).length>0?(y(),O(yt,{key:1,modelValue:s.value,"onUpdate:modelValue":[C[1]||(C[1]=m=>s.value=m),f],label:v.$t("assetBrowser.baseModels"),options:w(i),class:K(w(c)),"data-component-id":"asset-filter-base-models"},null,8,["modelValue","label","options","class"])):V("",!0)],2),x("div",{class:K(w(g)),"data-component-id":"asset-filter-bar-right"},[E(Pn,{modelValue:l.value,"onUpdate:modelValue":[C[2]||(C[2]=m=>l.value=m),f],label:v.$t("assetBrowser.sortBy"),options:r,class:K(w(c)),"data-component-id":"asset-filter-sort"},{icon:W(()=>C[3]||(C[3]=[x("i",{class:"icon-[lucide--arrow-up-down] size-3"},null,-1)])),_:1},8,["modelValue","label","class"])],2)],2))}}),$r={class:"absolute right-2 bottom-2 flex flex-wrap justify-end gap-1"},_r=j({__name:"AssetBadgeGroup",props:{badges:{}},setup(e){return(t,o)=>(y(),I("div",$r,[(y(!0),I(ue,null,$e(t.badges,s=>(y(),I("span",{key:s.label,class:K(w(re)("px-2 py-1 rounded text-xs font-bold uppercase tracking-wider text-modal-card-tag-foreground bg-modal-card-tag-background"))},H(s.label),3))),128))]))}}),Tr={class:"relative aspect-square w-full overflow-hidden rounded-xl"},Nr=["src"],Ir={key:1,class:"flex h-full w-full items-center justify-center bg-gradient-to-br from-smoke-400 via-smoke-800 to-charcoal-400"},Mr=["id"],Rr=["id"],Pr={key:0,class:"flex items-center gap-1"},Dr={key:1,class:"flex items-center gap-1"},Ar={key:2,class:"flex items-center gap-1"},Lr=j({__name:"AssetCard",props:{asset:{},interactive:{type:Boolean}},emits:["select"],setup(e){const t=e,o=Z(),s=sn(),l=sn(),a=b(()=>o.get("LiteGraph.Node.TooltipDelay")),{error:i}=Ls({src:t.asset.preview_url??"",alt:t.asset.name}),r=b(()=>t.asset.preview_url&&!i.value),u=b(()=>{const p=re("rounded-xl overflow-hidden transition-all duration-200 bg-modal-card-background");return t.interactive?re(p,"group","appearance-none bg-transparent p-0 m-0","font-inherit text-inherit outline-none cursor-pointer text-left","hover:bg-secondary-background","border-none","focus:outline-solid outline-azure-600 outline-4"):p}),d=b(()=>t.interactive?{type:"button","aria-labelledby":s,"aria-describedby":l}:{"aria-labelledby":s,"aria-describedby":l});return(p,g)=>{const c=Te("tooltip");return y(),O(Mt(p.interactive?"button":"div"),nt({"data-component-id":"AssetCard","data-asset-id":p.asset.id},d.value,{class:u.value,onClick:g[0]||(g[0]=f=>p.interactive&&p.$emit("select",p.asset)),onKeydown:g[1]||(g[1]=Rt(f=>p.interactive&&p.$emit("select",p.asset),["enter"]))}),{default:W(()=>[x("div",Tr,[r.value?(y(),I("img",{key:0,src:p.asset.preview_url,class:"h-full w-full object-contain"},null,8,Nr)):(y(),I("div",Ir)),E(_r,{badges:p.asset.badges},null,8,["badges"])]),x("div",{class:K(w(re)("p-4 h-32 flex flex-col justify-between"))},[x("div",null,[pe((y(),I("h3",{id:w(s),class:K(w(re)("mb-2 m-0 text-base font-semibold line-clamp-2 wrap-anywhere","text-base-foreground"))},[Ye(H(p.asset.name),1)],10,Mr)),[[c,{value:p.asset.name,showDelay:a.value},void 0,{top:!0}]]),pe((y(),I("p",{id:w(l),class:K(w(re)("m-0 text-sm leading-6 overflow-hidden [-webkit-box-orient:vertical] [-webkit-line-clamp:2] [display:-webkit-box]","text-muted-foreground"))},[Ye(H(p.asset.description),1)],10,Rr)),[[c,{value:p.asset.description,showDelay:a.value},void 0,{top:!0}]])]),x("div",{class:K(w(re)("flex gap-4 text-xs text-muted-foreground"))},[p.asset.stats.stars?(y(),I("span",Pr,[g[2]||(g[2]=x("i",{class:"icon-[lucide--star] size-3"},null,-1)),Ye(" "+H(p.asset.stats.stars),1)])):V("",!0),p.asset.stats.downloadCount?(y(),I("span",Dr,[g[3]||(g[3]=x("i",{class:"icon-[lucide--download] size-3"},null,-1)),Ye(" "+H(p.asset.stats.downloadCount),1)])):V("",!0),p.asset.stats.formattedDate?(y(),I("span",Ar,[g[4]||(g[4]=x("i",{class:"icon-[lucide--clock] size-3"},null,-1)),Ye(" "+H(p.asset.stats.formattedDate),1)])):V("",!0)],2)],2)]),_:1},16,["data-asset-id","class"])}}});function Dn(e={}){const{minWidth:t="15rem",maxWidth:o="1fr",padding:s="0",gap:l="1rem",columns:a}=e;return a!==void 0&&a<1&&console.warn("createGridStyle: columns must be >= 1, defaulting to 1"),{display:"grid",gridTemplateColumns:a?`repeat(${Math.max(1,a??1)}, 1fr)`:`repeat(auto-fill, minmax(${t}, ${o}))`,padding:s,gap:l}}n(Dn,"createGridStyle");const Er=["aria-setsize"],Vr={key:0,class:"col-span-full flex items-center justify-center py-20"},Wr={key:1,class:"col-span-full flex flex-col items-center justify-center py-16 text-muted-foreground"},Or={class:"mb-2 text-lg font-medium"},Br={class:"text-sm"},zr=j({__name:"AssetGrid",props:{assets:{},loading:{type:Boolean}},emits:["assetSelect"],setup(e){const t=b(()=>Dn());return(o,s)=>(y(),I("div",{"data-component-id":"AssetGrid",style:me(t.value),role:"grid","aria-label":"Asset collection","aria-rowcount":-1,"aria-colcount":-1,"aria-setsize":o.assets.length},[o.loading?(y(),I("div",Vr,s[1]||(s[1]=[x("i",{class:"icon-[lucide--loader] size-12 animate-spin text-muted-foreground"},null,-1)]))):o.assets.length===0?(y(),I("div",Wr,[s[2]||(s[2]=x("i",{class:"mb-4 icon-[lucide--search] size-10"},null,-1)),x("h3",Or,H(o.$t("assetBrowser.noAssetsFound")),1),x("p",Br,H(o.$t("assetBrowser.tryAdjustingFilters")),1)])):(y(!0),I(ue,{key:2},$e(o.assets,l=>(y(),O(Lr,{key:l.id,asset:l,interactive:!0,role:"gridcell",onSelect:s[0]||(s[0]=a=>o.$emit("assetSelect",a))},null,8,["asset"]))),128))],12,Er))}});function Ur(e){return typeof e.user_metadata?.description=="string"?e.user_metadata.description:null}n(Ur,"getAssetDescription");function fs(e){return typeof e.user_metadata?.base_model=="string"?e.user_metadata.base_model:null}n(fs,"getAssetBaseModel");function Fr(e){return t=>e==="all"||t.tags.includes(e)}n(Fr,"filterByCategory");function Gr(e){return t=>{if(e.length===0)return!0;const o=new Set(e),s=t.name.split(".").pop()?.toLowerCase();return s?o.has(s):!1}}n(Gr,"filterByFileFormats");function Hr(e){return t=>{if(e.length===0)return!0;const o=new Set(e),s=fs(t);return s?o.has(s):!1}}n(Hr,"filterByBaseModels");function jr(e=R([])){const t=b(()=>e.value??[]),o=R(""),s=R("all"),l=R({sortBy:"name-asc",fileFormats:[],baseModels:[]});function a(v){const C=v.tags.find(S=>S!=="models"),m=Ur(v)||`${C||ae("assetBrowser.unknown")} model`,h=[];C&&h.push({label:C,type:"type"});const k=fs(v);k&&h.push({label:k,type:"base"});const T={formattedDate:Zs(new Date(v.created_at),{dateStyle:"short"}),downloadCount:void 0,stars:void 0};return{...v,description:m,badges:h,stats:T}}n(a,"transformAssetForDisplay");const i=b(()=>{const v=t.value.filter(m=>m.tags[0]==="models").map(m=>m.tags[1]).filter(m=>typeof m=="string"&&m.length>0),C=Array.from(new Set(v)).sort().map(m=>({id:m,label:m.charAt(0).toUpperCase()+m.slice(1),icon:"icon-[lucide--package]"}));return[{id:"all",label:ae("assetBrowser.allModels"),icon:"icon-[lucide--folder]"},...C]}),r=b(()=>s.value==="all"?ae("assetBrowser.allModels"):i.value.find(C=>C.id===s.value)?.label||ae("assetBrowser.assets")),u=b(()=>t.value.filter(Fr(s.value))),d={fuseOptions:{keys:[{name:"name",weight:.4},{name:"tags",weight:.3}],threshold:.4,ignoreLocation:!0,includeScore:!0},matchAllWhenSearchEmpty:!0},{results:p}=Ta(o,u,d),g=b(()=>p.value.map(v=>v.item)),c=b(()=>{const C=[...g.value.filter(Gr(l.value.fileFormats)).filter(Hr(l.value.baseModels))];return C.sort((m,h)=>{switch(l.value.sortBy){case"name-desc":return h.name.localeCompare(m.name);case"recent":return new Date(h.created_at).getTime()-new Date(m.created_at).getTime();case"popular":return m.name.localeCompare(h.name);case"name-asc":default:return m.name.localeCompare(h.name)}}),C.map(a)});function f(v){l.value={...v}}return n(f,"updateFilters"),{searchQuery:o,selectedCategory:s,availableCategories:i,contentTitle:r,categoryFilteredAssets:u,filteredAssets:c,updateFilters:f}}n(jr,"useAssetBrowser");const qr=new Set(["VAE","CLIP","GLIGEN"]);function Kr(e){return e?e==="diffusion_models"?"Diffusion":e.split("_").map(t=>{const o=t.toUpperCase();if(qr.has(o))return o;const s=t.toLowerCase();return s.charAt(0).toUpperCase()+s.slice(1)}).join(" "):"Models"}n(Kr,"formatCategoryLabel");const Yr={class:"capitalize"},Qr={class:"flex w-full items-center justify-between gap-2"},na=j({__name:"AssetBrowserModal",props:{nodeType:{},inputName:{},onSelect:{type:Function},onClose:{type:Function},showLeftPanel:{type:Boolean},title:{},assetType:{}},emits:["asset-select","close"],setup(e,{emit:t}){const o=e,{t:s}=he(),l=t;Io(Oo,o.onClose??(()=>{}));const a=n(async()=>o.nodeType?await Gn.getAssetsForNodeType(o.nodeType)??[]:o.assetType?await Gn.getAssetsByTag(o.assetType)??[]:[],"fetchAssets"),{state:i,isLoading:r,execute:u}=Na(a,[],{immediate:!1});J(()=>[o.nodeType,o.assetType],async()=>{await u()},{immediate:!0});const{searchQuery:d,selectedCategory:p,availableCategories:g,categoryFilteredAssets:c,filteredAssets:f,updateFilters:v}=jr(i),C=wn(),m=b(()=>{const N=(i.value??[]).map(B=>B.tags?.find(D=>D!=="models")).find(B=>typeof B=="string"&&B.length>0);if(N)return N;if(o.nodeType){const B=C.getCategoryForNodeType(o.nodeType);if(B)return B}return o.assetType?o.assetType:"models"}),h=b(()=>p.value!=="all"?p.value:m.value),k=b(()=>{if(o.title)return o.title;const L=Kr(h.value);return s("assetBrowser.allCategory",{category:L})}),T=b(()=>o.showLeftPanel??!0);function S(){o.onClose?.(),l("close")}n(S,"handleClose");function $(L){l("asset-select",L),o.onSelect?.(L)}n($,"handleAssetSelectAndEmit");const{flags:_}=cr(),P=b(()=>_.modelUploadButtonEnabled);function M(){}return n(M,"handleUploadClick"),(L,N)=>(y(),O(Mn,{"data-component-id":"AssetBrowserModal",class:"size-full max-h-full max-w-full min-w-0","content-title":k.value,onClose:S},hn({header:W(()=>[x("div",Qr,[E(Do,{modelValue:w(d),"onUpdate:modelValue":N[1]||(N[1]=B=>Yt(d)?d.value=B:null),autofocus:!0,size:"lg",placeholder:L.$t("assetBrowser.searchAssetsPlaceholder"),class:"max-w-96"},null,8,["modelValue","placeholder"]),P.value?(y(),O(Gt,{key:0,type:"accent",size:"md",class:"!h-10 [&>span]:hidden md:[&>span]:inline",label:L.$t("assetBrowser.uploadModel"),"on-click":M},{icon:W(()=>N[3]||(N[3]=[x("i",{class:"icon-[lucide--upload]"},null,-1)])),_:1},8,["label"])):V("",!0)])]),contentFilter:W(()=>[E(xr,{assets:w(c),onFilterChange:w(v)},null,8,["assets","onFilterChange"])]),content:W(()=>[E(zr,{assets:w(f),loading:w(r),onAssetSelect:$},null,8,["assets","loading"])]),_:2},[T.value?{name:"leftPanel",fn:W(()=>[E(Rn,{modelValue:w(p),"onUpdate:modelValue":N[0]||(N[0]=B=>Yt(p)?p.value=B:null),"data-component-id":"AssetBrowserModal-LeftSidePanel","nav-items":w(g)},{"header-icon":W(()=>N[2]||(N[2]=[x("div",{class:"icon-[lucide--folder] size-4"},null,-1)])),"header-title":W(()=>[x("span",Yr,H(k.value),1)]),_:1},8,["modelValue","nav-items"])]),key:"0"}:void 0]),1032,["content-title"]))}}),aa={headless:!0,modal:!0,closable:!0,pt:{root:{class:"rounded-2xl overflow-hidden asset-browser-dialog"},header:{class:"!p-0 hidden"},content:{class:"!p-0 !m-0 h-full w-full"}}},Zr=n(()=>{const e=eo(),t="global-asset-browser";async function o(l){const a=n(i=>{l.onAssetSelected?.(i),e.closeDialog({key:t})},"handleAssetSelected");e.showDialog({key:t,component:na,props:{nodeType:l.nodeType,inputName:l.inputName,currentValue:l.currentValue,onSelect:a,onClose:n(()=>e.closeDialog({key:t}),"onClose")},dialogComponentProps:aa})}n(o,"show");async function s(l){const a=n(i=>{l.onAssetSelected?.(i),e.closeDialog({key:t})},"handleAssetSelected");e.showDialog({key:t,component:na,props:{showLeftPanel:!0,assetType:l.assetType,title:l.title,onSelect:a,onClose:n(()=>e.closeDialog({key:t}),"onClose")},dialogComponentProps:aa})}return n(s,"browse"),{show:o,browse:s}},"useAssetBrowserDialog"),Xr=["aria-label"],Jr={class:"relative h-88 w-full grow overflow-hidden rounded-[5px] bg-node-component-surface"},eu={key:0,class:"flex size-full flex-col items-center justify-center bg-smoke-800/50 text-center text-white"},tu={class:"text-sm text-smoke-300"},ou={class:"mt-1 text-xs text-smoke-400"},nu=["src"],au={key:3,class:"actions absolute top-2 right-2 flex gap-1"},su=["title","aria-label"],iu=["title","aria-label"],lu={key:4,class:"absolute right-2 bottom-2 left-2 flex justify-center gap-1"},ru=["aria-label","onClick"],uu={class:"relative"},cu={class:"mt-2 text-center text-xs text-white"},du={key:0,class:"text-red-400"},pu={key:1,class:"text-smoke-400"},fu={key:2},mu=j({__name:"VideoPreview",props:{imageUrls:{},nodeId:{}},setup(e){const t=e,{t:o}=he(),s=Dt(),l=R(0),a=R(!1),i=R(null),r=R(!1),u=R(!1),d=b(()=>t.imageUrls[l.value]),p=b(()=>t.imageUrls.length>1);J(()=>t.imageUrls,$=>{l.value>=$.length&&(l.value=0),i.value=null,r.value=!1,u.value=!1},{deep:!0});const g=n($=>{if(!$.target||!($.target instanceof HTMLVideoElement))return;const _=$.target;u.value=!1,r.value=!1,_.videoWidth&&_.videoHeight&&(i.value=`${_.videoWidth} x ${_.videoHeight}`)},"handleVideoLoad"),c=n(()=>{u.value=!1,r.value=!0,i.value=null},"handleVideoError"),f=n(()=>{try{Cn(d.value)}catch{Wo().add({severity:"error",summary:"Error",detail:o("g.failedToDownloadVideo"),life:3e3,group:"video-preview"})}},"handleDownload"),v=n(()=>{t.nodeId&&s.removeNodeOutputs(t.nodeId)},"handleRemove"),C=n($=>{$>=0&&$<t.imageUrls.length&&(l.value=$,i.value=null,u.value=!0,r.value=!1)},"setCurrentIndex"),m=n(()=>{a.value=!0},"handleMouseEnter"),h=n(()=>{a.value=!1},"handleMouseLeave"),k=n($=>["w-2 h-2 rounded-full transition-all duration-200 border-0 cursor-pointer",$===l.value?"bg-white":"bg-white/50 hover:bg-white/80"],"getNavigationDotClass"),T=n($=>{if(!(t.imageUrls.length<=1))switch($.key){case"ArrowLeft":$.preventDefault(),C(l.value>0?l.value-1:t.imageUrls.length-1);break;case"ArrowRight":$.preventDefault(),C(l.value<t.imageUrls.length-1?l.value+1:0);break;case"Home":$.preventDefault(),C(0);break;case"End":$.preventDefault(),C(t.imageUrls.length-1);break}},"handleKeyDown"),S=n($=>{try{return new URL($).searchParams.get("filename")||"Unknown file"}catch{return"Invalid URL"}},"getVideoFilename");return($,_)=>$.imageUrls.length>0?(y(),I("div",{key:0,class:"video-preview group relative flex size-full min-h-16 min-w-16 flex-col px-2",tabindex:"0",role:"region","aria-label":$.$t("g.videoPreview"),onMouseenter:m,onMouseleave:h,onKeydown:T},[x("div",Jr,[r.value?(y(),I("div",eu,[_[0]||(_[0]=x("i",{class:"mb-2 icon-[lucide--video-off] h-12 w-12 text-smoke-400"},null,-1)),x("p",tu,H($.$t("g.videoFailedToLoad")),1),x("p",ou,H(S(d.value)),1)])):u.value?(y(),O(w(ss),{key:1,class:"size-full","border-radius":"5px"})):(y(),I("video",{key:2,src:d.value,class:"block size-full object-contain",controls:"",loop:"",playsinline:"",onLoadeddata:g,onError:c},null,40,nu)),a.value?(y(),I("div",au,[x("button",{class:"action-btn cursor-pointer rounded-lg border-0 bg-white p-2 text-black shadow-sm transition-all duration-200 hover:bg-smoke-100",title:$.$t("g.downloadVideo"),"aria-label":$.$t("g.downloadVideo"),onClick:f},_[1]||(_[1]=[x("i",{class:"icon-[lucide--download] h-4 w-4"},null,-1)]),8,su),x("button",{class:"action-btn cursor-pointer rounded-lg border-0 bg-white p-2 text-black shadow-sm transition-all duration-200 hover:bg-smoke-100",title:$.$t("g.removeVideo"),"aria-label":$.$t("g.removeVideo"),onClick:v},_[2]||(_[2]=[x("i",{class:"icon-[lucide--x] h-4 w-4"},null,-1)]),8,iu)])):V("",!0),p.value?(y(),I("div",lu,[(y(!0),I(ue,null,$e($.imageUrls,(P,M)=>(y(),I("button",{key:M,class:K(k(M)),"aria-label":$.$t("g.viewVideoOfTotal",{index:M+1,total:$.imageUrls.length}),onClick:n(L=>C(M),"onClick")},null,10,ru))),128))])):V("",!0)]),x("div",uu,[x("div",cu,[r.value?(y(),I("span",du,H($.$t("g.errorLoadingVideo")),1)):u.value?(y(),I("span",pu,H($.$t("g.loading"))+"... ",1)):(y(),I("span",fu,H(i.value||$.$t("g.calculatingDimensions")),1))]),E(Ea)])],40,Xr)):V("",!0)}}),vu=["aria-label"],gu={class:"min-h-88 w-full overflow-hidden rounded-[5px] bg-node-component-surface"},hu={key:0,class:"flex size-full flex-col items-center justify-center bg-smoke-800/50 text-center text-white"},yu={class:"text-sm text-smoke-300"},bu={class:"mt-1 text-xs text-smoke-400"},wu=["src","alt"],Cu={key:3,class:"actions absolute top-2 right-2 flex gap-2.5"},Su=["title","aria-label"],ku=["title","aria-label"],xu=["title","aria-label"],$u={key:4,class:"absolute right-2 bottom-2 left-2 flex justify-center gap-1"},_u=["aria-label","onClick"],Tu={class:"relative"},Nu={class:"mt-2 text-center text-xs text-white"},Iu={key:0,class:"text-red-400"},Mu={key:1,class:"text-smoke-400"},Ru={key:2},Zo="flex h-8 min-h-8 items-center justify-center gap-2.5 rounded-lg border-0 bg-button-surface px-2 py-2 text-button-surface-contrast shadow-sm transition-colors duration-200 hover:bg-button-hover-surface focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-button-surface-contrast focus-visible:ring-offset-2 focus-visible:ring-offset-transparent cursor-pointer",Pu=j({__name:"ImagePreview",props:{imageUrls:{},nodeId:{}},setup(e){const t=e,{t:o}=he(),s=be(),l=Dt(),a=R(0),i=R(!1),r=R(null),u=R(!1),d=R(!1),p=R(),g=b(()=>t.imageUrls[a.value]),c=b(()=>t.imageUrls.length>1),f=b(()=>`Node output ${a.value+1}`);J(()=>t.imageUrls,N=>{a.value>=N.length&&(a.value=0),r.value=null,u.value=!1,d.value=!1},{deep:!0});const v=n(N=>{if(!N.target||!(N.target instanceof HTMLImageElement))return;const B=N.target;d.value=!1,u.value=!1,B.naturalWidth&&B.naturalHeight&&(r.value=`${B.naturalWidth} x ${B.naturalHeight}`)},"handleImageLoad"),C=n(()=>{d.value=!1,u.value=!0,r.value=null},"handleImageError"),m=n(()=>{if(!t.nodeId||!p.value)return;const N=F.rootGraph?.getNodeById(t.nodeId);N&&(N.imageIndex=a.value,N.imgs=[p.value],F.canvas?.select(N))},"setupNodeForMaskEditor"),h=n(()=>{m(),s.execute("Comfy.MaskEditor.OpenMaskEditor")},"handleEditMask"),k=n(()=>{try{Cn(g.value)}catch{Wo().add({severity:"error",summary:"Error",detail:o("g.failedToDownloadImage"),life:3e3,group:"image-preview"})}},"handleDownload"),T=n(()=>{t.nodeId&&l.removeNodeOutputs(t.nodeId)},"handleRemove"),S=n(N=>{N>=0&&N<t.imageUrls.length&&(a.value=N,r.value=null,d.value=!1,u.value=!1)},"setCurrentIndex"),$=n(()=>{i.value=!0},"handleMouseEnter"),_=n(()=>{i.value=!1},"handleMouseLeave"),P=n(N=>["w-2 h-2 rounded-full transition-all duration-200 border-0 cursor-pointer",N===a.value?"bg-white":"bg-white/50 hover:bg-white/80"],"getNavigationDotClass"),M=n(N=>{if(!(t.imageUrls.length<=1))switch(N.key){case"ArrowLeft":N.preventDefault(),S(a.value>0?a.value-1:t.imageUrls.length-1);break;case"ArrowRight":N.preventDefault(),S(a.value<t.imageUrls.length-1?a.value+1:0);break;case"Home":N.preventDefault(),S(0);break;case"End":N.preventDefault(),S(t.imageUrls.length-1);break}},"handleKeyDown"),L=n(N=>{try{return new URL(N).searchParams.get("filename")||"Unknown file"}catch{return"Invalid URL"}},"getImageFilename");return(N,B)=>{const D=Va;return N.imageUrls.length>0?(y(),I("div",{key:0,class:"image-preview group relative flex size-full min-h-16 min-w-16 flex-col px-2 justify-center",tabindex:"0",role:"region","aria-label":N.$t("g.imagePreview"),onMouseenter:$,onMouseleave:_,onKeydown:M},[x("div",gu,[u.value?(y(),I("div",hu,[B[0]||(B[0]=x("i",{class:"mb-2 icon-[lucide--image-off] h-12 w-12 text-smoke-400"},null,-1)),x("p",yu,H(N.$t("g.imageFailedToLoad")),1),x("p",bu,H(L(g.value)),1)])):d.value?(y(),O(w(ss),{key:1,class:"size-full","border-radius":"5px"})):(y(),I("img",{key:2,ref_key:"currentImageEl",ref:p,src:g.value,alt:f.value,class:"block size-full object-contain pointer-events-none",onLoad:v,onError:C},null,40,wu)),i.value?(y(),I("div",Cu,[c.value?V("",!0):(y(),I("button",{key:0,class:K(Zo),title:N.$t("g.editOrMaskImage"),"aria-label":N.$t("g.editOrMaskImage"),onClick:h},[E(D,{class:"h-4 w-4"})],8,Su)),x("button",{class:K(Zo),title:N.$t("g.downloadImage"),"aria-label":N.$t("g.downloadImage"),onClick:k},B[1]||(B[1]=[x("i",{class:"icon-[lucide--download] h-4 w-4"},null,-1)]),8,ku),x("button",{class:K(Zo),title:N.$t("g.removeImage"),"aria-label":N.$t("g.removeImage"),onClick:T},B[2]||(B[2]=[x("i",{class:"icon-[lucide--x] h-4 w-4"},null,-1)]),8,xu)])):V("",!0),c.value?(y(),I("div",$u,[(y(!0),I(ue,null,$e(N.imageUrls,(z,U)=>(y(),I("button",{key:U,class:K(P(U)),"aria-label":N.$t("g.viewImageOfTotal",{index:U+1,total:N.imageUrls.length}),onClick:n(A=>S(U),"onClick")},null,10,_u))),128))])):V("",!0)]),x("div",Tu,[x("div",Nu,[u.value?(y(),I("span",Iu,H(N.$t("g.errorLoadingImage")),1)):d.value?(y(),I("span",Mu,H(N.$t("g.loading"))+"... ",1)):(y(),I("span",Ru,H(r.value||N.$t("g.calculatingDimensions")),1))]),E(Ea)])],40,vu)):V("",!0)}}}),Du={key:0,class:"node-error p-2 text-sm text-red-500"},Au={key:1,class:"lg-node-content flex grow flex-col"},Lu=j({__name:"NodeContent",props:{nodeData:{},media:{}},setup(e){const t=e,o=b(()=>t.media&&t.media.urls.length>0),s=b(()=>t.nodeData?.id?.toString()),l=R(null),{toastErrorHandler:a}=Sn();return Ca(i=>(l.value=i.message,a(i),!1)),(i,r)=>l.value?(y(),I("div",Du,H(w(ke)("nodeErrors.content","Node Content Error")),1)):(y(),I("div",Au,[Ne(i.$slots,"default",{},()=>[o.value&&i.media?.type==="video"?(y(),O(mu,{key:0,"image-urls":i.media.urls,"node-id":s.value,class:"mt-2"},null,8,["image-urls","node-id"])):o.value&&i.media?.type==="image"?(y(),O(Pu,{key:1,"image-urls":i.media.urls,"node-id":s.value,class:"mt-2"},null,8,["image-urls","node-id"])):V("",!0)])]))}}),Eu={class:"flex max-w-xs min-w-40 flex-col gap-2 p-3"},Vu={class:"text-sm font-inter"},Wu={key:1,class:"text-xs"},Ou={class:"flex max-w-xs min-w-40 flex-col gap-2 p-3"},Bu={class:"text-sm font-inter"},zu={key:1,class:"text-xs"},sa="cursor-pointer transition-opacity hover:opacity-80",Uu=j({__name:"TopbarBadge",props:{badge:{},displayMode:{default:"full"},reverseOrder:{type:Boolean,default:!1},noPadding:{type:Boolean,default:!1},backgroundColor:{default:"var(--comfy-menu-bg)"}},setup(e){const t=e,o=R(),s=n(c=>{o.value?.toggle(c)},"togglePopover"),l=b(()=>t.badge.variant??"info"),a=b(()=>({backgroundColor:t.backgroundColor})),i=b(()=>{switch(l.value){case"error":return"bg-danger-100 text-white";case"warning":return"bg-gold-600 text-black";case"info":default:return"bg-white text-black"}}),r=b(()=>{switch(l.value){case"error":return"text-danger-100";case"warning":return"text-gold-600";case"info":default:return"text-text-primary"}}),u=b(()=>r.value),d=b(()=>{if(t.badge.icon)return t.badge.icon;switch(l.value){case"error":return"pi pi-exclamation-circle";case"warning":return"pi pi-exclamation-triangle";case"info":default:return}}),p=b(()=>{switch(l.value){case"error":return"bg-danger-100";case"warning":return"bg-gold-600";case"info":default:return"bg-slate-100"}}),g=b(()=>({root:{class:re("absolute z-50")},content:{class:re("mt-1 rounded-lg","bg-base-background","text-base-foreground","shadow-lg","border border-border-default")}}));return(c,f)=>{const v=Te("tooltip");return c.displayMode==="icon-only"?(y(),I("div",{key:0,class:K(["relative inline-flex h-full shrink-0 items-center justify-center px-2",sa]),style:me(a.value),onClick:s},[d.value?(y(),I("i",{key:0,class:K(["shrink-0 text-base",d.value,u.value])},null,2)):c.badge.label?(y(),I("div",{key:1,class:K(["shrink-0 rounded-full px-1.5 py-0.5 text-xxxs font-semibold",i.value])},H(c.badge.label),3)):(y(),I("div",{key:2,class:K(["size-2 shrink-0 rounded-full",p.value])},null,2)),E(w(ut),{ref_key:"popover",ref:o,"append-to":"body","auto-z-index":!0,"base-z-index":1e3,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:g.value},{default:W(()=>[x("div",Eu,[c.badge.label?(y(),I("div",{key:0,class:K(["w-fit rounded-full px-1.5 py-0.5 text-xxxs font-semibold",i.value])},H(c.badge.label),3)):V("",!0),x("div",Vu,H(c.badge.text),1),c.badge.tooltip?(y(),I("div",Wu,H(c.badge.tooltip),1)):V("",!0)])]),_:1},8,["pt"])],4)):c.displayMode==="compact"?(y(),I("div",{key:1,class:"relative inline-flex h-full",style:me(a.value)},[x("div",{class:K(["flex h-full shrink-0 items-center gap-2 whitespace-nowrap",[{"flex-row-reverse":c.reverseOrder},c.noPadding?"":"px-3",sa]]),onClick:s},[d.value?(y(),I("i",{key:0,class:K(["shrink-0 text-base",d.value,u.value])},null,2)):V("",!0),c.badge.label?(y(),I("div",{key:1,class:K(["shrink-0 rounded-full px-1.5 py-0.5 text-xxxs font-semibold",i.value])},H(c.badge.label),3)):V("",!0)],2),E(w(ut),{ref_key:"popover",ref:o,"append-to":"body","auto-z-index":!0,"base-z-index":1e3,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:g.value},{default:W(()=>[x("div",Ou,[c.badge.label?(y(),I("div",{key:0,class:K(["w-fit rounded-full px-1.5 py-0.5 text-xxxs font-semibold",i.value])},H(c.badge.label),3)):V("",!0),x("div",Bu,H(c.badge.text),1),c.badge.tooltip?(y(),I("div",zu,H(c.badge.tooltip),1)):V("",!0)])]),_:1},8,["pt"])],4)):pe((y(),I("div",{key:2,class:K(["flex h-full shrink-0 items-center gap-2 whitespace-nowrap",[{"flex-row-reverse":c.reverseOrder},c.noPadding?"":"px-3"]]),style:me(a.value)},[d.value?(y(),I("i",{key:0,class:K(["shrink-0 text-base",d.value,u.value])},null,2)):V("",!0),c.badge.label?(y(),I("div",{key:1,class:K(["shrink-0 rounded-full px-1.5 py-0.5 text-xxxs font-semibold",i.value])},H(c.badge.label),3)):V("",!0),x("div",{class:K(["font-inter text-sm",r.value])},H(c.badge.text),3)],6)),[[v,c.badge.tooltip]])}}}),Fu=3e3,Gu=5*60*1e3,Hu=j({__name:"SubscribeButton",props:{label:{},size:{default:"large"},variant:{default:"default"},fluid:{type:Boolean,default:!0}},emits:["subscribed"],setup(e,{emit:t}){const o=e,s=b(()=>re("font-bold",o.fluid&&"w-full")),l=t,{subscribe:a,isActiveSubscription:i,fetchStatus:r}=kn(),u=Xs(),d=R(!1),p=R(!1);let g=null;const c=n(()=>{p.value=!0,d.value=!0;const C=Date.now(),m=n(async()=>{try{if(Date.now()-C>Gu){f();return}await r(),i.value&&(f(),u?.trackMonthlySubscriptionSucceeded(),l("subscribed"))}catch(h){console.error("[SubscribeButton] Error polling subscription status:",h)}},"poll");m(),g=window.setInterval(m,Fu)},"startPollingSubscriptionStatus"),f=n(()=>{g&&(clearInterval(g),g=null),p.value=!1,d.value=!1},"stopPolling"),v=n(async()=>{d.value=!0;try{await a(),c()}catch(C){console.error("[SubscribeButton] Error initiating subscription:",C),d.value=!1}},"handleSubscribe");return dt(()=>{f()}),(C,m)=>(y(),O(w(ie),{label:C.label||C.$t("subscription.required.subscribe"),size:C.size,loading:d.value,disabled:p.value,severity:"primary",style:me(C.variant==="gradient"?{background:"var(--color-subscription-button-gradient)",color:"var(--color-white)"}:void 0),pt:{root:{class:s.value}},onClick:v},null,8,["label","size","loading","disabled","style","pt"]))}}),ju=j({__name:"GlobalToast",setup(e){const t=yn(),o=tt(),s=Z();J(()=>o.messagesToAdd,i=>{i.length!==0&&(i.forEach(r=>{t.add(r)}),o.messagesToAdd=[])},{deep:!0}),J(()=>o.messagesToRemove,i=>{i.length!==0&&(i.forEach(r=>{t.remove(r)}),o.messagesToRemove=[])},{deep:!0}),J(()=>o.removeAllRequested,i=>{i&&(t.removeAllGroups(),o.removeAllRequested=!1)});function l(){const i=document.getElementById("dynamic-toast-style")||a(),r=document.querySelector(".graph-canvas-container")?.getBoundingClientRect();r&&(i.textContent=`
    .p-toast.p-component.p-toast-top-right {
      top: ${r.top+100}px !important;
      right: ${window.innerWidth-(r.left+r.width)+20}px !important;
       z-index: 10000 !important;
    }
  `)}n(l,"updateToastPosition");function a(){const i=document.createElement("style");return i.id="dynamic-toast-style",document.head.appendChild(i),i}return n(a,"createStyleElement"),J(()=>s.get("Comfy.UseNewMenu"),()=>De(l),{immediate:!0}),J(()=>s.get("Comfy.Sidebar.Location"),()=>De(l),{immediate:!0}),(i,r)=>(y(),O(w(To)))}});let Xo,ms;(function(){const e=globalThis;typeof e.requestIdleCallback!="function"||typeof e.cancelIdleCallback!="function"?Xo=n((t,o,s)=>{setTimeout(()=>{if(l)return;const a=Date.now()+15;o(Object.freeze({didTimeout:!0,timeRemaining(){return Math.max(0,a-Date.now())}}))});let l=!1;return{dispose(){l||(l=!0)}}},"_runWhenIdle"):Xo=n((t,o,s)=>{const l=t.requestIdleCallback(o,typeof s=="number"?{timeout:s}:void 0);let a=!1;return{dispose(){a||(a=!0,t.cancelIdleCallback(l))}}},"_runWhenIdle"),ms=n((t,o)=>Xo(globalThis,t,o),"runWhenGlobalIdle")})();const qu={class:"comfy-menu-hamburger no-drag top-0 right-0"},Ku=j({__name:"MenuHamburger",setup(e){const t=Ge(),o=Z(),s=n(()=>{t.focusMode=!1},"exitFocusMode");return ge(()=>{o.get("Comfy.UseNewMenu")==="Disabled"&&(t.focusMode?F.ui.menuContainer.style.display="none":F.ui.menuContainer.style.display="block")}),(l,a)=>{const i=Te("tooltip");return pe((y(),I("div",qu,[pe(E(w(ie),{icon:"pi pi-bars",severity:"secondary",text:"",size:"large","aria-label":l.$t("menu.showMenu"),"aria-live":"assertive",onClick:s,onContextmenu:w(Js)},null,8,["aria-label","onContextmenu"]),[[i,{value:l.$t("menu.showMenu"),showDelay:300}]]),a[0]||(a[0]=x("div",{class:"window-actions-spacer"},null,-1))],512)),[[Fe,w(t).focusMode]])}}}),Yu=we(Ku,[["__scopeId","data-v-048d09e7"]]),Qu=j({__name:"UnloadWindowConfirmDialog",setup(e){const t=Z(),o=_e(),s=n(l=>{if(t.get("Comfy.Window.UnloadConfirmation")&&o.modifiedWorkflows.length>0)return l.preventDefault(),!0},"handleBeforeUnload");return Me(()=>{window.addEventListener("beforeunload",s)}),dt(()=>{window.removeEventListener("beforeunload",s)}),(l,a)=>(y(),I("div"))}}),Zu={class:"splitter-overlay-root pointer-events-none flex flex-col"},Xu={class:"side-toolbar-container"},Ju=j({__name:"LiteGraphCanvasSplitterOverlay",setup(e){const t=Z(),o=b(()=>t.get("Comfy.Sidebar.Location")),s=b(()=>t.get("Comfy.Sidebar.UnifiedWidth")),l=b(()=>$o().activeSidebarTab!==null),a=b(()=>At().bottomPanelVisible),i=b(()=>$o().activeSidebarTabId),r=b(()=>s.value?"unified-sidebar":i.value??"default-sidebar");return(u,d)=>(y(),I("div",Zu,[Ne(u.$slots,"workflow-tabs",{},void 0,!0),x("div",{class:K(["pointer-events-none flex flex-1 overflow-hidden",{"flex-row":o.value==="left","flex-row-reverse":o.value==="right"}])},[x("div",Xu,[Ne(u.$slots,"side-toolbar",{},void 0,!0)]),E(w(ea),{key:"main-splitter-stable",class:"splitter-overlay flex-1 overflow-hidden","pt:gutter":l.value?"":"hidden","state-key":r.value||"main-splitter","state-storage":"local"},{default:W(()=>[o.value==="left"?(y(),O(w(Wt),{key:0,class:"side-bar-panel pointer-events-auto","min-size":10,size:20,style:me({display:l.value&&o.value==="left"?"flex":"none"})},{default:W(()=>[l.value&&o.value==="left"?Ne(u.$slots,"side-bar-panel",{key:0},void 0,!0):V("",!0)]),_:3},8,["style"])):V("",!0),E(w(Wt),{size:80,class:"flex flex-col"},{default:W(()=>[Ne(u.$slots,"topmenu",{sidebarPanelVisible:l.value},void 0,!0),E(w(ea),{class:"splitter-overlay splitter-overlay-bottom mr-1 mb-1 ml-1 flex-1",layout:"vertical","pt:gutter":"rounded-tl-lg rounded-tr-lg "+(a.value?"":"hidden"),"state-key":"bottom-panel-splitter","state-storage":"local"},{default:W(()=>[E(w(Wt),{class:"graph-canvas-panel relative"},{default:W(()=>[Ne(u.$slots,"graph-canvas-panel",{},void 0,!0)]),_:3}),pe(E(w(Wt),{class:"bottom-panel pointer-events-auto rounded-lg"},{default:W(()=>[Ne(u.$slots,"bottom-panel",{},void 0,!0)]),_:3},512),[[Fe,a.value]])]),_:3},8,["pt:gutter"])]),_:3}),o.value==="right"?(y(),O(w(Wt),{key:1,class:"side-bar-panel pointer-events-auto","min-size":10,size:20,style:me({display:l.value&&o.value==="right"?"flex":"none"})},{default:W(()=>[l.value&&o.value==="right"?Ne(u.$slots,"side-bar-panel",{key:0},void 0,!0):V("",!0)]),_:3},8,["style"])):V("",!0)]),_:3},8,["pt:gutter","state-key"])],2)]))}}),ec=we(Ju,[["__scopeId","data-v-d3c440a8"]]),tc=Ps(()=>Wa(()=>import("./ComfyQueueButton-Csldb7Iq.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))),oc={class:"flex h-full items-center"},nc=j({__name:"ComfyActionbar",setup(e){const t=Z(),o=b(()=>t.get("Comfy.UseNewMenu")),s=b(()=>o.value!=="Disabled"),l=document.querySelector(".workflow-tabs-container"),a=R(null),i=R(null),r=xo("Comfy.MenuPosition.Docked",!0),u=xo("Comfy.MenuPosition.Floating",{x:0,y:0}),{x:d,y:p,style:g,isDragging:c}=Es(a,{initialValue:{x:0,y:0},handle:i,containerElement:document.body,onMove:n(_=>{const P=l?.getBoundingClientRect().bottom??40;_.y<P&&(_.y=P)},"onMove")});zt([d,p],([_,P])=>{u.value={x:_,y:P}},{debounce:300});const f=n(()=>{if(a.value){const _=window.innerWidth,P=window.innerHeight,M=a.value.offsetWidth,L=a.value.offsetHeight;if(M===0||L===0)return;if(u.value.x!==0||u.value.y!==0){d.value=_t(u.value.x,0,_-M),p.value=_t(u.value.y,0,P-L),C();return}d.value===0&&p.value===0&&(d.value=_t((_-M)/2,0,_-M),p.value=_t(P-L-10,0,P-L),C())}},"setInitialPosition");Me(f),J(s,async _=>{_&&await De(f)}),xe(i,"mousedown",()=>{});const v=R({x:d.value,y:p.value,windowWidth:window.innerWidth,windowHeight:window.innerHeight}),C=n(()=>{v.value={x:d.value,y:p.value,windowWidth:window.innerWidth,windowHeight:window.innerHeight}},"captureLastDragState");J(c,_=>{_||C()},{immediate:!0}),xe(window,"resize",n(()=>{if(a.value){const _=window.innerWidth,P=window.innerHeight,M=a.value.offsetWidth,L=a.value.offsetHeight,N=v.value.x,B=v.value.windowWidth-(v.value.x+M),D=v.value.y,z=v.value.windowHeight-(v.value.y+L),A=[{edge:"left",distance:N},{edge:"right",distance:B},{edge:"top",distance:D},{edge:"bottom",distance:z}].reduce((Q,Y)=>Y.distance<Q.distance?Y:Q),G=v.value.y/v.value.windowHeight,q=v.value.x/v.value.windowWidth;A.edge==="left"?(d.value=A.distance,p.value=G*P):A.edge==="right"?(d.value=_-M-A.distance,p.value=G*P):A.edge==="top"?(d.value=q*_,p.value=A.distance):(d.value=q*_,p.value=P-L-A.distance),d.value=_t(d.value,0,_-M),p.value=_t(p.value,0,P-L)}},"adjustMenuPosition"));const h=R(!1),k=n(()=>{c.value&&(h.value=!0)},"onMouseEnterDropZone"),T=n(()=>{c.value&&(h.value=!1)},"onMouseLeaveDropZone");J(c,_=>{_?r.value&&(r.value=!1):(h.value&&(r.value=!0),h.value=!1)});const S=b(()=>re("w-[265px] border-dashed border-blue-500 opacity-80","m-1.5 flex items-center justify-center self-stretch","rounded-md before:w-50 before:-ml-50 before:h-full",h.value&&"border-[3px] opacity-100 scale-105 shadow-[0_0_20px] shadow-blue-500")),$=b(()=>re("actionbar pointer-events-auto z1000",c.value&&"select-none pointer-events-none",r.value?"p-0 static mr-2 border-none bg-transparent":"fixed shadow-interface"));return(_,P)=>(y(),I("div",oc,[w(c)&&!w(r)?(y(),I("div",{key:0,class:K(S.value),onMouseenter:k,onMouseleave:T},H(w(ae)("actionbar.dockToTop")),35)):V("",!0),E(w(as),{class:K(["pointer-events-auto z-1000",$.value]),style:me(w(g)),pt:{header:{class:"hidden"},content:{class:w(r)?"p-0":"p-1"}}},{default:W(()=>[x("div",{ref_key:"panelRef",ref:a,class:"flex items-center select-none"},[x("span",{ref_key:"dragHandleRef",ref:i,class:K(w(re)("drag-handle cursor-grab w-3 h-max mr-2",w(c)&&"cursor-grabbing"))},null,2),E(w(tc))],512)]),_:1},8,["style","class","pt"])]))}}),ac={class:"p-breadcrumb-item-label px-2"},sc={key:1,class:"pi pi-angle-down text-[10px]"},ic=j({__name:"SubgraphBreadcrumbItem",props:{item:{},isActive:{type:Boolean,default:!1}},setup(e){const t=e,{t:o}=he(),s=R(),l=pt(),a=_e(),i=Qe(),r=R(!1),u=R(),d=R(),p=R(),g=n(async(h,k)=>{if(h&&h!==k){if(t.item.updateTitle?.(h),a.activeSubgraph)a.activeSubgraph.name=h;else if(a.activeWorkflow)try{await i.renameWorkflow(a.activeWorkflow,Oa.basePath+ei(h))}catch(S){console.error(S),l.showErrorDialog(S);return}const T=xn();T.restoreState(T.exportState())}},"rename"),c=t.item.key==="root",f=b(()=>[{label:o("g.rename"),icon:"pi pi-pencil",command:C},{label:o("breadcrumbsMenu.duplicate"),icon:"pi pi-copy",command:n(async()=>{await i.duplicateWorkflow(a.activeWorkflow)},"command"),visible:c&&!t.item.isBlueprint},{separator:!0,visible:c},{label:o("menuLabels.Save"),icon:"pi pi-save",command:n(async()=>{await be().execute("Comfy.SaveWorkflow")},"command"),visible:c},{label:o("menuLabels.Save As"),icon:"pi pi-save",command:n(async()=>{await be().execute("Comfy.SaveWorkflowAs")},"command"),visible:c},{separator:!0},{label:o("breadcrumbsMenu.clearWorkflow"),icon:"pi pi-trash",command:n(async()=>{await be().execute("Comfy.ClearWorkflow")},"command")},{separator:!0,visible:t.item.key==="root"&&t.item.isBlueprint},{label:o("subgraphStore.publish"),icon:"pi pi-copy",command:n(async()=>{await i.saveWorkflowAs(a.activeWorkflow)},"command"),visible:t.item.key==="root"&&t.item.isBlueprint},{separator:!0,visible:c},{label:t.item.isBlueprint?o("breadcrumbsMenu.deleteBlueprint"):o("breadcrumbsMenu.deleteWorkflow"),icon:"pi pi-times",command:n(async()=>{await i.deleteWorkflow(a.activeWorkflow)},"command"),visible:c}]),v=n(h=>{r.value||(h.detail===1?t.isActive?s.value?.toggle(h):t.item.command?.({item:t.item,originalEvent:h}):t.isActive&&h.detail===2&&(s.value?.hide(),h.stopPropagation(),h.preventDefault(),C()))},"handleClick"),C=n(()=>{r.value=!0,u.value=t.item.label,De(()=>{d.value?.$el&&(d.value.$el.focus(),d.value.$el.select(),p.value&&(d.value.$el.style.width=`${Math.max(200,p.value.offsetWidth)}px`))})},"startRename"),m=n(async h=>{h&&await g(u.value,t.item.label),r.value=!1},"inputBlur");return(h,k)=>{const T=Te("tooltip");return y(),I(ue,null,[pe((y(),I("a",{ref_key:"wrapperRef",ref:p,draggable:"false",href:"#",class:K(["p-breadcrumb-item-link h-12 cursor-pointer px-2",{"flex items-center gap-1":h.isActive,"p-breadcrumb-item-link-menu-visible":s.value?.overlayVisible,"p-breadcrumb-item-link-icon-visible":h.isActive,"active-breadcrumb-item":h.isActive}]),onClick:v},[x("span",ac,H(h.item.label),1),h.item.isBlueprint?(y(),O(w(Ut),{key:0,value:"Blueprint",severity:"primary"})):V("",!0),h.isActive?(y(),I("i",sc)):V("",!0)],2)),[[T,{value:h.item.label,showDelay:512},void 0,{bottom:!0}]]),h.isActive?(y(),O(w(rs),{key:0,ref_key:"menu",ref:s,model:f.value,popup:!0,pt:{root:{style:"background-color: var(--comfy-menu-bg)"},itemLink:{class:"py-2"}}},null,8,["model"])):V("",!0),r.value?(y(),O(w(Cl),{key:1,ref_key:"itemInputRef",ref:d,modelValue:u.value,"onUpdate:modelValue":k[0]||(k[0]=S=>u.value=S),class:"fixed z-10000 px-2 py-2 text-[.8rem]",onBlur:k[1]||(k[1]=S=>m(!1)),onClick:k[2]||(k[2]=Ee(()=>{},["stop"])),onKeydown:[k[3]||(k[3]=Rt(S=>m(!0),["enter"])),k[4]||(k[4]=Rt(S=>m(!1),["esc"]))]},null,8,["modelValue"])):V("",!0)],64)}}}),lc=we(ic,[["__scopeId","data-v-6028f498"]]),vs=n((e,t)=>{t={debounceTime:25,useMutationObserver:!0,useResizeObserver:!0,...t};const o=R(!1),s=[],l=R(!1),a=n(()=>{o.value=e.scrollWidth>e.clientWidth,t.onCheck?.(o.value)},"checkOverflowFn"),i=t.debounceTime?Mo(a,t.debounceTime):a;return t.useMutationObserver&&s.push(Vs(e,i,{subtree:!0,childList:!0}).stop),t.useResizeObserver&&s.push(Ia(e,i).stop),{isOverflowing:ko(o),disposed:ko(l),checkOverflow:i,dispose:n(()=>{l.value=!0,s.forEach(r=>r())},"dispose")}},"useOverflowObserver"),ia=28,la=8,Jo=8,ra=20,rc=j({__name:"SubgraphBreadcrumb",setup(e){const t=_e(),o=xn(),s=R(),l=b(()=>t.activeWorkflow?.filename),a=b(()=>Ba().isSubgraphBlueprint(t.activeWorkflow)),i=R(!1),r=R(!1),u=b(()=>s.value?s.value.$el?.querySelector(".p-breadcrumb-list"):null),d=b(()=>{const c=o.navigationStack.map(f=>({label:f.name,command:n(()=>{const v=ce().getCanvas();if(!v.graph)throw new TypeError("Canvas has no graph");v.setGraph(f)},"command"),updateTitle:n(v=>{const C=ce().getCanvas().graph?.rootGraph;C&&ti(C,f.id,m=>{m.title=v})},"updateTitle")}));return[p.value,...c]}),p=b(()=>({label:l.value,icon:"pi pi-home",key:"root",isBlueprint:a.value,command:n(()=>{const c=ce().getCanvas();if(!c.graph)throw new TypeError("Canvas has no graph");c.setGraph(c.graph.rootGraph)},"command")}));let g;return J(u,c=>{g?.dispose(),g=void 0,c&&(g=vs(c,{onCheck:n(f=>{if(r.value=f,i.value){if(!f){const v=[...c.querySelectorAll(".p-breadcrumb-item")];if(v.length<3)return;const C=v.filter(M=>M.querySelector(".p-breadcrumb-item-link-icon-visible")).length,m=c.querySelectorAll(".p-breadcrumb-separator"),k=m[m.length-1].offsetWidth,T=(ia+Jo+Jo)*v.length+C*ra,S=(v.length-1)*k,$=(v.length-1)*(la*2),_=T+S+$,P=c.clientWidth;_<=P&&(i.value=!1)}}else f&&(i.value=!0)},"onCheck")}))}),Sa(()=>{g?.disposed.value||g?.checkOverflow()}),(c,f)=>(y(),I("div",{class:K(["subgraph-breadcrumb w-auto drop-shadow-[var(--interface-panel-drop-shadow)]",{"subgraph-breadcrumb-collapse":i.value,"subgraph-breadcrumb-overflow":r.value}]),style:me({"--p-breadcrumb-gap":"0px","--p-breadcrumb-item-margin":`${la/2}px`,"--p-breadcrumb-item-min-width":`${ia}px`,"--p-breadcrumb-item-padding":`${Jo}px`,"--p-breadcrumb-icon-width":`${ra}px`})},[E(w(Rl),{ref_key:"breadcrumbRef",ref:s,class:"w-fit rounded-lg p-0",model:d.value,pt:{item:{class:"pointer-events-auto"}},"aria-label":c.$t("g.graphNavigation")},{item:W(({item:v})=>[E(lc,{item:v,"is-active":v===d.value.at(-1)},null,8,["item","is-active"])]),separator:W(()=>f[0]||(f[0]=[x("span",{style:{transform:"scale(1.5)"}}," / ",-1)])),_:1},8,["model","aria-label"])],6))}}),uc=we(rc,[["__scopeId","data-v-0e6867de"]]),cc=St("actionBarButton",()=>{const e=$n();return{buttons:b(()=>e.extensions.flatMap(o=>o.actionBarButtons??[]))}}),dc={class:"flex h-full shrink-0 items-center gap-1"},pc=j({__name:"ActionBarButtons",setup(e){const t=cc();return(o,s)=>{const l=Te("tooltip");return y(),I("div",dc,[(y(!0),I(ue,null,$e(w(t).buttons,(a,i)=>pe((y(),O(w(ie),{key:i,label:a.label,"aria-label":a.tooltip||a.label,class:K([a.class,"h-7"]),text:"",rounded:"",severity:"secondary",onClick:a.onClick},{icon:W(()=>[x("i",{class:K(a.icon)},null,2)]),_:2},1032,["label","aria-label","class","onClick"])),[[l,a.tooltip,void 0,{bottom:!0}]])),128))])}}}),fc={class:"current-user-popover w-72"},mc={class:"p-3"},vc={class:"flex flex-col items-center"},gc={class:"my-0 mb-1 truncate text-lg font-semibold"},hc={key:0,class:"my-0 truncate text-sm text-muted"},yc={key:0,class:"flex items-center justify-between"},bc={class:"flex flex-col gap-1"},wc=j({__name:"CurrentUserPopover",emits:["close"],setup(e,{emit:t}){const o=t,{buildDocsUrl:s}=Lt(),l="settingsCategories.Credits",{userDisplayName:a,userEmail:i,userPhotoUrl:r,handleSignOut:u}=to(),d=za(),p=pt(),{isActiveSubscription:g,fetchStatus:c}=kn(),f=n(()=>{p.showSettingsDialog("user"),o("close")},"handleOpenUserSettings"),v=n(()=>{p.showSettingsDialog("credits"),o("close")},"handleOpenPlanAndCreditsSettings"),C=n(()=>{p.showTopUpCreditsDialog(),o("close")},"handleTopUp"),m=n(()=>{window.open(s("/tutorials/api-nodes/overview#api-nodes",{includeLocale:!0}),"_blank"),o("close")},"handleOpenPartnerNodesInfo"),h=n(async()=>{await u(),o("close")},"handleLogout"),k=n(async()=>{await c()},"handleSubscribed");return Me(()=>{d.fetchBalance()}),(T,S)=>(y(),I("div",fc,[x("div",mc,[x("div",vc,[E(ds,{class:"mb-3","photo-url":w(r),"pt:icon:class":{"text-2xl!":!w(r)},size:"large"},null,8,["photo-url","pt:icon:class"]),x("h3",gc,H(w(a)||T.$t("g.user")),1),w(i)?(y(),I("p",hc,H(w(i)),1)):V("",!0)])]),w(g)?(y(),I("div",yc,[x("div",bc,[E(oi,{"text-class":"text-2xl"}),E(w(ie),{label:T.$t("subscription.partnerNodesCredits"),severity:"secondary",text:"",size:"small",class:"pl-6 p-0 h-auto justify-start",pt:{root:{class:"hover:bg-transparent active:bg-transparent"}},onClick:m},null,8,["label"])]),E(w(ie),{label:T.$t("credits.topUp.topUp"),severity:"secondary",size:"small",onClick:C},null,8,["label"])])):(y(),O(Hu,{key:1,label:T.$t("subscription.subscribeToComfyCloud"),size:"small",variant:"gradient",onSubscribed:k},null,8,["label"])),E(w(ta),{class:"my-2"}),E(w(ie),{class:"justify-start",label:T.$t("userSettings.title"),icon:"pi pi-cog",text:"",fluid:"",severity:"secondary",onClick:f},null,8,["label"]),w(g)?(y(),O(w(ie),{key:2,class:"justify-start",label:T.$t(w(l)),icon:"pi pi-receipt",text:"",fluid:"",severity:"secondary",onClick:v},null,8,["label"])):V("",!0),E(w(ta),{class:"my-2"}),E(w(ie),{class:"justify-start",label:T.$t("auth.signOut.signOut"),icon:"pi pi-sign-out",text:"",fluid:"",severity:"secondary",onClick:h},null,8,["label"])]))}}),Cc={class:"flex items-center gap-1 rounded-full hover:bg-interface-button-hover-surface"},Sc=j({__name:"CurrentUserButton",setup(e){const{isLoggedIn:t,userPhotoUrl:o}=to(),s=R(null),l=b(()=>o.value??void 0),a=n(()=>{s.value?.hide()},"closePopover");return(i,r)=>(y(),I("div",null,[w(t)?(y(),O(w(ie),{key:0,class:"user-profile-button p-1 hover:bg-transparent",severity:"secondary",text:"","aria-label":i.$t("g.currentUser"),onClick:r[0]||(r[0]=u=>s.value?.toggle(u))},{default:W(()=>[x("div",Cc,[E(ds,{"photo-url":l.value},null,8,["photo-url"]),r[1]||(r[1]=x("i",{class:"pi pi-chevron-down px-1",style:{fontSize:"0.6rem"}},null,-1))])]),_:1},8,["aria-label"])):V("",!0),E(w(ut),{ref_key:"popover",ref:s,"show-arrow":!1},{default:W(()=>[E(wc,{onClose:a})]),_:1},512)]))}}),kc={class:"mb-1"},xc=["href"],$c=j({__name:"LoginButton",setup(e){const{isLoggedIn:t,handleSignIn:o}=to(),{buildDocsUrl:s}=Lt(),l=s("/tutorials/api-nodes/overview#api-nodes",{includeLocale:!0}),a=R(null);let i=null,r=null;const u=n(g=>{i&&(clearTimeout(i),i=null),r&&(clearTimeout(r),r=null),r=setTimeout(()=>{a.value&&a.value.show(g,g.target)},200)},"showPopover"),d=n(()=>{i&&(clearTimeout(i),i=null)},"cancelHidePopover"),p=n(()=>{r&&(clearTimeout(r),r=null),i=setTimeout(()=>{a.value&&a.value.hide()},150)},"hidePopover");return(g,c)=>(y(),I(ue,null,[w(t)?V("",!0):(y(),O(w(ie),{key:0,outlined:"",rounded:"",severity:"secondary",class:"size-8 bg-secondary-background text-base-foreground hover:bg-secondary-background-hover",onClick:c[0]||(c[0]=f=>w(o)()),onMouseenter:u,onMouseleave:p},{icon:W(()=>c[1]||(c[1]=[x("i",{class:"icon-[lucide--user] size-4"},null,-1)])),_:1})),E(w(ut),{ref_key:"popoverRef",ref:a,class:"p-2",onMouseout:p,onMouseover:d},{default:W(()=>[x("div",null,[x("div",kc,H(w(ae)("auth.loginButton.tooltipHelp")),1),x("a",{href:w(l),target:"_blank",class:"text-neutral-500 hover:text-primary"},H(w(ae)("auth.loginButton.tooltipLearnMore")),9,xc)])]),_:1},512)],64))}}),_c={key:0,class:"ml-1 flex gap-x-0.5 pt-1"},Tc={class:"min-w-0 flex-1"},Nc={class:"actionbar-container pointer-events-auto flex h-12 items-center rounded-lg border border-[var(--interface-stroke)] px-2 shadow-interface"},Ic=j({__name:"TopMenuSection",setup(e){const t=Ge(),{isLoggedIn:o}=to(),s=Oe(),l=R();return Me(()=>{l.value&&(F.menu.element.style.width="fit-content",l.value.appendChild(F.menu.element))}),(a,i)=>w(t).focusMode?V("",!0):(y(),I("div",_c,[x("div",Tc,[E(uc)]),x("div",Nc,[E(pc),x("div",{ref_key:"legacyCommandsContainerRef",ref:l,class:"[&:not(:has(*>*:not(:empty)))]:hidden"},null,512),E(nc),w(o)?(y(),O(Sc,{key:0,class:"shrink-0"})):w(s)?(y(),O($c,{key:1})):V("",!0)])]))}}),Mc=we(Ic,[["__scopeId","data-v-19e99c7b"]]),gs=j({__name:"ExtensionSlot",props:{extension:{}},setup(e){const t=e,o=n((s,l)=>{s.render(l)},"mountCustomExtension");return dt(()=>{t.extension.type==="custom"&&t.extension.destroy&&t.extension.destroy()}),(s,l)=>s.extension.type==="vue"?(y(),O(Mt(s.extension.component),{key:0})):(y(),I("div",{key:1,ref:n(a=>{a&&o(t.extension,a)},"ref")},null,512))}}),Rc={class:"flex h-full flex-col"},Pc={class:"flex w-full justify-between"},Dc={class:"tabs-container"},Ac={class:"font-normal"},Lc={class:"flex items-center gap-2"},Ec={class:"h-0 grow"},Vc=j({__name:"BottomPanel",setup(e){const t=At(),o=pt(),{t:s}=he(),l=b(()=>{const d=t.activeBottomPanelTabId;return d==="shortcuts-essentials"||d==="shortcuts-view-controls"}),a=n(d=>d!=="shortcuts-essentials"&&d!=="shortcuts-view-controls","shouldCapitalizeTab"),i=n(d=>{const p=d.titleKey?s(d.titleKey):d.title||"";return a(d.id)?p.toUpperCase():p},"getTabDisplayTitle"),r=n(async()=>{o.showSettingsDialog("keybinding")},"openKeybindingSettings"),u=n(()=>{t.activePanel=null},"closeBottomPanel");return(d,p)=>(y(),I("div",Rc,[(y(),O(w(Tl),{key:d.$i18n.locale,value:w(t).activeBottomPanelTabId,"onUpdate:value":p[0]||(p[0]=g=>w(t).activeBottomPanelTabId=g),style:{"--p-tabs-tablist-background":"var(--comfy-menu-bg)"}},{default:W(()=>[E(w(Ml),{"pt:tab-list":"border-none h-full flex items-center py-2 border-b-1 border-solid",class:"bg-transparent"},{default:W(()=>[x("div",Pc,[x("div",Dc,[(y(!0),I(ue,null,$e(w(t).bottomPanelTabs,g=>(y(),O(w(Il),{key:g.id,value:g.id,class:K(["m-1 mx-2 border-none",{"tab-list-single-item":w(t).bottomPanelTabs.length===1}]),"pt:root":n(c=>({class:{"p-3 rounded-lg":!0,"pointer-events-none":w(t).bottomPanelTabs.length===1},style:{color:"var(--fg-color)",backgroundColor:!c.context.active||w(t).bottomPanelTabs.length===1?"":"var(--bg-color)"}}),"pt:root")},{default:W(()=>[x("span",Ac,H(i(g)),1)]),_:2},1032,["value","class","pt:root"]))),128))]),x("div",Lc,[l.value?(y(),O(w(ie),{key:0,label:d.$t("shortcuts.manageShortcuts"),icon:"pi pi-cog",severity:"secondary",size:"small",text:"",onClick:r},null,8,["label"])):V("",!0),E(w(ie),{class:"justify-self-end",icon:"pi pi-times",severity:"secondary",size:"small",text:"",onClick:u})])])]),_:1})]),_:1},8,["value"])),x("div",Ec,[w(t).bottomPanelVisible&&w(t).activeBottomPanelTab?(y(),O(gs,{key:0,extension:w(t).activeBottomPanelTab},null,8,["extension"])):V("",!0)])]))}}),Wc=we(Vc,[["__scopeId","data-v-d5048ae1"]]);function hs(e={}){const{useTransform:t=!1}=e,s=ce().getCanvas(),{canvasPosToClientPos:l,update:a}=ni(s.canvas,s),i=Z();J([()=>i.get("Comfy.Sidebar.Location"),()=>i.get("Comfy.Sidebar.Size"),()=>i.get("Comfy.UseNewMenu")],()=>a(),{flush:"post"});const r=R({}),u=n(p=>{const{pos:g,size:c,scale:f=s.ds.scale}=p,[v,C]=l(g),[m,h]=c;return t?{position:"fixed",transformOrigin:"0 0",transform:`scale(${f})`,left:`${v}px`,top:`${C}px`,width:`${m}px`,height:`${h}px`}:{position:"fixed",left:`${v}px`,top:`${C}px`,width:`${m*f}px`,height:`${h*f}px`}},"computeStyle");return{style:r,updatePosition:n(p=>{r.value=u(p)},"updatePosition")}}n(hs,"useAbsolutePosition");function Oc(e,t){const o=Math.max(e.x,t.x),s=Math.max(e.y,t.y),l=Math.min(e.x+e.width,t.x+t.width),a=Math.min(e.y+e.height,t.y+t.height);return o>=l||s>=a?null:[o,s,l-o,a-s]}n(Oc,"intersect");const Bc=n((e={})=>{const t=R({}),{margin:o=4}=e,s=n((a,i,r,u)=>{if(!r&&u){const{scale:d,offset:p}=u,g=Oc({x:a.left-i.left,y:a.top-i.top,width:a.width,height:a.height},{x:(u.x+p[0]-o)*d,y:(u.y+p[1]-o)*d,width:(u.width+2*o)*d,height:(u.height+2*o)*d});if(!g)return"";const c=(g[0]-a.left+i.left)/d+"px",f=(g[1]-a.top+i.top)/d+"px",v=g[2]/d+"px",C=g[3]/d+"px";return`polygon(0% 0%, 0% 100%, ${c} 100%, ${c} ${f}, calc(${c} + ${v}) ${f}, calc(${c} + ${v}) calc(${f} + ${C}), ${c} calc(${f} + ${C}), ${c} 100%, 100% 100%, 100% 0%)`}return""},"calculateClipPath");return{style:t,updateClipPath:n((a,i,r,u)=>{const d=a.getBoundingClientRect(),p=i.getBoundingClientRect(),g=s(d,p,r,u);t.value={clipPath:g||"none",willChange:"clip-path"}},"updateClipPath")}},"useDomClipping"),zc=["title"],Uc=j({__name:"DomWidget",props:{widgetState:{}},emits:["update:widgetValue"],setup(e,{emit:t}){const o=e.widgetState.widget,s=t,l=R(),a=R({}),{style:i,updatePosition:r}=hs({useTransform:!0}),{style:u,updateClipPath:d}=Bc(),p=ce(),g=Z(),c=b(()=>g.get("Comfy.DOMClippingEnabled")),f=n(()=>{const T=p.canvas;if(!T||!l.value)return;const S=Object.values(T.selected_nodes??{})[0];if(!S){d(l.value,T.canvas,!1,void 0);return}const $=S===e.widgetState.widget.node,_=S?.renderArea,P=T.ds.offset,M=T.ds.scale,L=_?{x:_[0],y:_[1],width:_[2],height:_[3],scale:M,offset:[P[0],P[1]]}:void 0;d(l.value,T.canvas,$,L)},"updateDomClipping"),{left:v,top:C}=Ma(p.getCanvas().canvas);J([()=>e.widgetState,v,C],([T,S,$])=>{r(T),c.value&&f(),a.value={...i.value,...c.value?u.value:{},zIndex:T.zIndex,pointerEvents:T.readonly||o.computedDisabled?"none":"auto",opacity:o.computedDisabled?.5:1}},{deep:!0}),J(()=>e.widgetState.visible,(T,S)=>{!T&&S&&o.options.onHide?.(o)}),xe(document,"mousedown",T=>{!Ht(o)||!e.widgetState.visible||!o.element.blur||o.element.contains(T.target)||o.element.blur()}),Me(()=>{Ht(o)&&xe(o.element,o.options.selectOn??["focus","click"],()=>{const T=p.canvas;T?.selectNode(e.widgetState.widget.node),T?.bringToFront(e.widgetState.widget.node)})});const h=o.node.constructor.nodeData?.inputs?.[o.name]?.tooltip,k=n(()=>{e.widgetState.visible&&Ht(o)&&l.value&&(l.value.contains(o.element)||l.value.appendChild(o.element))},"mountElementIfVisible");return Me(()=>{De(()=>{k()}).catch(T=>{console.error("Error mounting DOM widget element:",T)})}),J(()=>e.widgetState.visible,()=>{k()}),(T,S)=>pe((y(),I("div",{ref_key:"widgetElement",ref:l,class:"dom-widget",title:w(h),style:me(a.value)},[w(ai)(w(o))?(y(),O(Mt(w(o).component),nt({key:0,"model-value":w(o).value,widget:w(o)},w(o).props,{"onUpdate:modelValue":S[0]||(S[0]=$=>s("update:widgetValue",$))}),null,16,["model-value","widget"])):V("",!0)],12,zc)),[[Fe,T.widgetState.visible]])}}),Fc=we(Uc,[["__scopeId","data-v-781496d2"]]),Gc={class:"isolate"},Hc=j({__name:"DomWidgets",setup(e){const t=si(),o=b(()=>[...t.widgetStates.values()]),s=n(()=>{const a=l.canvas;if(!a)return;const i=a.low_quality,r=a.graph;for(const u of o.value){const d=u.widget;if(!d.isVisible()||!u.active){u.visible=!1;continue}const p=d.node,g=r?.nodes.includes(p);if(u.visible=!!g&&a.isNodeVisible(p)&&!(d.options.hideOnZoom&&i),u.visible&&p){const c=d.margin;u.pos=[p.pos[0]+c,p.pos[1]+c+d.y],u.size=[(d.width??p.width)-c*2,(d.computedHeight??50)-c*2],u.zIndex=a.graph?.nodes.indexOf(p)??-1,u.readonly=a.read_only}}},"updateWidgets"),l=ce();return Ro(()=>l.canvas,a=>a.onDrawForeground=Qt(a.onDrawForeground,s),{immediate:!0}),(a,i)=>(y(),I("div",Gc,[(y(!0),I(ue,null,$e(o.value,r=>(y(),O(Fc,{key:r.widget.id,"widget-state":r,"onUpdate:widgetValue":n(u=>r.widget.value=u,"onUpdate:widgetValue")},null,8,["widget-state","onUpdate:widgetValue"]))),128))]))}});function jc(){const e=R(!1),t=n(()=>{e.value=!0},"showModal"),o=n(()=>{e.value=!1},"hideModal"),s=n(()=>{e.value=!e.value},"toggleModal"),l=b(()=>e.value);return{isModalVisible:e,showModal:t,hideModal:o,toggleModal:s,hasActivePopup:l}}n(jc,"useZoomControls");function qc(e,t){const o=new Map,s=R(""),l=R(0),a=R({bounds:!1,nodes:!1,connections:!1,viewport:!1}),i=Le.getVersion(),r=new Map,u=Ra(()=>{t()},500),d=n(()=>{const C=e.value;if(!C||r.has(C.id))return;const m={onNodeAdded:C.onNodeAdded,onNodeRemoved:C.onNodeRemoved,onConnectionChange:C.onConnectionChange,onTrigger:C.onTrigger};r.set(C.id,m),C.onNodeAdded=function(h){m.onNodeAdded?.call(this,h),u()},C.onNodeRemoved=function(h){m.onNodeRemoved?.call(this,h),o.delete(h.id),u()},C.onConnectionChange=function(h){m.onConnectionChange?.call(this,h),u()},C.onTrigger=function(h){m.onTrigger?.call(this,h),h.type==="node:property:changed"&&(h.property==="mode"||h.property==="bgcolor"||h.property==="color")&&(o.delete(String(h.nodeId)),u())}},"setupEventListeners"),p=n(C=>{const m=C||e.value;if(!m)return;const h=r.get(m.id);if(!h){console.error("Attempted to cleanup event listeners for graph that was never set up");return}m.onNodeAdded=h.onNodeAdded,m.onNodeRemoved=h.onNodeRemoved,m.onConnectionChange=h.onConnectionChange,m.onTrigger=h.onTrigger,r.delete(m.id)},"cleanupEventListeners");return{updateFlags:a,setupEventListeners:d,cleanupEventListeners:p,checkForChanges:n(()=>{const C=e.value;if(!C)return!1;let m=!1,h=!1,k=!1;const T=Ua.create(C),S=T.getNodeCount();S!==l.value&&(m=!0,l.value=S);const $=T.getNodes();for(const M of $){const L=M.id,N=`${M.x},${M.y},${M.width},${M.height}`;o.get(L)!==N&&(h=!0,o.set(L,N))}const _=new Set($.map(M=>M.id));for(const[M]of o)_.has(M)||(o.delete(M),m=!0);const P=JSON.stringify(C.links||{});return P!==s.value&&(k=!0,s.value=P),(m||h)&&(a.value.bounds=!0,a.value.nodes=!0),k&&(a.value.connections=!0),m||h||k},"checkForChangesInternal"),init:n(()=>{d(),ve.addEventListener("graphChanged",u),J(i,()=>{u()})},"init"),destroy:n(()=>{p(),ve.removeEventListener("graphChanged",u),o.clear()},"destroy"),clearCache:n(()=>{o.clear(),s.value="",l.value=0},"clearCache")}}n(qc,"useMinimapGraph");function Kc(e,t,o,s,l,a,i){const r=R(!1),u=R({left:0,top:0,width:s,height:l}),d=n(()=>{if(!e.value)return;const m=e.value.getBoundingClientRect();u.value={left:m.left,top:m.top,width:m.width,height:m.height}},"updateContainerRect"),p=n(m=>{r.value=!0,d();const h=m.currentTarget;h instanceof HTMLElement&&h.setPointerCapture(m.pointerId),g(m)},"handlePointerDown"),g=n(m=>{if(!r.value||!i.value)return;const h=m.clientX-u.value.left,k=m.clientY-u.value.top,T=(s-t.value.width*o.value)/2,S=(l-t.value.height*o.value)/2,$=(h-T)/o.value+t.value.minX,_=(k-S)/o.value+t.value.minY;a($,_)},"handlePointerMove"),c=n(m=>{if(r.value=!1,!m)return;const h=m.currentTarget;h instanceof HTMLElement&&h.hasPointerCapture(m.pointerId)&&h.releasePointerCapture(m.pointerId)},"releasePointer");return{isDragging:r,containerRect:u,updateContainerRect:d,handlePointerDown:p,handlePointerMove:g,handlePointerUp:c,handlePointerCancel:c,handleWheel:n(m=>{m.preventDefault();const h=i.value;if(!h)return;u.value.left===0&&u.value.top===0&&e.value&&d();const k=h.ds,T=m.deltaY>0?.9:1.1,S=k.scale*T;if(S<.1||S>10)return;const P=m.clientX-u.value.left,M=m.clientY-u.value.top,L=(s-t.value.width*o.value)/2,N=(l-t.value.height*o.value)/2,B=(P-L)/o.value+t.value.minX,D=(M-N)/o.value+t.value.minY;k.scale=S,a(B,D)},"handleWheel")}}n(Kc,"useMinimapInteraction");function Yc(e,t,o,s,l,a,i,r){const u=R(!0),d=R(!0),p=n(()=>{const f=t.value;if(!e.value||!f)return;const v=e.value.getContext("2d");if(!v)return;if(!f._nodes||f._nodes.length===0){v.clearRect(0,0,i,r);return}(u.value||l.value.nodes||l.value.connections)&&(ii(e.value,f,{bounds:o.value,scale:s.value,settings:{nodeColors:a.nodeColors.value,showLinks:a.showLinks.value,showGroups:a.showGroups.value,renderBypass:a.renderBypass.value,renderError:a.renderError.value},width:i,height:r}),u.value=!1,l.value.nodes=!1,l.value.connections=!1)},"renderMinimap");return{needsFullRedraw:u,needsBoundsUpdate:d,renderMinimap:p,updateMinimap:n((f,v)=>{(d.value||l.value.bounds)&&(f(),d.value=!1,l.value.bounds=!1,u.value=!0,l.value.viewport=!0),(u.value||l.value.nodes||l.value.connections)&&p(),l.value.viewport&&(v(),l.value.viewport=!1)},"updateMinimap"),forceFullRedraw:n(()=>{u.value=!0,l.value.bounds=!0,l.value.nodes=!0,l.value.connections=!0,l.value.viewport=!0},"forceFullRedraw")}}n(Yc,"useMinimapRenderer");function Qc(){const e=Z(),t=Xe(),o=b(()=>e.get("Comfy.Minimap.NodeColors")),s=b(()=>e.get("Comfy.Minimap.ShowLinks")),l=b(()=>e.get("Comfy.Minimap.ShowGroups")),a=b(()=>e.get("Comfy.Minimap.RenderBypassState")),i=b(()=>e.get("Comfy.Minimap.RenderErrorState")),r=253,u=200,d=b(()=>t.completedActivePalette.light_theme),p=b(()=>({width:`${r}px`,height:`${u}px`,border:"1px solid var(--interface-stroke)",borderRadius:"8px"})),g=b(()=>({width:"210px",height:`${u}px`,border:"1px solid var(--interface-stroke)",borderRadius:"8px"}));return{nodeColors:o,showLinks:s,showGroups:l,renderBypass:a,renderError:i,containerStyles:p,panelStyles:g,isLightTheme:d}}n(Qc,"useMinimapSettings");function Zc(e,t,o,s){const l=R({minX:0,minY:0,maxX:0,maxY:0,width:0,height:0}),a=R(1),i=R({x:0,y:0,width:0,height:0}),r=R({width:0,height:0}),u=n(()=>{const m=e.value;if(!m)return;const h=m.canvas,k=window.devicePixelRatio||1;r.value={width:h.clientWidth||h.width/k,height:h.clientHeight||h.height/k}},"updateCanvasDimensions"),d=n(()=>{const m=Ua.create(t.value);if(!m.hasData())return{minX:0,minY:0,maxX:100,maxY:100,width:100,height:100};const h=m.getBounds();return li(h)},"calculateGraphBounds"),p=n(()=>ri(l.value,o,s),"calculateScale"),g=n(()=>{const m=e.value;if(!m)return;(r.value.width===0||r.value.height===0)&&u();const h=m.ds,k=r.value.width/h.scale,T=r.value.height/h.scale,S=-h.offset[0],$=-h.offset[1],_=(o-l.value.width*a.value)/2,P=(s-l.value.height*a.value)/2;i.value={x:(S-l.value.minX)*a.value+_,y:($-l.value.minY)*a.value+P,width:k*a.value,height:T*a.value}},"updateViewport"),c=n(()=>{l.value=d(),a.value=p()},"updateBounds"),f=n((m,h)=>{const k=e.value;if(!k)return;(r.value.width===0||r.value.height===0)&&u();const T=k.ds,S=r.value.width/T.scale,$=r.value.height/T.scale;T.offset[0]=-(m-S/2),T.offset[1]=-(h-$/2),k.setDirty(!0,!0)},"centerViewOn"),{resume:v,pause:C}=Jt(g);return{bounds:b(()=>l.value),scale:b(()=>a.value),viewportTransform:b(()=>i.value),canvasDimensions:b(()=>r.value),updateCanvasDimensions:u,updateViewport:g,updateBounds:c,centerViewOn:f,startViewportSync:v,stopViewportSync:C}}n(Zc,"useMinimapViewport");function An(){const e=ce(),t=_e(),o=Z(),s=R(),l=R(),a=R(null),i=R(!0),r=R(!1),u=250,d=200,p=b(()=>e.canvas),g=b(()=>t.activeSubgraph||p.value?.graph),c=Qc(),{nodeColors:f,showLinks:v,showGroups:C,renderBypass:m,renderError:h,containerStyles:k,panelStyles:T}=c,S=n(async(G,q)=>{await o.set(G,q),M.forceFullRedraw(),M.updateMinimap($.updateBounds,$.updateViewport)},"updateOption"),$=Zc(p,g,u,d),_=Kc(s,$.bounds,$.scale,u,d,$.centerViewOn,p),P=qc(g,()=>{M.forceFullRedraw(),M.updateMinimap($.updateBounds,$.updateViewport)}),M=Yc(l,g,$.bounds,$.scale,P.updateFlags,c,u,d),{pause:L,resume:N}=Jt(async()=>{i.value&&await P.checkForChanges()&&M.updateMinimap($.updateBounds,$.updateViewport)},{immediate:!1}),B=n(async()=>{r.value||(i.value=o.get("Comfy.Minimap.Visible"),p.value&&g.value&&(P.init(),s.value&&_.updateContainerRect(),$.updateCanvasDimensions(),window.addEventListener("resize",_.updateContainerRect),window.addEventListener("scroll",_.updateContainerRect),window.addEventListener("resize",$.updateCanvasDimensions),M.forceFullRedraw(),M.updateMinimap($.updateBounds,$.updateViewport),$.updateViewport(),i.value&&(N(),$.startViewportSync()),r.value=!0))},"init"),D=n(()=>{L(),$.stopViewportSync(),P.destroy(),window.removeEventListener("resize",_.updateContainerRect),window.removeEventListener("scroll",_.updateContainerRect),window.removeEventListener("resize",$.updateCanvasDimensions),r.value=!1},"destroy");J(p,async(G,q)=>{q&&(P.cleanupEventListeners(),L(),$.stopViewportSync(),P.destroy(),window.removeEventListener("resize",_.updateContainerRect),window.removeEventListener("scroll",_.updateContainerRect),window.removeEventListener("resize",$.updateCanvasDimensions)),G&&!r.value&&await B()},{immediate:!0,flush:"post"}),J(g,(G,q)=>{G&&G!==q&&(P.cleanupEventListeners(q||void 0),P.setupEventListeners(),M.forceFullRedraw(),M.updateMinimap($.updateBounds,$.updateViewport))}),J(i,async G=>{G?(s.value&&_.updateContainerRect(),$.updateCanvasDimensions(),M.forceFullRedraw(),await De(),await De(),M.updateMinimap($.updateBounds,$.updateViewport),$.updateViewport(),N(),$.startViewportSync()):(L(),$.stopViewportSync())});const z=n(async()=>{i.value=!i.value,await o.set("Comfy.Minimap.Visible",i.value)},"toggle"),U=n(G=>{a.value=G},"setMinimapRef"),A=b(()=>{const G=$.viewportTransform.value;return{transform:`translate(${G.x}px, ${G.y}px)`,width:`${G.width}px`,height:`${G.height}px`,border:`2px solid ${c.isLightTheme.value?"#E0E0E0":"#FFF"}`,backgroundColor:"rgba(255, 255, 255, 0.2)",willChange:"transform",backfaceVisibility:"hidden",perspective:"1000px",pointerEvents:"none"}});return{visible:b(()=>i.value),initialized:b(()=>r.value),containerRef:s,canvasRef:l,containerStyles:k,viewportStyles:A,panelStyles:T,width:u,height:d,nodeColors:f,showLinks:v,showGroups:C,renderBypass:m,renderError:h,init:B,destroy:D,toggle:z,renderMinimap:M.renderMinimap,handlePointerDown:_.handlePointerDown,handlePointerMove:_.handlePointerMove,handlePointerUp:_.handlePointerUp,handlePointerCancel:_.handlePointerCancel,handleWheel:_.handleWheel,setMinimapRef:U,updateOption:S}}n(An,"useMinimap");const Xc={class:"flex items-center gap-1 pr-0.5"},Jc={class:"rounded-lg bg-interface-panel-selected-surface p-2 group-hover:bg-interface-button-hover-surface"},ed={class:"flex flex-col gap-1"},td={class:"flex items-center gap-2"},od={class:"text-[9px] text-text-primary"},nd={class:"flex items-center gap-2"},ad={class:"text-[9px] text-text-primary"},sd=j({__name:"CanvasModeSelector",props:{buttonStyles:{}},setup(e){const t=R(),o=R(),s=be(),l=ce(),a=b(()=>l.canvas?.read_only??!1),i=b(()=>a.value?"icon-[lucide--hand]":"icon-[lucide--mouse-pointer-2]"),r=b(()=>s.formatKeySequence(s.getCommand("Comfy.Canvas.Unlock")).toUpperCase()),u=b(()=>s.formatKeySequence(s.getCommand("Comfy.Canvas.Lock")).toUpperCase()),d=n(c=>{const f=t.value?.$el||t.value;o.value?.toggle(c,f)},"toggle"),p=n(c=>{c==="select"&&a.value?s.execute("Comfy.Canvas.Unlock"):c==="hand"&&!a.value&&s.execute("Comfy.Canvas.Lock"),o.value?.hide()},"setMode"),g=b(()=>({root:{class:"absolute z-50 -translate-y-2"},content:{class:["mb-2 text-text-primary","shadow-lg border border-interface-stroke","bg-nav-background","rounded-lg","p-2 px-3","min-w-39","select-none"]}}));return(c,f)=>(y(),I(ue,null,[E(w(ie),{ref_key:"buttonRef",ref:t,severity:"secondary",class:"group h-8 rounded-none! bg-comfy-menu-bg p-0 transition-none! hover:rounded-lg! hover:bg-interface-button-hover-surface!",style:me(c.buttonStyles),onClick:d},{default:W(()=>[x("div",Xc,[x("div",Jc,[x("i",{class:K([i.value,"block h-4 w-4"])},null,2)]),f[2]||(f[2]=x("i",{class:"icon-[lucide--chevron-down] block h-4 w-4 pr-1.5"},null,-1))])]),_:1},8,["style"]),E(w(ut),{ref_key:"popover",ref:o,"auto-z-index":!0,"base-z-index":1e3,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:g.value},{default:W(()=>[x("div",ed,[x("div",{class:"flex cursor-pointer items-center justify-between px-3 py-2 text-sm hover:bg-node-component-surface-hovered",onClick:f[0]||(f[0]=v=>p("select"))},[x("div",td,[f[3]||(f[3]=x("i",{class:"icon-[lucide--mouse-pointer-2] h-4 w-4"},null,-1)),x("span",null,H(c.$t("graphCanvasMenu.select")),1)]),x("span",od,H(r.value),1)]),x("div",{class:"flex cursor-pointer items-center justify-between rounded px-3 py-2 text-sm hover:bg-node-component-surface-hovered",onClick:f[1]||(f[1]=v=>p("hand"))},[x("div",nd,[f[4]||(f[4]=x("i",{class:"icon-[lucide--hand] h-4 w-4"},null,-1)),x("span",null,H(c.$t("graphCanvasMenu.hand")),1)]),x("span",ad,H(u.value),1)])])]),_:1},8,["pt"])],64))}}),id={key:0,class:"absolute right-0 bottom-[62px] z-1300 flex w-[250px] justify-center border-0! bg-inherit!"},ld={class:"flex flex-col gap-1"},rd={class:"font-medium"},ud={class:"text-[9px] text-text-primary"},cd={class:"font-medium"},dd={class:"text-[9px] text-text-primary"},pd={class:"font-medium"},fd={class:"text-[9px] text-text-primary"},md=j({__name:"ZoomControlsModal",props:{visible:{type:Boolean}},setup(e){const t=An(),o=be(),s=ce(),{formatKeySequence:l}=be(),a=e,i=R(null),r=n(h=>{const k=h.value;isNaN(k)||k<1||k>1e3||s.setAppZoomFromPercentage(k)},"applyZoom"),u=n(h=>{o.execute(h)},"executeCommand"),d=n(h=>{if(i.value)return;const k=n(()=>o.execute(h),"cmd");k(),i.value=window.setInterval(k,100)},"startRepeat"),p=n(()=>{i.value&&(clearInterval(i.value),i.value=null)},"stopRepeat"),g=b(()=>({...t.containerStyles.value,height:void 0,width:void 0})),c=b(()=>l(o.getCommand("Comfy.Canvas.ZoomIn"))),f=b(()=>l(o.getCommand("Comfy.Canvas.ZoomOut"))),v=b(()=>l(o.getCommand("Comfy.Canvas.FitView"))),C=R(null),m=R(null);return J(()=>a.visible,async h=>{h&&(await De(),m.value?.querySelector("input")?.focus())}),(h,k)=>h.visible?(y(),I("div",id,[x("div",{class:"w-4/5 rounded-lg border border-interface-stroke bg-interface-panel-surface p-2 text-text-primary shadow-lg select-none",style:me(g.value),onClick:k[3]||(k[3]=Ee(()=>{},["stop"]))},[x("div",ld,[x("div",{class:"flex cursor-pointer items-center justify-between rounded px-3 py-2 text-sm hover:bg-node-component-surface-hovered",onMousedown:k[0]||(k[0]=T=>d("Comfy.Canvas.ZoomIn")),onMouseup:p,onMouseleave:p},[x("span",rd,H(h.$t("graphCanvasMenu.zoomIn")),1),x("span",ud,H(c.value),1)],32),x("div",{class:"flex cursor-pointer items-center justify-between rounded px-3 py-2 text-sm hover:bg-node-component-surface-hovered",onMousedown:k[1]||(k[1]=T=>d("Comfy.Canvas.ZoomOut")),onMouseup:p,onMouseleave:p},[x("span",cd,H(h.$t("graphCanvasMenu.zoomOut")),1),x("span",dd,H(f.value),1)],32),x("div",{class:"flex cursor-pointer items-center justify-between rounded px-3 py-2 text-sm hover:bg-node-component-surface-hovered",onClick:k[2]||(k[2]=T=>u("Comfy.Canvas.FitView"))},[x("span",pd,H(h.$t("zoomControls.zoomToFit")),1),x("span",fd,H(v.value),1)]),x("div",{ref_key:"zoomInputContainer",ref:m,class:"zoomInputContainer flex items-center gap-1 rounded bg-input-surface p-2"},[E(w(_l),{ref_key:"zoomInput",ref:C,"default-value":w(s).appScalePercentage,min:1,max:1e3,"show-buttons":!1,"use-grouping":!1,unstyled:!0,"input-class":"bg-transparent border-none outline-hidden text-sm shadow-none my-0 w-full",fluid:"",onInput:r,onKeyup:Rt(r,["enter"])},null,8,["default-value"]),k[4]||(k[4]=x("span",{class:"flex-shrink-0 text-sm text-text-primary"},"%",-1))],512)])],4)])):V("",!0)}}),vd={class:"inline-flex items-center gap-1 px-2 text-xs"},gd=j({__name:"GraphCanvasMenu",setup(e){const{t}=he(),o=be(),{formatKeySequence:s}=be(),l=ce(),a=Z(),i=wt(),r=An(),{isModalVisible:u,toggleModal:d,hideModal:p,hasActivePopup:g}=jc(),c=b(()=>{const L=["borderRadius"],N=["borderRadius"],B={border:"none"},D=r.containerStyles.value,z={...Object.fromEntries(Object.entries(D).filter(([A])=>N.includes(A))),...B},U=Object.entries(D).filter(([A])=>L.includes(A)).reduce((A,[G,q])=>({...A,[G]:q}),{});return{buttonStyles:z,buttonGroupStyles:U}}),f=b(()=>a.get("Comfy.LinkRenderMode")===le.HIDDEN_LINK),v=b(()=>s(o.getCommand("Comfy.Canvas.FitView")).toUpperCase()),C=b(()=>s(o.getCommand("Comfy.Canvas.ToggleMinimap")).toUpperCase()),m=b(()=>["bg-comfy-menu-bg",u.value?"not-active:bg-interface-panel-selected-surface!":"","hover:bg-interface-button-hover-surface!","p-0","h-8","w-15"]),h=b(()=>({"bg-comfy-menu-bg":!0,"hover:bg-interface-button-hover-surface!":!0,"not-active:bg-interface-panel-selected-surface!":a.get("Comfy.Minimap.Visible"),"p-0":!0,"w-8":!0,"h-8":!0})),k=b(()=>{const L=t("graphCanvasMenu.fitView"),N=v.value;return N?`${L} (${N})`:L}),T=b(()=>{const L=a.get("Comfy.Minimap.Visible")?t("zoomControls.hideMinimap"):t("zoomControls.showMinimap"),N=C.value;return N?`${L} (${N})`:L}),S=b(()=>f.value?t("graphCanvasMenu.showLinks"):t("graphCanvasMenu.hideLinks")),$=b(()=>f.value?t("graphCanvasMenu.showLinks"):t("graphCanvasMenu.hideLinks")),_=b(()=>["bg-comfy-menu-bg",f.value?"not-active:bg-interface-panel-selected-surface!":"","hover:bg-interface-button-hover-surface!","p-0","w-8","h-8"]);Me(()=>{l.initScaleSync()});const P=n(()=>{o.execute("Comfy.Canvas.ToggleMinimap")},"onMinimapToggleClick"),M=n(()=>{o.execute("Comfy.Canvas.ToggleLinkVisibility")},"onLinkVisibilityToggleClick");return dt(()=>{l.cleanupScaleSync()}),(L,N)=>{const B=Te("tooltip");return y(),I("div",null,[E(md,{visible:w(u),onClose:w(p)},null,8,["visible","onClose"]),w(g)?(y(),I("div",{key:0,class:"fixed inset-0 z-1200",onClick:N[0]||(N[0]=(...D)=>w(p)&&w(p)(...D))})):V("",!0),E(w(Pl),{class:"absolute right-0 bottom-0 z-[1200] flex-row gap-1 border-[1px] border-interface-stroke bg-comfy-menu-bg p-2",style:me({...c.value.buttonGroupStyles}),onWheel:w(i).handleWheel},{default:W(()=>[E(sd,{"button-styles":c.value.buttonStyles},null,8,["button-styles"]),N[6]||(N[6]=x("div",{class:"h-[27px] w-[1px] self-center bg-node-divider"},null,-1)),pe((y(),O(w(ie),{severity:"secondary",icon:"pi pi-expand","aria-label":k.value,style:me(c.value.buttonStyles),class:"h-8 w-8 bg-comfy-menu-bg p-0 hover:bg-interface-button-hover-surface!",onClick:N[1]||(N[1]=()=>w(o).execute("Comfy.Canvas.FitView"))},{icon:W(()=>N[2]||(N[2]=[x("i",{class:"icon-[lucide--focus] h-4 w-4"},null,-1)])),_:1},8,["aria-label","style"])),[[B,k.value,void 0,{top:!0}]]),pe((y(),O(w(ie),{ref:"zoomButton",severity:"secondary",label:w(t)("zoomControls.label"),class:K(m.value),"aria-label":w(t)("zoomControls.label"),"data-testid":"zoom-controls-button",style:me(c.value.buttonStyles),onClick:w(d)},{default:W(()=>[x("span",vd,[x("span",null,H(w(l).appScalePercentage)+"%",1),N[3]||(N[3]=x("i",{class:"icon-[lucide--chevron-down] h-4 w-4"},null,-1))])]),_:1},8,["label","class","aria-label","style","onClick"])),[[B,w(t)("zoomControls.label"),void 0,{top:!0}]]),N[7]||(N[7]=x("div",{class:"h-[27px] w-[1px] self-center bg-node-divider"},null,-1)),pe((y(),O(w(ie),{ref:"minimapButton",severity:"secondary","aria-label":T.value,"data-testid":"toggle-minimap-button",style:me(c.value.buttonStyles),class:K(h.value),onClick:P},{icon:W(()=>N[4]||(N[4]=[x("i",{class:"icon-[lucide--map] h-4 w-4"},null,-1)])),_:1},8,["aria-label","style","class"])),[[B,T.value,void 0,{top:!0}]]),pe((y(),O(w(ie),{severity:"secondary",class:K(_.value),"aria-label":$.value,"data-testid":"toggle-link-visibility-button",style:me(c.value.buttonStyles),onClick:M},{icon:W(()=>N[5]||(N[5]=[x("i",{class:"icon-[lucide--route-off] h-4 w-4"},null,-1)])),_:1},8,["class","aria-label","style"])),[[B,{value:S.value,pt:{root:{style:"z-index: 2; transform: translateY(-20px);"}}},void 0,{top:!0}]])]),_:1},8,["style","onWheel"])])}}}),hd=j({__name:"NodeTooltip",setup(e){let t;const o=st(),s=Z(),l=R(),a=R(""),i=R(),r=R();function u(){return a.value=""}n(u,"hideTooltip");async function d(c){if(!c)return;i.value=F.canvas.mouse[0]+"px",r.value=F.canvas.mouse[1]+"px",a.value=c,await De();const f=l.value?.getBoundingClientRect();f&&(f.right>window.innerWidth&&(i.value=F.canvas.mouse[0]-f.width+"px"),f.top<0&&(r.value=F.canvas.mouse[1]+f.height+"px"))}n(d,"showTooltip");function p(){const{canvas:c}=F,f=c?.node_over;if(!f)return;const v=f.constructor,C=o.nodeDefsByName[f.type??""];if(v.title_mode!==le.NO_TITLE&&c.graph_mouse[1]<f.pos[1])return d(C?.description);if(f.flags?.collapsed)return;const m=ui(f,c.graph_mouse[0],c.graph_mouse[1],[0,0]);if(m!==-1){const T=f.inputs[m].name,S=ke(`nodeDefs.${Ae(f.type??"")}.inputs.${Ae(T)}.tooltip`,C?.inputs[T]?.tooltip??"");return d(S)}const h=ci(f,c.graph_mouse[0],c.graph_mouse[1],[0,0]);if(h!==-1){const T=ke(`nodeDefs.${Ae(f.type??"")}.outputs.${h}.tooltip`,C?.outputs[h]?.tooltip??"");return d(T)}const k=F.canvas.getWidgetAtCursor();if(k&&!Ht(k)){const T=ke(`nodeDefs.${Ae(f.type??"")}.inputs.${Ae(k.name)}.tooltip`,C?.inputs[k.name]?.tooltip??"");return d(k.tooltip??T)}}return n(p,"onIdle"),xe(window,"mousemove",n(c=>{u(),clearTimeout(t),c.target.nodeName==="CANVAS"&&(t=window.setTimeout(p,s.get("LiteGraph.Node.TooltipDelay")))},"onMouseMove")),xe(window,"click",u),(c,f)=>a.value?(y(),I("div",{key:0,ref_key:"tooltipRef",ref:l,class:"node-tooltip",style:me({left:i.value,top:r.value})},H(a.value),5)):V("",!0)}}),yd=we(hd,[["__scopeId","data-v-6c42a423"]]),bd=j({__name:"BypassButton",setup(e){const t=be(),o=n(async()=>{await t.execute("Comfy.Canvas.ToggleSelectedNodes.Bypass")},"toggleBypass");return(s,l)=>{const a=Te("tooltip");return pe((y(),O(w(ie),{severity:"secondary",text:"","data-testid":"bypass-button",class:"hover:bg-secondary-background",onClick:o},{icon:W(()=>l[0]||(l[0]=[x("i",{class:"icon-[lucide--redo-dot] h-4 w-4"},null,-1)])),_:1})),[[a,{value:s.$t("commands.Comfy_Canvas_ToggleSelectedNodes_Bypass.label"),showDelay:1e3},void 0,{top:!0}]])}}}),wd={class:"relative"},Cd={class:"flex items-center gap-1 px-0"},Sd={key:0,class:"color-picker-container absolute -top-10 left-1/2"},kd=["data-testid"],xd=j({__name:"ColorPickerButton",setup(e){const{t}=he(),o=ce(),s=Xe(),l=_e(),a=b(()=>s.completedActivePalette.light_theme),i=n(m=>jt(m,{lightness:.5}),"toLightThemeColor"),r=R(!1),u={name:"noColor",localizedName:t("color.noColor"),value:{dark:le.NODE_DEFAULT_BGCOLOR,light:i(le.NODE_DEFAULT_BGCOLOR)}},d=[u,...Object.entries(Ue.node_colors).map(([m,h])=>({name:m,localizedName:t(`color.${m}`),value:{dark:h.bgcolor,light:i(h.bgcolor)}}))],p=R(null),g=n(m=>{const h=m?.name??u.name,k=h===u.name?null:Ue.node_colors[h];for(const T of o.selectedItems)mo(T)&&T.setColorOption(k);o.canvas?.setDirty(!0,!0),c.value=k,r.value=!1,l.activeWorkflow?.changeTracker.checkState()},"applyColor"),c=R(null),f=b(()=>c.value?a.value?i(c.value?.bgcolor):c.value?.bgcolor:null),v=b(()=>c.value?.bgcolor?d.find(h=>h.value.dark===c.value?.bgcolor||h.value.light===c.value?.bgcolor)?.localizedName??u.localizedName:null),C=n(m=>{r.value=!1,p.value=null,c.value=di(m)},"updateColorSelectionFromNode");return J(()=>o.selectedItems,m=>{C(m)},{immediate:!0}),(m,h)=>{const k=Te("tooltip");return y(),I("div",wd,[pe((y(),O(w(ie),{"data-testid":"color-picker-button",severity:"secondary",text:"",onClick:h[0]||(h[0]=()=>r.value=!r.value)},{default:W(()=>[x("div",Cd,[x("i",{class:"pi pi-circle-fill h-4 w-4",style:me({color:f.value??""})},null,4),h[1]||(h[1]=x("i",{class:"pi pi-chevron-down h-4 w-4 py-1",style:{fontSize:"0.5rem"}},null,-1))])]),_:1})),[[k,{value:v.value??w(t)("color.noColor"),showDelay:1e3},void 0,{top:!0}]]),r.value?(y(),I("div",Sd,[E(w(is),{"model-value":p.value,options:d,"option-label":"name","data-key":"value","onUpdate:modelValue":g},{option:W(({option:T})=>[pe(x("i",{class:"pi pi-circle-fill",style:me({color:a.value?T.value.light:T.value.dark}),"data-testid":T.name},null,12,kd),[[k,T.localizedName,void 0,{top:!0}]])]),_:1},8,["model-value"])])):V("",!0)])}}}),$d=we(xd,[["__scopeId","data-v-ae10caa8"]]),_d=j({__name:"ConfigureSubgraph",setup(e){return(t,o)=>{const s=Te("tooltip");return pe((y(),O(w(ie),{severity:"secondary",text:"",icon:"icon-[lucide--settings-2]",onClick:w(Fa)},null,8,["onClick"])),[[s,{value:t.$t("commands.Comfy_Graph_EditSubgraphWidgets.label"),showDelay:1e3},void 0,{top:!0}]])}}});function ft(){const e=ce(),t=st(),o=$o(),s=pi(),{id:l}=fi(),{selectedItems:a}=ct(e),i=b(()=>a.value.filter(_=>ot(_))),r=b(()=>i.value.length!==1?null:t.fromLGraphNode(i.value[0])),u=b(()=>a.value.length>0),d=b(()=>a.value.length===1),p=b(()=>a.value.length>1),g=b(()=>d.value&&ot(a.value[0])),c=b(()=>g.value&&a.value[0]?.isSubgraphNode?.()),f=b(()=>g.value&&Ga(a.value[0])),v=b(()=>a.value.some(_=>_ instanceof gt)),C=b(()=>{const _=Z().get("Comfy.Load3D.3DViewerEnable");return i.value.length===1&&i.value.some(mi)&&_}),m=b(()=>f.value),h=b(()=>In(i.value).length>0),k=n(_=>_.length?{collapsed:_.some(P=>P.flags?.collapsed),pinned:_.some(P=>P.pinned),bypassed:_.some(P=>P.mode===Ie.BYPASS)}:{collapsed:!1,pinned:!1,bypassed:!1},"computeSelectionStatesFromNodes"),T=b(()=>k(i.value));return{selectedItems:a,selectedNodes:i,nodeDef:r,showNodeHelp:n(()=>{const _=r.value;if(!_)return;const P=o.activeSidebarTabId===l,M=s.currentHelpNode;if(P&&s.isHelpOpen&&M&&M.nodePath===_.nodePath){s.closeHelp(),o.toggleSidebarTab(l);return}P||o.toggleSidebarTab(l),s.openHelp(_)},"showNodeHelp"),hasAny3DNodeSelected:C,hasAnySelection:u,hasSingleSelection:d,hasMultipleSelection:p,isSingleNode:g,isSingleSubgraph:c,isSingleImageNode:f,hasSubgraphs:v,hasImageNode:m,hasOutputNodesSelected:h,selectedNodesStates:T,computeSelectionFlags:n(()=>k(i.value),"computeSelectionFlags")}}n(ft,"useSelectionState");const Td=j({__name:"ConvertToSubgraphButton",setup(e){const t=be(),{isSingleSubgraph:o,hasAnySelection:s}=ft(),l=o,a=b(()=>s.value&&!o.value);return(i,r)=>{const u=Te("tooltip");return w(l)?pe((y(),O(w(ie),{key:0,severity:"secondary","data-testid":"convert-to-subgraph-button",text:"",onClick:r[0]||(r[0]=()=>w(t).execute("Comfy.Graph.UnpackSubgraph"))},{icon:W(()=>r[2]||(r[2]=[x("i",{class:"icon-[lucide--expand] h-4 w-4"},null,-1)])),_:1})),[[u,{value:i.$t("commands.Comfy_Graph_UnpackSubgraph.label"),showDelay:1e3},void 0,{top:!0}]]):a.value?pe((y(),O(w(ie),{key:1,severity:"secondary","data-testid":"convert-to-subgraph-button",text:"",onClick:r[1]||(r[1]=()=>w(t).execute("Comfy.Graph.ConvertToSubgraph"))},{icon:W(()=>r[3]||(r[3]=[x("i",{class:"icon-[lucide--shrink]"},null,-1)])),_:1})),[[u,{value:i.$t("commands.Comfy_Graph_ConvertToSubgraph.label"),showDelay:1e3},void 0,{top:!0}]]):V("",!0)}}}),Nd=j({__name:"DeleteButton",setup(e){const t=be(),{selectedItems:o}=ft(),s=b(()=>o.value.some(l=>l.removable!==!1));return(l,a)=>{const i=Te("tooltip");return pe((y(),O(w(ie),{severity:"secondary",text:"","icon-class":"w-4 h-4",icon:"pi pi-trash","data-testid":"delete-button",onClick:a[0]||(a[0]=()=>w(t).execute("Comfy.Canvas.DeleteSelectedItems"))},null,512)),[[Fe,s.value],[i,{value:l.$t("commands.Comfy_Canvas_DeleteSelectedItems.label"),showDelay:1e3},void 0,{top:!0}]])}}}),Id=j({__name:"ExecuteButton",setup(e){const{t}=he(),o=be(),s=ce(),{selectedNodes:l}=ft(),a=s.getCanvas(),i=R(!1),r=b(()=>l.value.filter(ot).filter(Dl));function u(){if(this.selected&&this.constructor.nodeData?.output_node&&i.value)return{color:"orange",lineWidth:2,padding:10}}n(u,"outputNodeStokeStyle");const d=n(()=>{i.value=!0;for(const c of r.value)c.strokeStyles.outputNode=u;a.setDirty(!0)},"handleMouseEnter"),p=n(()=>{i.value=!1,a.setDirty(!0)},"handleMouseLeave"),g=n(async()=>{await o.execute("Comfy.QueueSelectedOutputNodes")},"handleClick");return(c,f)=>{const v=Te("tooltip");return pe((y(),O(w(ie),{class:"size-8 bg-primary-background text-white p-0",text:"",onMouseenter:f[0]||(f[0]=()=>d()),onMouseleave:f[1]||(f[1]=()=>p()),onClick:g},{default:W(()=>f[2]||(f[2]=[x("i",{class:"icon-[lucide--play] size-4"},null,-1)])),_:1})),[[v,{value:w(t)("selectionToolbox.executeButton.tooltip"),showDelay:1e3},void 0,{top:!0}]])}}}),Md=j({__name:"ExtensionCommandButton",props:{command:{}},setup(e){const t=be();return(o,s)=>{const l=Te("tooltip");return pe((y(),O(w(ie),{severity:"secondary",text:"","icon-class":"w-4 h-4",icon:typeof o.command.icon=="function"?o.command.icon():o.command.icon,onClick:s[0]||(s[0]=()=>w(t).execute(o.command.id))},null,8,["icon"])),[[l,{value:w(ke)(`commands.${w(Ae)(o.command.id)}.label`,"")||void 0,showDelay:1e3},void 0,{top:!0}]])}}}),Rd=j({__name:"InfoButton",setup(e){const{showNodeHelp:t}=ft(),o=n(()=>{t()},"onInfoClick");return(s,l)=>{const a=Te("tooltip");return pe((y(),O(w(ie),{"data-testid":"info-button",text:"",severity:"secondary",onClick:o},{default:W(()=>l[0]||(l[0]=[x("i",{class:"icon-[lucide--info] h-4 w-4"},null,-1)])),_:1})),[[a,{value:s.$t("g.info"),showDelay:1e3},void 0,{top:!0}]])}}}),Pd=j({__name:"Load3DViewerButton",setup(e){const t=be(),o=n(()=>{t.execute("Comfy.3DViewer.Open3DViewer")},"open3DViewer");return(s,l)=>{const a=Te("tooltip");return pe((y(),O(w(ie),{severity:"secondary",text:"",icon:"pi pi-pencil","icon-class":"w-4 h-4",onClick:o},null,512)),[[a,{value:s.$t("commands.Comfy_3DViewer_Open3DViewer.label"),showDelay:1e3},void 0,{top:!0}]])}}}),Dd=j({__name:"MaskEditorButton",setup(e){const t=be(),{isSingleImageNode:o}=ft(),s=n(()=>{t.execute("Comfy.MaskEditor.OpenMaskEditor")},"openMaskEditor");return(l,a)=>{const i=Va,r=Te("tooltip");return pe((y(),O(w(ie),{severity:"secondary",text:"",onClick:s},{default:W(()=>[E(i,{class:"!h-4 !w-4"})]),_:1})),[[Fe,w(o)],[r,{value:l.$t("commands.Comfy_MaskEditor_OpenMaskEditor.label"),showDelay:1e3},void 0,{top:!0}]])}}}),Ad=n(e=>e!=null&&typeof e=="object"&&"refresh"in e&&typeof e.refresh=="function","isRefreshableWidget"),Ld=n(()=>{const e=ce(),t=R([]);ge(()=>{t.value=e.selectedItems.filter(ot)});const o=b(()=>t.value.flatMap(a=>{if(!a.widgets)return[];const i=[];for(const r of a.widgets)Ad(r)&&i.push(r);return i})),s=b(()=>o.value.length>0);async function l(){s.value&&await Promise.all(o.value.map(a=>a.refresh()))}return n(l,"refreshSelected"),{isRefreshable:s,refreshSelected:l}},"useRefreshableSelection"),Ed=j({__name:"RefreshSelectionButton",setup(e){const{t}=he(),{isRefreshable:o,refreshSelected:s}=Ld();return(l,a)=>{const i=Te("tooltip");return pe((y(),O(w(ie),{severity:"secondary",text:"","data-testid":"refresh-button",onClick:w(s)},{default:W(()=>a[0]||(a[0]=[x("i",{class:"icon-[lucide--refresh-cw] h-4 w-4"},null,-1)])),_:1},8,["onClick"])),[[Fe,w(o)],[i,w(t)("g.refreshNode"),void 0,{top:!0}]])}}}),Vd=j({__name:"SaveToSubgraphLibrary",setup(e){const t=be(),o=ce(),s=b(()=>o.selectedItems?.length===1&&o.selectedItems[0]instanceof gt);return(l,a)=>{const i=Te("tooltip");return pe((y(),O(w(ie),{severity:"secondary",text:"",onClick:a[0]||(a[0]=()=>w(t).execute("Comfy.PublishSubgraph"))},{icon:W(()=>a[1]||(a[1]=[x("i",{class:"icon-[lucide--book-open]"},null,-1)])),_:1})),[[Fe,s.value],[i,{value:l.$t("commands.Comfy_PublishSubgraph.label"),showDelay:1e3},void 0,{top:!0}]])}}}),lt=R(!1),ys=R(0),bs=R(0),Pe=R(!1);let vt=!1,ze=null;function wo(e){const t=e.canvas;if(!t)return null;const o=Array.from(t.selectedItems);if(o.length!==1)return null;const s=o[0];return ot(s)?`N:${s.id}`:Ha(s)?`G:${s.id}`:null}n(wo,"buildSelectionSignature");function Wd(e){return ze?wo(e)===ze:!1}n(Wd,"currentSelectionMatchesSignature");function Od(e){const t=ce(),o=t.getCanvas(),{getSelectableItems:s}=Ao(),{shouldRenderVueNodes:l}=_o(),a=R({x:0,y:0}),i=R(!1),{left:r,top:u}=Ma(o.canvas),d=n(()=>{const h=s();if(!h.size){i.value=!1;return}i.value=!0;const k=[];for(const S of h)if(S.id!=null)if(l.value&&typeof S.id=="string"){const $=Le.getNodeLayoutRef(S.id).value;$&&k.push([$.bounds.x,$.bounds.y,$.bounds.width,$.bounds.height])}else(S instanceof Ze||S instanceof ht)&&k.push([S.pos[0],S.pos[1]-le.NODE_TITLE_HEIGHT,S.size[0],S.size[1]+le.NODE_TITLE_HEIGHT]);const T=Al(k);T&&(a.value={x:T.x+T.width/2,y:T.y-10},p())},"updateSelectionBounds"),p=n(()=>{if(!i.value)return;const{scale:h,offset:k}=o.ds,T=(a.value.x+k[0])*h+r.value,S=(a.value.y+k[1])*h+u.value;e.value&&(e.value.style.setProperty("--tb-x",`${T}px`),e.value.style.setProperty("--tb-y",`${S}px`))},"updateTransform"),{resume:g,pause:c}=Jt(p);J(()=>t.getCanvas().state.selectionChanged,h=>{h&&((Pe.value||ze)&&(Pe.value=!1,vt=!1,lt.value?ze=wo(t):ze=null),d(),t.getCanvas().state.selectionChanged=!1,i.value?g():c())},{immediate:!0}),J(()=>lt.value,h=>{h?ze=wo(t):t.canvas?.state?.draggingItems||(ze=null,Pe.value&&(Pe.value=!1))});const f=n(h=>{if(h){v();return}C()},"handleDragStateChange"),v=n(()=>{if(i.value=!1,!lt.value){Pe.value=!1,vt=!1;return}if(wo(t)!==ze&&(ze=null),lt.value=!1,vt=!0,Pe.value=!!ze,Pe.value){ys.value++;return}vt=!1},"handleDragStart"),C=n(()=>{requestAnimationFrame(()=>{d();const h=Wd(t),k=vt&&i.value&&Pe.value&&h;Pe.value=k&&Pe.value,vt=!1,k&&bs.value++})},"handleDragEnd"),m=b(()=>{const h=t.canvas?.state?.draggingItems??!1,k=l.value&&Le.isDraggingVueNodes.value;return h||k});return J(m,f),at(()=>{Bd()}),{visible:i}}n(Od,"useSelectionToolboxPosition");function Bd(){lt.value=!1,Pe.value=!1,vt=!1,ze=null}n(Bd,"resetMoreOptionsState");function ws(){const e=Z(),t=Lo(),{hasMultipleSelection:o}=ft(),s=b(()=>o.value);return{frameNodes:n(()=>{const{canvas:a}=F;if(!a.selectedItems?.size)return;const i=new ht,r=e.get("Comfy.GroupSelectedNodes.Padding");i.resizeTo(a.selectedItems,r),a.graph?.add(i),t.titleEditorTarget=i},"frameNodes"),canFrame:s}}n(ws,"useFrameNodes");const zd=j({__name:"FrameNodes",setup(e){const{frameNodes:t}=ws();return(o,s)=>{const l=Te("tooltip");return pe((y(),O(w(ie),{class:"frame-nodes-button",text:"",severity:"secondary",onClick:w(t)},{default:W(()=>s[0]||(s[0]=[x("i",{class:"icon-[lucide--frame] h-4 w-4"},null,-1)])),_:1},8,["onClick"])),[[l,{value:o.$t("g.frameNodes"),showDelay:1e3},void 0,{top:!0}]])}}});function Ln(){const e=ce(),t=_e();return{refreshCanvas:n(()=>{e.canvas?.emitBeforeChange(),e.canvas?.setDirty(!0,!0),e.canvas?.graph?.afterChange(),e.canvas?.emitAfterChange(),t.activeWorkflow?.changeTracker?.checkState()},"refreshCanvas")}}n(Ln,"useCanvasRefresh");function En(){const{t:e}=he(),t=ce(),o=Xe(),s=Ln(),l=b(()=>o.completedActivePalette.light_theme),a=n(f=>jt(f,{lightness:.5}),"toLightThemeColor"),i={name:"noColor",localizedName:e("color.noColor"),value:{dark:le.NODE_DEFAULT_BGCOLOR,light:a(le.NODE_DEFAULT_BGCOLOR)}},r=[i,...Object.entries(Ue.node_colors).map(([f,v])=>({name:f,localizedName:e(`color.${f}`),value:{dark:v.bgcolor,light:a(v.bgcolor)}}))],u=[{name:"default",localizedName:e("shape.default"),value:ao.ROUND},{name:"box",localizedName:e("shape.box"),value:ao.BOX},{name:"card",localizedName:e("shape.CARD"),value:ao.CARD}];return{colorOptions:r,shapeOptions:u,applyColor:n(f=>{const v=f?.name??i.name,C=v===i.name?null:Ue.node_colors[v];for(const m of t.selectedItems)mo(m)&&m.setColorOption(C);s.refreshCanvas()},"applyColor"),applyShape:n(f=>{const v=Array.from(t.selectedItems).filter(C=>C instanceof Ze);v.length!==0&&(v.forEach(C=>{C.shape=f.value}),s.refreshCanvas())},"applyShape"),getCurrentColor:n(()=>{const f=Array.from(t.selectedItems);if(f.length===0)return null;const v=f.find(h=>mo(h));if(!v||!mo(v))return null;const m=v.getColorOption()?.bgcolor??null;return r.find(h=>h.value.dark===m||h.value.light===m)??i},"getCurrentColor"),getCurrentShape:n(()=>{const f=Array.from(t.selectedItems).filter(m=>m instanceof Ze);if(f.length===0)return null;const C=f[0].shape??ao.ROUND;return u.find(m=>m.value===C)??u[0]},"getCurrentShape"),isLightTheme:l}}n(En,"useNodeCustomization");function Ud(){const{t:e}=he(),t=ce(),o=_e(),s=Z(),l=Ln(),{shapeOptions:a,colorOptions:i,isLightTheme:r}=En();return{getFitGroupToNodesOption:n(c=>({label:"Fit Group To Nodes",icon:"icon-[lucide--move-diagonal-2]",action:n(()=>{try{c.recomputeInsideNodes()}catch(v){console.warn("Failed to recompute group nodes:",v);return}const f=s.get("Comfy.GroupSelectedNodes.Padding");c.resizeTo(c.children,f),c.graph?.change(),t.canvas?.setDirty(!0,!0),o.activeWorkflow?.changeTracker?.checkState()},"action")}),"getFitGroupToNodesOption"),getGroupShapeOptions:n((c,f)=>({label:e("contextMenu.Shape"),icon:"icon-[lucide--box]",hasSubmenu:!0,submenu:a.map(v=>({label:v.localizedName,action:n(()=>{(c.nodes||[]).forEach(m=>m.shape=v.value),l.refreshCanvas(),f()},"action")}))}),"getGroupShapeOptions"),getGroupColorOptions:n((c,f)=>({label:e("contextMenu.Color"),icon:"icon-[lucide--palette]",hasSubmenu:!0,submenu:i.map(v=>({label:v.localizedName,color:r.value?v.value.light:v.value.dark,action:n(()=>{c.color=r.value?v.value.light:v.value.dark,l.refreshCanvas(),f()},"action")}))}),"getGroupColorOptions"),getGroupModeOptions:n((c,f)=>{const v=[];try{c.recomputeInsideNodes()}catch(k){return console.warn("Failed to recompute group nodes for mode options:",k),v}const C=c.nodes||[];if(!C.length)return v;let m=!0;for(let k=1;k<C.length;k++)if(C[k].mode!==C[0].mode){m=!1;break}const h=n((k,T)=>({label:e(`selectionToolbox.${k}`),icon:T===Ie.BYPASS?"icon-[lucide--ban]":T===Ie.NEVER?"icon-[lucide--zap-off]":"icon-[lucide--play]",action:n(()=>{C.forEach(S=>{S.mode=T}),t.canvas?.setDirty(!0,!0),c.graph?.change(),o.activeWorkflow?.changeTracker?.checkState(),f()},"action")}),"createModeAction");if(m)switch(C[0].mode){case Ie.ALWAYS:v.push(h("Set Group Nodes to Never",Ie.NEVER)),v.push(h("Bypass Group Nodes",Ie.BYPASS));break;case Ie.NEVER:v.push(h("Set Group Nodes to Always",Ie.ALWAYS)),v.push(h("Bypass Group Nodes",Ie.BYPASS));break;case Ie.BYPASS:v.push(h("Set Group Nodes to Always",Ie.ALWAYS)),v.push(h("Set Group Nodes to Never",Ie.NEVER));break;default:v.push(h("Set Group Nodes to Always",Ie.ALWAYS)),v.push(h("Set Group Nodes to Never",Ie.NEVER)),v.push(h("Bypass Group Nodes",Ie.BYPASS));break}else v.push(h("Set Group Nodes to Always",Ie.ALWAYS)),v.push(h("Set Group Nodes to Never",Ie.NEVER)),v.push(h("Bypass Group Nodes",Ie.BYPASS));return v},"getGroupModeOptions")}}n(Ud,"useGroupMenuOptions");function Fd(){const{t:e}=he(),t=n(()=>{be().execute("Comfy.MaskEditor.OpenMaskEditor")},"openMaskEditor"),o=n(i=>{if(!i?.imgs?.length)return;const r=i.imgs[i.imageIndex??0];if(!r)return;const u=new URL(r.src);u.searchParams.delete("preview"),window.open(u.toString(),"_blank")},"openImage"),s=n(async i=>{if(!i?.imgs?.length)return;const r=i.imgs[i.imageIndex??0];if(!r)return;const u=document.createElement("canvas"),d=u.getContext("2d");if(d){u.width=r.naturalWidth,u.height=r.naturalHeight,d.drawImage(r,0,0);try{const p=await new Promise(g=>{u.toBlob(g,"image/png")});if(!p){console.warn("Failed to create image blob");return}if(!navigator.clipboard?.write){console.warn("Clipboard API not available");return}await navigator.clipboard.write([new ClipboardItem({"image/png":p})])}catch(p){console.error("Failed to copy image to clipboard:",p)}}},"copyImage"),l=n(i=>{if(!i?.imgs?.length)return;const r=i.imgs[i.imageIndex??0];if(r)try{const u=new URL(r.src);u.searchParams.delete("preview"),Cn(u.toString())}catch(u){console.error("Failed to save image:",u)}},"saveImage");return{getImageMenuOptions:n(i=>i?.imgs?.length?[{label:e("contextMenu.Open in Mask Editor"),action:n(()=>t(),"action")},{label:e("contextMenu.Open Image"),icon:"icon-[lucide--external-link]",action:n(()=>o(i),"action")},{label:e("contextMenu.Copy Image"),icon:"icon-[lucide--copy]",action:n(()=>s(i),"action")},{label:e("contextMenu.Save Image"),icon:"icon-[lucide--download]",action:n(()=>l(i),"action")}]:[],"getImageMenuOptions")}}n(Fd,"useImageMenuOptions");function Gd(){const{getSelectedNodes:e,toggleSelectedNodesMode:t}=Ao(),o=be(),s=_e();return{adjustNodeSize:n(()=>{e().forEach(p=>{const g=p.computeSize();p.setSize([g[0],g[1]])}),F.canvas.setDirty(!0,!0),s.activeWorkflow?.changeTracker?.checkState()},"adjustNodeSize"),toggleNodeCollapse:n(()=>{e().forEach(p=>{p.collapse()}),F.canvas.setDirty(!0,!0),s.activeWorkflow?.changeTracker?.checkState()},"toggleNodeCollapse"),toggleNodePin:n(()=>{e().forEach(p=>{p.pin(!p.pinned)}),F.canvas.setDirty(!0,!0),s.activeWorkflow?.changeTracker?.checkState()},"toggleNodePin"),toggleNodeBypass:n(()=>{t(Ie.BYPASS),F.canvas.setDirty(!0,!0)},"toggleNodeBypass"),runBranch:n(async()=>{const d=e();In(d).length!==0&&await o.execute("Comfy.QueueSelectedOutputNodes")},"runBranch")}}n(Gd,"useSelectedNodeActions");function Hd(){const{t:e}=he(),{shapeOptions:t,applyShape:o,applyColor:s,colorOptions:l,isLightTheme:a}=En(),{adjustNodeSize:i,toggleNodeCollapse:r,toggleNodePin:u,toggleNodeBypass:d,runBranch:p}=Gd(),g=b(()=>t.map(T=>({label:T.localizedName,action:n(()=>o(T),"action")}))),c=b(()=>l.map(T=>({label:T.localizedName,color:a.value?T.value.light:T.value.dark,action:n(()=>s(T.name==="noColor"?null:T),"action")})));return{getNodeInfoOption:n(T=>({label:e("contextMenu.Node Info"),icon:"icon-[lucide--info]",action:T}),"getNodeInfoOption"),getAdjustSizeOption:n(()=>({label:e("contextMenu.Adjust Size"),icon:"icon-[lucide--move-diagonal-2]",action:i}),"getAdjustSizeOption"),getNodeVisualOptions:n((T,S)=>[{label:T.collapsed?e("contextMenu.Expand Node"):e("contextMenu.Minimize Node"),icon:T.collapsed?"icon-[lucide--maximize-2]":"icon-[lucide--minimize-2]",action:n(()=>{r(),S()},"action")},{label:e("contextMenu.Shape"),icon:"icon-[lucide--box]",hasSubmenu:!0,submenu:g.value,action:n(()=>{},"action")},{label:e("contextMenu.Color"),icon:"icon-[lucide--palette]",hasSubmenu:!0,submenu:c.value,action:n(()=>{},"action")}],"getNodeVisualOptions"),getPinOption:n((T,S)=>({label:T.pinned?e("contextMenu.Unpin"):e("contextMenu.Pin"),icon:T.pinned?"icon-[lucide--pin-off]":"icon-[lucide--pin]",action:n(()=>{u(),S()},"action")}),"getPinOption"),getBypassOption:n((T,S)=>({label:T.bypassed?e("contextMenu.Remove Bypass"):e("contextMenu.Bypass"),icon:T.bypassed?"icon-[lucide--zap-off]":"icon-[lucide--ban]",shortcut:"Ctrl+B",action:n(()=>{d(),S()},"action")}),"getBypassOption"),getRunBranchOption:n(()=>({label:e("contextMenu.Run Branch"),icon:"icon-[lucide--play]",action:p}),"getRunBranchOption"),colorSubmenu:c}}n(Hd,"useNodeMenuOptions");function jd(){const{t:e}=he(),t=ce(),o=Ln(),s=[{name:"top",localizedName:e("contextMenu.Top"),value:"top",icon:"icon-[lucide--align-start-vertical]"},{name:"bottom",localizedName:e("contextMenu.Bottom"),value:"bottom",icon:"icon-[lucide--align-end-vertical]"},{name:"left",localizedName:e("contextMenu.Left"),value:"left",icon:"icon-[lucide--align-start-horizontal]"},{name:"right",localizedName:e("contextMenu.Right"),value:"right",icon:"icon-[lucide--align-end-horizontal]"}],l=[{name:"horizontal",localizedName:e("contextMenu.Horizontal"),value:!0,icon:"icon-[lucide--align-center-horizontal]"},{name:"vertical",localizedName:e("contextMenu.Vertical"),value:!1,icon:"icon-[lucide--align-center-vertical]"}];return{alignOptions:s,distributeOptions:l,applyAlign:n(r=>{const u=Array.from(t.selectedItems).filter(p=>ot(p));if(u.length===0)return;const d=vi(u,r.value);t.canvas?.repositionNodesVueMode(d),o.refreshCanvas()},"applyAlign"),applyDistribute:n(r=>{const u=Array.from(t.selectedItems).filter(p=>ot(p));if(u.length<2)return;const d=gi(u,r.value);t.canvas?.repositionNodesVueMode(d),o.refreshCanvas()},"applyDistribute")}}n(jd,"useNodeArrangement");function qd(){const e=ce(),t=tt(),o=pt(),s=Lo(),l=_e();return{copySelection:n(()=>{const p=F.canvas;if(!p.selectedItems||p.selectedItems.size===0){t.add({severity:"warn",summary:ae("g.nothingToCopy"),detail:ae("g.selectItemsToCopy"),life:3e3});return}p.copyToClipboard(),t.add({severity:"success",summary:ae("g.copied"),detail:ae("g.itemsCopiedToClipboard"),life:2e3})},"copySelection"),pasteSelection:n(()=>{F.canvas.pasteFromClipboard({connectInputs:!1}),l.activeWorkflow?.changeTracker?.checkState()},"pasteSelection"),duplicateSelection:n(()=>{const p=F.canvas;if(!p.selectedItems||p.selectedItems.size===0){t.add({severity:"warn",summary:ae("g.nothingToDuplicate"),detail:ae("g.selectItemsToDuplicate"),life:3e3});return}p.copyToClipboard(),p.selectedItems.clear(),e.updateSelectedItems(),p.pasteFromClipboard({connectInputs:!1}),l.activeWorkflow?.changeTracker?.checkState()},"duplicateSelection"),deleteSelection:n(()=>{const p=F.canvas;if(!p.selectedItems||p.selectedItems.size===0){t.add({severity:"warn",summary:ae("g.nothingToDelete"),detail:ae("g.selectItemsToDelete"),life:3e3});return}p.deleteSelected(),p.setDirty(!0,!0),l.activeWorkflow?.changeTracker?.checkState()},"deleteSelection"),renameSelection:n(async()=>{const p=Array.from(e.selectedItems);if(p.length===1){const g=p[0];if(g instanceof Ze){s.titleEditorTarget=g;return}const c="title"in g?g.title:"",f=await o.prompt({title:ae("g.rename"),message:ae("g.enterNewName"),defaultValue:c});if(f&&f!==c&&"title"in g){const v=g;v.title=f,F.canvas.setDirty(!0,!0),l.activeWorkflow?.changeTracker?.checkState()}return}if(p.length>1){const g=await o.prompt({title:ae("g.batchRename"),message:ae("g.enterBaseName"),defaultValue:"Item"});g&&(p.forEach((c,f)=>{if("title"in c){const v=c;v.title=`${g} ${f+1}`}}),F.canvas.setDirty(!0,!0),l.activeWorkflow?.changeTracker?.checkState());return}t.add({severity:"warn",summary:ae("g.nothingToRename"),detail:ae("g.selectItemsToRename"),life:3e3})},"renameSelection")}}n(qd,"useSelectionOperations");function Kd(){const{getSelectedNodes:e}=Ao(),t=ce(),o=_e(),s=Dt(),l=st(),a=ja(),i=n(()=>{const g=t.getCanvas(),c=g.subgraph??g.graph;if(!c)return null;const f=c.convertToSubgraph(g.selectedItems);if(!f)return;const{node:v}=f;g.select(v),t.updateSelectedItems(),o.activeWorkflow?.changeTracker?.checkState()},"convertToSubgraph");return{convertToSubgraph:i,unpackSubgraph:n(()=>{const g=t.getCanvas(),c=g.subgraph??g.graph;if(!c)return;const v=Array.from(g.selectedItems).filter(C=>C instanceof gt);v.length!==0&&(v.forEach(C=>{s.revokeSubgraphPreviews(C),c.unpackSubgraph(C)}),o.activeWorkflow?.changeTracker?.checkState())},"unpackSubgraph"),addSubgraphToLibrary:n(async()=>{const g=Array.from(t.selectedItems);if(g.length===1){const v=g[0];if(ot(v)){const C=l.fromLGraphNode(v);if(C){await a.addBookmark(C.nodePath);return}}}const c=e();if(c.length===0)return;if(!c.some(v=>v instanceof gt)){i();return}for(const v of c)if(v instanceof gt){const C=l.fromLGraphNode(v);C&&await a.addBookmark(C.nodePath)}},"addSubgraphToLibrary"),isSubgraphSelected:n(()=>Array.from(t.selectedItems).some(c=>c instanceof gt),"isSubgraphSelected"),hasSelectableNodes:n(()=>e().length>0,"hasSelectableNodes")}}n(Kd,"useSubgraphOperations");function Yd(){const{t:e}=he(),{copySelection:t,duplicateSelection:o,deleteSelection:s,renameSelection:l}=qd(),{alignOptions:a,distributeOptions:i,applyAlign:r,applyDistribute:u}=jd(),{convertToSubgraph:d,unpackSubgraph:p,addSubgraphToLibrary:g}=Kd(),{frameNodes:c}=ws(),f=b(()=>a.map(S=>({label:S.localizedName,icon:S.icon,action:n(()=>r(S),"action")}))),v=b(()=>i.map(S=>({label:S.localizedName,icon:S.icon,action:n(()=>u(S),"action")})));return{getBasicSelectionOptions:n(()=>[{label:e("contextMenu.Rename"),action:l},{label:e("contextMenu.Copy"),shortcut:"Ctrl+C",action:t},{label:e("contextMenu.Duplicate"),shortcut:"Ctrl+D",action:o}],"getBasicSelectionOptions"),getSubgraphOptions:n(S=>S?[{label:e("contextMenu.Add Subgraph to Library"),icon:"icon-[lucide--folder-plus]",action:g},{label:e("contextMenu.Unpack Subgraph"),icon:"icon-[lucide--expand]",action:p}]:[{label:e("contextMenu.Convert to Subgraph"),icon:"icon-[lucide--shrink]",action:d,badge:ln.NEW}],"getSubgraphOptions"),getMultipleNodesOptions:n(()=>{const S=n(()=>{be().execute("Comfy.GroupNode.ConvertSelectedNodesToGroupNode")},"convertToGroupNodes");return[{label:e("contextMenu.Convert to Group Node"),icon:"icon-[lucide--group]",action:S,badge:ln.DEPRECATED},{label:e("g.frameNodes"),icon:"icon-[lucide--frame]",action:c}]},"getMultipleNodesOptions"),getDeleteOption:n(()=>({label:e("contextMenu.Delete"),icon:"icon-[lucide--trash-2]",shortcut:"Delete",action:s}),"getDeleteOption"),getAlignmentOptions:n(()=>[{label:e("contextMenu.Align Selected To"),icon:"icon-[lucide--align-start-horizontal]",hasSubmenu:!0,submenu:f.value,action:n(()=>{},"action")},{label:e("contextMenu.Distribute Nodes"),icon:"icon-[lucide--align-center-horizontal]",hasSubmenu:!0,submenu:v.value,action:n(()=>{},"action")}],"getAlignmentOptions"),alignSubmenu:f,distributeSubmenu:v}}n(Yd,"useSelectionMenuOptions");var ln=(e=>(e.NEW="new",e.DEPRECATED="deprecated",e))(ln||{});let rn=null;function Cs(e,t,o=!1){rn?.toggle&&rn.toggle(e,t,o)}n(Cs,"toggleNodeOptions");function un(e){rn=e}n(un,"registerNodeOptionsInstance");function Qd(){const{selectedItems:e,selectedNodes:t,nodeDef:o,showNodeHelp:s,hasSubgraphs:l,hasImageNode:a,hasOutputNodesSelected:i,hasMultipleSelection:r,computeSelectionFlags:u}=ft(),{getImageMenuOptions:d}=Fd(),{getNodeInfoOption:p,getAdjustSizeOption:g,getNodeVisualOptions:c,getPinOption:f,getBypassOption:v,getRunBranchOption:C}=Hd(),{getFitGroupToNodesOption:m,getGroupShapeOptions:h,getGroupColorOptions:k,getGroupModeOptions:T}=Ud(),{getBasicSelectionOptions:S,getSubgraphOptions:$,getMultipleNodesOptions:_,getDeleteOption:P,getAlignmentOptions:M}=Yd(),L=l,N=r,B=R(0),D=n(()=>{B.value++},"bump"),z=b(()=>{B.value;const A=u(),G=e.value.filter(Ha),q=G.length===1&&t.value.length===0?G[0]:null,Q=L.value,Y=[];return Y.push(...S()),Y.push({type:"divider"}),o.value&&Y.push(p(s)),q?Y.push(m(q)):Y.push(g()),q?(Y.push(h(q,D)),Y.push(k(q,D)),Y.push({type:"divider"})):(Y.push(...c(A,D)),Y.push({type:"divider"})),a.value&&t.value.length>0&&Y.push(...d(t.value[0])),Y.push(...$(Q)),N.value&&Y.push(..._()),Y.push({type:"divider"}),q||Y.push(f(A,D)),N.value&&Y.push(...M()),q?Y.push(...T(q,D)):Y.push(v(A,D)),i.value&&Y.push(C()),Y.push({type:"divider"}),Y.push(P()),Y}),U=b(()=>z.value.filter(A=>A.hasSubmenu&&A.submenu));return{menuOptions:z,menuOptionsWithSubmenu:U,bump:D,hasSubgraphs:L,registerNodeOptionsInstance:un}}n(Qd,"useMoreOptionsMenu");const Zd=j({__name:"NodeOptionsButton",setup(e){const t=R(null),o=n(s=>{const l=t.value?.$el||t.value,a=l instanceof HTMLElement?l:null;a&&Cs(s,a,!0)},"handleClick");return(s,l)=>{const a=Te("tooltip");return pe((y(),O(w(ie),{ref_key:"buttonRef",ref:t,"data-testid":"more-options-button",text:"",class:"h-8 w-8 px-0",severity:"secondary",onClick:o},{default:W(()=>l[0]||(l[0]=[x("i",{class:"icon-[lucide--more-vertical] h-4 w-4"},null,-1)])),_:1})),[[a,{value:s.$t("g.moreOptions"),showDelay:1e3},void 0,{top:!0}]])}}}),Xd={},Jd={class:"h-6 w-px self-center bg-border-default"};function ep(e,t){return y(),I("div",Jd)}n(ep,"_sfc_render$1");const ua=we(Xd,[["render",ep]]),tp=j({__name:"SelectionToolbox",setup(e){const t=be(),o=ce(),s=hi(),l=wt(),a=R(),{visible:i}=Od(a),r=b(()=>{const z=new Set(o.selectedItems.map(U=>s.invokeExtensions("getSelectionToolboxCommands",U).flat()).flat());return Array.from(z).map(U=>t.getCommand(U)).filter(U=>U!==void 0)}),{hasAnySelection:u,hasMultipleSelection:d,isSingleNode:p,isSingleSubgraph:g,isSingleImageNode:c,hasAny3DNodeSelected:f,hasOutputNodesSelected:v,nodeDef:C}=ft(),m=b(()=>!!C.value),h=b(()=>u.value),k=b(()=>u.value),T=b(()=>d.value),S=b(()=>g.value),$=b(()=>p.value||g.value||d.value),_=b(()=>f.value),P=b(()=>c.value),M=b(()=>u.value),L=b(()=>u.value),N=b(()=>v.value),B=b(()=>h.value||k.value||T.value||S.value),D=b(()=>$.value);return(z,U)=>(y(),I("div",{ref_key:"toolboxRef",ref:a,style:{transform:"translate(var(--tb-x), var(--tb-y))"},class:"pointer-events-none fixed top-0 left-0 z-40"},[E(ba,{name:"slide-up"},{default:W(()=>[w(i)?(y(),O(w(as),{key:0,class:"selection-toolbox pointer-events-auto rounded-lg border border-interface-stroke bg-interface-panel-surface",pt:{header:"hidden",content:"p-2 h-12 flex flex-row gap-1"},onWheel:w(l).forwardEventToCanvas},{default:W(()=>[M.value?(y(),O(Nd,{key:0})):V("",!0),m.value&&B.value?(y(),O(ua,{key:1})):V("",!0),m.value?(y(),O(Rd,{key:2})):V("",!0),h.value?(y(),O($d,{key:3})):V("",!0),T.value?(y(),O(zd,{key:4})):V("",!0),k.value?(y(),O(Td,{key:5})):V("",!0),S.value?(y(),O(_d,{key:6})):V("",!0),S.value?(y(),O(Vd,{key:7})):V("",!0),P.value?(y(),O(Dd,{key:8})):V("",!0),B.value&&D.value?(y(),O(ua,{key:9})):V("",!0),$.value?(y(),O(bd,{key:10})):V("",!0),L.value?(y(),O(Ed,{key:11})):V("",!0),_.value?(y(),O(Pd,{key:12})):V("",!0),(y(!0),I(ue,null,$e(r.value,A=>(y(),O(Md,{key:A.id,command:A},null,8,["command"]))),128)),N.value?(y(),O(Id,{key:13})):V("",!0),E(Zd)]),_:1},8,["onWheel"])):V("",!0)]),_:1})],512))}}),op=we(tp,[["__scopeId","data-v-d1982b69"]]),np=j({__name:"TitleEditor",setup(e){const t=Z(),o=R(!1),s=R(""),{style:l,updatePosition:a}=hs(),i=R({}),r=b(()=>({...l.value,...i.value})),u=Lo(),d=ce(),p=R(!0),g=n(f=>{if(u.titleEditorTarget&&f?.trim()){const v=f.trim();u.titleEditorTarget.title=v;const C=u.titleEditorTarget;C instanceof Ze&&C.isSubgraphNode?.()&&(C.subgraph.name=v),F.graph.setDirtyCanvas(!0,!0)}o.value=!1,u.titleEditorTarget=null,d.canvas.allow_dragcanvas=p.value},"onEdit");return J(()=>u.titleEditorTarget,f=>{if(f===null)return;s.value=f.title,o.value=!0;const v=d.canvas;p.value=v.allow_dragcanvas,v.allow_dragcanvas=!1;const C=v.ds.scale;if(f instanceof ht){const m=f;a({pos:m.pos,size:[m.size[0],m.titleHeight]}),i.value={fontSize:`${m.font_size*C}px`}}else if(f instanceof Ze){const m=f,[h,k]=m.getBounding();a({pos:[h,k],size:[m.width,le.NODE_TITLE_HEIGHT]}),i.value={fontSize:`${12*C}px`}}}),xe(document,"litegraph:canvas",n(f=>{if(f.detail.subType==="group-double-click"){if(!t.get("Comfy.Group.DoubleClickTitleToEdit"))return;const v=f.detail.group,[C,m]=v.pos;f.detail.originalEvent.canvasY-m<=v.titleHeight&&(u.titleEditorTarget=v)}else if(f.detail.subType==="node-double-click"){if(!t.get("Comfy.Node.DoubleClickTitleToEdit"))return;const v=f.detail.node,[C,m]=v.pos;f.detail.originalEvent.canvasY-m<=0&&(u.titleEditorTarget=v)}},"canvasEventHandler")),(f,v)=>o.value?(y(),I("div",{key:0,class:"group-title-editor node-title-editor",style:me(r.value)},[E(yi,{"is-editing":o.value,"model-value":s.value,onEdit:g},null,8,["is-editing","model-value"])],4)):V("",!0)}}),ap=we(np,[["__scopeId","data-v-5a43f2bb"]]);function sp(){const e=n(async(a,i,r,u,d,p)=>{if(!a.label||!a.hasSubmenu)return;const g=u.value===a.label;if(d.forEach(c=>{const f=p[`submenu-${c.label}`];f&&f.hide()}),u.value=null,!g){u.value=a.label,await De();const c=i.currentTarget,f=c.getBoundingClientRect(),v=c.closest('[data-pc-section="content"]');if(v){const C=v.getBoundingClientRect(),m=t(C.right+8,f.top,`submenu-target-${a.label}`),h=o(C.right+8,f.top);r.show(h,m),s(m,100)}else{const C=t(f.right+8,f.top,`submenu-fallback-target-${a.label}`),m=o(f.right+8,f.top);r.show(m,C),s(C,100)}}},"toggleSubmenu"),t=n((a,i,r)=>{const u=document.createElement("div");return u.style.position="absolute",u.style.left=`${a}px`,u.style.top=`${i}px`,u.style.width="1px",u.style.height="1px",u.style.pointerEvents="none",u.style.visibility="hidden",u.id=r,document.body.appendChild(u),u},"createPositionedTarget"),o=n((a,i)=>new MouseEvent("click",{bubbles:!0,cancelable:!0,clientX:a,clientY:i}),"createMouseEvent"),s=n((a,i)=>{setTimeout(()=>{a.parentNode&&a.parentNode.removeChild(a)},i)},"cleanupTempTarget");return{toggleSubmenu:e,hideAllSubmenus:n((a,i,r)=>{a.forEach(u=>{const d=i[`submenu-${u.label}`];d&&d.hide()}),r.value=null},"hideAllSubmenus")}}n(sp,"useSubmenuPositioning");const ip={key:0,class:"my-1 h-px bg-border-default"},lp={class:"flex-1"},rp={key:1,class:"flex h-3.5 min-w-3.5 items-center justify-center rounded bg-interface-menu-keybind-surface-default px-1 py-0 text-xxs"},up={key:2,size:14,class:"icon-[lucide--chevron-right] opacity-60"},cp=j({__name:"MenuOptionItem",props:{option:{}},emits:["click"],setup(e,{emit:t}){const{t:o}=he(),s=e,l=t,a=n(i=>{l("click",s.option,i)},"handleClick");return(i,r)=>i.option.type==="divider"?(y(),I("div",ip)):(y(),I("div",{key:1,role:"button",class:"group flex cursor-pointer items-center gap-2 rounded px-3 py-1.5 text-left text-sm text-text-primary hover:bg-interface-menu-component-surface-hovered",onClick:a},[i.option.icon?(y(),I("i",{key:0,class:K([i.option.icon,"h-4 w-4"])},null,2)):V("",!0),x("span",lp,H(i.option.label),1),i.option.shortcut?(y(),I("span",rp,H(i.option.shortcut),1)):V("",!0),i.option.hasSubmenu?(y(),I("i",up)):V("",!0),i.option.badge?(y(),O(w(Sl),{key:3,severity:i.option.badge==="new"?"info":"secondary",value:w(o)(i.option.badge),class:K(w(re)("h-4 gap-2.5 px-1 text-[9px] text-base-foreground uppercase rounded-4xl",{"bg-primary-background":i.option.badge==="new","bg-secondary-background":i.option.badge==="deprecated"}))},null,8,["severity","value","class"])):V("",!0)]))}}),dp=["title","onClick"],pp={key:0,class:"icon-[lucide--check] size-4 flex-shrink-0"},fp={key:1,class:"w-4 flex-shrink-0"},mp=j({__name:"SubmenuPopover",props:{option:{}},emits:["submenu-click"],setup(e,{expose:t,emit:o}){const s=e,l=o,{getCurrentShape:a}=En(),i=R();t({show:n((c,f)=>{i.value?.show(c,f)},"show"),hide:n(()=>{i.value?.hide()},"hide")});const d=n(c=>{l("submenu-click",c)},"handleSubmenuClick"),p=n(c=>{if(c.color)return!1;const f=a();return f?f.localizedName===c.label:!1},"isShapeSelected"),g=b(()=>s.option.submenu&&s.option.submenu.length>0&&s.option.submenu.every(c=>c.color&&!c.icon));return(c,f)=>(y(),O(w(ut),{ref_key:"popover",ref:i,"auto-z-index":!0,"base-z-index":1100,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:{root:{class:"absolute z-[60]"},content:{class:["text-base-foreground rounded-lg","shadow-lg border border-base-background","bg-interface-panel-surface"]}}},{default:W(()=>[x("div",{class:K(g.value?"flex flex-col gap-1 p-2":"flex flex-col p-2 min-w-40")},[(y(!0),I(ue,null,$e(c.option.submenu,v=>(y(),I("div",{key:v.label,class:K(w(re)("hover:bg-secondary-background-hover rounded cursor-pointer",g.value?"w-7 h-7 flex items-center justify-center":"flex items-center gap-2 px-3 py-1.5 text-sm")),title:v.label,onClick:n(C=>d(v),"onClick")},[v.color?(y(),I("div",{key:0,class:"size-5 rounded-full border border-border-default",style:me({backgroundColor:v.color})},null,4)):v.color?V("",!0):(y(),I(ue,{key:1},[p(v)?(y(),I("i",pp)):(y(),I("div",fp)),x("span",null,H(v.label),1)],64))],10,dp))),128))],2)]),_:1},512))}}),vp={class:"flex min-w-48 flex-col p-2"},gp=j({__name:"NodeOptions",setup(e,{expose:t}){const o=R(),s=R(null),l=R(!0),a=R(!1),i=R(!1),r=R(null),u=R({}),d=R(null),{menuOptions:p,menuOptionsWithSubmenu:g,bump:c}=Qd(),{toggleSubmenu:f,hideAllSubmenus:v}=sp(),C=wt();let m=null;function h(){if(m&&m.isConnected)return m;const q=o.value?.$el;if(q instanceof HTMLElement)return m=q,q;const Q=s.value;if(Q){const Y=Array.from(document.querySelectorAll("div.absolute.z-50")),te=Q.getBoundingClientRect();let fe=null;for(const ne of Y){const Se=ne.getBoundingClientRect(),Ve=Math.abs(Se.top-te.bottom);(!fe||Ve<fe.dist)&&(fe={el:ne,dist:Ve})}if(fe&&fe.el)return m=fe.el,fe.el}return null}n(h,"resolveOverlayEl");const k=n(()=>{if(!a.value)return;const q=s.value,Q=h();if(!q||!Q)return;const Y=q.getBoundingClientRect(),te=8,fe=l.value?Y.left+Y.width/2:Y.right-Y.width/4,ne=l.value?Y.bottom+te:Y.top-te-6;try{Q.style.position="fixed",Q.style.left=`${fe}px`,Q.style.top=`${ne}px`,Q.style.transform="translate(-50%, 0)"}catch(Se){console.warn("[NodeOptions] Failed to set overlay style",Se);return}performance.now()},"repositionPopover"),{resume:T,pause:S}=Jt(k);function $(q,Q,Y){const te=Q||s.value;return!te||!te.isConnected?!1:(s.value=te,Y!==void 0&&(l.value=Y),c(),o.value?.show(q??new Event("reopen"),te),a.value=!0,lt.value=!0,Pe.value=!1,!0)}n($,"openPopover");function _(q="manual"){r.value=q,o.value?.hide(),a.value=!1,lt.value=!1,S(),B(),q!=="drag"?(i.value=!1,Pe.value=!1):Pe.value||(i.value=!0,Pe.value=!0)}n(_,"closePopover");let P=0;function M(){if(!a.value&&!(!i.value&&!Pe.value)){if($(new Event("reopen"),s.value||void 0)){i.value=!1,P=0;return}P>=5||(P++,requestAnimationFrame(()=>M()))}}n(M,"attemptRestore");const L=n((q,Q,Y)=>{a.value?_("manual"):$(q,Q,Y)},"toggle"),N=n((q="manual")=>_(q),"hide");t({toggle:L,hide:N,isOpen:a});const B=n(()=>{v(g.value,u.value,d)},"hideAll"),D=n((q,Q)=>{if(!q.hasSubmenu&&q.action)q.action(),N();else if(q.hasSubmenu){Q.stopPropagation();const Y=`submenu-${q.label}`,te=u.value[Y];te&&f(q,Q,te,d,g.value,u.value)}},"handleOptionClick"),z=n(q=>{q.action(),N("manual")},"handleSubmenuClick"),U=n((q,Q)=>{Q?u.value[q]=Q:delete u.value[q]},"setSubmenuRef"),A=n(()=>{m=h(),requestAnimationFrame(()=>k()),T()},"onPopoverShow"),G=n(()=>{r.value==null&&(a.value=!1,B(),i.value=!1,lt.value=!1,Pe.value=!1),m=null,S(),r.value=null},"onPopoverHide");return J(()=>ys.value,()=>{a.value?N("drag"):i.value=i.value||Pe.value}),J(()=>bs.value,()=>M()),Me(()=>{un({toggle:L,hide:N,isOpen:a}),Pe.value&&!a.value&&requestAnimationFrame(()=>M())}),at(()=>{S(),un(null)}),(q,Q)=>(y(),I("div",null,[E(w(ut),{ref_key:"popover",ref:o,"append-to":"body","auto-z-index":!0,"base-z-index":1e3,dismissable:!0,"close-on-escape":!0,unstyled:"",pt:{root:{class:"absolute z-50 w-[300px]"},content:{class:["mt-2 text-base-foreground rounded-lg","shadow-lg border border-border-default","bg-interface-panel-surface"]}},onShow:A,onHide:G,onWheel:w(C).forwardEventToCanvas},{default:W(()=>[x("div",vp,[(y(!0),I(ue,null,$e(w(p),(Y,te)=>(y(),O(cp,{key:Y.label||`divider-${te}`,option:Y,onClick:D},null,8,["option"]))),128))])]),_:1},8,["onWheel"]),(y(!0),I(ue,null,$e(w(g),Y=>(y(),O(mp,{key:`submenu-${Y.label}`,ref_for:!0,ref:n(te=>U(`submenu-${Y.label}`,te),"ref"),option:Y,onSubmenuClick:z},null,8,["option"]))),128))]))}}),Vn=St("searchBox",()=>{const e=Z(),{x:t,y:o}=Ws(),s=b(()=>e.get("Comfy.NodeSearchBoxImpl")==="default"),l=rt(null);function a(u){l.value=u}n(a,"setPopoverRef");const i=R(!1);function r(){if(s.value){i.value=!i.value;return}l.value&&l.value.showSearchBox(new MouseEvent("click",{clientX:t.value,clientY:o.value,layerY:o.value}))}return n(r,"toggleVisible"),{newSearchBoxEnabled:s,setPopoverRef:a,toggleVisible:r,visible:i}}),hp={name:"AutoCompletePlus",extends:io,emits:["focused-option-changed"],data(){return{isComposing:!1}},mounted(){typeof io.mounted=="function"&&io.mounted.call(this);const e=this.$el.querySelector("input");e&&(e.addEventListener("compositionstart",()=>{this.isComposing=!0}),e.addEventListener("compositionend",()=>{this.isComposing=!1})),this.$watch(()=>this.focusedOptionIndex,(t,o)=>{this.$emit("focused-option-changed",t)})},methods:{onKeyDown(e){if(e.key==="Enter"&&this.isComposing){e.preventDefault(),e.stopPropagation();return}io.methods.onKeyDown.call(this,e)}}},yp={class:"option-container flex w-full cursor-pointer items-center justify-between overflow-hidden px-2 py-0"},bp={class:"option-display-name flex flex-col font-semibold"},wp={key:0},Cp=["innerHTML"],Sp=["innerHTML"],kp={key:0,class:"option-category truncate text-sm font-light text-muted"},xp={class:"option-badges"},$p=j({__name:"NodeSearchItem",props:{nodeDef:{},currentQuery:{}},setup(e){const t=Z(),o=b(()=>t.get("Comfy.NodeSearchBoxImpl.ShowCategory")),s=b(()=>t.get("Comfy.NodeSearchBoxImpl.ShowIdName")),l=b(()=>t.get("Comfy.NodeSearchBoxImpl.ShowNodeFrequency")),a=_n(),i=b(()=>a.getNodeFrequency(d.nodeDef)),r=ja(),u=b(()=>r.isBookmarked(d.nodeDef)),d=e;return(p,g)=>(y(),I("div",yp,[x("div",bp,[x("div",null,[u.value?(y(),I("span",wp,g[0]||(g[0]=[x("i",{class:"pi pi-bookmark-fill mr-1 text-sm"},null,-1)]))):V("",!0),x("span",{innerHTML:w(Hn)(p.nodeDef.display_name,p.currentQuery)},null,8,Cp),g[1]||(g[1]=x("span",null,"",-1)),s.value?(y(),O(w(Ut),{key:1,severity:"secondary"},{default:W(()=>[x("span",{innerHTML:w(Hn)(p.nodeDef.name,p.currentQuery)},null,8,Sp)]),_:1})):V("",!0)]),o.value?(y(),I("div",kp,H(p.nodeDef.category.replaceAll("/"," > ")),1)):V("",!0)]),x("div",xp,[p.nodeDef.experimental?(y(),O(w(Ut),{key:0,value:p.$t("g.experimental"),severity:"primary"},null,8,["value"])):V("",!0),p.nodeDef.deprecated?(y(),O(w(Ut),{key:1,value:p.$t("g.deprecated"),severity:"danger"},null,8,["value"])):V("",!0),l.value&&i.value>0?(y(),O(w(Ut),{key:2,value:w(bi)(i.value,{roundToInt:!0}),severity:"secondary"},null,8,["value"])):V("",!0),p.nodeDef.nodeSource.type!==w(wi).Unknown?(y(),O(w(kl),{key:3,class:"text-sm font-light"},{default:W(()=>[Ye(H(p.nodeDef.nodeSource.displayText),1)]),_:1})):V("",!0)])]))}}),_p=we($p,[["__scopeId","data-v-acda36a0"]]),Tp={class:"comfy-vue-node-search-container flex w-full min-w-96 items-center justify-center"},Np={key:0,class:"comfy-vue-node-preview-container absolute top-[50px] left-[-350px]"},Ip={class:"_dialog-body"},Mp=j({__name:"NodeSearchBox",props:{filters:{},searchLimit:{default:64}},emits:["addFilter","removeFilter","addNode"],setup(e,{emit:t}){const o=Z(),{t:s}=he(),l=b(()=>o.get("Comfy.NodeSearchBoxImpl.NodePreview")),a=R(),i=R(!1),r=`comfy-vue-node-search-box-input-${Math.random()}`,u=R([]),d=R(null),p=R(""),g=b(()=>e.filters.length===0?s("g.searchNodes")+"...":""),c=st(),f=_n(),v=Mo(P=>{P.trim()},500),C=n(P=>{const M=P===""&&e.filters.length===0;p.value=P,u.value=M?f.topNodeDefs:[...c.nodeSearchService.searchNode(P,e.filters,{limit:e.searchLimit})],v(P)},"search"),m=t,h=n(P=>{m("addNode",P)},"onAddNode");let k=null;const T=n(async()=>{k??=document.getElementById(r),k&&(k.blur(),await De(()=>k?.focus()))},"reFocusInput");Me(()=>{k??=document.getElementById(r),k&&k.focus(),a.value.hide=()=>C(""),C(""),a.value.show()});const S=n(P=>{i.value=!1,m("addFilter",P)},"onAddFilter"),$=n(async(P,M)=>{P.stopPropagation(),P.preventDefault(),m("removeFilter",M),await T()},"onRemoveFilter"),_=n(P=>{if(P===-1){d.value=null;return}const M=u.value[P];d.value=M},"setHoverSuggestion");return(P,M)=>(y(),I("div",Tp,[l.value?(y(),I("div",Np,[d.value?(y(),O(Ci,{key:d.value?.name||"","node-def":d.value},null,8,["node-def"])):V("",!0)])):V("",!0),E(w(ie),{icon:"pi pi-filter",severity:"secondary",class:"filter-button z-10",onClick:M[0]||(M[0]=L=>i.value=!0)}),E(w(ls),{visible:i.value,"onUpdate:visible":M[1]||(M[1]=L=>i.value=L),class:"min-w-96","dismissable-mask":"",modal:"",onHide:T},{header:W(()=>[x("h3",null,H(P.$t("g.addNodeFilterCondition")),1)]),default:W(()=>[x("div",Ip,[E(Si,{onAddFilter:S})])]),_:1},8,["visible"]),E(hp,{ref_key:"autoCompletePlus",ref:a,"model-value":P.filters,class:"comfy-vue-node-search-box z-10 grow","scroll-height":"40vh",placeholder:g.value,"input-id":r,"append-to":"self",suggestions:u.value,delay:100,loading:!w(f).isLoaded,"complete-on-focus":"","auto-option-focus":"","force-selection":"",multiple:"","option-label":"display_name",onComplete:M[2]||(M[2]=L=>C(L.query)),onOptionSelect:M[3]||(M[3]=L=>h(L.value)),onFocusedOptionChanged:M[4]||(M[4]=L=>_(L))},{option:W(({option:L})=>[E(_p,{"node-def":L,"current-query":p.value},null,8,["node-def","current-query"])]),chip:W(({value:L})=>[L.filterDef&&L.value?(y(),O(ki,{key:`${L.filterDef.id}-${L.value}`,text:L.value,badge:L.filterDef.invokeSequence.toUpperCase(),"badge-class":L.filterDef.invokeSequence+"-badge",onRemove:n(N=>$(N,L),"onRemove")},null,8,["text","badge","badge-class","onRemove"])):V("",!0)]),_:1},8,["model-value","placeholder","suggestions","loading"])]))}}),Rp=j({__name:"NodeSearchBoxPopover",setup(e,{expose:t}){let o=null,s=null,l=!1;const a=Z(),i=Vn(),r=Eo(),{visible:u,newSearchBoxEnabled:d}=ct(i),p=R(!0);function g(){return o?[o.canvasX,o.canvasY]:r.getCanvasCenter()}n(g,"getNewNodeLocation");const c=R([]);function f(A){c.value.push(A)}n(f,"addFilter");function v(A){c.value=c.value.filter(G=>zn(G)!==zn(A))}n(v,"removeFilter");function C(){c.value=[]}n(C,"clearFilters");function m(){u.value=!1}n(m,"closeDialog");const h=ce();function k(A){const G=r.addNodeOnGraph(A,{pos:g()});l&&o?h.getCanvas().linkConnector.connectToNode(G,o):o||console.warn("The trigger event was undefined when addNode was called."),l=!1,_e().activeWorkflow?.changeTracker?.checkState(),window.requestAnimationFrame(m)}n(k,"addNode");function T(A){d.value?A?.pointerType==="touch"?setTimeout(()=>{_(A)},128):_(A):h.getCanvas().showSearchBox(A)}n(T,"showSearchBox");function S(){return h.getCanvas().linkConnector.renderLinks.at(0)}n(S,"getFirstLink");const $=st();function _(A){const G=S();if(G){const q=G.toType==="input"?$.nodeSearchService.inputTypeFilter:$.nodeSearchService.outputTypeFilter,Q=G.fromSlot.type?.toString()??"";f({filterDef:q,value:Q})}u.value=!0,o=A,p.value=!1,setTimeout(()=>{p.value=!0},300)}n(_,"showNewSearchBox");function P(A){const G=S();if(!G)return;const{node:q,fromSlot:Q,toType:Y}=G,te={e:A,allow_searchbox:!0,showSearchBox:n(()=>{qe(),T(A)},"showSearchBox")},fe=G.fromReroute?.id,ne=Y==="input"?{nodeFrom:q,slotFrom:Q,afterRerouteId:fe}:{nodeTo:q,slotTo:Q,afterRerouteId:fe},Se=h.getCanvas(),Ve=Se.showConnectionMenu({...ne,...te});if(!Ve){console.warn("No menu was returned from showConnectionMenu");return}o=A,s=new AbortController;const{signal:He}=s,je={once:!0,signal:He};xe(Se.canvas,"connect-new-default-node",We=>{if(!(We instanceof CustomEvent))throw new Error("Invalid event");const Be=We.detail?.node;if(!(Be instanceof Ze))throw new Error("Invalid node");l=!1,We.preventDefault(),Se.linkConnector.connectToNode(Be,A)},je);const qe=xe(Ve.controller.signal,"abort",U,je)}n(P,"showContextMenu"),ge(()=>{const{canvas:A}=h;A&&(le.release_link_on_empty_shows_menu=!1,A.allow_searchbox=!1,xe(A.linkConnector.events,"dropped-on-canvas",z))});function M(A){if(A.detail.subType==="empty-double-click")T(A.detail.originalEvent);else if(A.detail.subType==="group-double-click"){const G=A.detail.group,[q,Q]=G.pos;A.detail.originalEvent.canvasY-Q>G.titleHeight&&T(A.detail.originalEvent)}}n(M,"canvasEventHandler");const L=b(()=>a.get("Comfy.LinkRelease.Action")),N=b(()=>a.get("Comfy.LinkRelease.ActionShift"));function B(A){return A.preventDefault()}n(B,"preventDefault");function D(A){A.preventDefault();const G=h.getCanvas();G.linkConnector.state.snapLinksPos=[A.detail.canvasX,A.detail.canvasY],xe(G.linkConnector.events,"reset",B,{once:!0})}n(D,"cancelNextReset");function z(A){switch(l=!0,A.detail.shiftKey?N.value:L.value){case et.SEARCH_BOX:D(A),T(A.detail);break;case et.CONTEXT_MENU:D(A),P(A.detail);break;case et.NO_ACTION:}}n(z,"handleDroppedOnCanvas");function U(){s?.abort(),s=null,o=null;const A=h.getCanvas();A.linkConnector.events.removeEventListener("reset",B),l&&A.linkConnector.disconnectLinks(),A.linkConnector.reset(),A.setDirty(!0,!0)}return n(U,"reset"),J(u,()=>{u.value||U()}),xe(document,"litegraph:canvas",M),t({showSearchBox:T}),(A,G)=>(y(),I("div",null,[E(w(ls),{visible:w(u),"onUpdate:visible":G[0]||(G[0]=q=>Yt(u)?u.value=q:null),modal:"","dismissable-mask":p.value,pt:{root:{class:"invisible-dialog-root",role:"search"},mask:{class:"node-search-box-dialog-mask"},transition:{enterFromClass:"opacity-0 scale-75",enterActiveClass:"transition-all duration-100 ease-out",leaveActiveClass:"transition-all duration-100 ease-in",leaveToClass:"opacity-0 scale-75"}},onHide:C},{container:W(()=>[E(Mp,{filters:c.value,onAddFilter:f,onRemoveFilter:v,onAddNode:k},null,8,["filters"])]),_:1},8,["visible","dismissable-mask"])]))}}),Pp=["width","height"],Dp=j({__name:"ComfyLogo",props:{size:{default:16},color:{default:"currentColor"},class:{},mode:{default:"outline"}},setup(e){const t=b(()=>e.class||""),o=b(()=>({stroke:e.mode==="outline"?e.color:void 0,strokeWidth:e.mode==="outline"?1:void 0,fill:e.mode==="fill"?e.color:"none"}));return(s,l)=>(y(),I("svg",{class:K(t.value),width:s.size,height:s.size,viewBox:"0 0 18 18",xmlns:"http://www.w3.org/2000/svg"},[x("path",nt({d:"M14.8193 0.600586C15.1248 0.600586 15.3296 0.70893 15.459 0.881836C15.5914 1.05888 15.6471 1.33774 15.5527 1.66895L14.8037 4.30176C14.7063 4.64386 14.4729 4.97024 14.1641 5.21191C13.8544 5.45415 13.496 5.58984 13.1699 5.58984H13.1689L9.5791 5.59668H7.90625C7.52654 5.59668 7.19496 5.84986 7.09082 6.21289L5.69434 11.0889C5.63007 11.3133 5.66134 11.5534 5.77734 11.7529L5.83203 11.8359C5.99177 12.0491 6.24252 12.1758 6.50977 12.1758H6.51074L8.88281 12.1709H11.4971C11.7643 12.171 11.9541 12.254 12.084 12.3906L12.1357 12.4521C12.2685 12.6295 12.3249 12.9089 12.2305 13.2402L11.4805 15.8721C11.383 16.2144 11.1498 16.5415 10.8408 16.7832C10.5314 17.0252 10.1736 17.161 9.84766 17.1611H9.84668L6.25684 17.168H3.64258C3.33762 17.1679 3.13349 17.0588 3.00391 16.8857C2.87135 16.7087 2.81482 16.43 2.90918 16.0986L3.39551 14.3887C3.46841 14.1327 3.41794 13.8576 3.25879 13.6445V13.6436C3.09901 13.4303 2.84745 13.3037 2.58008 13.3037H1.18066C0.875088 13.3037 0.670398 13.1953 0.541016 13.0225C0.408483 12.8451 0.351891 12.5655 0.446289 12.2344L2.11914 6.38965L2.30371 5.74707V5.74609C2.40139 5.40341 2.63456 5.07671 2.94336 4.83496C3.25302 4.59258 3.61143 4.45705 3.9375 4.45703H5.6123C5.94484 4.45703 6.24083 4.26316 6.37891 3.9707L6.42773 3.83984L6.98145 1.89551C7.07894 1.55317 7.31212 1.22614 7.62109 0.984375C7.93074 0.742127 8.2892 0.606445 8.61523 0.606445H8.61621L12.1982 0.600586H14.8193Z"},o.value),null,16)],10,Pp))}}),Ap={class:"relative aspect-square w-full overflow-hidden rounded-t-lg select-none"},Lp={key:1,class:"flex h-full w-full items-center justify-center"},Ep=j({__name:"BaseThumbnail",props:{hoverZoom:{default:4},isHovered:{type:Boolean}},setup(e){const t=R(!1),o=R(null);return Me(()=>{Array.from(o.value?.getElementsByTagName("img")??[]).forEach(l=>{xe(l,"error",()=>{t.value=!0})})}),(s,l)=>(y(),I("div",Ap,[t.value?(y(),I("div",Lp,l[0]||(l[0]=[x("img",{src:Vl,draggable:"false",class:"h-full w-full transform-gpu object-cover transition-transform duration-300 ease-out"},null,-1)]))):(y(),I("div",{key:0,ref_key:"contentRef",ref:o,class:"h-full w-full transform-gpu transition-transform duration-1000 ease-out",style:me(s.isHovered?{transform:`scale(${1+s.hoverZoom/100})`}:void 0)},[Ne(s.$slots,"default",{},void 0,!0)],4))]))}}),Bo=we(Ep,[["__scopeId","data-v-c216f2c0"]]),Vp={class:"flex h-full w-full items-center justify-center p-4",style:{backgroundImage:"url(/assets/images/default-template.png)",backgroundRepeat:"round"}},Wp=["src"],Op=j({__name:"AudioThumbnail",props:{src:{}},setup(e){return(t,o)=>(y(),O(Bo,null,{default:W(()=>[x("div",Vp,[x("audio",{controls:"",class:"relative w-full",src:t.src,onClick:o[0]||(o[0]=Ee(()=>{},["stop"]))},null,8,Wp)])]),_:1}))}}),Bp=50,zp=j({__name:"CompareSliderThumbnail",props:{baseImageSrc:{},overlayImageSrc:{},alt:{},isHovered:{type:Boolean},isVideo:{type:Boolean}},setup(e){const t=e.isVideo||e.baseImageSrc?.toLowerCase().endsWith(".webp")||e.overlayImageSrc?.toLowerCase().endsWith(".webp")||!1,o=R(Bp),s=R(null),{elementX:l,elementWidth:a,isOutside:i}=Os(s);return J([()=>e.isHovered,l,a,i],([r,u,d,p])=>{r&&(p||(o.value=u/d*100))}),(r,u)=>(y(),O(Bo,{"is-hovered":r.isHovered},{default:W(()=>[E(Zt,{src:r.baseImageSrc,alt:r.alt,"image-class":w(t)?"w-full h-full object-cover":"max-w-full max-h-64 object-contain"},null,8,["src","alt","image-class"]),x("div",{ref_key:"containerRef",ref:s,class:"absolute inset-0"},[E(Zt,{src:r.overlayImageSrc,alt:r.alt,"image-class":w(t)?"w-full h-full object-cover":"max-w-full max-h-64 object-contain","image-style":{clipPath:`inset(0 ${100-o.value}% 0 0)`}},null,8,["src","alt","image-class","image-style"]),x("div",{class:"pointer-events-none absolute inset-y-0 z-10 w-0.5 bg-white/30 backdrop-blur-sm",style:me({left:`${o.value}%`})},null,4)],512)]),_:1},8,["is-hovered"]))}}),Up=j({__name:"DefaultThumbnail",props:{src:{},alt:{},hoverZoom:{},isHovered:{type:Boolean},isVideo:{type:Boolean}},setup(e){const t=e.isVideo??(e.src?.toLowerCase().endsWith(".webp")||!1);return(o,s)=>(y(),O(Bo,{"hover-zoom":o.hoverZoom,"is-hovered":o.isHovered},{default:W(()=>[E(Zt,{src:o.src,alt:o.alt,"image-class":["transform-gpu transition-transform duration-300 ease-out",w(t)?"w-full h-full object-cover":"max-w-full max-h-64 object-contain"],"image-style":o.isHovered?{transform:`scale(${1+o.hoverZoom/100})`}:void 0},null,8,["src","alt","image-class","image-style"])]),_:1},8,["hover-zoom","is-hovered"]))}}),Fp={class:"relative h-full w-full"},Gp={class:"absolute inset-0"},Hp={class:"absolute inset-0 z-10"},jp=j({__name:"HoverDissolveThumbnail",props:{baseImageSrc:{},overlayImageSrc:{},alt:{},isHovered:{type:Boolean},isVideo:{type:Boolean}},setup(e){const t=e.isVideo||e.baseImageSrc?.toLowerCase().endsWith(".webp")||e.overlayImageSrc?.toLowerCase().endsWith(".webp")||!1,o=b(()=>t?"size-full object-cover":"size-full object-contain"),s=b(()=>{const l="size-full transition-opacity duration-300",a=t?"object-cover":"object-contain",i=e.isHovered?"opacity-100":"opacity-0";return`${l} ${a} ${i}`});return(l,a)=>(y(),O(Bo,{"is-hovered":l.isHovered},{default:W(()=>[x("div",Fp,[x("div",Gp,[E(Zt,{src:l.baseImageSrc,alt:l.alt,"image-class":o.value},null,8,["src","alt","image-class"])]),x("div",Hp,[E(Zt,{src:l.overlayImageSrc,alt:l.alt,"image-class":s.value},null,8,["src","alt","image-class"])])])]),_:1},8,["is-hovered"]))}});function qp(e,t={}){const{itemsPerPage:o=12,initialPage:s=1}=t,l=R(s),a=R(!1),i=rt(new Set([])),r=b(()=>{const f="value"in e?e.value:e;return Array.isArray(f)?f:[]}),u=b(()=>{const f=r.value;if(f.length===0)return[];const v=Array.from(i.value).sort((h,k)=>h-k),m=Math.max(...v,0)*o;return f.slice(0,m)}),d=b(()=>{const f=r.value;if(f.length===0)return!1;const v=Array.from(i.value);return Math.max(...v,0)*o<f.length}),p=b(()=>{const f=r.value;return f.length===0?0:Math.ceil(f.length/o)}),g=n(async()=>{if(a.value||!d.value)return;a.value=!0;const f=Array.from(i.value),v=Math.max(...f,0)+1,C=new Set(i.value);C.add(v),i.value=C,l.value=v,a.value=!1},"loadNextPage");return J(()=>r.value.length,f=>{f>0&&i.value.size===0&&(i.value=new Set([1]))},{immediate:!0}),{paginatedItems:u,isLoading:a,hasMoreItems:d,currentPage:l,totalPages:p,loadNextPage:g,reset:n(()=>{l.value=s,i.value=new Set([]),a.value=!1,r.value.length>0&&(i.value=new Set([1]))},"reset")}}n(qp,"useLazyPagination");function Kp(e){const t=Z(),o=R(""),s=R(t.get("Comfy.Templates.SelectedModels")),l=R(t.get("Comfy.Templates.SelectedUseCases")),a=R(t.get("Comfy.Templates.SelectedRunsOn")),i=R(t.get("Comfy.Templates.SortBy")),r=b(()=>{const D="value"in e?e.value:e;return Array.isArray(D)?D:[]}),u={keys:[{name:"name",weight:.3},{name:"title",weight:.3},{name:"description",weight:.2},{name:"tags",weight:.1},{name:"models",weight:.1}],threshold:.4,includeScore:!0,includeMatches:!0},d=b(()=>new $a(r.value,u)),p=b(()=>{const D=new Set;return r.value.forEach(z=>{Array.isArray(z.models)&&z.models.forEach(U=>D.add(U))}),Array.from(D).sort()}),g=b(()=>{const D=new Set;return r.value.forEach(z=>{z.tags&&Array.isArray(z.tags)&&z.tags.forEach(U=>D.add(U))}),Array.from(D).sort()}),c=b(()=>["ComfyUI","External or Remote API"]),f=Bs(o,50),v=b(()=>f.value.trim()?d.value.search(f.value).map(z=>z.item):r.value),C=b(()=>s.value.length===0?v.value:v.value.filter(D=>!D.models||!Array.isArray(D.models)?!1:s.value.some(z=>D.models?.includes(z)))),m=b(()=>l.value.length===0?C.value:C.value.filter(D=>!D.tags||!Array.isArray(D.tags)?!1:l.value.some(z=>D.tags?.includes(z)))),h=b(()=>a.value.length===0?m.value:m.value.filter(D=>{const z=D.openSource===!1,U=D.openSource!==!1;return a.value.some(A=>A==="External or Remote API"?z:A==="ComfyUI"?U:!1)})),k=n(D=>typeof D.vram=="number"&&Number.isFinite(D.vram)&&D.vram>0?D.vram:Number.POSITIVE_INFINITY,"getVramMetric"),T=b(()=>{const D=[...h.value];switch(i.value){case"alphabetical":return D.sort((z,U)=>{const A=z.title||z.name||"",G=U.title||U.name||"";return A.localeCompare(G)});case"newest":return D.sort((z,U)=>{const A=new Date(z.date||"1970-01-01");return new Date(U.date||"1970-01-01").getTime()-A.getTime()});case"vram-low-to-high":return D.sort((z,U)=>{const A=k(z),G=k(U);if(A===G){const q=z.title||z.name||"",Q=U.title||U.name||"";return q.localeCompare(Q)}return A===Number.POSITIVE_INFINITY?1:G===Number.POSITIVE_INFINITY?-1:A-G});case"model-size-low-to-high":return D.sort((z,U)=>{const A=typeof z.size=="number"?z.size:Number.POSITIVE_INFINITY,G=typeof U.size=="number"?U.size:Number.POSITIVE_INFINITY;return A===G?0:A-G});case"default":default:return D}}),S=b(()=>T.value),$=n(()=>{o.value="",s.value=[],l.value=[],a.value=[],i.value="newest"},"resetFilters"),_=n(D=>{s.value=s.value.filter(z=>z!==D)},"removeModelFilter"),P=n(D=>{l.value=l.value.filter(z=>z!==D)},"removeUseCaseFilter"),M=n(D=>{a.value=a.value.filter(z=>z!==D)},"removeRunsOnFilter"),L=b(()=>S.value.length),N=b(()=>r.value.length),B=Mo(()=>{},500);return J([o,s,l,a,i],()=>{(o.value.trim()!==""||s.value.length>0||l.value.length>0||a.value.length>0||i.value!=="default")&&B()},{deep:!0}),zt(s,D=>{t.set("Comfy.Templates.SelectedModels",D)},{debounce:500,deep:!0}),zt(l,D=>{t.set("Comfy.Templates.SelectedUseCases",D)},{debounce:500,deep:!0}),zt(a,D=>{t.set("Comfy.Templates.SelectedRunsOn",D)},{debounce:500,deep:!0}),zt(i,D=>{t.set("Comfy.Templates.SortBy",D)},{debounce:500}),{searchQuery:o,selectedModels:s,selectedUseCases:l,selectedRunsOn:a,sortBy:i,filteredTemplates:S,availableModels:p,availableUseCases:g,availableRunsOn:c,filteredCount:L,totalCount:N,resetFilters:$,removeModelFilter:_,removeUseCaseFilter:P,removeRunsOnFilter:M}}n(Kp,"useTemplateFiltering");function Ss(){const{t:e}=he(),t=ps(),o=eo(),s=R(null),l=R(null),a=b(()=>t.isLoaded),i=b(()=>t.groupedTemplates),r=n(async()=>(t.isLoaded||await t.loadWorkflowTemplates(),t.isLoaded),"loadTemplates"),u=n(()=>{if(i.value.length>0){const C=i.value[0].modules[0];d(C)}},"selectFirstTemplateCategory"),d=n(C=>(s.value=C,C!==null),"selectTemplateCategory"),p=n((C,m,h="1")=>{const k=m==="default"?ve.fileURL(`/templates/${C.name}`):ve.apiURL(`/workflow_templates/${m}/${C.name}`),T=m==="default"&&h?`-${h}`:"";return`${k}${T}.${C.mediaSubtype}`},"getTemplateThumbnailUrl"),g=n((C,m)=>{const h=C.title??C.name??`${m} Template`;return m==="default"?C.localizedTitle??h:h},"getTemplateTitle"),c=n(C=>(C.localizedDescription||C.description)?.replace(/[-_]/g," ").trim()??"","getTemplateDescription"),f=n(async(C,m)=>{if(!a.value)return!1;l.value=C;let h;try{if(m==="all"){const $=i.value.find(M=>M.label===e("templateWorkflows.category.ComfyUI Examples","ComfyUI Examples"))?.modules.find(M=>M.moduleName==="all")?.templates.find(M=>M.name===C);if(!$||!$.sourceModule)return!1;const _=$.sourceModule;h=await v(C,_);const P=_==="default"?e(`templateWorkflows.template.${C}`,C):C;return o.closeDialog(),await F.loadGraphData(h,!0,!0,P,{openSource:"template"}),!0}h=await v(C,m);const k=m==="default"?e(`templateWorkflows.template.${C}`,C):C;return o.closeDialog(),await F.loadGraphData(h,!0,!0,k,{openSource:"template"}),!0}catch(k){return console.error("Error loading workflow template:",k),!1}finally{l.value=null}},"loadWorkflowTemplate"),v=n(async(C,m)=>m==="default"?fetch(ve.fileURL(`/templates/${C}.json`)).then(h=>h.json()):fetch(ve.apiURL(`/workflow_templates/${m}/${C}.json`)).then(h=>h.json()),"fetchTemplateJson");return{selectedTemplate:s,loadingTemplateId:l,isTemplatesLoaded:a,allTemplateGroups:i,loadTemplates:r,selectFirstTemplateCategory:u,selectTemplateCategory:d,getTemplateThumbnailUrl:p,getTemplateTitle:g,getTemplateDescription:c,loadWorkflowTemplate:f}}n(Ss,"useTemplateWorkflows");const Yp={class:"text-neutral text-base"},Qp={class:"flex gap-2"},Zp={class:"relative flex flex-wrap justify-between gap-2 px-6 pb-4"},Xp={class:"flex flex-wrap gap-2"},Jp={key:0,class:"text-neutral px-6 pt-4 pb-2 text-2xl font-semibold"},ef={key:0,class:"flex h-64 flex-col items-center justify-center text-neutral-500"},tf={class:"mb-2 text-lg"},of={class:"text-sm"},nf={key:1},af={key:0,class:"inline-block h-8 w-48 animate-pulse rounded bg-dialog-surface"},sf={class:"relative h-full w-full overflow-hidden rounded-lg"},lf={class:"flex flex-col gap-2 pt-3"},rf=["title"],uf={class:"flex justify-between gap-2"},cf={class:"flex-1"},df=["title"],pf={key:0,class:"flex flex-col-reverse justify-center"},ff={key:0,class:"text-sm text-muted"},mf={key:3,class:"mt-6 px-6 text-sm text-muted"},vf=j({__name:"WorkflowTemplateSelectorDialog",props:{onClose:{type:Function}},setup(e){const{t}=he(),o=R(0),s=R(!1);Me(()=>{o.value=Date.now()});const l=n(()=>{e.onClose()},"onClose");Io(Oo,l);const a=ps(),{loadTemplates:i,loadWorkflowTemplate:r,getTemplateThumbnailUrl:u,getTemplateTitle:d,getTemplateDescription:p}=Ss(),g=n(oe=>oe.sourceModule||"default","getEffectiveSourceModule"),c=n(oe=>{const X=g(oe);return u(oe,X,X==="default"?"1":"")},"getBaseThumbnailSrc"),f=n(oe=>{const X=g(oe);return u(oe,X,X==="default"?"2":"")},"getOverlayThumbnailSrc"),v=n(oe=>{oe.tutorialUrl&&window.open(oe.tutorialUrl,"_blank")},"openTutorial"),C=b(()=>Re.value?[{id:"skeleton-all",label:"All Templates",icon:"icon-[lucide--layout-grid]"},{id:"skeleton-basics",label:"Basics",icon:"icon-[lucide--graduation-cap]"},{title:"Generation Type",items:[{id:"skeleton-1",label:"...",icon:"icon-[lucide--loader-2]"},{id:"skeleton-2",label:"...",icon:"icon-[lucide--loader-2]"}]},{title:"Closed Source Models",items:[{id:"skeleton-3",label:"...",icon:"icon-[lucide--loader-2]"}]}]:a.navGroupedTemplates),m=b(()=>Dn()),h=b(()=>a.enhancedTemplates),k=b(()=>ne.value?a.filterTemplatesByCategory(ne.value):h.value),{searchQuery:T,selectedModels:S,selectedUseCases:$,selectedRunsOn:_,sortBy:P,filteredTemplates:M,availableModels:L,availableUseCases:N,availableRunsOn:B,filteredCount:D,totalCount:z,resetFilters:U}=Kp(k),A=b({get(){return S.value.map(oe=>({name:oe,value:oe}))},set(oe){S.value=oe.map(X=>X.value)}}),G=b({get(){return $.value.map(oe=>({name:oe,value:oe}))},set(oe){$.value=oe.map(X=>X.value)}}),q=b({get(){return _.value.map(oe=>({name:oe,value:oe}))},set(oe){_.value=oe.map(X=>X.value)}}),Q=R(null),Y=R(null),te=R([]),fe=R(0),ne=R("all"),Se=R(""),Ve=b(()=>L.value.map(oe=>({name:oe,value:oe}))),He=b(()=>N.value.map(oe=>({name:oe,value:oe}))),je=b(()=>B.value.map(oe=>({name:oe,value:oe}))),qe=b(()=>A.value.length===0?t("templateWorkflows.modelFilter","Model Filter"):A.value.length===1?A.value[0].name:t("templateWorkflows.modelsSelected",{count:A.value.length})),We=b(()=>G.value.length===0?t("templateWorkflows.useCaseFilter","Use Case"):G.value.length===1?G.value[0].name:t("templateWorkflows.useCasesSelected",{count:G.value.length})),Be=b(()=>q.value.length===0?t("templateWorkflows.runsOnFilter","Runs On"):q.value.length===1?q.value[0].name:t("templateWorkflows.runsOnSelected",{count:q.value.length})),Vt=b(()=>[{name:t("templateWorkflows.sort.newest","Newest"),value:"newest"},{name:t("templateWorkflows.sort.default","Default"),value:"default"},{name:t("templateWorkflows.sort.vramLowToHigh","VRAM Usage (Low to High)"),value:"vram-low-to-high"},{name:t("templateWorkflows.sort.modelSizeLowToHigh","Model Size (Low to High)"),value:"model-size-low-to-high"},{name:t("templateWorkflows.sort.alphabetical","Alphabetical (A-Z)"),value:"alphabetical"}]),kt=R(null),xt=b(()=>!T.value.trim()),{paginatedItems:mt,isLoading:Je,hasMoreItems:no,loadNextPage:zo,reset:Uo}=qp(M,{itemsPerPage:24}),se=b(()=>xt.value?mt.value:M.value);Wl(kt,()=>{xt.value&&no.value&&!Je.value&&zo()}),J([T,ne,P,S,$,_],()=>{Uo(),Q.value=null,fe.value++});const de=n(async oe=>{Q.value=oe.name;try{await r(oe.name,g(oe)),s.value=!0,l()}finally{Q.value=null}},"onLoadWorkflow"),Ce=b(()=>{const oe=C.value.find(X=>"id"in X?X.id===ne.value:X.items?.some(Fo=>Fo.id===ne.value));return oe?"id"in oe?oe.label:oe.items?.find(X=>X.id===ne.value)?.label||t("templateWorkflows.allTemplates","All Templates"):t("templateWorkflows.allTemplates","All Templates")}),{isLoading:Re}=Na(async()=>(await Promise.all([i(),a.loadWorkflowTemplates()]),!0),!1,{immediate:!0});return dt(()=>{te.value=[]}),(oe,X)=>{const Fo=Te("tooltip");return y(),O(Mn,{"content-title":oe.$t("templateWorkflows.title","Workflow Templates"),class:"workflow-template-selector-dialog"},{leftPanel:W(()=>[E(Rn,{modelValue:ne.value,"onUpdate:modelValue":X[0]||(X[0]=ee=>ne.value=ee),"nav-items":C.value},{"header-icon":W(()=>X[8]||(X[8]=[x("i",{class:"icon-[comfy--template]"},null,-1)])),"header-title":W(()=>[x("span",Yp,H(oe.$t("sideToolbar.templates","Templates")),1)]),_:1},8,["modelValue","nav-items"])]),header:W(()=>[E(Do,{modelValue:w(T),"onUpdate:modelValue":X[1]||(X[1]=ee=>Yt(T)?T.value=ee:null),size:"lg",class:"max-w-[384px]"},null,8,["modelValue"])]),"header-right-area":W(()=>[x("div",Qp,[w(D)!==w(z)?(y(),O(Gt,{key:0,type:"secondary",label:oe.$t("templateWorkflows.resetFilters","Clear Filters"),onClick:w(U)},{icon:W(()=>X[9]||(X[9]=[x("i",{class:"icon-[lucide--filter-x]"},null,-1)])),_:1},8,["label","onClick"])):V("",!0)])]),contentFilter:W(()=>[x("div",Zp,[x("div",Xp,[E(yt,{modelValue:A.value,"onUpdate:modelValue":X[2]||(X[2]=ee=>A.value=ee),"search-query":Se.value,"onUpdate:searchQuery":X[3]||(X[3]=ee=>Se.value=ee),class:"w-[250px]",label:qe.value,options:Ve.value,"show-search-box":!0,"show-selected-count":!0,"show-clear-button":!0},{icon:W(()=>X[10]||(X[10]=[x("i",{class:"icon-[lucide--cpu]"},null,-1)])),_:1},8,["modelValue","search-query","label","options"]),E(yt,{modelValue:G.value,"onUpdate:modelValue":X[4]||(X[4]=ee=>G.value=ee),label:We.value,options:He.value,"show-search-box":!0,"show-selected-count":!0,"show-clear-button":!0},{icon:W(()=>X[11]||(X[11]=[x("i",{class:"icon-[lucide--target]"},null,-1)])),_:1},8,["modelValue","label","options"]),E(yt,{modelValue:q.value,"onUpdate:modelValue":X[5]||(X[5]=ee=>q.value=ee),label:Be.value,options:je.value,"show-search-box":!0,"show-selected-count":!0,"show-clear-button":!0},{icon:W(()=>X[12]||(X[12]=[x("i",{class:"icon-[lucide--server]"},null,-1)])),_:1},8,["modelValue","label","options"])]),x("div",null,[E(Pn,{modelValue:w(P),"onUpdate:modelValue":X[6]||(X[6]=ee=>Yt(P)?P.value=ee:null),label:oe.$t("templateWorkflows.sorting","Sort by"),options:Vt.value,class:"w-62.5"},{icon:W(()=>X[13]||(X[13]=[x("i",{class:"icon-[lucide--arrow-up-down]"},null,-1)])),_:1},8,["modelValue","label","options"])])]),w(Re)?V("",!0):(y(),I("div",Jp,[x("span",null,H(Ce.value),1)]))]),content:W(()=>[!w(Re)&&w(M).length===0?(y(),I("div",ef,[X[14]||(X[14]=x("i",{class:"mb-4 icon-[lucide--search] h-12 w-12 opacity-50"},null,-1)),x("p",tf,H(oe.$t("templateWorkflows.noResults","No templates found")),1),x("p",of,H(oe.$t("templateWorkflows.noResultsHint","Try adjusting your search or filters")),1)])):(y(),I("div",nf,[w(Re)?(y(),I("span",af)):V("",!0),(y(),I("div",{key:fe.value,style:me(m.value),"data-testid":"template-workflows-content"},[(y(!0),I(ue,null,$e(w(Re)?12:0,ee=>(y(),O(vo,{key:`initial-skeleton-${ee}`,size:"compact",variant:"ghost",rounded:"lg",class:"hover:bg-base-background"},{top:W(()=>[E(go,{ratio:"landscape"},{default:W(()=>X[15]||(X[15]=[x("div",{class:"h-full w-full animate-pulse bg-dialog-surface"},null,-1)])),_:1})]),bottom:W(()=>[E(ho,null,{default:W(()=>X[16]||(X[16]=[x("div",{class:"px-4 py-3"},[x("div",{class:"mb-2 h-6 animate-pulse rounded bg-dialog-surface"}),x("div",{class:"h-4 animate-pulse rounded bg-dialog-surface"})],-1)])),_:1})]),_:2},1024))),128)),(y(!0),I(ue,null,$e(w(Re)?[]:se.value,ee=>(y(),O(vo,{key:ee.name,ref_for:!0,ref_key:"cardRefs",ref:te,size:"compact",variant:"ghost",rounded:"lg","data-testid":`template-workflow-${ee.name}`,class:"hover:bg-base-background",onMouseenter:n($t=>Y.value=ee.name,"onMouseenter"),onMouseleave:X[7]||(X[7]=$t=>Y.value=null),onClick:n($t=>de(ee),"onClick")},{top:W(()=>[E(go,{ratio:"square"},{default:W(()=>[x("div",sf,[ee.mediaType==="audio"?(y(),O(Op,{key:0,src:c(ee)},null,8,["src"])):ee.thumbnailVariant==="compareSlider"?(y(),O(zp,{key:1,"base-image-src":c(ee),"overlay-image-src":f(ee),alt:w(d)(ee,g(ee)),"is-hovered":Y.value===ee.name,"is-video":ee.mediaType==="video"||ee.mediaSubtype==="webp"},null,8,["base-image-src","overlay-image-src","alt","is-hovered","is-video"])):ee.thumbnailVariant==="hoverDissolve"?(y(),O(jp,{key:2,"base-image-src":c(ee),"overlay-image-src":f(ee),alt:w(d)(ee,g(ee)),"is-hovered":Y.value===ee.name,"is-video":ee.mediaType==="video"||ee.mediaSubtype==="webp"},null,8,["base-image-src","overlay-image-src","alt","is-hovered","is-video"])):(y(),O(Up,{key:3,src:c(ee),alt:w(d)(ee,g(ee)),"is-hovered":Y.value===ee.name,"is-video":ee.mediaType==="video"||ee.mediaSubtype==="webp","hover-zoom":ee.thumbnailVariant==="zoomHover"?16:5},null,8,["src","alt","is-hovered","is-video","hover-zoom"])),Q.value===ee.name?(y(),O(w(bl),{key:4,class:"absolute inset-0 z-10 m-auto h-12 w-12"})):V("",!0)])]),"bottom-right":W(()=>[ee.tags&&ee.tags.length>0?(y(!0),I(ue,{key:0},$e(ee.tags,$t=>(y(),O(yo,{key:$t,label:$t},null,8,["label"]))),128)):V("",!0)]),_:2},1024)]),bottom:W(()=>[E(ho,null,{default:W(()=>[x("div",lf,[x("h3",{class:"m-0 line-clamp-1 text-sm",title:w(d)(ee,g(ee))},H(w(d)(ee,g(ee))),9,rf),x("div",uf,[x("div",cf,[x("p",{class:"m-0 line-clamp-2 text-sm text-muted",title:w(p)(ee)},H(w(p)(ee)),9,df)]),ee.tutorialUrl?(y(),I("div",pf,[Y.value===ee.name?pe((y(),O(Nt,nt({key:0,ref_for:!0},oe.$attrs,{type:"primary",size:"sm",onClick:Ee($t=>v(ee),["stop"])}),{default:W(()=>X[17]||(X[17]=[x("i",{class:"icon-[lucide--info] size-4"},null,-1)])),_:2},1040,["onClick"])),[[Fo,oe.$t("g.seeTutorial"),void 0,{bottom:!0}]]):V("",!0)])):V("",!0)])])]),_:2},1024)]),_:2},1032,["data-testid","onMouseenter","onClick"]))),128)),(y(!0),I(ue,null,$e(w(Je)?6:0,ee=>(y(),O(vo,{key:`skeleton-${ee}`,size:"compact",variant:"ghost",rounded:"lg",class:"hover:bg-base-background"},{top:W(()=>[E(go,{ratio:"square"},{default:W(()=>X[18]||(X[18]=[x("div",{class:"h-full w-full animate-pulse bg-dialog-surface"},null,-1)])),_:1})]),bottom:W(()=>[E(ho,null,{default:W(()=>X[19]||(X[19]=[x("div",{class:"px-4 py-3"},[x("div",{class:"mb-2 h-6 animate-pulse rounded bg-dialog-surface"}),x("div",{class:"h-4 animate-pulse rounded bg-dialog-surface"})],-1)])),_:1})]),_:2},1024))),128))],4))])),!w(Re)&&w(no)?(y(),I("div",{key:2,ref_key:"loadTrigger",ref:kt,class:"mt-4 flex h-4 w-full items-center justify-center"},[w(Je)?(y(),I("div",ff,H(oe.$t("templateWorkflows.loadingMore","Loading more...")),1)):V("",!0)],512)):V("",!0),w(Re)?V("",!0):(y(),I("div",mf,H(oe.$t("templateWorkflows.resultsCount",{count:w(D),total:w(z)})),1))]),_:1},8,["content-title"])}}}),ca="global-workflow-template-selector",Wn=n(()=>{const e=pt(),t=eo();function o(){t.closeDialog({key:ca})}n(o,"hide");function s(l="command"){e.showLayoutDialog({key:ca,component:vf,props:{onClose:o},dialogComponentProps:{pt:{content:{class:"!px-0 overflow-hidden h-full !py-0"},root:{style:"width: 90vw; height: 85vh; max-width: 1400px; display: flex;"}}}})}return n(s,"show"),{show:s,hide:o}},"useWorkflowTemplateSelectorDialog"),cn=n((e,t,o=30)=>{const s=e instanceof HTMLElement?e:e.target;let l=0;const a=setInterval(()=>{t(l++)},o),i=n(()=>{clearInterval(a),r(),u()},"dispose"),r=xe(document,"mouseup",i),u=xe(s,"mouseup",i);return{dispose:i}},"whileMouseDown"),gf={class:"flex h-8 w-8 items-center justify-center rounded-lg bg-black"},hf=["href","onMousedown","onClick"],yf={class:"p-menubar-item-label text-nowrap"},bf={key:3,class:"keybinding-tag ml-auto rounded border border-surface p-1 text-xs text-nowrap text-muted"},wf={key:4,class:"pi pi-angle-right ml-auto"},Cf={class:"p-menubar-item-label text-nowrap"},Sf=j({__name:"ComfyMenuButton",setup(e){const{t}=he(),o=be(),s=qa(),l=Xe(),a=Ka(),i=eo(),r=it(),u=Z(),d=R(null),p=R(null),g=b({get:n(()=>u.get("Comfy.VueNodes.Enabled")??!1,"get"),set:n(async N=>{await u.set("Comfy.VueNodes.Enabled",N)},"set")});function c(N){d.value?.toggle(N)}n(c,"onLogoMenuClick");const f=n(N=>{const B=typeof N.label=="function"?N.label():N.label,D=B?t(`menuLabels.${Ae(B)}`,B):void 0;return{...N,label:D,items:N.items?.map(f)}},"translateMenuItem"),v=n(N=>{i.showDialog({key:"global-settings",headerComponent:xi,component:$i,props:{defaultPanel:N}})},"showSettings"),C=n(async()=>{await r.openManager({initialTab:qt.All,showToastOnLegacyError:!1})},"showManageExtensions"),m=b(()=>l.palettes.map(N=>({key:`theme-${N.id}`,label:N.name,parentPath:"theme",comfyCommand:{active:n(()=>l.activePaletteId===N.id,"active")},command:n(async()=>{await a.loadColorPalette(N.id)},"command")}))),h=b(()=>[{separator:!0},{key:"theme",label:t("menu.theme"),items:m.value},{key:"nodes-2.0-toggle",label:"Nodes 2.0"},{separator:!0},{key:"browse-templates",label:t("menuLabels.Browse Templates"),icon:"icon-[comfy--template]",command:n(()=>Wn().show("menu"),"command")},{key:"settings",label:t("g.settings"),icon:"mdi mdi-cog-outline",command:n(()=>{v()},"command")},{key:"manage-extensions",label:t("menu.manageExtensions"),icon:"mdi mdi-puzzle-outline",command:C}]),k=b(()=>{const N=s.menuItems.map(f);let B=N.findIndex(z=>z.key==="Help"),D;if(B!==-1){N[B].icon="mdi mdi-help-circle-outline";const z=B!==N.length-1;D=N.splice(B,1,...z?[{separator:!0}]:[])[0]}return B=N.length,N.splice(B,0,...h.value,...D?[{separator:!0},D]:[]),N}),T=n(()=>{De(()=>{d.value&&(d.value.dirty=!0)})},"onMenuShow"),S=n(N=>N.comfyCommand?.id==="Comfy.Canvas.ZoomIn"||N.comfyCommand?.id==="Comfy.Canvas.ZoomOut","isZoomCommand"),$=n((N,B)=>{N.comfyCommand&&cn(B,async()=>{await o.execute(N.comfyCommand.id)},50)},"handleZoomMouseDown"),_=n((N,B)=>{if(S(N)||N.comfyCommand?.active)return B.preventDefault(),B.stopPropagation(),N.comfyCommand?.active&&N.command?.({item:N,originalEvent:B}),!1},"handleItemClick"),P=n(N=>N.parentPath&&(N.parentPath==="theme"||s.menuItemHasActiveStateChildren[N.parentPath]),"hasActiveStateSiblings"),M=n(()=>!1,"handleNodes2ToggleClick"),L=n(async N=>{await u.set("Comfy.VueNodes.Enabled",N)},"onNodes2ToggleChange");return(N,B)=>{const D=Te("tooltip");return y(),I(ue,null,[pe((y(),I("div",{ref_key:"menuButtonRef",ref:p,class:K(["comfy-menu-button-wrapper flex shrink-0 cursor-pointer flex-col items-center justify-center p-2 transition-colors",{"comfy-menu-button-active":d.value?.visible}]),onClick:B[0]||(B[0]=z=>c(z))},[x("div",gf,[E(Dp,{alt:"ComfyUI Logo",class:"comfyui-logo h-[18px] w-[18px] text-white",mode:"fill"})])],2)),[[D,{value:w(t)("sideToolbar.labels.menu"),showDelay:300,hideDelay:300}]]),E(w(Ll),{ref_key:"menuRef",ref:d,model:k.value,popup:!0,class:"comfy-command-menu",onShow:T},{item:W(({item:z,props:U})=>[z.key!=="nodes-2.0-toggle"?(y(),I("a",nt({key:0,class:"p-menubar-item-link px-4 py-2"},U.action,{href:z.url,target:"_blank",class:typeof z.class=="function"?z.class():z.class,onMousedown:n(A=>S(z)?$(z,A):void 0,"onMousedown"),onClick:n(A=>_(z,A),"onClick")}),[P(z)?(y(),I("i",{key:0,class:K(["p-menubar-item-icon pi pi-check text-sm",{invisible:!z.comfyCommand?.active?.()}])},null,2)):z.icon&&z.comfyCommand?.id!=="Comfy.NewBlankWorkflow"?(y(),I("span",{key:1,class:K(["p-menubar-item-icon text-sm",z.icon])},null,2)):V("",!0),x("span",yf,H(z.label),1),z.comfyCommand?.id==="Comfy.NewBlankWorkflow"?(y(),I("i",{key:2,class:K(["ml-auto",z.icon])},null,2)):V("",!0),z?.comfyCommand?.keybinding?(y(),I("span",bf,H(z.comfyCommand.keybinding.combo.toString()),1)):V("",!0),z.items?(y(),I("i",wf)):V("",!0)],16,hf)):(y(),I("div",{key:1,class:"flex items-center justify-between px-4 py-2",onClick:Ee(M,["stop"])},[x("span",Cf,H(z.label),1),E(w(Nl),{modelValue:g.value,"onUpdate:modelValue":[B[1]||(B[1]=A=>g.value=A),L],class:"ml-4","aria-label":z.label,pt:{root:{style:{width:"38px",height:"20px"}},handle:{style:{width:"16px",height:"16px"}}},onClick:B[2]||(B[2]=Ee(()=>{},["stop"]))},null,8,["modelValue","aria-label"])]))]),_:1},8,["model"])],64)}}}),kf=we(Sf,[["__scopeId","data-v-93991bcb"]]),xf={viewBox:"0 0 256 256",width:"1.2em",height:"1.2em"};function $f(e,t){return y(),I("svg",xf,t[0]||(t[0]=[x("path",{fill:"currentColor",d:"m120 137l-72 64a12 12 0 1 1-16-18l61.91-55L32 73a12 12 0 1 1 16-18l72 64a12 12 0 0 1 0 18m96 43h-96a12 12 0 0 0 0 24h96a12 12 0 0 0 0-24"},null,-1)]))}n($f,"render$1");const _f=ka({name:"ph-terminal-bold",render:$f}),Tf={class:"side-bar-button-content"},Nf={key:0,class:"side-bar-button-label"},If=j({__name:"SidebarIcon",props:{icon:{default:""},selected:{type:Boolean,default:!1},tooltip:{default:""},tooltipSuffix:{default:""},iconBadge:{type:[String,Function],default:""},label:{default:""},isSmall:{type:Boolean,default:!1}},emits:["click"],setup(e,{emit:t}){const{t:o}=he(),s=t,l=b(()=>typeof e.iconBadge=="function"?e.iconBadge()??"":e.iconBadge),a=b(()=>!!l.value),i=b(()=>o(e.tooltip)+e.tooltipSuffix);return(r,u)=>{const d=Te("tooltip");return pe((y(),O(w(ie),{text:"",pt:{root:{class:`side-bar-button p-button-secondary ${r.selected?"side-bar-button-selected":""}`,"aria-label":i.value}},onClick:u[0]||(u[0]=p=>s("click",p))},{icon:W(()=>[x("div",Tf,[Ne(r.$slots,"icon",{},()=>[a.value?(y(),O(w(Ol),{key:0,value:l.value},{default:W(()=>[typeof r.icon=="string"?(y(),I("i",{key:0,class:K(r.icon+" side-bar-button-icon")},null,2)):(y(),O(Mt(r.icon),{key:1,class:"side-bar-button-icon"}))]),_:1},8,["value"])):typeof r.icon=="string"?(y(),I("i",{key:1,class:K(r.icon+" side-bar-button-icon")},null,2)):typeof r.icon=="object"?(y(),O(Mt(r.icon),{key:2,class:"side-bar-button-icon"})):V("",!0)],!0),r.label&&!r.isSmall?(y(),I("span",Nf,H(w(o)(r.label)),1)):V("",!0)])]),_:3},8,["pt"])),[[d,{value:i.value,showDelay:300,hideDelay:300}]])}}}),Et=we(If,[["__scopeId","data-v-c90a38ba"]]),Mf=j({__name:"SidebarBottomPanelToggleButton",setup(e){const t=At(),o=n(()=>{t.toggleBottomPanel()},"toggleConsole");return(s,l)=>{const a=_f;return y(),O(Et,{label:s.$t("sideToolbar.labels.console"),tooltip:s.$t("menu.toggleBottomPanel"),selected:w(t).activePanel=="terminal",onClick:o},{icon:W(()=>[E(a)]),_:1},8,["label","tooltip","selected"])}}}),Rf=j({__name:"SidebarShortcutsToggleButton",setup(e){const{t}=he(),o=At(),s=be(),l=s.getCommand("Workspace.ToggleBottomPanel.Shortcuts"),{formatKeySequence:a}=s,i=b(()=>o.activePanel==="shortcuts"),r=b(()=>`${t("shortcuts.keyboardShortcuts")} (${a(l)})`),u=n(()=>{o.togglePanel("shortcuts")},"toggleShortcutsPanel");return(d,p)=>(y(),O(Et,{label:d.$t("shortcuts.shortcuts"),tooltip:r.value,selected:i.value,onClick:u},{icon:W(()=>p[0]||(p[0]=[x("i",{class:"icon-[lucide--keyboard]"},null,-1)])),_:1},8,["label","tooltip","selected"]))}}),Pf=["width","height"],Df={"clip-path":"url(#clip0_1099_16244)"},Af=["stroke"],Lf=j({__name:"PuzzleIcon",props:{size:{default:16},color:{default:"currentColor"},class:{}},setup(e){const t=b(()=>e.class||"");return(o,s)=>(y(),I("svg",{xmlns:"http://www.w3.org/2000/svg",width:o.size,height:o.size,viewBox:"0 0 16 16",fill:"none",class:K(t.value)},[x("g",Df,[x("path",{d:"M4.99992 3.00016C4.99992 2.07969 5.74611 1.3335 6.66658 1.3335C7.58706 1.3335 8.33325 2.07969 8.33325 3.00016V4.00016H8.99992C9.9318 4.00016 10.3977 4.00016 10.7653 4.1524C11.2553 4.35539 11.6447 4.74474 11.8477 5.2348C11.9999 5.60234 11.9999 6.06828 11.9999 7.00016H12.9999C13.9204 7.00016 14.6666 7.74635 14.6666 8.66683C14.6666 9.5873 13.9204 10.3335 12.9999 10.3335H11.9999V11.4668C11.9999 12.5869 11.9999 13.147 11.7819 13.5748C11.5902 13.9511 11.2842 14.2571 10.9079 14.4488C10.4801 14.6668 9.92002 14.6668 8.79992 14.6668H8.33325V13.5002C8.33325 12.6717 7.66168 12.0002 6.83325 12.0002C6.00482 12.0002 5.33325 12.6717 5.33325 13.5002V14.6668H4.53325C3.41315 14.6668 2.85309 14.6668 2.42527 14.4488C2.04895 14.2571 1.74299 13.9511 1.55124 13.5748C1.33325 13.147 1.33325 12.5869 1.33325 11.4668V10.3335H2.33325C3.25373 10.3335 3.99992 9.5873 3.99992 8.66683C3.99992 7.74635 3.25373 7.00016 2.33325 7.00016H1.33325C1.33325 6.06828 1.33325 5.60234 1.48549 5.2348C1.68848 4.74474 2.07783 4.35539 2.56789 4.1524C2.93543 4.00016 3.40137 4.00016 4.33325 4.00016H4.99992V3.00016Z",stroke:o.color,"stroke-width":"1.2","stroke-linecap":"round","stroke-linejoin":"round"},null,8,Af)]),s[0]||(s[0]=x("defs",null,[x("clipPath",{id:"clip0_1099_16244"},[x("rect",{width:"16",height:"16",fill:"white"})])],-1))],10,Pf))}}),da=Pa.create({baseURL:Ya(),headers:{"Content-Type":"application/json"}}),Ef=n(()=>{const e=R(!1),t=R(null);J(()=>Ya(),a=>{da.defaults.baseURL=a});const o=n((a,i,r)=>{if(!Pa.isAxiosError(a))return a instanceof Error?`${i}: ${a.message}`:`${i}: Unknown error occurred`;const u=a;if(u.response){const{status:d,data:p}=u.response;if(r&&r[d])return r[d];switch(d){case 400:return`Bad request: ${p?.message||"Invalid input"}`;case 401:return"Unauthorized: Authentication required";case 403:return`Forbidden: ${p?.message||"Access denied"}`;case 404:return`Not found: ${p?.message||"Resource not found"}`;case 500:return`Server error: ${p?.message||"Internal server error"}`;default:return`${i}: ${p?.message||u.message}`}}return`${i}: ${u.message}`},"handleApiError"),s=n(async(a,i,r)=>{e.value=!0,t.value=null;try{return(await a()).data}catch(u){return _i(u)||(t.value=o(u,i,r)),null}finally{e.value=!1}},"executeApiRequest");return{isLoading:e,error:t,getReleases:n(async(a,i)=>{const r="/releases";return await s(()=>da.get(r,{params:a,signal:i}),"Failed to get releases",{400:"Invalid project or version parameter"})},"getReleases")}},"useReleaseService"),oo=St("release",()=>{const e=R([]),t=R(!1),o=R(null),s=Ef(),l=Qa(),a=Z(),i=b(()=>l?.systemStats?.system?.comfyui_version??""),r=b(()=>a.get("Comfy.Locale")),u=b(()=>a.get("Comfy.Release.Version")),d=b(()=>a.get("Comfy.Release.Status")),p=b(()=>a.get("Comfy.Release.Timestamp")),g=b(()=>a.get("Comfy.Notification.ShowVersionUpdates")),c=b(()=>e.value[0]??null),f=b(()=>e.value.slice(0,3)),v=3*24*60*60*1e3,C=b(()=>!!c.value&&Ft.compare(c.value.version,i.value||"0.0.0")>0),m=b(()=>!!c.value&&Ft.compare(c.value.version,i.value||"0.0.0")===0),h=b(()=>{const N=c.value?.attention;return N==="medium"||N==="high"}),k=b(()=>!(!Oe()||It||!g.value||!C.value||!h.value||u.value===c.value?.version&&["skipped","changelog seen"].includes(d.value))),T=b(()=>{if(!Oe()||It||!g.value||!C.value)return!1;const{version:N}=c.value;return u.value===N&&d.value==="changelog seen"?!1:h.value?!0:!(u.value===N&&d.value==="skipped"&&p.value&&Date.now()-p.value>=v)}),S=b(()=>!(!Oe()||It||!g.value||!m.value||u.value===c.value.version&&d.value==="what's new seen"));async function $(N){N!==c.value?.version||d.value==="changelog seen"||(await a.set("Comfy.Release.Version",N),await a.set("Comfy.Release.Status","skipped"),await a.set("Comfy.Release.Timestamp",Date.now()))}n($,"handleSkipRelease");async function _(N){N===c.value?.version&&(await a.set("Comfy.Release.Version",N),await a.set("Comfy.Release.Status","changelog seen"),await a.set("Comfy.Release.Timestamp",Date.now()))}n(_,"handleShowChangelog");async function P(N){N===c.value?.version&&(await a.set("Comfy.Release.Version",N),await a.set("Comfy.Release.Status","what's new seen"),await a.set("Comfy.Release.Timestamp",Date.now()))}n(P,"handleWhatsNewSeen");async function M(){if(!t.value&&g.value&&!l.systemStats?.system?.argv?.includes("--disable-api-nodes")){t.value=!0,o.value=null;try{l.systemStats||await Da(l.isInitialized);const N=await s.getReleases({project:"comfyui",current_version:i.value,form_factor:l.getFormFactor(),locale:Ti(r.value)});N!==null?e.value=N:s.error.value&&(o.value=s.error.value)}catch(N){o.value=N instanceof Error?N.message:"Unknown error occurred"}finally{t.value=!1}}}n(M,"fetchReleases");async function L(){await M()}return n(L,"initialize"),{releases:e,isLoading:t,error:o,recentRelease:c,recentReleases:f,shouldShowToast:k,shouldShowRedDot:T,shouldShowPopup:S,shouldShowUpdateButton:C,handleSkipRelease:$,handleShowChangelog:_,handleWhatsNewSeen:P,fetchReleases:M,initialize:L}}),Vf=Object.freeze(Object.defineProperty({__proto__:null,useReleaseStore:oo},Symbol.toStringTag,{value:"Module"})),Wf=["aria-label"],Of={class:"help-menu-section",role:"menubar"},Bf=["onClick","onMouseenter","onMouseleave"],zf={class:"help-menu-icon-container"},Uf={class:"help-menu-icon"},Ff={key:0,class:"menu-red-dot"},Gf={class:"menu-label"},Hf={key:0,class:"pi pi-chevron-right"},jf={key:0,class:"submenu-divider"},qf=["onClick"],Kf={class:"menu-label"},Yf={key:0,class:"whats-new-section"},Qf={class:"section-description"},Zf=["aria-label"],Xf=["onClick","onKeydown"],Jf={class:"release-content"},em={class:"release-title"},tm=["datetime"],om={class:"normal-state"},nm={class:"hover-state"},am={key:1,class:"help-menu-item",role:"status","aria-live":"polite"},sm={key:2,class:"help-menu-item",role:"status"},im=j({__name:"HelpCenterMenuContent",emits:["close"],setup(e,{emit:t}){const o={MINUTE:6e4,HOUR:36e5,DAY:864e5,WEEK:6048e5,MONTH:2592e6,YEAR:31536e6},s={DELAY_MS:100,OFFSET_PX:8,Z_INDEX:10001},{t:l}=he(),{staticUrls:a,buildDocsUrl:i}=Lt(),r=oo(),u=be(),d=Z(),p=t,g=R(!1),c=R(null),f=R({});let v=null;const C=R(Date.now()),m=b(()=>r.releases.length>0),h=b(()=>d.get("Comfy.Notification.ShowVersionUpdates")),{shouldShowRedDot:k}=Za(),T=b(()=>[{key:"desktop-guide",type:"item",label:l("helpCenter.desktopUserGuide"),visible:Oe(),action:n(()=>{P(i("/installation/desktop",{includeLocale:!0,platform:!0})),p("close")},"action")},{key:"dev-tools",type:"item",label:l("helpCenter.openDevTools"),visible:Oe(),action:n(()=>{G(),p("close")},"action")},{key:"divider-1",type:"divider",visible:Oe()},{key:"reinstall",type:"item",label:l("helpCenter.reinstall"),visible:Oe(),action:n(()=>{q(),p("close")},"action")}].filter(fe=>fe.visible!==!1)),S=b(()=>!!T.value.length),$=b(()=>_.value.find(te=>te.key==="more")),_=b(()=>{const te=[{key:"docs",type:"item",icon:"pi pi-book",label:l("helpCenter.docs"),action:n(()=>{P(i("/",{includeLocale:!0})),p("close")},"action")},{key:"discord",type:"item",icon:"pi pi-discord",label:"Discord",action:n(()=>{P(a.discord),p("close")},"action")},{key:"github",type:"item",icon:"pi pi-github",label:l("helpCenter.github"),action:n(()=>{P(a.github),p("close")},"action")},{key:"help",type:"item",icon:"pi pi-question-circle",label:l("helpCenter.helpFeedback"),action:n(()=>{u.execute("Comfy.ContactSupport"),p("close")},"action")}];return te.push({key:"manager",type:"item",icon:Lf,label:l("helpCenter.managerExtension"),showRedDot:k.value,action:n(async()=>{await it().openManager({initialTab:qt.All,showToastOnLegacyError:!1}),p("close")},"action")}),te.push({key:"more",type:"item",icon:"",label:l("helpCenter.more"),visible:S.value,action:n(()=>{},"action"),items:T.value}),te}),P=n(te=>{window.open(te,"_blank","noopener,noreferrer")},"openExternalLink"),M=n(()=>{v&&(clearTimeout(v),v=null)},"clearHoverTimeout"),L=n(te=>{const fe=te.getBoundingClientRect(),ne=210,Ve=($.value?.items?.filter(Vt=>Vt.visible!==!1).length||0)*48+16,He=c.value?.offsetHeight||Ve,je=window.innerWidth,qe=window.innerHeight;let We=fe.top,Be=fe.right+s.OFFSET_PX;return Be+ne>je&&(Be=fe.left-ne-s.OFFSET_PX),We+He>qe&&(We=Math.max(s.OFFSET_PX,fe.bottom-He)),We<s.OFFSET_PX&&(We=s.OFFSET_PX),We-=8,{position:"fixed",top:`${We}px`,left:`${Be}px`,zIndex:s.Z_INDEX}},"calculateSubmenuPosition"),N=n(te=>{if(!te)return"date";const fe=new Date(te),Se=Math.abs(new Date().getTime()-fe.getTime()),Ve=[{unit:o.YEAR,suffix:"y"},{unit:o.MONTH,suffix:"mo"},{unit:o.WEEK,suffix:"w"},{unit:o.DAY,suffix:"d"},{unit:o.HOUR,suffix:"h"},{unit:o.MINUTE,suffix:"min"}];for(const{unit:He,suffix:je}of Ve){const qe=Math.floor(Se/He);if(qe>0)return`${qe}${je} ago`}return"now"},"formatReleaseDate"),B=n(te=>r.shouldShowUpdateButton&&te===r.recentReleases[0],"shouldShowUpdateButton"),D=n(async(te,fe)=>{if(te!=="more"||!$.value?.items||!$.value.items.some(Ve=>Ve.visible!==!1))return;M();const Se=fe.currentTarget;f.value=L(Se),g.value=!0,await De(),c.value&&(f.value=L(Se))},"onMenuItemHover"),z=n(te=>{te==="more"&&(v=window.setTimeout(()=>{g.value=!1},s.DELAY_MS))},"onMenuItemLeave"),U=n(()=>{M()},"onSubmenuHover"),A=n(()=>{g.value=!1},"onSubmenuLeave"),G=n(()=>{Oe()&&Kt().openDevTools()},"openDevTools"),q=n(()=>{Oe()&&Kt().reinstall()},"onReinstall"),Q=n(te=>{r.handleShowChangelog(te.version);const fe=Tn(te.version),ne=`${i("/changelog",{includeLocale:!0})}#${fe}`;P(ne),p("close")},"onReleaseClick"),Y=n(te=>{P(i("/installation/update_comfyui",{includeLocale:!0})),p("close")},"onUpdate");return Me(async()=>{m.value||await r.fetchReleases()}),dt(()=>{Math.round((Date.now()-C.value)/1e3)}),(te,fe)=>(y(),I("div",{class:"help-center-menu",role:"menu","aria-label":te.$t("helpCenter.helpFeedback")},[x("nav",Of,[(y(!0),I(ue,null,$e(_.value,ne=>pe((y(),I("button",{key:ne.key,type:"button",class:K(["help-menu-item",{"more-item":ne.key==="more"}]),role:"menuitem",onClick:ne.action,onMouseenter:n(Se=>D(ne.key,Se),"onMouseenter"),onMouseleave:n(Se=>z(ne.key),"onMouseleave")},[x("div",zf,[x("div",Uf,[typeof ne.icon=="object"?(y(),O(Mt(ne.icon),{key:0,size:16})):(y(),I("i",{key:1,class:K(ne.icon)},null,2))]),ne.showRedDot?(y(),I("div",Ff)):V("",!0)]),x("span",Gf,H(ne.label),1),ne.key==="more"?(y(),I("i",Hf)):V("",!0)],42,Bf)),[[Fe,ne.visible!==!1]])),128))]),(y(),O(Bt,{to:"body"},[g.value?(y(),I("div",{key:0,ref_key:"submenuRef",ref:c,class:"more-submenu",style:me(f.value),onMouseenter:U,onMouseleave:A},[(y(!0),I(ue,null,$e($.value?.items,ne=>(y(),I(ue,{key:ne.key},[ne.type==="divider"?pe((y(),I("div",jf,null,512)),[[Fe,ne.visible!==!1]]):pe((y(),I("button",{key:1,type:"button",class:"help-menu-item submenu-item",role:"menuitem",onClick:ne.action},[x("span",Kf,H(ne.label),1)],8,qf)),[[Fe,ne.visible!==!1]])],64))),128))],36)):V("",!0)])),h.value?(y(),I("section",Yf,[x("h3",Qf,H(te.$t("helpCenter.whatsNew")),1),m.value?(y(),I("div",{key:0,role:"group","aria-label":te.$t("helpCenter.recentReleases")},[(y(!0),I(ue,null,$e(w(r).recentReleases,ne=>(y(),I("article",{key:ne.id||ne.version,class:"help-menu-item release-menu-item",role:"button",tabindex:"0",onClick:n(Se=>Q(ne),"onClick"),onKeydown:[Rt(Se=>Q(ne),["enter"]),Rt(Ee(Se=>Q(ne),["prevent"]),["space"])]},[fe[0]||(fe[0]=x("i",{class:"pi pi-refresh help-menu-icon","aria-hidden":"true"},null,-1)),x("div",Jf,[x("span",em,H(te.$t("g.releaseTitle",{package:"Comfy",version:ne.version})),1),x("time",{class:"release-date",datetime:ne.published_at},[x("span",om,H(N(ne.published_at)),1),x("span",nm,H(te.$t("helpCenter.clickToLearnMore")),1)],8,tm)]),B(ne)?(y(),O(w(ie),{key:0,label:te.$t("helpCenter.updateAvailable"),size:"small",class:"update-button",onClick:Ee(Se=>Y(),["stop"])},null,8,["label","onClick"])):V("",!0)],40,Xf))),128))],8,Zf)):w(r).isLoading?(y(),I("div",am,[fe[1]||(fe[1]=x("i",{class:"pi pi-spin pi-spinner help-menu-icon","aria-hidden":"true"},null,-1)),x("span",null,H(te.$t("helpCenter.loadingReleases")),1)])):(y(),I("div",sm,[fe[2]||(fe[2]=x("i",{class:"pi pi-info-circle help-menu-icon","aria-hidden":"true"},null,-1)),x("span",null,H(te.$t("helpCenter.noRecentReleases")),1)]))])):V("",!0)],8,Wf))}}),lm=we(im,[["__scopeId","data-v-6c6651d8"]]),rm={key:0,class:"release-toast-popup"},um={class:"release-notification-toast"},cm={class:"toast-header"},dm={class:"toast-text"},pm={class:"toast-title"},fm={class:"toast-version-badge"},mm={class:"toast-actions-section"},vm={class:"actions-row"},gm={class:"left-actions"},hm=["href"],ym={class:"right-actions"},bm=j({__name:"ReleaseNotificationToast",setup(e){const{buildDocsUrl:t}=Lt(),o=oo(),s=R(!1),l=b(()=>o.recentRelease),a=b(()=>o.shouldShowToast&&!s.value),i=b(()=>{const v=t("/changelog",{includeLocale:!0});if(l.value?.version){const C=Tn(l.value.version);return`${v}#${C}`}return v});let r=null;const u=n(()=>{r&&clearTimeout(r),r=setTimeout(()=>{p()},8e3)},"startAutoHide"),d=n(()=>{r&&(clearTimeout(r),r=null)},"clearAutoHide"),p=n(()=>{s.value=!0,d()},"dismissToast"),g=n(()=>{l.value&&o.handleSkipRelease(l.value.version),p()},"handleSkip"),c=n(()=>{l.value&&o.handleShowChangelog(l.value.version),p()},"handleLearnMore"),f=n(()=>{window.open(t("/installation/update_comfyui",{includeLocale:!0}),"_blank"),p()},"handleUpdate");return J(a,v=>{v?u():d()}),Me(async()=>{o.releases.length||await o.fetchReleases()}),(v,C)=>a.value?(y(),I("div",rm,[x("div",um,[x("div",cm,[C[0]||(C[0]=x("div",{class:"toast-icon"},[x("i",{class:"pi pi-download"})],-1)),x("div",dm,[x("div",pm,H(v.$t("releaseToast.newVersionAvailable")),1),x("div",fm,H(l.value?.version),1)])]),x("div",mm,[x("div",vm,[x("div",gm,[x("a",{class:"learn-more-link",href:i.value,target:"_blank",rel:"noopener,noreferrer",onClick:c},H(v.$t("releaseToast.whatsNew")),9,hm)]),x("div",ym,[x("button",{class:"skip-button",onClick:g},H(v.$t("releaseToast.skip")),1),x("button",{class:"cta-button",onClick:f},H(v.$t("releaseToast.update")),1)])])])])])):V("",!0)}}),wm=we(bm,[["__scopeId","data-v-c39af871"]]),Cm={key:0,class:"whats-new-popup-container"},Sm=["aria-label"],km={class:"popup-content"},xm=["innerHTML"],$m={class:"popup-actions"},_m=["href"],Tm=j({__name:"WhatsNewPopup",emits:["whats-new-dismissed"],setup(e,{expose:t,emit:o}){const{t:s}=he(),{buildDocsUrl:l}=Lt(),a=oo(),i=o,r=R(!1),u=b(()=>a.recentRelease),d=b(()=>a.shouldShowPopup&&!r.value),p=b(()=>{const C=l("/changelog",{includeLocale:!0});if(u.value?.version){const m=Tn(u.value.version);return`${C}#${m}`}return C}),g=b(()=>{if(!u.value?.content)return`<p>${s("whatsNewPopup.noReleaseNotes")}</p>`;try{return Ni(u.value.content)}catch(C){return console.error("Error parsing markdown:",C),u.value.content.replace(/\n/g,"<br>")}}),c=n(()=>{r.value=!1},"show"),f=n(()=>{r.value=!0,i("whats-new-dismissed")},"hide"),v=n(async()=>{u.value&&await a.handleWhatsNewSeen(u.value.version),f()},"closePopup");return Me(async()=>{a.releases.length||await a.fetchReleases()}),t({show:c,hide:f}),(C,m)=>d.value?(y(),I("div",Cm,[m[2]||(m[2]=Ds('<div class="help-center-arrow" data-v-21279e5a><svg xmlns="http://www.w3.org/2000/svg" width="16" height="19" viewBox="0 0 16 19" fill="none" data-v-21279e5a><path d="M15.25 1.27246L15.25 17.7275L0.999023 9.5L15.25 1.27246Z" fill="#353535" data-v-21279e5a></path><path d="M15.25 1.27246L0.999023 9.5" stroke="#4e4e4e" stroke-width="1" fill="none" data-v-21279e5a></path><path d="M0.999023 9.5L15.25 17.7275" stroke="#4e4e4e" stroke-width="1" fill="none" data-v-21279e5a></path></svg></div>',1)),x("div",{class:"whats-new-popup",onClick:m[0]||(m[0]=Ee(()=>{},["stop"]))},[x("button",{class:"close-button","aria-label":C.$t("g.close"),onClick:v},m[1]||(m[1]=[x("div",{class:"close-icon"},null,-1)]),8,Sm),x("div",km,[x("div",{class:"content-text",innerHTML:g.value},null,8,xm),x("div",$m,[x("a",{class:"learn-more-link",href:p.value,target:"_blank",rel:"noopener,noreferrer",onClick:v},H(C.$t("whatsNewPopup.learnMore")),9,_m)])])])])):V("",!0)}}),Nm=we(Tm,[["__scopeId","data-v-21279e5a"]]),dn=St("helpCenter",()=>{const e=R(!1);return{isVisible:e,toggle:n(()=>{e.value=!e.value},"toggle"),show:n(()=>{e.value=!0},"show"),hide:n(()=>{e.value=!1},"hide")}}),Im=j({__name:"SidebarHelpCenterIcon",props:{isSmall:{type:Boolean}},setup(e){const t=Z(),o=oo(),s=dn(),{isVisible:l}=ct(s),{shouldShowRedDot:a}=ct(o),i=Ii(),{showNodeConflictDialog:r}=pt(),{shouldShowRedDot:u,markConflictsAsSeen:d}=Za(),p=e,{isSmall:g}=xa(p),c=b(()=>a.value||u.value),f=b(()=>t.get("Comfy.Sidebar.Location")),v=n(()=>{s.toggle()},"toggleHelpCenter"),C=n(()=>{s.hide()},"closeHelpCenter"),m=n(async()=>{try{await i.shouldShowConflictModalAfterUpdate()&&h()}catch(k){console.error("[HelpCenter] Error checking conflict modal:",k)}},"handleWhatsNewDismissed"),h=n(()=>{r({showAfterWhatsNew:!0,dialogComponentProps:{onClose:n(()=>{d()},"onClose")}})},"showConflictModal");return Me(async()=>{await o.initialize()}),(k,T)=>(y(),I("div",null,[E(Et,{icon:"pi pi-question-circle",class:"comfy-help-center-btn",label:k.$t("menu.help"),tooltip:k.$t("sideToolbar.helpCenter"),"icon-badge":c.value?"":"","is-small":w(g),onClick:v},null,8,["label","tooltip","icon-badge","is-small"]),(y(),O(Bt,{to:"#graph-canvas-container"},[w(l)?(y(),I("div",{key:0,class:K(["help-center-popup",{"sidebar-left":f.value==="left","sidebar-right":f.value==="right","small-sidebar":w(g)}])},[E(lm,{onClose:C})],2)):V("",!0)])),(y(),O(Bt,{to:"#graph-canvas-container"},[E(wm,{class:K({"sidebar-left":f.value==="left","sidebar-right":f.value==="right","small-sidebar":w(g)})},null,8,["class"])])),(y(),O(Bt,{to:"#graph-canvas-container"},[E(Nm,{class:K({"sidebar-left":f.value==="left","sidebar-right":f.value==="right","small-sidebar":w(g)}),onWhatsNewDismissed:m},null,8,["class"])])),(y(),O(Bt,{to:"body"},[w(l)?(y(),I("div",{key:0,class:"help-center-backdrop",onClick:C})):V("",!0)]))]))}}),Mm=we(Im,[["__scopeId","data-v-91ae5559"]]),Rm=j({__name:"SidebarLogoutIcon",setup(e){const{t}=he(),o=Xa(),s=b(()=>`${t("sideToolbar.logout")} (${o.currentUser?.username})`),l=n(async()=>{await o.logout(),window.location.reload()},"logout");return(a,i)=>(y(),O(Et,{icon:"pi pi-sign-out",tooltip:s.value,label:a.$t("sideToolbar.logout"),onClick:l},null,8,["tooltip","label"]))}}),Pm=j({__name:"SidebarTemplatesButton",setup(e){const t=Z(),o=b(()=>t.get("Comfy.Sidebar.Size")==="small"),s=n(()=>{Wn().show("sidebar")},"openTemplates");return(l,a)=>(y(),O(Et,{icon:"icon-[comfy--template]",tooltip:l.$t("sideToolbar.templates"),label:l.$t("sideToolbar.labels.templates"),"is-small":o.value,class:"templates-tab-button",onClick:s},null,8,["tooltip","label","is-small"]))}}),Dm=20,Am=50,Lm=j({__name:"SideToolbar",setup(e){const t=Ge(),o=Z(),s=Xa(),l=be(),a=ce(),i=R(),r=R(),u=R(),d=R(),p=b(()=>o.get("Comfy.Sidebar.Size")==="small"),g=b(()=>o.get("Comfy.Sidebar.Location")),c=b(()=>o.get("Comfy.Sidebar.Style")),f=b(()=>C.value||T.value||c.value==="connected"),v=b(()=>t.getSidebarTabs()),C=b(()=>t.sidebarTab.activeSidebarTab),m=n(async _=>{_.id,_.id,_.id,_.id,await l.commands.find(P=>P.id===`Workspace.ToggleSidebarTab.${_.id}`)?.function?.()},"onTabClick"),h=Mi(),k=n(_=>{const P=h.getKeybindingByCommandId(`Workspace.ToggleSidebarTab.${_.id}`);return P?` (${P.combo.toString()})`:""},"getTabTooltipSuffix"),T=R(!1),S=b(()=>re("sidebar-item-group flex flex-col items-center overflow-hidden flex-shrink-0"+(f.value?"":" rounded-lg shadow-interface"))),$=Mo(()=>{if(!i.value||!u.value||!d.value)return;const _=i.value.clientHeight,P=u.value.scrollHeight,M=d.value.scrollHeight,L=P+M;T.value?T.value=_<L+Am:T.value=_<L+Dm},16);return Me(()=>{if(!i.value)return;const _=Ia(i.value,$);$(),dt(()=>{_.stop()}),J([p,g],async()=>{a.canvas&&(g.value==="left"?(await De(),a.canvas.fpsInfoLocation=[i.value?.getBoundingClientRect()?.right,null]):a.canvas.fpsInfoLocation=null,a.canvas.setDirty(!1,!0))},{immediate:!0})}),(_,P)=>(y(),I("nav",{ref_key:"sideToolbarRef",ref:i,class:K(["side-tool-bar-container flex h-full flex-col items-center bg-transparent [.floating-sidebar]:-mr-2 pointer-events-auto",{"small-sidebar":p.value,"connected-sidebar":f.value,"floating-sidebar":!f.value,"overflowing-sidebar":T.value,"border-r border-[var(--interface-stroke)] shadow-interface":f.value}])},[x("div",{ref_key:"contentMeasureRef",ref:r,class:K(T.value?"side-tool-bar-container overflow-y-auto":"flex flex-col h-full")},[x("div",{ref_key:"topToolbarRef",ref:u,class:K(S.value)},[E(kf),(y(!0),I(ue,null,$e(v.value,M=>(y(),O(Et,{key:M.id,icon:M.icon,"icon-badge":M.iconBadge,tooltip:M.tooltip,"tooltip-suffix":k(M),label:M.label||M.title,"is-small":p.value,selected:M.id===C.value?.id,class:K(M.id+"-tab-button"),onClick:n(L=>m(M),"onClick")},null,8,["icon","icon-badge","tooltip","tooltip-suffix","label","is-small","selected","class","onClick"]))),128)),E(Pm)],2),x("div",{ref_key:"bottomToolbarRef",ref:d,class:K(["mt-auto",S.value])},[w(s).isMultiUserServer?(y(),O(Rm,{key:0,"is-small":p.value},null,8,["is-small"])):V("",!0),E(Mm,{"is-small":p.value},null,8,["is-small"]),E(Mf,{"is-small":p.value},null,8,["is-small"]),E(Rf,{"is-small":p.value},null,8,["is-small"])],2)],2)],2))}}),Em=we(Lm,[["__scopeId","data-v-acadfbcc"]]),Vm=St("topbarBadge",()=>{const e=$n();return{badges:b(()=>e.extensions.flatMap(o=>o.topbarBadges??[]))}}),Wm={class:"flex h-full shrink-0 items-center"},Om=j({__name:"TopbarBadges",props:{reverseOrder:{type:Boolean,default:!1},noPadding:{type:Boolean,default:!1}},setup(e){const t=_a(Aa),o=t.greaterOrEqual("xl"),s=t.greaterOrEqual("lg"),l=b(()=>o.value?"full":s.value?"compact":"icon-only"),a=Vm();return(i,r)=>(y(),I("div",Wm,[(y(!0),I(ue,null,$e(w(a).badges,u=>(y(),O(Uu,{key:u.text,badge:u,"display-mode":l.value,"reverse-order":i.reverseOrder,"no-padding":i.noPadding},null,8,["badge","display-mode","reverse-order","no-padding"]))),128))]))}}),Bm={class:"workflow-preview-content"},zm={key:0,class:"workflow-preview-thumbnail relative"},Um=["src"],Fm={class:"workflow-preview-footer"},Gm={class:"workflow-preview-name"},Hm=250,jm=j({__name:"WorkflowTabPopover",props:{workflowFilename:{},thumbnailUrl:{},isActiveTab:{type:Boolean}},setup(e,{expose:t}){const o=e,{thumbnailUrl:s,isActiveTab:l}=xa(o),a=R(null),i=R(null);let r=null,u=null;const d=sn(),p=n(v=>{r&&(clearTimeout(r),r=null),u&&(clearTimeout(u),u=null),u=setTimeout(async()=>{if(a.value&&i.value){a.value.show(v,i.value),await De();const C=document.querySelector(`.workflow-popover-fade[data-popover-id="${d}"]`);if(C){const m=i.value.getBoundingClientRect().left,h=C.getBoundingClientRect().width,k=h/2;let T=m-k,S=0;if(T<0)S=T-8,T=8;else if(T+h>window.innerWidth){const $=window.innerWidth-h-16;S=T-$,T=$}S+k<0&&(S=-k+24),C.style.left=`${T}px`,C.style.setProperty("--shift",`${S}px`)}}},200)},"showPopover"),g=n(()=>{},"cancelHidePopover"),c=n(()=>{u&&(clearTimeout(u),u=null),r=setTimeout(()=>{a.value&&a.value.hide()},100)},"hidePopover");return t({showPopover:p,hidePopover:c,togglePopover:n(v=>{a.value&&a.value.toggle(v)},"togglePopover")}),(v,C)=>(y(),I(ue,null,[x("div",{ref_key:"positionRef",ref:i,class:"absolute bottom-0 left-1/2 -translate-x-1/2"},null,512),E(w(ut),{ref_key:"popoverRef",ref:a,"append-to":"body",pt:{root:{class:"workflow-popover-fade fit-content","data-popover-id":w(d)}},onMouseenter:g,onMouseleave:c},{default:W(()=>[x("div",Bm,[w(s)&&!w(l)?(y(),I("div",zm,[x("img",{src:w(s),class:"block h-[200px] rounded-lg object-cover p-2",style:me({width:`${Hm}px`})},null,12,Um)])):V("",!0),x("div",Fm,[x("span",Gm,H(v.workflowFilename),1)])])]),_:1},8,["pt"])],64))}}),qm=we(jm,[["__scopeId","data-v-4c13cb50"]]),Km={class:"workflow-label inline-block max-w-[150px] truncate text-sm"},Ym={class:"relative"},Qm={key:0,class:"absolute top-1/2 left-1/2 z-10 w-4 -translate-1/2 bg-(--comfy-menu-bg) text-2xl font-bold group-hover:hidden"},Zm=j({__name:"WorkflowTab",props:{class:{},workflowOption:{}},setup(e){const t=e,{t:o}=he(),s=Ge(),l=_e(),a=Z(),i=R(null),r=R(null),u=Pi(),d=b(()=>a.get("Comfy.Workflow.AutoSave")),p=b(()=>a.get("Comfy.Workflow.AutoSaveDelay")),g=b(()=>s.shiftDown?!1:t.workflowOption.workflow.isPersisted?t.workflowOption.workflow.isModified?d.value==="off"||d.value==="after delay"&&p.value>3e3:!1:!0),c=b(()=>l.activeWorkflow?.key===t.workflowOption.workflow.key),f=b(()=>u.getThumbnail(t.workflowOption.workflow.key)),v=n(S=>{r.value?.showPopover(S)},"handleMouseEnter"),C=n(()=>{r.value?.hidePopover()},"handleMouseLeave"),m=n(S=>{r.value?.togglePopover(S)},"handleClick"),h=n(async S=>{for(const $ of S)if(!await Qe().closeWorkflow($.workflow,{warnIfUnsaved:!s.shiftDown,hint:o("sideToolbar.workflowTab.dirtyCloseHint")}))break},"closeWorkflows"),k=n(async S=>{await h([S])},"onCloseWorkflow"),T=n(()=>i.value,"tabGetter");return Ri(T,{getInitialData:n(()=>({workflowKey:t.workflowOption.workflow.key}),"getInitialData")}),Ja(T,{getData:n(()=>({workflowKey:t.workflowOption.workflow.key}),"getData"),onDrop:n(S=>{const $=l.openWorkflows.findIndex(P=>P.key===S.source.data.workflowKey),_=l.openWorkflows.findIndex(P=>P.key===S.location.current.dropTargets[0]?.data.workflowKey);$!==_&&l.reorderWorkflows($,_)},"onDrop")}),at(()=>{r.value?.hidePopover()}),(S,$)=>(y(),I(ue,null,[x("div",nt({ref_key:"workflowTabRef",ref:i,class:"workflow-tab group flex gap-2 p-2"},S.$attrs,{onMouseenter:v,onMouseleave:C,onClick:m}),[x("span",Km,H(S.workflowOption.workflow.filename),1),x("div",Ym,[g.value?(y(),I("span",Qm,"")):V("",!0),E(w(ie),{class:"close-button invisible w-auto p-0",icon:"pi pi-times",text:"",severity:"secondary",size:"small",onClick:$[0]||($[0]=Ee(_=>k(S.workflowOption),["stop"]))})])],16),E(qm,{ref_key:"popoverRef",ref:r,"workflow-filename":S.workflowOption.workflow.filename,"thumbnail-url":f.value,"is-active-tab":c.value},null,8,["workflow-filename","thumbnail-url","is-active-tab"])],64))}}),Xm=j({__name:"WorkflowOverflowMenu",props:{workflows:{},activeWorkflow:{}},setup(e){const t=e,o=R(null),s=Qe(),l=b(()=>t.workflows.map(a=>({label:a.filename,icon:t.activeWorkflow?.key===a.key?"pi pi-check":void 0,command:n(()=>{s.openWorkflow(a)},"command")})));return(a,i)=>{const r=Te("tooltip");return y(),I("div",null,[pe(E(w(ie),{class:"rounded-none",icon:"pi pi-ellipsis-h",text:"",severity:"secondary","aria-label":a.$t("g.moreWorkflows"),onClick:i[0]||(i[0]=u=>o.value?.toggle(u))},null,8,["aria-label"]),[[r,{value:a.$t("g.moreWorkflows"),showDelay:300}]]),E(w(rs),{ref_key:"menu",ref:o,model:l.value,popup:!0,class:"max-h-[40vh] overflow-auto"},null,8,["model"])])}}}),Jm={key:3,class:"window-actions-spacer app-drag shrink-0"},ev=j({__name:"WorkflowTabs",props:{class:{}},setup(e){const t=e,{t:o}=he(),s=Ge(),l=_e(),a=Di(),i=Qe(),r=R(),u=R(),d=R(null),p=R(!1),g=R(!1),c=R(!1),f=Oe(),v=n(U=>({value:U.path,workflow:U}),"workflowToOption"),C=b(()=>l.openWorkflows.map(v)),m=b(()=>l.activeWorkflow?v(l.activeWorkflow):null),h=n(async U=>{U&&m.value?.value!==U.value&&await i.openWorkflow(U.workflow)},"onWorkflowChange"),k=n(async U=>{for(const A of U)if(!await i.closeWorkflow(A.workflow,{warnIfUnsaved:!s.shiftDown}))break},"closeWorkflows"),T=n(async U=>{await k([U])},"onCloseWorkflow"),S=n((U,A)=>{r.value=A,u.value.show(U)},"showContextMenu"),$=b(()=>{const U=r.value;if(!U)return[];const A=C.value.findIndex(G=>G.workflow===U.workflow);return[{label:o("tabMenu.duplicateTab"),command:n(async()=>{await i.duplicateWorkflow(U.workflow)},"command")},{separator:!0},{label:o("tabMenu.closeTab"),command:n(()=>T(U),"command")},{label:o("tabMenu.closeTabsToLeft"),command:n(()=>k(C.value.slice(0,A)),"command"),disabled:A<=0},{label:o("tabMenu.closeTabsToRight"),command:n(()=>k(C.value.slice(A+1)),"command"),disabled:A===C.value.length-1},{label:o("tabMenu.closeOtherTabs"),command:n(()=>k([...C.value.slice(A+1),...C.value.slice(0,A)]),"command"),disabled:C.value.length<=1},{label:a.isBookmarked(U.workflow.path)?o("tabMenu.removeFromBookmarks"):o("tabMenu.addToBookmarks"),command:n(()=>a.toggleBookmarked(U.workflow.path),"command"),disabled:U.workflow.isTemporary}]}),_=be(),P=n(U=>{const A=U.currentTarget,G=U.deltaX||U.deltaY;A.scroll({left:A.scrollLeft+G})},"handleWheel"),M=b(()=>d.value?.querySelector(".p-scrollpanel-content")??null),L=n(U=>{const A=M.value;A&&A.scrollBy({left:U*20})},"scroll"),N=n(async(U={})=>{if(!m.value)return;U.waitForDom!==!1&&await De();const A=d.value;if(!A)return;const G=A.querySelector(".p-togglebutton-checked");G&&G.scrollIntoView({block:"nearest",inline:"nearest"})},"ensureActiveTabVisible");J(()=>l.activeWorkflow,()=>{N()},{immediate:!0});let B=null,D=null,z=null;return J(M,(U,A,G)=>{if(D?.(),z?.(),B?.dispose(),!U)return;const q=zs(U);D=J([()=>q.arrivedState.left,()=>q.arrivedState.right],([Q,Y])=>{g.value=!Q,c.value=!Y},{immediate:!0}),B=vs(U),z=J(B.isOverflowing,Q=>{p.value=Q,Q&&De(()=>{q.measure(),N({waitForDom:!1})})},{immediate:!0}),G(()=>{D?.(),z?.(),B?.dispose()})},{immediate:!0}),Sa(()=>{B?.disposed.value||B?.checkOverflow()}),(U,A)=>{const G=Te("tooltip");return y(),I("div",{ref_key:"containerRef",ref:d,class:K(["workflow-tabs-container flex h-full max-w-full flex-auto flex-row overflow-hidden border-b border-[var(--interface-stroke)] shadow-interface",{"workflow-tabs-container-desktop":w(f)}])},[p.value?(y(),O(w(ie),{key:0,icon:"pi pi-chevron-left",text:"",severity:"secondary",class:"overflow-arrow overflow-arrow-left",disabled:!g.value,onMousedown:A[0]||(A[0]=q=>w(cn)(q,()=>L(-1)))},null,8,["disabled"])):V("",!0),E(w(xl),{class:"no-drag overflow-hidden","pt:content":{class:"p-0 w-full flex",onwheel:P},"pt:bar-x":"h-1"},{default:W(()=>[E(w(is),{class:K(["workflow-tabs bg-transparent",t.class]),"model-value":m.value,options:C.value,"option-label":"label","data-key":"value","onUpdate:modelValue":h},{option:W(({option:q})=>[E(Zm,{"workflow-option":q,onContextmenu:n(Q=>S(Q,q),"onContextmenu"),onMouseup:Ee(Q=>T(q),["middle"])},null,8,["workflow-option","onContextmenu","onMouseup"])]),_:1},8,["class","model-value","options"])]),_:1},8,["pt:content"]),p.value?(y(),O(w(ie),{key:1,icon:"pi pi-chevron-right",text:"",severity:"secondary",class:"overflow-arrow overflow-arrow-right",disabled:!c.value,onMousedown:A[1]||(A[1]=q=>w(cn)(q,()=>L(1)))},null,8,["disabled"])):V("",!0),p.value?(y(),O(Xm,{key:2,workflows:w(l).openWorkflows,"active-workflow":w(l).activeWorkflow},null,8,["workflows","active-workflow"])):V("",!0),pe(E(w(ie),{class:"new-blank-workflow-button no-drag shrink-0 rounded-none",icon:"pi pi-plus",text:"",severity:"secondary","aria-label":U.$t("sideToolbar.newBlankWorkflow"),onClick:A[2]||(A[2]=()=>w(_).execute("Comfy.NewBlankWorkflow"))},null,8,["aria-label"]),[[G,{value:U.$t("sideToolbar.newBlankWorkflow"),showDelay:300}]]),E(w($l),{ref_key:"menu",ref:u,model:$.value},null,8,["model"]),w(f)?(y(),I("div",Jm)):V("",!0)],2)}}}),tv=we(ev,[["__scopeId","data-v-4cd2c75d"]]);function ov(e){const{createNode:t,deleteNode:o,setSource:s}=Vo(),l=st(),a=gn(new Map),i=new Map,r=n(S=>{const $=i.get(S),_=a.get(S);if(!$||!_)return;const P=new Map;$.inputs?.forEach((L,N)=>{L?.widget?.name&&P.set(L.widget.name,{index:N,linked:L.link!=null})});const M=_.widgets?.map(L=>{const N=P.get(L.name);return N?{...L,slotMetadata:N}:L});a.set(S,{..._,widgets:M,inputs:$.inputs?[...$.inputs]:void 0,outputs:$.outputs?[...$.outputs]:void 0})},"refreshNodeSlots");function u(S){const $=S.graph&&"id"in S.graph&&S.graph!==S.graph.rootGraph?String(S.graph.id):null,_=new Map,P=As(S.widgets??[]);Object.defineProperty(S,"widgets",{get(){return P},set(D){P.splice(0,P.length,...D)}});const M=Us(()=>(S.inputs?.forEach((D,z)=>{D?.widget?.name&&_.set(D.widget.name,{index:z,linked:D.link!=null})}),S.widgets?.map(D=>{try{let z=D.value;z===void 0&&D.type==="combo"&&D.options?.values&&Array.isArray(D.options.values)&&D.options.values.length>0&&(z=D.options.values[0]);const U=l.getInputSpecForWidget(S,D.name),A=_.get(D.name);return{name:D.name,type:D.type,value:z,label:D.label,options:D.options?{...D.options}:void 0,callback:D.callback,spec:U,slotMetadata:A,isDOMWidget:Ht(D)}}catch{return{name:D.name||"unknown",type:D.type||"text",value:void 0}}})??[])),L=S.type||S.constructor?.comfyClass||S.constructor?.title||S.constructor?.name||"Unknown",N=S.constructor?.nodeData?.api_node??!1,B=S.badges;return{id:String(S.id),title:typeof S.title=="string"?S.title:"",type:L,mode:S.mode||0,selected:S.selected||!1,executing:!1,subgraphId:$,apiNode:N,badges:B,hasErrors:!!S.has_errors,widgets:M,inputs:S.inputs?[...S.inputs]:void 0,outputs:S.outputs?[...S.outputs]:void 0,flags:S.flags?{...S.flags}:void 0,color:S.color||void 0,bgcolor:S.bgcolor||void 0}}n(u,"extractVueNodeData");const d=n(S=>i.get(S),"getNode"),p=n(S=>{if(!(S==null||S===void 0)){if(typeof S=="string"||typeof S=="number"||typeof S=="boolean")return S;if(typeof S=="object")return Array.isArray(S)&&S.length>0&&S.every($=>$ instanceof File),S;console.warn(`Invalid widget value type: ${typeof S}`,S)}},"validateWidgetValue"),g=n((S,$,_)=>{try{const P=a.get(S);if(!P?.widgets)return;const M=P.widgets.map(N=>N.name===$?{...N,value:p(_)}:N),L={...P,widgets:M};a.set(S,L)}catch{}},"updateVueWidgetState"),c=n((S,$,_)=>{let P=!1;return M=>{if(!P){P=!0;try{if(M!=null&&typeof M!="string"&&typeof M!="number"&&typeof M!="boolean"&&typeof M!="object"){console.warn(`Invalid widget value type: ${typeof M}`),P=!1;return}S.value=M,$&&$.call(S,M),g(_,S.name,M)}finally{P=!1}}}},"createWrappedWidgetCallback"),f=n(S=>{if(!S.widgets)return;const $=String(S.id);S.widgets.forEach(_=>{const P=_.callback;_.callback=c(_,P,$)})},"setupNodeWidgetCallbacks"),v=n(()=>{if(!e?._nodes)return;const S=new Set(e._nodes.map($=>String($.id)));for(const $ of Array.from(a.keys()))S.has($)||(i.delete($),a.delete($));e._nodes.forEach($=>{const _=String($.id);i.set(_,$),f($),a.set(_,u($))})},"syncWithGraph"),C=n((S,$)=>{const _=String(S.id);i.set(_,S),f(S),a.set(_,u(S));const P=n(()=>{const M={x:S.pos[0],y:S.pos[1]},L={width:S.size[0],height:S.size[1]};s(Pt.Canvas),t(_,{position:M,size:L,zIndex:S.order||0,visible:!0})},"initializeVueNodeLayout");window.app?.configuringGraph?S.onAfterGraphConfigured=Qt(S.onAfterGraphConfigured,()=>{a.set(_,u(S)),P()}):P(),$&&$(S)},"handleNodeAdded"),m=n((S,$)=>{const _=String(S.id);s(Pt.Canvas),o(_),i.delete(_),a.delete(_),$&&$(S)},"handleNodeRemoved"),h=n((S,$,_)=>()=>{e.onNodeAdded=S||void 0,e.onNodeRemoved=$||void 0,e.onTrigger=_||void 0,i.clear(),a.clear()},"createCleanupFunction"),T=n(()=>{const S=e.onNodeAdded,$=e.onNodeRemoved,_=e.onTrigger;e.onNodeAdded=M=>{C(M,S)},e.onNodeRemoved=M=>{m(M,$)};const P={"node:property:changed":n(M=>{const L=String(M.nodeId),N=a.get(L);if(N)switch(M.property){case"title":a.set(L,{...N,title:String(M.newValue)});break;case"flags.collapsed":a.set(L,{...N,flags:{...N.flags,collapsed:!!M.newValue}});break;case"flags.pinned":a.set(L,{...N,flags:{...N.flags,pinned:!!M.newValue}});break;case"mode":a.set(L,{...N,mode:typeof M.newValue=="number"?M.newValue:0});break;case"color":a.set(L,{...N,color:typeof M.newValue=="string"?M.newValue:void 0});break;case"bgcolor":a.set(L,{...N,bgcolor:typeof M.newValue=="string"?M.newValue:void 0})}},"node:property:changed"),"node:slot-errors:changed":n(M=>{r(String(M.nodeId))},"node:slot-errors:changed"),"node:slot-links:changed":n(M=>{M.slotType===Ai.INPUT&&r(String(M.nodeId))},"node:slot-links:changed")};return e.onTrigger=M=>{switch(M.type){case"node:property:changed":P["node:property:changed"](M);break;case"node:slot-errors:changed":P["node:slot-errors:changed"](M);break;case"node:slot-links:changed":P["node:slot-links:changed"](M);break}_?.(M)},v(),h(S||void 0,$||void 0,_||void 0)},"setupEventListeners")();return e._nodes&&e._nodes.length>0&&e._nodes.forEach(S=>{e.onNodeAdded&&e.onNodeAdded(S)}),{vueNodeData:a,getNode:d,cleanup:T}}n(ov,"useGraphNodeManager");const ks=Po(()=>xo("comfy.vueNodesMigration.dismissed",!1));function nv(){const e=R();function t(s){s?.graph&&(o(),e.value=Le.onChange(l=>{for(const a of l.nodeIds){const i=Le.getNodeLayoutRef(a).value;if(!i)continue;const r=s.graph?.getNodeById(parseInt(a));r&&((r.pos[0]!==i.position.x||r.pos[1]!==i.position.y)&&(r.pos[0]=i.position.x,r.pos[1]=i.position.y),(r.size[0]!==i.size.width||r.size[1]!==i.size.height)&&r.setSize([i.size.width,i.size.height]))}s.setDirty(!0,!0)}))}n(t,"startSync");function o(){e.value?.(),e.value=void 0}return n(o,"stopSync"),at(o),{startSync:t,stopSync:o}}n(nv,"useLayoutSync");function av(){const e=ce(),t=Vo(),{shouldRenderVueNodes:o}=_o(),s=rt(null),{startSync:l}=nv(),a=ks();let i=!1;const r=n(()=>{const g=F.canvas?.graph;if(!g||s.value)return;const c=ov(g);s.value=c;const f=g._nodes.map(v=>({id:v.id.toString(),pos:[v.pos[0],v.pos[1]],size:[v.size[0],v.size[1]]}));Le.initializeFromLiteGraph(f);for(const v of g.reroutes.values()){const[C,m]=v.pos,h=v.parentId??void 0,k=Array.from(v.linkIds);t.createReroute(v.id,{x:C,y:m},h,k)}for(const v of g._links.values())t.createLink(v.id,v.origin_id,v.origin_slot,v.target_id,v.target_slot);l(e.canvas)},"initializeNodeManager"),u=n(()=>{if(s.value){try{s.value.cleanup()}catch{}s.value=null}},"disposeNodeManagerAndSyncs");return J(()=>o.value&&!!F.canvas?.graph,(g,c)=>{g&&(r(),jn(F.canvas?.graph?.extra.workflowRendererVersion),c===!1&&!a.value&&!i&&(i=!0,tt().add({group:"vue-nodes-migration",severity:"info",life:0})))},{immediate:!0}),Ro(()=>!o.value,()=>{jn(F.canvas?.graph?.extra.workflowRendererVersion),u(),F.canvas?.setDirty(!0,!0)}),J(()=>o.value,(g,c)=>{g!==c&&Le.clearAllSlotLayouts()},{immediate:!0,flush:"sync"}),{nodeManager:s,initializeNodeManager:r,disposeNodeManagerAndSyncs:u,setupEmptyGraphListener:n(()=>{const g=F.canvas?.graph;if(!o.value||s.value||g?._nodes.length!==0)return;const c=g.onNodeAdded;g.onNodeAdded=function(f){g.onNodeAdded=c,o.value&&!s.value&&r(),c&&c.call(this,f)}},"setupEmptyGraphListener"),cleanup:n(()=>{s.value&&(s.value.cleanup(),s.value=null)},"cleanup")}}n(av,"useVueNodeLifecycleIndividual");const On=Po(av);function sv(e){const[t,o]=e.pos,s=t+e.size[0],l=o+e.size[1];return[t,s,o,l]}n(sv,"getNodeBounds");function iv(e){if(!e)return;const t=e.ds,o=e.canvas.width,s=e.canvas.height,l=500*t.scale,[a,i]=t.offset,r=-l/t.scale-a,u=(o+l)/t.scale-a,d=-l/t.scale-i,p=(s+l)/t.scale-i;return[r,u,d,p]}n(iv,"viewportEdges");function lv(e,t){const[o,s,l,a]=e,[i,r,u,d]=t,p=s<i,g=o>r,c=a<u,f=l>d;return!(p||g||c||f)}n(lv,"boundsIntersect");function rv(){const e=ce(),{nodeManager:t}=On(),o=b(()=>iv(e.canvas));function s(i){if(!o.value||!i)return!0;const r=sv(i);return lv(r,o.value)}n(s,"inViewport");function l(){if(!t.value||!F.canvas)return;const i=document.querySelectorAll("[data-node-id]");for(const r of i){const u=r.getAttribute("data-node-id");if(!u)continue;const d=t.value.getNode(u);if(!d)continue;const p=s(d)?"":"none";r instanceof HTMLElement&&r.style.display!==p&&(r.style.display=p)}}return n(l,"updateVisibility"),{handleTransformUpdate:Ra(()=>l,100,!0)}}n(rv,"useViewportCullingIndividual");const uv=Po(rv);function cv(e,t,o=""){try{return e(t)}catch{return o}}n(cv,"safePricingExecution");const en=n(e=>{const t=e.widgets?.find(a=>a.name==="duration");if(!t)return"$0.05/second";const o=Number(t.value);return`$${(.05*(isNaN(o)?5:o)).toFixed(2)}/Run`},"calculateRunwayDurationPrice"),tn=n(e=>{const t=e.widgets?.find(r=>r.name==="duration_seconds"),o=e.widgets?.find(r=>r.name==="quality"),s=e.widgets?.find(r=>r.name==="motion_mode");if(!t||!o)return"$0.45-1.2/Run (varies with duration, quality & motion mode)";const l=String(t.value),a=String(o.value),i=String(s?.value);if(l.includes("5")){if(a.includes("1080p")||a.includes("720p")&&i?.includes("fast"))return"$1.2/Run";if(a.includes("720p")&&i?.includes("normal"))return"$0.6/Run";if(a.includes("540p")&&i?.includes("fast"))return"$0.9/Run";if(a.includes("540p")&&i?.includes("normal"))return"$0.45/Run";if(a.includes("360p")&&i?.includes("fast"))return"$0.9/Run";if(a.includes("360p")&&i?.includes("normal"))return"$0.45/Run";if(a.includes("720p")&&i?.includes("fast"))return"$1.2/Run"}else if(l.includes("8")){if(a.includes("720p")&&i?.includes("normal"))return"$1.2/Run";if(a.includes("540p")&&i?.includes("normal"))return"$0.9/Run";if(a.includes("540p")&&i?.includes("fast"))return"$1.2/Run";if(a.includes("360p")&&i?.includes("normal"))return"$0.9/Run";if(a.includes("360p")&&i?.includes("fast")||a.includes("1080p")&&i?.includes("normal")||a.includes("1080p")&&i?.includes("fast")||a.includes("720p")&&i?.includes("normal")||a.includes("720p")&&i?.includes("fast"))return"$1.2/Run"}return"$0.9/Run"},"pixversePricingCalculator"),lo=n(e=>{const t=e.widgets?.find(k=>k.name==="model"),o=e.widgets?.find(k=>k.name==="duration"),s=e.widgets?.find(k=>k.name==="resolution");if(!t||!o||!s)return"Token-based";const l=String(t.value).toLowerCase(),a=String(s.value).toLowerCase(),i=parseFloat(String(o.value)),r={"seedance-1-0-pro":{"480p":[.23,.24],"720p":[.51,.56],"1080p":[1.18,1.22]},"seedance-1-0-lite":{"480p":[.17,.18],"720p":[.37,.41],"1080p":[.85,.88]}},u=l.includes("seedance-1-0-pro")?"seedance-1-0-pro":l.includes("seedance-1-0-lite")?"seedance-1-0-lite":"",d=a.includes("1080")?"1080p":a.includes("720")?"720p":a.includes("480")?"480p":"",p=u&&d?r[u]?.[d]:void 0;if(!p)return"Token-based";const[g,c]=p,f=i/10,v=g*f,C=c*f,m=`$${v.toFixed(2)}/Run`,h=`$${C.toFixed(2)}/Run`;return m===h?m:`$${v.toFixed(2)}-$${C.toFixed(2)}/Run`},"byteDanceVideoPricingCalculator"),pa=n(e=>{const t=e.widgets?.find(c=>c.name==="model"),o=e.widgets?.find(c=>c.name==="duration"),s=e.widgets?.find(c=>c.name==="resolution"),l="$0.04-0.24/second";if(!t||!o||!s)return l;const a=String(t.value).toLowerCase(),i=String(s.value).toLowerCase(),r=parseFloat(String(o.value)),d={"ltx-2 (pro)":{"1920x1080":.06,"2560x1440":.12,"3840x2160":.24},"ltx-2 (fast)":{"1920x1080":.04,"2560x1440":.08,"3840x2160":.16}}[a];if(!d)return l;const p=d[i];return p?`$${(p*r).toFixed(2)}/Run`:l},"ltxvPricingCalculator"),Xt={BASIC:new Set(["720x1280","1280x720"]),PRO:new Set(["1024x1792","1792x1024"])},dv=new Set([...Xt.BASIC,...Xt.PRO]);function pv(e,t,o){const s=e?.toLowerCase()??"",l=o?.toLowerCase()??"";if(!t||Number.isNaN(t))return"Set duration (4s / 8s / 12s)";if(!l)return"Set size (720x1280, 1280x720, 1024x1792, 1792x1024)";if(!dv.has(l))return"Invalid size. Must be 720x1280, 1280x720, 1024x1792, or 1792x1024.";if(!s.includes("sora-2-pro")){if(s.includes("sora-2")&&!Xt.BASIC.has(l))return"sora-2 supports only 720x1280 or 1280x720";if(!s.includes("sora-2"))return"Unsupported model"}}n(pv,"validateSora2Selection");function fv(e,t){const o=e?.toLowerCase()??"",s=t?.toLowerCase()??"";return o.includes("sora-2-pro")?Xt.PRO.has(s)?.5:.3:o.includes("sora-2")?.1:Xt.PRO.has(s)?.5:.1}n(fv,"perSecForSora2");function mv(e,t){return`$${(e*t).toFixed(2)}/Run`}n(mv,"formatRunPrice");const vv=n(e=>{const t=n(r=>String(e.widgets?.find(u=>u.name===r)?.value??""),"getWidgetValue"),o=t("model"),s=t("size"),l=Number(e.widgets?.find(r=>["duration","duration_s"].includes(r.name))?.value);if(!o||!s||!l)return"Set model, duration & size";const a=pv(o,l,s);if(a)return a;const i=fv(o,s);return mv(i,l)},"sora2PricingCalculator"),fa={FluxProCannyNode:{displayPrice:"$0.05/Run"},FluxProDepthNode:{displayPrice:"$0.05/Run"},FluxProExpandNode:{displayPrice:"$0.05/Run"},FluxProFillNode:{displayPrice:"$0.05/Run"},FluxProUltraImageNode:{displayPrice:"$0.06/Run"},FluxProKontextProNode:{displayPrice:"$0.04/Run"},FluxProKontextMaxNode:{displayPrice:"$0.08/Run"},OpenAIVideoSora2:{displayPrice:vv},IdeogramV1:{displayPrice:n(e=>{const t=e.widgets?.find(r=>r.name==="num_images"),o=e.widgets?.find(r=>r.name==="turbo");if(!t)return"$0.02-0.06 x num_images/Run";const s=Number(t.value)||1;return`$${((String(o?.value).toLowerCase()==="true"?.02:.06)*s).toFixed(2)}/Run`},"displayPrice")},IdeogramV2:{displayPrice:n(e=>{const t=e.widgets?.find(r=>r.name==="num_images"),o=e.widgets?.find(r=>r.name==="turbo");if(!t)return"$0.05-0.08 x num_images/Run";const s=Number(t.value)||1;return`$${((String(o?.value).toLowerCase()==="true"?.05:.08)*s).toFixed(2)}/Run`},"displayPrice")},IdeogramV3:{displayPrice:n(e=>{const t=e.widgets?.find(d=>d.name==="rendering_speed"),o=e.widgets?.find(d=>d.name==="num_images"),s=e.inputs?.find(d=>d.name==="character_image"),l=typeof s?.link<"u"&&s.link!=null;if(!t)return"$0.03-0.08 x num_images/Run (varies with rendering speed & num_images)";const a=Number(o?.value)||1;let i=.06;const r=String(t.value);return r.toLowerCase().includes("quality")?l?i=.2:i=.09:r.toLowerCase().includes("default")?l?i=.15:i=.06:r.toLowerCase().includes("turbo")&&(l?i=.1:i=.03),`$${(i*a).toFixed(2)}/Run`},"displayPrice")},KlingCameraControlI2VNode:{displayPrice:"$0.49/Run"},KlingCameraControlT2VNode:{displayPrice:"$0.14/Run"},KlingDualCharacterVideoEffectNode:{displayPrice:n(e=>{const t=e.widgets?.find(r=>r.name==="mode"),o=e.widgets?.find(r=>r.name==="model_name"),s=e.widgets?.find(r=>r.name==="duration");if(!t||!o||!s)return"$0.14-2.80/Run (varies with model, mode & duration)";const l=String(t.value),a=String(s.value),i=String(o.value);return i.includes("v1-6")||i.includes("v1-5")?l.includes("pro")?a.includes("10")?"$0.98/Run":"$0.49/Run":a.includes("10")?"$0.56/Run":"$0.28/Run":i.includes("v1")?l.includes("pro")?a.includes("10")?"$0.98/Run":"$0.49/Run":a.includes("10")?"$0.28/Run":"$0.14/Run":"$0.14/Run"},"displayPrice")},KlingImage2VideoNode:{displayPrice:n(e=>{const t=e.widgets?.find(r=>r.name==="mode"),o=e.widgets?.find(r=>r.name==="model_name"),s=e.widgets?.find(r=>r.name==="duration");if(!t){if(!o)return"$0.14-2.80/Run (varies with model, mode & duration)";const r=String(o.value);return r.includes("v2-1-master")||r.includes("v2-master")?"$1.40/Run":r.includes("v1-6")||r.includes("v1-5")?"$0.28/Run":"$0.14/Run"}const l=String(t.value),a=String(s.value),i=String(o.value);return i.includes("v2-5-turbo")?a.includes("10")?"$0.70/Run":"$0.35/Run":i.includes("v2-1-master")||i.includes("v2-master")?a.includes("10")?"$2.80/Run":"$1.40/Run":i.includes("v2-1")||i.includes("v1-6")||i.includes("v1-5")?l.includes("pro")?a.includes("10")?"$0.98/Run":"$0.49/Run":a.includes("10")?"$0.56/Run":"$0.28/Run":i.includes("v1")?l.includes("pro")?a.includes("10")?"$0.98/Run":"$0.49/Run":a.includes("10")?"$0.28/Run":"$0.14/Run":"$0.14/Run"},"displayPrice")},KlingImageGenerationNode:{displayPrice:n(e=>{const o=e.inputs?.find(d=>d.name==="image")?.link?"image to image":"text to image",s=e.widgets?.find(d=>d.name==="model_name"),l=e.widgets?.find(d=>d.name==="n");if(!s)return"$0.0035-0.028 x n/Run (varies with modality & model)";const a=String(s.value),i=Number(l?.value)||1;let r=.014;return o.includes("text to image")?a.includes("kling-v1-5")||a.includes("kling-v2")?r=.014:a.includes("kling-v1")&&(r=.0035):o.includes("image to image")&&(a.includes("kling-v1-5")?r=.028:a.includes("kling-v1")&&(r=.0035)),`$${(r*i).toFixed(4)}/Run`},"displayPrice")},KlingLipSyncAudioToVideoNode:{displayPrice:"~$0.10/Run"},KlingLipSyncTextToVideoNode:{displayPrice:"~$0.10/Run"},KlingSingleImageVideoEffectNode:{displayPrice:n(e=>{const t=e.widgets?.find(s=>s.name==="effect_scene");if(!t)return"$0.28-0.49/Run (varies with effect scene)";const o=String(t.value);return o.includes("fuzzyfuzzy")||o.includes("squish")?"$0.28/Run":o.includes("dizzydizzy")||o.includes("bloombloom")?"$0.49/Run":(o.includes("expansion"),"$0.28/Run")},"displayPrice")},KlingStartEndFrameNode:{displayPrice:n(e=>{const t=e.widgets?.find(s=>s.name==="mode");if(!t)return"$0.14-2.80/Run (varies with model, mode & duration)";const o=String(t.value);return o.includes("v2-1")?o.includes("10s")?"$0.98/Run":"$0.49/Run":o.includes("v2-master")?o.includes("10s")?"$2.80/Run":"$1.40/Run":o.includes("v1-6")?o.includes("pro")?o.includes("10s")?"$0.98/Run":"$0.49/Run":o.includes("10s")?"$0.56/Run":"$0.28/Run":o.includes("v1")?o.includes("pro")?o.includes("10s")?"$0.98/Run":"$0.49/Run":o.includes("10s")?"$0.28/Run":"$0.14/Run":"$0.14/Run"},"displayPrice")},KlingTextToVideoNode:{displayPrice:n(e=>{const t=e.widgets?.find(s=>s.name==="mode");if(!t)return"$0.14-2.80/Run (varies with model, mode & duration)";const o=String(t.value);return o.includes("v2-5-turbo")?o.includes("10")?"$0.70/Run":"$0.35/Run":o.includes("v2-1-master")||o.includes("v2-master")?o.includes("10s")?"$2.80/Run":"$1.40/Run":o.includes("v1-6")?o.includes("pro")?o.includes("10s")?"$0.98/Run":"$0.49/Run":o.includes("10s")?"$0.56/Run":"$0.28/Run":o.includes("v1")?o.includes("pro")?o.includes("10s")?"$0.98/Run":"$0.49/Run":o.includes("10s")?"$0.28/Run":"$0.14/Run":"$0.14/Run"},"displayPrice")},KlingVideoExtendNode:{displayPrice:"$0.28/Run"},KlingVirtualTryOnNode:{displayPrice:"$0.07/Run"},LumaImageToVideoNode:{displayPrice:n(e=>{const t=e.widgets?.find(r=>r.name==="model"),o=e.widgets?.find(r=>r.name==="resolution"),s=e.widgets?.find(r=>r.name==="duration");if(!t||!o||!s)return"$0.14-11.47/Run (varies with model, resolution & duration)";const l=String(t.value),a=String(o.value).toLowerCase(),i=String(s.value);if(l.includes("ray-flash-2")){if(i.includes("5s")){if(a.includes("4k"))return"$2.19/Run";if(a.includes("1080p"))return"$0.55/Run";if(a.includes("720p"))return"$0.24/Run";if(a.includes("540p"))return"$0.14/Run"}else if(i.includes("9s")){if(a.includes("4k"))return"$3.95/Run";if(a.includes("1080p"))return"$0.99/Run";if(a.includes("720p"))return"$0.43/Run";if(a.includes("540p"))return"$0.252/Run"}}else if(l.includes("ray-2")){if(i.includes("5s")){if(a.includes("4k"))return"$6.37/Run";if(a.includes("1080p"))return"$1.59/Run";if(a.includes("720p"))return"$0.71/Run";if(a.includes("540p"))return"$0.40/Run"}else if(i.includes("9s")){if(a.includes("4k"))return"$11.47/Run";if(a.includes("1080p"))return"$2.87/Run";if(a.includes("720p"))return"$1.28/Run";if(a.includes("540p"))return"$0.72/Run"}}else if(l.includes("ray-1.6"))return"$0.35/Run";return"$0.55/Run"},"displayPrice")},LumaVideoNode:{displayPrice:n(e=>{const t=e.widgets?.find(r=>r.name==="model"),o=e.widgets?.find(r=>r.name==="resolution"),s=e.widgets?.find(r=>r.name==="duration");if(!t||!o||!s)return"$0.14-11.47/Run (varies with model, resolution & duration)";const l=String(t.value),a=String(o.value).toLowerCase(),i=String(s.value);if(l.includes("ray-flash-2")){if(i.includes("5s")){if(a.includes("4k"))return"$2.19/Run";if(a.includes("1080p"))return"$0.55/Run";if(a.includes("720p"))return"$0.24/Run";if(a.includes("540p"))return"$0.14/Run"}else if(i.includes("9s")){if(a.includes("4k"))return"$3.95/Run";if(a.includes("1080p"))return"$0.99/Run";if(a.includes("720p"))return"$0.43/Run";if(a.includes("540p"))return"$0.252/Run"}}else if(l.includes("ray-2")){if(i.includes("5s")){if(a.includes("4k"))return"$6.37/Run";if(a.includes("1080p"))return"$1.59/Run";if(a.includes("720p"))return"$0.71/Run";if(a.includes("540p"))return"$0.40/Run"}else if(i.includes("9s")){if(a.includes("4k"))return"$11.47/Run";if(a.includes("1080p"))return"$2.87/Run";if(a.includes("720p"))return"$1.28/Run";if(a.includes("540p"))return"$0.72/Run"}}else if(l.includes("ray-1-6"))return"$0.35/Run";return"$0.55/Run"},"displayPrice")},MinimaxImageToVideoNode:{displayPrice:"$0.43/Run"},MinimaxTextToVideoNode:{displayPrice:"$0.43/Run"},MinimaxHailuoVideoNode:{displayPrice:n(e=>{const t=e.widgets?.find(a=>a.name==="resolution"),o=e.widgets?.find(a=>a.name==="duration");if(!t||!o)return"$0.28-0.56/Run (varies with resolution & duration)";const s=String(t.value),l=String(o.value);if(s.includes("768P")){if(l.includes("6"))return"$0.28/Run";if(l.includes("10"))return"$0.56/Run"}else if(s.includes("1080P")&&l.includes("6"))return"$0.49/Run";return"$0.43/Run"},"displayPrice")},OpenAIDalle2:{displayPrice:n(e=>{const t=e.widgets?.find(r=>r.name==="size"),o=e.widgets?.find(r=>r.name==="n");if(!t)return"$0.016-0.02 x n/Run (varies with size & n)";const s=String(t.value),l=Number(o?.value)||1;let a=.02;return s.includes("1024x1024")?a=.02:s.includes("512x512")?a=.018:s.includes("256x256")&&(a=.016),`$${(a*l).toFixed(3)}/Run`},"displayPrice")},OpenAIDalle3:{displayPrice:n(e=>{const t=e.widgets?.find(a=>a.name==="size"),o=e.widgets?.find(a=>a.name==="quality");if(!t||!o)return"$0.04-0.12/Run (varies with size & quality)";const s=String(t.value),l=String(o.value);return s.includes("1024x1024")?l.includes("hd")?"$0.08/Run":"$0.04/Run":s.includes("1792x1024")||s.includes("1024x1792")?l.includes("hd")?"$0.12/Run":"$0.08/Run":"$0.04/Run"},"displayPrice")},OpenAIGPTImage1:{displayPrice:n(e=>{const t=e.widgets?.find(i=>i.name==="quality"),o=e.widgets?.find(i=>i.name==="n");if(!t)return"$0.011-0.30 x n/Run (varies with quality & n)";const s=String(t.value),l=Number(o?.value)||1;let a="$0.046-0.07";return s.includes("high")?a="$0.167-0.30":s.includes("medium")?a="$0.046-0.07":s.includes("low")&&(a="$0.011-0.02"),l===1?`${a}/Run`:`${a} x ${l}/Run`},"displayPrice")},PikaImageToVideoNode2_2:{displayPrice:n(e=>{const t=e.widgets?.find(a=>a.name==="duration"),o=e.widgets?.find(a=>a.name==="resolution");if(!t||!o)return"$0.2-1.0/Run (varies with duration & resolution)";const s=String(t.value),l=String(o.value);if(s.includes("5")){if(l.includes("1080p"))return"$0.45/Run";if(l.includes("720p"))return"$0.2/Run"}else if(s.includes("10")){if(l.includes("1080p"))return"$1.0/Run";if(l.includes("720p"))return"$0.6/Run"}return"$0.2/Run"},"displayPrice")},PikaScenesV2_2:{displayPrice:n(e=>{const t=e.widgets?.find(a=>a.name==="duration"),o=e.widgets?.find(a=>a.name==="resolution");if(!t||!o)return"$0.2-1.0/Run (varies with duration & resolution)";const s=String(t.value),l=String(o.value);if(s.includes("5")){if(l.includes("720p"))return"$0.3/Run";if(l.includes("1080p"))return"$0.5/Run"}else if(s.includes("10")){if(l.includes("720p"))return"$0.4/Run";if(l.includes("1080p"))return"$1.5/Run"}return"$0.3/Run"},"displayPrice")},PikaStartEndFrameNode2_2:{displayPrice:n(e=>{const t=e.widgets?.find(a=>a.name==="duration"),o=e.widgets?.find(a=>a.name==="resolution");if(!t||!o)return"$0.2-1.0/Run (varies with duration & resolution)";const s=String(t.value),l=String(o.value);if(s.includes("5")){if(l.includes("720p"))return"$0.2/Run";if(l.includes("1080p"))return"$0.3/Run"}else if(s.includes("10")){if(l.includes("720p"))return"$0.25/Run";if(l.includes("1080p"))return"$1.0/Run"}return"$0.2/Run"},"displayPrice")},PikaTextToVideoNode2_2:{displayPrice:n(e=>{const t=e.widgets?.find(a=>a.name==="duration"),o=e.widgets?.find(a=>a.name==="resolution");if(!t||!o)return"$0.2-1.5/Run (varies with duration & resolution)";const s=String(t.value),l=String(o.value);if(s.includes("5")){if(l.includes("1080p"))return"$0.45/Run";if(l.includes("720p"))return"$0.2/Run"}else if(s.includes("10")){if(l.includes("1080p"))return"$1.0/Run";if(l.includes("720p"))return"$0.6/Run"}return"$0.45/Run"},"displayPrice")},Pikadditions:{displayPrice:"$0.3/Run"},Pikaffects:{displayPrice:"$0.45/Run"},Pikaswaps:{displayPrice:"$0.3/Run"},PixverseImageToVideoNode:{displayPrice:tn},PixverseTextToVideoNode:{displayPrice:tn},PixverseTransitionVideoNode:{displayPrice:tn},RecraftCreativeUpscaleNode:{displayPrice:"$0.25/Run"},RecraftCrispUpscaleNode:{displayPrice:"$0.004/Run"},RecraftGenerateColorFromImageNode:{displayPrice:n(e=>{const t=e.widgets?.find(l=>l.name==="n");return t?`$${(.04*(Number(t.value)||1)).toFixed(2)}/Run`:"$0.04 x n/Run"},"displayPrice")},RecraftGenerateImageNode:{displayPrice:n(e=>{const t=e.widgets?.find(l=>l.name==="n");return t?`$${(.04*(Number(t.value)||1)).toFixed(2)}/Run`:"$0.04 x n/Run"},"displayPrice")},RecraftGenerateVectorImageNode:{displayPrice:n(e=>{const t=e.widgets?.find(l=>l.name==="n");return t?`$${(.08*(Number(t.value)||1)).toFixed(2)}/Run`:"$0.08 x n/Run"},"displayPrice")},RecraftImageInpaintingNode:{displayPrice:n(e=>{const t=e.widgets?.find(l=>l.name==="n");return t?`$${(.04*(Number(t.value)||1)).toFixed(2)}/Run`:"$0.04 x n/Run"},"displayPrice")},RecraftImageToImageNode:{displayPrice:n(e=>{const t=e.widgets?.find(l=>l.name==="n");return t?`$${(.04*(Number(t.value)||1)).toFixed(2)}/Run`:"$0.04 x n/Run"},"displayPrice")},RecraftRemoveBackgroundNode:{displayPrice:"$0.01/Run"},RecraftReplaceBackgroundNode:{displayPrice:"$0.04/Run"},RecraftTextToImageNode:{displayPrice:n(e=>{const t=e.widgets?.find(l=>l.name==="n");return t?`$${(.04*(Number(t.value)||1)).toFixed(2)}/Run`:"$0.04 x n/Run"},"displayPrice")},RecraftTextToVectorNode:{displayPrice:n(e=>{const t=e.widgets?.find(l=>l.name==="n");return t?`$${(.08*(Number(t.value)||1)).toFixed(2)}/Run`:"$0.08 x n/Run"},"displayPrice")},RecraftVectorizeImageNode:{displayPrice:n(e=>{const t=e.widgets?.find(l=>l.name==="n");return t?`$${(.01*(Number(t.value)||1)).toFixed(2)}/Run`:"$0.01 x n/Run"},"displayPrice")},StabilityStableImageSD_3_5Node:{displayPrice:n(e=>{const t=e.widgets?.find(s=>s.name==="model");if(!t)return"$0.035-0.065/Run (varies with model)";const o=String(t.value).toLowerCase();return o.includes("large")?"$0.065/Run":(o.includes("medium"),"$0.035/Run")},"displayPrice")},StabilityStableImageUltraNode:{displayPrice:"$0.08/Run"},StabilityUpscaleConservativeNode:{displayPrice:"$0.25/Run"},StabilityUpscaleCreativeNode:{displayPrice:"$0.25/Run"},StabilityUpscaleFastNode:{displayPrice:"$0.01/Run"},StabilityTextToAudio:{displayPrice:"$0.20/Run"},StabilityAudioToAudio:{displayPrice:"$0.20/Run"},StabilityAudioInpaint:{displayPrice:"$0.20/Run"},VeoVideoGenerationNode:{displayPrice:n(e=>{const t=e.widgets?.find(s=>s.name==="duration_seconds");return t?`$${(.5*Number(t.value)).toFixed(2)}/Run`:"$2.50-5.0/Run (varies with duration)"},"displayPrice")},Veo3VideoGenerationNode:{displayPrice:n(e=>{const t=e.widgets?.find(a=>a.name==="model"),o=e.widgets?.find(a=>a.name==="generate_audio");if(!t||!o)return"$0.80-3.20/Run (varies with model & audio generation)";const s=String(t.value),l=String(o.value).toLowerCase()==="true";return s.includes("veo-3.0-fast-generate-001")||s.includes("veo-3.1-fast-generate")?l?"$1.20/Run":"$0.80/Run":s.includes("veo-3.0-generate-001")||s.includes("veo-3.1-generate")?l?"$3.20/Run":"$1.60/Run":"$0.80-3.20/Run"},"displayPrice")},LumaImageNode:{displayPrice:n(e=>{const t=e.widgets?.find(l=>l.name==="model"),o=e.widgets?.find(l=>l.name==="aspect_ratio");if(!t||!o)return"$0.0045-0.0182/Run (varies with model & aspect ratio)";const s=String(t.value);return s.includes("photon-flash-1")?"$0.0019/Run":s.includes("photon-1")?"$0.0073/Run":"$0.0172/Run"},"displayPrice")},LumaImageModifyNode:{displayPrice:n(e=>{const t=e.widgets?.find(s=>s.name==="model");if(!t)return"$0.0019-0.0073/Run (varies with model)";const o=String(t.value);return o.includes("photon-flash-1")?"$0.0019/Run":o.includes("photon-1")?"$0.0073/Run":"$0.0172/Run"},"displayPrice")},MoonvalleyTxt2VideoNode:{displayPrice:n(e=>{const t=e.widgets?.find(s=>s.name==="length");if(!t)return"$1.50/Run";const o=String(t.value);return o==="5s"?"$1.50/Run":o==="10s"?"$3.00/Run":"$1.50/Run"},"displayPrice")},MoonvalleyImg2VideoNode:{displayPrice:n(e=>{const t=e.widgets?.find(s=>s.name==="length");if(!t)return"$1.50/Run";const o=String(t.value);return o==="5s"?"$1.50/Run":o==="10s"?"$3.00/Run":"$1.50/Run"},"displayPrice")},MoonvalleyVideo2VideoNode:{displayPrice:n(e=>{const t=e.widgets?.find(s=>s.name==="length");if(!t)return"$2.25/Run";const o=String(t.value);return o==="5s"?"$2.25/Run":o==="10s"?"$4.00/Run":"$2.25/Run"},"displayPrice")},RunwayTextToImageNode:{displayPrice:"$0.08/Run"},RunwayImageToVideoNodeGen3a:{displayPrice:en},RunwayImageToVideoNodeGen4:{displayPrice:en},RunwayFirstLastFrameNode:{displayPrice:en},Rodin3D_Regular:{displayPrice:"$0.4/Run"},Rodin3D_Detail:{displayPrice:"$0.4/Run"},Rodin3D_Smooth:{displayPrice:"$0.4/Run"},Rodin3D_Sketch:{displayPrice:"$0.4/Run"},TripoTextToModelNode:{displayPrice:n(e=>{const t=e.widgets?.find(d=>d.name==="quad"),o=e.widgets?.find(d=>d.name==="style"),s=e.widgets?.find(d=>d.name==="texture"),l=e.widgets?.find(d=>d.name==="texture_quality");if(!t||!o||!s)return"$0.1-0.4/Run (varies with quad, style, texture & quality)";const a=String(t.value).toLowerCase()==="true",i=String(o.value).toLowerCase(),r=String(s.value).toLowerCase()==="true",u=String(l?.value||"standard").toLowerCase();return i.includes("none")?a?u.includes("detailed")?r?"$0.35/Run":"$0.30/Run":r?"$0.25/Run":"$0.20/Run":r?"$0.15/Run":"$0.10/Run":a?u.includes("detailed")?r?"$0.40/Run":"$0.35/Run":r?"$0.30/Run":"$0.25/Run":r?"$0.20/Run":"$0.15/Run"},"displayPrice")},TripoImageToModelNode:{displayPrice:n(e=>{const t=e.widgets?.find(d=>d.name==="quad"),o=e.widgets?.find(d=>d.name==="style"),s=e.widgets?.find(d=>d.name==="texture"),l=e.widgets?.find(d=>d.name==="texture_quality");if(!t||!o||!s)return"$0.2-0.5/Run (varies with quad, style, texture & quality)";const a=String(t.value).toLowerCase()==="true",i=String(o.value).toLowerCase(),r=String(s.value).toLowerCase()==="true",u=String(l?.value||"standard").toLowerCase();return i.includes("none")?a?u.includes("detailed")?r?"$0.45/Run":"$0.40/Run":r?"$0.35/Run":"$0.30/Run":r?"$0.25/Run":"$0.20/Run":a?u.includes("detailed")?r?"$0.50/Run":"$0.45/Run":r?"$0.40/Run":"$0.35/Run":r?"$0.30/Run":"$0.25/Run"},"displayPrice")},TripoRefineNode:{displayPrice:"$0.3/Run"},TripoTextureNode:{displayPrice:n(e=>{const t=e.widgets?.find(s=>s.name==="texture_quality");return t?String(t.value).includes("detailed")?"$0.2/Run":"$0.1/Run":"$0.1-0.2/Run (varies with quality)"},"displayPrice")},TripoConvertModelNode:{displayPrice:"$0.10/Run"},TripoRetargetRiggedModelNode:{displayPrice:"$0.10/Run"},TripoMultiviewToModelNode:{displayPrice:n(e=>{const t=e.widgets?.find(d=>d.name==="quad"),o=e.widgets?.find(d=>d.name==="style"),s=e.widgets?.find(d=>d.name==="texture"),l=e.widgets?.find(d=>d.name==="texture_quality");if(!t||!o||!s)return"$0.2-0.5/Run (varies with quad, style, texture & quality)";const a=String(t.value).toLowerCase()==="true",i=String(o.value).toLowerCase(),r=String(s.value).toLowerCase()==="true",u=String(l?.value||"standard").toLowerCase();return i.includes("none")?a?u.includes("detailed")?r?"$0.45/Run":"$0.40/Run":r?"$0.35/Run":"$0.30/Run":r?"$0.25/Run":"$0.20/Run":a?u.includes("detailed")?r?"$0.50/Run":"$0.45/Run":r?"$0.40/Run":"$0.35/Run":r?"$0.30/Run":"$0.25/Run"},"displayPrice")},GeminiNode:{displayPrice:n(e=>{const t=e.widgets?.find(s=>s.name==="model");if(!t)return"Token-based";const o=String(t.value);return o.includes("veo-2.0")?"$0.5/second":o.includes("gemini-2.5-flash-preview-04-17")||o.includes("gemini-2.5-flash")?"$0.0003/$0.0025 per 1K tokens":o.includes("gemini-2.5-pro-preview-05-06")||o.includes("gemini-2.5-pro")?"$0.00125/$0.01 per 1K tokens":"Token-based"},"displayPrice")},GeminiImageNode:{displayPrice:"$0.03 per 1K tokens"},OpenAIChatNode:{displayPrice:n(e=>{const t=e.widgets?.find(s=>s.name==="model");if(!t)return"Token-based";const o=String(t.value);return o.includes("o4-mini")?"$0.0011/$0.0044 per 1K tokens":o.includes("o1-pro")?"$0.15/$0.60 per 1K tokens":o.includes("o1")?"$0.015/$0.06 per 1K tokens":o.includes("o3-mini")?"$0.0011/$0.0044 per 1K tokens":o.includes("o3")?"$0.01/$0.04 per 1K tokens":o.includes("gpt-4o")?"$0.0025/$0.01 per 1K tokens":o.includes("gpt-4.1-nano")?"$0.0001/$0.0004 per 1K tokens":o.includes("gpt-4.1-mini")?"$0.0004/$0.0016 per 1K tokens":o.includes("gpt-4.1")?"$0.002/$0.008 per 1K tokens":o.includes("gpt-5-nano")?"$0.00005/$0.0004 per 1K tokens":o.includes("gpt-5-mini")?"$0.00025/$0.002 per 1K tokens":o.includes("gpt-5")?"$0.00125/$0.01 per 1K tokens":"Token-based"},"displayPrice")},ViduTextToVideoNode:{displayPrice:"$0.4/Run"},ViduImageToVideoNode:{displayPrice:"$0.4/Run"},ViduReferenceVideoNode:{displayPrice:"$0.4/Run"},ViduStartEndToVideoNode:{displayPrice:"$0.4/Run"},ByteDanceImageNode:{displayPrice:n(e=>{const t=e.widgets?.find(s=>s.name==="model");return t&&String(t.value).includes("seedream-3-0-t2i")?"$0.03/Run":"Token-based"},"displayPrice")},ByteDanceImageEditNode:{displayPrice:n(e=>{const t=e.widgets?.find(s=>s.name==="model");return t&&String(t.value).includes("seededit-3-0-i2i")?"$0.03/Run":"Token-based"},"displayPrice")},ByteDanceSeedreamNode:{displayPrice:n(e=>{const t=e.widgets?.find(a=>a.name==="sequential_image_generation"),o=e.widgets?.find(a=>a.name==="max_images");if(!t||!o)return"$0.03/Run ($0.03 for one output image)";if(String(t.value).toLowerCase()==="disabled")return"$0.03/Run";const s=Number(o.value);return s===1?"$0.03/Run":`$${(.03*s).toFixed(2)}/Run ($0.03 for one output image)`},"displayPrice")},ByteDanceTextToVideoNode:{displayPrice:lo},ByteDanceImageToVideoNode:{displayPrice:lo},ByteDanceFirstLastFrameNode:{displayPrice:lo},ByteDanceImageReferenceNode:{displayPrice:lo},WanTextToVideoApi:{displayPrice:n(e=>{const t=e.widgets?.find(d=>d.name==="duration"),o=e.widgets?.find(d=>d.name==="size");if(!t||!o)return"$0.05-0.15/second";const s=parseFloat(String(t.value)),l=String(o.value).toLowerCase(),a=l.includes("1080")?"1080p":l.includes("720")?"720p":l.includes("480")?"480p":l.match(/^\s*(\d{3,4}p)/)?.[1]??"",r={"480p":.05,"720p":.1,"1080p":.15}[a];return isNaN(s)||!r?"$0.05-0.15/second":`$${(r*s).toFixed(2)}/Run`},"displayPrice")},WanImageToVideoApi:{displayPrice:n(e=>{const t=e.widgets?.find(u=>u.name==="duration"),o=e.widgets?.find(u=>u.name==="resolution");if(!t||!o)return"$0.05-0.15/second";const s=parseFloat(String(t.value)),l=String(o.value).trim().toLowerCase(),i={"480p":.05,"720p":.1,"1080p":.15}[l];return isNaN(s)||!i?"$0.05-0.15/second":`$${(i*s).toFixed(2)}/Run`},"displayPrice")},WanTextToImageApi:{displayPrice:"$0.03/Run"},WanImageToImageApi:{displayPrice:"$0.03/Run"},LtxvApiTextToVideo:{displayPrice:pa},LtxvApiImageToVideo:{displayPrice:pa}},gv=n(()=>({getNodeDisplayPrice:n(s=>{if(!s.constructor?.nodeData?.api_node)return"";const l=s.constructor.nodeData.name,a=fa[l];return a?typeof a.displayPrice=="function"?cv(a.displayPrice,s,""):a.displayPrice:""},"getNodeDisplayPrice"),getNodePricingConfig:n(s=>fa[s.constructor.nodeData?.name??""],"getNodePricingConfig"),getRelevantWidgetNames:n(s=>({KlingTextToVideoNode:["mode","model_name","duration"],KlingImage2VideoNode:["mode","model_name","duration"],KlingImageGenerationNode:["modality","model_name","n"],KlingDualCharacterVideoEffectNode:["mode","model_name","duration"],KlingSingleImageVideoEffectNode:["effect_scene"],KlingStartEndFrameNode:["mode","model_name","duration"],MinimaxHailuoVideoNode:["resolution","duration"],OpenAIDalle3:["size","quality"],OpenAIDalle2:["size","n"],OpenAIVideoSora2:["model","size","duration"],OpenAIGPTImage1:["quality","n"],IdeogramV1:["num_images","turbo"],IdeogramV2:["num_images","turbo"],IdeogramV3:["rendering_speed","num_images","character_image"],FluxProKontextProNode:[],FluxProKontextMaxNode:[],VeoVideoGenerationNode:["duration_seconds"],Veo3VideoGenerationNode:["model","generate_audio"],LumaVideoNode:["model","resolution","duration"],LumaImageToVideoNode:["model","resolution","duration"],LumaImageNode:["model","aspect_ratio"],LumaImageModifyNode:["model","aspect_ratio"],PikaTextToVideoNode2_2:["duration","resolution"],PikaImageToVideoNode2_2:["duration","resolution"],PikaScenesV2_2:["duration","resolution"],PikaStartEndFrameNode2_2:["duration","resolution"],PixverseTextToVideoNode:["duration_seconds","quality","motion_mode"],PixverseTransitionVideoNode:["duration_seconds","motion_mode","quality"],PixverseImageToVideoNode:["duration_seconds","quality","motion_mode"],StabilityStableImageSD_3_5Node:["model"],RecraftTextToImageNode:["n"],RecraftImageToImageNode:["n"],RecraftImageInpaintingNode:["n"],RecraftTextToVectorNode:["n"],RecraftVectorizeImageNode:["n"],RecraftGenerateColorFromImageNode:["n"],RecraftGenerateImageNode:["n"],RecraftGenerateVectorImageNode:["n"],MoonvalleyTxt2VideoNode:["length"],MoonvalleyImg2VideoNode:["length"],MoonvalleyVideo2VideoNode:["length"],RunwayImageToVideoNodeGen3a:["duration"],RunwayImageToVideoNodeGen4:["duration"],RunwayFirstLastFrameNode:["duration"],TripoTextToModelNode:["quad","style","texture","texture_quality"],TripoImageToModelNode:["quad","style","texture","texture_quality"],TripoTextureNode:["texture_quality"],GeminiNode:["model"],OpenAIChatNode:["model"],ByteDanceImageNode:["model"],ByteDanceImageEditNode:["model"],ByteDanceSeedreamNode:["model","sequential_image_generation","max_images"],ByteDanceTextToVideoNode:["model","duration","resolution"],ByteDanceImageToVideoNode:["model","duration","resolution"],ByteDanceFirstLastFrameNode:["model","duration","resolution"],ByteDanceImageReferenceNode:["model","duration","resolution"],WanTextToVideoApi:["duration","size"],WanImageToVideoApi:["duration","resolution"],LtxvApiTextToVideo:["model","duration","resolution"],LtxvApiImageToVideo:["model","duration","resolution"]})[s]||[],"getRelevantWidgetNames")}),"useNodePricing"),hv=n(()=>{function e(a){if(!a.isSubgraphNode())return;a.badges=a.badges.filter(r=>!o(r));const i=t(a.subgraph);i.length>1?a.badges.push(l("Partner Nodes x "+i.length)):a.badges.push(...i)}n(e,"updateSubgraphCredits");function t(a,i=new Set){if(i.has(a.id))return[];i.add(a.id);const r=[];for(const u of a.nodes)r.push(...u.isSubgraphNode()?t(u.subgraph,i):u.badges.filter(d=>o(d)));return r}n(t,"collectCreditsBadges");function o(a){return(typeof a=="function"?a():a).icon?.unicode===""}n(o,"isCreditsBadge");const s=Xe();function l(a){const i=s.completedActivePalette.light_theme;return new Nn({text:a,iconOptions:{unicode:"",fontFamily:"PrimeIcons",color:i?jt("#FABC25",{lightness:.5}):"#FABC25",bgColor:i?jt("#654020",{lightness:.5}):"#654020",fontSize:8},fgColor:s.completedActivePalette.colors.litegraph_base.BADGE_FG_COLOR,bgColor:i?jt("#8D6932",{lightness:.5}):"#8D6932"})}return n(l,"getCreditsBadge"),{getCreditsBadge:l,updateSubgraphCredits:e}},"usePriceBadge"),yv=n((e,t={})=>{const{widgetNames:o,triggerCanvasRedraw:s=!1}=t,l=R({});if(e.widgets){const a=o?e.widgets.filter(r=>o.includes(r.name)):e.widgets,i={};if(a.forEach(r=>{i[r.name]=r.value}),l.value=i,a.forEach(r=>{r.callback=Qt(r.callback,()=>{l.value={...l.value,[r.name]:r.value},s&&e.graph?.setDirtyCanvas(!0,!0)})}),o&&o.length>a.length){const r=o.map(u=>a.some(d=>d.name==u)?-1:e.inputs.findIndex(d=>d.name==u)).filter(u=>u>=0);e.onConnectionsChange=Qt(e.onConnectionsChange,(u,d,p)=>{r.includes(d)&&(l.value={...l.value,[r[d]]:p},s&&e.graph?.setDirtyCanvas(!0,!0))})}}return a=>Fs(l,a)},"useComputedWithWidgetWatch"),bv=n(()=>{const e=Z(),t=$n(),o=Xe(),s=hv(),l=b(()=>e.get("Comfy.NodeBadge.NodeSourceBadgeMode")),a=b(()=>e.get("Comfy.NodeBadge.NodeIdBadgeMode")),i=b(()=>e.get("Comfy.NodeBadge.NodeLifeCycleBadgeMode")),r=b(()=>e.get("Comfy.NodeBadge.ShowApiPricing"));J([l,a,i,r],()=>{F.graph?.setDirtyCanvas(!0,!0)});const u=st();function d(p,g){return!(g===Ke.None||p?.isCoreNode&&g===Ke.HideBuiltIn)}n(d,"badgeTextVisible"),Me(()=>{const p=gv();t.registerExtension({name:"Comfy.NodeBadge",nodeCreated(g){g.badgePosition=Li.TopRight;const c=b(()=>{const f=u.fromLGraphNode(g);return new Nn({text:Gs.truncate([d(f,a.value)?`#${g.id}`:"",d(f,i.value)?f?.nodeLifeCycleBadgeText??"":"",d(f,l.value)?f?.nodeSource?.badgeText??"":""].filter(v=>v.length>0).join(" "),{length:31}),fgColor:o.completedActivePalette.colors.litegraph_base.BADGE_FG_COLOR,bgColor:o.completedActivePalette.colors.litegraph_base.BADGE_BG_COLOR})});if(g.badges.push(()=>c.value),g.constructor.nodeData?.api_node&&r.value){const v=typeof p.getNodePricingConfig(g)?.displayPrice=="function";let C;const m=n(()=>{const h=p.getNodeDisplayPrice(g);return s.getCreditsBadge(h)},"createBadge");if(v){const h=p.getRelevantWidgetNames(g.constructor.nodeData?.name);C=yv(g,{widgetNames:h,triggerCanvasRedraw:!0})(m)}else C=b(m);g.badges.push(()=>C.value)}},init(){F.canvas.canvas.addEventListener("litegraph:set-graph",()=>{for(const g of F.canvas.graph?.nodes??[])s.updateSubgraphCredits(g)}),F.canvas.canvas.addEventListener("subgraph-converted",g=>s.updateSubgraphCredits(g.detail.subgraphNode))},afterConfigureGraph(){for(const g of F.canvas.graph?.nodes??[])s.updateSubgraphCredits(g)}})})},"useNodeBadge"),wv=n(e=>{const t=wn(),o=Eo(),s=Qe();Ja(()=>e.value,{getDropEffect:n(l=>l.source.data.type==="tree-explorer-node"?"copy":"move","getDropEffect"),onDrop:n(async l=>{const a=l.location.current.input,i=l.source.data;if(i.type==="tree-explorer-node"){const r=i.data,d=es().clientPosToCanvasPos([a.clientX,a.clientY]);if(r.data instanceof Ei){const p=r.data,g=[...d];g[1]+=le.NODE_TITLE_HEIGHT,o.addNodeOnGraph(p,{pos:g})}else if(r.data instanceof Vi){const p=r.data,g=d,c=F.graph.getNodeOnPos(g[0],g[1]);let f=null,v=null;if(c){const C=t.getAllNodeProviders(p.directory);for(const m of C)m.nodeDef.name===c.comfyClass&&(v=c,f=m)}if(!v){const C=t.getNodeProvider(p.directory);C&&(v=o.addNodeOnGraph(C.nodeDef,{pos:g}),f=C)}if(v){const C=v.widgets?.find(m=>m.name===f?.key);C&&(C.value=p.file_name)}}else if(r.data instanceof Oa){const p=r.data;await s.insertWorkflow(p,{position:d})}}},"onDrop")})},"useCanvasDrop"),Cv=n(()=>{Go.install(Ue.prototype,"getCanvasMenuOptions");const{getCanvasMenuOptions:e}=Ue.prototype,t=n(function(...r){const u=e.apply(this,r),d=F.collectCanvasMenuItems(this);for(const g of d)u.push(g);const p=Go.extractLegacyItems("getCanvasMenuOptions",this,...r);for(const g of p)u.push(g);for(const g of u)g?.content&&(g.content=ke(`contextMenu.${g.content}`,g.content));return u},"getCanvasCenterMenuOptions");Ue.prototype.getCanvasMenuOptions=t,Go.registerWrapper("getCanvasMenuOptions",t,e,Ue.prototype);const o=Ue.prototype.getNodeMenuOptions,s=n(function(...r){const u=o.apply(this,r),d=r[0],p=F.collectNodeMenuItems(d);for(const g of p)u.push(g);return u},"getNodeMenuOptionsWithExtensions");Ue.prototype.getNodeMenuOptions=s;function l(r,u){if(!r)return;const d=/Convert (.*) to input/,p=/Convert (.*) to widget/,g=ke("contextMenu.Convert ","Convert "),c=ke("contextMenu. to input"," to input"),f=ke("contextMenu. to widget"," to widget");for(const v of r){if(typeof v=="string"||(l(v?.submenu?.options,u),!v?.content))continue;Wi(`contextMenu.${v.content}`)&&(v.content=ke(`contextMenu.${v.content}`,v.content));const C=u.extra||u.parentMenu?.options?.extra,m=v.content?.match(d);if(m){let k=m[1];C?.inputs?.find(T=>{if(T.name!=k)return!1;k=T.label?T.label:T.name}),C?.widgets?.find(T=>{if(T.name!=k)return!1;k=T.label?T.label:T.name}),v.content=g+k+c;continue}const h=v.content?.match(p);if(h){let k=h[1];C?.inputs?.find(T=>{if(T.name!=k)return!1;k=T.label?T.label:T.name}),C?.widgets?.find(T=>{if(T.name!=k)return!1;k=T.label?T.label:T.name}),v.content=g+k+f;continue}}}n(l,"translateMenus");const a=le.ContextMenu;function i(r,u){return u.title&&(u.title=ke(`nodeDefs.${Ae(u.title)}.display_name`,u.title)),l(r,u),new a(r,u)}n(i,"ContextMenu"),le.ContextMenu=i,le.ContextMenu.prototype=a.prototype},"useContextMenuTranslation");function xs(e){return e instanceof HTMLTextAreaElement||e instanceof HTMLInputElement&&!["button","checkbox","file","hidden","image","radio","range","reset","search","submit"].includes(e.type)}n(xs,"shouldIgnoreCopyPaste");const Sv=['<meta charset="utf-8"><div><span data-metadata="','"></span></div><span style="white-space:pre-wrap;">Text</span>'],kv=n(()=>{const e=ce();xe(document,"copy",t=>{if(xs(t.target))return;const o=e.canvas;if(o?.selectedItems){const s=o.copyToClipboard();return t.clipboardData?.setData("text/html",Sv.join(btoa(s))),t.preventDefault(),t.stopImmediatePropagation(),!1}})},"useCopy"),xv=n(()=>{window.LiteGraph=le,window.LGraph=Oi,window.LLink=Bi,window.LGraphNode=Ze,window.LGraphGroup=ht,window.DragAndScale=zi,window.LGraphCanvas=Ue,window.ContextMenu=Ui,window.LGraphBadge=Nn},"useGlobalLitegraph");function $v(e){const o=e.getData("text/html").match(/data-metadata="([A-Za-z0-9+/=]+)"/)?.[1];if(!o)return!1;try{return ce().getCanvas()._deserializeItems(JSON.parse(atob(o)),{}),!0}catch(s){console.error(s)}return!1}n($v,"pasteClipboardItems");const _v=n(()=>{const e=Ge(),t=ce(),o=n((s,l,a)=>{if(!l)return;const i=Array.from(s).filter(u=>u.type.startsWith(a)),r=i[0]?.getAsFile();r&&(l.pasteFile?.(r),l.pasteFiles?.(Array.from(i).map(u=>u.getAsFile()).filter(u=>u!==null)))},"pasteItemsOnNode");xe(document,"paste",async s=>{if(xs(s.target)||e.shiftDown)return;const{canvas:l}=t;if(!l)return;const{graph:a}=l;let i=s.clipboardData;if(!i)throw new Error("No clipboard data on clipboard event");const{items:r}=i,u=l.current_node,d=u?.is_selected,p=d&&Ga(u),g=d&&Fi(u),c=d&&Gi(u);let f=p?u:null,v=c?u:null;const C=g?u:null;for(const h of r)if(h.type.startsWith("image/")){if(!f){const k=le.createNode("LoadImage");k&&(k.pos=[l.graph_mouse[0],l.graph_mouse[1]],f=a?.add(k)??null),a?.change()}o(r,f,"image");return}else if(h.type.startsWith("video/")){if(C){o(r,C,"video");return}}else if(h.type.startsWith("audio/")){if(!v){const k=le.createNode("LoadAudio");k&&(k.pos=[l.graph_mouse[0],l.graph_mouse[1]],v=a?.add(k)??null),a?.change()}o(r,v,"audio");return}if($v(i))return;i=i.getData("text/plain");let m=null;try{i=i.slice(i.indexOf("{")),m=JSON.parse(i)}catch{try{i=i.slice(i.indexOf(`workflow
`)),i=i.slice(i.indexOf("{")),m=JSON.parse(i)}catch{m=null}}if(m&&m.version&&m.nodes&&m.extra)await F.loadGraphData(m);else{if(s.target instanceof HTMLTextAreaElement&&s.target.type==="textarea"||s.target instanceof HTMLInputElement&&s.target.type==="text")return;l.pasteFromClipboard()}})},"usePaste"),Tv=n(()=>{const e=Z(),t=ce();ge(()=>{const o=e.get("Comfy.Graph.CanvasInfo");t.canvas&&(t.canvas.show_info=o,t.canvas.draw(!1,!0))}),ge(()=>{const o=e.get("Comfy.Graph.ZoomSpeed");t.canvas&&(t.canvas.zoom_speed=o)}),ge(()=>{le.snaps_for_comfy=e.get("Comfy.Node.AutoSnapLinkToSlot")}),ge(()=>{le.snap_highlights_node=e.get("Comfy.Node.SnapHighlightsNode")}),ge(()=>{Ze.keepAllLinksOnBypass=e.get("Comfy.Node.BypassAllLinksOnDelete")}),ge(()=>{le.middle_click_slot_add_default_node=e.get("Comfy.Node.MiddleClickRerouteNode")}),ge(()=>{const o=e.get("Comfy.LinkRenderMode");t.canvas&&(t.canvas.links_render_mode=o,t.canvas.setDirty(!1,!0))}),ge(()=>{const o=e.get("LiteGraph.Canvas.MinFontSizeForLOD");t.canvas&&(t.canvas.min_font_size_for_lod=o,t.canvas.setDirty(!0,!0))}),ge(()=>{const o=e.get("Comfy.Graph.LinkMarkers"),{canvas:s}=t;s&&(s.linkMarkerShape=o,s.setDirty(!1,!0))}),ge(()=>{const o=e.get("LiteGraph.Canvas.MaximumFps"),{canvas:s}=t;s&&(s.maximumFps=o)}),ge(()=>{const o=e.get("Comfy.Graph.CtrlShiftZoom"),{canvas:s}=t;s&&(s.dragZoomEnabled=o)}),ge(()=>{Ho.doubleClickTime=e.get("Comfy.Pointer.DoubleClickTime")}),ge(()=>{Ho.bufferTime=e.get("Comfy.Pointer.ClickBufferTime")}),ge(()=>{Ho.maxClickDrift=e.get("Comfy.Pointer.ClickDrift")}),ge(()=>{le.CANVAS_GRID_SIZE=e.get("Comfy.SnapToGrid.GridSize")}),ge(()=>{le.alwaysSnapToGrid=e.get("pysssss.SnapToGrid")}),ge(()=>{le.context_menu_scaling=e.get("LiteGraph.ContextMenu.Scaling")}),ge(()=>{le.Reroute.maxSplineOffset=e.get("LiteGraph.Reroute.SplineOffset")}),ge(()=>{const o=e.get("Comfy.Canvas.NavigationMode");le.canvasNavigationMode=o,le.macTrackpadGestures=o==="standard"}),ge(()=>{const o=e.get("Comfy.Canvas.LeftMouseClickBehavior");le.leftMouseClickBehavior=o}),ge(()=>{const o=e.get("Comfy.Canvas.MouseWheelScroll");le.mouseWheelScroll=o}),ge(()=>{le.saveViewportWithGraph=e.get("Comfy.EnableWorkflowViewRestore")})},"useLitegraphSettings"),Nv=[{id:"Comfy.Memory.AllowManualUnload",name:"Allow manual unload of models and execution cache via user command",type:"hidden",defaultValue:!0,versionAdded:"1.18.0"},{id:"Comfy.Validation.Workflows",name:"Validate workflows",type:"boolean",defaultValue:!0},{id:"Comfy.NodeSearchBoxImpl",category:["Comfy","Node Search Box","Implementation"],experimental:!0,name:"Node search box implementation",type:"combo",options:["default","litegraph (legacy)"],defaultValue:"default"},{id:"Comfy.LinkRelease.Action",category:["LiteGraph","LinkRelease","Action"],name:"Action on link release (No modifier)",type:"combo",options:Object.values(et),defaultValue:et.CONTEXT_MENU,defaultsByInstallVersion:{"1.24.1":et.SEARCH_BOX}},{id:"Comfy.LinkRelease.ActionShift",category:["LiteGraph","LinkRelease","ActionShift"],name:"Action on link release (Shift)",type:"combo",options:Object.values(et),defaultValue:et.SEARCH_BOX,defaultsByInstallVersion:{"1.24.1":et.CONTEXT_MENU}},{id:"Comfy.NodeSearchBoxImpl.NodePreview",category:["Comfy","Node Search Box","NodePreview"],name:"Node preview",tooltip:"Only applies to the default implementation",type:"boolean",defaultValue:!0},{id:"Comfy.NodeSearchBoxImpl.ShowCategory",category:["Comfy","Node Search Box","ShowCategory"],name:"Show node category in search results",tooltip:"Only applies to the default implementation",type:"boolean",defaultValue:!0},{id:"Comfy.NodeSearchBoxImpl.ShowIdName",category:["Comfy","Node Search Box","ShowIdName"],name:"Show node id name in search results",tooltip:"Only applies to the default implementation",type:"boolean",defaultValue:!1},{id:"Comfy.NodeSearchBoxImpl.ShowNodeFrequency",category:["Comfy","Node Search Box","ShowNodeFrequency"],name:"Show node frequency in search results",tooltip:"Only applies to the default implementation",type:"boolean",defaultValue:!1},{id:"Comfy.Sidebar.Location",category:["Appearance","Sidebar","Location"],name:"Sidebar location",type:"combo",options:["left","right"],defaultValue:"left"},{id:"Comfy.Sidebar.Size",category:["Appearance","Sidebar","Size"],name:"Sidebar size",type:"combo",options:["normal","small"],defaultValue:n(()=>window.innerWidth<1536?"small":"normal","defaultValue")},{id:"Comfy.Sidebar.UnifiedWidth",category:["Appearance","Sidebar","UnifiedWidth"],name:"Unified sidebar width",type:"boolean",defaultValue:!0,versionAdded:"1.18.1"},{id:"Comfy.Sidebar.Style",category:["Appearance","Sidebar","Style"],name:"Sidebar style",type:"combo",options:["floating","connected"],defaultValue:"connected"},{id:"Comfy.TextareaWidget.FontSize",category:["Appearance","Node Widget","TextareaWidget","FontSize"],name:"Textarea widget font size",type:"slider",defaultValue:10,attrs:{min:8,max:24}},{id:"Comfy.TextareaWidget.Spellcheck",category:["Comfy","Node Widget","TextareaWidget","Spellcheck"],name:"Textarea widget spellcheck",type:"boolean",defaultValue:!1},{id:"Comfy.Workflow.SortNodeIdOnSave",name:"Sort node IDs when saving workflow",type:"boolean",defaultValue:!1},{id:"Comfy.Canvas.NavigationMode",category:["LiteGraph","Canvas Navigation","NavigationMode"],name:"Navigation Mode",defaultValue:"legacy",type:"combo",sortOrder:100,options:[{value:"standard",text:"Standard (New)"},{value:"legacy",text:"Drag Navigation"},{value:"custom",text:"Custom"}],versionAdded:"1.25.0",defaultsByInstallVersion:{"1.25.0":"legacy"},onChange:n(async(e,t)=>{if(!t)return;const o=Z();e==="standard"?(await o.set("Comfy.Canvas.LeftMouseClickBehavior","select"),await o.set("Comfy.Canvas.MouseWheelScroll","panning")):e==="legacy"&&(await o.set("Comfy.Canvas.LeftMouseClickBehavior","panning"),await o.set("Comfy.Canvas.MouseWheelScroll","zoom"))},"onChange")},{id:"Comfy.Canvas.LeftMouseClickBehavior",category:["LiteGraph","Canvas Navigation","LeftMouseClickBehavior"],name:"Left Mouse Click Behavior",defaultValue:"panning",type:"radio",sortOrder:50,options:[{value:"panning",text:"Panning"},{value:"select",text:"Select"}],versionAdded:"1.27.4",onChange:n(async e=>{const t=Z(),o=t.get("Comfy.Canvas.NavigationMode");if(o!=="custom"){if(e==="select"&&o==="standard"||e==="panning"&&o==="legacy")return;await t.set("Comfy.Canvas.NavigationMode","custom")}},"onChange")},{id:"Comfy.Canvas.MouseWheelScroll",category:["LiteGraph","Canvas Navigation","MouseWheelScroll"],name:"Mouse Wheel Scroll",defaultValue:"zoom",type:"radio",options:[{value:"panning",text:"Panning"},{value:"zoom",text:"Zoom in/out"}],versionAdded:"1.27.4",onChange:n(async e=>{const t=Z(),o=t.get("Comfy.Canvas.NavigationMode");if(o!=="custom"){if(e==="panning"&&o==="standard"||e==="zoom"&&o==="legacy")return;await t.set("Comfy.Canvas.NavigationMode","custom")}},"onChange")},{id:"Comfy.Graph.CanvasInfo",category:["LiteGraph","Canvas","CanvasInfo"],name:"Show canvas info on bottom left corner (fps, etc.)",type:"boolean",defaultValue:!0},{id:"Comfy.Node.ShowDeprecated",name:"Show deprecated nodes in search",tooltip:"Deprecated nodes are hidden by default in the UI, but remain functional in existing workflows that use them.",type:"boolean",defaultValue:!1},{id:"Comfy.Node.ShowExperimental",name:"Show experimental nodes in search",tooltip:"Experimental nodes are marked as such in the UI and may be subject to significant changes or removal in future versions. Use with caution in production workflows",type:"boolean",defaultValue:!0},{id:"Comfy.Node.Opacity",category:["Appearance","Node","Opacity"],name:"Node opacity",type:"slider",defaultValue:1,attrs:{min:.01,max:1,step:.01}},{id:"Comfy.Workflow.ShowMissingNodesWarning",name:"Show missing nodes warning",type:"boolean",defaultValue:!0},{id:"Comfy.Workflow.ShowMissingModelsWarning",name:"Show missing models warning",type:"boolean",defaultValue:!0,experimental:!0},{id:"Comfy.Workflow.WarnBlueprintOverwrite",name:"Require confirmation to overwrite an existing subgraph blueprint",type:"boolean",defaultValue:!0},{id:"Comfy.Graph.ZoomSpeed",category:["LiteGraph","Canvas","ZoomSpeed"],name:"Canvas zoom speed",type:"slider",defaultValue:1.1,attrs:{min:1.01,max:2.5,step:.01}},{id:"Comfy.NodeLibrary.Bookmarks",name:"Node library bookmarks with display name (deprecated)",type:"hidden",defaultValue:[],deprecated:!0},{id:"Comfy.NodeLibrary.Bookmarks.V2",name:"Node library bookmarks v2 with unique name",type:"hidden",defaultValue:[]},{id:"Comfy.NodeLibrary.BookmarksCustomization",name:"Node library bookmarks customization",type:"hidden",defaultValue:{}},{id:"Comfy.Queue.ImageFit",name:"Queue image fit",type:"hidden",defaultValue:"cover"},{id:"Comfy.GroupSelectedNodes.Padding",category:["LiteGraph","Group","Padding"],name:"Group selected nodes padding",type:"slider",defaultValue:10,attrs:{min:0,max:100}},{id:"Comfy.Node.DoubleClickTitleToEdit",category:["LiteGraph","Node","DoubleClickTitleToEdit"],name:"Double click node title to edit",type:"boolean",defaultValue:!0},{id:"Comfy.Node.AllowImageSizeDraw",category:["LiteGraph","Node Widget","AllowImageSizeDraw"],name:"Show width  height below the image preview",type:"boolean",defaultValue:!0},{id:"Comfy.Group.DoubleClickTitleToEdit",category:["LiteGraph","Group","DoubleClickTitleToEdit"],name:"Double click group title to edit",type:"boolean",defaultValue:!0},{id:"Comfy.Window.UnloadConfirmation",name:"Show confirmation when closing window",type:"boolean",defaultValue:!0,versionModified:"1.7.12"},{id:"Comfy.TreeExplorer.ItemPadding",category:["Appearance","Tree Explorer","ItemPadding"],name:"Tree explorer item padding",type:"slider",defaultValue:2,attrs:{min:0,max:8,step:1}},{id:"Comfy.ModelLibrary.AutoLoadAll",name:"Automatically load all model folders",tooltip:"If true, all folders will load as soon as you open the model library (this may cause delays while it loads). If false, root level model folders will only load once you click on them.",type:"boolean",defaultValue:!1},{id:"Comfy.ModelLibrary.NameFormat",name:"What name to display in the model library tree view",tooltip:'Select "filename" to render a simplified view of the raw filename (without directory or ".safetensors" extension) in the model list. Select "title" to display the configurable model metadata title.',type:"combo",options:["filename","title"],defaultValue:"title"},{id:"Comfy.Locale",name:"Language",type:"combo",options:[{value:"en",text:"English"},{value:"zh",text:""},{value:"zh-TW",text:""},{value:"ru",text:""},{value:"ja",text:""},{value:"ko",text:""},{value:"fr",text:"Franais"},{value:"es",text:"Espaol"},{value:"ar",text:""},{value:"tr",text:"Trke"}],defaultValue:n(()=>navigator.language.split("-")[0]||"en","defaultValue")},{id:"Comfy.NodeBadge.NodeSourceBadgeMode",category:["LiteGraph","Node","NodeSourceBadgeMode"],name:"Node source badge mode",type:"combo",options:Object.values(Ke),defaultValue:Ke.HideBuiltIn},{id:"Comfy.NodeBadge.NodeIdBadgeMode",category:["LiteGraph","Node","NodeIdBadgeMode"],name:"Node ID badge mode",type:"combo",options:[Ke.None,Ke.ShowAll],defaultValue:Ke.None},{id:"Comfy.NodeBadge.NodeLifeCycleBadgeMode",category:["LiteGraph","Node","NodeLifeCycleBadgeMode"],name:"Node life cycle badge mode",type:"combo",options:[Ke.None,Ke.ShowAll],defaultValue:Ke.ShowAll},{id:"Comfy.NodeBadge.ShowApiPricing",category:["Comfy","API Nodes"],name:"Show API node pricing badge",type:"boolean",defaultValue:!0,versionAdded:"1.20.3"},{id:"Comfy.Notification.ShowVersionUpdates",category:["Comfy","Notification Preferences"],name:"Show version updates",tooltip:"Show updates for new models, and major new features.",type:"boolean",defaultValue:!0},{id:"Comfy.ConfirmClear",category:["Comfy","Workflow","ConfirmClear"],name:"Require confirmation when clearing workflow",type:"boolean",defaultValue:!0},{id:"Comfy.PromptFilename",category:["Comfy","Workflow","PromptFilename"],name:"Prompt for filename when saving workflow",type:"boolean",defaultValue:!0},{id:"Comfy.PreviewFormat",category:["LiteGraph","Node Widget","PreviewFormat"],name:"Preview image format",tooltip:"When displaying a preview in the image widget, convert it to a lightweight image, e.g. webp, jpeg, webp;50, etc.",type:"text",defaultValue:""},{id:"Comfy.DisableSliders",category:["LiteGraph","Node Widget","DisableSliders"],name:"Disable node widget sliders",type:"boolean",defaultValue:!1},{id:"Comfy.DisableFloatRounding",category:["LiteGraph","Node Widget","DisableFloatRounding"],name:"Disable default float widget rounding.",tooltip:"(requires page reload) Cannot disable round when round is set by the node in the backend.",type:"boolean",defaultValue:!1},{id:"Comfy.FloatRoundingPrecision",category:["LiteGraph","Node Widget","FloatRoundingPrecision"],name:"Float widget rounding decimal places [0 = auto].",tooltip:"(requires page reload)",type:"slider",attrs:{min:0,max:6,step:1},defaultValue:0},{id:"LiteGraph.Node.TooltipDelay",name:"Tooltip Delay",type:"number",attrs:{min:100,max:3e3,step:50},defaultValue:500,versionAdded:"1.9.0"},{id:"Comfy.EnableTooltips",category:["LiteGraph","Node","EnableTooltips"],name:"Enable Tooltips",type:"boolean",defaultValue:!0},{id:"Comfy.DevMode",name:"Enable dev mode options (API save, etc.)",type:"boolean",defaultValue:!1,onChange:n(e=>{const t=document.getElementById("comfy-dev-save-api-button");t&&(t.style.display=e?"flex":"none")},"onChange")},{id:"Comfy.UseNewMenu",category:["Comfy","Menu","UseNewMenu"],defaultValue:"Top",name:"Use new menu",type:"combo",options:["Disabled","Top"],tooltip:"Menu bar position. On mobile devices, the menu is always shown at the top.",migrateDeprecatedValue:n(e=>e==="Floating"||e==="Bottom"?"Top":e,"migrateDeprecatedValue")},{id:"Comfy.Workflow.WorkflowTabsPosition",name:"Opened workflows position",type:"combo",options:["Sidebar","Topbar"],defaultValue:"Topbar",migrateDeprecatedValue:n(e=>e==="Topbar (2nd-row)"?"Topbar":e,"migrateDeprecatedValue")},{id:"Comfy.Graph.CanvasMenu",category:["LiteGraph","Canvas","CanvasMenu"],name:"Show graph canvas menu",type:"boolean",defaultValue:!0},{id:"Comfy.QueueButton.BatchCountLimit",name:"Batch count limit",tooltip:"The maximum number of tasks added to the queue at one button click",type:"number",defaultValue:100,versionAdded:"1.3.5"},{id:"Comfy.Keybinding.UnsetBindings",name:"Keybindings unset by the user",type:"hidden",defaultValue:[],versionAdded:"1.3.7",versionModified:"1.7.3",migrateDeprecatedValue:n(e=>e.map(t=>(t.targetSelector==="#graph-canvas"&&(t.targetElementId="graph-canvas-container"),t)),"migrateDeprecatedValue")},{id:"Comfy.Keybinding.NewBindings",name:"Keybindings set by the user",type:"hidden",defaultValue:[],versionAdded:"1.3.7"},{id:"Comfy.Extension.Disabled",name:"Disabled extension names",type:"hidden",defaultValue:[],versionAdded:"1.3.11"},{id:"Comfy.LinkRenderMode",category:["LiteGraph","Graph","LinkRenderMode"],name:"Link Render Mode",defaultValue:2,type:"combo",options:[{value:le.STRAIGHT_LINK,text:"Straight"},{value:le.LINEAR_LINK,text:"Linear"},{value:le.SPLINE_LINK,text:"Spline"},{value:le.HIDDEN_LINK,text:"Hidden"}]},{id:"Comfy.Node.AutoSnapLinkToSlot",category:["LiteGraph","Node","AutoSnapLinkToSlot"],name:"Auto snap link to node slot",tooltip:"When dragging a link over a node, the link automatically snap to a viable input slot on the node",type:"boolean",defaultValue:!0,versionAdded:"1.3.29"},{id:"Comfy.Node.SnapHighlightsNode",category:["LiteGraph","Node","SnapHighlightsNode"],name:"Snap highlights node",tooltip:"When dragging a link over a node with viable input slot, highlight the node",type:"boolean",defaultValue:!0,versionAdded:"1.3.29"},{id:"Comfy.Node.BypassAllLinksOnDelete",category:["LiteGraph","Node","BypassAllLinksOnDelete"],name:"Keep all links when deleting nodes",tooltip:"When deleting a node, attempt to reconnect all of its input and output links (bypassing the deleted node)",type:"boolean",defaultValue:!0,versionAdded:"1.3.40"},{id:"Comfy.Node.MiddleClickRerouteNode",category:["LiteGraph","Node","MiddleClickRerouteNode"],name:"Middle-click creates a new Reroute node",type:"boolean",defaultValue:!0,versionAdded:"1.3.42"},{id:"Comfy.Graph.LinkMarkers",category:["LiteGraph","Link","LinkMarkers"],name:"Link midpoint markers",defaultValue:so.Circle,type:"combo",options:[{value:so.None,text:"None"},{value:so.Circle,text:"Circle"},{value:so.Arrow,text:"Arrow"}],versionAdded:"1.3.42"},{id:"Comfy.DOMClippingEnabled",category:["LiteGraph","Node","DOMClippingEnabled"],name:"Enable DOM element clipping (enabling may reduce performance)",type:"boolean",defaultValue:!0},{id:"Comfy.Graph.CtrlShiftZoom",category:["LiteGraph","Canvas","CtrlShiftZoom"],name:"Enable fast-zoom shortcut (Ctrl + Shift + Drag)",type:"boolean",defaultValue:!0,versionAdded:"1.4.0"},{id:"Comfy.Pointer.ClickDrift",category:["LiteGraph","Pointer","ClickDrift"],name:"Pointer click drift (maximum distance)",tooltip:`If the pointer moves more than this distance while holding a button down, it is considered dragging (rather than clicking).

Helps prevent objects from being unintentionally nudged if the pointer is moved whilst clicking.`,experimental:!0,type:"slider",attrs:{min:0,max:20,step:1},defaultValue:6,versionAdded:"1.4.3"},{id:"Comfy.Pointer.ClickBufferTime",category:["LiteGraph","Pointer","ClickBufferTime"],name:"Pointer click drift delay",tooltip:`After pressing a pointer button down, this is the maximum time (in milliseconds) that pointer movement can be ignored for.

Helps prevent objects from being unintentionally nudged if the pointer is moved whilst clicking.`,experimental:!0,type:"slider",attrs:{min:0,max:1e3,step:25},defaultValue:150,versionAdded:"1.4.3"},{id:"Comfy.Pointer.DoubleClickTime",category:["LiteGraph","Pointer","DoubleClickTime"],name:"Double click interval (maximum)",tooltip:"The maximum time in milliseconds between the two clicks of a double-click.  Increasing this value may assist if double-clicks are sometimes not registered.",type:"slider",attrs:{min:100,max:1e3,step:50},defaultValue:300,versionAdded:"1.4.3"},{id:"Comfy.SnapToGrid.GridSize",category:["LiteGraph","Canvas","GridSize"],name:"Snap to grid size",type:"slider",attrs:{min:1,max:500},tooltip:"When dragging and resizing nodes while holding shift they will be aligned to the grid, this controls the size of that grid.",defaultValue:le.CANVAS_GRID_SIZE},{id:"pysssss.SnapToGrid",category:["LiteGraph","Canvas","AlwaysSnapToGrid"],name:"Always snap to grid",type:"boolean",defaultValue:!1,versionAdded:"1.3.13"},{id:"Comfy.Server.ServerConfigValues",name:"Server config values for frontend display",tooltip:"Server config values used for frontend display only",type:"hidden",defaultValue:{},versionAdded:"1.4.8"},{id:"Comfy.Server.LaunchArgs",name:"Server launch arguments",tooltip:"These are the actual arguments that are passed to the server when it is launched.",type:"hidden",defaultValue:{},versionAdded:"1.4.8"},{id:"Comfy.Queue.MaxHistoryItems",name:"Queue history size",tooltip:"The maximum number of tasks that show in the queue history.",type:"slider",attrs:{min:2,max:256,step:2},defaultValue:64,versionAdded:"1.4.12"},{id:"LiteGraph.Canvas.MaximumFps",name:"Maximum FPS",tooltip:"The maximum frames per second that the canvas is allowed to render. Caps GPU usage at the cost of smoothness. If 0, the screen refresh rate is used. Default: 0",type:"slider",attrs:{min:0,max:120},defaultValue:0,versionAdded:"1.5.1"},{id:"Comfy.EnableWorkflowViewRestore",category:["Comfy","Workflow","EnableWorkflowViewRestore"],name:"Save and restore canvas position and zoom level in workflows",type:"boolean",defaultValue:!0,versionModified:"1.5.4"},{id:"Comfy.Workflow.ConfirmDelete",name:"Show confirmation when deleting workflows",type:"boolean",defaultValue:!0,versionAdded:"1.5.6"},{id:"Comfy.ColorPalette",name:"The active color palette id",type:"hidden",defaultValue:"dark",versionModified:"1.6.7",migrateDeprecatedValue(e){return e.startsWith("custom_")?e.replace("custom_",""):e}},{id:"Comfy.CustomColorPalettes",name:"Custom color palettes",type:"hidden",defaultValue:{},versionModified:"1.6.7"},{id:"Comfy.WidgetControlMode",category:["Comfy","Node Widget","WidgetControlMode"],name:"Widget control mode",tooltip:"Controls when widget values are updated (randomize/increment/decrement), either before the prompt is queued or after.",type:"combo",defaultValue:"after",options:["before","after"],versionModified:"1.6.10"},{id:"Comfy.TutorialCompleted",name:"Tutorial completed",type:"hidden",defaultValue:!1,versionAdded:"1.8.7"},{id:"Comfy.InstalledVersion",name:"The frontend version that was running when the user first installed ComfyUI",type:"hidden",defaultValue:null,versionAdded:"1.24.0"},{id:"LiteGraph.ContextMenu.Scaling",name:"Scale node combo widget menus (lists) when zoomed in",defaultValue:!1,type:"boolean",versionAdded:"1.8.8"},{id:"LiteGraph.Canvas.LowQualityRenderingZoomThreshold",type:"hidden",deprecated:!0,name:"Low quality rendering zoom threshold (deprecated)",tooltip:"Zoom level threshold for performance mode. Lower values (0.1) = quality at all zoom levels. Higher values (1.0) = performance mode even when zoomed in. Performance mode simplifies rendering by hiding text labels, shadows, and details.",attrs:{min:.1,max:1,step:.01},defaultValue:.6,versionAdded:"1.9.1",versionModified:"1.26.7"},{id:"LiteGraph.Canvas.MinFontSizeForLOD",name:"Zoom Node Level of Detail - font size threshold",tooltip:"Controls when the nodes switch to low quality LOD rendering. Uses font size in pixels to determine when to switch. Set to 0 to disable. Values 1-24 set the minimum font size threshold for LOD - higher values (24px) = switch nodes to simplified rendering sooner when zooming out, lower values (1px) = maintain full node quality longer.",type:"slider",attrs:{min:0,max:24,step:1},defaultValue:8,versionAdded:"1.26.7"},{id:"Comfy.Canvas.SelectionToolbox",category:["LiteGraph","Canvas","SelectionToolbox"],name:"Show selection toolbox",type:"boolean",defaultValue:!0,versionAdded:"1.10.5"},{id:"LiteGraph.Reroute.SplineOffset",name:"Reroute spline offset",tooltip:"The bezier control point offset from the reroute centre point",type:"slider",defaultValue:20,attrs:{min:0,max:400},versionAdded:"1.15.7"},{id:"Comfy.Toast.DisableReconnectingToast",name:"Disable toasts when reconnecting or reconnected",type:"hidden",defaultValue:!1,versionAdded:"1.15.12"},{id:"Comfy.Minimap.Visible",name:"Display minimap on canvas",type:"hidden",defaultValue:window.innerWidth>=Aa.lg,versionAdded:"1.25.0"},{id:"Comfy.Minimap.NodeColors",name:"Display node with its original color on minimap",type:"hidden",defaultValue:!1,versionAdded:"1.26.0"},{id:"Comfy.Minimap.ShowLinks",name:"Display links on minimap",type:"hidden",defaultValue:!0,versionAdded:"1.26.0"},{id:"Comfy.Minimap.ShowGroups",name:"Display node groups on minimap",type:"hidden",defaultValue:!0,versionAdded:"1.26.0"},{id:"Comfy.Minimap.RenderBypassState",name:"Render bypass state on minimap",type:"hidden",defaultValue:!0,versionAdded:"1.26.0"},{id:"Comfy.Minimap.RenderErrorState",name:"Render error state on minimap",type:"hidden",defaultValue:!0,versionAdded:"1.26.0"},{id:"Comfy.Workflow.AutoSaveDelay",name:"Auto Save Delay (ms)",defaultValue:1e3,type:"number",tooltip:'Only applies if Auto Save is set to "after delay".',versionAdded:"1.16.0"},{id:"Comfy.Workflow.AutoSave",name:"Auto Save",type:"combo",options:["off","after delay"],defaultValue:"off",versionAdded:"1.16.0"},{id:"Comfy.Workflow.Persist",name:"Persist workflow state and restore on page (re)load",type:"boolean",defaultValue:!0,versionAdded:"1.16.1"},{id:"LiteGraph.Node.DefaultPadding",name:"Always shrink new nodes",tooltip:"Resize nodes to the smallest possible size when created. When disabled, a newly added node will be widened slightly to show widget values.",type:"boolean",defaultValue:!1,versionAdded:"1.18.0"},{id:"Comfy.Canvas.BackgroundImage",category:["Appearance","Canvas","Background"],name:"Canvas background image",type:"backgroundImage",tooltip:'Image URL for the canvas background. You can right-click an image in the outputs panel and select "Set as Background" to use it, or upload your own image using the upload button.',defaultValue:"",versionAdded:"1.20.4",versionModified:"1.20.5"},{id:"Comfy.Release.Version",name:"Last seen release version",type:"hidden",defaultValue:""},{id:"Comfy.Release.Status",name:"Release status",type:"hidden",defaultValue:"skipped"},{id:"Comfy.Release.Timestamp",name:"Release seen timestamp",type:"hidden",defaultValue:0},{id:"Comfy.Templates.SelectedModels",name:"Template library - Selected model filters",type:"hidden",defaultValue:[]},{id:"Comfy.Templates.SelectedUseCases",name:"Template library - Selected use case filters",type:"hidden",defaultValue:[]},{id:"Comfy.Templates.SelectedRunsOn",name:"Template library - Selected runs on filters",type:"hidden",defaultValue:[]},{id:"Comfy.Templates.SortBy",name:"Template library - Sort preference",type:"hidden",defaultValue:"newest"},{id:"Comfy.VueNodes.Enabled",name:"Modern Node Design (Vue Nodes)",type:"boolean",tooltip:"Modern: DOM-based rendering with enhanced interactivity, native browser features, and updated visual design. Classic: Traditional canvas rendering.",defaultValue:!1,experimental:!0,versionAdded:"1.27.1"},{id:"Comfy.VueNodes.AutoScaleLayout",name:"Auto-scale layout (Vue nodes)",tooltip:"Automatically scale node positions when switching to Vue rendering to prevent overlap",type:"boolean",experimental:!0,defaultValue:!0,versionAdded:"1.30.3"},{id:"Comfy.Assets.UseAssetAPI",name:"Use Asset API for model library",type:"hidden",tooltip:"Use new Asset API for model browsing",defaultValue:!1,experimental:!0}];function Iv(){const e=_e(),t=Z(),o=Qe(),s=b(()=>t.get("Comfy.Workflow.AutoSave")),l=b(()=>t.get("Comfy.Workflow.AutoSaveDelay"));let a=null,i=!1,r=!1;const u=n(()=>{if(a&&(clearTimeout(a),a=null),s.value==="after delay"){if(i){r=!0;return}const p=l.value;a=setTimeout(async()=>{const g=e.activeWorkflow;if(g?.isModified&&g.isPersisted)try{i=!0,await o.saveWorkflow(g)}catch(c){console.error("Auto save failed:",c)}finally{i=!1,r&&(r=!1,u())}},p)}},"scheduleAutoSave");J(s,p=>{a&&(clearTimeout(a),a=null),p==="after delay"&&e.activeWorkflow?.isModified&&u()},{immediate:!0});const d=n(()=>{u()},"onGraphChanged");ve.addEventListener("graphChanged",d),at(()=>{a&&(clearTimeout(a),a=null),ve.removeEventListener("graphChanged",d)})}n(Iv,"useWorkflowAutoSave");function Mv(){const e=us(),t=cs(),{t:o}=he(),s=yn(),l=Ss(),a=ts.TEMPLATE,i=n(d=>/^[a-zA-Z0-9_-]+$/.test(d),"isValidParameter"),r=n(()=>{const d={...e.query};delete d.template,delete d.source,t.replace({query:d})},"cleanupUrlParams");return{loadTemplateFromUrl:n(async()=>{const d=e.query.template;if(!d||typeof d!="string")return;if(!i(d)){console.warn(`[useTemplateUrlLoader] Invalid template parameter format: ${d}`);return}const p=e.query.source||"default";if(!i(p)){console.warn(`[useTemplateUrlLoader] Invalid source parameter format: ${p}`);return}try{await l.loadTemplates(),await l.loadWorkflowTemplate(d,p)||s.add({severity:"error",summary:o("g.error"),detail:o("templateWorkflows.error.templateNotFound",{templateName:d}),life:3e3})}catch(g){console.error("[useTemplateUrlLoader] Failed to load template from URL:",g),s.add({severity:"error",summary:o("g.error"),detail:o("g.errorLoadingTemplate"),life:3e3})}finally{r(),Hi(a)}},"loadTemplateFromUrl")}}n(Mv,"useTemplateUrlLoader");function Rv(){const e=_e(),t=Z(),o=us(),s=cs(),l=Mv(),a=ts.TEMPLATE,i=n(async()=>{ji(a);const S=qi(a,o.query);return S&&await s.replace({query:S}),S??o.query},"ensureTemplateQueryFromIntent"),r=b(()=>t.get("Comfy.Workflow.Persist")),u=n(()=>{if(!r.value)return;const S=JSON.stringify(F.graph.serialize());try{localStorage.setItem("workflow",S),ve.clientId&&sessionStorage.setItem(`workflow:${ve.clientId}`,S)}catch($){const _=Object.keys(sessionStorage).filter(P=>P.startsWith("workflow:")||P==="workflow");throw console.error("QuotaExceededError details:",{workflowSizeKB:Math.round(S.length/1024),totalStorageItems:Object.keys(sessionStorage).length,ourWorkflowKeys:_.length,ourWorkflowSizes:_.map(P=>({key:P,sizeKB:Math.round(sessionStorage[P].length/1024)})),error:$ instanceof Error?$.message:String($)}),$}},"persistCurrentWorkflow"),d=n(async(S,$)=>{if(!S)return!1;const _=JSON.parse(S);return await F.loadGraphData(_,!0,!0,$),!0},"loadWorkflowFromStorage"),p=n(async()=>{const S=qo("Comfy.PreviousWorkflow"),$=ve.initialClientId??ve.clientId;if($){const P=sessionStorage.getItem(`workflow:${$}`);if(await d(P,S))return!0}const _=localStorage.getItem("workflow");return await d(_,S)},"loadPreviousWorkflowFromStorage"),g=n(async()=>{t.get("Comfy.TutorialCompleted")?await F.loadGraphData():(await t.set("Comfy.TutorialCompleted",!0),await Qe().loadBlankWorkflow(),await be().execute("Comfy.BrowseTemplates"))},"loadDefaultWorkflow"),c=n(async()=>{if(r.value)try{await p()||await g()}catch(S){console.error("Error loading previous workflow",S),await g()}},"initializeWorkflow"),f=n(async()=>{const S=await i();S.template&&typeof S.template=="string"&&await l.loadTemplateFromUrl()},"loadTemplateFromUrlIfPresent");J(()=>e.activeWorkflow?.key,S=>{S&&(jo("Comfy.PreviousWorkflow",S),u())}),ve.addEventListener("graphChanged",u),La(()=>{ve.removeEventListener("graphChanged",u)});const v=b(()=>e.openWorkflows),C=b(()=>e.activeWorkflow),m=b(()=>{if(!v.value||!C.value)return{paths:[],activeIndex:-1};const S=v.value.filter(_=>_?.isPersisted).map(_=>_.path),$=v.value.findIndex(_=>_.path===C.value?.path);return{paths:S,activeIndex:$}}),h=JSON.parse(qo("Comfy.OpenWorkflowsPaths")||"[]"),k=JSON.parse(qo("Comfy.ActiveWorkflowIndex")||"-1");return J(m,({paths:S,activeIndex:$})=>{r.value&&(jo("Comfy.OpenWorkflowsPaths",JSON.stringify(S)),jo("Comfy.ActiveWorkflowIndex",JSON.stringify($)))}),{initializeWorkflow:c,loadTemplateFromUrlIfPresent:f,restoreWorkflowTabsState:n(()=>{if(!r.value)return;h?.length>0&&k>=0&&e.openWorkflowsInBackground({left:h.slice(0,k),right:h.slice(k)})},"restoreWorkflowTabsState")}}n(Rv,"useWorkflowPersistence");const Bn=Symbol("transformState");function Pv(e,t={}){const{settleDelay:o=200,passive:s=!0}=t,l=R(!1),a=n(()=>{l.value=!0},"markTransformActive"),i=Hs(()=>{l.value=!1},o);return xe(e,"wheel",n(()=>{a(),i()},"handleWheel"),{capture:!0,passive:s}),{isTransforming:l}}n(Pv,"useTransformSettling");const Dv=n(()=>{const e=gn({x:0,y:0,z:1}),t=b(()=>({transform:`scale(${e.z}) translate(${e.x}px, ${e.y}px)`,transformOrigin:"0 0"})),o=n(c=>{!c||!c.ds||(e.x=c.ds.offset[0],e.y=c.ds.offset[1],e.z=c.ds.scale||1)},"syncWithCanvas"),s=n(c=>({x:(c.x+e.x)*e.z,y:(c.y+e.y)*e.z}),"canvasToScreen"),l=n(c=>({x:c.x/e.z-e.x,y:c.y/e.z-e.y}),"screenToCanvas"),a=n((c,f)=>{const v=s({x:c[0],y:c[1]}),C=f[0]*e.z,m=f[1]*e.z;return new DOMRect(v.x,v.y,C,m)},"getNodeScreenBounds"),i=n(c=>e.z<.1?Math.min(c*5,2):e.z>3?Math.max(c*.5,.05):c,"calculateAdjustedMargin"),r=n(c=>Math.max(c[0],c[1])*e.z<4,"isNodeTooSmall"),u=n((c,f)=>{const v=c.width*f,C=c.height*f;return{left:-v,right:c.width+v,top:-C,bottom:c.height+C}},"getExpandedViewportBounds"),d=n((c,f,v)=>{const C=c.x+f[0]*e.z,m=c.y+f[1]*e.z;return!(C<v.left||c.x>v.right||m<v.top||c.y>v.bottom)},"testViewportIntersection"),p=n((c,f,v,C=.2)=>{if(r(f))return!1;const m=s({x:c[0],y:c[1]}),h=i(C),k=u(v,h);return d(m,f,k)},"isNodeInViewport"),g=n((c,f=.2)=>{const v=c.width*f,C=c.height*f,m=l({x:-v,y:-C}),h=l({x:c.width+v,y:c.height+C});return{x:m.x,y:m.y,width:h.x-m.x,height:h.y-m.y}},"getViewportBounds");return{camera:ko(e),transformStyle:t,syncWithCanvas:o,canvasToScreen:s,screenToCanvas:l,getNodeScreenBounds:a,isNodeInViewport:p,getViewportBounds:g}},"useTransformState");function Av(e){return{isLOD:b(()=>{const{pixelRatio:o}=js(),s=14,l=Math.sqrt(o.value),i=Z().get("LiteGraph.Canvas.MinFontSizeForLOD"),r=Math.round(i/(s*l)*100)/100;return e.z<r})}}n(Av,"useLOD");const Lv=j({__name:"TransformPane",props:{canvas:{}},emits:["transformUpdate"],setup(e,{emit:t}){const o=e,{camera:s,transformStyle:l,syncWithCanvas:a,canvasToScreen:i,screenToCanvas:r,isNodeInViewport:u}=Dv(),{isLOD:d}=Av(s),p=b(()=>o.canvas?.canvas),{isTransforming:g}=Pv(p,{settleDelay:512});Io(Bn,{camera:s,canvasToScreen:i,screenToCanvas:r,isNodeInViewport:u});const c=t;return Jt(()=>{o.canvas&&(a(o.canvas),c("transformUpdate"))},{immediate:!0}),(f,v)=>(y(),I("div",{"data-testid":"transform-pane",class:K(w(re)("absolute inset-0 w-full h-full pointer-events-none",w(g)?"transform-pane--interacting":"will-change-auto",w(d)&&"isLOD")),style:me(w(l))},[Ne(f.$slots,"default",{},void 0,!0)],6))}}),Ev=we(Lv,[["__scopeId","data-v-f76f8040"]]),Vv={class:"flex items-center gap-2"},Wv={for:"node-colors"},Ov={class:"flex items-center gap-2"},Bv={for:"show-links"},zv={class:"flex items-center gap-2"},Uv={for:"show-groups"},Fv={class:"flex items-center gap-2"},Gv={for:"render-bypass"},Hv={class:"flex items-center gap-2"},jv={for:"render-error"},qv=j({__name:"MiniMapPanel",props:{panelStyles:{},nodeColors:{type:Boolean},showLinks:{type:Boolean},showGroups:{type:Boolean},renderBypass:{type:Boolean},renderError:{type:Boolean}},emits:["updateOption"],setup(e){return(t,o)=>(y(),I("div",{class:"minimap-panel mr-2 flex flex-col gap-2 bg-comfy-menu-bg p-3 text-sm shadow-interface",style:me(t.panelStyles)},[x("div",Vv,[E(w(Ot),{"input-id":"node-colors",name:"node-colors","model-value":t.nodeColors,binary:"","onUpdate:modelValue":o[0]||(o[0]=s=>t.$emit("updateOption","Comfy.Minimap.NodeColors",s))},null,8,["model-value"]),o[5]||(o[5]=x("i",{class:"icon-[lucide--palette]"},null,-1)),x("label",Wv,H(t.$t("minimap.nodeColors")),1)]),x("div",Ov,[E(w(Ot),{"input-id":"show-links",name:"show-links","model-value":t.showLinks,binary:"","onUpdate:modelValue":o[1]||(o[1]=s=>t.$emit("updateOption","Comfy.Minimap.ShowLinks",s))},null,8,["model-value"]),o[6]||(o[6]=x("i",{class:"icon-[lucide--route]"},null,-1)),x("label",Bv,H(t.$t("minimap.showLinks")),1)]),x("div",zv,[E(w(Ot),{"input-id":"show-groups",name:"show-groups","model-value":t.showGroups,binary:"","onUpdate:modelValue":o[2]||(o[2]=s=>t.$emit("updateOption","Comfy.Minimap.ShowGroups",s))},null,8,["model-value"]),o[7]||(o[7]=x("i",{class:"icon-[lucide--frame]"},null,-1)),x("label",Uv,H(t.$t("minimap.showGroups")),1)]),x("div",Fv,[E(w(Ot),{"input-id":"render-bypass",name:"render-bypass","model-value":t.renderBypass,binary:"","onUpdate:modelValue":o[3]||(o[3]=s=>t.$emit("updateOption","Comfy.Minimap.RenderBypassState",s))},null,8,["model-value"]),o[8]||(o[8]=x("i",{class:"icon-[lucide--circle-slash-2]"},null,-1)),x("label",Gv,H(t.$t("minimap.renderBypassState")),1)]),x("div",Hv,[E(w(Ot),{"input-id":"render-error",name:"render-error","model-value":t.renderError,binary:"","onUpdate:modelValue":o[4]||(o[4]=s=>t.$emit("updateOption","Comfy.Minimap.RenderErrorState",s))},null,8,["model-value"]),o[9]||(o[9]=x("i",{class:"icon-[lucide--message-circle-warning]"},null,-1)),x("label",jv,H(t.$t("minimap.renderErrorState")),1)])],4))}}),Kv=["width","height"],Yv=j({__name:"MiniMap",setup(e){const t=be(),o=R(),{initialized:s,visible:l,containerRef:a,canvasRef:i,containerStyles:r,viewportStyles:u,width:d,height:p,panelStyles:g,nodeColors:c,showLinks:f,showGroups:v,renderBypass:C,renderError:m,updateOption:h,destroy:k,handlePointerDown:T,handlePointerMove:S,handlePointerUp:$,handlePointerCancel:_,handleWheel:P,setMinimapRef:M}=An(),L=R(!1),N=n(()=>{L.value=!L.value},"toggleOptionsPanel");return Me(()=>{o.value&&M(o.value)}),at(()=>{k()}),(B,D)=>w(l)&&w(s)?(y(),I("div",{key:0,ref_key:"minimapRef",ref:o,class:"minimap-main-container absolute right-0 bottom-[54px] z-1000 flex"},[L.value?(y(),O(qv,{key:0,"panel-styles":w(g),"node-colors":w(c),"show-links":w(f),"show-groups":w(v),"render-bypass":w(C),"render-error":w(m),onUpdateOption:w(h)},null,8,["panel-styles","node-colors","show-links","show-groups","render-bypass","render-error","onUpdateOption"])):V("",!0),x("div",{ref_key:"containerRef",ref:a,class:"litegraph-minimap relative border border-interface-stroke bg-comfy-menu-bg shadow-interface",style:me(w(r))},[E(w(ie),{class:"absolute top-1 left-1 z-10 hover:bg-interface-button-hover-surface!",size:"small",text:"",severity:"secondary",onClick:Ee(N,["stop"])},{icon:W(()=>D[7]||(D[7]=[x("i",{class:"icon-[lucide--settings-2]"},null,-1)])),_:1}),E(w(ie),{class:"absolute top-1 right-1 z-10 hover:bg-interface-button-hover-surface!",size:"small",text:"",severity:"secondary","data-testid":"close-minmap-button",onClick:D[0]||(D[0]=Ee(()=>w(t).execute("Comfy.Canvas.ToggleMinimap"),["stop"]))},{icon:W(()=>D[8]||(D[8]=[x("i",{class:"icon-[lucide--x]"},null,-1)])),_:1}),x("hr",{class:"absolute top-7 h-px border-0 bg-node-component-border",style:me({width:w(r).width})},null,4),x("canvas",{ref_key:"canvasRef",ref:i,width:w(d),height:w(p),class:"minimap-canvas"},null,8,Kv),x("div",{class:"minimap-viewport",style:me(w(u))},null,4),x("div",{class:"absolute inset-0 touch-none",onPointerdown:D[1]||(D[1]=(...z)=>w(T)&&w(T)(...z)),onPointermove:D[2]||(D[2]=(...z)=>w(S)&&w(S)(...z)),onPointerup:D[3]||(D[3]=(...z)=>w($)&&w($)(...z)),onPointerleave:D[4]||(D[4]=(...z)=>w($)&&w($)(...z)),onPointercancel:D[5]||(D[5]=(...z)=>w(_)&&w(_)(...z)),onWheel:D[6]||(D[6]=(...z)=>w(P)&&w(P)(...z))},null,32)],4)],512)):V("",!0)}}),Qv=we(Yv,[["__scopeId","data-v-fdf41881"]]);function Zv(e={}){const{layoutSource:t=Pt.Vue}=e,o=Vo();function s(l,a){o.setSource(a??t),o.bringNodeToFront(l)}return n(s,"bringNodeToFront"),{bringNodeToFront:s}}n(Zv,"useNodeZIndex");function Xv(e){let t=0;for(let o=0;o<e.length;o++)if(ot(e[o])&&(t++,t>=2))return!0;return!1}n(Xv,"hasMultipleNodesSelected");function Jv(){const e=ce(),{nodeManager:t}=On(),{bringNodeToFront:o}=Zv(),{shouldHandleNodePointerEvents:s}=wt(),l=n((c,f)=>{if(!s.value||!e.canvas||!t.value)return;const v=t.value.getNode(f.id);if(!v)return;c.ctrlKey||c.metaKey||c.shiftKey?v.selected?e.canvas.deselect(v):e.canvas.select(v):Xv(e.selectedItems)||(e.canvas.deselectAll(),e.canvas.select(v)),v.flags?.pinned||o(f.id),e.updateSelectedItems()},"handleNodeSelect");return{handleNodeSelect:l,handleNodeCollapse:n((c,f)=>{if(!s.value||!t.value)return;const v=t.value.getNode(c);if(!v)return;(v.flags?.collapsed??!1)!==f&&v.collapse()},"handleNodeCollapse"),handleNodeTitleUpdate:n((c,f)=>{if(!s.value||!t.value)return;const v=t.value.getNode(c);v&&(v.title=f)},"handleNodeTitleUpdate"),handleNodeDoubleClick:n((c,f)=>{if(!s.value||!e.canvas||!t.value)return;const v=t.value.getNode(f.id);v&&(c.preventDefault(),v.selected||l(c,f))},"handleNodeDoubleClick"),handleNodeRightClick:n((c,f)=>{if(!s.value||!e.canvas||!t.value)return;const v=t.value.getNode(f.id);v&&(c.preventDefault(),v.selected||l(c,f))},"handleNodeRightClick"),handleNodeDragStart:n((c,f)=>{if(!s.value||!e.canvas||!t.value)return;const v=t.value.getNode(f.id);if(v){if(!v.selected){const C=new PointerEvent("pointerdown",{ctrlKey:c.ctrlKey,metaKey:c.metaKey,bubbles:!0});l(C,f)}c.dataTransfer&&(c.dataTransfer.setData("application/comfy-node-id",f.id),c.dataTransfer.effectAllowed="move")}},"handleNodeDragStart"),selectNodes:n((c,f=!1)=>{s.value&&(!e.canvas||!t.value||(f||e.canvas.deselectAll(),c.forEach(v=>{const C=t.value?.getNode(v);C&&e.canvas&&e.canvas.select(C)}),e.updateSelectedItems()))},"selectNodes"),deselectNodes:n(c=>{s.value&&(!e.canvas||!t.value||(c.forEach(f=>{const v=t.value?.getNode(f);v&&(v.selected=!1)}),e.updateSelectedItems()))},"deselectNodes")}}n(Jv,"useNodeEventHandlersIndividual");const eg=Po(Jv);function $s(){const e=Z(),t=b(()=>e.get("Comfy.SnapToGrid.GridSize")),o=b(()=>e.get("pysssss.SnapToGrid"));function s(i){return i.shiftKey||o.value}n(s,"shouldSnap");function l(i){const r=t.value;if(!r)return{...i};const u=[i.x,i.y];return qn(u,r)?{x:u[0],y:u[1]}:{...i}}n(l,"applySnapToPosition");function a(i){const r=t.value;if(!r)return{...i};const u=[i.width,i.height];return qn(u,r)?{width:u[0],height:u[1]}:{...i}}return n(a,"applySnapToSize"),{gridSize:t,alwaysSnap:o,shouldSnap:s,applySnapToPosition:l,applySnapToSize:a}}n($s,"useNodeSnap");function _s(){const e=rt(!1);let t=null;function o(l){l!==e.value&&(!t&&(t=F.canvas?.canvas??null,!t)||(e.value=l,t.dispatchEvent(new KeyboardEvent(l?"keydown":"keyup",{key:"Shift",shiftKey:l,bubbles:!0}))))}n(o,"syncShiftState");function s(l){o(l.shiftKey);const a=n(u=>{u.key==="Shift"&&o(u.shiftKey)},"handleKeyEvent"),i=xe(window,"keydown",a,{passive:!0}),r=xe(window,"keyup",a,{passive:!0});return()=>{i(),r()}}return n(s,"trackShiftKey"),La(()=>{e.value=!1,t=null}),{trackShiftKey:s}}n(_s,"useShiftKeySync");function Ts(e){const t=bt(e),o=Vo(),{selectedNodeIds:s}=ct(ce()),l=vn(Bn),{shouldSnap:a,applySnapToPosition:i}=$s(),{trackShiftKey:r}=_s(),u=Le.getNodeLayoutRef(t),d=b(()=>u.value?.position??{x:0,y:0}),p=b(()=>u.value?.size??{width:200,height:100}),g=b(()=>u.value?.bounds??{x:d.value.x,y:d.value.y,width:p.value.width,height:p.value.height}),c=b(()=>u.value?.visible??!0),f=b(()=>u.value?.zIndex??0),v=R(!1);let C=null,m=null,h=null,k=null,T=null;function S(M){if(!(!u.value||!l)){if(T=r(M),v.value=!0,C={...d.value},m={x:M.clientX,y:M.clientY},s?.value?.has(t)&&s.value.size>1){h=new Map;for(const L of s.value){if(L===t)continue;const N=Le.getNodeLayoutRef(L).value;N&&h.set(L,{...N.position})}}else h=null;o.setSource(Pt.Vue),M.target instanceof HTMLElement&&M.target.setPointerCapture(M.pointerId)}}n(S,"startDrag");const $=n(M=>{!v.value||!C||!m||!l||k===null&&(k=requestAnimationFrame(()=>{if(k=null,!C||!m||!l)return;const L={x:M.clientX-m.x,y:M.clientY-m.y},N=l.screenToCanvas({x:0,y:0}),B=l.screenToCanvas(L),D={x:B.x-N.x,y:B.y-N.y},z={x:C.x+D.x,y:C.y+D.y};if(o.moveNode(t,z),h&&h.size>0)for(const[U,A]of h){const G={x:A.x+D.x,y:A.y+D.y};o.moveNode(U,G)}}))},"handleDrag");function _(M){if(v.value){if(a(M)){const L=[],N=Le.getNodeLayoutRef(t).value;if(N){const B=N.position,D=i({...B});(D.x!==B.x||D.y!==B.y)&&L.push({nodeId:t,bounds:{x:D.x,y:D.y,width:N.size.width,height:N.size.height}})}if(h&&h.size>0)for(const B of h.keys()){const D=Le.getNodeLayoutRef(B).value;if(D){const z={...D.position},U=i(z);(U.x!==z.x||U.y!==z.y)&&L.push({nodeId:B,bounds:{x:U.x,y:U.y,width:D.size.width,height:D.size.height}})}}L.length>0&&Le.batchUpdateNodeBounds(L)}v.value=!1,C=null,m=null,h=null,T?.(),T=null,k!==null&&(cancelAnimationFrame(k),k=null),M.target instanceof HTMLElement&&M.target.releasePointerCapture(M.pointerId)}}n(_,"endDrag");function P(M){o.setSource(Pt.Vue),o.moveNode(t,M)}return n(P,"moveNodeTo"),{layoutRef:u,position:d,size:p,bounds:g,isVisible:c,zIndex:f,isDragging:v,moveNodeTo:P,startDrag:S,handleDrag:$,endDrag:_,nodeStyle:b(()=>({position:"absolute",left:`${d.value.x}px`,top:`${d.value.y}px`,width:`${p.value.width}px`,height:`${p.value.height}px`,zIndex:f.value,cursor:v.value?"grabbing":"grab"}))}}n(Ts,"useNodeLayout");function tg(e,t){const o=b(()=>{const _=bt(e);return _||(console.warn("useNodePointerInteractions: nodeDataMaybe resolved to null/undefined"),null)}),s=b(()=>o.value?.id??""),{startDrag:l,endDrag:a,handleDrag:i}=Ts(s),{forwardEventToCanvas:r,shouldHandleNodePointerEvents:u}=wt(),d=n(_=>Ki(_)?(r(_),!0):!1,"forwardMiddlePointerIfNeeded"),p=R(!1),g=b(()=>o.value?.flags?.pinned?{cursor:"default"}:{cursor:p.value?"grabbing":"grab"}),c=R({x:0,y:0}),f=n(_=>{if(!o.value){console.warn("LGraphNode: nodeData is null/undefined in handlePointerDown");return}if(!d(_)&&_.button===0){if(!u.value){r(_);return}c.value={x:_.clientX,y:_.clientY},t(_,o.value),!o.value.flags?.pinned&&(p.value=!0,Le.isDraggingVueNodes.value=!0,l(_))}},"handlePointerDown"),v=n(_=>{d(_)||p.value&&i(_)},"handlePointerMove"),C=n(()=>{p.value=!1,Le.isDraggingVueNodes.value=!1},"cleanupDragState"),m=n(async _=>{try{await a(_)}catch(P){console.error("Error during endDrag:",P)}finally{C()}},"safeDragEnd"),h=n((_,P)=>{m(_).catch(M=>{console.error(`Failed to complete ${P}:`,M),C()})},"handleDragTermination"),k=n(_=>{if(!d(_)&&(p.value&&h(_,"drag end"),!u.value)){r(_);return}},"handlePointerUp"),T=n(_=>{p.value&&h(_,"drag cancellation")},"handlePointerCancel"),S=n(_=>{p.value&&(_.preventDefault(),C())},"handleContextMenu");return at(()=>{p.value&&C()}),{isDragging:p,dragStyle:g,pointerHandlers:{onPointerdown:f,onPointermove:v,onPointerup:k,onPointercancel:T,onContextmenu:S}}}n(tg,"useNodePointerInteractions");const No=new Map([["node",{dataAttribute:"nodeId",updateHandler:n(e=>{const t=e.map(({id:o,bounds:s})=>({nodeId:o,bounds:s}));Le.batchUpdateNodeBounds(t)},"updateHandler")}]]),ma=new ResizeObserver(e=>{const t=es(),o=new Map,s=new Set;for(const l of e){if(!(l.target instanceof HTMLElement))continue;const a=l.target;let i,r;for(const[h,k]of No){const T=a.dataset[k.dataAttribute];if(T){i=h,r=T;break}}if(!i||!r)continue;const u=Array.isArray(l.borderBoxSize)?l.borderBoxSize[0]:{inlineSize:l.contentRect.width,blockSize:l.contentRect.height},d=u.inlineSize,p=u.blockSize,g=a.getBoundingClientRect(),[c,f]=t.clientPosToCanvasPos([g.left,g.top]),v={x:c,y:f},C={x:v.x,y:v.y+le.NODE_TITLE_HEIGHT,width:Math.max(0,d),height:Math.max(0,p-le.NODE_TITLE_HEIGHT)};let m=o.get(i);m||(m=[],o.set(i,m)),m.push({id:r,bounds:C}),i==="node"&&r&&s.add(r)}Le.setSource(Pt.Vue);for(const[l,a]of o){const i=No.get(l);i&&a.length&&i.updateHandler(a)}if(s.size>0)for(const l of s)Yi(l)});function og(e,t){const o=bt(e);Me(()=>{const s=Un()?.proxy?.$el;if(!(s instanceof HTMLElement)||!o)return;const l=No.get(t);l&&(s.dataset[l.dataAttribute]=o,ma.observe(s))}),at(()=>{const s=Un()?.proxy?.$el;if(!(s instanceof HTMLElement))return;const l=No.get(t);l&&(delete s.dataset[l.dataAttribute],ma.unobserve(s))})}n(og,"useVueElementTracking");const ng=n(e=>{const t=b(()=>bt(e)??""),{nodeLocationProgressStates:o,isIdle:s}=ct(Ct()),l=b(()=>{const d=t.value;return d?o.value[d]:void 0}),a=b(()=>!s.value&&l.value?.state==="running"),i=b(()=>{const d=l.value;return d&&d.max>0?d.value/d.max:void 0}),r=b(()=>{const d=i.value;return d!==void 0?Math.round(d*100):void 0}),u=b(()=>{const d=l.value;return d?d.state:"idle"});return{executing:a,progress:i,progressPercentage:r,progressState:l,executionState:u}},"useNodeExecutionState"),ag=n((e,t)=>{const o=bt(e),s=_e(),{nodePreviewImages:l}=ct(Dt()),a=b(()=>s.nodeIdToNodeLocatorId(o)),i=b(()=>{const p=a.value;if(!p)return;const g=l.value[p];return g?.length?g:void 0}),r=b(()=>!!i.value?.length),u=b(()=>{const p=i.value;return p?.length?p.at(-1):""}),d=b(()=>t?.isCollapsed?!t.isCollapsed.value&&r.value:r.value);return{locatorId:a,previewUrls:i,hasPreview:r,latestPreviewUrl:u,shouldShowPreviewImg:d}},"useNodePreviewState");function sg(e,t,o){const s=o.horizontal==="right"?1:-1,l=o.vertical==="bottom"?1:-1;return{width:e.width+t.x*s,height:e.height+t.y*l}}n(sg,"applyHandleDelta");function ig(e,t,o,s){const l=t.width-o.width,a=t.height-o.height;return{x:s.horizontal==="left"?e.x+l:e.x,y:s.vertical==="top"?e.y+a:e.y}}n(ig,"computeAdjustedPosition");function lg({startSize:e,startPosition:t,delta:o,handle:s,snapFn:l}){const a=sg(e,o,s),i=l?.(a)??a,r=ig(t,e,i,s);return{size:i,position:r}}n(lg,"computeResizeOutcome");function rg(e){const t={...e.startSize},o={...e.startPosition},s=e.handle;return(l,a)=>lg({startSize:t,startPosition:o,handle:s,delta:l,snapFn:a})}n(rg,"createResizeSession");function ug(e,t,o){const s=o===0?1:o;return{x:(t.x-e.x)/s,y:(t.y-e.y)/s}}n(ug,"toCanvasDelta");function cg(e,t){const{transformState:o}=t,s=R(!1),l=R(null),a=R(null),{shouldSnap:i,applySnapToSize:r}=$s(),{trackShiftKey:u}=_s();return{startResize:n((p,g,c)=>{p.preventDefault(),p.stopPropagation();const f=p.currentTarget;if(!(f instanceof HTMLElement))return;const v=f.closest("[data-node-id]");if(!(v instanceof HTMLElement))return;const C=v.getBoundingClientRect(),m=o.camera.z,h={width:C.width/m,height:C.height/m},k=u(p);f.setPointerCapture(p.pointerId),s.value=!0,l.value={x:p.clientX,y:p.clientY},a.value=rg({startSize:h,startPosition:{...c},handle:g});const T=n(P=>{if(!s.value||!l.value||!a.value)return;const M=l.value,L=a.value,N=ug(M,{x:P.clientX,y:P.clientY},o.camera.z),B=f.closest("[data-node-id]");if(B instanceof HTMLElement){const D=L(N,i(P)?r:void 0);e(D,B)}},"handlePointerMove"),S=n(P=>{s.value&&(s.value=!1,l.value=null,a.value=null,k(),f.releasePointerCapture(P.pointerId),$(),_())},"handlePointerUp"),$=xe("pointermove",T),_=xe("pointerup",S)},"startResize"),isResizing:s}}n(cg,"useNodeResize");const dg={viewBox:"0 0 24 24",width:"1.2em",height:"1.2em"};function pg(e,t){return y(),I("svg",dg,t[0]||(t[0]=[x("g",{fill:"none",stroke:"currentColor","stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2"},[x("path",{d:"m2 2l20 20M10.41 10.41a2 2 0 1 1-2.83-2.83m5.92 5.92L6 21m12-9l3 3"}),x("path",{d:"M3.59 3.59A2 2 0 0 0 3 5v14a2 2 0 0 0 2 2h14c.55 0 1.052-.22 1.41-.59M21 15V5a2 2 0 0 0-2-2H9"})],-1)]))}n(pg,"render");const fg=ka({name:"lucide-image-off",render:pg}),mg={key:0,class:"flex h-full min-h-16 w-full min-w-16 flex-col"},vg={class:"relative h-88 w-full grow overflow-hidden rounded-[5px] bg-node-component-surface"},gg={key:0,class:"text-pure-white flex h-full w-full flex-col items-center justify-center text-center"},hg={class:"text-xs text-smoke-400"},yg=["src","alt"],bg={class:"text-node-component-header-text mt-1 text-center text-xs"},wg=j({__name:"LivePreview",props:{imageUrl:{}},setup(e){const t=e,o=R(null),s=R(!1);J(()=>t.imageUrl,()=>{o.value=null,s.value=!1});const l=n(i=>{if(!i.target||!(i.target instanceof HTMLImageElement))return;const r=i.target;s.value=!1,r.naturalWidth&&r.naturalHeight&&(o.value=`${r.naturalWidth} x ${r.naturalHeight}`)},"handleImageLoad"),a=n(()=>{s.value=!0,o.value=null},"handleImageError");return(i,r)=>{const u=fg;return i.imageUrl?(y(),I("div",mg,[x("div",vg,[s.value?(y(),I("div",gg,[E(u,{class:"mb-1 size-8 text-smoke-500"}),x("p",hg,H(i.$t("g.imageFailedToLoad")),1)])):(y(),I("img",{key:1,src:i.imageUrl,alt:i.$t("g.liveSamplingPreview"),class:"pointer-events-none h-full w-full object-contain object-center",onLoad:l,onError:a},null,40,yg))]),x("div",bg,H(s.value?i.$t("g.errorLoadingImage"):o.value||i.$t("g.calculatingDimensions")),1)])):V("",!0)}}}),Cg={key:0,class:"node-error p-2 text-sm text-red-500"},Sg=["data-node-id"],kg={class:"flex flex-col justify-center items-center relative"},xg={class:"relative mb-1"},$g=["data-testid"],_g={key:1,class:"min-h-0 flex-1 flex"},Tg={key:2,class:"min-h-0 flex-1 px-4"},Ng=["aria-label","onPointerdown"],Ig="absolute h-3 w-3 opacity-0 pointer-events-auto focus-visible:outline focus-visible:outline-2 focus-visible:outline-white/40",va=.01,ga="h-2 bg-primary-500 transition-all duration-300",Mg=j({__name:"LGraphNode",props:{nodeData:{},error:{default:null},zoomLevel:{}},setup(e){const{t}=he(),{handleNodeCollapse:o,handleNodeTitleUpdate:s,handleNodeSelect:l,handleNodeRightClick:a}=eg();og(()=>e.nodeData.id,"node");const i=vn(Bn);if(!i)throw new Error("TransformState must be provided for node resize functionality");const{selectedNodeIds:r}=ct(ce()),u=b(()=>r.value.has(e.nodeData.id)),d=b(()=>Ko(e.nodeData)),{executing:p,progress:g}=ng(d),c=Ct(),f=b(()=>c.lastExecutionErrorNodeId===e.nodeData.id),v=b(()=>!!(f.value||e.nodeData.hasErrors||e.error||(c.lastNodeErrors?.[e.nodeData.id]?.errors.length??0)>0)),C=b(()=>e.nodeData.flags?.collapsed??!1),m=b(()=>e.nodeData.mode===Ie.BYPASS),h=b(()=>e.nodeData.mode===Ie.NEVER),k=b(()=>{const se=Xe();return e.nodeData.bgcolor?Qi(e.nodeData.bgcolor,!!se.completedActivePalette.light_theme):""}),T=b(()=>{const se=Z().get("Comfy.Node.Opacity")??1;return m.value||h.value?se*.5:se}),S=b(()=>Zi(e.nodeData).length>0),$=b(()=>!!e.nodeData.outputs?.length),{handleWheel:_,shouldHandleNodePointerEvents:P}=wt(),M=R(null),{toastErrorHandler:L}=Sn();Ca(se=>(M.value=se.message,L(se),!1));const{position:N,size:B,zIndex:D,moveNodeTo:z}=Ts(()=>e.nodeData.id),{pointerHandlers:U,isDragging:A,dragStyle:G}=tg(()=>e.nodeData,l),q=n(se=>{se.preventDefault(),se.stopPropagation(),a(se,e.nodeData);const de=se.currentTarget;de&&Cs(se,de,!1)},"handleContextMenu");Me(()=>{B.value&&mt.value&&(mt.value.style.setProperty("--node-width",`${B.value.width}px`),mt.value.style.setProperty("--node-height",`${B.value.height}px`))});const Q=[{id:"se",direction:{horizontal:"right",vertical:"bottom"},classes:"right-0 bottom-0 cursor-se-resize",ariaLabel:t("g.resizeFromBottomRight")},{id:"ne",direction:{horizontal:"right",vertical:"top"},classes:"right-0 top-0 cursor-ne-resize",ariaLabel:t("g.resizeFromTopRight")},{id:"sw",direction:{horizontal:"left",vertical:"bottom"},classes:"left-0 bottom-0 cursor-sw-resize",ariaLabel:t("g.resizeFromBottomLeft")},{id:"nw",direction:{horizontal:"left",vertical:"top"},classes:"left-0 top-0 cursor-nw-resize",ariaLabel:t("g.resizeFromTopLeft")}],{startResize:Y}=cg((se,de)=>{if(C.value)return;de.style.setProperty("--node-width",`${se.size.width}px`),de.style.setProperty("--node-height",`${se.size.height}px`);const Ce=N.value,Re=Math.abs(se.position.x-Ce.x),oe=Math.abs(se.position.y-Ce.y);(Re>va||oe>va)&&z(se.position)},{transformState:i}),te=n(se=>de=>{e.nodeData.flags?.pinned||Y(de,se,{...N.value})},"handleResizePointerDown");J(C,se=>{const de=mt.value;if(!de)return;const[Ce,Re]=se?["","-x"]:["-x",""],oe=de.style.getPropertyValue(`--node-width${Ce}`);de.style.setProperty(`--node-width${Re}`,oe),de.style.setProperty(`--node-width${Ce}`,"");const X=de.style.getPropertyValue(`--node-height${Ce}`);de.style.setProperty(`--node-height${Re}`,X),de.style.setProperty(`--node-height${Ce}`,"")});const fe=b(()=>!!xt.value&&xt.value.urls.length>0),{latestPreviewUrl:ne,shouldShowPreviewImg:Se}=ag(()=>e.nodeData.id,{isCollapsed:C}),Ve=b(()=>v.value?"border-node-stroke-error":p.value?"border-node-stroke-executing":"border-node-stroke"),He=b(()=>re(u.value&&(v.value&&"outline-error "||p.value&&"outline-node-executing"||"outline-node-component-outline"))),je=n(()=>{o(e.nodeData.id,!C.value)},"handleCollapse"),qe=n(se=>{s(e.nodeData.id,se)},"handleHeaderTitleUpdate"),We=n(()=>{const se=F.graph?.rootGraph||F.graph;if(!se){console.warn("LGraphNode: No graph available for subgraph navigation");return}const de=Ko(e.nodeData),Ce=Kn(se,de);if(!Ce?.isSubgraphNode()||!("subgraph"in Ce)){console.warn("LGraphNode: Node is not a valid subgraph node",Ce);return}const Re=F.canvas;if(!Re||typeof Re.openSubgraph!="function"){console.warn("LGraphNode: Canvas or openSubgraph method not available");return}Re.openSubgraph(Ce.subgraph,Ce)},"handleEnterSubgraph"),Be=Dt(),Vt=b(()=>e.nodeData.subgraphId?`${e.nodeData.subgraphId}:${e.nodeData.id}`:e.nodeData.id),kt=b(()=>{const se=Ko(e.nodeData),de=F.graph?.rootGraph||F.graph;return de?Kn(de,se):null}),xt=b(()=>{const se=Be.nodeOutputs[Vt.value],de=kt.value;if(!de||!se?.images?.length)return;const Ce=Be.getNodeImageUrls(de);if(!Ce?.length)return;const Re=de.inputs?.some(X=>X.type==="VIDEO");return{type:de.previewMediaType==="video"||!de.previewMediaType&&Re?"video":"image",urls:Ce}}),mt=R(),Je=R(!1);function no(se){const de=kt.value;if(!de||!de.onDragOver){Je.value=!1;return}const Ce=de.onDragOver(se);Je.value=Ce}n(no,"handleDragOver");function zo(){Je.value=!1}n(zo,"handleDragLeave");async function Uo(se){Je.value=!1;const de=kt.value;!de||!de.onDragDrop||await de.onDragDrop(se)}return n(Uo,"handleDrop"),(se,de)=>M.value?(y(),I("div",Cg,H(w(ke)("nodeErrors.render","Node Render Error")),1)):(y(),I("div",nt({key:1,ref_key:"nodeContainerRef",ref:mt,"data-node-id":se.nodeData.id,class:w(re)("bg-component-node-background lg-node absolute","h-min w-min contain-style contain-layout min-h-(--node-height) min-w-(--node-width)","rounded-2xl touch-none flex flex-col","border-1 border-solid border-component-node-border",w(P)&&"hover:ring-7 ring-node-component-ring","outline-transparent outline-2",Ve.value,He.value,{"before:rounded-2xl before:pointer-events-none before:absolute before:bg-bypass/60 before:inset-0":m.value,"before:rounded-2xl before:pointer-events-none before:absolute before:inset-0":h.value,"will-change-transform":w(A),"ring-4 ring-primary-500 bg-primary-500/10":Je.value},w(P)?"pointer-events-auto":"pointer-events-none"),style:[{transform:`translate(${w(N).x??0}px, ${(w(N).y??0)-w(le).NODE_TITLE_HEIGHT}px)`,zIndex:w(D),opacity:T.value,"--component-node-background":k.value},w(G)]},w(U),{onWheel:de[0]||(de[0]=(...Ce)=>w(_)&&w(_)(...Ce)),onContextmenu:q,onDragover:Ee(no,["prevent"]),onDragleave:zo,onDrop:Ee(Uo,["stop","prevent"])}),[x("div",kg,[C.value?(y(),I(ue,{key:0},[S.value?(y(),O(Yn,{key:0,multi:"",class:"absolute left-0 -translate-x-1/2"})):V("",!0),$.value?(y(),O(Yn,{key:1,multi:"",class:"absolute right-0 translate-x-1/2"})):V("",!0),E(Qn,{"node-data":se.nodeData,unified:""},null,8,["node-data"])],64)):V("",!0),E(Xi,{"node-data":se.nodeData,collapsed:C.value,onCollapse:je,"onUpdate:title":qe,onEnterSubgraph:We},null,8,["node-data","collapsed"])]),C.value&&w(p)&&w(g)!==void 0?(y(),I("div",{key:0,class:K(w(re)("absolute inset-x-4 -bottom-[1px] translate-y-1/2 rounded-full",ga)),style:me({width:`${Math.min(w(g)*100,100)}%`})},null,6)):V("",!0),C.value?V("",!0):(y(),I(ue,{key:1},[x("div",xg,[w(p)&&w(g)!==void 0?(y(),I("div",{key:0,class:K(w(re)("absolute inset-x-0 top-1/2 -translate-y-1/2",w(g)<1&&"rounded-r-full",ga)),style:me({width:`${Math.min(w(g)*100,100)}%`})},null,6)):V("",!0)]),x("div",{class:"flex min-h-min min-w-min flex-1 flex-col gap-1 pb-2","data-testid":`node-body-${se.nodeData.id}`},[E(Qn,{"node-data":se.nodeData},null,8,["node-data"]),se.nodeData.widgets?.length?(y(),O(Ji,{key:0,"node-data":se.nodeData},null,8,["node-data"])):V("",!0),fe.value?(y(),I("div",_g,[E(Lu,{"node-data":se.nodeData,media:xt.value},null,8,["node-data","media"])])):V("",!0),w(Se)?(y(),I("div",Tg,[E(wg,{"image-url":w(ne)||null},null,8,["image-url"])])):V("",!0)],8,$g)],64)),C.value?V("",!0):(y(),I(ue,{key:2},$e(Q,Ce=>x("div",{key:Ce.id,role:"button","aria-label":Ce.ariaLabel,class:K(w(re)(Ig,Ce.classes)),onPointerdown:Ee(Re=>te(Ce.direction)(Re),["stop"])},null,42,Ng)),64))],16,Sg))}});let ro=[],uo=!1,co=null;const Rg=n(()=>{function e(l){const a=Object.keys(l.settingValues).length===0||!l.get("Comfy.TutorialCompleted"),i=!localStorage.getItem("workflow"),r=!localStorage.getItem("Comfy.PreviousWorkflow");return a&&i&&r}n(e,"checkIsNewUser");async function t(l){if(uo){if(co)try{await l()}catch(a){console.error("New user initialization callback failed:",a)}}else ro.push(l)}n(t,"registerInitCallback");async function o(l){if(!uo){if(co=e(l),uo=!0,!co){ro=[];return}await l.set("Comfy.InstalledVersion","1.32.5");for(const a of ro)try{await a()}catch(i){console.error("New user initialization callback failed:",i)}ro=[]}}n(o,"initializeIfNewUser");function s(){return uo?co:null}return n(s,"isNewUser"),{registerInitCallback:t,initializeIfNewUser:o,isNewUser:s}},"newUserService"),Pg={key:0,class:"pointer-events-auto relative w-full h-10 bg-gradient-to-r from-blue-600 to-blue-700 flex items-center justify-center px-4"},Dg={class:"flex items-center"},Ag={class:"pl-2 text-sm"},Lg="vueNodesBannerDismissed",Eg=j({__name:"TryVueNodeBanner",setup(e){const t=Z(),o=xo(Lg,!1),s=b(()=>{try{return t.get("Comfy.VueNodes.Enabled")??!1}catch{return!1}}),l=b(()=>!(s.value||o.value)),a=n(()=>{o.value=!0},"handleDismiss"),i=n(async()=>{try{await t.set("Comfy.VueNodes.Enabled",!0)}catch(r){console.error("Failed to enable Vue nodes:",r)}finally{a()}},"handleTryItOut");return(r,u)=>l.value?(y(),I("div",Pg,[x("div",Dg,[u[0]||(u[0]=x("i",{class:"icon-[lucide--rocket]"},null,-1)),x("span",Ag,H(r.$t("vueNodesBanner.message")),1),E(w(ie),{class:"cursor-pointer bg-transparent rounded h-7 px-3 border border-white text-white ml-4 text-xs",onClick:i},{default:W(()=>[Ye(H(r.$t("vueNodesBanner.tryItOut")),1)]),_:1})]),E(w(ie),{class:"cursor-pointer bg-transparent border-0 outline-0 grid place-items-center absolute right-4",unstyled:"",onClick:a},{default:W(()=>u[1]||(u[1]=[x("i",{class:"w-5 h-5 icon-[lucide--x]"},null,-1)])),_:1})])):V("",!0)}}),Vg={key:0,class:"workflow-tabs-container pointer-events-auto relative h-9.5 w-full"},Wg={key:0,class:"app-drag fixed top-0 left-0 z-10 h-[var(--comfy-topbar-height)] w-full"},Og={class:"flex h-full items-center"},Bg={class:"sidebar-content-container h-full w-full overflow-x-hidden overflow-y-auto"},zg=j({__name:"GraphCanvas",emits:["ready"],setup(e,{emit:t}){const o=t,s=R(null),l=rt(null),a=Z(),i=st(),r=Ge(),u=ce(),d=Ct(),p=tt(),g=Xe(),c=Ka(),f=wt(),v=b(()=>a.get("Comfy.UseNewMenu")!=="Disabled"),C=b(()=>a.get("Comfy.Workflow.WorkflowTabsPosition")),m=b(()=>a.get("Comfy.Graph.CanvasMenu")),h=b(()=>a.get("Comfy.EnableTooltips")),k=b(()=>a.get("Comfy.Canvas.SelectionToolbox")),T=b(()=>r.sidebarTab.activeSidebarTab),S=b(()=>!r.focusMode&&v.value),$=b(()=>a.get("Comfy.Minimap.Visible")),{shouldRenderVueNodes:_}=_o(),P=On(),{handleTransformUpdate:M}=uv(),L=n(async()=>{_.value&&(P.disposeNodeManagerAndSyncs(),await De(),P.initializeNodeManager())},"handleVueNodeLifecycleReset");J(()=>u.currentGraph,L),J(()=>u.isInSubgraph,async(U,A)=>{A&&!U&&_e().updateActiveGraph(),await L()});const N=b(()=>Array.from(P.nodeManager.value?.vueNodeData?.values()??[]));ge(()=>{le.nodeOpacity=a.get("Comfy.Node.Opacity")}),ge(()=>{le.nodeLightness=g.completedActivePalette.light_theme?.5:void 0}),ge(()=>{i.showDeprecated=a.get("Comfy.Node.ShowDeprecated")}),ge(()=>{i.showExperimental=a.get("Comfy.Node.ShowExperimental")}),ge(()=>{const U=a.get("Comfy.TextareaWidget.Spellcheck");document.querySelectorAll("textarea.comfy-multiline-input").forEach(G=>{G.spellcheck=U,G.focus(),G.blur()})}),J(()=>a.get("Comfy.WidgetControlMode"),()=>{if(u.canvas){for(const U of F.graph.nodes)if(U.widgets){for(const A of U.widgets)if(A[el]&&(Zn(A),A.linkedWidgets))for(const G of A.linkedWidgets)Zn(G)}F.graph.setDirtyCanvas(!0)}}),J([()=>u.canvas,()=>a.get("Comfy.ColorPalette")],async([U,A])=>{U&&await c.loadColorPalette(A)}),J(()=>a.get("Comfy.Canvas.BackgroundImage"),async()=>{if(!u.canvas)return;const U=g.activePaletteId;U&&(await c.loadColorPalette(U),u.canvas.setDirty(!1,!0))}),J(()=>g.activePaletteId,async U=>{await a.set("Comfy.ColorPalette",U)}),J(()=>[d.nodeLocationProgressStates,u.canvas],([U,A])=>{if(A?.graph){for(const G of A.graph.nodes){const q=_e().nodeIdToNodeLocatorId(G.id),Q=U[q];Q&&Q.state==="running"?G.progress=Q.value/Q.max:G.progress=void 0}A.graph.setDirtyCanvas(!0,!1)}},{deep:!0}),J(()=>d.lastNodeErrors,U=>{if(F.graph){for(const A of F.graph.nodes){for(const Q of A.inputs)delete Q.hasErrors;for(const Q of A.outputs)delete Q.hasErrors;const G=U?.[A.id];if(!G)continue;G.errors.filter(Q=>Q.extra_info?.input_name!==void 0).forEach(Q=>{const Y=Q.extra_info.input_name,te=A.findInputSlot(Y);te!==-1&&(A.inputs[te].hasErrors=!0)})}F.canvas.draw(!0,!0)}}),xe(s,"litegraph:no-items-selected",()=>{p.add({severity:"warn",summary:ae("toastMessages.nothingSelected"),life:2e3})},{passive:!0});const B=n(async()=>{try{const U=await ve.getCustomNodesI18n();Object.entries(U).forEach(([A,G])=>{bn.global.mergeLocaleMessage(A,G)})}catch(U){console.error("Failed to load custom nodes i18n",U)}},"loadCustomNodesI18n"),D=R(!1),z=Rv();return wv(s),Tv(),bv(),Me(async()=>{xv(),Cv(),kv(),_v(),Iv(),_o(),F.vueAppReady=!0,r.spinner=!0,tl.init(),await B();try{await a.loadSettingValues()}catch(G){if(G instanceof ol)localStorage.removeItem("Comfy.userId"),localStorage.removeItem("Comfy.userName"),window.location.reload();else throw G}Nv.forEach(a.addSetting),await Rg().initializeIfNewUser(a),await F.setup(s.value),u.canvas=F.canvas,u.canvas.render_canvas_border=!1,r.spinner=!1,Vn().setPopoverRef(l.value),window.app=F,window.graph=F.graph,D.value=!0,P.setupEmptyGraphListener(),F.canvas.onSelectionChange=Qt(F.canvas.onSelectionChange,()=>u.updateSelectedItems()),g.customPalettes=a.get("Comfy.CustomColorPalettes"),await z.initializeWorkflow(),z.restoreWorkflowTabsState(),await z.loadTemplateFromUrlIfPresent();const{useReleaseStore:U}=await Wa(async()=>{const{useReleaseStore:G}=await Promise.resolve().then(()=>Vf);return{useReleaseStore:G}},void 0);U().initialize(),J(()=>a.get("Comfy.Locale"),async()=>{await be().execute("Comfy.RefreshNodeDefinitions"),await Qe().reloadCurrentWorkflow()}),Ro(()=>ce().canvas,G=>{xe(G.canvas,"litegraph:set-graph",()=>{_e().updateActiveGraph()})},{immediate:!0}),o("ready")}),at(()=>{P.cleanup()}),(U,A)=>(y(),I(ue,null,[D.value?(y(),O(ec,{key:0},hn({"graph-canvas-panel":W(()=>[m.value?(y(),O(gd,{key:0,class:"pointer-events-auto"})):V("",!0),D.value&&$.value&&S.value?(y(),O(Qv,{key:1,class:"pointer-events-auto"})):V("",!0)]),_:2},[S.value?{name:"workflow-tabs",fn:W(()=>[E(Eg),C.value==="Topbar"?(y(),I("div",Vg,[w(nl)()&&C.value!=="Topbar"?(y(),I("div",Wg)):V("",!0),x("div",Og,[E(tv),E(Om)])])):V("",!0)]),key:"0"}:void 0,S.value?{name:"side-toolbar",fn:W(()=>[E(Em)]),key:"1"}:void 0,S.value?{name:"side-bar-panel",fn:W(()=>[x("div",Bg,[T.value?(y(),O(gs,{key:0,extension:T.value},null,8,["extension"])):V("",!0)])]),key:"2"}:void 0,S.value?{name:"topmenu",fn:W(()=>[E(Mc)]),key:"3"}:void 0,S.value?{name:"bottom-panel",fn:W(()=>[E(Wc)]),key:"4"}:void 0]),1024)):V("",!0),x("canvas",{id:"graph-canvas",ref_key:"canvasRef",ref:s,tabindex:"1",class:"absolute inset-0 size-full touch-none"},null,512),w(_)&&w(F).canvas&&D.value?(y(),O(Ev,{key:1,canvas:w(F).canvas,onTransformUpdate:w(M),onWheelCapture:w(f).forwardEventToCanvas},{default:W(()=>[(y(!0),I(ue,null,$e(N.value,G=>(y(),O(Mg,{key:G.id,"node-data":G,error:w(d).lastExecutionError?.node_id===G.id?"Execution error":null,"zoom-level":w(u).canvas?.ds?.scale||1,"data-node-id":G.id},null,8,["node-data","error","zoom-level","data-node-id"]))),128))]),_:1},8,["canvas","onTransformUpdate","onWheelCapture"])):V("",!0),h.value?(y(),O(yd,{key:2})):V("",!0),E(Rp,{ref_key:"nodeSearchboxPopoverRef",ref:l},null,512),D.value?(y(),I(ue,{key:3},[E(ap),k.value?(y(),O(op,{key:0})):V("",!0),E(gp),w(_)?V("",!0):(y(),O(Hc,{key:1}))],64)):V("",!0)],64))}}),Ug={class:"flex flex-auto flex-col items-start"},Fg={class:"my-4 text-lg font-medium"},Gg=j({__name:"RerouteMigrationToast",setup(e){const{t}=he(),o=Wo(),s=_e(),l=n(async()=>{const a=F.graph.serialize(),i=al(a);await F.loadGraphData(i,!1,!1,s.activeWorkflow),o.removeGroup("reroute-migration")},"migrateToLitegraphReroute");return(a,i)=>(y(),O(w(To),{group:"reroute-migration"},{message:W(()=>[x("div",Ug,[x("div",Fg,H(w(t)("toastMessages.migrateToLitegraphReroute")),1),E(w(ie),{class:"self-end",size:"small",label:w(t)("g.migrate"),severity:"warn",onClick:l},null,8,["label"])])]),_:1}))}}),Hg={class:"flex flex-auto items-center justify-between gap-4"},jg={class:"whitespace-nowrap"},qg={class:"flex flex-auto items-center justify-between gap-4"},Kg={class:"whitespace-nowrap"},Yg=j({__name:"VueNodesMigrationToast",setup(e){const{t}=he(),o=Wo(),s=ks(),l=n(async()=>{await i(),o.removeGroup("vue-nodes-migration"),s.value=!0,r()},"switchBack"),a=n(()=>{s.value=!0,r()},"handleClose"),i=n(async()=>{await Z().set("Comfy.VueNodes.Enabled",!1)},"disableVueNodes"),r=n(()=>{tt().add({group:"vue-nodes-check-main-menu",severity:"info",life:5e3})},"showMainMenuToast");return(u,d)=>(y(),I(ue,null,[E(w(To),{group:"vue-nodes-migration",position:"bottom-center",class:"w-auto",onClose:a},{message:W(()=>[x("div",Hg,[x("span",jg,H(w(t)("vueNodesMigration.message")),1),E(w(ie),{class:"whitespace-nowrap",size:"small",label:w(t)("vueNodesMigration.button"),text:"",onClick:l},null,8,["label"])])]),_:1}),E(w(To),{group:"vue-nodes-check-main-menu",position:"bottom-center",class:"w-auto"},{message:W(()=>[x("div",qg,[x("span",Kg,H(w(t)("vueNodesMigrationMainMenu.message")),1)])]),_:1})],64))}}),ha="ComfyUI",Qg=" - ComfyUI",Zg=n(()=>{const e=Ct(),t=Z(),o=_e(),s=Ge(),l=b(()=>e.isIdle?"":`[${Math.round(e.executionProgress*100)}%]`),a=b(()=>t.get("Comfy.UseNewMenu")!=="Disabled"),i=b(()=>t.get("Comfy.Workflow.AutoSave")==="after delay"),r=b(()=>!!o.activeWorkflow?.isModified),u=b(()=>!!o.activeWorkflow?.isPersisted),d=b(()=>s.shiftDown||i.value?!1:!!(!u.value||r.value)),p=b(()=>d.value?" *":""),g=b(()=>{const C=o.activeWorkflow?.filename;return C?p.value+C+Qg:ha}),c=b(()=>{const m=Object.entries(e.nodeProgressStates).filter(([$,_])=>_.state==="running");if(m.length===0)return"";if(m.length>1)return`${l.value}[${m.length} ${ae("g.nodesRunning","nodes running")}]`;const[h,k]=m[0],T=Math.round(k.value/k.max*100),S=e.activePrompt?.workflow?.changeTracker?.activeState.nodes.find($=>String($.id)===h)?.type||"Node";return`${l.value}[${T}%] ${S}`}),f=b(()=>l.value+(a.value?g.value:ha)),v=b(()=>c.value||f.value);qs(v)},"useBrowserTabTitle"),Xg={},Jg={class:"size-full bg-modal-panel-background pr-6 pb-8 pl-4"};function eh(e,t){return y(),I("div",Jg,[Ne(e.$slots,"default")])}n(eh,"_sfc_render");const th=we(Xg,[["render",eh]]),oh={class:"text-neutral text-base"},nh={class:"flex gap-2"},ah={class:"relative flex gap-2 px-6 pb-4"},sh=j({__name:"SampleModelSelector",props:{onClose:{type:Function}},setup(e){const t=R([{name:"Vue",value:"vue"},{name:"React",value:"react"},{name:"Angular",value:"angular"},{name:"Svelte",value:"svelte"}]),o=R([{name:"Project A",value:"proj-a"},{name:"Project B",value:"proj-b"},{name:"Project C",value:"proj-c"}]),s=R([{name:"Popular",value:"popular"},{name:"Latest",value:"latest"},{name:"A  Z",value:"az"}]),l=R([{id:"installed",label:"Installed",icon:"icon-[lucide--download]"},{title:"TAGS",items:[{id:"tag-sd15",label:"SD 1.5",icon:"icon-[lucide--tag]"},{id:"tag-sdxl",label:"SDXL",icon:"icon-[lucide--tag]"},{id:"tag-utility",label:"Utility",icon:"icon-[lucide--tag]"}]},{title:"CATEGORIES",items:[{id:"cat-models",label:"Models",icon:"icon-[lucide--layers]"},{id:"cat-nodes",label:"Nodes",icon:"icon-[lucide--grid-3x3]"}]}]);Io(Oo,e.onClose);const a=R(""),i=R(""),r=R([]),u=R([]),d=R("popular"),p=R("installed"),g=b(()=>Dn());return(c,f)=>(y(),O(Mn,{"content-title":c.$t("assetBrowser.checkpoints")},{leftPanel:W(()=>[E(Rn,{modelValue:p.value,"onUpdate:modelValue":f[0]||(f[0]=v=>p.value=v),"nav-items":l.value},{"header-icon":W(()=>f[6]||(f[6]=[x("i",{class:"text-neutral icon-[lucide--puzzle]"},null,-1)])),"header-title":W(()=>[x("span",oh,H(c.$t("g.title")),1)]),_:1},8,["modelValue","nav-items"])]),header:W(()=>[E(Do,{modelValue:a.value,"onUpdate:modelValue":f[1]||(f[1]=v=>a.value=v),size:"lg",class:"max-w-[384px]"},null,8,["modelValue"])]),"header-right-area":W(()=>[x("div",nh,[E(Gt,{type:"primary",label:c.$t("g.upload"),onClick:n(()=>{},"onClick")},{icon:W(()=>f[7]||(f[7]=[x("i",{class:"icon-[lucide--upload]"},null,-1)])),_:1},8,["label"]),E(sl,null,{default:W(({close:v})=>[E(Gt,{type:"secondary",label:"Settings",onClick:n(()=>{v()},"onClick")},{icon:W(()=>f[8]||(f[8]=[x("i",{class:"icon-[lucide--download]"},null,-1)])),_:2},1032,["onClick"]),E(Gt,{type:"primary",label:"Profile",onClick:n(()=>{v()},"onClick")},{icon:W(()=>f[9]||(f[9]=[x("i",{class:"icon-[lucide--scroll]"},null,-1)])),_:2},1032,["onClick"])]),_:1})])]),contentFilter:W(()=>[x("div",ah,[E(yt,{modelValue:r.value,"onUpdate:modelValue":f[2]||(f[2]=v=>r.value=v),"search-query":i.value,"onUpdate:searchQuery":f[3]||(f[3]=v=>i.value=v),class:"w-[250px]",label:"Select Frameworks",options:t.value,"show-search-box":!0,"show-selected-count":!0,"show-clear-button":!0},null,8,["modelValue","search-query","options"]),E(yt,{modelValue:u.value,"onUpdate:modelValue":f[4]||(f[4]=v=>u.value=v),label:"Select Projects",options:o.value},null,8,["modelValue","options"]),E(Pn,{modelValue:d.value,"onUpdate:modelValue":f[5]||(f[5]=v=>d.value=v),label:"Sorting Type",options:s.value,class:"w-[135px]"},{icon:W(()=>f[10]||(f[10]=[x("i",{class:"icon-[lucide--filter]"},null,-1)])),_:1},8,["modelValue","options"])])]),content:W(()=>[x("div",{style:me(g.value)},[(y(),I(ue,null,$e(100,v=>E(vo,{key:v,size:"regular"},{top:W(()=>[E(go,{ratio:"landscape"},{default:W(()=>f[11]||(f[11]=[x("div",{class:"h-full w-full bg-blue-500"},null,-1)])),"top-right":W(()=>[E(Nt,{class:"!bg-white !text-neutral-900",onClick:n(()=>{},"onClick")},{default:W(()=>f[12]||(f[12]=[x("i",{class:"icon-[lucide--info]"},null,-1)])),_:1})]),"bottom-right":W(()=>[E(yo,{label:"png"}),E(yo,{label:"1.2 MB"}),E(yo,{label:"LoRA"},{icon:W(()=>f[13]||(f[13]=[x("i",{class:"icon-[lucide--folder]"},null,-1)])),_:1})]),_:1})]),bottom:W(()=>[E(ho)]),_:2},1024)),64))],4)]),rightPanel:W(()=>[E(th)]),_:1},8,["content-title"]))}}),ya="global-model-selector",ih=n(()=>{const e=pt(),t=eo();function o(){t.closeDialog({key:ya})}n(o,"hide");function s(){e.showLayoutDialog({key:ya,component:sh,props:{onClose:o}})}return n(s,"show"),{show:s,hide:o}},"useModelSelectorDialog");function lh(e,t){const o=il.safeParse(e);if(!o.success){const C=o.error.errors.map(m=>`${m.path.join(".")}: ${m.message}`).join(", ");return console.error("Invalid asset item:",C),{success:!1,error:{code:"INVALID_ASSET",message:"Asset schema validation failed",assetId:e.id,details:{validationErrors:C}}}}const s=o.data,l=s.user_metadata;if(!l)return console.error(`Asset ${s.id} missing required user_metadata`),{success:!1,error:{code:"INVALID_ASSET",message:"Asset missing required user_metadata",assetId:s.id}};const a=l.filename;if(typeof a!="string"||a.length===0)return console.error(`Asset ${s.id} has invalid user_metadata.filename (expected non-empty string, got ${typeof a})`),{success:!1,error:{code:"INVALID_ASSET",message:`Invalid filename (expected non-empty string, got ${typeof a})`,assetId:s.id}};if(s.tags.length===0)return console.error(`Asset ${s.id} has no tags defined (expected at least one category tag)`),{success:!1,error:{code:"INVALID_ASSET",message:"Asset has no tags defined",assetId:s.id}};const i=s.tags.find(C=>C!==Xn&&C!==Jn);if(!i)return console.error(`Asset ${s.id} has no valid category tag. Available tags: ${s.tags.join(", ")} (expected tag other than '${Xn}' or '${Jn}')`),{success:!1,error:{code:"INVALID_ASSET",message:"Asset has no valid category tag",assetId:s.id,details:{availableTags:s.tags}}};const u=wn().getNodeProvider(i);if(!u)return console.error(`No node provider registered for category: ${i}`),{success:!1,error:{code:"NO_PROVIDER",message:`No node provider registered for category: ${i}`,assetId:s.id,details:{category:i}}};const p=Eo().getCanvasCenter(),g=le.createNode(u.nodeDef.name,u.nodeDef.display_name,{pos:p});if(!g)return console.error(`Failed to create node for type: ${u.nodeDef.name}`),{success:!1,error:{code:"NODE_CREATION_FAILED",message:`Failed to create node for type: ${u.nodeDef.name}`,assetId:s.id,details:{nodeType:u.nodeDef.name}}};const c=_e(),f=c.isSubgraphActive?c.activeSubgraph:F.canvas.graph;if(!f)return console.error("No active graph available"),{success:!1,error:{code:"NO_GRAPH",message:"No active graph available",assetId:s.id}};const v=g.widgets?.find(C=>C.name===u.key);return v?(f.add(g),v.value=a,{success:!0,value:g}):(console.error(`Widget ${u.key} not found on node ${u.nodeDef.name}`),{success:!1,error:{code:"MISSING_WIDGET",message:`Widget ${u.key} not found on node ${u.nodeDef.name}`,assetId:s.id,details:{widgetName:u.key,nodeType:u.nodeDef.name}}})}n(lh,"createModelNodeFromAsset");const po={DISTRIBUTION:"tf_42243568391700",ANONYMOUS_EMAIL:"tf_anonymous_requester_email",EMAIL:"tf_40029135130388",USER_ID:"tf_42515251051412"},rh="https://support.comfy.org/hc/en-us/requests/new";function uh(e){const t=new URLSearchParams({[po.DISTRIBUTION]:"oss"});return e?.userEmail&&(t.append(po.ANONYMOUS_EMAIL,e.userEmail),t.append(po.EMAIL,e.userEmail)),e?.userId&&t.append(po.USER_ID,e.userId),`${rh}?${t.toString()}`}n(uh,"buildSupportUrl");const{isActiveSubscription:on,showSubscriptionDialog:nn}=kn(),fo="1.22.2";function ch(){const e=Qe(),t=_e(),o=pt(),s=Xe(),l=za(),a=tt(),i=ce(),r=Ct(),{staticUrls:u,buildDocsUrl:d}=Lt(),p=At(),{getSelectedNodes:g,toggleSelectedNodesMode:c}=Ao(),f=n(()=>t.activeWorkflow?.changeTracker,"getTracker"),v=n(m=>{const h=g();if(h.length===0)return;const k=Z().get("Comfy.SnapToGrid.GridSize");h.forEach(T=>{T.pos=m(T.pos,k)}),F.canvas.state.selectionChanged=!0,F.canvas.setDirty(!0,!0)},"moveSelectedNodes");return[{id:"Comfy.NewBlankWorkflow",icon:"pi pi-plus",label:"New Blank Workflow",menubarLabel:"New",category:"essentials",function:n(async()=>{F.graph._nodes.length>0,await e.loadBlankWorkflow()},"function")},{id:"Comfy.OpenWorkflow",icon:"pi pi-folder-open",label:"Open Workflow",menubarLabel:"Open",category:"essentials",function:n(()=>{F.ui.loadFile()},"function")},{id:"Comfy.LoadDefaultWorkflow",icon:"pi pi-code",label:"Load Default Workflow",function:n(async()=>{F.graph._nodes.length>0,await e.loadDefaultWorkflow()},"function")},{id:"Comfy.SaveWorkflow",icon:"pi pi-save",label:"Save Workflow",menubarLabel:"Save",category:"essentials",function:n(async()=>{const m=_e().activeWorkflow;m&&await e.saveWorkflow(m)},"function")},{id:"Comfy.PublishSubgraph",icon:"pi pi-save",label:"Publish Subgraph",menubarLabel:"Publish",function:n(async()=>{await Ba().publishSubgraph()},"function")},{id:"Comfy.SaveWorkflowAs",icon:"pi pi-save",label:"Save Workflow As",menubarLabel:"Save As",category:"essentials",function:n(async()=>{const m=_e().activeWorkflow;m&&await e.saveWorkflowAs(m)},"function")},{id:"Comfy.ExportWorkflow",icon:"pi pi-download",label:"Export Workflow",menubarLabel:"Export",category:"essentials",function:n(async()=>{await e.exportWorkflow("workflow","workflow")},"function")},{id:"Comfy.ExportWorkflowAPI",icon:"pi pi-download",label:"Export Workflow (API Format)",menubarLabel:"Export (API)",function:n(async()=>{await e.exportWorkflow("workflow_api","output")},"function")},{id:"Comfy.Undo",icon:"pi pi-undo",label:"Undo",category:"essentials",function:n(async()=>{await f()?.undo?.()},"function")},{id:"Comfy.Redo",icon:"pi pi-refresh",label:"Redo",category:"essentials",function:n(async()=>{await f()?.redo?.()},"function")},{id:"Comfy.ClearWorkflow",icon:"pi pi-trash",label:"Clear Workflow",category:"essentials",function:n(()=>{if(!Z().get("Comfy.ConfirmClear")||confirm("Clear workflow?")){if(F.clean(),F.canvas.subgraph){const h=F.canvas.subgraph;ll(h).forEach(T=>h.remove(T))}ve.dispatchCustomEvent("graphCleared")}},"function")},{id:"Comfy.Canvas.ResetView",icon:"pi pi-expand",label:"Reset View",function:n(()=>{Eo().resetView()},"function")},{id:"Comfy.OpenClipspace",icon:"pi pi-clipboard",label:"Clipspace",function:n(()=>{F.openClipspace()},"function")},{id:"Comfy.RefreshNodeDefinitions",icon:"pi pi-refresh",label:"Refresh Node Definitions",category:"essentials",function:n(async()=>{await F.refreshComboInNodes()},"function")},{id:"Comfy.Interrupt",icon:"pi pi-stop",label:"Interrupt",category:"essentials",function:n(async()=>{await ve.interrupt(r.activePromptId),a.add({severity:"info",summary:ae("g.interrupted"),detail:ae("toastMessages.interrupted"),life:1e3})},"function")},{id:"Comfy.ClearPendingTasks",icon:"pi pi-stop",label:"Clear Pending Tasks",category:"essentials",function:n(async()=>{await os().clear(["queue"]),a.add({severity:"info",summary:ae("g.confirmed"),detail:ae("toastMessages.pendingTasksDeleted"),life:3e3})},"function")},{id:"Comfy.BrowseTemplates",icon:"pi pi-folder-open",label:"Browse Templates",function:n(()=>{Wn().show()},"function")},{id:"Comfy.Canvas.ZoomIn",icon:"pi pi-plus",label:"Zoom In",category:"view-controls",function:n(()=>{const m=F.canvas.ds;m.changeScale(m.scale*1.1,m.element?[m.element.width/2,m.element.height/2]:void 0),F.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.Canvas.ZoomOut",icon:"pi pi-minus",label:"Zoom Out",category:"view-controls",function:n(()=>{const m=F.canvas.ds;m.changeScale(m.scale/1.1,m.element?[m.element.width/2,m.element.height/2]:void 0),F.canvas.setDirty(!0,!0)},"function")},{id:"Experimental.ToggleVueNodes",label:n(()=>`Experimental: ${Z().get("Comfy.VueNodes.Enabled")?"Disable":"Enable"} Vue Nodes`,"label"),function:n(async()=>{const m=Z(),h=m.get("Comfy.VueNodes.Enabled")??!1;await m.set("Comfy.VueNodes.Enabled",!h)},"function")},{id:"Comfy.Canvas.FitView",icon:"pi pi-expand",label:"Fit view to selected nodes",menubarLabel:"Zoom to fit",category:"view-controls",function:n(()=>{if(Z().get("Comfy.VueNodes.Enabled")){const k=ce().selectedNodeIds,T=Le.getAllNodes().value,S=k.size>0?Array.from(k).map(M=>T.get(M)).filter(M=>M!=null):Array.from(T.values()),$=rl(S);if(!$){a.add({severity:"error",summary:ae("toastMessages.emptyCanvas"),life:3e3});return}const _=[$.x,$.y,$.width,$.height],P=n(()=>F.canvas.setDirty(!0,!0),"setDirty");F.canvas.ds.animateToBounds(_,P)}else{if(F.canvas.empty){a.add({severity:"error",summary:ae("toastMessages.emptyCanvas"),life:3e3});return}F.canvas.fitViewToSelectionAnimated()}},"function")},{id:"Comfy.Canvas.ToggleLock",icon:"pi pi-lock",label:"Canvas Toggle Lock",category:"view-controls",function:n(()=>{F.canvas.state.readOnly=!F.canvas.state.readOnly},"function")},{id:"Comfy.Canvas.Lock",icon:"pi pi-lock",label:"Lock Canvas",category:"view-controls",function:n(()=>{F.canvas.state.readOnly=!0},"function")},{id:"Comfy.Canvas.Unlock",icon:"pi pi-lock-open",label:"Unlock Canvas",function:n(()=>{F.canvas.state.readOnly=!1},"function")},{id:"Comfy.Canvas.ToggleLinkVisibility",icon:"pi pi-eye",label:"Canvas Toggle Link Visibility",menubarLabel:"Node Links",versionAdded:"1.3.6",function:(()=>{const m=Z();let h=le.SPLINE_LINK;return async()=>{const k=m.get("Comfy.LinkRenderMode");k===le.HIDDEN_LINK?await m.set("Comfy.LinkRenderMode",h):(h=k,await m.set("Comfy.LinkRenderMode",le.HIDDEN_LINK))}})(),active:n(()=>Z().get("Comfy.LinkRenderMode")!==le.HIDDEN_LINK,"active")},{id:"Comfy.Canvas.ToggleMinimap",icon:"pi pi-map",label:"Canvas Toggle Minimap",menubarLabel:"Minimap",versionAdded:"1.24.1",function:n(async()=>{const m=Z();await m.set("Comfy.Minimap.Visible",!m.get("Comfy.Minimap.Visible"))},"function"),active:n(()=>Z().get("Comfy.Minimap.Visible"),"active")},{id:"Comfy.QueuePrompt",icon:"pi pi-play",label:"Queue Prompt",versionAdded:"1.3.7",category:"essentials",function:n(async m=>{if(!on.value){nn();return}const h=bo().batchCount;await F.queuePrompt(0,h)},"function")},{id:"Comfy.QueuePromptFront",icon:"pi pi-play",label:"Queue Prompt (Front)",versionAdded:"1.3.7",category:"essentials",function:n(async m=>{if(!on.value){nn();return}const h=bo().batchCount;await F.queuePrompt(-1,h)},"function")},{id:"Comfy.QueueSelectedOutputNodes",icon:"pi pi-play",label:"Queue Selected Output Nodes",versionAdded:"1.19.6",function:n(async m=>{if(!on.value){nn();return}const h=bo().batchCount,k=g(),T=In(k);if(T.length===0){a.add({severity:"error",summary:ae("toastMessages.nothingToQueue"),detail:ae("toastMessages.pleaseSelectOutputNodes"),life:3e3});return}const S=ul(T);if(S.length===0){a.add({severity:"error",summary:ae("toastMessages.failedToQueue"),detail:ae("toastMessages.failedExecutionPathResolution"),life:3e3});return}await F.queuePrompt(0,h,S)},"function")},{id:"Comfy.ShowSettingsDialog",icon:"pi pi-cog",label:"Show Settings Dialog",versionAdded:"1.3.7",category:"view-controls",function:n(()=>{o.showSettingsDialog()},"function")},{id:"Comfy.Graph.GroupSelectedNodes",icon:"pi pi-sitemap",label:"Group Selected Nodes",versionAdded:"1.3.7",category:"essentials",function:n(()=>{const{canvas:m}=F;if(!m.selectedItems?.size){a.add({severity:"error",summary:ae("toastMessages.nothingToGroup"),detail:ae("toastMessages.pleaseSelectNodesToGroup"),life:3e3});return}const h=new ht,k=Z().get("Comfy.GroupSelectedNodes.Padding");h.resizeTo(m.selectedItems,k),m.graph?.add(h),h.recomputeInsideNodes(),Lo().titleEditorTarget=h},"function")},{id:"Workspace.NextOpenedWorkflow",icon:"pi pi-step-forward",label:"Next Opened Workflow",versionAdded:"1.3.9",function:n(async()=>{await e.loadNextOpenedWorkflow()},"function")},{id:"Workspace.PreviousOpenedWorkflow",icon:"pi pi-step-backward",label:"Previous Opened Workflow",versionAdded:"1.3.9",function:n(async()=>{await e.loadPreviousOpenedWorkflow()},"function")},{id:"Comfy.Canvas.ToggleSelectedNodes.Mute",icon:"pi pi-volume-off",label:"Mute/Unmute Selected Nodes",versionAdded:"1.3.11",category:"essentials",function:n(()=>{c(Ie.NEVER),F.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.Canvas.ToggleSelectedNodes.Bypass",icon:"pi pi-shield",label:"Bypass/Unbypass Selected Nodes",versionAdded:"1.3.11",category:"essentials",function:n(()=>{c(Ie.BYPASS),F.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.Canvas.ToggleSelectedNodes.Pin",icon:"pi pi-pin",label:"Pin/Unpin Selected Nodes",versionAdded:"1.3.11",category:"essentials",function:n(()=>{g().forEach(m=>{m.pin(!m.pinned)}),F.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.Canvas.ToggleSelected.Pin",icon:"pi pi-pin",label:"Pin/Unpin Selected Items",versionAdded:"1.3.33",function:n(()=>{for(const m of F.canvas.selectedItems)(m instanceof Ze||m instanceof ht)&&m.pin(!m.pinned);F.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.Canvas.Resize",icon:"pi pi-minus",label:"Resize Selected Nodes",versionAdded:"",function:n(()=>{g().forEach(m=>{const h=m.computeSize();m.setSize([h[0],h[1]])}),F.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.Canvas.ToggleSelectedNodes.Collapse",icon:"pi pi-minus",label:"Collapse/Expand Selected Nodes",versionAdded:"1.3.11",function:n(()=>{g().forEach(m=>{m.collapse()}),F.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.ToggleTheme",icon:"pi pi-moon",label:"Toggle Theme (Dark/Light)",versionAdded:"1.3.12",function:(()=>{let m=pl.id,h=fl.id;return async()=>{const k=Z(),T=s.completedActivePalette;T.light_theme?(h=T.id,await k.set("Comfy.ColorPalette",m)):(m=T.id,await k.set("Comfy.ColorPalette",h))}})()},{id:"Workspace.ToggleBottomPanel",icon:"pi pi-list",label:"Toggle Bottom Panel",menubarLabel:"Bottom Panel",versionAdded:"1.3.22",category:"view-controls",function:n(()=>{p.toggleBottomPanel()},"function"),active:n(()=>p.bottomPanelVisible,"active")},{id:"Workspace.ToggleFocusMode",icon:"pi pi-eye",label:"Toggle Focus Mode",menubarLabel:"Focus Mode",versionAdded:"1.3.27",category:"view-controls",function:n(()=>{Ge().toggleFocusMode()},"function"),active:n(()=>Ge().focusMode,"active")},{id:"Comfy.Graph.FitGroupToContents",icon:"pi pi-expand",label:"Fit Group To Contents",versionAdded:"1.4.9",function:n(()=>{for(const m of F.canvas.selectedItems)if(m instanceof ht){m.recomputeInsideNodes();const h=Z().get("Comfy.GroupSelectedNodes.Padding");m.resizeTo(m.children,h),F.graph.change()}},"function")},{id:"Comfy.Help.OpenComfyUIIssues",icon:"pi pi-github",label:"Open ComfyUI Issues",menubarLabel:"ComfyUI Issues",versionAdded:"1.5.5",function:n(()=>{window.open(u.githubIssues,"_blank")},"function")},{id:"Comfy.Help.OpenComfyUIDocs",icon:"pi pi-info-circle",label:"Open ComfyUI Docs",menubarLabel:"ComfyUI Docs",versionAdded:"1.5.5",function:n(()=>{window.open(d("/",{includeLocale:!0}),"_blank")},"function")},{id:"Comfy.Help.OpenComfyOrgDiscord",icon:"pi pi-discord",label:"Open Comfy-Org Discord",menubarLabel:"Comfy-Org Discord",versionAdded:"1.5.5",function:n(()=>{window.open(u.discord,"_blank")},"function")},{id:"Workspace.SearchBox.Toggle",icon:"pi pi-search",label:"Toggle Search Box",versionAdded:"1.5.7",function:n(()=>{Vn().toggleVisible()},"function")},{id:"Comfy.Help.AboutComfyUI",icon:"pi pi-info-circle",label:"Open About ComfyUI",menubarLabel:"About ComfyUI",versionAdded:"1.6.4",function:n(()=>{o.showSettingsDialog("about")},"function")},{id:"Comfy.DuplicateWorkflow",icon:"pi pi-clone",label:"Duplicate Current Workflow",versionAdded:"1.6.15",function:n(async()=>{await e.duplicateWorkflow(t.activeWorkflow)},"function")},{id:"Workspace.CloseWorkflow",icon:"pi pi-times",label:"Close Current Workflow",versionAdded:"1.7.3",function:n(async()=>{t.activeWorkflow&&await e.closeWorkflow(t.activeWorkflow)},"function")},{id:"Comfy.ContactSupport",icon:"pi pi-question",label:"Contact Support",versionAdded:"1.17.8",function:n(()=>{const{userEmail:m,resolvedUserInfo:h}=to(),k=uh({userEmail:m.value,userId:h.value?.id});window.open(k,"_blank")},"function")},{id:"Comfy.Help.OpenComfyUIForum",icon:"pi pi-comments",label:"Open ComfyUI Forum",menubarLabel:"ComfyUI Forum",versionAdded:"1.8.2",function:n(()=>{window.open(u.forum,"_blank")},"function")},{id:"Comfy.Canvas.DeleteSelectedItems",icon:"pi pi-trash",label:"Delete Selected Items",versionAdded:"1.10.5",function:n(()=>{F.canvas.deleteSelected(),F.canvas.setDirty(!0,!0)},"function")},{id:"Comfy.Manager.CustomNodesManager.ShowCustomNodesMenu",icon:"pi pi-puzzle",label:"Custom Nodes Manager",versionAdded:"1.12.10",function:n(async()=>{await it().openManager({showToastOnLegacyError:!0})},"function")},{id:"Comfy.Manager.ShowUpdateAvailablePacks",icon:"pi pi-sync",label:"Check for Custom Node Updates",versionAdded:"1.17.0",function:n(async()=>{const m=it();if(m.managerUIState.value===cl.DISABLED){a.add({severity:"error",summary:ae("g.error"),detail:ae("manager.notAvailable"),life:3e3});return}await m.openManager({initialTab:qt.UpdateAvailable,showToastOnLegacyError:!1})},"function")},{id:"Comfy.Manager.ShowMissingPacks",icon:"pi pi-exclamation-circle",label:"Install Missing Custom Nodes",versionAdded:"1.17.0",function:n(async()=>{await it().openManager({initialTab:qt.Missing,showToastOnLegacyError:!1})},"function")},{id:"Comfy.Manager.ToggleManagerProgressDialog",icon:"pi pi-spinner",label:"Toggle the Custom Nodes Manager Progress Bar",versionAdded:"1.13.9",function:n(()=>{o.toggleManagerProgressDialog()},"function")},{id:"Comfy.User.OpenSignInDialog",icon:"pi pi-user",label:"Open Sign In Dialog",versionAdded:"1.17.6",function:n(async()=>{await o.showSignInDialog()},"function")},{id:"Comfy.User.SignOut",icon:"pi pi-sign-out",label:"Sign Out",versionAdded:"1.18.1",function:n(async()=>{await l.logout()},"function")},{id:"Comfy.Canvas.MoveSelectedNodes.Up",icon:"pi pi-arrow-up",label:"Move Selected Nodes Up",versionAdded:fo,function:n(()=>v(([m,h],k)=>[m,h-k]),"function")},{id:"Comfy.Canvas.MoveSelectedNodes.Down",icon:"pi pi-arrow-down",label:"Move Selected Nodes Down",versionAdded:fo,function:n(()=>v(([m,h],k)=>[m,h+k]),"function")},{id:"Comfy.Canvas.MoveSelectedNodes.Left",icon:"pi pi-arrow-left",label:"Move Selected Nodes Left",versionAdded:fo,function:n(()=>v(([m,h],k)=>[m-k,h]),"function")},{id:"Comfy.Canvas.MoveSelectedNodes.Right",icon:"pi pi-arrow-right",label:"Move Selected Nodes Right",versionAdded:fo,function:n(()=>v(([m,h],k)=>[m+k,h]),"function")},{id:"Comfy.Graph.ConvertToSubgraph",icon:"icon-[lucide--shrink]",label:"Convert Selection to Subgraph",versionAdded:"1.20.1",category:"essentials",function:n(()=>{const m=i.getCanvas(),h=m.subgraph??m.graph;if(!h)throw new TypeError("Canvas has no graph or subgraph set.");const k=h.convertToSubgraph(m.selectedItems);if(!k){a.add({severity:"error",summary:ae("toastMessages.cannotCreateSubgraph"),detail:ae("toastMessages.failedToConvertToSubgraph"),life:3e3});return}const{node:T}=k;m.select(T),i.updateSelectedItems()},"function")},{id:"Comfy.Graph.UnpackSubgraph",icon:"icon-[lucide--expand]",label:"Unpack the selected Subgraph",versionAdded:"1.26.3",function:n(()=>{const m=i.getCanvas(),h=m.subgraph??m.graph;if(!h)throw new TypeError("Canvas has no graph or subgraph set.");const k=F.canvas.selectedItems.values().next().value;k instanceof gt&&(Dt().revokeSubgraphPreviews(k),h.unpackSubgraph(k))},"function")},{id:"Comfy.Graph.EditSubgraphWidgets",label:"Edit Subgraph Widgets",icon:"icon-[lucide--settings-2]",versionAdded:"1.28.5",function:Fa},{id:"Comfy.Graph.ToggleWidgetPromotion",icon:"icon-[lucide--arrow-left-right]",label:"Toggle promotion of hovered widget",versionAdded:"1.30.1",function:dl},{id:"Comfy.OpenManagerDialog",icon:"mdi mdi-puzzle-outline",label:"Manager",function:n(async()=>{await it().openManager({initialTab:qt.All,showToastOnLegacyError:!1})},"function")},{id:"Comfy.ToggleHelpCenter",icon:"pi pi-question-circle",label:"Help Center",function:n(()=>{dn().toggle()},"function"),active:n(()=>dn().isVisible,"active")},{id:"Comfy.ToggleCanvasInfo",icon:"pi pi-info-circle",label:"Canvas Performance",function:n(async()=>{const m=Z(),h=m.get("Comfy.Graph.CanvasInfo");await m.set("Comfy.Graph.CanvasInfo",!h)},"function"),active:n(()=>Z().get("Comfy.Graph.CanvasInfo"),"active")},{id:"Workspace.ToggleBottomPanel.Shortcuts",icon:"pi pi-key",label:"Show Keybindings Dialog",versionAdded:"1.24.1",category:"view-controls",function:n(()=>{p.togglePanel("shortcuts")},"function")},{id:"Comfy.Graph.ExitSubgraph",icon:"pi pi-arrow-up",label:"Exit Subgraph",versionAdded:"1.20.1",function:n(()=>{const m=ce().getCanvas(),h=xn();m.graph&&m.setGraph(h.navigationStack.at(-2)??m.graph.rootGraph)},"function")},{id:"Comfy.Dev.ShowModelSelector",icon:"pi pi-box",label:"Show Model Selector (Dev)",versionAdded:"1.26.2",category:"view-controls",function:n(()=>{ih().show()},"function")},{id:"Comfy.Manager.CustomNodesManager.ShowLegacyCustomNodesMenu",icon:"pi pi-bars",label:"Custom Nodes (Legacy)",versionAdded:"1.16.4",function:n(async()=>{await it().openManager({legacyCommand:"Comfy.Manager.CustomNodesManager.ToggleVisibility",showToastOnLegacyError:!0,isLegacyOnly:!0})},"function")},{id:"Comfy.Manager.ShowLegacyManagerMenu",icon:"mdi mdi-puzzle",label:"Manager Menu (Legacy)",versionAdded:"1.16.4",function:n(async()=>{await it().openManager({showToastOnLegacyError:!0,isLegacyOnly:!0})},"function")},{id:"Comfy.Memory.UnloadModels",icon:"mdi mdi-vacuum-outline",label:"Unload Models",versionAdded:"1.16.4",function:n(async()=>{if(!Z().get("Comfy.Memory.AllowManualUnload")){tt().add({severity:"error",summary:ae("g.error"),detail:ae("g.commandProhibited",{command:"Comfy.Memory.UnloadModels"}),life:3e3});return}await ve.freeMemory({freeExecutionCache:!1})},"function")},{id:"Comfy.Memory.UnloadModelsAndExecutionCache",icon:"mdi mdi-vacuum-outline",label:"Unload Models and Execution Cache",versionAdded:"1.16.4",function:n(async()=>{if(!Z().get("Comfy.Memory.AllowManualUnload")){tt().add({severity:"error",summary:ae("g.error"),detail:ae("g.commandProhibited",{command:"Comfy.Memory.UnloadModelsAndExecutionCache"}),life:3e3});return}await ve.freeMemory({freeExecutionCache:!0})},"function")},{id:"Comfy.BrowseModelAssets",icon:"pi pi-folder-open",label:"Experimental: Browse Model Assets",versionAdded:"1.28.3",function:n(async()=>{if(!Z().get("Comfy.Assets.UseAssetAPI")){if(!await o.confirm({title:"Enable Asset API",message:"The Asset API is currently disabled. Would you like to enable it?",type:"default"}))return;await Z().set("Comfy.Assets.UseAssetAPI",!0),await e.reloadCurrentWorkflow()}await Zr().browse({assetType:"models",title:ae("sideToolbar.modelLibrary"),onAssetSelected:n(h=>{const k=lh(h);k.success||(a.add({severity:"error",summary:ae("g.error"),detail:ae("assetBrowser.failedToCreateNode")}),console.error("Node creation failed:",k.error))},"onAssetSelected")})},"function")},{id:"Comfy.ToggleAssetAPI",icon:"pi pi-database",label:n(()=>`Experimental: ${Z().get("Comfy.Assets.UseAssetAPI")?"Disable":"Enable"} AssetAPI`,"label"),function:n(async()=>{const m=Z(),h=m.get("Comfy.Assets.UseAssetAPI")??!1;await m.set("Comfy.Assets.UseAssetAPI",!h),await Qe().reloadCurrentWorkflow()},"function")}].map(m=>({...m,source:"System"}))}n(ch,"useCoreCommands");const dh=n(()=>{const e="/assets/images/favicon_progress_16x16/frame_9.png",t=Ks(e),o=Ct(),s=10;J([()=>o.executionProgress,()=>o.isIdle],([l,a])=>{if(a)t.value=e;else{const i=Math.min(Math.max(0,Math.floor(l*s)),s-1);t.value=`/assets/images/favicon_progress_16x16/frame_${i}.png`}})},"useProgressFavicon");var pn=(e=>(e.NoPreviews="none",e.Auto="auto",e.Latent2RGB="latent2rgb",e.TAESD="taesd",e))(pn||{}),fn=(e=>(e.DEBUG="DEBUG",e.INFO="INFO",e.WARNING="WARNING",e.ERROR="ERROR",e.CRITICAL="CRITICAL",e))(fn||{}),mn=(e=>(e.MD5="md5",e.SHA1="sha1",e.SHA256="sha256",e.SHA512="sha512",e))(mn||{}),Tt=(e=>(e.Auto="auto",e.Disable="disable",e.Enable="enable",e))(Tt||{}),ye=(e=>(e.AUTO="auto",e.FP64="fp64",e.FP32="fp32",e.FP16="fp16",e.BF16="bf16",e.FP8E4M3FN="fp8_e4m3fn",e.FP8E5M2="fp8_e5m2",e))(ye||{}),Co=(e=>(e.Auto="auto",e.Split="split",e.Quad="quad",e.Pytorch="pytorch",e))(Co||{}),So=(e=>(e.Auto="auto",e.GPUOnly="gpu-only",e.HighVram="highvram",e.NormalVram="normalvram",e.LowVram="lowvram",e.NoVram="novram",e.CPU="cpu",e))(So||{});const ph=[{id:"listen",name:"Host: The IP address to listen on",category:["Network"],type:"text",defaultValue:"127.0.0.1"},{id:"port",name:"Port: The port to listen on",category:["Network"],type:"number",defaultValue:8e3},{id:"tls-keyfile",name:"TLS Key File: Path to TLS key file for HTTPS",category:["Network"],type:"text",defaultValue:""},{id:"tls-certfile",name:"TLS Certificate File: Path to TLS certificate file for HTTPS",category:["Network"],type:"text",defaultValue:""},{id:"enable-cors-header",name:'Enable CORS header: Use "*" for all origins or specify domain',category:["Network"],type:"text",defaultValue:""},{id:"max-upload-size",name:"Maximum upload size (MB)",category:["Network"],type:"number",defaultValue:100},{id:"cuda-device",name:"CUDA device index to use",category:["CUDA"],type:"number",defaultValue:null},{id:"cuda-malloc",name:"Use CUDA malloc for memory allocation",category:["CUDA"],type:"combo",options:Object.values(Tt),defaultValue:Tt.Auto,getValue:n(e=>{switch(e){case Tt.Auto:return{};case Tt.Enable:return{"cuda-malloc":!0};case Tt.Disable:return{"disable-cuda-malloc":!0}}},"getValue")},{id:"global-precision",name:"Global floating point precision",category:["Inference"],type:"combo",options:[ye.AUTO,ye.FP32,ye.FP16],defaultValue:ye.AUTO,tooltip:"Global floating point precision",getValue:n(e=>{switch(e){case ye.AUTO:return{};case ye.FP32:return{"force-fp32":!0};case ye.FP16:return{"force-fp16":!0};default:return{}}},"getValue")},{id:"unet-precision",name:"UNET precision",category:["Inference"],type:"combo",options:[ye.AUTO,ye.FP64,ye.FP32,ye.FP16,ye.BF16,ye.FP8E4M3FN,ye.FP8E5M2],defaultValue:ye.AUTO,tooltip:"UNET precision",getValue:n(e=>{switch(e){case ye.AUTO:return{};default:return{[`${e.toLowerCase()}-unet`]:!0}}},"getValue")},{id:"vae-precision",name:"VAE precision",category:["Inference"],type:"combo",options:[ye.AUTO,ye.FP16,ye.FP32,ye.BF16],defaultValue:ye.AUTO,tooltip:"VAE precision",getValue:n(e=>{switch(e){case ye.AUTO:return{};default:return{[`${e.toLowerCase()}-vae`]:!0}}},"getValue")},{id:"cpu-vae",name:"Run VAE on CPU",category:["Inference"],type:"boolean",defaultValue:!1},{id:"text-encoder-precision",name:"Text Encoder precision",category:["Inference"],type:"combo",options:[ye.AUTO,ye.FP8E4M3FN,ye.FP8E5M2,ye.FP16,ye.FP32],defaultValue:ye.AUTO,tooltip:"Text Encoder precision",getValue:n(e=>{switch(e){case ye.AUTO:return{};default:return{[`${e.toLowerCase()}-text-enc`]:!0}}},"getValue")},{id:"force-channels-last",name:"Force channels-last memory format",category:["Memory"],type:"boolean",defaultValue:!1},{id:"directml",name:"DirectML device index",category:["Memory"],type:"number",defaultValue:null},{id:"disable-ipex-optimize",name:"Disable IPEX optimization",category:["Memory"],type:"boolean",defaultValue:!1},{id:"preview-method",name:"Method used for latent previews",category:["Preview"],type:"combo",options:Object.values(pn),defaultValue:pn.NoPreviews},{id:"preview-size",name:"Size of preview images",category:["Preview"],type:"slider",defaultValue:512,attrs:{min:128,max:2048,step:128}},{id:"cache-classic",name:"Use classic cache system",category:["Cache"],type:"boolean",defaultValue:!1},{id:"cache-lru",name:"Use LRU caching with a maximum of N node results cached.",category:["Cache"],type:"number",defaultValue:null,tooltip:"May use more RAM/VRAM."},{id:"cross-attention-method",name:"Cross attention method",category:["Attention"],type:"combo",options:Object.values(Co),defaultValue:Co.Auto,getValue:n(e=>{switch(e){case Co.Auto:return{};default:return{[`use-${e.toLowerCase()}-cross-attention`]:!0}}},"getValue")},{id:"disable-xformers",name:"Disable xFormers optimization",type:"boolean",defaultValue:!1},{id:"force-upcast-attention",name:"Force attention upcast",category:["Attention"],type:"boolean",defaultValue:!1},{id:"dont-upcast-attention",name:"Prevent attention upcast",category:["Attention"],type:"boolean",defaultValue:!1},{id:"vram-management",name:"VRAM management mode",category:["Memory"],type:"combo",options:Object.values(So),defaultValue:So.Auto,getValue:n(e=>{switch(e){case So.Auto:return{};default:return{[e]:!0}}},"getValue")},{id:"reserve-vram",name:"Reserved VRAM (GB)",category:["Memory"],type:"number",defaultValue:null,tooltip:"Set the amount of vram in GB you want to reserve for use by your OS/other software. By default some amount is reserved depending on your OS."},{id:"default-hashing-function",name:"Default hashing function for model files",type:"combo",options:Object.values(mn),defaultValue:mn.SHA256},{id:"disable-smart-memory",name:"Disable smart memory management",tooltip:"Force ComfyUI to aggressively offload to regular ram instead of keeping models in vram when it can.",category:["Memory"],type:"boolean",defaultValue:!1},{id:"deterministic",name:"Make pytorch use slower deterministic algorithms when it can.",type:"boolean",defaultValue:!1,tooltip:"Note that this might not make images deterministic in all cases."},{id:"fast",name:"Enable some untested and potentially quality deteriorating optimizations.",type:"boolean",defaultValue:!1},{id:"dont-print-server",name:"Don't print server output to console.",type:"boolean",defaultValue:!1},{id:"disable-metadata",name:"Disable saving prompt metadata in files.",type:"boolean",defaultValue:!1},{id:"disable-all-custom-nodes",name:"Disable loading all custom nodes.",type:"boolean",defaultValue:!1},{id:"log-level",name:"Logging verbosity level",type:"combo",options:Object.values(fn),defaultValue:fn.INFO,getValue:n(e=>({verbose:e}),"getValue")},{id:"input-directory",name:"Input directory",category:["Directories"],type:"text",defaultValue:""},{id:"output-directory",name:"Output directory",category:["Directories"],type:"text",defaultValue:""}],fh=7*24*60*60*1e3,Ns=St("versionCompatibility",()=>{const e=Qa(),t=b(()=>ml.app_version),o=b(()=>e.systemStats?.system?.comfyui_version??""),s=b(()=>e.systemStats?.system?.required_frontend_version??""),l=b(()=>!t.value||!s.value||!Ft.valid(t.value)||!Ft.valid(s.value)?!1:Ft.gt(s.value,t.value)),a=b(()=>!1),i=b(()=>l.value),r=b(()=>!t.value||!o.value||!s.value?null:`${t.value}-${o.value}-${s.value}`),u=Ys("comfy.versionMismatch.dismissals",{},localStorage,{serializer:{read:n(C=>{try{return JSON.parse(C)}catch{return{}}},"read"),write:n(C=>JSON.stringify(C),"write")}}),d=b(()=>{if(!r.value)return!1;const C=u.value[r.value];return C?Date.now()<C:!1}),p=b(()=>i.value&&!d.value),g=b(()=>l.value?{type:"outdated",frontendVersion:t.value,requiredVersion:s.value}:null);async function c(){e.systemStats||await Da(e.isInitialized)}n(c,"checkVersionCompatibility");function f(){if(!r.value)return;const C=Date.now()+fh;u.value={...u.value,[r.value]:C}}n(f,"dismissWarning");async function v(){await c()}return n(v,"initialize"),{frontendVersion:t,backendVersion:o,requiredFrontendVersion:s,hasVersionMismatch:i,shouldShowWarning:p,warningMessage:g,isFrontendOutdated:l,isFrontendNewer:a,checkVersionCompatibility:c,dismissWarning:f,initialize:v}});function mh(e={}){const{immediate:t=!1}=e,{t:o}=he(),s=tt(),l=Ns();let a=!1;const i=n(()=>{if(a)return;const r=l.warningMessage;if(!r)return;const u=o("g.frontendOutdated",{frontendVersion:r.frontendVersion,requiredVersion:r.requiredVersion}),d=o("g.versionMismatchWarningMessage",{warning:o("g.versionMismatchWarning"),detail:u});s.addAlert(d),a=!0,l.dismissWarning()},"showWarning");return Me(()=>{t&&Ro(()=>l.shouldShowWarning,()=>{i()},{immediate:!0,once:!0})}),{showWarning:i,shouldShowWarning:b(()=>l.shouldShowWarning),dismissWarning:l.dismissWarning,hasVersionMismatch:b(()=>l.hasVersionMismatch)}}n(mh,"useFrontendVersionMismatchWarning");function vh(){const e=ns(),t=bo();let o=!1,s=0;ve.addEventListener("graphChanged",()=>{t.mode==="change"&&(s?o=!0:(o=!1,F.queuePrompt(0,t.batchCount),s++))}),e.$subscribe(async()=>{s=e.count,!s&&!F.lastExecutionError&&(t.mode==="instant"||t.mode==="change"&&o)&&(o=!1,await F.queuePrompt(0,t.batchCount))},{detached:!0})}n(vh,"setupAutoQueueHandler");const gh={class:"comfyui-body grid h-full w-full overflow-hidden"},hh=j({__name:"GraphView",setup(e){vh(),dh(),Zg();const{t}=he(),o=yn(),s=Z(),l=Ct(),a=Xe(),i=os(),r=vl(),u=Ns(),d=R(null);gl(),J(()=>a.completedActivePalette,$=>{const _="dark-theme";$.light_theme?document.body.classList.remove(_):document.body.classList.add(_),Oe()&&Kt().changeTheme({color:"rgba(0, 0, 0, 0)",symbolColor:$.colors.comfy_base["input-text"]})},{immediate:!0}),Oe()&&J(()=>i.tasks,($,_)=>{const P=new Set(_.filter(M=>M.isRunning).map(M=>M.promptId));$.filter(M=>P.has(M.promptId)&&M.isHistory).forEach(M=>{Kt().Events.incrementUserProperty(`execution:${M.displayStatus.toLowerCase()}`,1),Kt().Events.trackEvent("execution",{status:M.displayStatus.toLowerCase()})})},{deep:!0}),ge(()=>{const $=s.get("Comfy.TextareaWidget.FontSize");document.documentElement.style.setProperty("--comfy-textarea-font-size",`${$}px`)}),ge(()=>{const $=s.get("Comfy.TreeExplorer.ItemPadding");document.documentElement.style.setProperty("--comfy-tree-explorer-item-padding",`${$}px`)}),ge(async()=>{const $=s.get("Comfy.Locale");if($)try{await hl($),bn.global.locale.value=$}catch(_){console.error(`Failed to switch to locale "${$}":`,_)}});const p=b(()=>s.get("Comfy.UseNewMenu"));ge(()=>{p.value==="Disabled"?(F.ui.menuContainer.style.setProperty("display","block"),F.ui.restoreMenuPosition()):F.ui.menuContainer.style.setProperty("display","none")}),ge(()=>{i.maxHistoryItems=s.get("Comfy.Queue.MaxHistoryItems")});const g=n(()=>{const $=ch();be().registerCommands($),qa().registerCoreMenuCommands(),Yo().registerCoreKeybindings(),$o().registerCoreSidebarTabs(),At().registerCoreBottomPanelTabs(),F.extensionManager=Ge()},"init"),c=ns(),f=n(async $=>{c.update($),await Promise.all([i.update(),r.updateHistory()])},"onStatus"),v=n(async()=>{await Promise.all([i.update(),r.updateHistory()])},"onExecutionSuccess"),C={severity:"error",summary:t("g.reconnecting")},m=n(()=>{s.get("Comfy.Toast.DisableReconnectingToast")||(o.remove(C),o.add(C))},"onReconnecting"),h=n(()=>{s.get("Comfy.Toast.DisableReconnectingToast")||(o.remove(C),o.add({severity:"success",summary:t("g.reconnected"),life:2e3}))},"onReconnected");Me(()=>{ve.addEventListener("status",f),ve.addEventListener("execution_success",v),ve.addEventListener("reconnecting",m),ve.addEventListener("reconnected",h),l.bindExecutionEvents();try{g(),d.value?.prepend(F.ui.menuContainer)}catch($){console.error("Failed to init ComfyUI frontend",$)}}),dt(()=>{ve.removeEventListener("status",f),ve.removeEventListener("execution_success",v),ve.removeEventListener("reconnecting",m),ve.removeEventListener("reconnected",h),l.unbindExecutionEvents()}),xe(window,"keydown",Yo().keybindHandler);const{wrapWithErrorHandling:k,wrapWithErrorHandlingAsync:T}=Sn();mh({immediate:!0}),De(()=>{u.initialize().catch($=>{console.warn("Version compatibility check failed:",$)})});const S=n(()=>{ms(()=>{k(Yo().registerUserKeybindings)(),k(Bl().loadServerConfig)(ph,s.get("Comfy.Server.ServerConfigValues")),T(yl().loadModelFolders)(),T(_n().loadNodeFrequencies)(),st().nodeSearchService.searchNode("")},1e3)},"onGraphReady");return($,_)=>(y(),I(ue,null,[x("div",gh,[_[0]||(_[0]=x("div",{id:"comfyui-body-top",class:"comfyui-body-top"},null,-1)),_[1]||(_[1]=x("div",{id:"comfyui-body-bottom",class:"comfyui-body-bottom"},null,-1)),_[2]||(_[2]=x("div",{id:"comfyui-body-left",class:"comfyui-body-left"},null,-1)),_[3]||(_[3]=x("div",{id:"comfyui-body-right",class:"comfyui-body-right"},null,-1)),x("div",{id:"graph-canvas-container",ref_key:"graphCanvasContainerRef",ref:d,class:"graph-canvas-container"},[E(zg,{onReady:S})],512)]),E(ju),E(Gg),E(Yg),w(Oe)()?V("",!0):(y(),O(Qu,{key:0})),E(Yu)],64))}}),Hy=we(hh,[["__scopeId","data-v-7091dde3"]]);export{Hy as default};
//# sourceMappingURL=GraphView-DIt5okxh.js.map
